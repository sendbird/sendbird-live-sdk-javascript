!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sendbirdLive={})}(this,function(D){"use strict";function M(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){g(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function L(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function _(o){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=o.apply(e,a);function i(e){L(r,t,n,i,s,"next",e)}function s(e){L(r,t,n,i,s,"throw",e)}i(void 0)})}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function j(e,t,n){return(j=q()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);t=new(Function.bind.apply(e,r));return n&&F(t,n.prototype),t}).apply(null,arguments)}function H(e){var n="function"==typeof Map?new Map:void 0;return function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return j(e,arguments,U(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),F(t,e)}(e)}function G(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};for(var n,r={},i=Object.keys(e),s=0;s<i.length;s++)n=i[s],0<=t.indexOf(n)||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),s=0;s<i.length;s++)n=i[s],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(n){var r=q();return function(){var e,t=U(n),t=(e=r?(e=U(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return b(t)}}function V(e){return function(e){if(Array.isArray(e))return K(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||B(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){if(e){if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(e,t):void 0}}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Q(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=B(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}var z,W="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Y={exports:{}},Y=function(a){var u,e=Object.prototype,c=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function o(e,t,n,r){var i,s,a,o,t=t&&t.prototype instanceof _?t:_,t=Object.create(t.prototype),r=new S(r||[]);return t._invoke=(i=e,s=n,a=r,o=h,function(e,t){if(o===f)throw new Error("Generator is already running");if(o===p){if("throw"===e)throw t;return k()}for(a.method=e,a.arg=t;;){var n=a.delegate;if(n){n=function e(t,n){var r=t.iterator[n.method];if(r===u){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=u,e(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}r=l(r,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;r=r.arg;if(!r)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v;{if(!r.done)return r;n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=u)}n.delegate=null;return v}(n,a);if(n){if(n===v)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===h)throw o=p,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=f;n=l(i,s,a);if("normal"===n.type){if(o=a.done?p:d,n.arg!==v)return{value:n.arg,done:a.done}}else"throw"===n.type&&(o=p,a.method="throw",a.arg=n.arg)}}),t}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}a.wrap=o;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",v={};function _(){}function y(){}function m(){}var t={},g=(s(t,r,function(){return this}),Object.getPrototypeOf),g=g&&g(g(C([]))),E=(g&&g!==e&&c.call(g,r)&&(t=g),m.prototype=_.prototype=Object.create(t));function b(e){["next","throw","return"].forEach(function(t){s(e,t,function(e){return this._invoke(t,e)})})}function I(a,o){var t;this._invoke=function(n,r){function e(){return new o(function(e,t){!function t(e,n,r,i){var s,e=l(a[e],a,n);if("throw"!==e.type)return(n=(s=e.arg).value)&&"object"==typeof n&&c.call(n,"__await")?o.resolve(n.__await).then(function(e){t("next",e,r,i)},function(e){t("throw",e,r,i)}):o.resolve(n).then(function(e){s.value=e,r(s)},function(e){return t("throw",e,r,i)});i(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function C(t){if(t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=u,e.done=!0,e}).next=e}return{next:k}}function k(){return{value:u,done:!0}}return s(E,"constructor",y.prototype=m),s(m,"constructor",y),y.displayName=s(m,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,i,"GeneratorFunction")),e.prototype=Object.create(E),e},a.awrap=function(e){return{__await:e}},b(I.prototype),s(I.prototype,n,function(){return this}),a.AsyncIterator=I,a.async=function(e,t,n,r,i){void 0===i&&(i=Promise);var s=new I(o(e,t,n,r),i);return a.isGeneratorFunction(t)?s:s.next().then(function(e){return e.done?e.value:s.next()})},b(E),s(E,i,"Generator"),s(E,r,function(){return this}),s(E,"toString",function(){return"[object Generator]"}),a.keys=function(n){var e,r=[];for(e in n)r.push(e);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return s.type="throw",s.arg=n,r.next=e,t&&(r.method="next",r.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],s=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),o=c.call(i,"finallyLoc");if(a&&o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}var s=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(n=i.completion).type&&(r=n.arg,w(i)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=u),v}},a}(Y.exports);try{regeneratorRuntime=Y}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=Y:Function("r","regeneratorRuntime = r")(Y)}var X=new Uint8Array(16);var J=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Z(e){return"string"==typeof e&&J.test(e)}for(var $=[],ee=0;ee<256;++ee)$.push((ee+256).toString(16).substr(1));function te(e,t){t=1<arguments.length&&void 0!==t?t:0,e=($[e[t+0]]+$[e[t+1]]+$[e[t+2]]+$[e[t+3]]+"-"+$[e[t+4]]+$[e[t+5]]+"-"+$[e[t+6]]+$[e[t+7]]+"-"+$[e[t+8]]+$[e[t+9]]+"-"+$[e[t+10]]+$[e[t+11]]+$[e[t+12]]+$[e[t+13]]+$[e[t+14]]+$[e[t+15]]).toLowerCase();if(Z(e))return e;throw TypeError("Stringified UUID is invalid")}function ne(){try{0}catch(e){}}function oe(e,t,n){var r=(e=e||{}).random||(e.rng||function(){if(z=z||"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto))return z(X);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return te(r)}ne(),ne();function ue(e){try{return!!e()}catch(e){return!0}}function ce(e){return qe(Fe(e),8,-1)}function le(e){if(null==e)throw Ve("Can't call method on "+e);return e}function he(e){return Be(Ke(e))}function de(e){return e&&e.Math==Math&&e}function fe(t,n){try{ze(Qe,t,{value:n,configurable:!0,writable:!0})}catch(e){Qe[t]=n}return n}function pe(e){return Je(Xe(e))}function ve(e){return"Symbol("+(void 0===e?"":e)+")_"+rt(++tt+nt,36)}function _e(e){return"function"==typeof e}function ye(e,t){return arguments.length<2?(n=it[e],st(n)?n:void 0):it[e]&&it[e][t];var n}function me(e){var t;return dt(_t,e)&&(pt||"string"==typeof _t[e])||(t="Symbol."+e,pt&&dt(yt,e)?_t[e]=yt[e]:_t[e]=(vt&&mt?mt:gt)(t)),_t[e]}function ge(e){return"object"==typeof e?null!==e:Et(e)}function Ee(e){if(bt(e))return e;throw Tt(It(e)+" is not an object")}function be(e){return Ct?St.createElement(e):{}}function Ie(e){try{return Lt(e)}catch(e){return"Object"}}function Te(e){if(Pt(e))return e;throw Ft(Ut(e)+" is not a function")}function we(e,t){return null==(e=e[t])?void 0:qt(e)}function Se(e,t){if(!Kt(e)||Qt(e))return e;var n=zt(e,Xt);if(n){if(n=Bt(n,e,t=void 0===t?"default":t),!Kt(n)||Qt(n))return n;throw Yt("Can't convert object to primitive value")}return Wt(e,t=void 0===t?"number":t)}function Ce(e){return e=Jt(e,"string"),Zt(e)?e:e+""}function ke(e){return(e=+e)!=e||0==e?0:hn(e)}function Ne(e,t){return(e=dn(e))<0?fn(e+t,0):pn(e,t)}function Ae(e){return 0<e?_n(vn(e),9007199254740991):0}function Oe(e){return yn(e.length)}function Re(o){return function(e,t,n){var r,i=mn(e),s=En(i),a=gn(n,s);if(o&&t!=t){for(;a<s;)if((r=i[a++])!=r)return!0}else for(;a<s;a++)if((o||a in i)&&i[a]===t)return o||a||0;return!o&&-1}}function De(e,t){var n,r=Sn(e),i=0,s=[];for(n in r)!wn(kn,n)&&wn(r,n)&&Nn(s,n);for(;t.length>i;)!wn(r,n=t[i++])||~Cn(s,n)||Nn(s,n);return s}var Y=!ue(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),Me=Y,xe=Function.prototype,Le=xe.bind,Pe=xe.call,Ue=Me&&Le.bind(Pe,Pe),xe=Me?function(e){return e&&Ue(e)}:function(e){return e&&function(){return Pe.apply(e,arguments)}},Le=xe,Fe=Le({}.toString),qe=Le("".slice),Me=ue,je=ce,He=Object,Ge=xe("".split),Le=Me(function(){return!He("z").propertyIsEnumerable(0)})?function(e){return"String"==je(e)?Ge(e,""):He(e)}:He,Ve=TypeError,Be=Le,Ke=le,Me=de("object"==typeof globalThis&&globalThis)||de("object"==typeof window&&window)||de("object"==typeof self&&self)||de("object"==typeof W&&W)||function(){return this}()||Function("return this")(),W={exports:{}},Qe=Me,ze=Object.defineProperty,e=fe,We="__core-js_shared__",e=Me[We]||e(We,{}),Ye=e,Xe=((W.exports=function(e,t){return Ye[e]||(Ye[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.23.4",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.4/LICENSE",source:"https://github.com/zloirock/core-js"}),le),Je=Object,Ze=pe,$e=xe({}.hasOwnProperty),We=Object.hasOwn||function(e,t){return $e(Ze(e),t)},et=xe,tt=0,nt=Math.random(),rt=et(1..toString),it=Me,st=_e,et=ye("navigator","userAgent")||"",at=et,ot=Me.process,ut=Me.Deno,ot=ot&&ot.versions||ut&&ut.version,ut=ot&&ot.v8,ot=ht=!(ht=ut?0<(lt=ut.split("."))[0]&&lt[0]<4?1:+(lt[0]+lt[1]):ht)&&at&&(!(lt=at.match(/Edge\/(\d+)/))||74<=lt[1])&&(lt=at.match(/Chrome\/(\d+)/))?+lt[1]:ht,ct=ot,ut=ue,at=!!Object.getOwnPropertySymbols&&!ut(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ct&&ct<41}),lt=at&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ht=Me,ut=W.exports,dt=We,ft=ve,pt=at,vt=lt,_t=ut("wks"),yt=ht.Symbol,mt=yt&&yt.for,gt=vt?yt:yt&&yt.withoutSetter||ft,Et=_e,bt=ge,It=String,Tt=TypeError,at={},ut=!ue(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),ht=ut&&ue(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),ft={},wt=ge,St=Me.document,Ct=wt(St)&&wt(St.createElement),kt=be,wt=!ut&&!ue(function(){return 7!=Object.defineProperty(kt("div"),"a",{get:function(){return 7}}).a}),Nt=Function.prototype.call,At=Y?Nt.bind(Nt):function(){return Nt.apply(Nt,arguments)},Ot=xe({}.isPrototypeOf),Rt=ye,Dt=_e,Mt=Ot,xt=Object,lt=lt?function(e){return"symbol"==typeof e}:function(e){var t=Rt("Symbol");return Dt(t)&&Mt(t.prototype,xt(e))},Lt=String,Pt=_e,Ut=Ie,Ft=TypeError,qt=Te,jt=At,Ht=_e,Gt=ge,Vt=TypeError,Bt=At,Kt=ge,Qt=lt,zt=we,Wt=function(e,t){var n,r;if("string"===t&&Ht(n=e.toString)&&!Gt(r=jt(n,e)))return r;if(Ht(n=e.valueOf)&&!Gt(r=jt(n,e)))return r;if("string"!==t&&Ht(n=e.toString)&&!Gt(r=jt(n,e)))return r;throw Vt("Can't convert object to primitive value")},Yt=TypeError,Xt=me("toPrimitive"),Jt=Se,Zt=lt,$t=wt,en=Ee,tn=Ce,nn=TypeError,rn=Object.defineProperty,sn=Object.getOwnPropertyDescriptor,an="enumerable",on="configurable",un="writable",cn=(ft.f=ut?ht?function(e,t,n){var r;return en(e),t=tn(t),en(n),"function"==typeof e&&"prototype"===t&&"value"in n&&un in n&&!n[un]&&((r=sn(e,t))&&r[un]&&(e[t]=n.value,n={configurable:(on in n?n:r)[on],enumerable:(an in n?n:r)[an],writable:!1})),rn(e,t,n)}:rn:function(e,t,n){if(en(e),t=tn(t),en(n),$t)try{return rn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw nn("Accessors not supported");return"value"in n&&(e[t]=n.value),e},Math.ceil),ln=Math.floor,hn=Math.trunc||function(e){e=+e;return(0<e?ln:cn)(e)},dn=ke,fn=Math.max,pn=Math.min,vn=ke,_n=Math.min,yn=Ae,mn=he,gn=Ne,En=Oe,bn={includes:Re(!0),indexOf:Re(!1)},In={},Tn=xe,wn=We,Sn=he,Cn=bn.indexOf,kn=In,Nn=Tn([].push),Tn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],An=De,On=Tn,Rn=Object.keys||function(e){return An(e,On)},Dn=ft,Mn=Ee,xn=he,Ln=Rn;at.f=ut&&!ht?Object.defineProperties:function(e,t){Mn(e);for(var n,r=xn(t),i=Ln(t),s=i.length,a=0;a<s;)Dn.f(e,n=i[a++],r[n]);return e};function Pn(e){return nr[e]||(nr[e]=tr(e))}function Un(){}function Fn(e){e.write(hr("")),e.close();var t=e.parentWindow.Object;return e=null,t}function qn(e){_r[vr][e]=!0}function jn(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function Hn(e,t,n,r){var i=(r=r||{}).enumerable,s=void 0!==r.name?r.name:t;if(Xr(n)&&Zr(n,s,r),r.global)i?e[t]=n:$r(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=n:Jr.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e}function Gn(e,t){return(e=pi[fi(e)])==_i||e!=vi&&(hi(t)?li(t):!!t)}function Vn(e,t){var n,r,i,s=e.target,a=e.global,o=e.stat,u=a?yi:o?yi[s]||bi(s,{}):(yi[s]||{}).prototype;if(u)for(n in t){if(r=t[n],i=e.dontCallGetSet?(i=mi(u,n))&&i.value:u[n],!Ti(a?n:s+(o?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;Ii(r,i)}(e.sham||i&&i.sham)&&gi(r,"sham",!0),Ei(u,n,r,e)}}var Bn,Kn,Qn,zn,Wn,Yn,Xn,Jn,Zn,$n,ht=ye("document","documentElement"),er=W.exports,tr=ve,nr=er("keys"),rr=Ee,ir=at,sr=Tn,er=In,ar=ht,or=be,ur="prototype",cr="script",lr=Pn("IE_PROTO"),hr=function(e){return"<"+cr+">"+e+"</"+cr+">"},dr=function(){try{Bn=new ActiveXObject("htmlfile")}catch(e){}dr="undefined"==typeof document||document.domain&&Bn?Fn(Bn):(e=or("iframe"),t="java"+cr+":",e.style.display="none",ar.appendChild(e),e.src=String(t),(t=e.contentWindow.document).open(),t.write(hr("document.F=Object")),t.close(),t.F);for(var e,t,n=sr.length;n--;)delete dr[ur][sr[n]];return dr()},at=(er[lr]=!0,Object.create||function(e,t){var n;return null!==e?(Un[ur]=rr(e),n=new Un,Un[ur]=null,n[lr]=e):n=dr(),void 0===t?n:ir.f(n,t)}),er=me,fr=at,pr=ft.f,vr=er("unscopables"),_r=Array.prototype,er=(null==_r[vr]&&pr(_r,vr,{configurable:!0,value:fr(null)}),{}),pr=_e,fr=e,yr=xe(Function.toString),pr=(pr(fr.inspectSource)||(fr.inspectSource=function(e){return yr(e)}),fr.inspectSource),fr=_e,mr=pr,gr=Me.WeakMap,fr=fr(gr)&&/native code/.test(mr(gr)),Er=ft,br=jn,mr=ut?function(e,t,n){return Er.f(e,t,br(1,n))}:function(e,t,n){return e[t]=n,e},gr=xe,Ir=ge,Tr=mr,wr=We,Sr=Pn,Cr=In,kr="Object already initialized",Nr=Me.TypeError,Ar=Me.WeakMap,fr=(Jn=fr||e.state?(Kn=e.state||(e.state=new Ar),Qn=gr(Kn.get),zn=gr(Kn.has),Wn=gr(Kn.set),Yn=function(e,t){if(zn(Kn,e))throw new Nr(kr);return t.facade=e,Wn(Kn,e,t),t},Xn=function(e){return Qn(Kn,e)||{}},function(e){return zn(Kn,e)}):(Cr[Zn=Sr("state")]=!0,Yn=function(e,t){if(wr(e,Zn))throw new Nr(kr);return t.facade=e,Tr(e,Zn,t),t},Xn=function(e){return wr(e,Zn)?e[Zn]:{}},function(e){return wr(e,Zn)}),{set:Yn,get:Xn,has:Jn,enforce:function(e){return Jn(e)?Xn(e):Yn(e,{})},getterFor:function(t){return function(e){if(Ir(e)&&(e=Xn(e)).type===t)return e;throw Nr("Incompatible receiver, "+t+" required")}}}),e={},Ar={},gr={}.propertyIsEnumerable,Or=Object.getOwnPropertyDescriptor,Cr=Or&&!gr.call({1:2},1),Sr=(Ar.f=Cr?function(e){e=Or(this,e);return!!e&&e.enumerable}:gr,ut),Rr=At,Dr=Ar,Mr=jn,xr=he,Lr=Ce,Pr=We,Ur=wt,Fr=Object.getOwnPropertyDescriptor,Cr=(e.f=Sr?Fr:function(e,t){if(e=xr(e),t=Lr(t),Ur)try{return Fr(e,t)}catch(e){}if(Pr(e,t))return Mr(!Rr(Dr.f,e,t),e[t])},{exports:{}}),gr=ut,wt=We,Sr=Function.prototype,qr=gr&&Object.getOwnPropertyDescriptor,wt=wt(Sr,"name"),wt={EXISTS:wt,PROPER:wt&&"something"===function(){}.name,CONFIGURABLE:wt&&(!gr||qr(Sr,"name").configurable)},gr=ue,jr=_e,Hr=We,Gr=ut,Vr=wt.CONFIGURABLE,Br=pr,Kr=fr.enforce,Qr=fr.get,zr=Object.defineProperty,Wr=Gr&&!gr(function(){return 8!==zr(function(){},"length",{value:8}).length}),Yr=String(String).split("String"),qr=Cr.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Hr(e,"name")||Vr&&e.name!==t)&&(Gr?zr(e,"name",{value:t,configurable:!0}):e.name=t),Wr&&n&&Hr(n,"arity")&&e.length!==n.arity&&zr(e,"length",{value:n.arity});try{n&&Hr(n,"constructor")&&n.constructor?Gr&&zr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}n=Kr(e);return Hr(n,"source")||(n.source=Yr.join("string"==typeof t?t:"")),e},Xr=(Function.prototype.toString=qr(function(){return jr(this)&&Qr(this).source||Br(this)},"toString"),_e),Jr=ft,Zr=Cr.exports,$r=fe,Sr={},ei=De,ti=Tn.concat("length","prototype"),gr=(Sr.f=Object.getOwnPropertyNames||function(e){return ei(e,ti)},{}),qr=(gr.f=Object.getOwnPropertySymbols,ye),ni=Sr,ri=gr,ii=Ee,si=xe([].concat),Cr=qr("Reflect","ownKeys")||function(e){var t=ni.f(ii(e)),n=ri.f;return n?si(t,n(e)):t},ai=We,oi=Cr,ui=e,ci=ft,li=ue,hi=_e,di=/#|\.prototype\./,fi=Gn.normalize=function(e){return String(e).replace(di,".").toLowerCase()},pi=Gn.data={},vi=Gn.NATIVE="N",_i=Gn.POLYFILL="P",Tn=Gn,yi=Me,mi=e.f,gi=mr,Ei=Hn,bi=fe,Ii=function(e,t,n){for(var r=oi(t),i=ci.f,s=ui.f,a=0;a<r.length;a++){var o=r[a];ai(e,o)||n&&ai(n,o)||i(e,o,s(t,o))}},Ti=Tn,qr=!ue(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),wi=We,Si=_e,Ci=pe,Cr=qr,ki=Pn("IE_PROTO"),Ni=Object,Ai=Ni.prototype,qr=Cr?Ni.getPrototypeOf:function(e){e=Ci(e);if(wi(e,ki))return e[ki];var t=e.constructor;return Si(t)&&e instanceof t?t.prototype:e instanceof Ni?Ai:null},Cr=ue,Oi=_e,Ri=qr,Di=Hn,Mi=me("iterator"),xi=!1;[].keys&&("next"in(qi=[].keys())?(Ri=Ri(Ri(qi)))!==Object.prototype&&($n=Ri):xi=!0);function Li(e,t,n){(e=e&&!n?e.prototype:e)&&!Hi(e,Gi)&&ji(e,Gi,{configurable:!0,value:t})}function Pi(){return this}function Ui(){return this}function Fi(e,t,n,r,i,s,a){function o(e){if(e===i&&f)return f;if(!fs&&e in h)return h[e];switch(e){case"keys":case vs:case _s:return function(){return new n(this,e)}}return function(){return new n(this)}}rs(n,t,r);var u,c,r=t+" Iterator",l=!1,h=e.prototype,d=h[ps]||h["@@iterator"]||i&&h[i],f=!fs&&d||o(i),p="Array"==t&&h.entries||d;if(p&&(p=is(p.call(new e)))!==Object.prototype&&p.next&&(is(p)!==ds&&(ss?ss(p,ds):ns(p[ps])||us(p,ps,Ui)),as(p,r,!0)),ls&&i==vs&&d&&d.name!==vs&&(hs?os(h,"name",vs):(l=!0,f=function(){return ts(d,this)})),i)if(u={values:o(vs),keys:s?f:o("keys"),entries:o(_s)},a)for(c in u)!fs&&!l&&c in h||us(h,c,u[c]);else es({target:t,proto:!0,forced:fs||l},u);return h[ps]!==f&&us(h,ps,f,{name:i}),cs[t]=f,u}Oi(($n=null==$n||Cr(function(){var e={};return $n[Mi].call(e)!==e})?{}:$n)[Mi])||Di($n,Mi,function(){return this});var qi={IteratorPrototype:$n,BUGGY_SAFARI_ITERATORS:xi},ji=ft.f,Hi=We,Gi=me("toStringTag"),Vi=qi.IteratorPrototype,Bi=at,Ki=jn,Qi=Li,zi=er,Wi=_e,Yi=String,Xi=TypeError,Ji=xe,Zi=Ee,$i=function(e){if("object"==typeof e||Wi(e))return e;throw Xi("Can't set "+Yi(e)+" as a prototype")},Ri=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Ji(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return Zi(e),$i(t),r?n(e,t):e.__proto__=t,e}}():void 0),es=Vn,ts=At,ns=_e,rs=function(e,t,n,r){t+=" Iterator";return e.prototype=Bi(Vi,{next:Ki(+!r,n)}),Qi(e,t,!1),zi[t]=Pi,e},is=qr,ss=Ri,as=Li,os=mr,us=Hn,Oi=me,cs=er,ls=wt.PROPER,hs=wt.CONFIGURABLE,ds=qi.IteratorPrototype,fs=qi.BUGGY_SAFARI_ITERATORS,ps=Oi("iterator"),vs="values",_s="entries",ys=he,Cr=qn,Di=er,xi=fr,qr=ft.f,qi=Fi,Oi=ut,ms="Array Iterator",gs=xi.set,Es=xi.getterFor(ms),xi=qi(Array,"Array",function(e,t){gs(this,{type:ms,target:ys(e),index:0,kind:t})},function(){var e=Es(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),qi=Di.Arguments=Di.Array;if(Cr("keys"),Cr("values"),Cr("entries"),Oi&&"values"!==qi.name)try{qr(qi,"name",{value:"values"})}catch(e){}var Di={},Cr=(Di[me("toStringTag")]="z","[object z]"===String(Di)),Oi=Cr,bs=_e,Is=ce,Ts=me("toStringTag"),ws=Object,Ss="Arguments"==Is(function(){return arguments}()),qr=Oi?Is:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(t=function(e,t){try{return e[t]}catch(e){}}(e=ws(e),Ts))?t:Ss?Is(e):"Object"==(t=Is(e))&&bs(e.callee)?"Arguments":t},Cs=qr;Cr||Hn(Object.prototype,"toString",Cr?{}.toString:function(){return"[object "+Cs(this)+"]"},{unsafe:!0});function ks(e){var e=Ls(e),t=Ps.f;Us&&e&&!e[Fs]&&t(e,Fs,{configurable:!0,get:function(){return this}})}function Ns(e,t){if(qs(t,e))return e;throw js("Incorrect invocation")}function As(){}function Os(e){if(!Hs(e))return!1;try{return Ks(As,Bs,e),!0}catch(e){return!1}}function Rs(e){if(!Hs(e))return!1;switch(Gs(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ws||!!zs(Qs,Vs(e))}catch(e){return!0}}function Ds(e,t){return ra(e),void 0===t?e:ia?sa(e,t):function(){return e.apply(t,arguments)}}var Ms,xs,qi="process"==ce(Me.process),Ls=ye,Ps=ft,Us=ut,Fs=me("species"),qs=Ot,js=TypeError,Di=xe,Oi=ue,Hs=_e,Gs=qr,Vs=pr,Bs=[],Ks=ye("Reflect","construct"),Qs=/^\s*(?:class|function)\b/,zs=Di(Qs.exec),Ws=!Qs.exec(As),Cr=(Rs.sham=!0,!Ks||Oi(function(){var e;return Os(Os.call)||!Os(Object)||!Os(function(){e=!0})||e})?Rs:Os),Ys=Cr,Xs=Ie,Js=TypeError,Zs=Ee,$s=function(e){if(Ys(e))return e;throw Js(Xs(e)+" is not a constructor")},ea=me("species"),Di=Function.prototype,ta=Di.apply,na=Di.call,Oi="object"==typeof Reflect&&Reflect.apply||(Y?na.bind(ta):function(){return na.apply(ta,arguments)}),ra=Te,ia=Y,sa=xe(xe.bind),Di=xe([].slice),aa=TypeError,Y=/(?:ipad|iphone|ipod).*applewebkit/i.test(et),oa=Me,ua=Oi,t=Ds,ca=_e,la=We,ha=ue,da=ht,fa=Di,pa=be,va=function(e,t){if(e<t)throw aa("Not enough arguments");return e},ht=Y,n=qi,_a=oa.setImmediate,r=oa.clearImmediate,ya=oa.process,ma=oa.Dispatch,ga=oa.Function,Ea=oa.MessageChannel,ba=oa.String,Ia=0,Ta={},wa="onreadystatechange";try{Ms=oa.location}catch(e){}function Sa(e){return function(){Ga(e)}}function Ca(e){Ga(e.data)}function ka(e){oa.postMessage(ba(e),Ms.protocol+"//"+Ms.host)}function Na(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}function Aa(){this.head=null,this.tail=null}function Oa(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=to(n),this.reject=to(r)}function Ra(e,t){var n,r,i,s,a=t.value,o=t.state==Do,u=o?e.ok:e.fail,c=e.resolve,l=e.reject,h=e.domain;try{u?(o||(t.rejection===Lo&&(s=t,io(lo,ro,function(){var e=s.facade;no?Co.emit("rejectionHandled",e):Fo(Ro,e,s.value)})),t.rejection=xo),!0===u?n=a:(h&&h.enter(),n=u(a),h&&(h.exit(),i=!0)),n===e.promise?l(wo("Promise-chain cycle")):(r=Po(n))?io(r,n,c,l):c(n)):l(a)}catch(e){h&&!i&&h.exit(),l(e)}}var Da,Ma,xa,La,Pa,Ua,Fa,qa,ja,Ha,Ga=function(e){var t;la(Ta,e)&&(t=Ta[e],delete Ta[e],t())},Ea=(_a&&r||(_a=function(e){va(arguments.length,1);var t=ca(e)?e:ga(e),n=fa(arguments,1);return Ta[++Ia]=function(){ua(t,void 0,n)},xs(Ia),Ia},r=function(e){delete Ta[e]},n?xs=function(e){ya.nextTick(Sa(e))}:ma&&ma.now?xs=function(e){ma.now(Sa(e))}:Ea&&!ht?(ht=(n=new Ea).port2,n.port1.onmessage=Ca,xs=t(ht.postMessage,ht)):oa.addEventListener&&ca(oa.postMessage)&&!oa.importScripts&&Ms&&"file:"!==Ms.protocol&&!ha(ka)?(xs=ka,oa.addEventListener("message",Ca,!1)):xs=wa in pa("script")?function(e){da.appendChild(pa("script"))[wa]=function(){da.removeChild(this),Ga(e)}}:function(e){setTimeout(Sa(e),0)}),{set:_a,clear:r}),n=Me,t=/ipad|iphone|ipod/i.test(et)&&void 0!==n.Pebble,ht=/web0s(?!.*chrome)/i.test(et),ha=Me,_a=Ds,r=e.f,Va=Ea.set,n=Y,Y=t,t=ht,Ba=qi,ht=ha.MutationObserver||ha.WebKitMutationObserver,i=ha.document,Ka=ha.process,Qa=ha.Promise,r=r(ha,"queueMicrotask"),r=r&&r.value,t=(r||(Da=function(){var e,t;for(Ba&&(e=Ka.domain)&&e.exit();Ma;){t=Ma.fn,Ma=Ma.next;try{t()}catch(e){throw Ma?La():xa=void 0,e}}xa=void 0,e&&e.enter()},La=n||Ba||t||!ht||!i?!Y&&Qa&&Qa.resolve?((n=Qa.resolve(void 0)).constructor=Qa,Fa=_a(n.then,n),function(){Fa(Da)}):Ba?function(){Ka.nextTick(Da)}:(Va=_a(Va,ha),function(){Va(Da)}):(Pa=!0,Ua=i.createTextNode(""),new ht(Da).observe(Ua,{characterData:!0}),function(){Ua.data=Pa=!Pa})),r||function(e){e={fn:e,next:void 0};xa&&(xa.next=e),Ma||(Ma=e,La()),xa=e}),za=Me,Y=(Aa.prototype={add:function(e){e={item:e,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},Aa),Qa=Me.Promise,n="object"==typeof window&&"object"!=typeof Deno,_a=Me,Wa=Qa,ha=_e,i=Tn,Ya=pr,ht=me,Xa=n,Ja=ot,Za=(Wa&&Wa.prototype,ht("species")),$a=!1,eo=ha(_a.PromiseRejectionEvent),r={CONSTRUCTOR:i("Promise",function(){var e=Ya(Wa),t=e!==String(Wa);if(!t&&66===Ja)return!0;if(51<=Ja&&/native code/.test(e))return!1;function n(e){e(function(){},function(){})}e=new Wa(function(e){e(1)});return(e.constructor={})[Za]=n,!($a=e.then(function(){})instanceof n)||!t&&Xa&&!eo}),REJECTION_EVENT:eo,SUBCLASSING:$a},pr={},to=Te,n=(pr.f=function(e){return new Oa(e)},Vn),no=qi,ro=Me,io=At,ht=Hn,ha=Ri,_a=Li,i=ks,so=Te,ao=_e,oo=ge,uo=Ns,co=function(e,t){var e=Zs(e).constructor;return void 0===e||null==(e=Zs(e)[ea])?t:$s(e)},lo=Ea.set,ho=t,fo=function(e,t){var n=za.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},po=Na,vo=Y,Ea=fr,t=Qa,Y=pr,_o="Promise",yo=r.CONSTRUCTOR,mo=r.REJECTION_EVENT,go=r.SUBCLASSING,Eo=Ea.getterFor(_o),bo=Ea.set,Ea=t&&t.prototype,Io=t,To=Ea,wo=ro.TypeError,So=ro.document,Co=ro.process,ko=Y.f,No=ko,Ao=!!(So&&So.createEvent&&ro.dispatchEvent),Oo="unhandledrejection",Ro="rejectionhandled",Do=1,Mo=2,xo=1,Lo=2,Po=function(e){var t;return!(!oo(e)||!ao(t=e.then))&&t},Uo=function(n,i){n.notified||(n.notified=!0,ho(function(){for(var e,r,t=n.reactions;e=t.get();)Ra(e,n);n.notified=!1,i&&!n.rejection&&(r=n,io(lo,ro,function(){var e=r.facade,t=r.value,n=qo(r);if(n&&(n=po(function(){no?Co.emit("unhandledRejection",t,e):Fo(Oo,e,t)}),r.rejection=no||qo(r)?Lo:xo,n.error))throw n.value}))}))},Fo=function(e,t,n){var r;Ao?((r=So.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),ro.dispatchEvent(r)):r={promise:t,reason:n},!mo&&(t=ro["on"+e])?t(r):e===Oo&&fo("Unhandled promise rejection",n)},qo=function(e){return e.rejection!==xo&&!e.parent},jo=function(t,n,r){return function(e){t(n,e,r)}},Ho=function(e,t,n){e.done||(e.done=!0,(e=n?n:e).value=t,e.state=Mo,Uo(e,!0))},Go=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw wo("Promise can't be resolved itself");var r=Po(e);r?ho(function(){var t={done:!1};try{io(r,e,jo(Go,t,n),jo(Ho,t,n))}catch(e){Ho(t,e,n)}}):(n.value=e,n.state=Do,Uo(n,!1))}catch(e){Ho({done:!1},e,n)}}};if(yo&&(To=(Io=function(e){uo(this,To),so(e),io(qa,this);var t=Eo(this);try{e(jo(Go,t),jo(Ho,t))}catch(e){Ho(t,e)}}).prototype,(qa=function(e){bo(this,{type:_o,done:!1,notified:!1,parent:!1,reactions:new vo,rejection:!1,state:0,value:void 0})}).prototype=ht(To,"then",function(e,t){var n=Eo(this),r=ko(co(this,Io));return n.parent=!0,r.ok=!ao(e)||e,r.fail=ao(t)&&t,r.domain=no?Co.domain:void 0,0==n.state?n.reactions.add(r):ho(function(){Ra(r,n)}),r.promise}),ja=function(){var e=new qa,t=Eo(e);this.promise=e,this.resolve=jo(Go,t),this.reject=jo(Ho,t)},Y.f=ko=function(e){return e===Io||void 0===e?new ja:No(e)},ao(t)&&Ea!==Object.prototype)){Ha=Ea.then,go||ht(Ea,"then",function(e,t){var n=this;return new Io(function(e,t){io(Ha,n,e,t)}).then(e,t)},{unsafe:!0});try{delete Ea.constructor}catch(e){}ha&&ha(Ea,To)}n({global:!0,constructor:!0,wrap:!0,forced:yo},{Promise:Io}),_a(Io,_o,!1),i(_o);function Vo(e){if(null!=e)return Xo(e,Zo)||Xo(e,"@@iterator")||Jo[Yo(e)]}function Bo(e,t){this.stopped=e,this.result=t}function Ko(e,t,n){function r(e){return s&&yu(s,"normal",e),new Bo(!0,e)}function i(e){return d?(lu(e),v?_(e[0],e[1],r):_(e[0],e[1])):v?_(e,r):_(e)}var s,a,o,u,c,l,h=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),v=!(!n||!n.INTERRUPTED),_=uu(t,h);if(f)s=e.iterator;else if(p)s=e;else{if(!(n=_u(e)))throw mu(hu(e)+" is not iterable");if(du(n)){for(a=0,o=fu(e);a<o;a++)if((u=i(e[a]))&&pu(gu,u))return u;return new Bo(!1)}s=vu(e,n)}for(c=(f?e:s).next;!(l=cu(c,s)).done;){try{u=i(l.value)}catch(e){yu(s,"throw",e)}if("object"==typeof u&&u&&pu(gu,u))return u}return new Bo(!1)}var Qo=er,zo=me("iterator"),Wo=Array.prototype,Yo=qr,Xo=we,Jo=er,Zo=me("iterator"),$o=At,eu=Te,tu=Ee,nu=Ie,ru=Vo,iu=TypeError,su=At,au=Ee,ou=we,uu=Ds,cu=At,lu=Ee,hu=Ie,du=function(e){return void 0!==e&&(Qo.Array===e||Wo[zo]===e)},fu=Oe,pu=Ot,vu=function(e,t){t=arguments.length<2?ru(e):t;if(eu(t))return tu($o(t,e));throw iu(nu(e)+" is not iterable")},_u=Vo,yu=function(e,t,n){var r,i;au(e);try{if(!(r=ou(e,"return"))){if("throw"===t)throw n;return n}r=su(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return au(r),n},mu=TypeError,gu=Bo.prototype,Eu=me("iterator"),bu=!1;try{var Iu=0,Tu={next:function(){return{done:!!Iu++}},return:function(){bu=!0}};Tu[Eu]=function(){return this},Array.from(Tu,function(){throw 2})}catch(e){}function wu(e,t){if(!t&&!bu)return!1;var n=!1;try{var r={};r[Eu]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}var Su=Qa,Y=wu,t=r.CONSTRUCTOR||!Y(function(e){Su.all(e).then(void 0,function(){})}),Cu=At,ku=Te,Nu=pr,Au=Na,Ou=Ko,go=(Vn({target:"Promise",stat:!0,forced:t},{all:function(e){var o=this,t=Nu.f(o),u=t.resolve,c=t.reject,n=Au(function(){var r=ku(o.resolve),i=[],s=0,a=1;Ou(e,function(e){var t=s++,n=!1;a++,Cu(r,o,e).then(function(e){n||(n=!0,i[t]=e,--a||u(i))},c)}),--a||u(i)});return n.error&&c(n.value),t.promise}}),Vn),ht=Qa,ha=ye,Ea=_e,n=Hn,yo=ht&&ht.prototype;go({target:"Promise",proto:!0,forced:r.CONSTRUCTOR,real:!0},{catch:function(e){return this.then(void 0,e)}}),Ea(ht)&&(_a=ha("Promise").prototype.catch,yo.catch!==_a&&n(yo,"catch",_a,{unsafe:!0}));var Ru=At,Du=Te,Mu=pr,xu=Na,Lu=Ko;Vn({target:"Promise",stat:!0,forced:t},{race:function(e){var n=this,r=Mu.f(n),i=r.reject,t=xu(function(){var t=Du(n.resolve);Lu(e,function(e){Ru(t,n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}});function Pu(e){if("Symbol"===Qu(e))throw TypeError("Cannot convert a Symbol value to a string");return zu(e)}function Uu(i){return function(e,t){var n,e=Yu(Xu(e)),t=Wu(t),r=e.length;return t<0||r<=t?i?"":void 0:(n=Zu(e,t))<55296||56319<n||t+1===r||(r=Zu(e,t+1))<56320||57343<r?i?Ju(e,t):n:i?$u(e,t,t+2):r-56320+(n-55296<<10)+65536}}function Fu(t,e){if(t){if(t[cc]!==hc)try{uc(t,cc,hc)}catch(e){t[cc]=hc}if(t[lc]||uc(t,lc,e),ac[e])for(var n in oc)if(t[n]!==oc[n])try{uc(t,n,oc[n])}catch(e){t[n]=oc[n]}}}var qu,ju=At,Hu=pr,Gu=(Vn({target:"Promise",stat:!0,forced:r.CONSTRUCTOR},{reject:function(e){var t=Hu.f(this);return ju(t.reject,void 0,e),t.promise}}),Ee),Vu=ge,Bu=pr,i=Vn,er=ye,Tu=r.CONSTRUCTOR,Ku=function(e,t){if(Gu(e),Vu(t)&&t.constructor===e)return t;e=Bu.f(e);return(0,e.resolve)(t),e.promise},Qu=(er("Promise"),i({target:"Promise",stat:!0,forced:Tu},{resolve:function(e){return Ku(this,e)}}),qr),zu=String,Y=xe,Wu=ke,Yu=Pu,Xu=le,Ju=Y("".charAt),Zu=Y("".charCodeAt),$u=Y("".slice),Qa={codeAt:Uu(!1),charAt:Uu(!0)},ec=Qa.charAt,tc=Pu,go=fr,Ea=Fi,nc="String Iterator",rc=go.set,ic=go.getterFor(nc),ht=(Ea(String,"String",function(e){rc(this,{type:nc,string:tc(e),index:0})},function(){var e=ic(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=ec(t,n),e.index+=t.length,{value:t,done:!1})}),{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),ha=be("span").classList,n=ha&&ha.constructor&&ha.constructor.prototype,yo=n===Object.prototype?void 0:n,sc=Me,ac=ht,_a=yo,oc=xi,uc=mr,t=me,cc=t("iterator"),lc=t("toStringTag"),hc=oc.values;for(qu in ac)Fu(sc[qu]&&sc[qu].prototype,qu);Fu(_a,"DOMTokenList");function dc(e,t){return new(Ic(e))(0===t?0:t)}function fc(d){var f=1==d,p=2==d,v=3==d,_=4==d,y=6==d,m=7==d,g=5==d||y;return function(e,t,n,r){for(var i,s,a=Sc(e),o=wc(a),u=Tc(t,n),c=Cc(o),l=0,t=r||kc,h=f?t(e,c):p||m?t(e,0):void 0;l<c;l++)if((g||l in o)&&(s=u(i=o[l],l,a),d))if(f)h[l]=s;else if(s)switch(d){case 3:return!0;case 5:return i;case 6:return l;case 2:Nc(h,i)}else switch(d){case 4:return!1;case 7:Nc(h,i)}return y?-1:v||_?_:h}}function pc(t){return 51<=Oc||!Ac(function(){var e=[];return(e.constructor={})[Rc]=function(){return{foo:1}},1!==e[t](Boolean).foo})}var c,vc,_c=ce,pr=Array.isArray||function(e){return"Array"==_c(e)},yc=pr,mc=Cr,gc=ge,Ec=me("species"),bc=Array,Ic=function(e){var t;return yc(e)&&(t=e.constructor,(mc(t)&&(t===bc||yc(t.prototype))||gc(t)&&null===(t=t[Ec]))&&(t=void 0)),void 0===t?bc:t},Tc=Ds,wc=Le,Sc=pe,Cc=Oe,kc=dc,Nc=xe([].push),r={forEach:fc(0),map:fc(1),filter:fc(2),some:fc(3),every:fc(4),find:fc(5),findIndex:fc(6),filterReject:fc(7)},Ac=ue,Oc=ot,Rc=me("species"),er=Vn,Dc=r.map,Mc=(er({target:"Array",proto:!0,forced:!pc("map")},{map:function(e){return Dc(this,e,1<arguments.length?arguments[1]:void 0)}}),m(function e(){y(this,e)})),xc=function(){E(t,Mc);var e=I(t);function t(){return y(this,t),e.call(this)}return m(t,[{key:"getApiOption",value:function(){return{auth:this.getAuth(),path:this.getPath(),method:this.getMethod(),body:this.getData(),headers:this.getHeaders()}}},{key:"getAuth",value:function(){return!0}},{key:"getHeaders",value:function(){return{}}}]),t}(),Lc=function(){E(t,xc);var e=I(t);function t(){return y(this,t),e.call(this)}return m(t,[{key:"getPath",value:function(){return"/v1".concat(this.getSubPath())}}]),t}(),Pc=((i=c=c||{}).CREATE="create",i.UPDATE="update",i.GET="get",i.DELETE="delete",i.QUERY="query",i.READY="ready",i.START="start",i.ENTER_HOST="enter_host",i.GET_HOSTS="get_hosts",i.EXIT_HOST="exit_host",i.HOST_ALIVE="host_alive",i.AUDIO="audio",i.VIDEO="video",i.HOST_CREATE_STREAM="host_create_stream",i.HOST_DELETE_STREAM="host_delete_stream",i.HOST_CONNECTED="host_connected",i.ENTER="enter",i.EXIT="exit",i.ALIVE="alive",i.GET_PARTICIPANTS="get_participants",i.CREATE_STREAM="create_stream",i.DELETE_STREAM="delete_stream",i.CONNECTED="connected",i.ATTACH="attach",i.CUSTOM_ITEMS_GET="custom_items_get",i.CUSTOM_ITEMS_UPDATE="custom_items_update",i.CUSTOM_ITEMS_DELETE="custom_items_delete",i.LIVE_EVENT_READY="live_event_ready",i.LIVE_EVENT_STARTED="live_event_started",i.LIVE_EVENT_ENDED="live_event_ended",i.LIVE_EVENT_UPDATED="live_event_updated",i.HOST_ENTERED="host_entered",i.HOST_EXITED="host_exited",i.HOST_DISCONNECTED="host_disconnected",i.HOST_AUDIO_STATUS_CHANGED="host_audio_status_changed",i.HOST_VIDEO_STATUS_CHANGED="host_video_status_changed",i.PARTICIPANT_ENTERED="participant_entered",i.PARTICIPANT_EXITED="participant_exited",(Tu=vc=vc||{}).SINGLE_HOST="single_host",Tu.MULTIPLE_HOST="multiple_host",function(){E(r,Mc);var n=I(r);function r(e){var t;return y(this,r),(t=n.call(this)).payload=t.parseData(e),t}return m(r)}()),Uc=function(){E(t,Pc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t)}();function Fc(e){return{liveEventId:e.live_event_id,createdAt:e.created_at,setReadyAt:e.set_ready_at,startedAt:e.started_at,endedAt:e.ended_at,state:e.state,isHostStreaming:e.is_host_streaming,createdBy:e.created_by,setReadyBy:e.set_ready_by,startedBy:e.started_by,endedBy:e.ended_by,duration:e.duration,host:e.host?qc(e.host):void 0,participantCount:e.participant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count,userIdsForHost:e.user_ids_for_host,customItems:e.custom_items,title:e.title,coverUrl:e.cover_url}}function qc(e){return{hostId:e.host_id,userId:e.user.user_id,nickname:e.user.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,connectedAt:e.connected_at,disconnectedAt:e.disconnected_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,isAudioOn:e.is_audio_on,isVideoOn:e.is_video_on,liveEventId:e.live_event_id}}function jc(e){return{id:e.rtcstream_id}}function Hc(e){return{participantId:e.participant_id,userId:e.user.user_id,nickname:e.user.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,liveEventId:e.live_event_id}}var qr=Vn,Gc=r.filter;qr({target:"Array",proto:!0,forced:!pc("filter")},{filter:function(e){return Gc(this,e,1<arguments.length?arguments[1]:void 0)}});function Vc(e){if(9007199254740991<e)throw Wc("Maximum allowed index exceeded");return e}function Bc(e,t,n){(t=Yc(t))in e?Xc.f(e,t,Jc(0,n)):e[t]=n}function Kc(){var e=al(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}var Qc=pe,zc=Rn,Wc=(Vn({target:"Object",stat:!0,forced:ue(function(){zc(1)})},{keys:function(e){return zc(Qc(e))}}),TypeError),Yc=Ce,Xc=ft,Jc=jn,Y=Vn,go=ue,Zc=pr,$c=ge,el=pe,tl=Oe,nl=Vc,rl=Bc,il=dc,Ea=pc,ha=ot,sl=me("isConcatSpreadable"),n=51<=ha||!go(function(){var e=[];return e[sl]=!1,e.concat()[0]!==e}),xi=Ea("concat"),al=(Y({target:"Array",proto:!0,arity:1,forced:!n||!xi},{concat:function(e){for(var t,n,r,i=el(this),s=il(i,0),a=0,o=-1,u=arguments.length;o<u;o++)if(function(e){if(!$c(e))return!1;var t=e[sl];return void 0!==t?!!t:Zc(e)}(r=-1===o?i:arguments[o]))for(n=tl(r),nl(a+n),t=0;t<n;t++,a++)t in r&&rl(s,a,r[t]);else nl(a+1),rl(s,a++,r);return s.length=a,s}}),Ee),ol=At,ul=We,cl=Ot,ll=Kc,hl=RegExp.prototype,t=wt.PROPER,_a=Hn,dl=Ee,fl=Pu,er=ue,pl=function(e){var t=e.flags;return void 0!==t||"flags"in hl||ul(e,"flags")||!cl(hl,e)?t:ol(ll,e)},i="toString",vl=RegExp.prototype[i],qr=er(function(){return"/a/b"!=vl.call({source:"a",flags:"b"})}),ha=t&&vl.name!=i;function _l(t){return Object.keys(t).filter(function(e){return null!=t[e]}).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(function(e){if(Array.isArray(e))return e.map(function(e){return encodeURIComponent(e.toString())}).join(",");return encodeURIComponent(e.toString())}(t[e]))}).join("&")}(qr||ha)&&_a(RegExp.prototype,i,function(){var e=dl(this);return"/"+fl(e.source)+"/"+fl(pl(e))},{unsafe:!0});function yl(e,t){var n=[][e];return!!n&&bl(function(){n.call(null,t||function(){return 1},1)})}var ml,gl=function(){E(s,Lc);var i=I(s);function s(e,t,n){var r;return y(this,s),g(b(r=i.call(this)),"type",c.QUERY),r.params=r._normalizeParams(e),r.prevToken=t,r.nextToken=n,r}return m(s,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"/live-events?".concat(this._createQuery())}},{key:"getMethod",value:function(){return"GET"}},{key:"_normalizeParams",value:function(e){var t=e.hostType,n=e.liveEventState,r=e.createdAtRange,i=e.participantCountRange,s=e.durationRange,a=e.liveEventIds,o=e.createdByUserIds,e=e.limit;return{hostType:t,liveEventState:n,createdAtRange:r,participantCountRange:i,durationRange:s,liveEventIds:a,createdByUserIds:o,limit:null!=e?Math.min(Math.max(1,e),100):void 0}}},{key:"_createQuery",value:function(){var e;return _l({host_type:this.params.hostType,state:this.params.liveEventState,created_at_start_date:null==(e=this.params.createdAtRange)?void 0:e[0],created_at_end_date:null==(e=this.params.createdAtRange)?void 0:e[0],participant_count_gte:null==(e=this.params.participantCountRange)?void 0:e[0],participant_count_lte:null==(e=this.params.participantCountRange)?void 0:e[1],duration_range_gte:null==(e=this.params.durationRange)?void 0:e[0],duration_range_lte:null==(e=this.params.durationRange)?void 0:e[1],live_event_ids:this.params.liveEventIds,created_by_user_ids:this.params.createdByUserIds,limit:this.params.limit,prev:this.prevToken,next:this.nextToken})}}]),s}(),El=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){var t;return{liveEvents:null==(t=e.live_events)?void 0:t.map(Fc),prev:e.prev,next:e.next}}}]),t}(),bl=ue,go=Vn,Ea=xe,Il=bn.indexOf,Y=yl,Tl=Ea([].indexOf),wl=!!Tl&&1/Tl([1],1,-0)<0,n=Y("indexOf"),Sl=(go({target:"Array",proto:!0,forced:wl||!n},{indexOf:function(e){var t=1<arguments.length?arguments[1]:void 0;return wl?Tl(this,e,t)||0:Il(this,e,t)}}),Ie),Cl=TypeError,xi=Vn,kl=pe,Nl=Ne,Al=ke,Ol=Oe,Rl=Vc,Dl=dc,Ml=Bc,xl=function(e,t){if(!delete e[t])throw Cl("Cannot delete property "+Sl(t)+" of "+Sl(e))},wt=pc("splice"),Ll=Math.max,Pl=Math.min;xi({target:"Array",proto:!0,forced:!wt},{splice:function(e,t){var n,r,i,s,a,o,u=kl(this),c=Ol(u),l=Nl(e,c),e=arguments.length;for(0===e?n=r=0:r=1===e?(n=0,c-l):(n=e-2,Pl(Ll(Al(t),0),c-l)),Rl(c+n-r),i=Dl(u,r),s=0;s<r;s++)(a=l+s)in u&&Ml(i,s,u[a]);if(n<(i.length=r)){for(s=l;s<c-r;s++)o=s+n,(a=s+r)in u?u[o]=u[a]:xl(u,o);for(s=c;c-r+n<s;s--)xl(u,s-1)}else if(r<n)for(s=c-r;l<s;s--)o=s+n-1,(a=s+r-1)in u?u[o]=u[a]:xl(u,o);for(s=0;s<n;s++)u[s+l]=arguments[s+2];return u.length=c-r+n,i}}),(er=ml=ml||{}).VERBOSE="VERBOSE",er.DEBUG="DEBUG",er.INFO="INFO",er.WARNING="WARNING",er.ERROR="ERROR",er.NONE="NONE";var T=new(function(){function e(){y(this,e),this._listeners=[]}return m(e,[{key:"verbose",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[ml.VERBOSE].concat(t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[ml.DEBUG].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[ml.INFO].concat(t))}},{key:"warning",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[ml.WARNING].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[ml.ERROR].concat(t))}},{key:"_log",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,s=Q(this._listeners);try{for(s.s();!(i=s.n()).done;){var a=i.value;a._permit.apply(a,[e].concat(n))}}catch(e){s.e(e)}finally{s.f()}}},{key:"addListener",value:function(e){this._listeners.push(e)}},{key:"removeListener",value:function(e){e=this._listeners.indexOf(e);-1!==e&&this._listeners.splice(e,1)}},{key:"removeAllListener",value:function(){this._listeners=[]}}]),e}()),Ul=function(){function r(e,t,n){y(this,r),this.isLoading=!1,this.params=e,this.sender=t,this.prevToken=null,this.nextToken=null,this.liveEventManager=n}var n,e,t;return m(r,[{key:"hasPrev",get:function(){return!!this.prevToken}},{key:"hasNext",get:function(){return!this.prevToken&&!this.nextToken||!!this.nextToken}},{key:"next",value:(t=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading)throw new Error("query is in progress");e.next=2;break;case 2:if(this.hasNext){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(null,this.nextToken));case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"prev",value:(e=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading)throw new Error("query is in progress");e.next=2;break;case 2:if(this.hasPrev){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(this.prevToken,null));case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_sendQueryCommand",value:(n=_(regeneratorRuntime.mark(function e(t,n){var r,i,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n)throw new Error("internal error while creating LiveEventListQueryCommand");e.next=2;break;case 2:return this.isLoading=!0,r=new gl(this.params,t,n),e.next=6,this.sender.send(r);case 6:return r=e.sent,i=r.payload,this.prevToken=i.prev,this.nextToken=i.next,this.isLoading=!1,e.prev=11,e.abrupt("return",Promise.all(i.liveEvents.map(function(e){return s.liveEventManager.deserializeLiveEvent(e)})));case 15:return e.prev=15,e.t0=e.catch(11),T.error(e.t0),e.abrupt("return",i.liveEvents);case 19:case"end":return e.stop()}},e,this,[[11,15]])})),function(e,t){return n.apply(this,arguments)})}]),r}(),t=Vn,Fl=r.find,qr=qn,ha="find",ql=!0,_a=(ha in[]&&Array(1)[ha](function(){ql=!1}),t({target:"Array",proto:!0,forced:ql},{find:function(e){return Fl(this,e,1<arguments.length?arguments[1]:void 0)}}),qr(ha),Vn),jl=r.findIndex,i=qn,Ea="findIndex",Hl=!0,Y=(Ea in[]&&Array(1)[Ea](function(){Hl=!1}),_a({target:"Array",proto:!0,forced:Hl},{findIndex:function(e){return jl(this,e,1<arguments.length?arguments[1]:void 0)}}),i(Ea),{exports:{}}),go={},Gl=Ne,Vl=Oe,Bl=Bc,Kl=Array,Ql=Math.max,zl=ce,Wl=he,Yl=Sr.f,Xl=function(e,t,n){for(var r=Vl(e),i=Gl(t,r),s=Gl(void 0===n?r:n,r),a=Kl(Ql(s-i,0)),o=0;i<s;i++,o++)Bl(a,o,e[i]);return a.length=o,a},Jl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];go.f=function(e){if(!Jl||"Window"!=zl(e))return Yl(Wl(e));try{return Yl(e)}catch(e){return Xl(Jl)}};function Zl(e){hh(e,yh,{value:{objectID:"O"+mh++,weakData:{}}})}function $l(e,t,n){return Ih&&Eh(t=t.constructor)&&t!==n&&bh(t=t.prototype)&&t!==n.prototype&&Ih(e,t),e}function eh(t){if(t&&t.forEach!==Mf)try{xf(t,"forEach",Mf)}catch(e){t.forEach=Mf}}var th,nh,n=ue(function(){var e;"function"==typeof ArrayBuffer&&(e=new ArrayBuffer(8),Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8}))}),xi=ue,rh=ge,ih=ce,sh=n,ah=Object.isExtensible,wt=xi(function(){ah(1)})||sh?function(e){return!!rh(e)&&((!sh||"ArrayBuffer"!=ih(e))&&(!ah||ah(e)))}:ah,er=!ue(function(){return Object.isExtensible(Object.preventExtensions({}))}),oh=Vn,uh=xe,t=In,ch=ge,lh=We,hh=ft.f,dh=Sr,fh=go,ph=wt,vh=er,_h=!1,yh=ve("meta"),mh=0,gh=Y.exports={enable:function(){gh.enable=function(){},_h=!0;var i=dh.f,s=uh([].splice),e={};e[yh]=1,i(e).length&&(dh.f=function(e){for(var t=i(e),n=0,r=t.length;n<r;n++)if(t[n]===yh){s(t,n,1);break}return t},oh({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:fh.f}))},fastKey:function(e,t){if(!ch(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!lh(e,yh)){if(!ph(e))return"F";if(!t)return"E";Zl(e)}return e[yh].objectID},getWeakData:function(e,t){if(!lh(e,yh)){if(!ph(e))return!0;if(!t)return!1;Zl(e)}return e[yh].weakData},onFreeze:function(e){return vh&&_h&&ph(e)&&!lh(e,yh)&&Zl(e),e}},Eh=(t[yh]=!0,_e),bh=ge,Ih=Ri,Th=Vn,wh=Me,Sh=xe,Ch=Tn,kh=Hn,Nh=Y.exports,Ah=Ko,Oh=Ns,Rh=_e,Dh=ge,Mh=ue,xh=wu,Lh=Li,Ph=$l,Uh=Hn,Fh=ft.f,qh=at,jh=function(e,t,n){for(var r in t)Uh(e,r,t[r],n);return e},Hh=Ds,Gh=Ns,Vh=Ko,Bh=Fi,Kh=ks,Qh=ut,zh=Y.exports.fastKey,Wh=fr.set,Yh=fr.getterFor,Xh=(function(e,t,n){function r(e){var n=Sh(f[e]);kh(f,e,"add"==e?function(e){return n(this,0===e?0:e),this}:"delete"==e?function(e){return!(l&&!Dh(e))&&n(this,0===e?0:e)}:"get"==e?function(e){return l&&!Dh(e)?void 0:n(this,0===e?0:e)}:"has"==e?function(e){return!(l&&!Dh(e))&&n(this,0===e?0:e)}:function(e,t){return n(this,0===e?0:e,t),this})}var i,s,a,o,u,c=-1!==e.indexOf("Map"),l=-1!==e.indexOf("Weak"),h=c?"set":"add",d=wh[e],f=d&&d.prototype,p=d,v={};return Ch(e,!Rh(d)||!(l||f.forEach&&!Mh(function(){(new d).entries().next()})))?(p=n.getConstructor(t,e,c,h),Nh.enable()):Ch(e,!0)&&(s=(i=new p)[h](l?{}:-0,1)!=i,a=Mh(function(){i.has(1)}),o=xh(function(e){new d(e)}),u=!l&&Mh(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),o||(((p=t(function(e,t){Oh(e,f);e=Ph(new d,e,p);return null!=t&&Ah(t,e[h],{that:e,AS_ENTRIES:c}),e})).prototype=f).constructor=p),(a||u)&&(r("delete"),r("has"),c&&r("get")),(u||s)&&r(h),l&&f.clear&&delete f.clear),v[e]=p,Th({global:!0,constructor:!0,forced:p!=d},v),Lh(p,e),l||n.setStrong(p,e,c),p}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,n,r,i){function s(e,t,n){var r,i=u(e),s=a(e,t);return s?s.value=n:(i.last=s={index:r=zh(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=s),t&&(t.next=s),Qh?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e}function a(e,t){var n,e=u(e),r=zh(t);if("F"!==r)return e.index[r];for(n=e.first;n;n=n.next)if(n.key==t)return n}var e=e(function(e,t){Gh(e,o),Wh(e,{type:n,index:qh(null),first:void 0,last:void 0,size:0}),Qh||(e.size=0),null!=t&&Vh(t,e[i],{that:e,AS_ENTRIES:r})}),o=e.prototype,u=Yh(n);return jh(o,{clear:function(){for(var e=u(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Qh?e.size=0:this.size=0},delete:function(e){var t,n,r=u(this),e=a(this,e);return e&&(t=e.next,n=e.previous,delete r.index[e.index],e.removed=!0,n&&(n.next=t),t&&(t.previous=n),r.first==e&&(r.first=t),r.last==e&&(r.last=n),Qh?r.size--:this.size--),!!e},forEach:function(e){for(var t,n=u(this),r=Hh(e,1<arguments.length?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),jh(o,r?{get:function(e){e=a(this,e);return e&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Qh&&Fh(o,"size",{get:function(){return u(this).size}}),e},setStrong:function(e,t,n){var r=t+" Iterator",i=Yh(t),s=Yh(r);Bh(e,t,function(e,t){Wh(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),Kh(t)}}),ut),qr=xe,Jh=At,ha=ue,Zh=Rn,$h=gr,ed=Ar,td=pe,nd=Le,rd=Object.assign,id=Object.defineProperty,sd=qr([].concat),_a=!rd||ha(function(){if(Xh&&1!==rd({b:1},rd(id({},"a",{enumerable:!0,get:function(){id(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=rd({},e)[n]||Zh(rd({},t)).join("")!=r})?function(e,t){for(var n=td(e),r=arguments.length,i=1,s=$h.f,a=ed.f;i<r;)for(var o,u=nd(arguments[i++]),c=s?sd(Zh(u),s(u)):Zh(u),l=c.length,h=0;h<l;)o=c[h++],Xh&&!Jh(a,u,o)||(n[o]=u[o]);return n}:rd,i=(Vn({target:"Object",stat:!0,arity:2,forced:Object.assign!==_a},{assign:_a}),Vn),ad=bn.includes,Ea=qn,od=(i({target:"Array",proto:!0,forced:ue(function(){return!Array(1).includes()})},{includes:function(e){return ad(this,e,1<arguments.length?arguments[1]:void 0)}}),Ea("includes"),ge),ud=ce,cd=me("match"),ld=function(e){var t;return od(e)&&(void 0!==(t=e[cd])?!!t:"RegExp"==ud(e))},hd=TypeError,dd=me("match"),n=Vn,fd=function(e){if(ld(e))throw hd("The method doesn't accept regular expressions");return e},pd=le,vd=Pu,xi=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[dd]=!1,"/./"[t](n)}catch(e){}}return!1},_d=xe("".indexOf),yd=(n({target:"String",proto:!0,forced:!xi("includes")},{includes:function(e){return!!~_d(vd(pd(this)),vd(fd(e)),1<arguments.length?arguments[1]:void 0)}}),D.LiveEventRole=void 0,(In=D.LiveEventRole||(D.LiveEventRole={})).HOST="host",In.PARTICIPANT="participant",D.LiveEventState=void 0,(go=D.LiveEventState||(D.LiveEventState={})).CREATED="created",go.READY="ready",go.ONGOING="ongoing",go.PAUSED="paused",go.ENDED="ended",D.HostState=void 0,(wt=D.HostState||(D.HostState={})).ENTERED="entered",wt.CONNECTED="connected",wt.DISCONNECTED="disconnected",wt.EXITED="exited",D.ParticipantState=void 0,(er=D.ParticipantState||(D.ParticipantState={})).ENTERED="entered",er.EXITED="exited",function(){E(s,xc);var i=I(s);function s(e,t,n){var r;return y(this,s),(r=i.call(this)).appId=e,r.userId=t,r.accessToken=n,r}return m(s,[{key:"getAuth",value:function(){return!1}},{key:"getData",value:function(){return{app_id:this.appId,user_id:this.userId,access_token:this.accessToken}}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/login")}},{key:"getMethod",value:function(){return"POST"}}]),s}()),md=((t=th=th||{}).POST="POST",t.GET="GET",t.DELETE="DELETE",t.OPTION="OPTION",t.PUT="PUT",function(){E(u,Lc);var o=I(u);function u(e,t,n,r,i,s){var a;return y(this,u),g(b(a=o.call(this)),"type",c.CREATE),a.hostType=e,a.hostIds=Array.isArray(t)?t:[t],a.title=null===n?"":n,a.coverUrl=null===r?"":r,a.coverFile=null===i?"":i,a.customItems=s,a}return m(u,[{key:"getData",value:function(){function e(e,t,n,r){void 0!==n&&i.set(t,n)}var i=new FormData;return e(0,"host_type",this.hostType),e(0,"user_ids_for_host",String(this.hostIds)),e(0,"title",this.title),e(0,"cover_url",this.coverUrl),e(0,"cover_file",this.coverFile),e(0,"customItems",JSON.stringify(this.customItems)),i}},{key:"getSubPath",value:function(){return"/live-events"}},{key:"getMethod",value:function(){return th.POST}}]),u}()),gd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEvent:Fc(e.live_event)}}}]),t}(),Ed=function(){E(r,Lc);var n=I(r);function r(e){var t;return y(this,r),g(b(t=n.call(this)),"type",c.GET),t.liveEventId=e,t}return m(r,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return th.GET}}]),r}(),bd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEvent:Fc(e.live_event)}}}]),t}(),Id=function(){E(i,Lc);var r=I(i);function i(e,t){var n;return y(this,i),g(b(n=r.call(this)),"type",c.ENTER_HOST),g(b(n),"mediaOption",{turnAudioOn:!0,turnVideoOn:!0}),n.liveEventId=e,n.mediaOption=t,n}return m(i,[{key:"getData",value:function(){return{is_audio_on:this.mediaOption.turnAudioOn,is_video_on:this.mediaOption.turnVideoOn}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts")}},{key:"getMethod",value:function(){return th.POST}}]),i}(),Td=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{host:qc(e.host)}}}]),t}(),wd=function(){E(r,Lc);var n=I(r);function r(e){var t;return y(this,r),g(b(t=n.call(this)),"type",c.READY),t.liveEventId=e,t}return m(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/ready")}},{key:"getMethod",value:function(){return th.POST}}]),r}(),Sd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEvent:Fc(e.live_event)}}}]),t}(),Cd=function(){E(r,Lc);var n=I(r);function r(e){var t;return y(this,r),g(b(t=n.call(this)),"type",c.START),t.liveEventId=e,t}return m(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/start")}},{key:"getMethod",value:function(){return th.POST}}]),r}(),kd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEvent:Fc(e.live_event)}}}]),t}(),Nd=function(){E(i,Lc);var r=I(i);function i(e,t){var n;return y(this,i),g(b(n=r.call(this)),"type",c.EXIT_HOST),n.liveEventId=e,n.hostId=t,n}return m(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId)}},{key:"getMethod",value:function(){return th.DELETE}}]),i}(),Ad=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{host:qc(e.host)}}}]),t}(),Od=function(){E(r,Lc);var n=I(r);function r(e){var t;return y(this,r),g(b(t=n.call(this)),"type",c.DELETE),t.liveEventId=e,t}return m(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return th.DELETE}}]),r}(),Rd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEvent:Fc(e.live_event)}}}]),t}(),Dd=function(){E(r,Lc);var n=I(r);function r(e){var t;return y(this,r),g(b(t=n.call(this)),"type",c.ENTER),t.liveEventId=e,t}return m(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants")}},{key:"getMethod",value:function(){return th.POST}}]),r}(),Md=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{participant:Hc(e.participant)}}}]),t}(),xd=function(){E(i,Lc);var r=I(i);function i(e,t){var n;return y(this,i),g(b(n=r.call(this)),"type",c.EXIT),n.liveEventId=e,n.participantId=t,n}return m(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId)}},{key:"getMethod",value:function(){return th.DELETE}}]),i}(),Ld=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{participant:Hc(e.participant)}}}]),t}(),Pd=function(){E(s,Lc);var i=I(s);function s(e,t,n){var r;return y(this,s),g(b(r=i.call(this)),"type",c.CONNECTED),r.liveEventId=e,r.participantId=t,r.endpointId=n,r}return m(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId,"/connected")}},{key:"getMethod",value:function(){return th.POST}}]),s}(),Ud=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{endpoint:jc(e.rtcstream)}}}]),t}(),Fd=function(){E(s,Lc);var i=I(s);function s(e,t,n){var r;return y(this,s),g(b(r=i.call(this)),"type",c.HOST_CONNECTED),r.liveEventId=e,r.hostId=t,r.endpointId=n,r}return m(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams/").concat(this.endpointId,"/connected")}},{key:"getMethod",value:function(){return th.POST}}]),s}(),qd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{endpoint:jc(e.rtcstream)}}}]),t}(),jd=function(){E(s,Lc);var i=I(s);function s(e,t,n){var r;return y(this,s),g(b(r=i.call(this)),"type",c.DELETE_STREAM),r.liveEventId=e,r.participantId=t,r.endpointId=n,r}return m(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId)}},{key:"getMethod",value:function(){return th.DELETE}}]),s}(),Hd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Gd=function(){E(s,Lc);var i=I(s);function s(e,t,n){var r;return y(this,s),g(b(r=i.call(this)),"type",c.HOST_DELETE_STREAM),r.liveEventId=e,r.hostId=t,r.endpointId=n,r}return m(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams/").concat(this.endpointId)}},{key:"getMethod",value:function(){return th.DELETE}}]),s}(),Vd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Bd=function(){E(a,Lc);var s=I(a);function a(e,t,n,r){var i;return y(this,a),g(b(i=s.call(this)),"type",c.ATTACH),i.liveEventId=e,i.participantId=t,i.endpointId=n,i.attachTo=r,i}return m(a,[{key:"getData",value:function(){return{attach_to:this.attachTo}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId,"/attach")}},{key:"getMethod",value:function(){return th.POST}}]),a}(),Kd=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{endpoint:jc(e.rtcstream)}}}]),t}(),Qd=function(){E(r,Mc);var n=I(r);function r(e){var t;return y(this,r),(t=n.call(this)).type=e.type,t.version=e.version,t.messageId=e.message_id,t.payload=t.parseData(e.payload),t}return m(r)}(),zd=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:Fc(e.live_event)}}}]),t}(),Wd=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:Fc(e.live_event)}}}]),t}(),Yd=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:Fc(e.live_event)}}}]),t}(),Xd=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:qc(e.host)}}}]),t}(),Jd=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:qc(e.host)}}}]),t}(),Zd=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:qc(e.host)}}}]),t}(),$d=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:qc(e.host)}}}]),t}(),ef=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:qc(e.host)}}}]),t}(),tf=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,participant:Hc(e.participant),participantCount:e.participant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}]),t}(),nf=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,participant:Hc(e.participant),participantCount:e.participant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}]),t}(),rf=function(){E(o,Lc);var a=I(o);function o(e,t,n,r,i){var s;return y(this,o),g(b(s=a.call(this)),"type",c.CREATE_STREAM),s.liveEventId=e,s.participantId=t,s.sdp=n,s.audioAttr=r,s.videoAttr=i,s}return m(o,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams")}},{key:"getMethod",value:function(){return th.POST}}]),o}(),sf=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{sdp:e.sdp,endpoint:jc(e.rtcstream)}}}]),t}(),af=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{hosts:e.hosts.map(qc)}}}]),t}(),of=function(){E(i,Lc);var r=I(i);function i(e,t){var n;return y(this,i),g(b(n=r.call(this)),"type",c.HOST_ALIVE),n.liveEventId=e,n.hostId=t,n}return m(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/alive")}},{key:"getMethod",value:function(){return th.POST}}]),i}(),uf=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{}}}]),t}(),cf=function(){E(o,Lc);var a=I(o);function o(e,t,n,r,i){var s;return y(this,o),g(b(s=a.call(this)),"type",c.HOST_CREATE_STREAM),s.liveEventId=e,s.hostId=t,s.sdp=n,s.audioAttr=r,s.videoAttr=i,s}return m(o,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams")}},{key:"getMethod",value:function(){return th.POST}}]),o}(),lf=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{sdp:e.sdp,endpoint:jc(e.rtcstream)}}}]),t}(),hf=function(){E(i,Lc);var r=I(i);function i(e,t){var n;return y(this,i),g(b(n=r.call(this)),"type",c.ALIVE),n.liveEventId=e,n.participantId=t,n}return m(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/alive")}},{key:"getMethod",value:function(){return th.POST}}]),i}(),df=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{}}}]),t}(),ff=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{participant:Hc(e.participant)}}}]),t}(),pf=function(){E(s,Lc);var i=I(s);function s(e,t,n){var r;return y(this,s),g(b(r=i.call(this)),"type",c.AUDIO),r.liveEventId=e,r.hostId=t,r.on=n,r}return m(s,[{key:"getData",value:function(){return{on:this.on}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/audio")}},{key:"getMethod",value:function(){return th.POST}}]),s}(),vf=function(){E(s,Lc);var i=I(s);function s(e,t,n){var r;return y(this,s),g(b(r=i.call(this)),"type",c.VIDEO),r.liveEventId=e,r.hostId=t,r.on=n,r}return m(s,[{key:"getData",value:function(){return{on:this.on}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/video")}},{key:"getMethod",value:function(){return th.POST}}]),s}(),_f=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:qc(e.host)}}}]),t}(),yf=function(){E(o,Lc);var a=I(o);function o(e,t,n,r,i){var s;return y(this,o),g(b(s=a.call(this)),"type",c.UPDATE),s.liveEventId=e,s.hostIds=null===t?"":Array.isArray(t)?t:[t],s.title=null===n?"":n,s.coverUrl=null===r?"":r,s.coverFile=null===i?"":i,s}return m(o,[{key:"getData",value:function(){function e(e,t,n,r){void 0!==n&&i.set(t,n)}var i=new FormData;return e(0,"user_ids_for_host",String(this.hostIds)),e(0,"title",this.title),e(0,"cover_url",this.coverUrl),e(0,"cover_file",this.coverFile),i}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return th.PUT}}]),o}(),mf=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEvent:Fc(e.live_event)}}}]),t}(),gf=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:Fc(e.live_event)}}}]),t}(),Ef=function(){E(r,Lc);var n=I(r);function r(e){var t;return y(this,r),g(b(t=n.call(this)),"type",c.CUSTOM_ITEMS_GET),t.liveEventId=e,t}return m(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return th.GET}}]),r}(),bf=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{customItems:e.custom_items}}}]),t}(),If=function(){E(i,Lc);var r=I(i);function i(e,t){var n;return y(this,i),g(b(n=r.call(this)),"type",c.CUSTOM_ITEMS_UPDATE),n.liveEventId=e,n.customItems=t,n}return m(i,[{key:"getData",value:function(){return this.customItems}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return th.PUT}}]),i}(),Tf=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{customItems:e.custom_items,updatedKeys:e.updated_keys,updatedAt:e.updated_at}}}]),t}(),wf=function(){E(i,Lc);var r=I(i);function i(e,t){var n;return y(this,i),g(b(n=r.call(this)),"type",c.CUSTOM_ITEMS_DELETE),n.liveEventId=e,n.keys=t,n}return m(i,[{key:"getData",value:function(){return this.keys}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return th.DELETE}}]),i}(),Sf=function(){E(t,Uc);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{customItems:e.custom_items,deletedKeys:e.deleted_keys,deletedAt:e.deleted_at}}}]),t}(),Cf=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,updatedAt:e.updated_at,customItems:e.custom_items,updatedKeys:e.updated_keys}}}]),t}(),kf=function(){E(t,Qd);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,deletedAt:e.deleted_at,customItems:e.custom_items,deletedKeys:e.deleted_keys}}}]),t}(),Nf=function(){E(r,Lc);var n=I(r);function r(e){var t;return y(this,r),g(b(t=n.call(this)),"type",c.CUSTOM_ITEMS_DELETE),t.liveEventId=e,t}return m(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return th.DELETE}}]),r}(),Af=function(){function e(){y(this,e)}return m(e,null,[{key:"createAuth",value:function(e,t,n){return new yd(e,t,n)}},{key:"createLiveEvent",value:function(e,t,n,r,i,s){return new md(e,t,n,r,i,s)}},{key:"updateLiveEvent",value:function(e,t,n,r,i){return new yf(e,t,n,r,i)}},{key:"createGetLiveEvent",value:function(e){return new Ed(e)}},{key:"createEnterHost",value:function(e,t){return new Id(e,t)}},{key:"createReady",value:function(e){return new wd(e)}},{key:"createStart",value:function(e){return new Cd(e)}},{key:"createExitHost",value:function(e,t){return new Nd(e,t)}},{key:"createEndLiveEvent",value:function(e){return new Od(e)}},{key:"createEnter",value:function(e){return new Dd(e)}},{key:"createExit",value:function(e,t){return new xd(e,t)}},{key:"createConnected",value:function(e,t,n){return new Pd(e,t,n)}},{key:"createHostConnected",value:function(e,t,n){return new Fd(e,t,n)}},{key:"createStream",value:function(e,t,n,r,i){return new rf(e,t,n,r,i)}},{key:"createHostCreateStream",value:function(e,t,n,r,i){return new cf(e,t,n,r,i)}},{key:"createDeleteStream",value:function(e,t,n){return new jd(e,t,n)}},{key:"createHostDeleteStream",value:function(e,t,n){return new Gd(e,t,n)}},{key:"createAttach",value:function(e,t,n,r){return new Bd(e,t,n,r)}},{key:"createAudio",value:function(e,t,n){return new pf(e,t,n)}},{key:"createVideo",value:function(e,t,n){return new vf(e,t,n)}},{key:"createAlive",value:function(e,t){return new hf(e,t)}},{key:"createHostAlive",value:function(e,t){return new of(e,t)}},{key:"createGetCustomItems",value:function(e){return new Ef(e)}},{key:"createUpdateCustomItems",value:function(e,t){return new If(e,t)}},{key:"createDeleteCustomItems",value:function(e,t){return new wf(e,t)}},{key:"createDeleteAllCustomItems",value:function(e){return new Nf(e)}},{key:"parseResponse",value:function(e,t){try{switch(e.type){case c.CREATE:return new gd(t);case c.GET:return new bd(t);case c.DELETE:return new Rd(t);case c.QUERY:return new El(t);case c.READY:return new Sd(t);case c.START:return new kd(t);case c.ENTER_HOST:return new Td(t);case c.GET_HOSTS:return new af(t);case c.EXIT_HOST:return new Ad(t);case c.HOST_ALIVE:return new uf(t);case c.AUDIO:return new $d(t);case c.VIDEO:return new ef(t);case c.HOST_CREATE_STREAM:return new lf(t);case c.HOST_DELETE_STREAM:return new Vd(t);case c.HOST_CONNECTED:return new qd(t);case c.ENTER:return new Md(t);case c.EXIT:return new Ld(t);case c.ALIVE:return new df(t);case c.GET_PARTICIPANTS:return new ff(t);case c.CREATE_STREAM:return new sf(t);case c.DELETE_STREAM:return new Hd(t);case c.CONNECTED:return new Ud(t);case c.ATTACH:return new Kd(t);case c.UPDATE:return new mf(t);case c.CUSTOM_ITEMS_GET:return new bf(t);case c.CUSTOM_ITEMS_UPDATE:return new Tf(t);case c.CUSTOM_ITEMS_DELETE:return new Sf(t)}}catch(e){return}}},{key:"parse",value:function(e){if("live"===e.call_type)try{switch(e.type){case c.LIVE_EVENT_READY:return new zd(e);case c.LIVE_EVENT_STARTED:return new Wd(e);case c.LIVE_EVENT_ENDED:return new Yd(e);case c.LIVE_EVENT_UPDATED:return new gf(e);case c.HOST_ENTERED:return new Xd(e);case c.HOST_EXITED:return new Jd(e);case c.HOST_CONNECTED:return new Zd(e);case c.HOST_DISCONNECTED:return new _f(e);case c.HOST_AUDIO_STATUS_CHANGED:return new $d(e);case c.HOST_VIDEO_STATUS_CHANGED:return new ef(e);case c.PARTICIPANT_ENTERED:return new tf(e);case c.PARTICIPANT_EXITED:return new nf(e);case c.CUSTOM_ITEMS_UPDATE:return new Cf(e);case c.CUSTOM_ITEMS_DELETE:return new kf(e)}}catch(e){return}}}]),e}(),Of=r.forEach,Rf=Me,Df=ht,Ri=yo,Mf=yl("forEach")?[].forEach:function(e){return Of(this,e,1<arguments.length?arguments[1]:void 0)},xf=mr;for(nh in Df)Df[nh]&&eh(Rf[nh]&&Rf[nh].prototype);eh(Ri);function Lf(n,e,t,r){var a,i=mp(n),o=!yp(function(){var e={};return e[i]=function(){return 7},7!=""[n](e)}),s=o&&!yp(function(){var e=!1,t=/a/;return"split"===n&&((t={constructor:{}}).constructor[Ep]=function(){return t},t.flags="",t[i]=/./[i]),t.exec=function(){return e=!0,null},t[i](""),!e});o&&s&&!t||(a=pp(/./[i]),s=e(i,""[n],function(e,t,n,r,i){var e=pp(e),s=t.exec;return s===_p||s===bp.exec?o&&!i?{done:!0,value:a(t,n,r)}:{done:!0,value:e(n,t,r)}:{done:!1}}),vp(String.prototype,n,s[0]),vp(bp,i,s[1])),r&&gp(bp[i],"sham",!0)}function Pf(e,t,n){return t+(n?Ip(e,t).length:1)}function Uf(e,t){var n=e.exec;if(Dp(n))return null!==(n=Op(n,e,t))&&Rp(n),n;if("RegExp"===Mp(e))return Op(xp,e,t);throw Lp("RegExp#exec called on incompatible receiver")}var Y=Vn,Ff=pr,qf=Cr,jf=ge,Hf=Ne,Gf=Oe,Vf=he,Bf=Bc,Rn=me,Kf=Di,gr=pc("slice"),Qf=Rn("species"),zf=Array,Wf=Math.max,Yf=(Y({target:"Array",proto:!0,forced:!gr},{slice:function(e,t){var n,r,i,s=Vf(this),a=Gf(s),o=Hf(e,a),u=Hf(void 0===t?a:t,a);if(Ff(s)&&(n=s.constructor,(n=qf(n)&&(n===zf||Ff(n.prototype))||jf(n)&&null===(n=n[Qf])?void 0:n)===zf||void 0===n))return Kf(s,o,u);for(r=new(void 0===n?zf:n)(Wf(u-o,0)),i=0;o<u;o++,i++)o in s&&Bf(r,i,s[o]);return r.length=i,r}}),function(){function e(){y(this,e),g(this,"_listeners",{}),g(this,"on",this.addEventListener),g(this,"off",this.removeEventListener)}return m(e,[{key:"addEventListener",value:function(e,t){var n=this;return e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t),function(){return n.removeEventListener(e,t)}}},{key:"once",value:function(t,n){var r=this;return this.on(t,function e(){n.apply(void 0,arguments),r.removeEventListener(t,e)})}},{key:"removeEventListener",value:function(e,t){if(e in this._listeners)for(var n=this._listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"removeAllEventListeners",value:function(){this._listeners={}}},{key:"_dispatchEvent",value:function(e){if(e in this._listeners){for(var t=this._listeners[e].slice(),n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var s,a=0,o=t.length;a<o;a++)(s=t[a]).call.apply(s,[this].concat(r))}}}]),e}()),Ar=ue,Xf=Me.RegExp,qr=Ar(function(){var e=Xf("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),ha=qr||Ar(function(){return!Xf("a","y").sticky}),_a={BROKEN_CARET:qr||Ar(function(){var e=Xf("^r","gy");return e.lastIndex=2,null!=e.exec("str")}),MISSED_STICKY:ha,UNSUPPORTED_Y:qr},bn=ue,Jf=Me.RegExp,i=bn(function(){var e=Jf(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}),Ea=ue,Zf=Me.RegExp,n=Ea(function(){var e=Zf("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}),$f=At,xi=xe,ep=Pu,tp=Kc,In=_a,go=W.exports,np=at,rp=fr.get,wt=i,er=n,ip=go("native-string-replace",String.prototype.replace),sp=RegExp.prototype.exec,ap=sp,op=xi("".charAt),up=xi("".indexOf),cp=xi("".replace),lp=xi("".slice),hp=(t=/b*/g,$f(sp,r=/a/,"a"),$f(sp,t,"a"),0!==r.lastIndex||0!==t.lastIndex),dp=In.BROKEN_CARET,fp=void 0!==/()??/.exec("")[1],ht=ap=hp||fp||dp||wt||er?function(e){var t,n,r,i,s,a,o=this,u=rp(o),e=ep(e),c=u.raw;if(c)return c.lastIndex=o.lastIndex,h=$f(ap,c,e),o.lastIndex=c.lastIndex,h;var l=u.groups,c=dp&&o.sticky,h=$f(tp,o),u=o.source,d=0,f=e;if(c&&(h=cp(h,"y",""),-1===up(h,"g")&&(h+="g"),f=lp(e,o.lastIndex),0<o.lastIndex&&(!o.multiline||o.multiline&&"\n"!==op(e,o.lastIndex-1))&&(u="(?: "+u+")",f=" "+f,d++),t=new RegExp("^(?:"+u+")",h)),fp&&(t=new RegExp("^"+u+"$(?!\\s)",h)),hp&&(n=o.lastIndex),r=$f(sp,c?t:o,f),c?r?(r.input=lp(r.input,d),r[0]=lp(r[0],d),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:hp&&r&&(o.lastIndex=o.global?r.index+r[0].length:n),fp&&r&&1<r.length&&$f(ip,r[0],t,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r&&l)for(r.groups=s=np(null),i=0;i<l.length;i++)s[(a=l[i])[0]]=r[a[1]];return r}:ap,pp=(Vn({target:"RegExp",proto:!0,forced:/./.exec!==ht},{exec:ht}),xe),vp=Hn,_p=ht,yp=ue,mp=me,gp=mr,Ep=mp("species"),bp=RegExp.prototype,Ip=Qa.charAt,yo=xe,Tp=pe,wp=Math.floor,Sp=yo("".charAt),Cp=yo("".replace),kp=yo("".slice),Np=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Ap=/\$([$&'`]|\d{1,2})/g,Op=At,Rp=Ee,Dp=_e,Mp=ce,xp=ht,Lp=TypeError,Pp=Oi,Up=At,Ri=xe,pr=Lf,Cr=ue,Fp=Ee,qp=_e,jp=ke,Hp=Ae,Gp=Pu,Vp=le,Bp=Pf,Kp=we,Qp=function(s,a,o,u,c,e){var l=o+s.length,h=u.length,t=Ap;return void 0!==c&&(c=Tp(c),t=Np),Cp(e,t,function(e,t){var n;switch(Sp(t,0)){case"$":return"$";case"&":return s;case"`":return kp(a,0,o);case"'":return kp(a,l);case"<":n=c[kp(t,1,-1)];break;default:var r,i=+t;if(0==i)return e;if(h<i)return 0!==(r=wp(i/10))&&r<=h?void 0===u[r-1]?Sp(t,1):u[r-1]+Sp(t,1):e;n=u[i-1]}return void 0===n?"":n})},zp=Uf,Wp=me("replace"),Yp=Math.max,Xp=Math.min,Jp=Ri([].concat),Zp=Ri([].push),$p=Ri("".indexOf),ev=Ri("".slice),Di="$0"==="a".replace(/./,"$0"),tv=!!/./[Wp]&&""===/./[Wp]("a","$0");pr("replace",function(e,g,E){var b=tv?"$":"$0";return[function(e,t){var n=Vp(this),r=null==e?void 0:Kp(e,Wp);return r?Up(r,e,n,t):Up(g,Gp(n),e,t)},function(e,t){var n=Fp(this),r=Gp(e);if("string"==typeof t&&-1===$p(t,b)&&-1===$p(t,"$<")){e=E(g,n,r,t);if(e.done)return e.value}for(var i,s=qp(t),a=(s||(t=Gp(t)),n.global),o=(a&&(i=n.unicode,n.lastIndex=0),[]);null!==(d=zp(n,r))&&(Zp(o,d),a);)""===Gp(d[0])&&(n.lastIndex=Bp(r,Hp(n.lastIndex),i));for(var u,c="",l=0,h=0;h<o.length;h++){for(var d,f=Gp((d=o[h])[0]),p=Yp(Xp(jp(d.index),r.length),0),v=[],_=1;_<d.length;_++)Zp(v,void 0===(u=d[_])?u:String(u));var y=d.groups,m=s?(m=Jp([f],v,p,r),void 0!==y&&Zp(m,y),Gp(Pp(t,void 0,m))):Qp(f,r,p,v,y,t);l<=p&&(c+=ev(r,l,p)+m,l=p+f.length)}return c+ev(r,l)}]},!!Cr(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!Di||tv);function nv(t){return function(e){e=iv(rv(e));return 1&t&&(e=sv(e,av,"")),e=2&t?sv(e,ov,""):e}}var Rn=xe(1..valueOf),Y="\t\n\v\f\r                　\u2028\u2029\ufeff",rv=le,iv=Pu,sv=xe("".replace),gr="[\t\n\v\f\r                　\u2028\u2029\ufeff]",av=RegExp("^"+gr+gr+"*"),ov=RegExp(gr+gr+"*$"),Ar={start:nv(1),end:nv(2),trim:nv(3)},ha=ut,qr=Me,bn=xe,Ea=Tn,_a=Hn,uv=We,cv=$l,lv=Ot,hv=lt,dv=Se,fv=ue,W=Sr.f,pv=e.f,vv=ft.f,_v=Rn,yv=Ar.trim,at="Number",mv=qr[at],gv=mv.prototype,Ev=qr.TypeError,bv=bn("".slice),Iv=bn("".charCodeAt),Tv=function(e){var t,n,r,i,s,a,o,u=dv(e,"number");if(hv(u))throw Ev("Cannot convert a Symbol value to a number");if("string"==typeof u&&2<u.length)if(u=yv(u),43===(e=Iv(u,0))||45===e){if(88===(t=Iv(u,2))||120===t)return NaN}else if(48===e){switch(Iv(u,1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+u}for(s=(i=bv(u,2)).length,a=0;a<s;a++)if((o=Iv(i,a))<48||r<o)return NaN;return parseInt(i,n)}return+u};if(Ea(at,!mv(" 0o1")||!mv("0b1")||mv("+0x1"))){for(var wv,Sv=function(e){var e=arguments.length<1?0:mv(function(e){e=dv(e,"number");return"bigint"==typeof e?e:Tv(e)}(e)),t=this;return lv(gv,t)&&fv(function(){_v(t)})?cv(Object(e),t,Sv):e},Cv=ha?W(mv):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),kv=0;Cv.length>kv;kv++)uv(mv,wv=Cv[kv])&&!uv(Sv,wv)&&vv(Sv,wv,pv(mv,wv));_a(qr,at,(Sv.prototype=gv).constructor=Sv,{constructor:!0})}function Nv(n){Object.keys(n).forEach(function(e){var t;(void 0===(t=n[e])||Number.isNaN(t)||""===t||Array.isArray(t)&&0===t.length)&&delete n[e]})}var Av,Ov,Rv,Dv,Mv,xv=function(){var t=_(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getCandidateInfo()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:n=e.sent,i=n.entries(),s=0;case 7:if(!(s<n.size)){e.next=18;break}if(a=i.next(),a=a.value){e.next=11;break}return e.abrupt("continue",15);case 11:if("candidate-pair"===(o=a[1]).type&&"succeeded"===o.state)return r=o.localCandidateId,e.abrupt("break",18);e.next=15;break;case 15:s++,e.next=7;break;case 18:if(!(s<n.size)){e.next=28;break}if(o=i.next(),u=o.value){e.next=22;break}return e.abrupt("continue",25);case 22:if("local-candidate"===(c=u[1]).type&&c.id===r)return e.abrupt("return",{connectionType:null!=(l=c.candidateType)?l:"",protocol:null!=(l=c.protocol)?l:"",relayProtocol:null!=(l=c.relayProtocol)?l:""});e.next=25;break;case 25:s++,e.next=18;break;case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),Lv=function(){var t=_(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={},i={},s={},a=new Map,o=new Map,t.forEach(function(e){"codec"===e.type&&a.set(e.id,e),"candidate-pair"===e.type&&"succeeded"===e.state&&(u=e.localCandidateId,n.webrtc_timestamp=e.time),"media-source"===e.type&&o.set(e.kind,e)}),t.forEach(function(e){var t;"local-candidate"===e.type&&e.id===u&&(r.network_type=e.networkType,r.protocol=e.protocol,r.candidate_type=e.candidateType),"audio"!==e.kind&&"audio"!==e.mediaType||("outbound-rtp"===e.type&&(i.codec=null==(t=a.get(e.codecId))?void 0:t.mimeType,i.total_packets_sent=e.packetsSent,i.retransmitted_packets_sent=e.retransmittedPacketsSent),"remote-inbound-rtp"===e.type&&(i.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,i.total_packets_received=e.packetsReceived,i.total_packets_lost_rate=t,i.total_packets_lost=e.packetsLost,i.jitter=1e3*e.jitter),"track"===e.type&&e.remoteSource&&(i.jitter_buffer_delay=e.jitterBufferDelay,i.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount)),"video"!==e.kind&&"video"!==e.mediaType||(s.video_source_width=null==(t=o.get("video"))?void 0:t.width,s.video_source_height=null==(t=o.get("video"))?void 0:t.height,s.video_source_frames_per_second=null==(t=o.get("video"))?void 0:t.framesPerSecond,"outbound-rtp"===e.type&&(s.codec=null==(t=a.get(e.codecId))?void 0:t.mimeType,s.fir_count=e.firCount,s.pli_count=e.pliCount,s.nack_count=e.nackCount,s.qp_sum=e.qpSum,s.retransmitted_packets_sent=e.retransmittedBytesSent,s.quality_limitation_reason=e.qualityLimitationReason,s.quality_limitation_resolution_changes=e.qualityLimitationResolutionChanges),"remote-inbound-rtp"===e.type&&(s.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(s.header_bytes_received=e.headerBytesReceived,s.key_frames_decoded=e.keyFramesDecoded,s.total_decode_time=e.totalDecodeTime,s.total_inter_frame_delay=e.totalInterFrameDelay,s.total_squared_inter_frame_delay=e.totalSquaredInterFrameDelay,t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,s.total_packets_lost=e.packetsLost,s.total_packets_received=e.packetsReceived,s.total_packets_lost_rate=t),"track"===e.type&&(e.remoteSource?(s.jitter_buffer_delay=e.jitterBufferDelay,s.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount,s.received_frame_width=e.frameWidth,s.received_frame_height=e.frameHeight,s.frames_received=e.framesReceived,s.frames_decoded=e.framesDecoded,s.frames_dropped=e.framesDropped,s.freeze_count=e.freezeCount,s.pause_count=e.pauseCount,s.total_freezes_duration=e.totalFreezesDuration,s.total_pauses_duration=e.totalPausesDuration,s.total_frames_duration=e.totalFramesDuration,s.sum_of_squared_frames_duration=e.sumOfSquaredFramesDuration):(s.sent_frame_width=e.frameWidth,s.sent_frame_height=e.frameHeight)))}),Nv(r),Nv(i),Nv(s),n.transport_info=r,n.audio=i,n.video=s,e.abrupt("return",n);case 15:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),Pv=function(){var t=_(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getStats()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:return n=e.sent,e.abrupt("return",Lv(n));case 6:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),Uv=function(){function t(e){y(this,t),this._context=e}return m(t,[{key:"state",get:function(){return this._state}},{key:"_changeState",value:function(e){this._state&&this._state.type===e.type||(this._state&&this._state.destroy(),this._state=e,this._state.context=this._context,this._state.start())}}]),t}(),Fv=function(){function t(e){y(this,t),this._stateMutator=e}return m(t,[{key:"context",set:function(e){this._context=e}},{key:"start",value:function(){this._onStart()}},{key:"destroy",value:function(){this._onDestroy()}}]),t}(),qv=function(){function n(e,t){y(this,n),this._context=e,this._stateMutator=t,this._context=e,this._stateMutator=t}return m(n,[{key:"state",get:function(){return this._stateMutator.state}}]),n}(),jv=function(){E(n,Fv);var t=I(n);function n(e){return y(this,n),t.call(this,e)}return m(n)}(),Hv=((fr=Av=Av||{}).IDLE="idle",fr.OFFERING="offering",fr.ANSWERING="answering",fr.CONNECTED="connected",fr.RECONNECTING="reconnecting",fr.ICE_RESTART_OFFERING="iceRestartOffering",fr.ICE_RESTART_ANSWERING="iceRestartAnswering",fr.CLOSED="closed",function(){E(r,jv);var t,n=I(r);function r(e,t){return y(this,r),g(b(e=n.call(this,e)),"type",Av.ANSWERING),e._offerCommand=t,e}return m(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("answering"),this._context.createRTCConnection(),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.prepareSessionDescription(),this._context.sendAnswer().catch(function(e){});case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}()),Gv=function(){E(s,jv);var i=I(s);function s(){var e;y(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(b(e=i.call.apply(i,[this].concat(n))),"type",Av.CLOSED),e}return m(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),s}(),Vv=function(){E(r,jv);var t,n=I(r);function r(e,t){return y(this,r),g(b(e=n.call(this,e)),"type",Av.CONNECTED),e._isReconnected=t,e}return m(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toReconnecting(t);case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceDisconnected",value:function(){this._stateMutator.toReconnecting()}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),Bv=function(){E(r,jv);var t,n=I(r);function r(e,t){return y(this,r),g(b(e=n.call(this,e)),"type",Av.ICE_RESTART_ANSWERING),e._offerCommand=t,e}return m(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartAnswering"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.sendAnswer().catch(function(e){});case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),Kv=function(){E(s,jv);var i=I(s);function s(){var e;y(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(b(e=i.call.apply(i,[this].concat(n))),"type",Av.ICE_RESTART_OFFERING),e}return m(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartOffering"),this._context.sendOffer(!0)}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),Qv=function(){E(s,jv);var t,i=I(s);function s(){var e;y(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(b(e=i.call.apply(i,[this].concat(n))),"type",Av.IDLE),e}return m(s,[{key:"_onStart",value:function(){}},{key:"_onDestroy",value:function(){}},{key:"createOffer",value:function(){this._stateMutator.toOffering()}},{key:"onOfferReceived",value:(t=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toAnswering(t);case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),zv=function(){E(s,jv);var i=I(s);function s(){var e;y(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(b(e=i.call.apply(i,[this].concat(n))),"type",Av.OFFERING),e}return m(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("offering"),this._context.createRTCConnection(),this._context.prepareSessionDescription()}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),Wv=function(){E(r,jv);var n=I(r);function r(e,t){return y(this,r),g(b(e=n.call(this,e)),"type",Av.RECONNECTING),e._offerCommand=t,e}return m(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("reconnecting"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:function(e){this._stateMutator.toIceRestartAnswering(e)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),Yv=function(){E(t,Uv);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}},{key:"toIdle",value:function(){this._changeState(new Qv(this))}},{key:"toOffering",value:function(){this._changeState(new zv(this))}},{key:"toAnswering",value:function(e){this._changeState(new Hv(this,e))}},{key:"toConnected",value:function(e){this._changeState(new Vv(this,e))}},{key:"toReconnecting",value:function(e){this._changeState(new Wv(this,e))}},{key:"toIceRestartOffering",value:function(){this._changeState(new Kv(this))}},{key:"toIceRestartAnswering",value:function(e){this._changeState(new Bv(this,e))}},{key:"toClosed",value:function(){this._changeState(new Gv(this))}}]),t}(),Xv=function(){E(n,qv);var t=I(n);function n(e){return y(this,n),(e=t.call(this,e,new Yv(e)))._stateMutator.toIdle(),e}return m(n,[{key:"state",get:function(){return this._stateMutator.state}},{key:"onOfferReceived",value:function(e){T.verbose("[".concat(this.state.type,"] onOfferReceived"));var t=this.state;switch(t.type){case Av.IDLE:case Av.ANSWERING:case Av.CONNECTED:case Av.RECONNECTING:case Av.ICE_RESTART_ANSWERING:t.onOfferReceived(e);break;default:T.error("[".concat(this.state.type,"] onOfferReceived"))}}},{key:"onAnswerReceived",value:function(e){T.verbose("[".concat(this.state.type,"] onAnswerReceived"));var t=this.state;switch(t.type){case Av.OFFERING:case Av.ICE_RESTART_OFFERING:t.onAnswerReceived(e);break;default:T.error("[".concat(this.state.type,"] onAnswerReceived"))}}},{key:"onClose",value:function(){T.verbose("[".concat(this.state.type,"] onClose"));var e=this.state;switch(e.type){case Av.IDLE:case Av.OFFERING:case Av.ANSWERING:case Av.CONNECTED:case Av.RECONNECTING:case Av.ICE_RESTART_OFFERING:case Av.ICE_RESTART_ANSWERING:e.onClose();break;default:T.error("[".concat(this.state.type,"] onClose"))}}},{key:"createOffer",value:function(){T.verbose("[".concat(this.state.type,"] createOffer"));var e=this.state;e.type===Av.IDLE?e.createOffer():T.error("[".concat(this.state.type,"] createOffer"))}},{key:"onIceConnected",value:function(){T.verbose("[".concat(this.state.type,"] onIceConnected"));var e=this.state;switch(e.type){case Av.OFFERING:case Av.ANSWERING:case Av.RECONNECTING:case Av.ICE_RESTART_OFFERING:case Av.ICE_RESTART_ANSWERING:e.onIceConnected();break;default:T.error("[".concat(this.state.type,"] onIceConnected"))}}},{key:"onIceDisconnected",value:function(){T.verbose("[".concat(this.state.type,"] onIceDisconnected"));var e=this.state;e.type===Av.CONNECTED?e.onIceDisconnected():T.error("[".concat(this.state.type,"] onIceDisconnected"))}},{key:"onIceFailed",value:function(){T.verbose("[".concat(this.state.type,"] onIceFailed"));var e=this.state;switch(e.type){case Av.CONNECTED:case Av.RECONNECTING:e.onIceFailed();break;default:T.error("[".concat(this.state.type,"] onIceFailed"))}}}]),n}(),Jv=((i=Ov=Ov||{}).RELAY="relay",i.ALL="all",function(){E(l,Yf);var e,t,n,r,c=I(l);function l(e,t,n,r,i,s,a,o){var u;return y(this,l),(u=c.call(this))._ctx=e,u.id=t,u._signalingClient=n,u._localStream=r,u._isInitiator=i,u._turnCredential=s,u._mediaDirections=a,u._isDisposable=o,u._stateMachine=new Xv({dispatchEvent:u._dispatchEvent.bind(b(u)),isInitiator:u._isInitiator,setRemoteDescription:u._setRemoteDescription.bind(b(u)),sendAnswer:u._sendAnswer.bind(b(u)),sendOffer:u._sendOffer.bind(b(u)),createRTCConnection:u._createRTCConnection.bind(b(u)),prepareSessionDescription:u._prepareSessionDescription.bind(b(u)),isDisposable:u._isDisposable}),r&&r.on("streamChanged",function(e){return u.onLocalStream(e)}),u}return m(l,[{key:"_state",get:function(){return this._stateMachine.state}},{key:"rtcConnection",get:function(){return this._rtcConnection}},{key:"remoteStream",get:function(){return this._remoteStream}},{key:"signalingClient",get:function(){return this._signalingClient}},{key:"onEvent",value:function(e){switch(e.type){case Rv.CANDIDATE:return void this._receiveCandidate(e);case Rv.OFFER:this._stateMachine.onOfferReceived(e);break;case Rv.ANSWER:this._stateMachine.onAnswerReceived(e);break;default:T.error(new Error("unhandled call event ".concat(e)))}}},{key:"createOffer",value:function(){this._stateMachine.createOffer()}},{key:"close",value:function(){this._closeRTCConnection(),this._stateMachine.onClose()}},{key:"onLocalStream",value:function(e){if(this._rtcConnection){var t,n=Q(e.getTracks());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._replaceTrack(r)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getCandidateInfo",value:(r=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xv(this.rtcConnection));case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getStatsLog",value:(n=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Pv(this.rtcConnection));case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"_replaceTrack",value:function(e){var t,n=Q(this._rtcConnection.getSenders());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.track&&r.track.kind===e.kind&&r.replaceTrack(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_createRTCConnection",value:function(){var e,r=this,t=(this._turnCredential&&(e={iceServers:[{username:this._turnCredential.username,credential:this._turnCredential.password,urls:this._turnCredential.turnUrls}],iceTransportPolicy:this._turnCredential.transportPolicy||Ov.ALL}),new RTCPeerConnection(e));t.onnegotiationneeded=function(){r._sendOffer(!1)},t.onicecandidate=function(e){var t,n;e.candidate&&null!=(t=(n=r._signalingClient).sendCandidate)&&t.call(n,e.candidate)},t.onconnectionstatechange=function(){return r._handleConnectionStateChange(t)},t.oniceconnectionstatechange=function(){return r._handleIceConnectionStateChange(t)},t.ontrack=function(e){return r._onRemoteTrack(e)},this._rtcConnection=t}},{key:"_closeRTCConnection",value:function(){this._rtcConnection&&(this._rtcConnection.onnegotiationneeded=null,this._rtcConnection.onicecandidate=null,this._rtcConnection.oniceconnectionstatechange=null,this._rtcConnection.onconnectionstatechange=null,this._rtcConnection.close(),this._rtcConnection=null,delete this._remoteStream)}},{key:"_prepareSessionDescription",value:function(){var e=this._mediaDirections,t=e.audio,e=e.video,n={sendrecv:[],sendonly:[],recvonly:[],none:[]};n[t].push("audio"),n[e].push("video"),n.sendrecv.length&&this._addTracks(n.sendrecv),n.sendonly.length&&this._addSendOnlyTransceivers(n.sendonly),n.recvonly.length&&this._addReceiveOnlyTransceivers(n.recvonly)}},{key:"_addTracks",value:function(t){var n=this,r=(T.debug("_addTracks()"),this._localStream.localStream);r.getTracks().forEach(function(e){t.includes(e.kind)&&n._rtcConnection.addTrack(e,r)})}},{key:"_addReceiveOnlyTransceivers",value:function(e){var t=this;e.forEach(function(e){t._rtcConnection.addTransceiver(e,{direction:"recvonly"})})}},{key:"_addSendOnlyTransceivers",value:function(e){var n=this,r=this._localStream.localStream;e.forEach(function(t){r.getTracks().forEach(function(e){e.kind===t&&n._rtcConnection.addTransceiver(e,{direction:"sendonly",streams:[r]})})})}},{key:"_setRemoteDescription",value:function(e,t){t=t.replace(/a=extmap:0 ulpfec\r\n/,""),e=new RTCSessionDescription({type:e,sdp:t});return this._rtcConnection.setRemoteDescription(e)}},{key:"_sendOffer",value:(t=_(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={iceRestart:t||!1},e.next=3,this._rtcConnection.createOffer(n);case 3:return n=e.sent,e.next=6,this._rtcConnection.setLocalDescription(n);case 6:return e.abrupt("return",this._signalingClient.sendOfferSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_sendAnswer",value:(e=_(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rtcConnection.createAnswer();case 2:return(t=e.sent).sdp=t.sdp.replace("actpass","active"),e.next=6,this._rtcConnection.setLocalDescription(t);case 6:return e.abrupt("return",this._signalingClient.sendAnswerSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_handleIceConnectionStateChange",value:function(e){switch(T.verbose("[".concat(this._state.type,"] iceConnectionState ").concat(e.iceConnectionState)),e.iceConnectionState){case"connected":this._stateMachine.onIceConnected();break;case"disconnected":this._stateMachine.onIceDisconnected();break;case"failed":this._dispatchEvent("iceFailed")}}},{key:"_handleConnectionStateChange",value:function(e){T.verbose("[".concat(this._state.type,"] connectionState ").concat(e.connectionState))}},{key:"_receiveCandidate",value:function(e){e=e.payload.candidate;this._rtcConnection.addIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.sdp}).catch(function(e){T.error(e)})}},{key:"_onRemoteTrack",value:function(e){this._remoteStream=e.streams[0],this._dispatchEvent("remoteStream",this._remoteStream)}}]),l}()),Zv=((n=Rv=Rv||{}).OFFER="offer",n.ANSWER="answer",n.CANDIDATE="candidate",m(function e(){var n=this;y(this,e),this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})})),$v=function(){var r=_(regeneratorRuntime.mark(function e(t,n,r){var i,s,a,o,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=3<l.length&&void 0!==l[3]?l[3]:{count:0,deferred:new Zv},i=a.deferred,s=a.count,e.prev=2,e.next=5,n();case 5:a=e.sent,0<s&&null!=(o=r.onRecover)&&o.call(r),i.resolve(a),e.next=19;break;case 10:if(e.prev=10,e.t0=e.catch(2),null!=(o=r.onError)&&o.call(r,e.t0),0<=(u=t.calcTimeout(s+1)))return null!=(c=r.onRetrial)&&c.call(r,s+1,e.t0),setTimeout(function(){$v(t,n,r,{count:s+1,deferred:i})},u),e.abrupt("return",i.promise);e.next=18;break;case 18:i.reject(e.t0);case 19:return e.abrupt("return",i.promise);case 20:case"end":return e.stop()}},e,null,[[2,10]])}));return function(e,t,n){return r.apply(this,arguments)}}(),e_=function(){function e(){y(this,e)}return m(e,[{key:"calcTimeout",value:function(e){switch(e){case 1:return 1e3;case 2:return 2e3;case 3:return 3e3;default:return-1}}}]),e}(),t_=function(){function r(e,t,n){y(this,r),this.interval=e,this.noise=t,this.maxRetrial=n}return m(r,[{key:"calcTimeout",value:function(e){return e>this.maxRetrial?-1:e*this.interval+(Math.random()-.5)*this.noise*2}}]),r}(),n_=function(){function t(e){y(this,t),this._requests=new Map,this.timeoutTime=e}return m(t,[{key:"has",value:function(e){return this._requests.has(e)}},{key:"get",value:function(e){return this._requests.get(e)}},{key:"register",value:function(e){if(!e)throw new Error("invalid request id");if(this._requests.has(e))throw new Error("duplicate requests");var t=new Zv;return this._requests.set(e,{deferred:t,timer:this._createTimeoutTimer(e)}),t}},{key:"unregister",value:function(e){if(!this._requests.has(e))return null;var t=this._requests.get(e),n=t.timer,t=t.deferred;return clearTimeout(n),this._requests.delete(e),t}},{key:"_createTimeoutTimer",value:function(e){var t=this;return setTimeout(function(){t.unregister(e).reject(new Error("no response due to timeout"))},this._getTimeoutTime())}},{key:"rejectAll",value:function(e){var t,n=Q(this._requests.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value,i=this._requests.get(r);clearTimeout(i.timer),i.deferred.reject(e)}}catch(e){n.e(e)}finally{n.f()}this._requests.clear()}},{key:"_getTimeoutTime",value:function(){return this.timeoutTime}}]),t}(),r_=function(){function i(e,t,n,r){y(this,i),g(this,"_timeoutTime",6e4),this._ctx=e,this._participantId=t,this._mediaDirections=n,this._endpointId=r,this._requestMap=new n_(this._timeoutTime)}var t,n,r;return m(i,[{key:"sendOfferSdp",value:(r=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._endpointId){e.next=5;break}return e.next=3,this._sendOfferAndUnregisterCreateEndpointRequest(t);case 3:e.next=7;break;case 5:return e.next=7,this._sendOfferAndUnregisterPutEndpointRequest(t);case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_sendOfferAndUnregisterCreateEndpointRequest",value:(n=_(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":create-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return n.apply(this,arguments)})},{key:"_sendOfferAndUnregisterPutEndpointRequest",value:(t=_(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":put-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return t.apply(this,arguments)})},{key:"registerCreateEndpointRequest",value:function(){if(this._endpointId)throw new Error("Cannot register create endpoint request on endpoint recycle");return this._requestMap.register("".concat(this._participantId,":create-endpoint-request"))}},{key:"registerPutEndpointRequest",value:function(){if(this._endpointId)return this._requestMap.register("".concat(this._participantId,":put-endpoint-request"));throw new Error("Cannot register put endpoint request without endpoint id")}},{key:"_sendCreateEndpoint",value:function(e){return this._ctx.sendCreateEndpoint(e)}},{key:"_sendPutEndpoint",value:function(e){return this._ctx.sendPutEndpoint(e)}}]),i}(),i_=function(){E(n,Fv);var t=I(n);function n(e){return y(this,n),t.call(this,e)}return m(n)}(),s_=((go=Dv=Dv||{}).PENDING="pending",go.ESTABLISHED="established",go.CONNECTED="connected",go.FAILED="failed",go.RELEASING="releasing",go.CLOSED="closed",function(){E(s,i_);var i=I(s);function s(){var e;y(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(b(e=i.call.apply(i,[this].concat(n))),"type",Dv.CLOSED),e}return m(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),s}()),a_=function(){E(n,i_);var t=I(n);function n(e){return y(this,n),g(b(e=t.call(this,e)),"type",Dv.CONNECTED),e}return m(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onICEFailed",value:function(){this._stateMutator.toPending()}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(),o_=function(){E(i,i_);var r=I(i);function i(e,t,n){return y(this,i),g(b(e=r.call(this,e)),"type",Dv.ESTABLISHED),e._sdp=t,e._hasPendingAttach=n,e}return m(i,[{key:"_onStart",value:function(){this._context.dispatchEvent("established"),this._context.setRemoteDescription(this._sdp),this._hasPendingAttach&&this.onAttach()}},{key:"_onDestroy",value:function(){}},{key:"onPCConnected",value:function(){this._stateMutator.toConnected()}},{key:"onICEFailed",value:function(){this._stateMutator.toPending()}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),i}(),u_=function(){E(s,i_);var i=I(s);function s(){var e;y(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(b(e=i.call.apply(i,[this].concat(n))),"type",Dv.FAILED),e}return m(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("failed"),this._context.endpoint.id?this._stateMutator.toReleasing():this._stateMutator.toClosed()}},{key:"_onDestroy",value:function(){}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),c_=function(){E(s,i_);var i=I(s);function s(){var e;y(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(b(e=i.call.apply(i,[this].concat(n))),"type",Dv.PENDING),e}return m(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("pending"),this._request()}},{key:"_onDestroy",value:function(){this._requestTimeout&&clearTimeout(this._requestTimeout),delete this._requestTimeout}},{key:"_request",value:function(){var e=this,t=(this._context.trialCount+=1,this._context.trialCount);9<=t?this._stateMutator.toFailed():1<t?this._requestTimeout=setTimeout(function(){e._context.createSession()},5e3*t+2e3*(Math.random()-.5)):this._context.createSession()}},{key:"onEndpointRequestSucceeded",value:function(e){this._stateMutator.toEstablished(e,this._hasPendingAttach)}},{key:"onEndpointRequestFailed",value:function(){this._request()}},{key:"onAttach",value:function(){this._hasPendingAttach=!0}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),l_=function(){E(s,i_);var i=I(s);function s(){var e;y(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(b(e=i.call.apply(i,[this].concat(n))),"type",Dv.RELEASING),e}return m(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("releasing"),this._context.closePeerConnection(),this._context.endpoint.id&&this._context.requestRelease()}},{key:"_onDestroy",value:function(){}},{key:"onEndpointRequestSucceeded",value:function(){this._context.requestRelease()}},{key:"onEndpointRequestFailed",value:function(){this._stateMutator.toClosed()}},{key:"onReleased",value:function(){this._stateMutator.toClosed()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),h_=function(){E(t,Uv);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t,[{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}},{key:"toPending",value:function(){this._changeState(new c_(this))}},{key:"toEstablished",value:function(e,t){this._changeState(new o_(this,e,t))}},{key:"toConnected",value:function(){this._changeState(new a_(this))}},{key:"toFailed",value:function(){this._changeState(new u_(this))}},{key:"toReleasing",value:function(){this._changeState(new l_(this))}},{key:"toClosed",value:function(){this._changeState(new s_(this))}}]),t}(),d_=function(){E(n,qv);var t=I(n);function n(e){return y(this,n),(e=t.call(this,e,new h_(e)))._stateMutator.toPending(),e}return m(n,[{key:"state",get:function(){return this._stateMutator.state}},{key:"onEndpointRequestSucceeded",value:function(e){T.verbose("[".concat(this.state.type,"] onEndpointRequestSucceeded"));var t=this.state;switch(t.type){case Dv.PENDING:t.onEndpointRequestSucceeded(e);break;case Dv.RELEASING:t.onEndpointRequestSucceeded();break;default:T.error("[".concat(this.state.type,"] onEndpointRequestSucceeded"))}}},{key:"onEndpointRequestFailed",value:function(){T.verbose("[".concat(this.state.type,"] onEndpointCreateFailed"));var e=this.state;switch(e.type){case Dv.PENDING:case Dv.RELEASING:e.onEndpointRequestFailed();break;default:T.error("[".concat(this.state.type,"] onEndpointCreateFailed"))}}},{key:"onICEFailed",value:function(){T.verbose("[".concat(this.state.type,"] onICEFailed"));var e=this.state;switch(e.type){case Dv.ESTABLISHED:case Dv.CONNECTED:e.onICEFailed();break;default:T.error("[".concat(this.state.type,"] onICEFailed"))}}},{key:"onPCConnected",value:function(){T.verbose("[".concat(this.state.type,"] onPCConnected"));var e=this.state;e.type===Dv.ESTABLISHED?e.onPCConnected():T.error("[".concat(this.state.type,"] onPCConnected"))}},{key:"onAttach",value:function(){T.verbose("[".concat(this.state.type,"] onAttach"));var e=this.state;switch(e.type){case Dv.PENDING:case Dv.ESTABLISHED:case Dv.CONNECTED:e.onAttach();break;default:T.error("[".concat(this.state.type,"] onAttach"))}}},{key:"onRelease",value:function(){T.verbose("[".concat(this.state.type,"] onRelease"));var e=this.state;switch(e.type){case Dv.PENDING:case Dv.ESTABLISHED:case Dv.CONNECTED:e.onRelease();break;default:T.error("[".concat(this.state.type,"] onRelease"))}}},{key:"onReleased",value:function(){T.verbose("[".concat(this.state.type,"] onReleased"));var e=this.state;e.type===Dv.RELEASING?e.onReleased():T.error("[".concat(this.state.type,"] onReleased"))}},{key:"onExit",value:function(){T.verbose("[".concat(this.state.type,"] onExit"));var e=this.state;switch(e.type){case Dv.RELEASING:case Dv.PENDING:case Dv.CONNECTED:case Dv.ESTABLISHED:case Dv.FAILED:e.onExit();break;default:T.error("[".concat(this.state.type,"] onExit"))}}}]),n}(),f_=function(){E(r,Mc);var n=I(r);function r(e){var t;return y(this,r),(t=n.call(this)).payload=e.payload||{},t}return m(r)}(),p_=function(){E(t,f_);var e=I(t);function t(){return y(this,t),e.apply(this,arguments)}return m(t)}(),v_=((xi=Mv=Mv||{}).OFFER="offer",xi.ANSWER="answer",xi.CANDIDATE="candidate",function(){E(n,p_);var t=I(n);function n(e){return y(this,n),g(b(e=t.call(this,{payload:e})),"type",Mv.ANSWER),e}return m(n)}()),__=function(){E(n,p_);var t=I(n);function n(e){return y(this,n),g(b(e=t.call(this,{payload:e})),"type",Mv.CANDIDATE),e}return m(n)}(),y_=function(){E(n,p_);var t=I(n);function n(e){return y(this,n),g(b(e=t.call(this,{payload:e})),"type",Mv.OFFER),e}return m(n)}(),m_=function(){function e(){y(this,e)}return m(e,null,[{key:"createOffer",value:function(e,t){return new y_({peerConnectionId:e,sdp:t})}},{key:"createAnswer",value:function(e,t){return new v_({peerConnectionId:e,sdp:t})}},{key:"createCandidate",value:function(e,t){return new __({peerConnectionId:e,candidate:t})}}]),e}(),g_=function(){E(a,Yf);var s=I(a);function a(e,t,n,r){var i;return y(this,a),g(b(i=s.call(this)),"tmpId",oe()),g(b(i),"_createSession",function(){switch(T.debug("_createSession()"),i._type){case"master":i._createMasterSession();break;case"viewer":i._createViewerSession();break;default:T.error("Not supported endpoint type : ",i._type)}}),g(b(i),"_closePeerConnection",function(){T.debug("_closePeerConnection()"),i._pc.removeAllEventListeners(),i._pc.close()}),g(b(i),"_requestAttach",function(){$v(new t_(5e3,1e3,8),function(){return i._sendAttach(i._attachedTo)},{onError:function(e){T.error("Fail attach endpoint endpointId = ".concat(i.id,", to = ").concat(i._attachedTo," ErrorCode = ").concat(e.code))}}).then(function(){i._dispatchEvent("attached",i._attachedTo)})}),g(b(i),"_requestRelease",function(){T.debug("_requestRelease()"),i._sendReleaseEndpoint().then(function(){i._stateMachine.onReleased()}).catch(function(e){T.error("Release request failed",e),i._stateMachine.onReleased()})}),g(b(i),"_setRemoteDescription",function(e){T.debug("_setRemoteDescription()");var t=i._pc,e=m_.createAnswer(void 0,e);t.onEvent(e),t.once("connected",function(){i._stateMachine.onPCConnected(),i._sendConnected()}),t.once("iceFailed",function(){i._stateMachine.onICEFailed()})}),i._ctx=e,i._localStream=t,i._type=n,i._participantId=r,i._stateMachine=new d_({endpoint:b(i),dispatchEvent:i._dispatchEvent.bind(b(i)),createSession:i._createSession,setRemoteDescription:i._setRemoteDescription,closePeerConnection:i._closePeerConnection,requestAttach:i._requestAttach,requestRelease:i._requestRelease,trialCount:0}),i}return m(a,[{key:"pc",get:function(){return this._pc}},{key:"_state",get:function(){return this._stateMachine.state}},{key:"_masterSessionDirection",get:function(){return this._ctx.masterSessionDirection}},{key:"_viewerSessionDirection",get:function(){return this._ctx.viewerSessionDirection}},{key:"attach",value:function(e){T.debug("attach()"),this._attachedTo=e,this._stateMachine.onAttach()}},{key:"release",value:function(){T.debug("release()"),this._stateMachine.onRelease()}},{key:"exit",value:function(){T.debug("exit()"),this._closePeerConnection(),this._stateMachine.onExit()}},{key:"_createMasterSession",value:function(){T.debug("_createMasterSession()"),this._createPeerConnection(this._masterSessionDirection,this._localStream),this._requestCreateEndpoint()}},{key:"_createViewerSession",value:function(){T.debug("_createViewerSession()"),this._createPeerConnection(this._viewerSessionDirection,void 0),this._requestCreateEndpoint()}},{key:"_createPeerConnection",value:function(e,t){T.debug("_createPeerConnection()");var n=new r_(this._ctx,this._participantId,e,this.id);this._pc=new Jv(this._ctx,void 0,n,t,!0,void 0,e,!0),this._dispatchEvent("pcChanged",this._pc)}},{key:"_requestCreateEndpoint",value:function(){var t=this,e=(T.debug("_requestCreateEndpoint()"),this._pc),n=this.id?e.signalingClient.registerPutEndpointRequest():e.signalingClient.registerCreateEndpointRequest();e.createOffer(),n.promise.then(function(e){t.id=e.payload.endpoint.id,t._stateMachine.onEndpointRequestSucceeded(e.payload.sdp)}).catch(function(e){T.error("Endpoint request failed",e),t._stateMachine.onEndpointRequestFailed()})}},{key:"_sendConnected",value:function(){return this._ctx.sendConnected(this)}},{key:"_sendReleaseEndpoint",value:function(){return this._ctx.sendReleaseEndpoint(this)}},{key:"_sendAttach",value:function(e){return this._ctx.sendAttach(this,e)}}]),a}(),E_=function(){E(n,Yf);var e,t=I(n);function n(){return y(this,n),t.call(this)}return m(n,[{key:"stream",get:function(){return this._stream}},{key:"isSharing",get:function(){return!!this._stream}},{key:"startStream",value:(e=_(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getDisplayMedia({video:!0});case 3:t=e.sent,this._stream=t,this._stream.getVideoTracks()[0].onended=function(){n._releaseStream(),n._dispatchEvent("streamStopped")},e.next=19;break;case 8:e.prev=8,e.t0=e.catch(0),e.t1=e.t0.name,e.next="InvalidStateError"===e.t1?13:"NotAllowedError"===e.t1?14:"NotFoundError"===e.t1?15:"NotReadableError"===e.t1?16:17;break;case 13:case 14:case 15:case 16:return e.abrupt("break",18);case 17:throw new Error("");case 18:throw new Error("failed to start screen share");case 19:case"end":return e.stop()}},e,this,[[0,8]])})),function(){return e.apply(this,arguments)})},{key:"stopStream",value:function(){this._releaseStream(),this._dispatchEvent("streamStopped")}},{key:"_releaseStream",value:function(){if(this._stream){var e,t=Q(this._stream.getTracks());try{for(t.s();!(e=t.n()).done;)e.value.stop()}catch(e){t.e(e)}finally{t.f()}delete this._stream}}}]),n}(),b_=function(){E(i,Yf);var e,r=I(i);function i(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};return y(this,i),g(b(t=r.call(this)),"_checkScreenSharePrerequisites",function(){if(!navigator.mediaDevices.getDisplayMedia)throw new Error("screen share is not supported in this browser")}),t._deviceManager=e,t._mediaConstraints=n,t._screenShare=new E_,t._screenShare.on("streamStopped",function(){t._releaseMergedStream(),t._dispatchEvent("screenShareStreamStopped")}),t}return m(i,[{key:"mediaConstraints",set:function(e){this._mediaConstraints=e}},{key:"hasPermission",get:function(){var e;return null==(e=this._mediaAccess)?void 0:e.hasPermission}},{key:"localStream",get:function(){return this.isScreenSharing?this._mergedStream:this.getLocalMediaStream()}},{key:"mergedStream",get:function(){return this._mergedStream}},{key:"screenStream",get:function(){return this._screenShare.stream}},{key:"isScreenSharing",get:function(){return this._screenShare.isSharing}},{key:"useScreenStream",value:(e=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkScreenSharePrerequisites(),e.next=3,this._screenShare.startStream();case 3:this._mergeScreenShareStream(),this._dispatchEvent("streamChanged",this.localStream);case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"getLocalMediaStream",value:function(){return this._mediaAccess||this._grantMediaAccess(this._mediaConstraints),this._mediaAccess.stream}},{key:"stopScreenShare",value:function(){this._screenShare.isSharing&&this._screenShare.stopStream()}},{key:"revokeMediaAccess",value:function(){this._mediaAccess&&(this._mediaAccess.dispose(),this._mediaAccess=null)}},{key:"release",value:function(){this.stopScreenShare(),this.revokeMediaAccess()}},{key:"_grantMediaAccess",value:function(e){var t=this;this._mediaAccess=this._deviceManager.useMedia(e),this._mediaAccess.on("streamChanged",function(){t._screenShare.isSharing&&t._mergeScreenShareStream(),t._dispatchEvent("streamChanged",t.localStream)}),this._mediaAccess.on("audioOutputChanged",function(){return t._dispatchEvent("audioOutputChanged")})}},{key:"_mergeScreenShareStream",value:function(){var e;this._screenShare.isSharing&&(e=new MediaStream,this._mediaAccess.stream&&0<this._mediaAccess.stream.getAudioTracks().length&&e.addTrack(this._mediaAccess.stream.getAudioTracks()[0]),e.addTrack(this.screenStream.getVideoTracks()[0]),this._mergedStream=e)}},{key:"_releaseMergedStream",value:function(){this._mergedStream&&(this._mergedStream.removeTrack(this._mergedStream.getAudioTracks()[0]),delete this._mergedStream,this._dispatchEvent("streamChanged",this.localStream))}}]),i}(),I_=function(){function i(e,t,n,r){y(this,i),this._liveEvent=e,this._sender=n,this._deviceManager=t,this._mediaOption=r}var t,n,r;return m(i,[{key:"mediaView",get:function(){return this._mediaView},set:function(e){this._mediaView!==e&&(this._mediaView&&(this._mediaView=null),e?this.isHostStream?this._mediaView=this._updateMediaViewStream(e,this.localStream):this._mediaView=this._updateMediaViewStream(e,this.stream):delete this._mediaView)}},{key:"localStream",get:function(){var e;return null==(e=this._localStream)?void 0:e.localStream}},{key:"stream",get:function(){var e;return null==(e=this._endpoint.pc)?void 0:e.remoteStream}},{key:"isHostStream",get:function(){return this._mediaOption}},{key:"_createLocalStream",value:function(){var e=this;this._localStream=new b_(this._deviceManager,{audio:!0,video:!0}),this._localStream.on("streamChanged",function(){e._onLocalStream()})}},{key:"_createEndpoint",value:function(){var e,t=this;return this.isHostStream?(this._localStream||this._createLocalStream(),new g_({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},this._localStream,"master",this._liveEvent.host.hostId)):(e=new g_({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},void 0,"viewer",this._liveEvent.currentLiveUser.participantId),this._unsubscriber=e.pc.on("remoteStream",function(e){t._onStream()}),e)}},{key:"openStream",value:function(){this._endpoint&&this._teardown(),this._endpoint=this._createEndpoint()}},{key:"closeStream",value:function(e){e&&this._endpoint.release(),this._teardown()}},{key:"attach",value:function(e){this._endpoint.attach(e)}},{key:"toggleAudio",value:function(t){var e;null!=(e=this.localStream.getAudioTracks())&&e.forEach(function(e){e.enabled=t}),this._mediaOption.turnAudioOn=t}},{key:"toggleVideo",value:function(t){var e;null!=(e=this.localStream.getVideoTracks())&&e.forEach(function(e){e.enabled=t}),this._mediaOption.turnVideoOn=t}},{key:"chooseMediaDevice",value:function(e,t){this._deviceManager.selectDevice(e,t)}},{key:"_onLocalStream",value:function(){this.toggleAudio(this._mediaOption.turnAudioOn),this.toggleVideo(this._mediaOption.turnVideoOn),this._mediaView&&this._updateMediaViewStream(this._mediaView,this.localStream)}},{key:"_onStream",value:function(){var e=this.stream;this._mediaView&&this._updateMediaViewStream(this._mediaView,e)}},{key:"_updateMediaViewStream",value:function(e,t){return t&&(e.srcObject=t),e}},{key:"_sendConnected",value:(r=_(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.isHostStream?Af.createHostConnected(this._liveEvent.liveEventId,this._liveEvent.host.hostId,t.id):Af.createConnected(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,t.id),e.abrupt("return",this._sender.send(n));case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_sendReleaseEndpoint",value:function(e){e=this.isHostStream?Af.createHostDeleteStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,e.id):Af.createDeleteStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id);return this._sender.sendWithRetry(e)}},{key:"_sendAttach",value:function(e,t){e=Af.createAttach(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id,t);return this._sender.sendWithRetry(e)}},{key:"_sendCreateEndpoint",value:(n=_(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHostStream)return n=Af.createHostCreateStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,t.sdp,"sendonly","sendonly"),e.abrupt("return",this._sender.send(n));e.next=5;break;case 5:return n=Af.createStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,t.sdp,"recvonly","recvonly"),e.abrupt("return",this._sender.send(n));case 7:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_sendPutEndpoint",value:(t=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._sendCreateEndpoint(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_teardown",value:function(){var e;null!=(e=this._endpoint)&&e.exit(),(this._endpoint=null)!=(e=this._unsubscriber)&&e.call(this),this._unsubscriber=null}}]),i}(),T_=(D.ErrorCode=void 0,(r=D.ErrorCode||(D.ErrorCode={}))[r.LIVE_EVENT_ID_NOT_FOUND=2800100]="LIVE_EVENT_ID_NOT_FOUND",r[r.ACTION_NOT_ALLOWED_IN_CURRENT_STATE=2800101]="ACTION_NOT_ALLOWED_IN_CURRENT_STATE",r[r.ACTION_NOT_ALLOWED_FOR_PARTICIPANT=2800102]="ACTION_NOT_ALLOWED_FOR_PARTICIPANT",r[r.USER_NOT_ENTERED_LIVE_EVENT=2800103]="USER_NOT_ENTERED_LIVE_EVENT",r[r.STREAM_NOT_STARTED=2800104]="STREAM_NOT_STARTED",r[r.CONNECTION_TO_MEDIA_STREAM_FAILED=2800105]="CONNECTION_TO_MEDIA_STREAM_FAILED",r[r.UNKNOWN_NETWORK_ERROR=2800400]="UNKNOWN_NETWORK_ERROR",r[r.QUERY_IN_PROGRESS=2800900]="QUERY_IN_PROGRESS",r[r.OPEN_CHANNEL_NOT_FETCHED=2800901]="OPEN_CHANNEL_NOT_FETCHED",function(){function e(){y(this,e)}return m(e,null,[{key:"getErrorMessage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=(t.invalidParameter,t.methodName),n=void 0===t?"":t;switch(e){case D.ErrorCode.LIVE_EVENT_ID_NOT_FOUND:return"The live event ID is not found.";case D.ErrorCode.ACTION_NOT_ALLOWED_IN_CURRENT_STATE:return"The user is trying to perform actions such as calling the ".concat(n,", ").concat(n,", ").concat(n," methods for a live event that is not in the 'ongoing' or 'ready' state.");case D.ErrorCode.ACTION_NOT_ALLOWED_FOR_PARTICIPANT:return"The participant is trying to perform actions that are only allowed for a host.";case D.ErrorCode.USER_NOT_ENTERED_LIVE_EVENT:return"The user is trying to perform actions on a live event without entering the event.";case D.ErrorCode.STREAM_NOT_STARTED:return"The user is trying to end a stream that doesn't exist.";case D.ErrorCode.CONNECTION_TO_MEDIA_STREAM_FAILED:return"The connection to media stream failed to establish.";case D.ErrorCode.UNKNOWN_NETWORK_ERROR:return"An unknown network error has occured.";case D.ErrorCode.QUERY_IN_PROGRESS:return"The last query is in progress.";case D.ErrorCode.OPEN_CHANNEL_NOT_FETCHED:return"The open channel for the live event is not fetched.";default:return""}}}]),e}()),w_=["message","error"],S_=function(){E(s,H(Error));var i=I(s);function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.message,r=t.error,t=G(t,w_),n=(y(this,s),n||T_.getErrorMessage(e,t)),t=i.call(this,n);return t.code=e,t._error=r,t}return m(s)}(),C_=function(){E(v,Yf);var e,t,n,r,i,s,a,o,u,c,l,h,d,f,p=I(v);function v(e){var t,n=e.deviceManager,r=e.sender,i=e.sb,s=e.userId,e=e.info;return y(this,v),g(b(t=p.call(this)),"_customItemsUpdatedAt",0),t._deviceManager=n,t._sender=r,t._sb=i,t._userId=s,t._streams=new Map,t._customItems=null,e&&Object.assign(b(t),e),t._unsubscriber=t._sender.on("command",function(e){t._onEvent(e)}),t}return m(v,[{key:"customItems",get:function(){return x({},this._customItems)},set:function(e){this._customItems=e}},{key:"myRole",get:function(){return this.userIdsForHost.includes(this._userId)?D.LiveEventRole.HOST:D.LiveEventRole.PARTICIPANT}},{key:"isHost",get:function(){return this.myRole===D.LiveEventRole.HOST}},{key:"isActiveHost",get:function(){return this.isHost&&this.host&&this.host.userId===this._userId}},{key:"duration",get:function(){return 0<this._duration?this._duration:Date.now()-this.startedAt},set:function(e){this._duration=e}},{key:"fetchOpenChannel",value:(f=_(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sb.openChannel.getChannelWithoutCache(this.liveEventId);case 2:return t=e.sent,t=this._sb.openChannel.buildOpenChannelFromSerializedData(t),this.openChannel=t,e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"_getOpenChannel",value:(d=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.openChannel)return e.abrupt("return",this.openChannel);e.next=2;break;case 2:return e.abrupt("return",this.fetchOpenChannel());case 3:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"enterAsHost",value:(h=_(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getOpenChannel();case 2:return n=e.sent,e.next=5,n.enter();case 5:return e.prev=5,e.next=8,this._sender.send(Af.createEnterHost(this.liveEventId,t));case 8:r=e.sent,r=r.payload.host,t&&this._streams.set(r.hostId,new I_(this,this._deviceManager,this._sender,t)),this.upsert({host:r}),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(5),e.next=18,n.exit();case 18:throw e.t0;case 19:this._startToSendAlive();case 20:case"end":return e.stop()}},e,this,[[5,14]])})),function(e){return h.apply(this,arguments)})},{key:"setEventReady",value:(l=_(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:return e.next=4,this._sender.send(Af.createReady(this.liveEventId));case 4:t=e.sent,t=t.payload.liveEvent,this.upsert(t);case 7:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"startEvent",value:(c=_(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:return e.next=4,this._sender.send(Af.createStart(this.liveEventId));case 4:n=e.sent,n=n.payload.liveEvent,this.upsert(n),this.isHostStreaming||this.startStreaming(t),"boolean"==typeof t.turnAudioOn&&this._toggleAudio(t.turnAudioOn),"boolean"==typeof t.turnVideoOn&&this._toggleVideo(t.turnVideoOn);case 10:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"startStreaming",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{turnAudioOn:!0,turnVideoOn:!0};if(!this.isActiveHost)throw new Error("current host only action");var t=this._streams.get(this.host.hostId);t||(e=new I_(this,this._deviceManager,this._sender,e),this._streams.set(this.host.hostId,e)),t.openStream()}},{key:"endStreaming",value:function(){if(!this.isActiveHost)throw new Error("current host only action");var e=this._streams.get(this.host.hostId);e&&(this._streams.delete(this.host.hostId),e.closeStream(!0))}},{key:"exitAsHost",value:(u=_(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isActiveHost){e.next=2;break}throw new Error("current host only action");case 2:return t=this.host.hostId,e.next=5,this._sender.send(Af.createExitHost(this.liveEventId,t));case 5:t=e.sent,n=t.payload.host,this.upsert({host:n}),this.teardown();case 9:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"endEvent",value:(o=_(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sender.send(Af.createEndLiveEvent(this.liveEventId));case 2:t=e.sent,t=t.payload.liveEvent,this.upsert(t),this.teardown();case 6:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"muteAudioInput",value:function(){this._toggleAudio(!1)}},{key:"unmuteAudioInput",value:function(){this._toggleAudio(!0)}},{key:"_toggleAudio",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");this._streams.get(this.host.hostId).toggleAudio(e),this._sender.send(Af.createAudio(this.liveEventId,this.host.hostId,e))}},{key:"stopVideo",value:function(){this._toggleVideo(!1)}},{key:"startVideo",value:function(){this._toggleVideo(!0)}},{key:"_toggleVideo",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");this._streams.get(this.host.hostId).toggleVideo(e),this._sender.send(Af.createVideo(this.liveEventId,this.host.hostId,e))}},{key:"selectAudioInput",value:function(e){if(this.isActiveHost)return this._deviceManager.selectDevice("audioinput",e);throw new Error("current host only action")}},{key:"selectVideoInput",value:function(e){if(this.isActiveHost)return this._deviceManager.selectDevice("videoinput",e);throw new Error("current host only action")}},{key:"enter",value:(a=_(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getOpenChannel();case 2:return t=e.sent,e.next=5,t.enter();case 5:return e.prev=5,e.next=8,this._sender.send(Af.createEnter(this.liveEventId));case 8:n=e.sent,n=n.payload.participant,this.upsert({currentLiveUser:n}),this._tryOpen(),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(5),e.next=18,t.exit();case 18:throw e.t0;case 19:this._startToSendAlive();case 20:case"end":return e.stop()}},e,this,[[5,14]])})),function(){return a.apply(this,arguments)})},{key:"exit",value:(s=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sender.send(Af.createExit(this.liveEventId,this.currentLiveUser.participantId));case 2:e.sent.payload.participant,this.teardown();case 5:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"setVideoViewForLiveEvent",value:function(e,t){t=this._streams.get(t);t&&(t.mediaView=e)}},{key:"updateLiveEventInfo",value:(i=_(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Af.updateLiveEvent(this.liveEventId,t.userIdsForHost,t.title,t.coverUrl,t.coverFile),e.next=3,this._sender.send(n);case 3:n=e.sent,r=n.payload.liveEvent,this.upsert(r);case 6:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"fetchCustomItems",value:(r=_(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Af.createGetCustomItems(this.liveEventId),e.prev=1,e.next=4,this._sender.send(t);case 4:return t=e.sent,n=t.payload,this._setCustomItems(n.customItems),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),T.error("failed to update customItems"),e.t0;case 14:case"end":return e.stop()}},e,this,[[1,10]])})),function(){return r.apply(this,arguments)})},{key:"updateCustomItems",value:(n=_(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object.keys(t).some(function(e){return"string"!=typeof t[e]}))throw new Error("invalid parameter");e.next=2;break;case 2:return n=Af.createUpdateCustomItems(this.liveEventId,t),e.prev=3,e.next=6,this._sender.send(n);case 6:return n=e.sent,r=n.payload,this._setCustomItems(r.customItems,r.updatedAt),e.abrupt("return",r);case 12:throw e.prev=12,e.t0=e.catch(3),T.error("failed to update customItems"),e.t0;case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return n.apply(this,arguments)})},{key:"deleteCustomItems",value:(t=_(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.some(function(e){return"string"!=typeof e}))throw new Error("invalid parameter");e.next=2;break;case 2:return n=Af.createDeleteCustomItems(this.liveEventId,t),e.prev=3,e.next=6,this._sender.send(n);case 6:return n=e.sent,r=n.payload,this._setCustomItems(r.customItems,r.deletedAt),e.abrupt("return",r);case 12:throw e.prev=12,e.t0=e.catch(3),T.error("failed to delete customItems"),e.t0;case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return t.apply(this,arguments)})},{key:"deleteAllCustomItems",value:(e=_(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Af.createDeleteAllCustomItems(this.liveEventId),e.prev=1,e.next=4,this._sender.send(t);case 4:return t=e.sent,n=t.payload,this._setCustomItems(n.customItems,n.deletedAt),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),T.error("failed to delete all customItems"),e.t0;case 14:case"end":return e.stop()}},e,this,[[1,10]])})),function(){return e.apply(this,arguments)})},{key:"upsert",value:function(e){Object.assign(this,e)}},{key:"teardown",value:function(){null!=(e=this.openChannel)&&e.exit();var e,t,n=Q(this._streams.values());try{for(n.s();!(t=n.n()).done;)t.value.closeStream()}catch(e){n.e(e)}finally{n.f()}this._streams.clear(),this._stopToSendAlive(),this.upsert({currentLiveUser:void 0})}},{key:"_setCustomItems",value:function(e,t){return(void 0===t||t>this._customItemsUpdatedAt)&&(this._customItemsUpdatedAt=t,this._customItems=e||{},!0)}},{key:"_onEvent",value:function(e){if(this.liveEventId===e.payload.liveEventId)if(e instanceof zd)this._onReady(e);else if(e instanceof Wd)this._onStarted(e);else if(e instanceof Yd)this._onEnded(e);else if(e instanceof gf)this._onUpdated(e);else if(e instanceof Xd)this._onHostEntered(e);else if(e instanceof Jd)this._onHostExited(e);else if(e instanceof Zd)this._onHostConnected(e);else if(e instanceof _f)this._onHostDisconnected(e);else if(e instanceof $d)this._onHostAudioStatusChanged(e);else if(e instanceof ef)this._onHostVideoStatusChanged(e);else if(e instanceof tf)this._onParticipantEntered(e);else if(e instanceof nf)this._onParticipantExited(e);else if(e instanceof Cf)this._onUpdateCustomItems(e);else{if(!(e instanceof kf))throw new Error("unknown event is received");this._onDeleteCustomItems(e)}}},{key:"_onReady",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventReady",this)}},{key:"_onStarted",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventStarted",this),this._tryOpen()}},{key:"_onEnded",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventEnded",this),this.teardown()}},{key:"_onUpdated",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventUpdated",this)}},{key:"_onHostEntered",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostEntered",this,this.host)}},{key:"_onHostExited",value:function(e){e=e.payload.host;this.upsert({host:void 0}),this._dispatchEvent("hostExited",this,e)}},{key:"_onHostConnected",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostConnected",this,this.host),this._tryOpen()}},{key:"_onHostDisconnected",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostDisconnected",this,this.host)}},{key:"_onHostAudioStatusChanged",value:function(e){e=e.payload.host;this.upsert({host:e}),e.isAudioOn&&this._dispatchEvent("hostUnmutedAudio",this,this.host),e.isAudioOn||this._dispatchEvent("hostMutedAudio",this,this.host)}},{key:"_onHostVideoStatusChanged",value:function(e){e=e.payload.host;this.upsert({host:e}),e.isVideoOn&&this._dispatchEvent("hostStartedVideo",this,this.host),e.isVideoOn||this._dispatchEvent("hostStoppedVideo",this,this.host)}},{key:"_onParticipantEntered",value:function(e){var e=e.payload,t=e.participant,n=e.participantCount,r=e.peakParticipantCount,e=e.cumulativeParticipantCount;this.upsert({participantCount:n,peakParticipantCount:r,cumulativeParticipantCount:e}),this._dispatchEvent("participantEntered",this,t)}},{key:"_onParticipantExited",value:function(e){var e=e.payload,t=e.participant,n=e.participantCount,r=e.peakParticipantCount,e=e.cumulativeParticipantCount;this.upsert({participantCount:n,peakParticipantCount:r,cumulativeParticipantCount:e}),this._dispatchEvent("participantExited",this,t)}},{key:"_onUpdateCustomItems",value:function(e){var e=e.payload,t=e.customItems,n=e.updatedAt;e.updatedKeys,this._setCustomItems(t,n)&&this._dispatchEvent("customItemsUpdated",t,n)}},{key:"_onDeleteCustomItems",value:function(e){var e=e.payload,t=e.customItems,n=e.deletedAt;e.deletedKeys,this._setCustomItems(t,n)&&this._dispatchEvent("customItemsDeleted",t,n)}},{key:"onDisconnected",value:function(){this._dispatchEvent("disconnected",this,new S_(D.ErrorCode.LIVE_EVENT_ID_NOT_FOUND)),this.teardown()}},{key:"_tryOpen",value:function(){var e,t;this.host&&this.host.state===D.HostState.CONNECTED&&this.state===D.LiveEventState.ONGOING&&(e=this.host.hostId,this._streams.has(e)?t=this._streams.get(e):(t=new I_(this,this._deviceManager,this._sender),this._streams.set(e,t)),t.openStream(),t.attach(e))}},{key:"_tryClose",value:function(){}},{key:"_startToSendAlive",value:function(){var t=this;this.isActiveHost?this._aliveIntervalId=setInterval(function(){var e=Af.createHostAlive(t.liveEventId,t.host.hostId);t._sender.send(e)},3e3):this._aliveIntervalId=setInterval(function(){var e=Af.createAlive(t.liveEventId,t.currentLiveUser.participantId);t._sender.send(e)},9e4)}},{key:"_stopToSendAlive",value:function(){this._aliveIntervalId&&(clearInterval(this._aliveIntervalId),delete this._aliveIntervalId)}}]),v}(),k_=function(e,t){return(k_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}k_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var f=function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function re(e,a,o,u){return new(o=o||Promise)(function(n,t){function r(e){try{s(u.next(e))}catch(e){t(e)}}function i(e){try{s(u.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,i)}s((u=u.apply(e,a||[])).next())})}function ie(r,i){var s,a,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,a&&(o=2&t[0]?a.return:t[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,t[1])).done)return o;switch(a=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!((o=0<(o=u.trys).length&&o[o.length-1])||6!==t[0]&&2!==t[0])){u=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){u.label=t[1];break}if(6===t[0]&&u.label<o[1]){u.label=o[1],o=t;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(t);break}o[2]&&u.ops.pop(),u.trys.pop();continue}t=i.call(r,u)}catch(e){t=[6,e],a=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function se(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function N_(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function A_(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.defineProperty(R_,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(R_,"SDK_VERSION",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(R_,"SDK_MAJOR_VERSION",{get:function(){return R_.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(R_,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(R_,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0});var d,O_=R_;function R_(){}(t=d=d||{})[t.INVALID_TOKEN=400111]="INVALID_TOKEN",t[t.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",t[t.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",t[t.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",t[t.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",t[t.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",t[t.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",t[t.LOST_INSTANCE=700100]="LOST_INSTANCE",t[t.CONNECTION_RENEW=700102]="CONNECTION_RENEW",t[t.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",t[t.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",t[t.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",t[t.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",t[t.INVALID_PARAMETER=800110]="INVALID_PARAMETER",t[t.NETWORK_ERROR=800120]="NETWORK_ERROR",t[t.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",t[t.MALFORMED_DATA=800130]="MALFORMED_DATA",t[t.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",t[t.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",t[t.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",t[t.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",t[t.ACK_TIMEOUT=800180]="ACK_TIMEOUT",t[t.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",t[t.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",t[t.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",t[t.REQUEST_FAILED=800220]="REQUEST_FAILED",t[t.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",t[t.REQUEST_CANCELED=800240]="REQUEST_CANCELED",t[t.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",t[t.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",t[t.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",t[t.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",t[t.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED";function D_(e){return!(e instanceof p&&!e.shouldThrowOutside)}function M_(e,t){return e===t||(e=f({},e),t=f({},t),!(e.hasOwnProperty("messageId")&&t.hasOwnProperty("messageId")&&e.messageId!==t.messageId||e.hasOwnProperty("reqId")&&t.hasOwnProperty("reqId")&&e.reqId!==t.reqId||(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,t.hasOwnProperty("messageId")&&delete t.messageId,t.hasOwnProperty("reqId")&&delete t.reqId,JSON.stringify(e)!==JSON.stringify(t))))}function x_(e){return 0<e&&0<=H_.indexOf(e)}function L_(e,t){if((t=void 0===t?!1:t)&&null===e)return!0;if(!(t=l("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type)){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return t}function P_(e){var t=void 0===(t=e.encryption)?null:t,n=void 0===(n=e.store)?null:n,e=void 0===(e=e.localCacheEnabled)||e;this.nestdb=null,this.store=n,this.preference=new Q_({store:n}),this.encryption=null!=t?t:K_,this.localCacheEnabled=e}function U_(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}function F_(){}function w(t){var n={};return t&&Object.keys(t).forEach(function(e){void 0!==t[e]&&NaN!==t[e]&&null!==t[e]&&(n[e]=t[e])}),n}s(a,q_=Error),Object.defineProperty(a.prototype,"isInvalidTokenError",{get:function(){return this.code===d.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===d.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===d.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(a,"debugModeRequired",{get:function(){return new a({code:d.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"lostInstance",{get:function(){return new a({code:d.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"connectionRenew",{get:function(){return new a({code:d.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"invalidConnectionStateTransition",{get:function(){return new a({code:d.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"connectionRequired",{get:function(){return new a({code:d.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"connectionCanceled",{get:function(){return new a({code:d.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"invalidParameters",{get:function(){return new a({code:d.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"networkError",{get:function(){return new a({code:d.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"markAsReadAllRateLimitExceeded",{get:function(){return new a({code:d.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"queryInProgress",{get:function(){return new a({code:d.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"noAckTimeout",{get:function(){return new a({code:d.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"loginTimeout",{get:function(){return new a({code:d.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"connectionClosed",{get:function(){return new a({code:d.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"requestFailed",{get:function(){return new a({code:d.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"fileUploadCanceled",{get:function(){return new a({code:d.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"requestCanceled",{get:function(){return new a({code:d.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"sessionTokenRefreshFailed",{get:function(){return new a({code:d.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(a,"sessionTokenRequestFailed",{get:function(){return new a({code:d.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),a.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this};var S,q_,p=a,j_=[d.CONNECTION_REQUIRED,d.NETWORK_ERROR,d.ACK_TIMEOUT,d.WEBSOCKET_CONNECTION_CLOSED,d.WEBSOCKET_CONNECTION_FAILED,d.FILE_UPLOAD_CANCEL_FAILED,d.REQUEST_CANCELED,d.INTERNAL_SERVER_ERROR,d.RATE_LIMIT_EXCEEDED,d.UNKNOWN_SERVER_ERROR],H_=[d.WEBSOCKET_CONNECTION_CLOSED,d.WEBSOCKET_CONNECTION_FAILED,d.CONNECTION_REQUIRED],l=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||("string"!=typeof e?"object"==typeof e?G_(e,t):t instanceof e:typeof t===e)},G_=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||Object.values(e).includes(t)},h=function(t,e,n){return!(!(n=void 0===n?!1:n)||null!=e)||Array.isArray(e)&&e.every(function(e){return l(t,e)})},V_=(Object.defineProperty(ny.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){l("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(ny.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){l("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(ny.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){l("number",e)&&1e3<=e&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(ny.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){l("number",e)&&5e3<=e&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),ny),B_={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},K_={encrypt:function(e){return e},decrypt:function(e){return e}},Q_=(ty.prototype._savePreferenceKeys=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:A_([],N_(this._preference.keys()),!1),generation:1})];case 1:return e.sent(),[2]}})})},ty.prototype.init=function(u){var c;return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return this._keysAddress=u,[4,this._store.get(u)];case 1:t=null!=(c=e.sent())?c:[],e.label=2;case 2:e.trys.push([2,7,8,9]),n=se(t),r=n.next(),e.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._store.get(i)]);case 4:(s=e.sent())&&this._preference.set(i,s),e.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return s=e.sent(),a={error:s},[3,9];case 8:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 9:return[2]}})})},ty.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,null!=(n=this._preference.get(t))?n:null]})})},ty.prototype.set=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=!this._preference.has(n),[4,this._store.set({key:n,value:r,generation:1})];case 1:return e.sent(),this._preference.set(n,r),t?[4,this._savePreferenceKeys()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},ty.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.remove(t)];case 1:return e.sent(),this._preference.delete(t),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},ty.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.removeMany(A_([],N_(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},ty),z_=(Object.defineProperty(ey.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),ey.prototype.clear=function(){this.authToken=null,this.sessionKey=null},ey),W_=($_.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},$_.prototype.on=function(e,t){return this._register(e,-1,t)},$_.prototype.once=function(e,t){return this._register(e,1,t)},$_.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},$_),Y_=(Z_.prototype.on=function(e,t){return new W_({container:this._container}).on(e,t)},Z_.prototype.once=function(e,t){return new W_({container:this._container}).once(e,t)},Z_.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var s=[];try{for(var a=se(i.keys()),o=a.next();!o.done;o=a.next()){var u=o.value,c=i.get(u);c.handler(t),0<c.occurence&&(c.occurence--,0===c.occurence&&s.push(u))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}s.forEach(function(e){return i.delete(e)})}},Z_),X_=(J_.prototype.on=function(e){return this._dispatcher.on("event",e)},J_.prototype.once=function(e){return this._dispatcher.once("event",e)},J_.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},J_);function J_(){this._dispatcher=new Y_}function Z_(){this._container={}}function $_(e){e=e.container;this._container={},this._container=e,this.key=U_()}function ey(){this.sessionKey=null,this.authToken=null}function ty(e){e=e.store;this._preference=new Map,this._store=e}function ny(e){var e=void 0===e?{}:e,t=e.useMemberInfoInMessage,t=void 0!==t&&t,n=e.typingIndicatorInvalidateTime,n=void 0===n?1e4:n,r=e.typingIndicatorThrottle,r=void 0===r?1e3:r,e=e.websocketResponseTimeout,e=void 0===e?1e4:e;this._useMemberInfoInMessage=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=t,this._typingIndicatorInvalidateTime=n,this._typingIndicatorThrottle=r,this._websocketResponseTimeout=e}function a(e){var t=e.code,t=void 0===t?0:t,e=e.message,e=q_.call(this,e)||this;return e.shouldThrowOutside=!1,e.name="SendbirdError",e.code=t,Object.setPrototypeOf(e,a.prototype),e}(In=S=S||{}).GET="GET",In.POST="POST",In.PUT="PUT",In.DELETE="DELETE";s(_y,uy=F_),_y.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},Object.defineProperty(_y.prototype,"query",{get:function(){var t=this,n=w(this.params);return"?".concat(Object.keys(n).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t.stringifyParams(n[e])))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(_y.prototype,"payload",{get:function(){var r,i=this,s=w(this.params);return Object.keys(s).some(function(e){return L_(s[e])})?(r=new FormData,Object.keys(s).forEach(function(e){var t,n=s[e];L_(n)?r.append(e,n,null!=(t=n.name)?t:"filename"):r.append(e,i.stringifyParams(n))}),r):JSON.stringify(s)},enumerable:!1,configurable:!0});var ry,iy,sy,ay,oy,uy,o=_y,v=(s(vy,oy=F_),Object.defineProperty(vy.prototype,"payload",{get:function(){return f({},this._payload)},enumerable:!1,configurable:!0}),vy.prototype.as=function(e){return new e(this._iid,this.payload)},vy),cy=(s(py,ay=F_),py),ly=(s(fy,sy=F_),fy),hy=(s(dy,iy=F_),dy);function dy(e){var t=iy.call(this)||this;return t.statLog=e,t}function fy(){return null!==sy&&sy.apply(this,arguments)||this}function py(e){var t=ay.call(this)||this;return t.requestId=e,t}function vy(e,t){var n=oy.call(this)||this;return n._iid=e,n._payload=t,n}function _y(){var e=null!==uy&&uy.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=U_(),e}(wt=ry=ry||{}).WEBSOCKET_CONNECT="ws:connect",wt.API_RESULT="api:result";function yy(){}My.payloadify=function(e){return w({stat_type:e.type,ts:e.createdAt,data:w(e.data)})};var my,gy,Ey,by,Iy=My,Ty=(Object.defineProperty(Dy.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",e=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(O_.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(e)},enumerable:!1,configurable:!0}),Dy.prototype._createHeader=function(e,t){void 0===t&&(t=null);var n=this._sdkState,r=n.appId,n=n.appVersion,n=f(f({},e.headers),{SendBird:"JS,".concat(O_.OS_VERSION,",").concat(O_.SDK_VERSION,",").concat(r).concat(n?",".concat(n):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(n["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(n["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(n["App-Id"]=r,n["Access-Token"]=this._auth.authToken),n},Dy.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new hy(new Iy({type:ry.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},Dy.prototype.send=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:r=h.path,t=h.method,i=![S.GET,S.DELETE].includes(t),n=this._sdkState.api,n="".concat(n.host).concat(r).concat(i?"":h.query),r=i?h.payload:null,i=this._createHeader(h,r instanceof FormData?r:null),a=new AbortController,s=a.signal,this._abortControl.set(h.requestId,a),a=Date.now(),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(n,{method:t,body:r,headers:i,signal:s})];case 2:return[4,(o=e.sent()).json()];case 3:if(c=e.sent(),o.ok||o.redirected)return this._logger.debug("receive api response",h.requestId),this._statLogApiResult(h,a,null),[2,new v(this._iid,c)];throw c?(u=new p(c)).isSessionKeyExpiredError&&this._dispatcher.dispatch(new ly):u=p.requestFailed,this._statLogApiResult(h,a,u),u;case 4:throw c=e.sent(),this._statLogApiResult(h,a,c),c instanceof p?(this._logger.debug("fail api request",c),c):"AbortError"===c.name?p.requestCanceled:(l=p.networkError,this._logger.debug("fail api request",l),l);case 5:return[2]}})})},Dy.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},Dy.prototype.cancelAll=function(){var e,t;try{for(var n=se(this._abortControl.values()),r=n.next();!r.done;r=n.next())r.value.abort()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},Dy),wy=(s(Ry,by=F_),Ry.createFromRawMessage=function(e,t){var n=t.substring(0,4),r=null;try{r=JSON.parse(t.substring(4))}catch(e){n="NOOP"}finally{return new Ry(e,n,r)}},Ry.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},Ry.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},Ry),Sy=(s(Oy,Ey=F_),Oy.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},Oy),Cy=(s(Ay,gy=Sy),Ay),ky=(Object.defineProperty(Ny.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),Ny.prototype.ping=function(){var e,t=this,n=new Cy;try{var r=null!=(e=this.sdkState.websocket.pongTimeout)?e:5e3;this._pingTimeoutTimer=setTimeout(function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)},r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n},Ny.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},Ny.prototype.refreshTimer=function(){var e=this,t=(this._logger.debug("pinger.refreshTimer()"),null!=(t=this.sdkState.websocket.pingInterval)?t:15e3);this.stop(),this._pingTimer=setInterval(function(){e.ping()},t)},Ny.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},Ny.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},Ny);function Ny(e){var t=e.pingDelegate,n=e.sdkState,e=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=e}function Ay(){return gy.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}function Oy(e){var t=e.code,n=e.ackRequired,e=e.payload,e=void 0===e?null:e,r=this;return(r=Ey.call(this)||this).code=t,r.payload=e,r.requestId=null!=(t=r.payload.req_id)?t:U_(),r.ackRequired=n,r.payload.req_id=r.requestId,r}function Ry(e,t,n,r){void 0===r&&(r="");var i=this;return(i=by.call(this)||this)._iid=e,i.code=t,i.payload=n,i.requestId=n?null!=(e=n.req_id)?e:r:"",i}function Dy(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,s=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on(function(e){e instanceof cy&&s.cancel(e.requestId)}),this._logger=t}function My(e){var t=e.type,n=e.data,e=e.ts,e=void 0===e?Date.now():e;this.type=t,this.createdAt=e,this.data=n}(er=my=my||{}).CONNECTING="CONNECTING",er.OPEN="OPEN",er.CLOSED="CLOSED";function xy(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}s(Vy,Uy=Y_),Object.defineProperty(Vy.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return my.CONNECTING;case 1:return my.OPEN}return my.CLOSED},enumerable:!1,configurable:!0}),Vy.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach(function(e){e&&l("string",e)&&(e=wy.createFromRawMessage(t._iid,e),t._logger.debug("receive websocket event",e),"LOGI"===e.code?(e.payload&&!e.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",e)):"PONG"===e.code?t._pinger&&t._pinger.pong():"EXPR"===e.code?e.payload&&0<e.payload.expires_in&&t._dispatcher.dispatch(new ly):"NOOP"!==e.code&&t.dispatch("message",e))})},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",p.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close")},this.lastActive=Date.now()},Vy.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=yy,this._ws.onmessage=yy,this._ws.onerror=yy,this._ws.onclose=function(){e.dispatch("close")},this._ws.close(),this._ws=null)},Vy.prototype.send=function(e){if(!this._ws)throw p.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},Vy.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e)};var Ly,Py,Uy,Fy=Vy,qy=(s(Gy,Py=F_),Gy),jy=(Hy.prototype._sendApiRequest=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(t)];case 1:return[2,e.sent()]}})})},Hy.prototype._sendWebsocketRequest=function(s){return re(this,void 0,void 0,function(){var n,r,t,i=this;return ie(this,function(e){if(n=new xy,s.ackRequired){r=null,t=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),i._ackStateMap.has(s.requestId)&&(i._ackStateMap.delete(s.requestId),r&&(clearTimeout(r),r=null),e?(i._logger.debug("fail websocket request",e),n.reject(e)):(i._logger.debug("receive websocket ack",s.requestId),n.resolve(t)))};try{r=setTimeout(function(){return t(p.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(s.requestId,{resolve:function(e){return t(null,e)},reject:function(e){return t(e)}}),this.websocketClient.send(s)}catch(e){t(e)}}else try{this.websocketClient.send(s),n.resolve(null)}catch(e){n.reject(e)}return[2,n.promise]})})},Hy.prototype.send=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t instanceof o?[4,this._sendApiRequest(t)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return t instanceof Sy?[4,this._sendWebsocketRequest(t)]:[3,4];case 4:throw p.invalidParameters}})})},Hy.prototype.cancel=function(e){this.apiClient.cancel(e)},Hy.prototype.cancelAll=function(){this.apiClient.cancelAll()},Hy);function Hy(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,s=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=t,this.apiClient=new Ty(e,{auth:n,sdkState:r,dispatcher:i,logger:t}),this.websocketClient=new Fy(e,{sdkState:r,dispatcher:i,logger:t}),this.websocketClient.on("message",function(e){var t;e.payload.unread_cnt&&s._dispatcher.dispatch(new qy(e.payload.unread_cnt)),e.requestId?s._ackStateMap.has(e.requestId)&&(t=s._ackStateMap.get(e.requestId),"EROR"!==e.code?t.resolve(e):t.reject(new p({code:e.payload.code,message:e.payload.message}))):s._dispatcher.dispatch(e)}).on("close",function(){s._ackStateMap.forEach(function(e){e.reject(p.connectionClosed)}),s._ackStateMap.clear()})}function Gy(e){var t=e.all,n=e.custom_types,e=e.ts,r=Py.call(this)||this;return r.all=t,r.customTypes=n,r.ts=e,r}function Vy(e,t){var n=t.sdkState,r=t.dispatcher,t=t.logger,i=Uy.call(this)||this;return i._pinger=null,i.lastActive=0,i._iid=e,i._sdkState=n,i._dispatcher=r,i._logger=t,i._sdkState.websocket.pingerDisabled||(i._pinger=new ky({pingDelegate:{send:function(e){return i.send(e)},error:function(e){return i.error(e)}},sdkState:i._sdkState,logger:t})),i}(mr=Ly=Ly||{})[mr.NONE=0]="NONE",mr[mr.INITIALIZED=1]="INITIALIZED",mr[mr.CONNECTING=2]="CONNECTING",mr[mr.CONNECTED=3]="CONNECTED",mr[mr.RECONNECTING=4]="RECONNECTING",mr[mr.DISCONNECTED=5]="DISCONNECTED",mr[mr.LOGOUT=6]="LOGOUT";function By(t){return re(void 0,void 0,void 0,function(){return ie(this,function(e){return[2,new Promise(function(e){return setTimeout(e,t)})]})})}function Ky(a,o,u){return void 0===u&&(u=new wm),re(void 0,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:t=0,n=null,r=function(e){return n=null!=(e=void 0===e?null:e)?e:new Error("Halted")},i=function(){t=0},e.label=1;case 1:if(!(-1===o||t<o))return[3,9];e.label=2;case 2:return e.trys.push([2,4,,8]),[4,a(r,i)];case 3:if(s=e.sent(),n)throw n;return[2,s];case 4:if(s=e.sent(),n)return[3,6];if(++t===o)throw s;return[4,By(u.calcTimeout(t))];case 5:return e.sent(),[3,7];case 6:throw n;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})}function ae(n){re(void 0,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:if((t=e.sent())instanceof p)return t.throwOutside(),[3,3];throw t;case 3:return[2]}})})}function Qy(e,t){return null!==(t=void 0===t?null:t)&&Dm.set(e,t),null!=(t=Dm.get(e))?t:""}function zy(e){this.emojiHash=(e=void 0===e?{}:e).emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[]}s(og,vm=F_);var Wy,Yy,Xy,Jy,Zy,$y,em,tm,nm,rm,im,sm,am,om,um,cm,lm,hm,dm,fm,pm,vm,_m,ym=og,mm=(Object.defineProperty(ag.prototype,"isReady",{get:function(){return this._currentConnectionStateType===Ly.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(ag.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===Ly.CONNECTING||this._currentConnectionStateType===Ly.RECONNECTING},enumerable:!1,configurable:!0}),ag.prototype.send=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return i instanceof Sy?this.isReady?(this._logger.debug("send websocket request",i),[4,this.commandRouter.send(i)]):[3,2]:[3,4];case 1:case 5:return[2,e.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",i),t=new xy,this._lazyCallQueue.push({command:i,deferred:t,timeout:setTimeout(function(){return r.timeout(i.requestId)},1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),p.connectionRequired;case 3:return[3,7];case 4:return i instanceof o?this._auth.hasSession?(this._logger.debug("send api request",i),[4,this.commandRouter.send(i)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",i),t=new xy,this._lazyCallQueue.push({command:i,deferred:t,timeout:setTimeout(function(){return r.timeout(i.requestId)},1e4)}),[2,t.promise];throw n=p.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}})})},ag.prototype.forceSend=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._logger.debug("send websocket request (forced)",t),[4,this.commandRouter.send(t)];case 1:return[2,e.sent()]}})})},ag.prototype.timeout=function(t){this._logger.debug("timeout request",t);var e=this._lazyCallQueue.findIndex(function(e){return e.command.requestId===t});-1<e&&(this._lazyCallQueue[e].deferred.reject(p.connectionRequired),this._lazyCallQueue.splice(e,1))},ag.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},ag.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},ag),gm=(s(sg,pm=o),sg),Em=(s(ig,fm=Sy),ig),bm=(s(rg,dm=v),rg),Im=(s(ng,hm=wy),ng),Tm=(s(tg,lm=F_),tg),wm=(eg.prototype.calcTimeout=function(){return 0},eg),Sm=($m.prototype.createRefreshWebsocketCommand=function(e){return new Em({authToken:e,expiringSession:!0})},$m.prototype._refreshSessionKey=function(a,o){return re(this,void 0,void 0,function(){var t,n,r,i,s=this;return ie(this,function(e){switch(e.label){case 0:if(this._currentConnectionStateType!==Ly.CONNECTED)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this.createRefreshWebsocketCommand(a),[4,this._requestQueue.forceSend(t)];case 2:if(t=e.sent(),r=t.as(Im),n=r.newKey,r=r.error)throw r;return this.auth.sessionKey=null!=n?n:this.auth.sessionKey,this._logger.debug("session refreshed"),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2];case 3:if(r=e.sent(),D_(r))throw r;return r.isSessionTokenExpiredError?(this._handleError(o),[2]):[3,4];case 4:return e.trys.push([4,6,,7]),i=new gm({userId:this._sdkState.userId,authToken:a,expiringSession:!0}),[4,Ky(function(n){return re(s,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(i)];case 1:return t=e.sent(),t=t.as(bm).key,this.auth.sessionKey=t,[3,3];case 2:throw(t=e.sent()).isSessionTokenExpiredError&&n(p.sessionTokenRefreshFailed),t;case 3:return[2]}})})},3)];case 5:return e.sent(),this._logger.debug("session refreshed"),[3,7];case 6:return e.sent(),this._handleError(o),[2];case 7:return ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2]}})})},$m.prototype._handleError=function(e){var t=this,n=p.sessionTokenRefreshFailed;ae(function(){return re(t,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionError(n),[2]})})}),e&&e.reject(n)},$m.prototype.refresh=function(){return re(this,void 0,void 0,function(){var n,t,r,i=this;return ie(this,function(e){return this.handler?(n=new xy,t=function(e){e?(i._logger.debug("session refreshing.."),i.auth.authToken=e,i._refreshSessionKey(e,n)):(i._logger.debug("session closed"),ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionClosed(),[2]})})}),n.resolve())},r=function(){i._dispatcher.dispatch(new Tm);var t=p.sessionTokenRequestFailed;i.handler&&(ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionError(t),[2]})})}),n.reject(t))},this._logger.debug("session expired"),this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,n):ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionTokenRequired(t,r),[2]})})}),[2,n.promise]):[2]})})},$m),Qa=(Zm.prototype.run=function(e){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},Zm.prototype.onConnect=function(e,t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},Zm.prototype.onReconnect=function(e,t){return t.resetReconnectCount,re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},Zm.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},Zm.prototype.onLogout=function(e){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},Zm),Cm=(s(Jm,cm=Qa),Jm.prototype.run=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return t=r.sdkState.userId,r.logout(),ae(function(){return re(n,void 0,void 0,function(){return ie(this,function(e){return r.connectionHandlers.forEach(function(e){e.onDisconnected(t)}),[2]})})}),[4,r.changeState(new Rm)];case 1:return e.sent(),[2]}})})},Jm),km=(s(Xm,um=Qa),Xm.prototype.run=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),this._autoReconnect?[4,t.changeState(new Nm)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Xm.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new Om({authToken:n}))];case 1:return e.sent(),[2]}})})},Xm.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Nm)];case 1:return e.sent(),[2]}})})},Xm.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Cm)];case 1:return e.sent(),[2]}})})},Xm),Nm=(s(Ym,om=Qa),Ym.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},Ym.prototype.run=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s=this;return ie(this,function(e){switch(e.label){case 0:t=new xy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectStarted()}),[2]})})}),e.label=1;case 1:return e.trys.push([1,4,,9]),r=a.sdkState.websocket,n=r.reconnectMaxRetry,r=r.reconnectRetryStrategy,[4,Ky(function(n,r){return re(s,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this._haltConnect=n,this._resetConnect=r,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.connect()];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof p&&t.code===d.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},n,r)];case 2:return e.sent(),[4,a.changeState(new Am)];case 3:return e.sent(),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectSucceeded()}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return i=e.sent(),D_(i)?[3,7]:!(i instanceof p)||i.code===d.CONNECTION_CANCELED?[3,6]:[4,a.changeState(new km({autoReconnect:!1}))];case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectFailed()}),this.flushCallbacks(i),[2]})})}),[3,8];case 7:throw i;case 8:return[3,9];case 9:return[2,t.promise]}})})},Ym.prototype.onConnect=function(n,e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new xy,this._resetConnect&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},Ym.prototype.onReconnect=function(n,e){var e=e.resetReconnectCount,r=void 0!==e&&e;return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new xy,this._resetConnect&&r&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},Ym.prototype.onDisconnect=function(t,e){var n=e.error,r=void 0===n?null:n,n=e.autoReconnect,i=void 0===n||n;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=r?r:p.connectionCanceled),[4,t.changeState(new km({autoReconnect:i}))];case 1:return e.sent(),[2]}})})},Ym.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,t.changeState(new Cm)];case 1:return e.sent(),[2]}})})},Ym),Am=(s(Wm,am=Qa),Wm.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new Nm)];case 1:return e.sent(),[2]}})})},Wm.prototype.onDisconnect=function(t,e){var n=e.autoReconnect;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new km({autoReconnect:n}))];case 1:return e.sent(),[2]}})})},Wm.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Cm)];case 1:return e.sent(),[2]}})})},Wm),Om=(s(zm,sm=Qa),zm.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},zm.prototype.run=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:t=new xy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),e.label=1;case 1:return e.trys.push([1,4,,9]),[4,Ky(function(n){return re(r,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this._haltConnect=n,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i.connect(this._authToken)];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof p&&t.code===d.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},i.sdkState.websocket.connectMaxRetry)];case 2:return e.sent(),[4,i.changeState(new Am)];case 3:return e.sent(),ae(function(){return re(r,void 0,void 0,function(){return ie(this,function(e){return i.connectionHandlers.forEach(function(e){e.onConnected(i.sdkState.userId)}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return n=e.sent(),D_(n)?[3,7]:(i.disconnect(),!(n instanceof p)||n.code===d.CONNECTION_CANCELED?[3,6]:[4,i.changeState(new Rm)]);case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(r,void 0,void 0,function(){return ie(this,function(e){return this.flushCallbacks(n),[2]})})}),[3,8];case 7:throw n;case 8:return[3,9];case 9:return[2,t.promise]}})})},zm.prototype.onConnect=function(e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new xy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},zm.prototype.onDisconnect=function(t,e){var e=e.error,n=void 0===e?null:e;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=n?n:p.connectionCanceled),[4,t.changeState(new Cm)];case 1:return e.sent(),[2]}})})},zm.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,t.changeState(new Cm)];case 1:return e.sent(),[2]}})})},zm),Rm=(s(Qm,im=Qa),Qm.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Om({authToken:n}))];case 1:return e.sent(),[2]}})})},Qm),Dm=new Map,yo=(Km.payloadify=function(e){return e?{}:null},Km),Mm="/".concat("v3","/users"),xm="/".concat("v3","/storage/file"),Lm="/".concat("v3","/group_channels"),Pm="/".concat("v3","/open_channels"),Um="/".concat("v3","/sdk/open_channels"),Fm="/".concat("v3","/search"),qm="/".concat("v3","/report"),jm="/".concat("v3","/emojis"),Hm="/".concat("v3","/emoji_categories"),Gm="/".concat("v3","/sdk/statistics"),Vm=(s(Bm,rm=o),Bm);function Bm(e){var t=e.userId,e=e.metadata,n=rm.call(this)||this;return n.method=S.POST,n.path="".concat(Mm,"/").concat(t,"/metadata"),n.params={metadata:e},n}function Km(e){this._iid="",this._iid=e}function Qm(){var e=null!==im&&im.apply(this,arguments)||this;return e.type=Ly.INITIALIZED,e.name="initialized",e}function zm(e){var e=e.authToken,t=sm.call(this)||this;return t.type=Ly.CONNECTING,t.name="connecting",t._authToken="",t._haltConnect=null,t._callbacks=[],t._authToken=e,t}function Wm(){var e=null!==am&&am.apply(this,arguments)||this;return e.type=Ly.CONNECTED,e.name="connected",e}function Ym(){var e=null!==om&&om.apply(this,arguments)||this;return e.type=Ly.RECONNECTING,e.name="reconnecting",e._haltConnect=null,e._resetConnect=null,e._callbacks=[],e}function Xm(e){var e=e.autoReconnect,t=um.call(this)||this;return t.type=Ly.DISCONNECTED,t.name="disconnected",t._autoReconnect=!1,t._autoReconnect=e,t}function Jm(){var e=null!==cm&&cm.apply(this,arguments)||this;return e.type=Ly.LOGOUT,e.name="logout",e}function Zm(){this.type=Ly.NONE,this.name="none"}function $m(e){var t=e.auth,n=e.sdkState,r=e.dispatcher,i=e.requestQueue,e=e.logger,s=this;this._currentConnectionStateType=Ly.INITIALIZED,this.auth=t,this._sdkState=n,this._dispatcher=r,this._requestQueue=i,this._logger=e,this._dispatcher.on(function(e){var t;e instanceof ym?(t=e.stateType,s._currentConnectionStateType=t):e instanceof ly&&s.refresh()})}function eg(){}function tg(){return null!==lm&&lm.apply(this,arguments)||this}function ng(e,t,n){e=hm.call(this,e,"LOGI",n)||this;return e.error=null,e.newKey=n.new_key,e.error=n.error?new p(n.error):null,e}function rg(e,t){e=dm.call(this,e,t)||this,t=t.key;return e.key=t,e}function ig(e){var t=e.authToken,e=e.expiringSession;return fm.call(this,{code:"LOGI",payload:{token:t,expiring_session:void 0===e||e?1:0},ackRequired:!0})||this}function sg(e){var t=e.userId,n=e.authToken,e=e.expiringSession,e=void 0===e||e,r=pm.call(this)||this;return r.path="/users/".concat(t,"/session_key"),r.method=S.POST,r.params={token:n,expiring_session:!!e},r.requireAuth=!1,r}function ag(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,a=this;this._currentConnectionStateType=Ly.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new jy(e,{auth:n,sdkState:r,dispatcher:i,logger:t}),this._auth=n,this._logger=t,this._dispatcher=i,this._dispatcher.on(function(e){if(e instanceof ym){e=e.stateType;switch(a._currentConnectionStateType=e){case Ly.CONNECTED:var t=a._lazyCallQueue;a._lazyCallQueue=[],t.forEach(function(s){return re(a,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:t=s.command,n=s.deferred,r=s.timeout,clearTimeout(r),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.send(t)];case 2:return r=e.sent(),n.resolve(r),[3,4];case 3:return i=e.sent(),n.reject(i),[3,4];case 4:return[2]}})})});break;case Ly.INITIALIZED:case Ly.DISCONNECTED:case Ly.LOGOUT:t=a._lazyCallQueue,a._lazyCallQueue=[],t.forEach(function(r){return re(a,void 0,void 0,function(){var t,n;return ie(this,function(e){return t=r.deferred,n=r.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(p.connectionClosed):t.reject(p.connectionRequired),[2]})})})}}})}function og(e){var e=e.stateType,t=vm.call(this)||this;return t.stateType=e,t}s(function(e,t){return(e=_m.call(this,e,t)||this).metadata=t,e},_m=v),(ht=Wy=Wy||{}).BASE="base",ht.GROUP="group",ht.OPEN="open",(Oi=Yy=Yy||{}).OPERATOR="operator",Oi.NONE="none",(Ri=Xy=Xy||{}).BASE="base",Ri.USER="user",Ri.FILE="file",Ri.ADMIN="admin",(pr=Jy=Jy||{}).ALL="",pr.USER="MESG",pr.FILE="FILE",pr.ADMIN="ADMM",(Cr=Zy=Zy||{}).USER="MESG",Cr.FILE="FILE",Cr.ADMIN="ADMM",(Di=$y=$y||{}).USERS="users",Di.CHANNEL="channel",(gr=em=em||{}).ALL="all",gr.NONE="none",gr.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",(ut=tm=tm||{}).DEFAULT="default",ut.SUPPRESS="suppress",(Tn=nm=nm||{}).PENDING="pending",Tn.SCHEDULED="scheduled",Tn.SUCCEEDED="succeeded",Tn.FAILED="failed",Tn.CANCELED="canceled";function ug(e){switch(e){case Wy.GROUP:return Lm;case Wy.OPEN:return Pm;default:return null}}function cg(e){switch(e){case Wy.GROUP:return"".concat(qm,"/group_channels");case Wy.OPEN:return"".concat(qm,"/open_channels");default:return null}}function lg(e,t,n){return e=yg(e.mentionType,e.mentionedUserIds,n),t=yg(t.mentionType,t.mentionedUserIds,n),!e&&t?1:e&&!t?-1:0}var hg,dg,fg,pg,vg,_g,yg=function(e,t,n){var r,i;switch(e){case $y.CHANNEL:return!0;case $y.USERS:if(t)try{for(var s=se(t),a=s.next();!a.done;a=s.next())if(a.value===n)return!0}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},mg=(s(kg,vg=o),kg),gg=(s(Cg,pg=v),Cg),Eg=(s(Sg,fg=o),Sg),bg=(s(wg,dg=v),wg),Ig=(s(Tg,hg=o),Tg);function Tg(e){var t=e.userId,e=e.metadataKey,n=hg.call(this)||this;return n.method=S.DELETE,n.path="".concat(Mm,"/").concat(t,"/metadata/").concat(e),n}function wg(e,t){e=dg.call(this,e,t)||this;return e.metadata=t,e}function Sg(e){var t=e.userId,n=e.metadata,e=e.upsert,r=fg.call(this)||this;return r.method=S.PUT,r.path="".concat(Mm,"/").concat(t,"/metadata"),r.params={metadata:n,upsert:e},r}function Cg(e,t){e=pg.call(this,e,t)||this;return e.metaData=null!=t?t:{},e}function kg(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metadata;return(t=vg.call(this)||this).method=S.POST,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:e,include_ts:!0},t}s(function(){return null!==_g&&_g.apply(this,arguments)||this},_g=v);s(Rg,Ng=o);var Ng,Ag,Og=Rg;function Rg(e){var e=e.userId,t=Ng.call(this)||this;return t.method=S.DELETE,t.path="".concat(Mm,"/").concat(e,"/metadata"),t}s(function(){return null!==Ag&&Ag.apply(this,arguments)||this},Ag=v);function Dg(e,t){return void 0===t&&(t=null),(e=JSON.parse(JSON.stringify(e)))._iid&&delete e._iid,t&&t(e),e}function Mg(e,t){return void 0===t&&(t=null),e=JSON.parse(JSON.stringify(e)),t&&t(e),e}function C(t){return{do:function(e){t||e()},throw:function(e){if(!t)throw e}}}var xg;(We=xg=xg||{}).ONLINE="online",We.OFFLINE="offline",We.NON_AVAILABLE="nonavailable";s(nE,Hg=yo),nE.payloadify=function(e){return e?w(f(f({},Hg.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null},Object.defineProperty(nE.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(Qy(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),nE.prototype.serialize=function(){return Dg(this)},nE.prototype._isValidMetaData=function(t){return!Array.isArray(t)&&0<Object.keys(t).length&&Object.keys(t).map(function(e){return t[e]}).every(function(e){return l("string",e)})},nE.prototype._applyMetaData=function(t,n){var r=this;void 0===n&&(n=!1),Object.keys(t).forEach(function(e){n?delete r.metaData[e]:r.metaData[e]=t[e]})},nE.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(this._isValidMetaData(r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Vm({userId:n.userId,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(gg).metaData,this._applyMetaData(n),[2,this.metaData]}})})},nE.prototype.updateMetaData=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(this._isValidMetaData(r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Eg({userId:n.userId,metadata:r,upsert:i}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(bg).metadata,this._applyMetaData(n),[2,this.metaData]}})})},nE.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)).throw(p.invalidParameters),n=k.of(this._iid),t=n.sdkState,n=n.requestQueue,t=new Ig({userId:t.userId,metadataKey:r}),[4,n.send(t)];case 1:return e.sent(),this._applyMetaData(((n={})[r]=!0,n),!0),[2,this.metaData]}})})},nE.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Og({userId:n.userId}),[4,t.send(n)];case 1:return e.sent(),this.metaData={},[2]}})})};var Lg,Pg,Ug,Fg,qg,jg,Hg,u=nE,Gg=(s(tE,jg=F_),tE),Vg=(eE.payloadify=function(e){return f(f({},u.payloadify(e.user)),{emoji_hash:e.appInfo.emojiHash,file_upload_size_limit:e.appInfo.uploadSizeLimit,application_attributes:e.appInfo.applicationAttributes,premium_feature_list:e.appInfo.premiumFeatureList,login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},eE.prototype.apply=function(){var t=this.reconnectInterval,n=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,e=k.of(this._iid);e.sdkState.websocket.pingInterval=1e3*this.pingInterval,e.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,e.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,e.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(e){return 0<e?1e3*Math.min(t*Math.pow(r,e-1),n):10}},e.appInfo=this.appInfo,e.sessionManager.currentUser=this.user,e.connectedAt=this.connectedAt,this.firstConnectedAt||(e.firstConnectedAt=this.connectedAt),e.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,e.concurrentCallLimit=this.concurrentCallLimit,e.backOffDelay=this.backOffDelay,e.dispatcher.dispatch(new Gg({userProfile:this}))},eE),Bg=(s($g,qg=wy),$g.asError=function(e){return new $g(null,"LOGI",f({user_id:null,error:!0},e))},$g.prototype.applyTo=function(e){if(this.error)throw this.error;var t=k.of(e);if(!t)throw p.lostInstance;t.sessionManager.auth.sessionKey=this.key,Qy(e,this.ekey),this.userProfile.apply()},$g),Kg=(s(Zg,Fg=F_),Zg),Qg=(s(Jg,Ug=Y_),Object.defineProperty(Jg.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Jg.prototype.changeState=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._currentState=t,this._dispatcher.dispatch(new ym({stateType:t.type})),this._logger.debug("connection state changes to ".concat(t.name)),[4,this._currentState.run(this)];case 1:return e.sent(),[2]}})})},Jg.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,i=t.userId,t=t.extensions,s=this._sessionManager.auth,a=t.sb_syncmanager?"s".concat(t.sb_syncmanager):"",t=t.sb_uikit?"u".concat(t.sb_uikit):"",a="JS/c".concat(O_.SDK_VERSION,"/").concat(a,"/").concat(t);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(O_.OS_VERSION),"&sv=").concat(encodeURIComponent(O_.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(s.hasSession?"&key=".concat(encodeURIComponent(s.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(a,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=1")},Jg.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new Kg(e))},Jg.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new hy(new Iy({type:ry.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},Jg.prototype.connect=function(i){return void 0===i&&(i=""),re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){return t=this._url(i),n=new xy,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){r._loginTimer=null,r._dispatcher.dispatch(Bg.asError(p.loginTimeout))},this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]})})},Jg.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(Bg.asError(p.connectionRenew))},Jg.prototype.disconnect=function(){this._websocketClient.disconnect()},Jg.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()},Jg),zg=(Object.defineProperty(Xg.prototype,"isConnected",{get:function(){return this._context.currentState.type===Ly.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(Xg.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===Ly.CONNECTING||e.type===Ly.RECONNECTING},enumerable:!1,configurable:!0}),Xg.prototype.connect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onConnect(this._context,t)];case 1:return e.sent(),[2]}})})},Xg.prototype.reconnect=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},Xg.prototype.resetAndReconnect=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},Xg.prototype.background=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}})})},Xg.prototype.disconnect=function(t){return void 0===t&&(t=null),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:t,autoReconnect:!0})];case 1:return e.sent(),[2]}})})},Xg.prototype.logout=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}})})},Xg),Wg=(s(Yg,Pg=o),Yg);function Yg(e){var t=e.deviceId,e=e.statLogs,n=Pg.call(this)||this;return n.method=S.POST,n.path="".concat(Gm),n.params={device_id:t,log_entries:e.map(function(e){return Iy.payloadify(e)})},n}function Xg(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.disableAutoReconnect,t=void 0!==t&&t,u=this;this._context=null,this._logger=o,this._context=new Qg(e,{sdkState:n,connectionHandlers:r,sessionManager:i,websocketClient:s,dispatcher:a,logger:o}),t||s.on("close",function(){"foreground"===n.appState&&setTimeout(function(){u._logger.debug("try reconnect by websocket connection closed"),u.reconnect()},100)})}function Jg(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.entryState,t=void 0===t?new Rm:t,u=Ug.call(this)||this;return u._currentState=null,u._loginTimer=null,u._connectingAt=0,u._connectionRequestQueue=[],u._iid=e,u.sdkState=n,u.connectionHandlers=r,u._sessionManager=i,u._websocketClient=s,u._dispatcher=a,u._logger=o,u._currentState=t,u._websocketClient.on("message",function(e){var t;"LOGI"===e.code&&(u._loginTimer&&(clearTimeout(u._loginTimer),u._loginTimer=null),(t=e.as(Bg)).error?(t.error.isSessionKeyExpiredError&&u._dispatcher.dispatch(new ly),u._connectionRequestQueue.forEach(function(e){return e.reject(t.error)}),u._statLogConnection(t.error)):(t.applyTo(u._iid),u._connectionRequestQueue.forEach(function(e){return e.resolve()}),e=t.userProfile,u._enableStatLog(e.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),u._statLogConnection(null)),u._connectionRequestQueue=[])}).on("close",function(){0<u._connectionRequestQueue.length&&(u._connectionRequestQueue.forEach(function(e){return e.reject(p.networkError)}),u._connectionRequestQueue=[],u._statLogConnection(p.networkError))}),u}function Zg(e){var t=Fg.call(this)||this;return t.enabled=e,t}function $g(e,t,n){var r=this;return(r=qg.call(this,e,t,n)||this).error=null,r.userProfile=new Vg(e,n),r.key=n.key,r.ekey=null!=(t=n.ekey)?t:"",r.error=n.error?new p(n):null,r}function eE(e,t){this._iid=e,this.appInfo=new zy(t),this.user=new u(e,t),this.connectedAt=1e3*(null!=(e=t.login_ts)?e:0),this.firstConnectedAt=0,this.pingInterval=null!=(e=t.ping_interval)?e:15e3,this.pongTimeout=null!=(e=t.pong_timeout)?e:5e3,this.reconnectInterval=null!=(e=null==(e=t.reconnect)?void 0:e.interval)?e:3e3,this.reconnectMaxInterval=null!=(e=null==(e=t.reconnect)?void 0:e.max_interval)?e:6e4,this.reconnectRetryCount=null!=(e=null==(e=t.reconnect)?void 0:e.retry_cnt)?e:5,this.reconnectIntervalMultiple=null!=(e=null==(e=t.reconnect)?void 0:e.mul)?e:2,this.maxUnreadCountOnSuperGroup=null!=(e=t.max_unread_cnt_on_super_group)?e:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!=(e=t.concurrent_call_limit)?e:5,this.backOffDelay=null!=(e=t.back_off_delay)?e:100}function tE(e){var e=e.userProfile,t=jg.call(this)||this;return t.userProfile=e,t}function nE(e,t){var n=this;return(n=Hg.call(this,e)||this).userId=null!=(e=null!=(e=t.guest_id)?e:t.user_id)?e:"",n.nickname=null!=(e=null!=(e=t.nickname)?e:t.name)?e:"",n.plainProfileUrl=null!=(e=null!=(e=t.profile_url)?e:t.image)?e:"",n.requireAuth=null!=(e=t.require_auth_for_profile_image)&&e,n.metaData=null!=(e=t.metadata)?e:{},n.connectionStatus=xg.NON_AVAILABLE,G_(xg,t.is_online)?n.connectionStatus=t.is_online:l("boolean",t.is_online)&&(n.connectionStatus=t.is_online?xg.ONLINE:xg.OFFLINE),n.isActive=null==(e=t.is_active)||e,n.lastSeenAt=null!=(e=t.last_seen_at)?e:null,n.preferredLanguages=t.preferred_languages?A_([],N_(t.preferred_languages),!1):null,n.friendDiscoveryKey=null!=(e=t.friend_discovery_key)?e:null,n.friendName=null!=(e=t.friend_name)?e:null,n}(Ot=Lg=Lg||{})[Ot.PENDING=0]="PENDING",Ot[Ot.ENABLED=1]="ENABLED",Ot[Ot.DISABLED=2]="DISABLED";Object.defineProperty(sE.prototype,"isEnabled",{get:function(){return this.enabledstate===Lg.ENABLED},enumerable:!1,configurable:!0}),sE.prototype._save=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map(function(e){return Iy.payloadify(e)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},sE.prototype._flush=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(!this.isEnabled)return[3,7];if(this.isFlushing)return[3,7];this.isFlushing=!0,e.label=1;case 1:return e.trys.push([1,5,6,7]),0<(t=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length?(n=new Wg({deviceId:this.deviceId,statLogs:t}),[4,this.requestQueue.send(n)]):[3,4];case 2:return e.sent(),this.queue=this.queue.slice(t.length),[4,this._save()];case 3:e.sent(),e.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return e.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return[2]}})})},sE.prototype.init=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.key=r,this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.get(this.key)]:[3,4];case 1:return(t=e.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map(function(e){return new Iy({type:e.stat_type,ts:e.ts,data:e.data})}),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,108e5<=Date.now()-this.lastFlushedAt&&this.queue.length>=this.minLimit?(t=Math.min(Math.floor(18e4*Math.random()),100),[4,By(t)]):[3,4]):[3,4];case 2:return e.sent(),[4,this._flush()];case 3:e.sent(),e.label=4;case 4:return this.dispatcher.on(function(e){var t;e instanceof hy?(t=e.statLog,n.put(t)):e instanceof Kg&&(n.enabledstate=e.enabled?Lg.ENABLED:Lg.DISABLED,n.isEnabled?n.queue.length>=n.limit&&n._flush():n.clear())}),[2]}})})},sE.prototype.put=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.enabledstate===Lg.DISABLED?[3,3]:(this.queue.push(t),[4,this._save()]);case 1:return e.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},sE.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})};var rE,iE=sE;function sE(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,i=e.baseLimit,i=void 0===i?100:i,s=e.maxLimit,s=void 0===s?1e3:s,e=e.minLimit,e=void 0===e?10:e;this.queue=[],this.enabledstate=Lg.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=U_(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=i,this.limit=i,this.maxLimit=s,this.minLimit=e}(lt=rE=rE||{})[lt.NONE=0]="NONE",lt[lt.VERBOSE=1]="VERBOSE",lt[lt.DEBUG=2]="DEBUG",lt[lt.INFO=3]="INFO",lt[lt.WARN=4]="WARN",lt[lt.ERROR=5]="ERROR";EE.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=rE.VERBOSE&&console.log.apply(console,A_(["[verbose]"],N_(e),!1))},EE.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=rE.DEBUG&&console.log.apply(console,A_(["[debug]"],N_(e),!1))},EE.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=rE.INFO&&console.log.apply(console,A_(["[info]"],N_(e),!1))},EE.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=rE.WARN&&console.warn.apply(console,A_(["[warn]"],N_(e),!1))},EE.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=rE.ERROR&&console.error.apply(console,A_(["[error]"],N_(e),!1))};var aE,oE,uE,cE,lE=EE,hE={},k=(gE.of=function(e){if(hE[e])return hE[e];throw p.lostInstance},gE),Sr=(mE.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,t=(t.onlineDetector,t.cacheContext),t=void 0===t?null:t;this._iid=e,this._cacheContext=t,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=s,this._logger=a},mE),dE=(s(yE,cE=o),yE),fE=(s(_E,uE=v),_E),pE=(s(vE,oE=yo),vE.payloadify=function(e){return e?w(f(f({},oE.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(e){return u.payloadify(e)}):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null},vE);function vE(e,t){var n=this;return(n=oE.call(this,e)||this).replyCount=0,n.mostRepliedUsers=null,n.lastRepliedAt=0,n.updatedAt=0,n.replyCount=null!=(e=t.reply_count)?e:0,n.mostRepliedUsers=t.hasOwnProperty("most_replies")&&h("object",t.most_replies)?t.most_replies.map(function(e){return new u(n._iid,e)}):[],n.lastRepliedAt=null!=(e=t.last_replied_at)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,n}function _E(e,t){var n=this;return(n=uE.call(this,e,t)||this).url=t.url,n.fileSize=null!=(e=t.file_size)?e:0,n.thumbnailSizes=null!=(e=t.thumbnails)?e:[],n.requireAuth=null!=(e=t.require_auth)&&e,n}function yE(e){var t=cE.call(this)||this;if(t.method=S.POST,t.path="".concat(xm),t.params=w({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var n=0;n<e.thumbnailSizes.length;n++){var r=e.thumbnailSizes[n],i=r.maxWidth,r=r.maxHeight;t.params["thumbnail".concat(n+1)]="".concat(i,",").concat(r)}return t.requestId=e.requestId,t}function mE(){}function gE(e,t){var n,r,i,s;return this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,hE[e]||(hE[e]=this,n=null!=(n=t.options)?n:new V_,r=this.sdkState={appId:t.appId,appVersion:null!=(r=t.appVersion)?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!=(r=t.apiHost)?r:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!=(r=t.websocketHost)?r:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new wm,responseTimeout:n.websocketResponseTimeout}},this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0},i=this.logger=new lE,this.logger.level=null!=(s=t.logLevel)?s:rE.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new P_({encryption:t.encryption,store:t.store,localCacheEnabled:null!=(s=t.localCacheEnabled)&&s}),this.debugMode=null!=(s=t.debugMode)&&s,this.maxSuperGroupChannelUnreadCount=O_.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=n.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=n.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=n.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null,t=this.dispatcher=new X_,s=new z_,this.requestQueue=new mm(e,{auth:s,sdkState:r,dispatcher:t,logger:i}),this.sessionManager=new Sm({auth:s,sdkState:r,dispatcher:t,requestQueue:this.requestQueue,logger:i}),this.connectionManager=new zg(e,{sdkState:r,connectionHandlers:this.connectionHandlers,dispatcher:t,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,logger:i}),this.statLogCollector=new iE({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:t})),hE[e]}function EE(){this.level=rE.WARN}(e=aE=aE||{}).ADD="add",e.DELETE="delete";function bE(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=l("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,e=e.updated_at;t&&l("string",n)&&l("string",r)&&G_(aE,r)&&l("string",i)&&i&&l("number",e)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=e)}Object.defineProperty(DE.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),DE.payloadify=function(e){return e?w({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},DE.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case aE.ADD:t<0&&this.userIds.push(e.userId);break;case aE.DELETE:0<=t&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}};var IE,TE=DE,wE=(RE.payloadify=function(e){return e?w({key:e.key,value:null!=(e=e.value)?e:[]}):null},RE),SE=(OE.payloadify=function(e){var t;return e?w({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!=(t=e.width)?t:0,height:null!=(t=e.height)?t:0,alt:e.alt}):null},OE),CE=(AE.payloadify=function(e){return e?w({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?SE.payloadify(e.defaultImage):null}):null},AE),kE=(NE.payloadify=function(e){return e?w({name:e.name,volume:e.volume}):null},NE);function NE(e){var t;this.name=null,this.volume=0,this.name=null!=(t=e.name)?t:"default",this.volume=null!=(t=e.volume)?t:1}function AE(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new SE(e["og:image"]))}function OE(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}function RE(e){this.key=e.key,this.value=h("string",e.value)?A_([],N_(e.value),!1):[]}function DE(e){var t,n,r=e.key,i=null!=(i=A_([],N_(e.user_ids),!1))?i:[],s=e.updated_at,a=(l("string",r)&&r&&h("string",i)&&0<i.length&&l("number",s)&&(this.key=r,this.userIds=i,this.updatedAt=s),{});try{for(var o=se(this.userIds),u=o.next();!u.done;u=o.next())a[u.value]=this.updatedAt}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._version=a}(ft=IE=IE||{}).PENDING="pending",ft.IN_QUEUE="in_queue",ft.SENT="sent",ft.FAILED="failed",ft.CANCELED="canceled",ft.REMOVED="removed";function ME(e){return l("number",e.prevResultSize)&&l("number",e.nextResultSize)&&l("boolean",e.isInclusive)&&l("boolean",e.reverse)&&l("string",e.messageTypeFilter)&&G_(Jy,e.messageTypeFilter)&&h("string",e.customTypesFilter,!0)&&h("string",e.senderUserIdsFilter,!0)&&l("boolean",e.includeMetaArray)&&l("boolean",e.includeReactions)&&l("boolean",e.includeParentMessageInfo)}s(y0,BE=yo),y0.payloadify=function(e){var t;return e?w(f(f({},BE.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:function(e){switch(e){case Xy.BASE:return"";case Xy.USER:return"MESG";case Xy.FILE:return"FILE";case Xy.ADMIN:return"ADMM"}}(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null==(t=e.mentionedUsers)?void 0:t.map(function(e){return u.payloadify(e)}),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?pE.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(e){return TE.payloadify(e)}),sorted_metaarray:null==(t=e.metaArrays)?void 0:t.map(function(e){return wE.payloadify(e)}),og_tag:CE.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:kE.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null==(t=e.scheduledInfo)?void 0:t.scheduledMessageId,scheduled_at:null==(t=e.scheduledInfo)?void 0:t.scheduledAt,scheduled_status:e._scheduledStatus})):null},y0.prototype.isIdentical=function(e){return this.messageId===e.messageId},y0.prototype.isEqual=function(e){return M_(this,e)},y0.prototype.isUserMessage=function(){return this.messageType===Xy.USER},y0.prototype.isFileMessage=function(){return this.messageType===Xy.FILE},y0.prototype.isAdminMessage=function(){return this.messageType===Xy.ADMIN},y0.prototype.serialize=function(){return Dg(this)},y0.prototype.getMetaArraysByKeys=function(t){return this.metaArrays.filter(function(e){return t.includes(e.key)})},y0.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},y0.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new TE(TE.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},y0.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1};var xE,LE,PE,UE,FE,qE,jE,HE,GE,VE,BE,KE=y0,QE=(s(_0,VE=u),_0.payloadify=function(e){return e?w(f(f({},VE.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null},_0),zE=(s(v0,GE=KE),v0.payloadify=function(e){return e?w(f(f({},GE.payloadify.call(this,e)),{user:QE.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null},Object.defineProperty(v0.prototype,"isResendable",{get:function(){return this.sendingStatus===nm.FAILED&&0<(e=this.errorCode)&&0<=j_.indexOf(e);var e},enumerable:!1,configurable:!0}),v0.prototype.isIdentical=function(e){return 0<this.messageId&&0<e.messageId?this.messageId===e.messageId:this.reqId===e.reqId},v0),WE=(p0.payloadify=function(e){return e?w({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(p0.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),p0),YE={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Jy.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},XE=(s(f0,HE=KE),f0.payloadify=function(e){return e?w(f(f({},HE.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:$E(e.parentMessage)})):null},f0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},YE),n),C(0<this.messageId&&l("number",t)&&ME(n)).throw(p.invalidParameters),[4,$0.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},f0),JE=(d0.payloadify=function(e){return e?w({type:e.type,vendor:e.vendor,detail:e.detail}):null},d0),ZE=(s(h0,jE=zE),h0.payloadify=function(e){return e?w(f(f({},jE.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(e){return JE.payloadify(e)}),parent_message_info:$E(e.parentMessage)})):null},h0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},YE),n),C(0<this.messageId&&l("number",t)&&ME(n)).throw(p.invalidParameters),[4,$0.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},h0),$E=function(e){if(e)switch(e.messageType){case Xy.USER:return ZE.payloadify(e);case Xy.FILE:return t0.payloadify(e);case Xy.ADMIN:return XE.payloadify(e)}return null},e0=function(e,t){switch(t.type){case"MESG":return new ZE(e,t);case"FILE":return new t0(e,t);case"ADMM":case"BRDM":return new XE(e,t)}return null},t0=(s(l0,qE=zE),l0.payloadify=function(e){return e?w(f(f({},qE.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map(function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:$E(e.parentMessage)})):null},Object.defineProperty(l0.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(Qy(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),l0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},YE),n),C(0<this.messageId&&l("number",t)&&ME(n)).throw(p.invalidParameters),[4,$0.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},l0),n0=(s(c0,FE=Sy),c0),r0=(s(u0,UE=o),u0),i0=(s(o0,PE=wy),o0),s0=(s(a0,LE=v),a0);function a0(e,t){var n,r=this,e=((r=LE.call(this,e,t)||this).message=new t0(e,t),k.of(e).sdkState);return r.isMentioned=yg(r.message.mentionType,null!=(n=r.message.mentionedUserIds)?n:r.message.mentionedUsers.map(function(e){return e.userId}),e.userId),r.forceUpdateLastMessage=null!=(n=t.force_update_last_message)&&n,r}function o0(e,t,n){var r,i=this,e=((i=PE.call(this,e,"FILE",n)||this).message=new t0(e,n),k.of(e).sdkState);return i.isMentioned=yg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function u0(e){var t=this,t=UE.call(this)||this,n=[];return e.mentionType===$y.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),t.method=S.POST,t.path="".concat(ug(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),t.params=w({message_type:Xy.FILE,user_id:e.userId,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:n,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes.map(function(e){return WE.payloadify(e)}),require_auth:e.requireAuth,sorted_metaarray:null==(n=e.metaArrays)?void 0:n.map(function(e){return wE.payloadify(e)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:kE.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,req_id:e.reqId}),t}function c0(e){var t,n=[];return e.mentionType===$y.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),FE.call(this,{code:"FILE",ackRequired:!0,payload:w({channel_url:e.channelUrl,url:e.url,name:null!=(t=e.fileName)?t:"",type:null!=(t=e.mimeType)?t:"",size:null!=(t=e.fileSize)?t:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==tm.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function l0(e,t){var n,r=this,i=((r=qE.call(this,e,t)||this).messageParams=null,r.plainUrl="",r.requireAuth=!1,r.name=null,r.size=0,r.type=null,r.thumbnails=[],r.messageSurvivalSeconds=-1,r.messageType=Xy.FILE,null!=(i=t.file)?i:null);return r.plainUrl=(null!=(n=null!=(n=null==i?void 0:i.url)?n:t.url)?n:"").split("?auth=")[0],r.name=null!=(n=null!=(n=null==i?void 0:i.name)?n:t.name)?n:"File",r.size=null!=(n=null!=(n=null==i?void 0:i.size)?n:t.size)?n:0,r.data=null!=(n=null!=(n=null==i?void 0:i.data)?n:t.custom)?n:"",r.type=i?null!=(n=i.type)?n:"":null!=(i=t.type)?i:"",r.requireAuth=null!=(n=t.require_auth)&&n,r.thumbnails=t.thumbnails?t.thumbnails.map(function(e){return new WE(f(f({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(r.requireAuth?"?auth=".concat(Qy(r._iid)):"")}))}):[],r.messageSurvivalSeconds=null!=(i=t.message_survival_seconds)?i:-1,t.parent_message_info&&(n=t.parent_message_info,i=f(f({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(i=n.file)?void 0:i.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=e0(e,i)),r}function h0(e,t){var n,r,i,s=this;if((s=jE.call(this,e,t)||this).message="",s.messageParams=null,s.translations={},s.translationTargetLanguages=[],s.messageSurvivalSeconds=-1,s.plugins=[],s.message=t.message,s.messageType=Xy.USER,s.translations=null!=(r=t.translations)?r:{},s.translationTargetLanguages=null!=(r=t.target_langs)?r:[],s.translations==={}&&0<s.translationTargetLanguages.length)try{for(var a=se(s.translationTargetLanguages),o=a.next();!o.done;o=a.next()){var u=o.value;s.translations[u]=""}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s.messageSurvivalSeconds=null!=(r=t.message_survival_seconds)?r:-1,s.plugins=t.plugins?t.plugins.map(function(e){return new JE(e)}):[],t.parent_message_info&&(i=t.parent_message_info,t=f(f({},i),{created_at:i.ts,message_id:s.parentMessageId,channel_url:s.channelUrl,channel_type:s.channelType,file:i.file,url:null==(n=i.file)?void 0:n.url,require_auth:null==(r=i.file)?void 0:r.require_auth}),s.parentMessage=e0(e,w(t))),s}function d0(e){var t;this.type=null,this.vendor=null,this.detail={},this.type=null!=(t=e.type)?t:"",this.vendor=null!=(t=e.vendor)?t:"",e.hasOwnProperty("detail")&&l("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}function f0(e,t){var n,r=this;return(r=HE.call(this,e,t)||this).message=null,r.translations={},r.message=null!=(n=t.message)?n:"",r.messageType=Xy.ADMIN,r.translations=null!=(n=t.translations)?n:{},t.parent_message_info&&(n=t.parent_message_info,n=f(f({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(t=n.file)?void 0:t.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=e0(e,n)),r}function p0(e){var t;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!=(t=e.real_width)?t:e.width,this.realHeight=null!=(t=e.real_height)?t:e.height}function v0(e,t){var n=this;if((n=GE.call(this,e,t)||this).sender=null,n.reqId="",n.replyToChannel=!1,n.sendingStatus=null,n.errorCode=0,n.sender=t.user?new QE(n._iid,t.user):t.sender_id,n.reqId=null!=(e=null!=(e=t.req_id)?e:t.request_id)?e:"",n.replyToChannel=null!=(e=t.is_reply_to_channel)&&e,t.request_state&&G_(nm,t.request_state)&&(n.sendingStatus=t.request_state),!n.sendingStatus)if(0<n.messageId)n.sendingStatus=nm.SUCCEEDED;else if(n.scheduledInfo)switch(n._scheduledStatus=t.scheduled_status,t.scheduled_status){case IE.SENT:case IE.IN_QUEUE:n.sendingStatus=nm.SUCCEEDED;break;case IE.PENDING:n.sendingStatus=nm.SCHEDULED;break;case IE.FAILED:case IE.REMOVED:n.sendingStatus=nm.FAILED;break;case IE.CANCELED:n.sendingStatus=nm.CANCELED}else n.sendingStatus=nm.PENDING;return n.errorCode=null!=(e=t.error_code)?e:0,n}function _0(e,t){e=VE.call(this,e,t)||this;return e.role=null,e.isBlockedByMe=!1,e.role=G_(Yy,t.role)?t.role:Yy.NONE,t.hasOwnProperty("is_blocked_by_me")&&(e.isBlockedByMe=t.is_blocked_by_me),e}function y0(e,t){var n=this,e=((n=BE.call(this,e)||this).channelUrl=null,n.channelType=Wy.BASE,n.messageId=0,n.parentMessageId=null,n.parentMessage=null,n.silent=!1,n.isOperatorMessage=!1,n.messageType=Xy.BASE,n.data=null,n.customType=null,n.mentionType=null,n.mentionedUsers=[],n.mentionedUserIds=[],n.mentionedMessageTemplate=null,n.threadInfo=null,n.reactions=[],n.metaArrays=[],n.ogMetaData=null,n.appleCriticalAlertOptions=null,n.createdAt=0,n.updatedAt=0,n.scheduledInfo=null,n._scheduledStatus=null,n.messageId=null!=(e=null!=(e=t.msg_id)?e:t.message_id)?e:0,n.channelUrl=t.channel_url,n.channelType=G_(Wy,t.channel_type)?t.channel_type:Wy.GROUP,t.channel&&(t.channel.channel_url&&(n.channelUrl=t.channel.channel_url),t.channel.channel_type&&(n.channelType=t.channel.channel_type)),n.parentMessageId=null!=(e="string"==typeof t.parent_message_id?parseInt(t.parent_message_id):t.parent_message_id)?e:0,n.data=null!=(e=t.data)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.mentionType=G_($y,t.mention_type)?t.mention_type:null,t.mentioned_users),e=(n.mentionedUsers=e?e.map(function(e){return new u(n._iid,e)}):null,t.mentioned_user_ids);n.mentionedUserIds=null!=e?e:null,n.mentionedMessageTemplate=null!=(e=t.mentioned_message_template)?e:"",n.threadInfo=t.thread_info?new pE(n._iid,t.thread_info):null,n.reactions=t.reactions?t.reactions.map(function(e){return new TE(e)}):[];for(var r=null!=(e=t.metaarray)?e:{},i=null!=(e=t.metaarray_key_order)?e:Object.keys(r).sort(function(e,t){return e.localeCompare(t)}),s=0;s<i.length;s++){var a=i[s];n.metaArrays.push(new wE({key:a,value:r[a]||[]}))}return t.sorted_metaarray&&(n.metaArrays=t.sorted_metaarray.map(function(e){return new wE(e)})),n.ogMetaData=t.og_tag?new CE(t.og_tag):null,n.silent=null!=(e=t.silent)&&e,n.isOperatorMessage=null!=(e=t.is_op_msg)&&e,n.appleCriticalAlertOptions=t.apple_critical_alert_options?new kE(t.apple_critical_alert_options):null,n.createdAt=null!=(e=null!=(e=t.created_at)?e:t.ts)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,"number"==typeof t.scheduled_message_id&&"number"==typeof t.scheduled_at&&t.scheduled_status&&(n.scheduledInfo={scheduledMessageId:t.scheduled_message_id,scheduledAt:t.scheduled_at},n._scheduledStatus=t.scheduled_status),n}(Rn=xE=xE||{})[Rn.PENDING=0]="PENDING",Rn[Rn.UPLOADING=1]="UPLOADING",Rn[Rn.UPLOADED=2]="UPLOADED",Rn[Rn.SENDING=3]="SENDING",Rn[Rn.FAILED=4]="FAILED";function m0(e){return G_(em,e.replyType)&&l("boolean",e.includeReactions)&&l("boolean",e.includeMetaArray)&&l("boolean",e.includeParentMessageInfo)&&l("boolean",e.includeThreadInfo)&&l("boolean",e.includePollDetails)}Object.defineProperty(T0.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===Ly.CONNECTED||this._connectionState===Ly.CONNECTING||this._connectionState===Ly.RECONNECTING},enumerable:!1,configurable:!0}),T0.prototype._sendFileMessage=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this._shouldSendThroughWebSocket?(t=new n0(f(f({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)]):[3,2];case 1:return[2,e.sent().as(i0).message];case 2:return t=new r0(f(f({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,userId:this._sdkState.userId,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)];case 3:return[2,e.sent().as(s0).message]}})})},T0.prototype._resolveMessageQueue=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:if(!(t=this._queueMap.get(h.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,e.label=1;case 1:e.trys.push([1,15,16,17]),i=se(t.messageQueue),s=i.next(),e.label=2;case 2:if(s.done)return[3,14];switch((a=s.value).state){case xE.PENDING:case xE.UPLOADING:return[3,3];case xE.UPLOADED:return[3,4];case xE.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(a),[3,13];case 4:if(!r)return[3,10];e.label=5;case 5:return e.trys.push([5,8,,9]),a.state=xE.SENDING,[4,this._sendFileMessage(h,a)];case 6:return o=e.sent(),a.deferred.resolve(o),[4,By(100)];case 7:return e.sent(),[3,9];case 8:return o=e.sent(),a.deferred.reject(o),[3,9];case 9:return[3,11];case 10:n.push(a),e.label=11;case 11:return[3,13];case 12:return a.deferred.reject(a.error.code===d.REQUEST_CANCELED?p.fileUploadCanceled:a.error),[3,13];case 13:return s=i.next(),[3,2];case 14:return[3,17];case 15:return c=e.sent(),c={error:c},[3,17];case 16:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 17:return u=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,u?[4,this._resolveMessageQueue(h)]:[3,19];case 18:e.sent(),e.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,e.label=21;case 21:return[2]}})})},T0.prototype._uploadNextPendingItem=function(c){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=this._queueMap.get(c.url),(n=t.messageQueue.find(function(e){return e.state===xE.PENDING}))?L_(n.params.file)?t.uploadQueue.length<6?(n.state=xE.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!e.sent())return[3,8];e.label=2;case 2:return e.trys.push([2,4,5,7]),r=new dE({file:n.params.file,channelUrl:c.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return r=e.sent(),a=r.as(fE),o=a.url,i=a.fileSize,i=void 0===i?n.params.fileSize:i,s=a.thumbnailSizes,s=void 0===s?n.params.thumbnailSizes:s,a=a.requireAuth,a=void 0!==a&&a,n.params.fileUrl=o,n.params.fileSize=i,n.params.thumbnailSizes=s,n.params.requireAuth=a,n.requireAuth=a,n.state=xE.UPLOADED,[3,7];case 4:return o=e.sent(),n.state=xE.FAILED,n.error=o,[3,7];case 5:return 0<=(u=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(u,1),this._uploadNextPendingItem(c)),[4,this._resolveMessageQueue(c)];case 6:return e.sent(),[7];case 7:return[3,10];case 8:return n.state=xE.FAILED,n.error=p.connectionRequired,0<=(u=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(u,1),this._uploadNextPendingItem(c)),[4,this._resolveMessageQueue(c)];case 9:e.sent(),e.label=10;case 10:return[3,13];case 11:return n.params.thumbnailSizes=[],n.state=xE.UPLOADED,[4,this._resolveMessageQueue(c)];case 12:e.sent(),e.label=13;case 13:return[2]}})})},T0.prototype.request=function(n,r,i){var s;return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new xy,L_(i.file)&&(i.fileName=null!=(s=i.fileName)?s:i.file.name,i.mimeType=null!=(s=i.mimeType)?s:i.file.type,i.fileSize=null!=(s=i.fileSize)?s:i.file.size),this._queueMap.has(n.url)||this._queueMap.set(n.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(n.url).messageQueue.push({requestId:r,params:i,state:xE.PENDING,deferred:t,requireAuth:i.requireAuth}),this._uploadNextPendingItem(n),[2,t.promise]})})},T0.prototype.cancel=function(e,t){void 0===t&&(t=null);var n,r,i=this._queueMap.get(e.url);if(i){i=t?[i.messageQueue.find(function(e){return e.requestId===t})]:A_([],N_(i.messageQueue),!1);try{for(var s=se(i),a=s.next();!a.done;a=s.next()){var o=a.value;if(o)switch(o.state){case xE.PENDING:o.state=xE.FAILED,o.error=p.requestCanceled,this._resolveMessageQueue(e);break;case xE.UPLOADING:this._requestQueue.cancel(o.requestId)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}};var g0,E0=T0,b0={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Jy.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:em.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},I0={replyType:em.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includePollDetails:!1};function T0(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,t=t.cacheContext,a=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=t,this._dispatcher=r,this._dispatcher.on(function(e){e instanceof ym&&(a._connectionState=e.stateType)}),this._onlineDetector=s}(bn=g0=g0||{}).UNKNOWN="UNKNOWN",bn.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",bn.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",bn.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",bn.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",bn.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",bn.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",bn.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",bn.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",bn.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",bn.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",bn.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",bn.REQUEST_MESSAGE="REQUEST_MESSAGE",bn.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",bn.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",bn.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",bn.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",bn.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",bn.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",bn.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",bn.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",bn.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",bn.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";s(R0,C0=F_);var w0,S0,C0,k0,N0=R0,A0=(s(O0,S0=F_),O0);function O0(e){var t=e.messageIds,e=e.source,n=S0.call(this)||this;return n.messageIds=t,n.source=e,n}function R0(e){var t=e.messages,e=e.source,n=C0.call(this)||this;return n.messages=t,n.source=e,n}function D0(e){var t=e.reqId,e=e.source,n=k0.call(this)||this;return n.reqId=t,n.source=e,n}s(D0,k0=F_);s(mb,V0=o);var M0,x0,L0,P0,U0,F0,q0,j0,H0,G0,V0,B0=mb,K0=(s(yb,G0=v),yb),Q0=(s(_b,H0=o),_b),z0=(s(vb,j0=v),vb),W0=(s(pb,q0=o),pb),Y0=(s(fb,F0=v),fb),X0=(s(db,U0=o),db),J0=(s(hb,P0=v),hb),Z0={},$0=(lb.of=function(e){return Z0[e]},lb.prototype.buildMessageFromSerializedData=function(e){var t=Mg(e);switch(t.messageType){case Xy.USER:return new ZE(this._iid,ZE.payloadify(t));case Xy.FILE:return new t0(this._iid,t0.payloadify(t));case Xy.ADMIN:return new XE(this._iid,XE.payloadify(t))}return null},lb.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return w({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations)})},lb.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return w({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),fileType:e.fileType,requireAuth:t.requireAuth})},lb.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return f(f({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},lb.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return f(f({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},lb.prototype.buildSenderFromSerializedData=function(e){e=Mg(e);return new QE(this._iid,QE.payloadify(e))},lb.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=new B0(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(K0).message]}})})},lb.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=new X0(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(J0).message]}})})},lb.prototype.getMessagesByTimestamp=function(r,i,s,a,o){return void 0===o&&(o=g0.REQUEST_MESSAGE),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=new Q0(f(f({channelType:i,channelUrl:r,timestamp:s},b0),a)),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(z0).messages,this._dispatcher.dispatch(new N0({messages:n,source:o})),[2,n]}})})},lb.prototype.getThreadedMessagesByTimestamp=function(i,s,a,o){return void 0===o&&(o=g0.REQUEST_THREADED_MESSAGE),re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=new Q0(f(f(f({channelUrl:i.channelUrl,channelType:i.channelType,timestamp:s},YE),a),{replyType:em.ALL,parentMessageId:i.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(z0).messages,(r=n.slice(1)).forEach(function(e){e.parentMessage=i}),this._dispatcher.dispatch(new N0({messages:r,source:o})),[2,{parentMessage:n[0],threadedMessages:r}]}})})},lb.prototype.getMessageChangelogs=function(a,o,u,c,l){return void 0===l&&(l=g0.REQUEST_MESSAGE_CHANGELOGS),re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return t=new W0(w(f(f({channelType:o,channelUrl:a,timestamp:"number"==typeof u?u:null,token:"string"==typeof u?u:null},I0),c))),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),i=t.as(Y0),n=i.updatedMessages,s=i.deletedMessagesInfo,r=i.hasMore,i=i.nextToken,s=s.map(function(e){return e.messageId}),0<n.length&&this._dispatcher.dispatch(new N0({messages:n,source:l})),0<s.length&&this._dispatcher.dispatch(new A0({messageIds:s,source:l})),[2,{updatedMessages:n,deletedMessageIds:s,hasMore:r,token:i}]}})})},lb),eb=(cb.prototype._trigger=function(e,t){switch(t.sendingStatus){case nm.PENDING:this._onPending(t);break;case nm.FAILED:case nm.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);break;case nm.SCHEDULED:case nm.SUCCEEDED:this._onSucceeded(t)}},cb.prototype.onPending=function(e){return this._onPending=e,this},cb.prototype.onFailed=function(e){return this._onFailed=e,this},cb.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},cb),tb=(s(ub,L0=yo),ub),nb={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,includePollDetails:!1},Ea=(Object.defineProperty(ob.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(ob.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),ob.prototype._validate=function(){return l("number",this.limit)&&0<this.limit},ob),rb=(s(ab,x0=o),ab),ib=(s(sb,M0=v),sb);function sb(t,e){var n=M0.call(this,t,e)||this;return n.messages=e.results.map(function(e){return e0(t,e)}),n.hasNext=e.has_next,n.nextToken=e.end_cursor,n}function ab(e){var t=e.channelCustomType,n=e.keyword,r=e.limit,i=e.reverse,s=e.exactMatch,a=e.channelUrl,o=e.order,u=e.messageTimestampFrom,c=e.messageTimestampTo,l=e.advancedQuery,h=e.targetFields,e=e.nextToken,d=x0.call(this)||this;return d.method=S.GET,d.path="".concat(Fm,"/messages"),d.params={custom_type:t,query:n,limit:r,reverse:i,exact_match:s,channel_url:a,message_ts_from:u,message_ts_to:c,sort_field:o,advanced_query:l,target_fields:h,after:e},d}function ob(e,t){this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!=(e=t.limit)?e:20}function ub(e,t){var n=L0.call(this,e)||this,r=(n.threadInfo=null,n.targetMessageId=0,n.channelUrl=null,n.channelType=null,t.thread_info),i=t.root_message_id,s=t.channel_url,t=t.channel_type;return r&&l("object",r)&&l("number",i)&&l("string",s)&&l("string",t)&&(n.threadInfo=new pE(e,r),n.targetMessageId=i,n.channelUrl=s,n.channelType=t),n}function cb(){this._onPending=yy,this._onFailed=yy,this._onSucceeded=yy}function lb(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,t=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._onlineDetector=s,this._cacheContext=t,this.fileMessageQueue=new E0(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:t}),Z0[e]=this}function hb(e,t){var n=P0.call(this,e,t)||this;return n.message=t?e0(e,f({},t)):null,n}function db(e){var t=e.channelUrl,e=e.scheduledMessageId,n=U0.call(this)||this;return n.method=S.GET,n.path="".concat(Lm,"/").concat(encodeURIComponent(t),"/scheduled_messages/").concat(encodeURIComponent(e)),n.params={},n}function fb(t,e){var n=F0.call(this,t,e)||this;return n.updatedMessages=e.updated.map(function(e){return e0(t,e)}),n.deletedMessagesInfo=e.deleted.map(function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}}),n.hasMore=e.has_more,n.nextToken=e.next,n}function pb(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,i=e.token,s=e.replyType,a=e.includeMetaArray,o=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,e=e.includePollDetails,l=q0.call(this)||this;return l.method=S.GET,l.path="".concat(ug(t),"/").concat(encodeURIComponent(n),"/messages/changelogs"),l.params={change_ts:r,token:i,with_sorted_meta_array:a,include_reactions:o,include_thread_info:u,include_reply_type:s,include_parent_message_info:c,include_poll_details:e},l}function vb(t,e){var n=j0.call(this,t,e)||this;return n.messages=e.messages.map(function(e){return e0(t,e)}),n}function _b(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,r=void 0===r?null:r,i=e.token,i=void 0===i?null:i,s=e.prevResultSize,a=e.nextResultSize,o=e.isInclusive,u=e.reverse,c=e.messageTypeFilter,l=e.customTypesFilter,h=e.senderUserIdsFilter,d=e.replyType,f=e.includeMetaArray,p=e.includeReactions,v=e.parentMessageId,_=e.includeThreadInfo,y=e.includeParentMessageInfo,m=e.showSubchannelMessagesOnly,e=e.includePollDetails,g=H0.call(this)||this;return g.method=S.GET,g.path="".concat(ug(t),"/").concat(encodeURIComponent(n),"/messages"),g.params=w({is_sdk:!0,prev_limit:s,next_limit:a,include:o,reverse:u,message_ts:r,message_id:i,message_type:null!=c?c:null,custom_types:l,sender_ids:h,include_reply_type:d,with_sorted_meta_array:f,include_reactions:p,parent_message_id:v,include_thread_info:_,include_parent_message_info:y,show_subchannel_message_only:m,include_poll_details:e}),g}function yb(e,t){var n=G0.call(this,e,t)||this;return n.message=t?e0(e,f({},t)):null,n}function mb(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,i=e.includeMetaArray,s=e.includeReactions,a=e.includeThreadInfo,o=e.includeParentMessageInfo,e=e.includePollDetails,u=V0.call(this)||this;return u.method=S.GET,u.path="".concat(ug(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r)),u.params={is_sdk:!0,with_sorted_meta_array:i,include_reactions:s,include_thread_info:a,include_parent_message_info:o,include_poll_details:e},u}(ha=w0=w0||{}).SCORE="score",ha.TIMESTAMP="ts";s(Ob,Ib=Ea),Ob.prototype._validate=function(){return Ib.prototype._validate.call(this)&&l("string",this.keyword)&&0<this.keyword.length&&l("boolean",this.reverse)&&l("boolean",this.exactMatch)&&l("string",this.channelUrl)&&l("string",this.channelCustomType)&&(l("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(l("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&G_(w0,this.order)&&l("boolean",this.advancedQuery)&&h("string",this.targetFields,!0)},Ob.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=k.of(this._iid).requestQueue,n=new rb(f(f({},this),{nextToken:this._nextToken||null})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(ib),r=n.messages,i=n.hasNext,s=n.nextToken,this._nextToken=s,this._hasNext=i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})};var gb,Eb,bb,Ib,Tb=Ob,W=(s(Ab,bb=Ea),Ab.prototype._validate=function(){return bb.prototype._validate.call(this)&&l("string",this.channelUrl)&&G_(Wy,this.channelType)},Ab),wb=(s(Nb,Eb=W),Nb.prototype._validate=function(){return Eb.prototype._validate.call(this)&&l("boolean",this.reverse)&&G_(Jy,this.messageTypeFilter)&&G_(em,this.replyType)&&h("string",this.customTypesFilter,!0)&&h("string",this.senderUserIdsFilter,!0)&&l("boolean",this.includeMetaArray)&&l("boolean",this.includeReactions)&&l("boolean",this.includeParentMessageInfo)&&l("boolean",this.includeThreadInfo)&&l("boolean",this.showSubchannelMessagesOnly)},Nb.prototype.load=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,$0.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return t=e.sent(),this._edge=Math.min.apply(Math,A_([Number.MAX_SAFE_INTEGER],N_(t.map(function(e){return e.createdAt})),!1)),this._hasNext=t.length>=this.limit,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},Nb),Sb={channelUrl:null,scheduledMessageId:0},Cb=(s(kb,gb=Sr),kb.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;gb.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new $0(e,{sdkState:n,dispatcher:r,requestQueue:s,onlineDetector:o,cacheContext:t})},kb.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},kb.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},kb.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){return n=f(f({},nb),n),C(l("string",(t=n).channelUrl)&&l("string",t.channelType)&&G_(Wy,t.channelType)&&l("number",t.messageId)&&l("boolean",t.includeMetaArray)&&l("boolean",t.includeParentMessageInfo)&&l("boolean",t.includeThreadInfo)&&l("boolean",t.includePollDetails)).throw(p.invalidParameters),[2,this._manager.getMessage(n)];var t})})},kb.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){return n=f(f({},Sb),n),C(l("string",(t=n).channelUrl)&&l("number",t.scheduledMessageId)).throw(p.invalidParameters),[2,this._manager.getScheduledMessage(n)];var t})})},kb);function kb(){var e=null!==gb&&gb.apply(this,arguments)||this;return e.name="message",e}function Nb(e,t,n,r){var i=this;return(i=Eb.call(this,e,t,n,r)||this).reverse=!1,i.messageTypeFilter=Jy.ALL,i.customTypesFilter=null,i.senderUserIdsFilter=null,i.replyType=em.NONE,i.includeMetaArray=!1,i.includeReactions=!1,i.includeParentMessageInfo=!1,i.includeThreadInfo=!1,i.showSubchannelMessagesOnly=!1,i._edge=Number.MAX_SAFE_INTEGER,i.reverse=null!=(e=r.reverse)&&e,i.messageTypeFilter=null!=(t=r.messageTypeFilter)?t:Jy.ALL,i.customTypesFilter=null!=(n=r.customTypesFilter)?n:null,i.senderUserIdsFilter=null!=(e=r.senderUserIdsFilter)?e:null,i.replyType=null!=(t=r.replyType)?t:em.NONE,i.includeMetaArray=null!=(n=r.includeMetaArray)&&n,i.includeReactions=null!=(e=r.includeReactions)&&e,i.includeParentMessageInfo=null!=(t=r.includeParentMessageInfo)&&t,i.includeThreadInfo=null!=(n=r.includeThreadInfo)&&n,i.showSubchannelMessagesOnly=null!=(e=r.showSubchannelMessagesOnly)&&e,i}function Ab(e,t,n,r){e=bb.call(this,e,r)||this;return e.channelUrl=t,e.channelType=n,e}function Ob(e,t){var n=this;return(n=Ib.call(this,e,t)||this).keyword="",n.reverse=!1,n.exactMatch=!1,n.channelUrl="",n.channelCustomType="",n.messageTimestampFrom=null,n.messageTimestampTo=null,n.order=w0.SCORE,n.advancedQuery=!1,n.targetFields=null,n._nextToken="",n.keyword=t.keyword,n.reverse=null!=(e=t.reverse)&&e,n.exactMatch=null!=(e=t.exactMatch)&&e,n.channelUrl=null!=(e=t.channelUrl)?e:"",n.channelCustomType=null!=(e=t.channelCustomType)?e:"",n.messageTimestampFrom=null!=(e=t.messageTimestampFrom)?e:null,n.messageTimestampTo=null!=(e=t.messageTimestampTo)?e:null,n.order=null!=(e=t.order)?e:w0.SCORE,n.advancedQuery=null!=(e=t.advancedQuery)&&e,n.targetFields=null!=(e=t.targetFields)?e:null,n}function Rb(e){return l("string",e.data,!0)&&l("string",e.customType,!0)&&G_($y,e.mentionType)&&h("string",e.mentionedUserIds,!0)&&h(u,e.mentionedUsers,!0)&&l("string",e.mentionedMessageTemplate,!0)&&h(wE,e.metaArrays,!0)&&l("number",e.parentMessageId,!0)&&l("boolean",e.isReplyToChannel)&&G_(tm,e.pushNotificationDeliveryOption,!0)&&l(kE,e.appleCriticalAlertOptions,!0)}function Db(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}var Mb,_a={data:null,customType:null,mentionType:$y.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},xb=f(f({},_a),{message:null,translationTargetLanguages:null});(qr=Mb=Mb||{}).FILE="file",qr.BLOB="blob",qr.BLOB_LIKE_OBJECT="blobLikeObject",qr.URL="url";function Lb(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob}function Pb(e){return e===Mb.BLOB||e===Mb.FILE}function Ub(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}function Fb(e){return Rb(e)&&(L_(e.file)||l("string",e.fileUrl))&&l("string",e.fileName,!0)&&l("string",e.mimeType,!0)&&l("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every(function(e){return l("object",e)&&0<e.maxWidth&&0<e.maxHeight}))}var qb,jb=f(f({},_a),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1});(at=qb=qb||{}).MUTED="muted",at.BANNED="banned";function Hb(e){return l("string",e.data,!0)&&l("string",e.customType,!0)&&G_($y,e.mentionType)&&h("string",e.mentionedUserIds,!0)&&h(u,e.mentionedUsers,!0)&&l("string",e.mentionedMessageTemplate,!0)&&h(wE,e.metaArrays,!0)&&G_(tm,e.pushNotificationDeliveryOption,!0)&&l(kE,e.appleCriticalAlertOptions,!0)}II.payloadify=function(e){return e?w({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null};var Gb,Vb,Bb,Kb,Qb,zb,Wb,Yb,Xb,Jb,Zb,$b=II,eI=(s(bI,Zb=u),bI.payloadify=function(e){return e?w(f(f({},Zb.payloadify.call(this,e)),$b.payloadify(e.restrictionInfo))):null},bI),fr={data:null,customType:null,mentionType:$y.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},tI=f(f({},fr),{message:null,translationTargetLanguages:null}),nI=f({},fr),rI=(s(EI,Jb=o),EI),iI=(s(gI,Xb=v),gI),sI=(s(mI,Yb=W),mI.prototype._validate=function(){return Yb.prototype._validate.call(this)},mI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:(t=[],this._hasNext?(this._isLoading=!0,n=k.of(this._iid).requestQueue,r=new rI(f(f({},this),{channelUrl:this.channelUrl,token:this._token})),[4,n.send(r)]):[3,2]):[3,5];case 1:return n=e.sent(),r=n.as(iI),i=r.operators,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,t];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},mI),aI=(s(yI,Wb=o),yI),oI=(s(_I,zb=v),_I),uI=(s(vI,Qb=W),vI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=k.of(this._iid).requestQueue,n=new aI(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(oI),r=n.mutedUsers,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},vI),cI=(s(pI,Kb=o),pI),lI=(s(fI,Bb=v),fI),hI=(s(dI,Vb=W),dI.prototype._validate=function(){return Vb.prototype._validate.call(this)},dI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=k.of(this._iid).requestQueue,n=new cI(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(lI),r=n.bannedUsers,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},dI);function dI(e,t,n,r){return Vb.call(this,e,t,n,r)||this}function fI(t,e){var n=Bb.call(this,t,e)||this,r=(n.token=null,n.bannedUsers=[],e.next),e=e.banned_list;return n.token=r,e&&0<e.length&&(n.bannedUsers=e.map(function(e){return new eI(t,e.user)})),n}function pI(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.limit,e=e.token;return(t=Kb.call(this)||this).method=S.GET,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=w({limit:i,token:e}),t}function vI(e,t,n,r){return Qb.call(this,e,t,n,r)||this}function _I(t,e){var n=zb.call(this,t,e)||this,r=(n.token=null,n.mutedUsers=[],e.next),e=e.muted_list;return n.token=r,e&&0<e.length&&(n.mutedUsers=e.map(function(e){return new eI(t,e)})),n}function yI(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.limit,e=e.token;return(t=Wb.call(this)||this).method=S.GET,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={limit:i,token:e},t}function mI(e,t,n,r){return Yb.call(this,e,t,n,r)||this}function gI(t,e){var n=Xb.call(this,t,e)||this;return n.operators=e.operators.map(function(e){return new u(t,e)}),n.token=e.next,n}function EI(e){var t=e.channelUrl,n=e.channelType,r=e.token,e=e.limit,i=Jb.call(this)||this;return i.method=S.GET,i.path="".concat(ug(n),"/").concat(encodeURIComponent(t),"/operators"),i.params={token:r,limit:e},i}function bI(e,t){e=Zb.call(this,e,t)||this;return e.restrictionInfo=null,e.restrictionInfo=new $b(t),e}function II(e){var t;this.restrictionType=null,this.description=null,this.endAt=-1,G_(qb,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!=(t=e.description)?t:null,this.endAt=null!=(t=null!=(t=e.end_at)?t:e.muted_end_at)?t:-1}(i=Gb=Gb||{}).SPAM="spam",i.HARASSING="harassing",i.SUSPICIOUS="suspicious",i.INAPPROPRIATE="inappropriate";s(CI,TI=o);var TI,wI,SI=CI;function CI(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=TI.call(this)||this).method=S.POST,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}s(function(){return null!==wI&&wI.apply(this,arguments)||this},wI=v);s(OI,kI=o);var kI,NI,AI=OI;function OI(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=kI.call(this)||this).method=S.DELETE,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}s(function(e,t){return NI.call(this,e,t)||this},NI=v);s(xT,YI=o);var RI,DI,MI,xI,LI,PI,UI,FI,qI,jI,HI,GI,VI,BI,KI,QI,zI,WI,YI,XI,JI=xT,ZI=(s(MT,WI=v),MT),$I=(s(DT,zI=o),DT),eT=(s(RT,QI=v),RT),tT=(s(OT,KI=o),OT),nT=(s(AT,BI=v),AT),rT=(s(NT,VI=wy),NT),iT=(s(kT,GI=o),kT),sT=(s(CT,HI=v),CT),aT=(s(ST,jI=o),ST),oT=(s(wT,qI=v),wT),uT=(s(TT,FI=o),TT),cT=(s(IT,UI=v),IT),lT=(s(bT,PI=o),bT),hT=(s(ET,LI=v),ET),dT=(s(gT,xI=o),gT),fT=(s(mT,MI=v),mT),pT=(s(yT,DI=wy),yT),vT=(s(_T,RI=o),_T);function _T(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=RI.call(this)||this).method=S.DELETE,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/metacounter/").concat(e),t.params=null,t}function yT(e,t,n){e=DI.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function mT(e,t){e=MI.call(this,e,t)||this;return e.metaCounter=t,e}function gT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.metaCounter,s=e.upsert,s=void 0!==s&&s,e=e.mode,e=void 0===e?"set":e;return(t=xI.call(this)||this).method=S.PUT,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:i,upsert:s,mode:e},t}function ET(e,t){e=LI.call(this,e,t)||this;return e.metaCounter=t,e}function bT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metaCounter;return(t=PI.call(this)||this).method=S.POST,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:e},t}function IT(e,t){e=UI.call(this,e,t)||this;return e.metaCounter=t,e}function TT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=FI.call(this)||this).method=S.GET,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={keys:e},t}function wT(e,t){e=qI.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function ST(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=jI.call(this)||this).method=S.PUT,t.path="".concat(ug(e),"/").concat(encodeURIComponent(n),"/metadata"),t.params={include_ts:!0},t}function CT(e,t){e=HI.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function kT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=GI.call(this)||this).method=S.DELETE,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/metadata/").concat(e),t.params={include_ts:!0},t}function NT(e,t,n){e=VI.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function AT(e,t){var e=BI.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function OT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.metadata,e=e.upsert;return(t=KI.call(this)||this).method=S.PUT,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:i,include_ts:!0,upsert:null!=e&&e},t}function RT(e,t){var e=QI.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function DT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=zI.call(this)||this).method=S.GET,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={keys:e,include_ts:!0},t}function MT(e,t){var e=WI.call(this,e,t)||this,n=(e.isMuted=!1,e.startAt=null,e.endAt=null,e.remainingDuration=null,e.description=null,t.is_muted),r=t.start_at,i=t.end_at,s=t.remaining_duration,t=t.description;return e.isMuted=n,e.startAt=r,e.endAt=i,e.remainingDuration=s,e.description=t,e}function xT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=YI.call(this)||this).method=S.GET,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/mute/").concat(e),t}s(function(e,t){return XI.call(this,e,t)||this},XI=v);s(FT,LT=o);var LT,PT,UT=FT;function FT(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=LT.call(this)||this).method=S.DELETE,t.path="".concat(ug(e),"/").concat(encodeURIComponent(n),"/metacounter"),t.params=null,t}s(function(){return null!==PT&&PT.apply(this,arguments)||this},PT=v);s(GT,qT=o);var qT,jT,HT=GT;function GT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.userId,s=e.seconds,e=e.description;return(t=qT.call(this)||this).method=S.POST,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={user_id:i,seconds:s,description:e},t}s(function(e,t){return jT.call(this,e,t)||this},jT=v);s(YT,BT=wy);var VT,BT,KT,QT=YT,zT=(s(WT,VT=o),WT);function WT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=VT.call(this)||this).method=S.DELETE,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/mute/").concat(encodeURIComponent(e)),t}function YT(e,t,n){var r=BT.call(this,e,"SYEV",n)||this;return r.user=new eI(e,n.data),r}s(function(){return null!==KT&&KT.apply(this,arguments)||this},KT=v);s(nw,JT=wy);var XT,JT,ZT,$T=nw,ew=(s(tw,XT=o),tw);function tw(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.userId,s=e.seconds,e=e.description;return(t=XT.call(this)||this).method=S.POST,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=w({user_id:i,seconds:s,description:e}),t}function nw(e,t,n){var r=JT.call(this,e,"SYEV",n)||this;return r.user=new eI(e,n.data),r}s(function(){return null!==ZT&&ZT.apply(this,arguments)||this},ZT=v);s(cw,iw=wy);var rw,iw,sw,aw=cw,ow=(s(uw,rw=o),uw);function uw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=rw.call(this)||this).method=S.DELETE,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/ban/").concat(encodeURIComponent(e)),t}function cw(e,t,n){var r=iw.call(this,e,"SYEV",n)||this;return r.memberCount=null,r.joinedMemberCount=null,r.user=new eI(e,n.data),n.data.member_count&&(r.memberCount=n.data.member_count),n.data.joined_member_count&&(r.joinedMemberCount=n.data.joined_member_count),r}s(function(){return null!==sw&&sw.apply(this,arguments)||this},sw=v);s(_w,hw=wy);var lw,hw,dw,fw=_w,pw=(s(vw,lw=o),vw);function vw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.freezing;return(t=lw.call(this)||this).method=S.PUT,t.path="".concat(ug(r),"/").concat(encodeURIComponent(n),"/freeze"),t.params={freeze:e},t}function _w(e,t,n){var r=hw.call(this,e,"SYEV",n)||this;return r.user=new eI(e,n.data),r}s(function(){return null!==dw&&dw.apply(this,arguments)||this},dw=v);s(Xw,kw=wy);var yw,mw,gw,Ew,bw,Iw,Tw,ww,Sw,Cw,kw,Nw,Aw=Xw,Ow=(s(Yw,Cw=o),Yw),Rw=(s(Ww,Sw=o),Ww),Dw=(s(zw,ww=o),zw),Mw=(s(Qw,Tw=Sy),Qw),xw=(s(Kw,Iw=wy),Kw),Lw=(s(Bw,bw=Sy),Bw),Pw=(s(Vw,Ew=wy),Vw),Uw=(s(Gw,gw=Sy),Gw),Fw=(s(Hw,mw=wy),Hw),qw=(s(jw,yw=o),jw);function jw(e){var t=yw.call(this)||this;return t.method=S.DELETE,t.path="".concat(ug(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),t}function Hw(e,t,n){var r,i=this,e=((i=mw.call(this,e,"FEDI",n)||this).message=new t0(e,n),k.of(e).sdkState);return i.mentionCountChange=lg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function Gw(e){var t=[];return e.mentionType===$y.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),gw.call(this,{code:"FEDI",ackRequired:!0,payload:w({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function Vw(e,t,n){var r,i=this,e=((i=Ew.call(this,e,"MEDI",n)||this).message=new ZE(e,n),k.of(e).sdkState);return i.mentionCountChange=lg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function Bw(e){var t=[];return e.mentionType===$y.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),bw.call(this,{code:"MEDI",ackRequired:!0,payload:w({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function Kw(e,t,n){var r,i=this,e=((i=Iw.call(this,e,"MESG",n)||this).message=new ZE(e,n),k.of(e).sdkState);return i.isMentioned=yg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function Qw(e){var t=[];return e.mentionType===$y.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),Tw.call(this,{code:"MESG",ackRequired:!0,payload:w({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==tm.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function zw(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,a=e.offendingUserId,o=e.messageId,e=e.description;return(t=ww.call(this)||this).method=S.POST,t.path="".concat(cg(r),"/").concat(encodeURIComponent(n),"/messages/").concat(o),t.params={report_category:i,reporting_user_id:s,report_description:e,offending_user_id:a},t}function Ww(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,a=e.offendingUserId,e=e.description;return(t=Sw.call(this)||this).method=S.POST,t.path="/report/users/".concat(a),t.params={channel_url:n,channel_type:r===Wy.OPEN?"open_channels":"group_channels",report_category:i,reporting_user_id:s,report_description:e},t}function Yw(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,e=e.description;return(t=Cw.call(this)||this).method=S.POST,t.path="".concat(cg(r),"/").concat(encodeURIComponent(n)),t.params={report_category:i,reporting_user_id:s,report_description:e},t}function Xw(e,t,n){e=kw.call(this,e,"SYEV",n)||this;return e.freeze=n.data.freeze,e}s(function(){return null!==Nw&&Nw.apply(this,arguments)||this},Nw=v);s(DS,uS=wy);var Jw,Zw,$w,eS,tS,nS,rS,iS,sS,aS,oS,uS,cS,lS=DS,hS=(s(RS,oS=o),RS),dS=(s(OS,aS=v),OS),fS=(s(AS,sS=o),AS),pS=(s(NS,iS=v),NS),vS=(s(kS,rS=o),kS),_S=(s(CS,nS=v),CS),yS=(s(SS,tS=o),SS),mS=(s(wS,eS=v),wS),gS=(s(TS,$w=o),TS),ES=(s(IS,Zw=v),IS),bS=(s(N,Jw=yo),N.payloadify=function(e){return w(f(f({},Jw.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:u.payloadify(e.creator),created_at:e.createdAt/1e3}))},N.prototype.isGroupChannel=function(){return this.channelType===Wy.GROUP},N.prototype.isOpenChannel=function(){return this.channelType===Wy.OPEN},Object.defineProperty(N.prototype,"cachedMetaData",{get:function(){var n={};return this._cachedMetaData.forEach(function(e,t){e.isRemoved||(n[t]=e.value)}),n},enumerable:!1,configurable:!0}),N.prototype._upsertCachedMetaData=function(n,r){var i=this;Object.keys(n).forEach(function(e){var t=i._cachedMetaData.get(e);(!t||t.updatedAt<=r)&&i._cachedMetaData.set(e,{value:n[e],isRemoved:!1,updatedAt:r})})},N.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach(function(e){e=n._cachedMetaData.get(e);e&&e.updatedAt<t&&(e.isRemoved=!1,e.updatedAt=t)})},N.prototype._generateRequestId=function(){return"rq-".concat(U_())},N.prototype.isIdentical=function(e){return e&&this.url===e.url},N.prototype.isEqual=function(e){return M_(this,e)},N.prototype.createOperatorListQuery=function(e){return new sI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},N.prototype.createMutedUserListQuery=function(e){return new uI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},N.prototype.createBannedUserListQuery=function(e){return new hI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},N.prototype.createPreviousMessageListQuery=function(e){return new wb(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},N.prototype.addOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(h("string",r)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new SI({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.removeOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(h("string",r)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new AI({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.getMyMutedInfo=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new JI({channelUrl:this.url,channelType:this.channelType,userId:n.userId}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(ZI),r=n.isMuted,i=n.startAt,s=n.endAt,a=n.remainingDuration,o=n.description,[2,{isMuted:r,startAt:i,endAt:s,remainingDuration:a,description:o}]}})})},N.prototype.getMetaData=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return C(h("string",s)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new $I({channelUrl:this.url,channelType:this.channelType,keys:s}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(eT),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},N.prototype.getAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new $I({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(eT),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},N.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new mg({channelUrl:this.url,channelType:this.channelType,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(gg).metaData,this._upsertCachedMetaData(n,0),[2,n]}})})},N.prototype.updateMetaData=function(s,a){return void 0===a&&(a=!1),re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new tT({channelUrl:this.url,channelType:this.channelType,metadata:s,upsert:a}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(nT),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},N.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new iT({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(sT).ts,this._removeFromCachedMetaData([r],n),[2]}})})},N.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new aT({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(oT).ts,this._removeFromCachedMetaData(A_([],N_(this._cachedMetaData.keys()),!1),n),[2]}})})},N.prototype.getMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(h("string",r)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new uT({channelUrl:this.url,channelType:this.channelType,keys:r}),[4,t.send(n)];case 1:return[2,e.sent().as(cT).metaCounter]}})})},N.prototype.getAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new uT({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return[2,e.sent().as(cT).metaCounter]}})})},N.prototype.createMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new lT({channelUrl:this.url,channelType:this.channelType,metaCounter:r}),[4,t.send(n)];case 1:return[2,e.sent().as(hT).metaCounter]}})})},N.prototype.updateMetaCounters=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new dT({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:i}),[4,t.send(n)];case 1:return[2,e.sent().as(fT).metaCounter]}})})},N.prototype.increaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new dT({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return[2,e.sent().as(fT).metaCounter]}})})},N.prototype.decreaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new dT({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return[2,e.sent().as(fT).metaCounter]}})})},N.prototype.deleteMetaCounter=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new vT({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.deleteAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new UT({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.muteUser=function(t,n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.muteUserWithUserId(t.userId,n,r)]})})},N.prototype.muteUserWithUserId=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)&&l("number",i,!0)&&l("string",s,!0)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new HT({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.unmuteUser=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unmuteUserWithUserId(t.userId)]})})},N.prototype.unmuteUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new zT({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.banUser=function(t,n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.banUserWithUserId(t.userId,n,r)]})})},N.prototype.banUserWithUserId=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)&&l("number",i,!0)&&l("string",s,!0)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new ew({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.unbanUser=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unbanUserWithUserId(t.userId)]})})},N.prototype.unbanUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new ow({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.freeze=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new pw({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!0,[2]}})})},N.prototype.unfreeze=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new pw({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!1,[2]}})})},N.prototype.getMessagesByTimestamp=function(n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return r=f(f({},b0),r),C(l("number",n)&&(l("number",(t=r).prevResultSize)&&l("number",t.nextResultSize)&&l("boolean",t.isInclusive)&&l("boolean",t.reverse)&&l("string",t.messageTypeFilter)&&G_(Jy,t.messageTypeFilter)&&h("string",t.customTypesFilter,!0)&&h("string",t.senderUserIdsFilter,!0)&&G_(em,t.replyType)&&l("boolean",t.includeMetaArray)&&l("boolean",t.includeReactions)&&l("boolean",t.includeParentMessageInfo)&&l("boolean",t.includeThreadInfo)&&l("boolean",t.showSubchannelMessagesOnly))).throw(p.invalidParameters),[4,$0.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,n,r)];case 1:return[2,e.sent()]}var t})})},N.prototype.getMessageChangeLogsSinceTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},I0),n),C(l("number",t)&&m0(n)).throw(p.invalidParameters),[4,$0.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},N.prototype.getMessageChangeLogsSinceToken=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},I0),n),C(l("string",t)&&m0(n)).throw(p.invalidParameters),[4,$0.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},N.prototype._createPendingSendableMessagePayload=function(e,t,n){var r=k.of(this._iid).sessionManager;return w({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(e){return wE.payloadify(e)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?kE.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:QE.payloadify(r.currentUser),req_id:t,request_state:nm.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:e.mentionedUsers})},N.prototype._createPendingUserMessage=function(e,t,n){var r={};if(e.translationTargetLanguages)try{for(var i=se(e.translationTargetLanguages),s=i.next();!s.done;s=i.next())r[s.value]=""}catch(e){o={error:e}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(o)throw o.error}}var a=w(f(f({},this._createPendingSendableMessagePayload(e,t,n)),{type:Xy.USER,message:e.message,translations:r})),o=new ZE(this._iid,a);return o.messageParams=e,o},N.prototype._createPendingScheduledUserMessage=function(e,t,n){t=this._createPendingUserMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},N.prototype._createPendingFileMessage=function(e,t,n){t=w(f(f({},this._createPendingSendableMessagePayload(e,t,n)),{type:Xy.FILE,url:e.fileUrl,file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}}):[]})),n=new t0(this._iid,t);return n.messageParams=e,n},N.prototype._createPendingScheduledFileMessage=function(e,t,n){t=this._createPendingFileMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},N.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===d.REQUEST_CANCELED?e.sendingStatus=nm.CANCELED:n||(e.sendingStatus=nm.FAILED)},N.prototype.sendUserMessage=function(e){return e=f(f({},xb),e),C(Rb(t=e)&&l("string",t.message)&&h("string",t.translationTargetLanguages,!0)).throw(p.invalidParameters),this._sendUserMessage(e);var t},N.prototype._sendUserMessage=function(r,i,e){var n,s=this,t=(void 0===i&&(i=Date.now()),void 0===e&&(e=null),k.of(this._iid)),a=t.dispatcher,t=t.requestQueue,o=e,u=new eb,e=(o||(o=this._generateRequestId(),n=k.of(this._iid).dispatcher,By(2).then(function(){var t=s._createPendingUserMessage(r,o,i);n.dispatch(new N0({messages:[t],source:g0.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})})),new Mw(f({channelUrl:this.url,channelType:this.channelType,reqId:o},r)));return t.send(e).then(function(e){var t=e.as(xw).message;a.dispatch(new N0({messages:[t],source:g0.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})}).catch(function(n){if(D_(n))throw n;By(2).then(function(){var t=s._createPendingUserMessage(r,o,i),e=k.of(s._iid).cacheContext.localCacheEnabled&&x_(n.code);s._markMessageAsFailed(t,n,e),a.dispatch(new N0({messages:[t],source:t.sendingStatus===nm.PENDING?g0.REQUEST_RESEND_MESSAGE:g0.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(n,t)]})})})})}),u},N.prototype._autoResendUserMessage=function(e){return C(e instanceof ZE).throw(p.invalidParameters),this._sendUserMessage(e.messageParams,e.createdAt,e.reqId)},N.prototype.resendUserMessage=function(r){var i;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof ZE&&!r.scheduledInfo).throw(p.invalidParameters),t=new xy,n=null!=(i=r.messageParams)?i:w({data:r.data,customType:r.customType,mentionType:r.mentionType,mentionedUsers:r.mentionedUsers,mentionedUserIds:r.mentionedUserIds,mentionedMessageTemplate:r.mentionedMessageTemplate,metaArrays:r.metaArrays,parentMessageId:r.parentMessageId,appleCriticalAlertOptions:r.appleCriticalAlertOptions,message:r.message,translationTargetLanguages:Object.keys(r.translations)}),this._sendUserMessage(n).onFailed(function(e){return t.reject(e)}).onSucceeded(function(e){return t.resolve(e)}),[2,t.promise]})})},N.prototype.updateUserMessage=function(s,a){return re(this,void 0,void 0,function(){var n,r,i;return ie(this,function(e){switch(e.label){case 0:return a=f(f({},tI),a),C(l("number",s)&&(Hb(t=a)&&l("string",t.message,!0)&&h("string",t.translationTargetLanguages,!0))).throw(p.invalidParameters),r=k.of(this._iid),n=r.dispatcher,r=r.requestQueue,i=new Lw(f({channelType:this.channelType,channelUrl:this.url,messageId:s},a)),[4,r.send(i)];case 1:return r=e.sent(),i=r.as(Pw).message,n.dispatch(new N0({messages:[i],source:g0.EVENT_MESSAGE_UPDATED})),[2,i]}var t})})},N.prototype.copyUserMessage=function(r,i){var s;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof N&&i instanceof ZE&&i.sendingStatus===nm.SUCCEEDED&&r.url===i.channelUrl&&!i.scheduledInfo).throw(p.invalidParameters),t=new xy,n=null!=(s=i.messageParams)?s:f(f({},i),{mentionType:i.mentionType,mentionedUserIds:null!=(s=i.mentionedUserIds)?s:null==(s=i.mentionedUsers)?void 0:s.map(function(e){return e.userId}),translationTargetLanguages:Object.keys(i.translations),pushNotificationDeliveryOption:tm.DEFAULT,parentMessageId:null,isReplyToChannel:!1}),r._sendUserMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},N.prototype.translateUserMessage=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof ZE&&0<r.messageId&&h("string",i)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new vS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,translationTargetLanguages:i}),[4,t.send(n)];case 1:return[2,e.sent().as(_S).message]}})})},N.prototype._createScheduledUserMessage=function(e,r){var i=this,t=k.of(this._iid).requestQueue,s=Date.now(),a=this._generateRequestId(),n=(By(2).then(function(){var t=i._createPendingScheduledUserMessage(e,a,s);ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}),new yS(f({reqId:a,channelType:this.channelType,channelUrl:this.url},e)));t.send(n).then(function(e){var t=e.as(mS).message;ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(D_(n))throw n;By(2).then(function(){var t=i._createPendingScheduledUserMessage(e,a,s);i._markMessageAsFailed(t,n),ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(n,t)]})})})})})},N.prototype.sendFileMessage=function(e){return e=f(f({},jb),e),C(Fb(e)).throw(p.invalidParameters),this._sendFileMessage(e)},N.prototype._sendFileMessage=function(r,i,e){var s=this,a=(void 0===i&&(i=Date.now()),void 0===e&&(e=null),k.of(this._iid).dispatcher),t=$0.of(this._iid).fileMessageQueue,o=e,u=new eb;return o||(o=this._generateRequestId(),By(2).then(function(){var t=s._createPendingFileMessage(r,o,i);a.dispatch(new N0({messages:[t],source:g0.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})})),t.request(this,o,r).then(function(t){a.dispatch(new N0({messages:[t],source:g0.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})}).catch(function(n){if(D_(n))throw n;By(2).then(function(){var t=s._createPendingFileMessage(r,o,i),e=k.of(s._iid).cacheContext.localCacheEnabled&&x_(n.code);s._markMessageAsFailed(t,n,e),a.dispatch(new N0({messages:[t],source:t.sendingStatus===nm.PENDING?g0.REQUEST_RESEND_MESSAGE:g0.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(n,t)]})})})})}),u},N.prototype._autoResendFileMessage=function(e){C(e instanceof t0).throw(p.invalidParameters);var t=k.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.createdAt,e.reqId).onFailed(function(e){t.debug("autoResendFileMessage failed",e)}).onSucceeded(function(e){t.debug("autoResendFileMessage success",e)})},N.prototype._createScheduledFileMessage=function(e,r,i,s){var a=this,t=k.of(this._iid).requestQueue,n=new gS(f(f({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));t.send(n).then(function(e){var t=e.as(ES).message;ae(function(){return re(a,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(D_(n))throw n;By(2).then(function(){var t=a._createPendingScheduledFileMessage(e,i,s);a._markMessageAsFailed(t,n),ae(function(){return re(a,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(n,t)]})})})})})},N.prototype.sendFileMessages=function(e){C(e.every(function(e){return Fb(f(f({},jb),e))})).throw(p.invalidParameters);var t,n,r=new eb;try{for(var i=se(e),s=i.next();!s.done;s=i.next()){var a=s.value;this.sendFileMessage(a).onPending(function(e){return r._trigger(null,e)}).onFailed(function(e,t){return r._trigger(e,t)}).onSucceeded(function(e){return r._trigger(null,e)})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},N.prototype.resendFileMessage=function(i,s){var a;return re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){return C(i instanceof t0&&s instanceof Blob&&!i.scheduledInfo).throw(p.invalidParameters),n=new xy,r=null!=(a=i.messageParams)?a:(t=s,w({data:i.data,customType:i.customType,mentionType:i.mentionType,mentionedUsers:i.mentionedUsers,mentionedUserIds:i.mentionedUserIds,metaArrays:i.metaArrays,parentMessageId:i.parentMessageId,appleCriticalAlertOptions:i.appleCriticalAlertOptions,file:t=void 0===s?null:t,fileUrl:i.url,fileName:i.name,fileSize:i.size,mimeType:i.type,thumbnailSizes:i.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}})})),this._sendFileMessage(r).onFailed(function(e){return n.reject(e)}).onSucceeded(function(e){return n.resolve(e)}),[2,n.promise];var t})})},N.prototype.updateFileMessage=function(i,s){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return s=f(f({},nI),s),C(l("number",i)&&Hb(s)).throw(p.invalidParameters),n=k.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new Uw(f({channelType:this.channelType,channelUrl:this.url,messageId:i},s)),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(Fw).message,t.dispatch(new N0({messages:[r],source:g0.EVENT_MESSAGE_UPDATED})),[2,r]}})})},N.prototype.cancelUploadingFileMessage=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(l("string",t)).throw(p.invalidParameters),$0.of(this._iid).fileMessageQueue.cancel(this,t),[2,!0]})})},N.prototype.copyFileMessage=function(r,i){var s;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof N&&i instanceof t0&&i.sendingStatus===nm.SUCCEEDED&&r.url===i.channelUrl&&!i.scheduledInfo).throw(p.invalidParameters),t=new xy,n=f(f({},i),{fileUrl:i.url,fileName:i.name,fileSize:i.size,mimeType:i.type,mentionType:i.mentionType,mentionedUserIds:null!=(s=i.mentionedUserIds)?s:null==(s=i.mentionedUsers)?void 0:s.map(function(e){return e.userId}),pushNotificationDeliveryOption:tm.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:i.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),requireAuth:i.requireAuth}),r._sendFileMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},N.prototype.deleteMessage=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof zE).throw(p.invalidParameters),0<r.messageId?(t=k.of(this._iid).requestQueue,n=new qw({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},N.prototype.addReaction=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof KE&&0<r.messageId&&l("string",i)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new hS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:i}),[4,t.send(n)];case 1:return[2,e.sent().as(dS).reactionEvent]}})})},N.prototype.deleteReaction=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof KE&&0<r.messageId&&l("string",i)).throw(p.invalidParameters),t=k.of(this._iid).requestQueue,n=new fS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:i}),[4,t.send(n)];case 1:return[2,e.sent().as(pS).reactionEvent]}})})},N.prototype._updateMessageMetaArray=function(i,s,a,o){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return n=k.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new Lw({channelType:this.channelType,channelUrl:this.url,messageId:i,metaArrayParams:{array:s,mode:a,upsert:o}}),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(Pw).message,t.dispatch(new N0({messages:[r],source:g0.EVENT_MESSAGE_UPDATED})),[2,r]}})})},N.prototype.createMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return C(n instanceof zE&&0<n.messageId&&h("string",r)).throw(p.invalidParameters),t=r.map(function(e){return new wE({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"add",!0)]})})},N.prototype.deleteMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return C(n instanceof zE&&0<n.messageId&&h("string",r)).throw(p.invalidParameters),t=r.map(function(e){return new wE({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"remove",!0)]})})},N.prototype.addMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(t instanceof zE&&0<t.messageId&&n.every(function(e){return e instanceof wE})).throw(p.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"add",!0)]})})},N.prototype.removeMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(t instanceof zE&&0<t.messageId&&n.every(function(e){return e instanceof wE})).throw(p.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"remove",!0)]})})},N.prototype.report=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(G_(Gb,r)&&l("string",i)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Ow({channelUrl:this.url,channelType:this.channelType,userId:n.userId,category:r,description:i}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.reportUser=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof u&&G_(Gb,i)&&l("string",s)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Rw({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.userId,category:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N.prototype.reportMessage=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof zE&&G_(Gb,i)&&l("string",s)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Dw({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.sender.userId,messageId:r.messageId,category:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},N);function N(e,t){var n=this;return(n=Jw.call(this,e)||this).url="",n.channelType=Wy.BASE,n.name="",n.coverUrl="",n.customType="",n.data="",n.isFrozen=!1,n.isEphemeral=!1,n.creator=null,n.createdAt=0,n.url=t.channel_url,n.name=null!=(e=t.name)?e:"",n.coverUrl=null!=(e=t.cover_url)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.data=null!=(e=t.data)?e:"",n.isFrozen=!!l("boolean",t.freeze)&&t.freeze,n.isEphemeral=!!l("boolean",t.is_ephemeral)&&t.is_ephemeral,n.creator=t.created_by?new u(n._iid,t.created_by):null,n.createdAt=1e3*t.created_at,n._cachedMetaData=new Map,t.metadata&&t.ts&&Object.keys(t.metadata).forEach(function(e){n._cachedMetaData.set(e,{value:t.metadata[e],isRemoved:!1,updatedAt:t.ts})}),n}function IS(e,t){var n=Zw.call(this,e,t)||this;return n.message=new t0(e,t),n}function TS(e){var t=this,t=$w.call(this)||this,n=[],r=(e.mentionType===$y.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),i=e.channelUrl;return t.method=S.POST,t.path="".concat(ug(r),"/").concat(encodeURIComponent(i),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:Zy.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return WE.payloadify(e)}):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return wE.payloadify(e)}),apple_critical_alert_options:kE.payloadify(e.appleCriticalAlertOptions),push_option:e.pushNotificationDeliveryOption},t}function wS(e,t){var n=eS.call(this,e,t)||this;return n.message=new ZE(e,t),n}function SS(e){var t=this,t=tS.call(this)||this,n=[],r=(e.mentionType===$y.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),i=e.channelUrl;return t.method=S.POST,t.path="".concat(ug(r),"/").concat(encodeURIComponent(i),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:Zy.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return wE.payloadify(e)}),apple_critical_alert_options:kE.payloadify(e.appleCriticalAlertOptions),target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption},t}function CS(e,t){var n=nS.call(this,e,t)||this;return n.message=new ZE(e,t),n}function kS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.translationTargetLanguages,i=rS.call(this)||this;return i.method=S.POST,i.path="".concat(ug(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r),"/translation"),i.params={target_langs:e},i}function NS(e,t){e=iS.call(this,e,t)||this;return e.reactionEvent=new bE(f({},t)),e}function AS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,i=sS.call(this)||this;return i.method=S.DELETE,i.path="".concat(ug(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),i.params={reaction:e},i}function OS(e,t){e=aS.call(this,e,t)||this;return e.reactionEvent=new bE(t),e}function RS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,i=oS.call(this)||this;return i.method=S.POST,i.path="".concat(ug(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),i.params={reaction:e},i}function DS(e,t,n){e=uS.call(this,e,"DELM",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.messageId=Number(n.msg_id),e}(n=cS=cS||{})[n.NONE=0]="NONE",n[n.CHANNEL_ENTER=10102]="CHANNEL_ENTER",n[n.CHANNEL_EXIT=10103]="CHANNEL_EXIT",n[n.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",n[n.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",n[n.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",n[n.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",n[n.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",n[n.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",n[n.TYPING_START=10900]="TYPING_START",n[n.TYPING_END=10901]="TYPING_END",n[n.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",n[n.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",n[n.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",n[n.CHANNEL_INVITE=10020]="CHANNEL_INVITE",n[n.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",n[n.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",n[n.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",n[n.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",n[n.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",n[n.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",n[n.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",n[n.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE";Object.defineProperty(tC.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===Wy.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(tC.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===Wy.OPEN},enumerable:!1,configurable:!0});var MS,xS,LS,PS,US,FS,qS,jS=tC,HS=(s(eC,qS=wy),eC),GS=(s($S,FS=HS),$S),VS=(s(ZS,US=wy),ZS),BS=(s(JS,PS=wy),JS),KS=(s(XS,LS=wy),XS),QS=(s(YS,xS=wy),YS),zS=(s(WS,MS=wy),WS);function WS(e,t,n){var r=MS.call(this,e,"MTHD",n)||this;return r.event=new tb(e,n),r}function YS(e,t,n){e=xS.call(this,e,"MRCT",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.event=new bE(n),e}function XS(e,t,n){var r,i=this,e=((i=LS.call(this,e,"AEDI",n)||this).message=new XE(e,n),k.of(e).sdkState);return i.mentionCountChange=lg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function JS(e,t,n){var r,i=this,e=((i=PS.call(this,e,"ADMM",n)||this).message=new XE(e,n),k.of(e).sdkState);return i.isMentioned=yg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function ZS(e,t,n){e=US.call(this,e,"MCNT",n)||this;return e.groupChannelMemberCounts=n.group_channels.map(function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}}),e.openChannelMemberCounts=n.open_channels.map(function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}}),e}function $S(e,t,n){var r=FS.call(this,e,t,n)||this,e=n.data.operators,t=void 0===e?[]:e;return r.operators=t.map(function(e){return new u(r._iid,e)}),r}function eC(e,t,n){e=qS.call(this,e,"SYEV",n)||this;return e.event=new jS(n),e}function tC(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}s(vC,sC=yo),Object.defineProperty(vC.prototype,"enteredChannels",{get:function(){var t=this;return this._enteredChannelUrls.map(function(e){return t._channels.get(e)}).filter(function(e){return null!==e})},enumerable:!1,configurable:!0}),vC.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},vC.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},vC.prototype.exit=function(e){e=this._enteredChannelUrls.indexOf(e);0<=e&&this._enteredChannelUrls.splice(e,1)},vC.prototype.exitAll=function(){this._enteredChannelUrls=[]},vC.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,null!=(n=this._channels.get(t))?n:null]})})},vC.prototype.upsert=function(t){return re(this,void 0,void 0,function(){var n=this;return ie(this,function(e){return t.forEach(function(e){var t;n._channels.has(e.url)?(t=n._channels.get(e.url),Object.assign(t,e)):n._channels.set(e.url,e)}),[2]})})},vC.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._channels.delete(t),this.exit(t),[2]})})},vC.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]})})};var nC,rC,iC,sC,aC,oC=vC,uC={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},cC=(s(pC,iC=o),pC),lC=(s(fC,rC=v),fC),hC=(s(dC,nC=o),dC);function dC(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,i=e.name,s=e.data,a=e.customType,e=e.operatorUserIds;return(t=nC.call(this)||this).method=S.POST,t.path=Pm,t.params=w({channel_url:n,cover_url:l("string",r)?r:null,cover_file:L_(r)?r:null,name:i,data:s,custom_type:a,operators:e}),t}function fC(e,t){var n=rC.call(this,e,t)||this;return n.channel=null,n.channel=new ik(e,t),n}function pC(e){var t=e.channelUrl,e=e.isInternalCall,n=iC.call(this)||this;return n.method=S.GET,n.path="".concat(e?Um:Pm,"/").concat(encodeURIComponent(t)),n}function vC(){var e=null!==sC&&sC.apply(this,arguments)||this;return e._channels=new Map,e._enteredChannelUrls=[],e}s(function(e,t){var n=aC.call(this,e,t)||this;return n.channel=new ik(e,t),n},aC=v);s(XC,SC=Sy);var _C,yC,mC,gC,EC,bC,IC,TC,wC,SC,CC,kC=XC,NC=(s(YC,wC=wy),YC),AC=(s(WC,TC=Sy),WC),OC=(s(zC,IC=wy),zC),RC={},DC=(QC.of=function(e){return RC[e]},QC.prototype.buildOpenChannelFromSerializedData=function(e){e=Mg(e);return new ik(e._iid,ik.payloadify(e))},QC.prototype.getChannelFromCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.get(t)];case 1:return[2,e.sent()]}})})},QC.prototype.upsertChannelsToCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.upsert(t)];case 1:return e.sent(),[2]}})})},QC.prototype.removeChannelsFromCache=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,7]),t=se(a),n=t.next(),e.label=1;case 1:return n.done?[3,4]:(r=n.value,[4,this._openChannelCache.remove(r)]);case 2:e.sent(),e.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=e.sent(),i={error:r},[3,7];case 6:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}})})},QC.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},QC.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},QC.prototype._handleEvent=function(ne){return re(this,void 0,void 0,function(){var a,U,o,t,u,c,F,l,n,r,q,j,s,H,G,h,i,d,f,p,v,_,y,V,B,m,g,E,K,Q,b,I,T,w,S,C,k,z,N,W,A,Y,O,R,D,M,x,L,X,J,Z,$,ee,te,P=this;return ie(this,function(e){switch(e.label){case 0:switch(e.trys.push([0,51,,52]),ne.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"SYEV":return[3,27]}return[3,50];case 1:return t=null,"MESG"===ne.code?t=ne.as(xw):"FILE"===ne.code?t=ne.as(i0):"ADMM"!==ne.code&&"BRDM"!=ne.code||(t=ne.as(BS)),t?(a=t.message,U=t.isMentioned,a.channelType!==Wy.OPEN?[3,3]:[4,this.getChannel(a.channelUrl,!0)]):[3,3];case 2:o=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(o.url)&&r.onMessageReceived(o,a),U&&r.onMentionReceived(o,a)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=3;case 3:return[3,50];case 4:return t=null,"MEDI"===ne.code?t=ne.as(Pw):"FEDI"===ne.code?t=ne.as(Fw):"AEDI"===ne.code&&(t=ne.as(KS)),!t||(u=t.message).channelType!==Wy.OPEN?[3,6]:[4,this.getChannel(u.channelUrl,!0)];case 5:c=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(c.url)&&r.onMessageUpdated(c,u)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=6;case 6:return[3,50];case 7:return n=ne.as(lS),f=n.channelUrl,r=n.channelType,F=n.messageId,r!==Wy.OPEN?[3,9]:[4,this.getChannel(f,!0)];case 8:l=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(l.url)&&r.onMessageDeleted(l,F)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=9;case 9:return[3,50];case 10:return n=ne.as(QS),f=n.channelUrl,r=n.channelType,q=n.event,r!==Wy.OPEN?[3,12]:[4,this.getChannel(f,!0)];case 11:j=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onReactionUpdated(j,q)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=12;case 12:return[3,50];case 13:return(s=ne.as(zS).event).channelType!==Wy.OPEN?[3,15]:[4,this.getChannel(s.channelUrl,!0)];case 14:H=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onThreadInfoUpdated(H,s)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=15;case 15:return[3,50];case 16:G=ne.as(VS).openChannelMemberCounts,h=[],e.label=17;case 17:e.trys.push([17,22,23,24]),i=se(G),d=i.next(),e.label=18;case 18:return d.done?[3,21]:(p=d.value,f=p.channelUrl,E=p.participantCount,p=p.updatedAt,[4,this.getChannelFromCache(f)]);case 19:(v=e.sent())&&v._updateParticipantCount(E,p)&&h.push(v),e.label=20;case 20:return d=i.next(),[3,18];case 21:return[3,24];case 22:return v=e.sent(),ee={error:v},[3,24];case 23:try{d&&!d.done&&(te=i.return)&&te.call(i)}finally{if(ee)throw ee.error}return[7];case 24:return 0<h.length?[4,this.upsertChannelsToCache(h)]:[3,26];case 25:e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onChannelMemberCountChanged(h)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=26;case 26:return[3,50];case 27:if((_=ne.as(HS).event).isOpenChannelEvent)switch(_.category){case cS.CHANNEL_ENTER:return[3,28];case cS.CHANNEL_EXIT:return[3,30];case cS.CHANNEL_OPERATOR_UPDATE:return[3,32];case cS.USER_CHANNEL_MUTE:case cS.USER_CHANNEL_UNMUTE:return[3,34];case cS.USER_CHANNEL_BAN:case cS.USER_CHANNEL_UNBAN:return[3,36];case cS.CHANNEL_FREEZE:case cS.CHANNEL_UNFREEZE:return[3,38];case cS.CHANNEL_DELETED:return[3,40];case cS.CHANNEL_PROP_CHANGED:return[3,43];case cS.CHANNEL_META_DATA_CHANGED:return[3,45];case cS.CHANNEL_META_COUNTERS_CHANGED:return[3,47]}return[3,49];case 28:return[4,this.getChannel(_.channelUrl,!0)];case 29:return y=e.sent(),g=ne.as(NC),E=g.participantCount,V=g.user,B=y._updateParticipantCount(E,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserEntered(y,V),B&&e.onChannelParticipantCountChanged(y)}),[2]})})}),[3,49];case 30:return[4,this.getChannel(_.channelUrl,!0)];case 31:return m=e.sent(),g=ne.as(OC),E=g.participantCount,K=g.user,Q=m._updateParticipantCount(E,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserExited(m,K),Q&&e.onChannelParticipantCountChanged(m)}),[2]})})}),[3,49];case 32:return[4,this.getChannel(_.channelUrl,!0)];case 33:return b=e.sent(),I=ne.as(GS).operators,b.operators=I,this.upsertChannelsToCache([b]),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onOperatorUpdated(b,I)}),[2]})})}),[3,49];case 34:return[4,this.getChannel(_.channelUrl,!0)];case 35:return T=e.sent(),w=_.category===cS.USER_CHANNEL_MUTE,S=ne.as(w?QT:$T).user,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){w?e.onUserMuted(T,S):e.onUserUnmuted(T,S)}),[2]})})}),[3,49];case 36:return[4,this.getChannel(_.channelUrl,!0)];case 37:return C=e.sent(),k=_.category===cS.USER_CHANNEL_BAN,z=ne.as(k?aw:fw).user,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){k?e.onUserBanned(C,z):e.onUserUnbanned(C,z)}),[2]})})}),[3,49];case 38:return[4,this.getChannel(_.channelUrl,!0)];case 39:return N=e.sent(),W=ne.as(Aw).freeze,N.isFrozen=W,this.upsertChannelsToCache([N]),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){W?e.onChannelFrozen(N):e.onChannelUnfrozen(N)}),[2]})})}),[3,49];case 40:return[4,this.getChannel(_.channelUrl,!0)];case 41:return A=e.sent(),[4,this.removeChannelsFromCache([A.url])];case 42:return e.sent(),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelDeleted(A.url,A.channelType)}),[2]})})}),[3,49];case 43:return[4,this.getChannelWithoutCache(_.channelUrl,!0)];case 44:return Y=e.sent(),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelChanged(Y)}),[2]})})}),[3,49];case 45:return[4,this.getChannel(_.channelUrl,!0)];case 46:return O=e.sent(),L=ne.as(rT),R=L.created,D=L.updated,M=L.deleted,R&&O._upsertCachedMetaData(R,_.ts),D&&O._upsertCachedMetaData(D,_.ts),M&&O._removeFromCachedMetaData(M,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){R&&e.onMetaDataCreated(O,R),D&&e.onMetaDataUpdated(O,D),M&&e.onMetaDataDeleted(O,M)}),[2]})})}),[3,49];case 47:return[4,this.getChannel(_.channelUrl,!0)];case 48:return x=e.sent(),L=ne.as(pT),X=L.created,J=L.updated,Z=L.deleted,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){X&&e.onMetaCounterCreated(x,X),J&&e.onMetaCounterUpdated(x,J),Z&&e.onMetaCounterDeleted(x,Z)}),[2]})})}),[3,49];case 49:return[3,50];case 50:return[3,52];case 51:if($=e.sent(),D_($))throw $;return[3,52];case 52:return[2]}})})},QC.prototype.addHandler=function(e,t){this._openChannelHandlers.set(e,t)},QC.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},QC.prototype.clearHandler=function(){this._openChannelHandlers.clear()},QC.prototype.getChannel=function(n,e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:C(l("string",n)).throw(p.invalidParameters),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.getChannelFromCache(n)];case 2:return(t=e.sent())?[2,t]:[3,4];case 3:return e.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(n)];case 5:return[2,e.sent()]}})})},QC.prototype.getChannelWithoutCache=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)).throw(p.invalidParameters),t=new cC({channelUrl:r,isInternalCall:i}),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(lC).channel,[4,this.upsertChannelsToCache([n])];case 2:return e.sent(),[2,n]}})})},QC.prototype.createChannel=function(i){return re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){switch(e.label){case 0:return i=f(f({},uC),i),C(h("string",(t=i).operatorUserIds,!0)&&(l("string",t.coverUrlOrImage)||L_(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&l("string",t.name,!0)&&l("string",t.data,!0)&&l("string",t.customType,!0)&&(l("string",t.channelUrl)&&/^\w+$/.test(t.channelUrl)||null===t.channelUrl)).throw(p.invalidParameters),n=new hC(i),[4,this._requestQueue.send(n)];case 1:return n=e.sent(),r=n.as(lC).channel,this.upsertChannelsToCache([r]),[2,r]}var t})})},QC),MC={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},xC=(s(KC,bC=o),KC),LC=(s(BC,EC=v),BC),PC=(s(VC,gC=W),VC.prototype._validate=function(){return gC.prototype._validate.call(this)},VC.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=k.of(this._iid).requestQueue,n=new xC(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(LC),r=n.participants,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},VC),UC=(s(GC,mC=o),GC),FC=(s(HC,yC=v),HC),qC=(s(jC,_C=o),jC);function jC(e){var t=this,e=e.channelUrl;return(t=_C.call(this)||this).method=S.DELETE,t.path="".concat(Pm,"/").concat(encodeURIComponent(e)),t}function HC(e,t){var n=yC.call(this,e,t)||this;return n.channel=new ik(e,t),n}function GC(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,i=e.name,s=e.data,a=e.customType,e=e.operatorUserIds;return(t=mC.call(this)||this).method=S.PUT,t.path="".concat(Pm,"/").concat(encodeURIComponent(n)),t.params=w({cover_url:l("string",r)?r:null,cover_file:L_(r)?r:null,name:i,data:s,custom_type:a,operators:e}),t}function VC(e,t,n){return gC.call(this,e,t,Wy.OPEN,n)||this}function BC(t,e){var n=EC.call(this,t,e)||this,r=(n.token=null,n.participants=[],e.next),e=e.participants;return n.token=r,n.participants=e.map(function(e){return new u(t,e)}),n}function KC(e){var t=this,n=e.channelUrl,r=e.token,e=e.limit;return(t=bC.call(this)||this).method=S.GET,t.path="".concat(Pm,"/").concat(encodeURIComponent(n),"/participants"),t.params={token:r,limit:e},t}function QC(e,t){var n=t.sdkState,r=t.dispatcher,t=t.requestQueue,a=this;this._sdkState=n,this._requestQueue=t,this._dispatcher=r,this._openChannelCache=new oC(e),this._openChannelHandlers=new Map,this._dispatcher.on(function(e){var t,n;if(e instanceof wy)a._handleEvent(e);else if(e instanceof ym&&e.stateType===Ly.CONNECTED){var r=a._openChannelCache.enteredChannels;try{for(var i=se(r),s=i.next();!s.done;s=i.next())s.value.enter()}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}),RC[e]=this}function zC(e,t,n){var r,i=this,i=IC.call(this,e,"EXIT",n)||this;return n.data&&(i.participantCount=null!=(r=n.data.participant_count)?r:0,i.user=new u(e,n.data),i.ts=null!=(r=n.data.edge_ts)?r:0),i}function WC(e){e=e.channelUrl;return TC.call(this,{code:"EXIT",payload:{channel_url:e},ackRequired:!0})||this}function YC(e,t,n){var r,i=this,i=wC.call(this,e,"ENTR",n)||this;return n.data&&(i.participantCount=null!=(r=n.data.participant_count)?r:0,i.user=new u(e,n.data),i.ts=null!=(r=n.data.edge_ts)?r:0),i}function XC(e){e=e.channelUrl;return SC.call(this,{code:"ENTR",payload:{channel_url:e},ackRequired:!0})||this}s(function(e,t){return CC.call(this,e,t)||this},CC=v);s(_k,rk=bS),_k.payloadify=function(e){return e?w(f(f({},bS.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map(function(e){return u.payloadify(e)})})):null},_k.prototype.serialize=function(){return Dg(this)},_k.prototype.isOperator=function(t){return t instanceof u?this.isOperator(t.userId):this.operators.some(function(e){return e.userId===t})},_k.prototype._updateParticipantCount=function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)},_k.prototype.createParticipantListQuery=function(e){return new PC(this._iid,this.url,e)},_k.prototype.refresh=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,DC.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}})})},_k.prototype.enter=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new kC({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(NC),r=n.participantCount,i=n.ts,this._updateParticipantCount(r,i),DC.of(this._iid).setEnteredToCache(this),[2]}})})},_k.prototype.exit=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new AC({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(OC),r=n.participantCount,i=n.ts,this._updateParticipantCount(r,i),DC.of(this._iid).setExitedToCache(this),$0.of(this._iid).fileMessageQueue.cancel(this),[2]}})})},_k.prototype.updateChannel=function(s){return re(this,void 0,void 0,function(){var n,r,i;return ie(this,function(e){switch(e.label){case 0:return s=f(f({},MC),s),C(h("string",(t=s).operatorUserIds,!0)&&(l("string",t.coverUrlOrImage)||L_(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&l("string",t.name,!0)&&l("string",t.data,!0)&&l("string",t.customType,!0)).throw(p.invalidParameters),r=k.of(this._iid).requestQueue,n=new UC(f({channelUrl:this.url},s)),[4,r.send(n)];case 1:return r=e.sent(),i=r.as(FC).channel,[4,DC.of(this._iid).upsertChannelsToCache([i])];case 2:return e.sent(),[2,i]}var t})})},_k.prototype.updateChannelWithOperatorUserIds=function(n,r,i,s,a){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=f(f({},MC),{name:n,coverUrlOrImage:r,data:i,operatorUserIds:s,customType:a}),[2,this.updateChannel(t)]})})},_k.prototype.delete=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new qC({channelUrl:this.url}),[4,t.send(n)];case 1:return e.sent(),[4,DC.of(this._iid).removeChannelsFromCache([this.url])];case 2:return e.sent(),[2]}})})};var JC,ZC,$C,ek,tk,nk,rk,ik=_k,sk=(s(vk,nk=function(){this.onUserMuted=yy,this.onUserUnmuted=yy,this.onUserBanned=yy,this.onUserUnbanned=yy,this.onChannelChanged=yy,this.onChannelDeleted=yy,this.onChannelFrozen=yy,this.onChannelUnfrozen=yy,this.onOperatorUpdated=yy,this.onChannelMemberCountChanged=yy,this.onMetaDataCreated=yy,this.onMetaDataUpdated=yy,this.onMetaDataDeleted=yy,this.onMetaCounterCreated=yy,this.onMetaCounterUpdated=yy,this.onMetaCounterDeleted=yy,this.onMessageReceived=yy,this.onMessageUpdated=yy,this.onMessageDeleted=yy,this.onMentionReceived=yy,this.onReactionUpdated=yy,this.onThreadInfoUpdated=yy}),s(pk,tk=vk),pk),ak=(s(fk,ek=o),fk),ok=(s(dk,$C=v),dk),uk=(s(hk,ZC=Ea),hk.prototype._validate=function(){return ZC.prototype._validate.call(this)&&l("boolean",this.includeFrozen)&&l("boolean",this.includeMetaData)&&l("string",this.nameKeyword,!0)&&l("string",this.urlKeyword,!0)&&h("string",this.customTypes,!0)},hk.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,t=k.of(this._iid).requestQueue,n=new ak(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,3]:[3,6];case 1:return t=e.sent(),n=t.as(ok),r=n.channels,i=n.token,this._token=i,this._hasNext=!!i,[4,DC.of(this._iid).upsertChannelsToCache(r)];case 2:return e.sent(),this._isLoading=!1,[2,r];case 3:return[2,[]];case 4:throw p.queryInProgress;case 5:return[3,7];case 6:throw p.invalidParameters;case 7:return[2]}})})},hk),ck=(s(lk,JC=Sr),lk.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;JC.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new DC(e,{sdkState:n,dispatcher:r,requestQueue:s})},lk.prototype.createOpenChannelListQuery=function(e){return new uk(this._iid,e=void 0===e?{}:e)},lk.prototype.addOpenChannelHandler=function(e,t){this._manager.addHandler(e,t)},lk.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},lk.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},lk.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},lk.prototype.getChannel=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.getChannel(t)]})})},lk.prototype.getChannelWithoutCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.getChannelWithoutCache(t)]})})},lk.prototype.createChannel=function(t){return void 0===t&&(t={}),re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.createChannel(t)]})})},lk.prototype.createChannelWithOperatorUserIds=function(n,r,i,s,a){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return(t=f({},uC)).name=n,t.coverUrlOrImage=r,t.data=i,t.operatorUserIds=s,t.customType=a,[2,this._manager.createChannel(t)]})})},lk);function lk(){var e=null!==JC&&JC.apply(this,arguments)||this;return e.name="openChannel",e}function hk(e,t){var n=this;return(n=ZC.call(this,e,t)||this).includeFrozen=!0,n.includeMetaData=!0,n.nameKeyword=null,n.urlKeyword=null,n.customTypes=null,n.includeFrozen=null==(e=t.includeFrozen)||e,n.includeMetaData=null==(e=t.includeMetaData)||e,n.nameKeyword=null!=(e=t.nameKeyword)?e:null,n.urlKeyword=null!=(e=t.urlKeyword)?e:null,n.customTypes=null!=(e=t.customTypes)?e:null,n}function dk(t,e){var n=$C.call(this,t,e)||this,r=(n.token=null,n.channels=[],n.ts=null,e.next),i=e.channels,e=e.ts;return n.token=r,i&&0<i.length&&(n.channels=i.map(function(e){return new ik(t,e)})),n.ts="number"==typeof e?e:null,n}function fk(e){var t=this,n=e.token,r=e.limit,i=e.nameKeyword,s=e.urlKeyword,a=e.customTypes,o=e.includeFrozen,e=e.includeMetaData;return(t=ek.call(this)||this).method=S.GET,t.path=Pm,t.params=w({token:n,limit:r,name_contains:i,url_contains:s,custom_types:a,show_frozen:o,show_metadata:e}),t}function pk(t){void 0===t&&(t={});var n=tk.call(this)||this;return Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&(n[e]=t[e])}),n}function vk(){var e=null!==nk&&nk.apply(this,arguments)||this;return e.onUserEntered=yy,e.onUserExited=yy,e.onChannelParticipantCountChanged=yy,e}function _k(t,e){var n,r=this;return(r=rk.call(this,t,e)||this)._lastParticipantCountUpdated=0,r.participantCount=0,r.operators=[],r.channelType=Wy.OPEN,r.participantCount=null!=(n=e.participant_count)?n:0,r.operators=Array.isArray(e.operators)?e.operators.map(function(e){return new u(t,e)}):[],r}function yk(c){return function(e,t,n,r){Ek(t);var i=bk(e),s=Ik(i),a=Tk(i),o=c?a-1:0,u=c?-1:1;if(n<2)for(;;){if(o in s){r=s[o],o+=u;break}if(o+=u,c?o<0:a<=o)throw wk("Reduce of empty array with no initial value")}for(;c?0<=o:o<a;o+=u)o in s&&(r=t(r,s[o],o,i));return r}}var mk="LIVE_EVENT_MANAGER",gk=function(){function t(e){var n=this;y(this,t),this._liveEvents=[],this._ctx=e,this._ctx.sb.openChannel.addOpenChannelHandler(mk,new sk({onUserBanned:function(t,e){e.userId===n._ctx.sb.currentUser.userId&&(e=n._liveEvents.find(function(e){return(null==(e=e.openChannel)?void 0:e.url)===t.url}))&&e.onDisconnected()}}))}var n,r,i;return m(t,[{key:"createLiveEvent",value:(i=_(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Af.createLiveEvent(vc.SINGLE_HOST,t.userIdsForHost?[].concat(V(t.userIdsForHost),[this.userId]):[this.userId],t.title,t.coverUrl,t.coverFile,t.customItems),e.next=3,this._ctx.commandRouter.send(n);case 3:return n=e.sent,r=n.payload.liveEvent,r=new C_({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:r}),e.prev=6,e.next=9,r.fetchOpenChannel();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),T.error("failed to fetch initial open channel");case 14:return this._liveEvents.push(r),e.abrupt("return",r);case 16:case"end":return e.stop()}},e,this,[[6,11]])})),function(e){return i.apply(this,arguments)})},{key:"getLiveEvent",value:(r=_(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Af.createGetLiveEvent(t),e.next=3,this._ctx.commandRouter.send(n);case 3:return n=e.sent,r=n.payload.liveEvent,e.abrupt("return",this.deserializeLiveEvent(r));case 6:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"deserializeLiveEvent",value:(n=_(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1<(n=this._liveEvents.findIndex(function(e){return e.liveEventId===t.liveEventId})))return(r=this._liveEvents[n]).upsert(t),e.prev=4,e.next=7,r.fetchOpenChannel();e.next=15;break;case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),T.error("failed to fetch initial open channel");case 12:return e.abrupt("return",r);case 15:return i=new C_({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:t}),e.prev=16,e.next=19,i.fetchOpenChannel();case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(16),T.error("failed to fetch initial open channel");case 24:return this._liveEvents.push(i),e.abrupt("return",i);case 26:case"end":return e.stop()}},e,this,[[4,9],[16,21]])})),function(e){return n.apply(this,arguments)})},{key:"clear",value:function(){this._liveEvents=[],this._ctx.sb.openChannel.removeOpenChannelHandler(mk);var e,t=Q(this._liveEvents);try{for(t.s();!(e=t.n()).done;)e.value.teardown()}catch(e){t.e(e)}finally{t.f()}}}]),t}(),Ek=Te,bk=pe,Ik=Le,Tk=Oe,wk=TypeError,go=Vn,Sk={left:yk(!1),right:yk(!0)}.left,xi=ot,r=qi,t=(go({target:"Array",proto:!0,forced:!yl("reduce")||!r&&79<xi&&xi<83},{reduce:function(e){var t=arguments.length;return Sk(this,e,t,1<t?arguments[1]:void 0)}}),function(){function n(e,t){y(this,n),this.key=e,this.value=t}return m(n,[{key:"toString",value:function(){return this.key}},{key:"equals",value:function(e){return this.value.width===e.value.width&&this.value.height===e.value.height}}]),n}()),Ck=(g(t,"_720P",new t("_720P",{width:1280,height:720})),g(t,"_540P",new t("_540P",{width:960,height:540})),g(t,"_480P",new t("_480P",{width:848,height:480})),g(t,"_360P",new t("_360P",{width:640,height:360})),t._720P),kk=function(){E(i,Yf);var r=I(i);function i(e,t){var n;return y(this,i),g(b(n=r.call(this)),"hasPermission",!1),n._streamManger=e,n.constraints=t,n}return m(i,[{key:"stream",get:function(){return this._streamManger.stream}},{key:"dispose",value:function(){var e;this.removeAllEventListeners(),null!=(e=this.onDisposed)&&e.call(this)}},{key:"streamChanged",value:function(e){this._dispatchEvent("streamChanged",e)}},{key:"audioOutputChanged",value:function(){this._dispatchEvent("audioOutputChanged")}}]),i}(),Nk=At,Ak=Ee,Ok=Ae,Rk=Pu,Dk=le,Mk=we,xk=Pf,Lk=Uf;Lf("match",function(r,o,u){return[function(e){var t=Dk(this),n=null==e?void 0:Mk(e,r);return n?Nk(n,e,t):new RegExp(e)[r](Rk(t))},function(e){var t=Ak(this),n=Rk(e),e=u(o,t,n);if(e.done)return e.value;if(!t.global)return Lk(t,n);for(var r=t.unicode,i=[],s=t.lastIndex=0;null!==(a=Lk(t,n));){var a=Rk(a[0]);""===(i[s]=a)&&(t.lastIndex=xk(n,Ok(t.lastIndex),r)),s++}return 0===s?null:i}]});function Pk(e,t){var n,r,i,s,a;t.audio&&0===e.getAudioTracks().length&&e.addTrack((i=Uk=Uk||new(window.AudioContext||window.webkitAudioContext),Fk=i.createOscillator(),n=i.createMediaStreamDestination(),(r=i.createGain()).gain.setValueAtTime(0,i.currentTime),Fk.connect(r),r.connect(n),Fk.start(),Hk=n.stream.getAudioTracks()[0],n.stream.getAudioTracks()[0])),t.video&&0===e.getVideoTracks().length&&e.addTrack((i=x(x({},Ck.value),{},{frameRate:24}),s=i.width,a=i.height,i=i.frameRate,(qk=qk||document.createElement("canvas")).width=s,qk.height=a,qk.getContext("2d").fillRect(0,0,s,a),jk=jk||setInterval(function(){qk.getContext("2d").fillRect(0,0,s,a)},1e3),i=qk.captureStream(i),Gk=i.getVideoTracks()[0],i.getVideoTracks()[0]))}var Uk,Fk,qk,jk,Hk,Gk,In=ue,wt=xe,Vk=Pu,Bk=Ar.trim,er=Y,Kk=Me.parseInt,mr=Me.Symbol,Qk=mr&&mr.iterator,zk=/^[+-]?0x/i,Wk=wt(zk.exec),Qa=8!==Kk(er+"08")||22!==Kk(er+"0x16")||Qk&&!In(function(){Kk(Object(Qk))})?function(e,t){e=Bk(Vk(e));return Kk(e,t>>>0||(Wk(zk,e)?16:10))}:Kk;Vn({global:!0,forced:parseInt!=Qa},{parseInt:Qa});function Yk(){Hk&&Hk.stop(),Gk&&Gk.stop(),Gk=Hk=null,jk&&(clearInterval(jk),jk=null),Fk&&(Fk.onended=function(){Fk.disconnect(),Fk=null},Fk.stop())}function Xk(e){if(e){var t,n=Q(e.getTracks());try{for(n.s();!(t=n.n()).done;)t.value.stop()}catch(e){n.e(e)}finally{n.f()}}}function Jk(e,t,n){return(e=e.match(t))&&e.length>=n&&parseInt(e[n],10)}var Zk="safari"===function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;var t=window.navigator;if(t.mozGetUserMedia)e.browser="firefox",e.version=Jk(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)e.browser="chrome",e.version=Jk(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=Jk(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=Jk(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return e}().browser,$k=function(){function t(e){y(this,t),g(this,"_hasPermission",!1),this._deviceManager=e,this._updateQueued=!1}var e;return m(t,[{key:"updateStream",value:(e=_(regeneratorRuntime.mark(function e(){var t,n,r,i,s,a,o,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._updateAt)return this._updateQueued=!0,e.abrupt("return");e.next=3;break;case 3:if(t=this._deviceManager.mediaAccesses.some(function(e){return e.constraints.audio}),n=this._deviceManager.mediaAccesses.some(function(e){return e.constraints.video}),t||n){e.next=9;break}return Xk(this.stream),Yk(),e.abrupt("return");case 9:return this._updateAt=Date.now(),(r=this.stream)||(s=new MediaStream,Pk(s,{audio:t,video:n}),this.stream=s),Zk&&Xk(r),e.prev=13,e.next=16,this._deviceManager.getMediaConstraints({usingAudio:t,usingVideo:n});case 16:return s=e.sent,e.next=19,navigator.mediaDevices.getUserMedia(s);case 19:i=e.sent,this._hasPermission=!0,a=Q(this._deviceManager.mediaAccesses);try{for(a.s();!(o=a.n()).done;)o.value.hasPermission=!0}catch(e){a.e(e)}finally{a.f()}Yk(),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),i=new MediaStream;case 29:Pk(i,{audio:t,video:n}),Zk||Xk(r),this.stream=i,u=Q(this._deviceManager.mediaAccesses);try{for(u.s();!(c=u.n()).done;)c.value.streamChanged(this.stream)}catch(e){u.e(e)}finally{u.f()}delete this._updateAt,this._updateQueued?(this._updateQueued=!1,this.updateStream()):this._deviceManager.refreshMediaDevices({audio:t,video:n},!0);case 36:case"end":return e.stop()}},e,this,[[13,26]])})),function(){return e.apply(this,arguments)})}]),t}();function eN(e,t){return(null==e?void 0:e.deviceId)===(null==t?void 0:t.deviceId)&&(null==e?void 0:e.label)===(null==t?void 0:t.label)&&(null==e?void 0:e.groupId)===(null==t?void 0:t.groupId)}function tN(i){return function(e,t,n){var e=yN(mN(e)),t=_N(t),r=e.length,n=void 0===n?" ":yN(n);return t<=r||""==n?e:((r=gN(n,bN((t=t-r)/n.length))).length>t&&(r=EN(r,0,t)),i?e+r:r+e)}}var nN,rN,iN,sN,aN=function(){function t(){var e=this;y(this,t),this.mediaAccesses=[],this._availableMediaDevices={audioinput:[],audiooutput:[],videoinput:[]},this._currentMediaDevices={audioinput:void 0,audiooutput:void 0,videoinput:void 0},this._sendbirdCallListeners=new Map,this._streamManager=new $k(this),navigator.mediaDevices.ondevicechange=function(){return e._onDeviceChanged()}}var n,r,e,i;return m(t,[{key:"_onDeviceChanged",value:function(){0!==this.mediaAccesses.length&&this.refreshMediaDevices({audio:this.mediaAccesses.some(function(e){return e.constraints.audio}),video:this.mediaAccesses.some(function(e){return e.constraints.video})})}},{key:"addSendBirdCallListener",value:function(e,t){this._sendbirdCallListeners.set(e,t)}},{key:"removeSendBirdCallListener",value:function(e){this._sendbirdCallListeners.delete(e)}},{key:"removeAllSendBirdCallListener",value:function(){this._sendbirdCallListeners.clear()}},{key:"getCurrentAudioInputDevice",value:function(){return this._currentMediaDevices.audioinput}},{key:"getCurrentAudioOutputDevice",value:function(){return this._currentMediaDevices.audiooutput}},{key:"getCurrentVideoInputDevice",value:function(){return this._currentMediaDevices.videoinput}},{key:"getAvailableAudioInputDevices",value:function(){return this._availableMediaDevices.audioinput}},{key:"getAvailableAudioOutputDevices",value:function(){return this._availableMediaDevices.audiooutput}},{key:"getAvailableVideoInputDevices",value:function(){return this._availableMediaDevices.videoinput}},{key:"_updateStream",value:(i=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._streamManager.updateStream());case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_registerMediaAccess",value:function(e){var t=this;this.mediaAccesses.push(e),e.onDisposed=function(){return t.stopMedia(e)}}},{key:"useMedia",value:function(e){{if(e.audio||e.video)return e=new kk(this._streamManager,e),this._registerMediaAccess(e),this._updateStream(),e;T.error(new Error("you should set true for at least 1 media type."))}}},{key:"stopMedia",value:function(e){this.mediaAccesses.splice(this.mediaAccesses.indexOf(e),1),this._updateStream()}},{key:"fetchMediaDevices",value:(e=_(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.reduce(function(e,t){return e[t.kind].push(t),e},{audioinput:[],audiooutput:[],videoinput:[]}));case 4:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"getMediaConstraints",value:(r=_(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.usingAudio,r=t.usingVideo,i={audio:!1,video:!1},e.next=4,this.fetchMediaDevices();case 4:return s=e.sent,a=s.audioinput,s=s.videoinput,n&&a.length&&(a=this.getCurrentAudioInputDevice(),i.audio={deviceId:null==a?void 0:a.deviceId}),r&&s.length&&(a=this.getCurrentVideoInputDevice(),i.video=x(x({deviceId:null==a?void 0:a.deviceId},Ck.value),{},{frameRate:24})),e.abrupt("return",i);case 10:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_updateCurrentMediaDevice",value:function(e,t){var n,r=this._availableMediaDevices[e],i=this._currentMediaDevices[e],s=r.find(function(e){return e.deviceId===(null==t?void 0:t.deviceId)});return s||(T.warning("Selected device is unavailable. fallback to default device."),s=(null!=(n=s)?n:0<r.length)?r[0]:null),!eN(i,this._currentMediaDevices[e]=s)}},{key:"_onAudioOutputChanged",value:function(){var e,t=Q(this.mediaAccesses);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.constraints.audio&&n.audioOutputChanged()}}catch(e){t.e(e)}finally{t.f()}}},{key:"selectDevice",value:function(e,t){t.kind!==e?T.error(new Error("Tried to select invalid device of type")):this._updateCurrentMediaDevice(e,t)&&("audioinput"!==e&&"videoinput"!==e||this._updateStream(),"audiooutput"===e&&this._onAudioOutputChanged())}},{key:"_updateAvailableDevices",value:function(e,t){var n,r,i,s=this._currentMediaDevices[e];if(!!function(e,t){if(e.length===t.length){for(var n=0;n<t.length;n++)if(!eN(e[n],t[n]))return;return 1}}(this._availableMediaDevices[e],t))return!1;this._availableMediaDevices[e]=t,s=this._updateCurrentMediaDevice(e,s);var a,o=Q(this._sendbirdCallListeners.values());try{for(o.s();!(a=o.n()).done;){var u=a.value,c=this._currentMediaDevices[e];switch(e){case"audioinput":null!=(n=u.onAudioInputDeviceChanged)&&n.call(u,c,t);break;case"audiooutput":null!=(r=u.onAudioOutputDeviceChanged)&&r.call(u,c,t);break;case"videoinput":null!=(i=u.onVideoInputDeviceChanged)&&i.call(u,c,t)}}}catch(e){o.e(e)}finally{o.f()}return s}},{key:"refreshMediaDevices",value:(n=_(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.audio,r=t.video,i=1<l.length&&void 0!==l[1]&&l[1],n||r){e.next=4;break}throw new Error("at least one of the audio or video must be true");case 4:return e.next=6,this.fetchMediaDevices();case 6:o=e.sent,s=o.audioinput,a=o.audiooutput,o=o.videoinput,c=u=!1,n&&(u=this._updateAvailableDevices("audioinput",s),c=this._updateAvailableDevices("audiooutput",a)),r&&(u=this._updateAvailableDevices("videoinput",o)||u),!i&&u&&this._updateStream(),c&&this._onAudioOutputChanged();case 16:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]),t}(),oN="v1.0.0-beta.4",uN=function(){function t(e){y(this,t),this._parse=e}return m(t,[{key:"parseToJson",value:function(e){try{return JSON.parse(e)}catch(e){return{}}}},{key:"validate",value:function(e){var t=e.cmd,n=e.request_id,e=e.call_type;return!!(n||t||e)}},{key:"parseCommand",value:function(e){return e.error?{isValid:!0,error:{requestId:e.request_id,message:e.message,code:e.code}}:{isValid:!0,command:this._parse(e)}}},{key:"parse",value:function(e){e=this.parseToJson(e);return this.validate(e)?this.parseCommand(e):{isValid:!1}}}]),t}(),cN=function(){E(r,Yf);var n=I(r);function r(e){var t;return y(this,r),(t=n.call(this))._ctx=e,t._ws=null,t._retryTimer=null,t._closed=!0,t._sessionKey=null,t._requestMap=new n_(t._getTimeoutTime()),t._messageParser=new uN(t._ctx.parse),t._hostUrl=null!=(e=t._ctx.websocketHost)?e:"wss://ws-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",t._ctx.appId),t}return m(r,[{key:"connect",value:function(){var r=this;return new Promise(function(e,t){r._sessionKey||t(new Error("tried to connect to websocket server without auth")),r._ws=r._createWebSocket(),r._closed=!1,r._ws.onopen=function(){r._onOpen(),e(null)},r._ws.onmessage=function(e){var e=r._messageParser.parse(e.data),t=e.isValid,n=e.error,e=e.command;t&&(n?r._processError(n):r.processCommand(e))},r._ws.onerror=function(e){return r._onError(e)},r._ws.onclose=function(){r._onClose(),t(new Error("websocket connection failed"))}})}},{key:"_processError",value:function(e){var t=e.requestId,e=(e.code,e.message),t=this._requestMap.unregister(t);t&&t.reject(new Error(e))}},{key:"processCommand",value:function(e){this._dispatchEvent("command",e)}},{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._disconnect(),this._sessionKey=null}},{key:"_disconnect",value:function(){this._ws&&(this._closed=!0,this._removeRetryTimer(),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onerror=null,this._ws.onclose=null,this._ws.close(),this._requestMap.rejectAll(new Error("request failed due to websocket connection lost")),this._ws=null)}},{key:"isConnected",get:function(){return!!this._ws&&1===this._ws.readyState}},{key:"_onOpen",value:function(){}},{key:"_onError",value:function(e){}},{key:"_onClose",value:function(){this._startToReconnect()}},{key:"_createWebSocket",value:function(){var e="/?sbcall_session_token=".concat(encodeURIComponent(this._sessionKey),"&sbcall_client_id=").concat(encodeURIComponent(this._ctx.clientId),"&sendbird=").concat(encodeURIComponent(this._getVersion()));return new WebSocket(this._getHost()+e)}},{key:"_getVersion",value:function(){return"JS,".concat(this._getOsVersion(),",").concat(oN)}},{key:"_getHost",value:function(){return this._hostUrl}},{key:"_startToReconnect",value:function(){this._closed||this._retryTimer||(this._retryTimer=setTimeout(this._reconnect.bind(this),this._getRetryTime()))}},{key:"_reconnect",value:function(){this._removeRetryTimer(),this.connect().catch(function(){})}},{key:"_removeRetryTimer",value:function(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)}},{key:"_getTimeoutTime",value:function(){return 6e4}},{key:"_getRetryTime",value:function(){return 2e3}},{key:"_getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),r}(),lN=function(){function t(e){y(this,t),this._ctx=e,this._fetch=function(){var e;return(e=window).fetch.apply(e,arguments)},this._sessionKey=null,this._hostUrl=null!=(e=this._ctx.apiHost)?e:"https://api-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",this._ctx.appId)}var n;return m(t,[{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._sessionKey=null}},{key:"send",value:(n=_(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getApiOption){e.next=2;break}throw new Error("invalid api request ".concat(JSON.stringify(t)));case 2:if((n=t.getApiOption()).auth&&!this._sessionKey)throw new Error("tried to call private api without auth");e.next=5;break;case 5:return i=x({},n.headers),n.body instanceof FormData||(i["Content-Type"]="application/json"),i.SendBird="JS,".concat(this._getOsVersion(),",").concat(oN),i["SBCall-Client-Id"]=this._ctx.clientId,this._sessionKey&&(i["SBCall-Session-Token"]=this._sessionKey),e.next=12,this._fetch("".concat(this._getHost()).concat(n.path),{method:n.method,body:n.body instanceof FormData?n.body:JSON.stringify(n.body),headers:i});case 12:return r=e.sent,e.next=15,r.text();case 15:i=e.sent,s=null,e.prev=17,s=JSON.parse(i),e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(17),new Error("malformed data");case 24:if(r.ok){e.next=34;break}if(s.error)throw new Error("server error");e.next=29;break;case 29:if(500===r.status)throw new Error("internal server error");e.next=31;break;case 31:if(300<=r.status&&r.status<400)throw new Error("malformed data");e.next=33;break;case 33:throw new Error("request failed");case 34:if(e.prev=34,a=this._ctx.parseResponse(t,s))return e.abrupt("return",a);e.next=38;break;case 38:e.next=43;break;case 40:return e.prev=40,e.t1=e.catch(34),e.abrupt("return",s);case 43:return e.abrupt("return",s);case 44:case"end":return e.stop()}},e,this,[[17,21],[34,40]])})),function(e){return n.apply(this,arguments)})},{key:"_getHost",value:function(){return this._hostUrl}},{key:"_getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),t}(),hN=function(){E(s,Yf);var t,n,r,i=I(s);function s(e){var t;return y(this,s),(t=i.call(this))._ctx=e,t.wsClient=new cN(x(x({},e),{},{parse:function(e){return Af.parse(e)}})),t.apiClient=new lN(x(x({},e),{},{parseResponse:function(e,t){return Af.parseResponse(e,t)}})),t._unsubscriber=t.wsClient.on("command",function(e){t._dispatchEvent("command",e)}),t}return m(s,[{key:"connectWs",value:function(){return this.wsClient.connect()}},{key:"sendAPI",value:function(e){return this.apiClient.send(e)}},{key:"send",value:(r=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sendAPI(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"sendWithRetry",value:(n=_(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o=this,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<u.length&&void 0!==u[1]?u[1]:new e_,s=2<u.length&&void 0!==u[2]?u[2]:{count:0,deferred:new Zv},r=s.deferred,i=s.count,e.prev=3,e.next=6,this.send(t);case 6:s=e.sent,r.resolve(s),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),0<(a=n.calcTimeout(i))?setTimeout(function(){o.sendWithRetry(t,n,{count:i+1,deferred:r})},a):r.reject(e.t0);case 14:return e.abrupt("return",r.promise);case 15:case"end":return e.stop()}},e,this,[[3,10]])})),function(e){return n.apply(this,arguments)})},{key:"_setSessionKey",value:function(e){this.apiClient.setSessionKey(e),this.wsClient.setSessionKey(e)}},{key:"authenticate",value:(t=_(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userId,r=t.accessToken,e.prev=1,e.next=4,this._ctx.sb.connect(n,r);case 4:return i=Af.createAuth(this._ctx.appId,n,r),e.next=7,this.send(i);case 7:i=e.sent,this._setSessionKey(i.sbcall_session_token),this._ctx.liveEventManager.userId=i.user.user_id,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(1),T.error("failed to authenticate user ".concat(n)),e.t0;case 16:case"end":return e.stop()}},e,this,[[1,12]])})),function(e){return t.apply(this,arguments)})},{key:"deauthenticate",value:function(){this.apiClient.clearSessionKey(),this.wsClient.clearSessionKey()}}]),s}(),dN=ke,fN=Pu,pN=le,vN=RangeError,ht=xe,_N=Ae,yN=Pu,mN=le,gN=ht(function(e){var t=fN(pN(this)),n="",r=dN(e);if(r<0||r==1/0)throw vN("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}),EN=ht("".slice),bN=Math.ceil,Oi={start:tN(!1),end:tN(!0)},Ri=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(et),pr=Vn,IN=Oi.start,TN=(pr({target:"String",proto:!0,forced:Ri},{padStart:function(e){return IN(this,e,1<arguments.length?arguments[1]:void 0)}}),{VERBOSE:{level:-1,name:ml.VERBOSE,public:!1},DEBUG:{level:1,name:ml.DEBUG,public:!1},INFO:{level:2,name:ml.INFO,public:!0},WARNING:{level:3,name:ml.WARNING,public:!0},ERROR:{level:4,name:ml.ERROR,public:!0},NONE:{level:100,name:ml.NONE,public:!0}}),wN=function(){function t(e){y(this,t),this.level=e||ml.NONE}return m(t,[{key:"setLoggerLevel",value:function(e){var t;return null!=(t=TN[e])&&t.public&&(this.level=e),this.level}},{key:"_enabledFor",value:function(e){try{return TN[this.level].level<=TN[e].level}catch(e){return!1}}}]),t}(),SN=function(){E(n,wN);var t=I(n);function n(e){return y(this,n),t.call(this,e)}return m(n,[{key:"_getLogType",value:function(e){switch(e){case ml.ERROR:return"error";case ml.WARNING:return"warn";default:return"log"}}},{key:"_getTimeString",value:function(e){var t=e.getFullYear().toString().padStart(2,"0"),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),a=e.getSeconds().toString().padStart(2,"0"),e=e.getMilliseconds().toString().padStart(2,"0");return"[".concat(t,".").concat(n,".").concat(r," ").concat(i,":").concat(s,":").concat(a,":").concat(e,"]")}},{key:"_permit",value:function(e){var t=this._getLogType(e),n=new Date;if(this._enabledFor(e)&&console&&console[t]){for(var n="".concat(this._getTimeString(n)," [").concat(e,"]"),r=arguments.length,i=new Array(1<r?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];(e=console)[t].apply(e,[n].concat(i))}}}]),n}();(Cr=nN=nN||{}).SUCCESS="success",Cr.PENDING="pending",Cr.ERROR="error",(Di=rN=rN||{}).DEFAULT="default",Di.ALL="all",Di.MENTION_ONLY="mention_only",Di.OFF="off",(gr=iN=iN||{}).FCM="gcm",gr.APNS="apns",gr.UNKNOWN="unknown",(ut=sN=sN||{}).ALTERNATIVE="alternative",ut.DEFAULT="default";var CN;(Tn=CN=CN||{}).LATEST_LAST_MESSAGE="latest_last_message",Tn.CHRONOLOGICAL="chronological",Tn.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",Tn.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";function kN(e){switch(e){case CN.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case CN.CHRONOLOGICAL:return["-createdAt","syncIndex"];case CN.CHANNEL_NAME_ALPHABETICAL:return["name"]}}ON.prototype.clone=function(){var t=new ON,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach(function(e){t[e]=n[e]}),t},ON.prototype.match=function(e){switch(this.messageTypeFilter){case Jy.USER:if(e.messageType!==Xy.USER)return!1;break;case Jy.FILE:if(e.messageType!==Xy.FILE)return!1;break;case Jy.ADMIN:if(e.messageType!==Xy.ADMIN)return!1}if(this.customTypesFilter&&0<this.customTypesFilter.length&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&0<this.senderUserIdsFilter.length){if(!(e instanceof zE))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case em.NONE:if(0<e.parentMessageId)return!1;break;case em.ONLY_REPLY_TO_CHANNEL:if(e instanceof zE&&0<e.parentMessageId&&!e.replyToChannel)return!1}return!0};var NN,AN=ON;function ON(){this.messageTypeFilter=Jy.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=em.NONE}(We=NN=NN||{}).CHANNEL_LATEST="channel_latest",We.NEWEST_CHILD_MESSAGE="newest_child_message";function RN(e){switch(e){case NN.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case NN.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}}f(f({},xb),{scheduledAt:null}),f(f({},_a),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1});var DN,MN,xN,LN,PN={},UN=(s(QN,LN=yo),QN.of=function(e){return PN[e]},Object.defineProperty(QN.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(QN.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),QN.prototype._serialize=function(e){if(0<e.messageId)throw p.invalidParameters;var t,n=f({},e.serialize());return e instanceof ZE?(e.messageParams&&(n.messageParams=Db(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,f(f({},Db(t)),{scheduledAt:t.scheduledAt})))):e instanceof t0&&(e.messageParams&&(n.messageParams=Ub(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,f(f({},Ub(t)),{scheduledAt:t.scheduledAt})))),n},QN.prototype._deserialize=function(e){return e?(e=f(f({},e),{messageId:parseInt(e.messageId)}),$0.of(this._iid).buildMessageFromSerializedData(e)):null},QN.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},QN.prototype.fetch=function(e){var t=e.channelUrl,i=void 0===t?null:t,t=e.filter,s=void 0===t?new AN:t,t=e.order,a=void 0===t?NN.CHANNEL_LATEST:t,t=e.sendingStatus,o=void 0===t?null:t,t=e.backward,u=void 0!==t&&t,t=e.parentMessageId,c=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(n=RN(a),t={"/where":function(e){return!!(a!==NN.NEWEST_CHILD_MESSAGE||c&&0!==e.parentMessageId&&e.parentMessageId===c)&&s.match(r._deserialize(e))}},i&&(t.channelUrl=i),o&&(t.sendingStatus=o),t={where:t,index:n,backward:u},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({})];case 2:return n=e.sent(),[2,Promise.all(n.map(function(o){return re(r,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return t=$0.of(this._iid),n=this._deserialize(o),(r=o.messageParams)?n instanceof ZE?(n.messageParams=t.buildUserMessageCreateParamsFromSerializedData(r,n),[3,4]):[3,1]:[3,4];case 1:return n instanceof t0?r.fileKey&&"string"==typeof r.fileKey&&Pb(r.fileType)?(i=r,[4,this.collection.getBlob(r.fileKey)]):[3,3]:[3,4];case 2:i.file=e.sent(),e.label=3;case 3:n.messageParams=t.buildFileMessageCreateParamsFromSerializedData(r,n),e.label=4;case 4:return n.scheduledInfo&&o.scheduledInfo&&o.scheduledInfo.scheduledMessageParams?n instanceof ZE?(s=o.scheduledInfo.scheduledMessageParams,n.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(s,n),[3,8]):[3,5]:[3,8];case 5:return n instanceof t0?(s=o.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof s.fileKey&&Pb(s.fileType)?(a=s,[4,this.collection.getBlob(s.fileKey)]):[3,7]:[3,8];case 6:a.file=e.sent(),e.label=7;case 7:n.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(s,n),e.label=8;case 8:return[2,n]}})})}))];case 3:return[2,[]]}})})},QN.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new AN),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.fetch({filter:n,order:NN.NEWEST_CHILD_MESSAGE,channelUrl:t.channelUrl,backward:!1,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},QN.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,3];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},QN.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},QN.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=se(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})},QN.prototype.removeMessagesOfChannel=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t}})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},QN.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},QN.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(i){return re(t,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return i instanceof t0?i.messageParams&&(t=i.messageParams).file&&Lb(t.file)?[4,this.collection.saveBlob(t.file,i.reqId)]:[3,2]:[3,4];case 1:r=e.sent(),t.fileKey=r,t.fileType=Mb.BLOB,e.label=2;case 2:return i.scheduledInfo&&i.scheduledInfo.scheduledMessageParams&&(n=i.scheduledInfo.scheduledMessageParams).file&&Lb(n.file)?[4,this.collection.saveBlob(n.file,i.reqId)]:[3,4];case 3:r=e.sent(),n.fileKey=r,n.fileType=Mb.BLOB,e.label=4;case 4:return[2]}})})}))];case 1:return e.sent(),[2]}})})},QN),FN={},qN=(s(KN,xN=yo),KN.of=function(e){return FN[e]},Object.defineProperty(KN.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(KN.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),KN.prototype._serialize=function(e){return f(f({},e.serialize()),{messageId:"".concat(e.messageId)})},KN.prototype._deserialize=function(e){return e=f(f({},e),{messageId:parseInt(e.messageId)}),$0.of(this._iid).buildMessageFromSerializedData(e)},KN.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},KN.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,t=e.limit,s=void 0===t?100:t,t=e.filter,a=void 0===t?new AN:t,t=e.order,o=void 0===t?NN.CHANNEL_LATEST:t,t=e.backward,u=void 0!==t&&t,t=e.parentMessageId,c=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=RN(o),t={where:{channelUrl:r,"/where":function(e){if(i)switch(o){case NN.CHANNEL_LATEST:if(!u&&e.createdAt>i||u&&e.createdAt<i)return!1;break;case NN.NEWEST_CHILD_MESSAGE:if(!c||0===e.parentMessageId||e.parentMessageId!==c)return!1}return a.match(n._deserialize(e))}},index:t,backward:u},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({limit:s})];case 2:return t=e.sent(),[2,Promise.all(t.map(function(i){return re(n,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=this._deserialize(i),(n=i.messageParams)?t instanceof ZE?(t.messageParams=n,[3,4]):[3,1]:[3,4];case 1:return t instanceof t0?n.fileKey&&"string"==typeof n.fileKey&&Pb(n.fileType)?(r=n,[4,this.collection.getBlob(n.fileKey)]):[3,3]:[3,4];case 2:r.file=e.sent(),e.label=3;case 3:t.messageParams=n,e.label=4;case 4:return[2,t]}})})}))];case 3:return[2,[]]}})})},KN.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new AN),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.fetch({channelUrl:t.channelUrl,token:Date.now(),limit:null,backward:!1,filter:n,order:NN.NEWEST_CHILD_MESSAGE,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},KN.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,5];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:return e.sent(),[4,this.upsertChildMessages(r)];case 3:return e.sent(),[4,this._unsentMessageCache.upsertChildMessages(r)];case 4:e.sent(),e.label=5;case 5:return[2]}})})},KN.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},KN.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=se(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})},KN.prototype.removeMessagesOfChannel=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:n},index:RN(NN.CHANNEL_LATEST)})]:[3,6];case 1:return e.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync"))];case 2:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync.meta"))];case 3:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs"))];case 4:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs.meta"))];case 5:e.sent(),e.label=6;case 6:return[2]}})})},KN.prototype.removeUnderOffset=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t,createdAt:{"<":n}},index:RN(NN.CHANNEL_LATEST)})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},KN.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},KN.prototype.countBetween=function(r,i,s){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=RN(NN.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:r,"/where":function(e){e=n._deserialize(e);return s.includes(e.createdAt)&&i.match(e)}},index:t}).count()]):[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},KN.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return r instanceof t0&&r.messageParams&&(t=r.messageParams).file&&Lb(t.file)?[4,this.collection.saveBlob(t.file,r.reqId)]:[3,2];case 1:n=e.sent(),t.fileKey=n,e.label=2;case 2:return[2]}})})}))];case 1:return e.sent(),[2]}})})},KN),jN=(s(BN,MN=F_),BN),HN={},GN=(VN.of=function(e){return HN[e]},VN.prototype.processNonAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=se(t),r=n.next();!r.done;r=n.next())0===(i=r.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=nm.FAILED,i.errorCode=d.ACK_TIMEOUT,this._dispatcher.dispatch(new N0({messages:[i],source:g0.LOCAL_MESSAGE_FAILED})))}catch(e){s={error:e}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}}return[2]}})})},VN.prototype.processAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=se(t),r=n.next();!r.done;r=n.next())(i=r.value).errorCode&&x_(i.errorCode)&&(s=(new Date).getTime(),a=i.createdAt+2592e5,s<=a?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),i.sendingStatus=nm.FAILED,this._dispatcher.dispatch(new N0({messages:[i],source:g0.LOCAL_MESSAGE_FAILED}))))}catch(e){o={error:e}}finally{try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}}return[2]}})})},VN.prototype.completeCurrentAndProcessNextAutoResend=function(e){this._localCacheEnabled&&(e.sendingStatus===nm.SUCCEEDED||e.sendingStatus===nm.FAILED&&!x_(e.errorCode))&&(0<=(e=this.indexOf(e))&&this._autoResendQueue.splice(e,1),0===e&&this._processNextAutoResend())},VN.prototype._fetchAllCachedPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return(t=UN.of(this._iid))?[4,t.fetch({sendingStatus:nm.PENDING,backward:!0})]:[3,2];case 1:return n=e.sent(),[3,3];case 2:n=[],e.label=3;case 3:return[2,n]}})})},VN.prototype.indexOf=function(e){return 0<this._autoResendQueue.length?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId):-1},VN.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId)},VN.prototype._processNextAutoResend=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{0<this._autoResendQueue.length?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new jN({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}return[2]})})},VN);function VN(e,t){var n=t.localCacheEnabled,r=t.dispatcher,i=t.sdkState,t=t.logger,s=this;(HN[e]=this)._iid=e,(HN[e]=this)._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=t,this._sdkState=i,this._localCacheEnabled&&r.on(function(e){if(e instanceof ym)switch(e.stateType){case Ly.CONNECTED:s._isProcessingAutoResend||s.processAutoResendRegisteredPendingMessages().then(function(){return s._processNextAutoResend()});break;case Ly.DISCONNECTED:s._isProcessingAutoResend=!1}})}function BN(e){var e=e.message,t=MN.call(this)||this;return t.message=e,t}function KN(e,t){var n=t.sdkState,r=t.cacheContext,t=t.unsentMessageCache,i=xN.call(this,e)||this;return i._sdkState=n,i._cacheContext=r,i._unsentMessageCache=t,FN[e]=i}function QN(e,t){var n=t.sdkState,t=t.cacheContext,r=LN.call(this,e)||this;return r._sdkState=n,r._cacheContext=t,PN[e]=r}(Ot=DN=DN||{})[Ot.USER_BLOCK=20001]="USER_BLOCK",Ot[Ot.USER_UNBLOCK=2e4]="USER_UNBLOCK",Ot[Ot.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED";d1.getDataAsUserBlockEvent=function(e,t){var t=t.data,n=t.blocker,t=t.blockee;return{blocker:new u(e,n),blockee:new u(e,t)}},d1.getDataAsFriendDiscoveredEvent=function(t,e){e=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(e)?e.map(function(e){return new u(t,e)}):[]}};var zN,WN,YN,XN,JN,ZN,$N=d1,e1=(s(h1,ZN=F_),h1),t1=(s(l1,JN=wy),l1),n1=(s(c1,XN=o),c1),r1=(s(u1,YN=v),u1),i1=(s(o1,WN=o),o1),s1=(s(a1,zN=v),a1);function a1(e,t){e=zN.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function o1(e){var t=e.userId,e=e.pushTriggerOption,n=WN.call(this)||this;return n.method=S.PUT,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push_preference"),n.params={push_trigger_option:e},n}function u1(e,t){e=YN.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function c1(e){var e=e.userId,t=XN.call(this)||this;return t.method=S.GET,t.path="".concat(Mm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function l1(e,t,n){e=JN.call(this,e,"USEV",n)||this;return e.event=new $N(n),e}function h1(e,t){var t=t.userId,n=ZN.call(this)||this;return n._iid=e,n.userId=t,n}function d1(e){this.category=e.cat,this.data=e.data}var f1,p1,v1,_1,y1,m1,g1={profileImage:null,profileUrl:null,nickname:null},E1=(s(function(){return null!==f1&&f1.apply(this,arguments)||this},f1=yo),s(A1,y1=Y_),Object.defineProperty(A1.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),A1.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=null,e.dispatch("pause")},3e4)),this._currentState=document.visibilityState},A1.prototype.start=function(){this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})},A1.prototype.stop=function(){this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})},A1),b1=(Object.defineProperty(N1.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),N1.prototype._onlineWorker=function(){this.connectionDelegate.reconnect()},N1.prototype._offlineWorker=function(){this.connectionDelegate.disconnect()},N1.prototype.start=function(){this.isAvailable&&(window.addEventListener("online",this._onlineWorker),window.addEventListener("offline",this._offlineWorker))},N1.prototype.stop=function(){this.isAvailable&&(window.removeEventListener("online",this._onlineWorker,!1),window.removeEventListener("offline",this._offlineWorker,!1))},N1.prototype.isOnline=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this.isAvailable?[2,navigator.onLine]:[2,new Promise(function(e,t){fetch("https://www.google.com",{method:S.GET}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},N1),I1=(s(k1,_1=o),k1),T1=(s(C1,v1=v),C1),w1=(s(S1,p1=o),S1);function S1(e){var t=e.userId,e=e.token,n=p1.call(this)||this;return n.method=S.POST,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push/apns"),n.params={apns_device_token:e,always_push:!0},n}function C1(e,t){var n=v1.call(this,e,t)||this;return n.user=null,n.user=new u(e,f({},t)),n}function k1(e){var t=e.userId,n=e.nickname,n=void 0===n?null:n,r=e.profileUrl,r=void 0===r?null:r,i=e.profileImage,i=void 0===i?null:i,e=e.preferredLanguages,e=void 0===e?null:e,s=_1.call(this)||this;return s.method=S.PUT,s.path="".concat(Mm,"/").concat(encodeURIComponent(t)),s.params=w({nickname:n,profile_url:r,profile_file:i,preferred_languages:e}),s}function N1(e){var t=e.logger,e=e.connectionDelegate,e=void 0===e?null:e;this.logger=t,e&&(this.connectionDelegate=e),this._onlineWorker=this._onlineWorker.bind(this),this._offlineWorker=this._offlineWorker.bind(this)}function A1(){var e=y1.call(this)||this;return e._pauseDelayTimer=null,e._currentState="visible",e._toggleState=e._toggleState.bind(e),e}s(function(e,t){var n=m1.call(this,e,t)||this;return n.token=t.token,n.type=t.type?iN[t.type.toLowerCase()]:iN.UNKNOWN,n.user=new u(e,t.user),n},m1=v);s(M1,O1=o);var O1,R1,D1=M1;function M1(e){var t=e.userId,e=e.token,n=O1.call(this)||this;return n.method=S.POST,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push/gcm"),n.params={gcm_reg_token:e,always_push:!0},n}s(function(e,t){var n=R1.call(this,e,t)||this;return n.token=t.token,n.type=t.type?iN[t.type.toLowerCase()]:iN.UNKNOWN,n.user=new u(e,t.user),n},R1=v);s(U1,x1=o);var x1,L1,P1=U1;function U1(e){var t=e.userId,e=e.token,n=x1.call(this)||this;return n.method=S.DELETE,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push/apns/").concat(encodeURIComponent(e)),n}s(function(e,t){var n=L1.call(this,e,t)||this;return n.token=t.token,n.user=new u(e,t.user),n},L1=v);s(H1,F1=o);var F1,q1,j1=H1;function H1(e){var t=e.userId,e=e.token,n=F1.call(this)||this;return n.method=S.DELETE,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push/gcm/").concat(encodeURIComponent(e)),n}s(function(e,t){var n=q1.call(this,e,t)||this;return n.token=t.token,n.user=new u(e,t.user),n},q1=v);s(K1,G1=o);var G1,V1,B1=K1;function K1(e){var e=e.userId,t=G1.call(this)||this;return t.method=S.DELETE,t.path="".concat(Mm,"/").concat(encodeURIComponent(e),"/push/apns"),t}s(function(e,t){var n=V1.call(this,e,t)||this;return n.type=t.type?iN[t.type.toLowerCase()]:iN.UNKNOWN,n.user=new u(e,t.user),n},V1=v);s(Y1,Q1=o);var Q1,z1,W1=Y1;function Y1(e){var e=e.userId,t=Q1.call(this)||this;return t.method=S.DELETE,t.path="".concat(Mm,"/").concat(encodeURIComponent(e),"/push/gcm"),t}s(function(e,t){var n=z1.call(this,e,t)||this;return n.type=t.type?iN[t.type.toLowerCase()]:iN.UNKNOWN,n.user=new u(e,t.user),n},z1=v);s(HA,lA=o);var X1,J1,Z1,$1,eA,tA,nA,rA,iA,sA,aA,oA,uA,cA,lA,hA,dA=HA,fA=(s(jA,cA=v),jA),pA=(s(qA,uA=o),qA),vA=(s(FA,oA=v),FA),_A=(s(UA,aA=o),UA),yA=(s(PA,sA=v),PA),mA=(s(LA,iA=o),LA),gA=(s(xA,rA=v),xA),EA=(s(MA,nA=o),MA),bA=(s(DA,tA=v),DA),IA=(s(RA,eA=o),RA),TA=(s(OA,$1=v),OA),wA=(s(AA,Z1=o),AA),SA=(s(NA,J1=v),NA),CA=(s(kA,X1=o),kA);function kA(e){var t=e.userId,e=e.blockedUserId,n=X1.call(this)||this;return n.method=S.POST,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/block"),n.params={target_id:e},n}function NA(e,t){e=J1.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function AA(e){var t=e.userId,n=e.snoozeOn,r=e.startTs,e=e.endTs,i=Z1.call(this)||this;return i.method=S.PUT,i.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push_preference"),i.params={snooze_enabled:n,snooze_start_ts:r,snooze_end_ts:e},i}function OA(e,t){e=$1.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function RA(e){var e=e.userId,t=eA.call(this)||this;return t.method=S.GET,t.path="".concat(Mm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function DA(e,t){e=tA.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function MA(e){var t=e.userId,n=e.doNotDisturbOn,r=e.startHour,i=e.startMin,s=e.endHour,a=e.endMin,e=e.timezone,o=nA.call(this)||this;return o.method=S.PUT,o.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push_preference"),o.params={do_not_disturb:n,start_hour:r,start_min:i,end_hour:s,end_min:a,timezone:e},o}function xA(e,t){e=rA.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function LA(e){var e=e.userId,t=iA.call(this)||this;return t.method=S.GET,t.path="".concat(Mm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function PA(e,t){e=sA.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function UA(e){var t=e.userId,e=e.willAutoAccept,n=aA.call(this)||this;return n.method=S.PUT,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/channel_invitation_preference"),n.params={auto_accept:e},n}function FA(e,t){e=oA.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function qA(e){var e=e.userId,t=uA.call(this)||this;return t.method=S.GET,t.path="".concat(Mm,"/").concat(encodeURIComponent(e),"/channel_invitation_preference"),t}function jA(e,t){e=cA.call(this,e,t)||this;return e.pushTokens={type:t.type?iN[t.type.toLowerCase()]:iN.UNKNOWN,deviceTokens:t.device_tokens,hasMore:t.has_more,token:t.token},e}function HA(e){var t=e.userId,n=e.type,r=e.token,e=e.ts,i=lA.call(this)||this;return i.method=S.GET,i.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push/").concat(encodeURIComponent(n),"/device_tokens"),i.params={created_ts:e,token:r},i}s(function(e,t){var n=hA.call(this,e,t)||this;return n.user=new u(e,t),n},hA=v);s(KA,GA=o);var GA,VA,BA=KA;function KA(e){var t=e.userId,e=e.unblockedUserId,n=GA.call(this)||this;return n.method=S.DELETE,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/block/").concat(encodeURIComponent(e)),n}s(function(){return null!==VA&&VA.apply(this,arguments)||this},VA=v);s(gO,eO=o);var QA,zA,WA,YA,XA,JA,ZA,$A,eO,tO,nO=gO,rO=(s(mO,$A=v),mO),iO=(s(yO,ZA=o),yO),sO=(s(_O,JA=v),_O),aO=(s(vO,XA=o),vO),oO=(s(pO,YA=v),pO),uO=(s(fO,WA=o),fO),cO=(s(dO,zA=v),dO),lO=(s(hO,QA=o),hO);function hO(e){var t=e.userId,e=e.discoveryKeys,n=QA.call(this)||this;return n.method=S.DELETE,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discovery_keys:e},n}function dO(e,t){e=zA.call(this,e,t)||this;return e.friendDiscoveryRequestId=t.friend_discovery_request_id,e}function fO(e){var t=e.userId,e=e.discoveries,n=WA.call(this)||this;return n.method=S.PUT,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discoveries:e.map(function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}})},n}function pO(t,e){var n=YA.call(this,t,e)||this;return n.changelogs={addedUsers:e.added.map(function(e){return new u(t,e)}),updatedUsers:e.updated.map(function(e){return new u(t,e)}),deletedUserIds:e.deleted,hasMore:e.has_more,token:e.next},n}function vO(e){var t=e.userId,e=e.token,n=XA.call(this)||this;return n.method=S.GET,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/friends/changelogs"),n.params={token:e},n}function _O(e,t){e=JA.call(this,e,t)||this;return e.name=t.name,e}function yO(e){var t=e.userId,e=e.templateName,n=ZA.call(this)||this;return n.method=S.PUT,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/push/template"),n.params={name:e},n}function mO(e,t){e=$A.call(this,e,t)||this;return e.name=t.name,e}function gO(e){var e=e.userId,t=eO.call(this)||this;return t.method=S.GET,t.path="".concat(Mm,"/").concat(encodeURIComponent(e),"/push/template"),t}s(function(){return null!==tO&&tO.apply(this,arguments)||this},tO=v);s(AO,IO=o);var EO,bO,IO,TO,wO=AO,SO=(s(NO,bO=v),NO),CO=(s(kO,EO=o),kO);function kO(e){var t=e.userId,e=e.userIds,n=EO.call(this)||this;return n.method=S.DELETE,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}function NO(t,e){var n=bO.call(this,t,e)||this;return n.users=e.users.map(function(e){return new u(t,e)}),n}function AO(e){var t=e.userId,e=e.userIds,n=IO.call(this)||this;return n.method=S.POST,n.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}s(function(){return null!==TO&&TO.apply(this,arguments)||this},TO=v);s(qO,DO=o);var OO,RO,DO,MO,xO=qO,LO=(s(FO,RO=v),FO),PO=(s(UO,OO=o),UO);function UO(e){var t=e.userId,e=e.allowFriendDiscovery,n=OO.call(this)||this;return n.method=S.PUT,n.path="".concat(Mm,"/").concat(t,"/allow_friend_discovery"),n.params={allow_friend_discovery:e},n}function FO(e,t){e=RO.call(this,e,t)||this;return e.allowFriendDiscovery=t.allow_friend_discovery,e}function qO(e){var e=e.userId,t=DO.call(this)||this;return t.method=S.GET,t.path="".concat(Mm,"/").concat(e,"/allow_friend_discovery"),t.params={},t}s(function(){return null!==MO&&MO.apply(this,arguments)||this},MO=v);function jO(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map(function(e){return new iR(e)}):[]}var HO,GO,VO,BO,KO,QO,zO,WO,YO,XO,JO,ZO,$O,eR,tR,nR,rR=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url},iR=function(e){var t;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!=(t=e.id)?t:0,this.name=null!=(t=e.name)?t:"",this.url=null!=(t=e.url)?t:"",this.emojis=e.emojis?e.emojis.map(function(e){return new rR(e)}):[]},sR=(s(UR,nR=o),UR),aR=(s(PR,tR=v),PR),oR=(s(LR,eR=o),LR),uR=(s(xR,$O=v),xR),cR=(s(MR,ZO=o),MR),lR=(s(DR,JO=v),DR),hR=(s(RR,XO=o),RR),dR=(s(OR,YO=v),OR),fR=(s(AR,WO=Ea),AR.prototype._validate=function(){return WO.prototype._validate.call(this)&&h("string",this.userIdsFilter,!0)&&l("string",this.metaDataKeyFilter,!0)&&h("string",this.metaDataValuesFilter,!0)&&l("string",this.metaDataKeyFilter,!0)},AR.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=k.of(this._iid).requestQueue,n=new hR(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(dR),r=n.users,i=n.next,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},AR),pR=(s(NR,zO=o),NR),vR=(s(kR,QO=v),kR),_R=(s(CR,KO=Ea),CR.prototype._validate=function(){return KO.prototype._validate.call(this)&&h("string",this.userIdsFilter,!0)},CR.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new pR(f(f({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(vR),r=n.users,i=n.next,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},CR),yR=(s(SR,BO=o),SR),mR=(s(wR,VO=v),wR),gR=(s(TR,GO=Ea),TR.prototype._validate=function(){return GO.prototype._validate.call(this)},TR.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new yR(f(f({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(mR),r=n.users,i=n.hasMore,s=n.next,this._token=s,this._hasNext=i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},TR),ER={},bR=(IR.get=function(e){return ER[e]},IR);function IR(e){var t=e.dbname,n=e.itemSizeLimit,r=e.cacheLimit,r=void 0===r?256:r,i=e.blockHashBase,i=void 0===i?2:i,s=e.blockHashMultiplier,s=void 0===s?10:s,a=e.blockHashConstant,a=void 0===a?11:a,o=e.transactionApplyDelay,o=void 0===o?200:o,e=e.disableLogger,e=void 0!==e&&e;return ER[t]||(this.itemSizeLimit=void 0===n?1048576:n,this.cacheLimit=r,this.blockHashBase=i,this.blockHashMultiplier=s,this.blockHashConstant=a,this.transactionApplyDelay=o,this.disableLogger=e,ER[t]=this),ER[t]}function TR(){return null!==GO&&GO.apply(this,arguments)||this}function wR(t,e){var n=VO.call(this,t,e)||this;return n.hasMore=e.has_more,n.users=e.users.map(function(e){return new u(t,e)}),n.next=e.next,n}function SR(e){var t=e.userId,n=e.limit,e=e.token,r=BO.call(this)||this;return r.method=S.GET,r.path="".concat(Mm,"/").concat(encodeURIComponent(t),"/friends"),r.params={limit:n,token:e},r}function CR(e,t){var n=this;return(n=KO.call(this,e,t)||this).userIdsFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n}function kR(t,e){var n=QO.call(this,t,e)||this;return n.users=e.users.map(function(e){return new u(t,e)}),n.next=e.next,n}function NR(e){var t=e.userId,n=e.limit,r=e.token,e=e.userIdsFilter,i=zO.call(this)||this;return i.method=S.GET,i.path="".concat(Mm,"/").concat(t,"/block"),i.params=w({limit:n,token:r,user_ids:e}),i}function AR(e,t){var n=this;return(n=WO.call(this,e,t)||this).userIdsFilter=null,n.metaDataKeyFilter=null,n.metaDataValuesFilter=null,n.nicknameStartsWithFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n.metaDataKeyFilter=null!=(e=t.metaDataKeyFilter)?e:null,n.metaDataValuesFilter=null!=(e=t.metaDataValuesFilter)?e:null,n.nicknameStartsWithFilter=t.nicknameStartsWithFilter||null,n}function OR(t,e){var n=YO.call(this,t,e)||this;return n.users=e.users.map(function(e){return new u(t,e)}),n.next=e.next,n}function RR(e){var t=e.limit,n=e.token,r=e.userIdsFilter,i=e.metaDataKeyFilter,s=e.metaDataValuesFilter,e=e.nicknameStartsWithFilter,a=XO.call(this)||this;return a.method=S.GET,a.path=Mm,a.params=w({limit:t,token:n,user_ids:r,metadatakey:i,metadatavalues_in:s,nickname_startswith:e}),a}function DR(e,t){e=JO.call(this,e,t)||this;return e.emoji=new rR(t),e}function MR(e){var e=e.key,t=ZO.call(this)||this;return t.method=S.GET,t.path="".concat(jm,"/").concat(e),t}function xR(e,t){e=$O.call(this,e,t)||this;return e.emojiCategory=new iR(t),e}function LR(e){var e=e.categoryId,t=eR.call(this)||this;return t.method=S.GET,t.path="".concat(Hm,"/").concat(e),t}function PR(e,t){e=tR.call(this,e,t)||this;return e.emojiContainer=new jO(t),e}function UR(){var e=nR.call(this)||this;return e.method=S.GET,e.path=Hm,e}(e=HO=HO||{})[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND";s(O,qR=Error),Object.defineProperty(O,"storeNotDefined",{get:function(){return new O({code:HO.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailable",{get:function(){return new O({code:HO.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailableInPrivateBrowsing",{get:function(){return new O({code:HO.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeIsFull",{get:function(){return new O({code:HO.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeKeyTypeIsInvalid",{get:function(){return new O({code:HO.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenIntegrity",{get:function(){return new O({code:HO.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenBlob",{get:function(){return new O({code:HO.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeEncryptionInvalid",{get:function(){return new O({code:HO.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeItemSizeExceeded",{get:function(){return new O({code:HO.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeReadFailed",{get:function(){return new O({code:HO.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeWriteFailed",{get:function(){return new O({code:HO.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"databaseSchemaNotOnUpgrade",{get:function(){return new O({code:HO.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionNotReady",{get:function(){return new O({code:HO.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotMatch",{get:function(){return new O({code:HO.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionQueryNotValid",{get:function(){return new O({code:HO.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionInsertDuplicate",{get:function(){return new O({code:HO.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotFound",{get:function(){return new O({code:HO.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotGiven",{get:function(){return new O({code:HO.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionWriteFailed",{get:function(){return new O({code:HO.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionItemSizeExceeded",{get:function(){return new O({code:HO.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTableIsRequired",{get:function(){return new O({code:HO.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTypesNotMatch",{get:function(){return new O({code:HO.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"compareTypesNotMatch",{get:function(){return new O({code:HO.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"circularReferenceFound",{get:function(){return new O({code:HO.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0});var FR,qR,A=O;function O(e){var t=e.code,t=void 0===t?HO.UNKNOWN_ERROR:t,e=e.message,e=qR.call(this,void 0===e?"Unknown error occurred.":e)||this;return e.code=t,Object.setPrototypeOf(e,O.prototype),e}(ft=FR=FR||{}).INIT="init",ft.READY="ready",ft.CLOSED="closed";function jR(e,t){if(void 0===t&&(t=new WeakMap),"object"!=typeof e||null===e)return e;if(t.has(e))throw A.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map(function(e){return jR(e,t)});else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=jR(e[r],t);return t.delete(e),n}function HR(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw A.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n}function GR(t){return new Promise(function(e){setTimeout(function(){return e()},t)})}function VR(e,t){if(t){if("function"==typeof e)return e(t);for(var n in e)if(["/and","&&"].includes(n)){if(e[n].some(function(e){return!VR(e,t)}))return}else if(["/or","||"].includes(n)){if(e[n].every(function(e){return!VR(e,t)}))return}else if("/where"===n){if(!(0,e[n])(t))return}else{var r=n;if("object"==typeof e[r]){var i,s=e[r];for(i in s)switch(i){case"/eq":case"=":if((a=t[r])!==(o=s[i]))return;break;case"/neq":case"!=":if((a=t[r])===(o=s[i]))return;break;case"/gt":case">":var a=t[r],o=s[i];if(0<HR(a,o))break;return;case"/gte":case">=":if(a=t[r],o=s[i],0<=HR(a,o))break;return;case"/lt":case"<":if(a=t[r],o=s[i],HR(a,o)<0)break;return;case"/lte":case"<=":if(a=t[r],o=s[i],HR(a,o)<=0)break;return;case"/in":if(a=t[r],(o=s[i]).includes(a))break;return;case"/nin":if(a=t[r],(o=s[i]).includes(a))return;break;case"/contain":if(a=t[r],o=s[i],a.includes(o))break;return;case"/regex":if(a=t[r],(o=s[i]).test(a))break;return;case"/where":if(a=t[r],!(0,s[i])(a))return}}else if("function"==typeof e[r]){if(!e[r](t[r]))return}else if(e[r]!==t[r])return}return 1}}function BR(){}function KR(){return Promise.resolve()}function QR(e){return e}function zR(e,t){t(null)}var WR=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t};function YR(e,t){return"".concat(aD(e,t),".metadata")}function XR(e,t){return"".concat(aD(e,t),"/block.")}function JR(e,t){return"".concat(aD(e,t),"/blob.")}function ZR(e,t,n,r){return void 0===r&&(r=0),"".concat(JR(e,t)).concat(n,".").concat(r)}Object.defineProperty(hD.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(hD.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(hD.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(hD.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(hD.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),hD.prototype.prev=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:if(!this.hasPrevious)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._prevValue,[4,(n=this)._backward()];case 2:return n._prevValue=e.sent()||null,this._nextValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},hD.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:if(!this.hasNext)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._nextValue,[4,(n=this)._forward()];case 2:return n._nextValue=e.sent()||null,this._prevValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},hD.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()};var $R,eD,tD,nD=hD,rD=(lD.prototype.findOptimizedStartPosition=function(){var s=this,a=["=","/eq",">",">=","/gt","/gte"],o=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var e=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var t in this._indexer.fields){var n=this._indexer.fields[t],r=1;if("-"===n[0]&&(n=n.slice(1),r=-1),this.condition[n])if("object"==typeof this.condition[n]){var i,u=0<r?o:a;for(i in this.condition[n])if(u.includes(i))for(var c=e;0<=c;c--)if(r*HR(this._indexer.origin[c].columnValues[t],this.condition[n][i])<=0){e=c;break}}else for(c=e;0<=c;c--)if(r*HR(this._indexer.origin[c].columnValues[t],this.condition[n])<=0){e=c;break}}return Math.min(e+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=this,t=0;t<this._indexer.fields.length;t++)!function(n){var r=h._indexer.fields[n],i=1;if("-"===r[0]&&(r=r.slice(1),i=-1),h.condition[r])if("object"==typeof h.condition[r])Object.keys(h.condition[r]).forEach(function(e){if((0<i?a:o).includes(e))for(var t=l;t<s._indexer.origin.length;t++)if(0<=i*HR(s._indexer.origin[t].columnValues[n],s.condition[r][e])){l=t;break}});else for(var e=l;e<h._indexer.origin.length;e++)if(0<=i*HR(h._indexer.origin[e].columnValues[n],h.condition[r])){l=e;break}}(t);return Math.max(l-1,0)},lD.prototype.each=function(c){return re(this,void 0,void 0,function(){var r,i,s,a,t,n,o,u=this;return ie(this,function(e){switch(e.label){case 0:if(r=this.findOptimizedStartPosition(),i=0,this.backward&&this._indexer.origin[r]&&(i=this._indexer.origin[r].keys.length-1),s=function(){if(u._indexer.origin[r]){if(!u._indexer.origin[r].keys[++i]){if(!u._indexer.origin[++r])return!1;i=0}return!0}return!1},a=function(){if(u._indexer.origin[r]){if(!u._indexer.origin[r].keys[--i]){if(!u._indexer.origin[--r])return!1;i=u._indexer.origin[r].keys.length-1}return!0}return!1},t=null,!this._indexer.origin[r])return[3,4];n=this.backward?a:s,e.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])];case 2:if(o=e.sent(),VR(this.condition,o))return t=o,[3,4];e.label=3;case 3:if(n())return[3,1];e.label=4;case 4:return[4,new Promise(function(e){e=new nD({initialNextValue:jR(t),iterator:c,forward:function(){return re(u,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:t=this.backward?a:s,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])]:[3,3];case 2:return n=e.sent(),VR(this.condition,n)?[2,jR(n)]:[3,1];case 3:return[2,null]}})})},backward:function(){return re(u,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:t=this.backward?s:a,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])]:[3,3];case 2:return n=e.sent(),VR(this.condition,n)?[2,jR(n)]:[3,1];case 3:return[2,null]}})})},complete:e});c(e)})];case 5:return[2,e.sent()]}})})},lD),iD=(cD.prototype.fetch=function(a){return void 0===a&&(a={}),re(this,void 0,void 0,function(){var n,r,i,t,s=this;return ie(this,function(e){switch(e.label){case 0:if(n=Math.max(a.offset||0,0),0===(r="number"==typeof a.limit?a.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(r<0)throw A.collectionQueryNotValid;e.label=1;case 1:return e.trys.push([1,4,,5]),i=[],[4,this._mutex.lock()];case 2:return e.sent(),[4,this._iterator.each(function(t){return re(s,void 0,void 0,function(){return ie(this,function(e){return!t.error&&t.hasNext?0===n?(i.push(t.nextValue),0<r&&r<=i.length?t.stop():t.next()):(n--,t.next()):t.stop(),[2]})})})];case 3:return e.sent(),this._mutex.unlock(),[2,i];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[2]}})})},cD.prototype.count=function(){return re(this,void 0,void 0,function(){var n,t,r=this;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),n=0,[4,this._mutex.lock()];case 1:return e.sent(),[4,this._iterator.each(function(t){return re(r,void 0,void 0,function(){return ie(this,function(e){return!t.error&&t.hasNext?(n++,t.next()):t.stop(),[2]})})})];case 2:return e.sent(),this._mutex.unlock(),[2,n];case 3:throw t=e.sent(),this._mutex.unlock(),t;case 4:return[2]}})})},cD),sD=function(e){return"".concat("nest","@").concat(e)},aD=function(e,t){return"".concat(sD(e),"/").concat(t)},oD=(uD.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(0<n){for(var r=Math.ceil(e.data.length/n),r="".concat(r,".").concat(e.type,".").concat(t),i=[],s=0;s<e.data.length;s+=n){var a=e.data.slice(s,s+n);i.push(a)}return{blobId:r,shards:i}}return{blobId:null,shards:null}},uD.prototype._encode=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){var t=new FileReader;t.onload=function(){e({data:t.result,type:n.type})},t.readAsDataURL(n)})];case 1:return[2,e.sent()]}})})},uD.prototype._decode=function(o){return re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return"undefined"==typeof fetch?[3,3]:[4,fetch(o.data)];case 1:return[4,e.sent().blob()];case 2:return[2,e.sent()];case 3:for(t=[],n=atob(o.data.split(",")[1]),r=0;r<n.length;r+=512){for(i=n.slice(r,r+512),s=new Array(i.length),a=0;a<i.length;a++)s[a]=i.charCodeAt(a);t.push(new Uint8Array(s))}return[2,new Blob(t,{type:o.type})]}})})},uD.prototype.get=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(t=[],n=N_(a.split("."),2),r=n[0],n=n[1],!(0<(r=parseInt(r))))return[3,6];i=0,e.label=1;case 1:return i<r?(s=ZR(this.dbname,this.collectionName,a,i),[4,this._store.get(s)]):[3,4];case 2:if(!(s=e.sent())||!s.d)throw A.storeBrokenBlob;t.push(s.d),e.label=3;case 3:return i++,[3,1];case 4:return[4,this._decode({data:t.join(""),type:n})];case 5:return[2,e.sent()];case 6:return[2,null]}})})},uD.prototype.save=function(o,u){return void 0===u&&(u="".concat(Date.now())),re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return t=[],[4,this._encode(o)];case 1:if(n=e.sent(),n=this._makeShards(n,u),r=n.blobId,i=n.shards,!r)return[3,3];for(s=0;s<i.length;s++)a=ZR(this.dbname,this.collectionName,r,s),t.push({key:a,value:{d:i[s]},generation:1});return[4,this._store.setMany(t)];case 2:if(e.sent().some(function(e){return e instanceof Error}))throw A.storeWriteFailed;return[2,r];case 3:return[2,null]}})})},uD.prototype.remove=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:if(t=[],n=N_(s.split("."),1),n=n[0],!(0<(r=parseInt(n))))return[3,2];for(i=0;i<r;i++)t.push(ZR(this.dbname,this.collectionName,s,i));return[4,this._store.removeMany(t)];case 1:e.sent(),e.label=2;case 2:return[2]}})})},uD.prototype.clear=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=JR(this.dbname,this.collectionName),n=[],[4,this._store.getAllKeys()];case 1:r=e.sent();try{for(i=se(r),s=i.next();!s.done;s=i.next())(a=s.value).startsWith(t)&&n.push(a)}catch(e){o={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(o)throw o.error}}return[4,this._store.removeMany(r)];case 2:return e.sent(),[2]}})})},uD);function uD(e){var t=e.dbname,n=e.collectionName,e=e.store;this.dbname=t,this.collectionName=n,this._store=e}function cD(e){var t=e.condition,t=void 0===t?{}:t,n=e.backward,n=void 0!==n&&n,r=e.mutex,i=e.blockManager,e=e.indexer;this._mutex=r,this._iterator=new rD({condition:t,backward:n,blockManager:i,indexer:e})}function lD(e){var t=e.condition,n=e.backward,n=void 0!==n&&n,r=e.blockManager,e=e.indexer;this.condition=void 0===t?{}:t,this.backward=n,this._blockManager=r,this._indexer=e}function hD(e){var t=e.initialPrevValue,n=e.initialNextValue,n=void 0===n?null:n,r=e.iterator,i=e.map,i=void 0===i?QR:i,s=e.backward,s=void 0===s?KR:s,a=e.forward,a=void 0===a?KR:a,e=e.complete,e=void 0===e?BR:e;this._prevValue=void 0===t?null:t,this._nextValue=n,this._error=null,this._map=i,this._backward=s,this._forward=a,this._iterator=r,this._complete=e}(Rn=$R=$R||{})[Rn.COMMIT=0]="COMMIT",Rn[Rn.WRITE=1]="WRITE",Rn[Rn.ERROR=2]="ERROR",(bn=eD=eD||{}).PENDING="pending",bn.PERSISTENT="persistent",bn.VOLATILE="volatile",(ha=tD=tD||{})[ha.NO_CACHE=0]="NO_CACHE",ha[ha.DEFAULT=1]="DEFAULT",ha[ha.PERSISTENT=2]="PERSISTENT";var dD=[eD.PENDING,eD.VOLATILE],fD={},pD=(wD.get=function(e){return fD[e]},Object.defineProperty(wD.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),wD.prototype.find=function(r,i,s){return void 0===s&&(s=tD.DEFAULT),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return(t=this.get(i))?[3,2]:[4,r.get(i)];case 1:return(n=e.sent())&&(t={key:i,value:n,generation:1,state:s===tD.PERSISTENT?eD.PERSISTENT:eD.VOLATILE},this.put(t)),[3,3];case 2:s===tD.PERSISTENT&&(t.state=eD.PERSISTENT),e.label=3;case 3:return[2,t]}})})},wD.prototype.get=function(e,t){void 0===t&&(t=tD.DEFAULT);var e=this._items.map(function(e){return e.key}).indexOf(e);return-1<e?(e=this._items[e],t===tD.PERSISTENT&&(e.state=eD.PERSISTENT),t!==tD.NO_CACHE&&this.put(e),e):null},wD.prototype.put=function(e){var t,n;if(0<this._limit){var r=this._items.map(function(e){return e.key}).indexOf(e.key);if(-1<r)dD.includes(this._items[r].state)&&dD.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter(function(e){return e.state===eD.VOLATILE}).length-this._limit;if(0<i){var s=[];try{for(var a=se(this._items),o=a.next();!o.done;o=a.next()){var u=o.value;u.state===eD.VOLATILE&&0<i?i--:s.push(u)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this._items=s}}}},wD.prototype.remove=function(e){e=this._items.map(function(e){return e.key}).indexOf(e);-1<e&&this._items.splice(e,1)},wD.prototype.clearByCondition=function(t){this._items=this._items.filter(function(e){return!t(e)})},wD.prototype.clear=function(e){this._items=(e=void 0===e?!1:e)?[]:this._items.filter(function(e){return e.state!==eD.VOLATILE})},wD),vD=(Object.defineProperty(TD.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(TD.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),TD.prototype._getReducedRecordset=function(n){return void 0===n&&(n=[]),re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=e.sent()||[]).push.apply(t,A_([],N_(n),!1)),[2,this._reduceRecordSet(t)]}})})},TD.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;0<=r;r--){for(var i=e[r],s=[],a=i.requests.length-1;0<=a;a--){var o=i.requests[a],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0)}0<s.length&&(i.requests=s,t.unshift(i))}return t},TD.prototype._applyRecord=function(c,l){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:t=pD.get(this.dbname),n=l.generation,r=l.requests,i=null,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.setMany(r.map(function(e){return f(f({},e.data),{generation:n})}))];case 2:for(s=e.sent(),a=0;a<r.length;a++)s[a]instanceof Error&&(i=i||s[a],o=r[a].data,t.put(f(f({},o),{generation:n,state:eD.PERSISTENT})));return[3,4];case 3:return u=e.sent(),i=u,[3,4];case 4:return i?[3,6]:(u=c.filter(function(e){return e.generation!==n}),[4,this._store.set({key:this.recordsetKey,value:u,generation:n})]);case 5:return e.sent(),this._onWrite.forEach(function(e){e(r.map(function(e){return e.data}))}),[3,7];case 6:this._onError.forEach(function(e){return e(i)}),e.label=7;case 7:return[2]}})})},TD.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return[4,(t=this)._store.get(this.metadataKey)];case 1:return t._metadata=e.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:n=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),r=se(n),i=r.next(),e.label=4;case 4:return i.done?[3,7]:(s=i.value,[4,this._applyRecord(n,s)]);case 5:e.sent(),e.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return s=e.sent(),a={error:s},[3,10];case 9:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},TD.prototype.on=function(e,t,n){switch(e){case $R.COMMIT:this._onCommit.set(t,n);break;case $R.WRITE:this._onWrite.set(t,n);break;case $R.ERROR:this._onError.set(t,n)}},TD.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t=void 0===t?null:t}),pD.get(this.dbname).put(f({state:eD.PENDING,generation:this.generation},e))},TD.prototype.requestMultipleWrite=function(e,t){void 0===t&&(t=null);var n,r,i=pD.get(this.dbname);try{for(var s=se(e),a=s.next();!a.done;a=s.next()){var o=a.value;this._requests.push({data:o,options:t}),i.put(f({state:eD.PENDING,generation:this.generation},o))}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},TD.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return pD.get(this.dbname).clearByCondition(function(e){return e.state===eD.PENDING}),this._requests=[],[2]})})},TD.prototype.commit=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d=this;return ie(this,function(e){switch(e.label){case 0:if(!(0<(t=this._requests).length))return[3,4];for(n=[],r={},u=t.length-1;0<=u;u--)i=t[u],c=i.data,r[c.key]||(r[c.key]=!0,n.unshift(i));return s={generation:this.generation,requests:n},[4,this._getReducedRecordset([s])];case 1:return a=e.sent(),[4,this._store.set({key:this.recordsetKey,value:a,generation:this.generation})];case 2:return e.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(e.sent(),o=pD.get(this.dbname),u=0;u<n.length;u++)l=n[u],c=l.data,l=l.options,o.put(f(f({},c),{generation:s.generation,state:l&&l.persistent?eD.PERSISTENT:eD.VOLATILE}));this._requests=[],this._onCommit.forEach(function(e){e(t.map(function(e){return e.data}))}),h=bR.get(this.dbname),setTimeout(function(){try{d._applyRecord(a,s)}catch(t){d._onError.forEach(function(e){return e(t)})}},h.transactionApplyDelay),e.label=4;case 4:return[2]}})})},TD),_D=(ID.createFromCacheItem=function(e){return e?new ID(e.value):null},Object.defineProperty(ID.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(ID.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),ID.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},ID.prototype.getItemByKey=function(t){var n=this;return this._items.find(function(e){e=e[n.keyName];return t===e})},ID.prototype.has=function(e){var t=this;return this._items.map(function(e){return e[t.keyName]}).includes(e)},ID.prototype.add=function(e){var t=this,n=this._items.map(function(e){return e[t.keyName]}).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},ID.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},ID.prototype.clear=function(){this._items=[]},ID),yD=(Object.defineProperty(bD.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),bD.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,e="".concat(function(e,t,n){t=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||WR)(e,t)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(XR(n,r)).concat(i,".").concat(e);var n,r,i},bD.prototype._findBlock=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:t=pD.get(this.dbname),n=this.metadata.blockLevel,e.label=1;case 1:return 0<n?(r=this.createBlockId(s,n),[4,t.find(this._store,r)]):[3,4];case 2:if((r=e.sent())&&(i=_D.createFromCacheItem(r)).getItemByKey(s))return[2,i];e.label=3;case 3:return n--,[3,1];case 4:return[2,null]}})})},bD.prototype.getFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return[2,(t=e.sent())?t.getItemByKey(n):null]}})})},bD.prototype.putToBlock=function(i,s){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return n=bR.get(this.dbname),t=this.createBlockId(i),n=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,pD.get(this.dbname).find(this._store,t)];case 1:return r=e.sent(),(r=r?_D.createFromCacheItem(r):new _D({blockId:t,keyName:this.keyName,items:[],limit:n})).add(s)?(this._transaction.requestWrite({key:r.blockId,value:r.serialize()}),[2,!0]):[2,!1]}})})},bD.prototype.removeFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return(t=e.sent())&&t.remove(n)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}})})},bD.prototype.clearAllBlocks=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=XR(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return n=e.sent(),n=n.filter(function(e){return e.startsWith(t)}),[4,this._store.removeMany(n)];case 2:e.sent(),r=pD.get(this.dbname);try{for(i=se(n),s=i.next();!s.done;s=i.next())a=s.value,r.remove(a)}catch(e){o={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(o)throw o.error}}return[2]}})})},bD),mD=(ED.createKey=function(e){return e.join(">")},ED.parseKey=function(e){return e.split(">")},ED.prototype._addItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),n=N_(this.indexOf(e),2),r=n[0];return n[1]?!this._table[r].keys.includes(t)&&(this._table[r].keys.push(t),!0):(this._table.splice(r,0,{columnValues:e,keys:[t]}),!0)},ED.prototype._removeItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),e=N_(this.indexOf(e),2),n=e[0];if(e[1]){e=this._table[n].keys.indexOf(t);if(-1<e)return this._table[n].keys.splice(e,1),0===this._table[n].keys.length&&this._table.splice(n,1),!0}return!1},Object.defineProperty(ED.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(ED.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),ED.prototype.getColumnValues=function(e){var t,n,r=[];try{for(var i=se(this.fields),s=i.next();!s.done;s=i.next()){var a,o=s.value,u=e[o="-"===o[0]?o.slice(1):o];if(a=typeof u,null!==u&&"undefined"!=a&&"boolean"!=a&&"number"!=a&&"string"!=a)throw A.indexTypesNotMatch;r.push(e[o])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},ED.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,n=HR(e[n],t[n]);if(0!==n)return r*n}return 0},ED.prototype.indexOf=function(e){if(0<this._table.length){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(0<i)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},ED.prototype.ensure=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d,f,p,v;return ie(this,function(e){switch(e.label){case 0:return[4,(t=pD.get(this.dbname)).find(this._store,this.indexerKey,tD.PERSISTENT)];case 1:return(n=e.sent())?[3,11]:(r=XR(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:i=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),s=se(i),a=s.next(),e.label=4;case 4:return a.done?[3,7]:(o=a.value).startsWith(r)?[4,t.find(this._store,o,tD.NO_CACHE)]:[3,6];case 5:o=e.sent(),h=_D.createFromCacheItem(o);try{for(p=void 0,u=se(h.items),c=u.next();!c.done;c=u.next())l=c.value,this._addItem(l)}catch(e){p={error:e}}finally{try{c&&!c.done&&(v=u.return)&&v.call(u)}finally{if(p)throw p.error}}e.label=6;case 6:return a=s.next(),[3,4];case 7:return[3,10];case 8:return h=e.sent(),d={error:h},[3,10];case 9:try{a&&!a.done&&(f=s.return)&&f.call(s)}finally{if(d)throw d.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=n.value,this._table=jR(this._origin),e.label=12;case 12:return[2]}})})},ED.prototype.drop=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return pD.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}})})},ED.prototype.addItem=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._addItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},ED.prototype.removeItem=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._removeItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},ED.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},ED.prototype.commit=function(){this._origin=this._table,this._table=jR(this._origin)},ED.prototype.abort=function(){this._table=jR(this._origin)},ED),gD="undefined"!=typeof document&&"undefined"!=typeof navigator;function ED(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,e=e.store,a=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=(t=this.dbname,n=this.collectionName,r=this.fields.join(">"),"".concat(aD(t,n),"/index.").concat(r)),this._transaction=s,this._store=e,this._transaction.on($R.COMMIT,this.indexerKey,function(){return a.commit()}),this._transaction.on($R.ERROR,this.indexerKey,function(){return a.abort()})}function bD(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,i=void 0===i?WR:i,s=e.transaction,e=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=i,this.metadata=r,this._transaction=s,this._store=e}function ID(e){var t=e.blockId,n=e.keyName,r=e.items,r=void 0===r?[]:r,e=e.limit;this.blockId=t,this.keyName=n,this.limit=e,this._items=A_([],N_(r),!1)}function TD(e){var t=e.dbname,n=e.collectionName,e=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey="".concat(aD(t,n),"/trans.metadata"),this.recordsetKey="".concat(aD(t,n),"/trans.recordset"),this._store=e}function wD(e){var t=e.dbname,e=e.limit,e=void 0===e?256:e;return fD[t]||(this.dbname=t,this._items=[],this._limit=e,fD[t]=this),fD[t]}gD&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var SD=gD&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");gD&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),gD&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),gD&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");function CD(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}var kD,ND,AD=gD&&navigator.userAgent&&navigator.userAgent.includes("Edge/");(qr=kD=kD||{})[qr.PROCESSING=0]="PROCESSING",qr[qr.DONE=1]="DONE",(at=ND=ND||{}).NEWNODE="newnode",at.REMOVENODE="removenode",at.CLAIM_HOST="claimhost",at.SYNC_HOST="synchost",at.REQUEST_LOCK="requestlock",at.ACQUIRE_LOCK="acquirelock",at.RELEASE_LOCK="releaselock";var OD,RD={},DD=(Object.defineProperty(KD.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(KD.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(KD.prototype,"isInSync",{get:function(){return this._state==kD.DONE},enumerable:!1,configurable:!0}),KD.prototype._send=function(e,t){var n,e={nodeId:this.nodeId,requestId:null!=(n=null==(t=void 0===t?{}:t)?void 0:t.requestId)?n:CD(),key:this.key,op:e,data:null!=(n=t.data)?n:null,ts:Date.now()};return gD&&window.postMessage(e,"*"),e},KD.prototype._acquire=function(e){(e=void 0===e?null:e)?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null},KD.prototype._release=function(t){var e,n;this._currentItem&&this._currentItem.requestId===t&&(e=this._currentItem,this._currentItem=null,e.nodeId===this.nodeId&&this._send(ND.RELEASE_LOCK,{requestId:e.requestId}),-1<(n=this._queue.findIndex(function(e){return e.requestId===t}))&&this._queue.splice(n,1),e.onReleased(t))},KD.prototype._requestLock=function(i){var s=this;return new Promise(function(t){var e,n={nodeId:i.nodeId,requestId:i.requestId,ts:i.ts,onAcquired:function(e){s.isHost&&s._send(ND.ACQUIRE_LOCK,{requestId:e}),t()},onReleased:function(){s._acquire(s._queue[0])}},r=!1;for(e in s._queue)if(s._queue[e].ts>n.ts){s._queue.splice(parseInt(e),0,n),r=!0;break}r||s._queue.push(n),s._currentItem||s._acquire(s._queue[0])})},KD.prototype._sendSync=function(){var e;this.isHost&&this._send(ND.SYNC_HOST,{data:{currentItemRequestId:null==(e=this._currentItem)?void 0:e.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},KD.prototype._waitUntilSyncCompleted=function(){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(e){t._activationQueue.push(e)})]:[2]})})},KD.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout(function(){e._completeSync()},8))},KD.prototype._completeSync=function(){this.isInSync||(this._state=kD.DONE,this._activationQueue.forEach(function(e){return e()}),this._activationQueue=[])},KD.prototype.registerNode=function(){this._send(ND.NEWNODE),this._waitSync()},KD.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(ND.CLAIM_HOST),this._waitSync()},KD.prototype.lock=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),t=this._send(ND.REQUEST_LOCK),[4,this._requestLock(t)];case 2:return e.sent(),[2]}})})},KD.prototype.unlock=function(){var e;this._release(null==(e=this._currentItem)?void 0:e.requestId)},KD),MD=(BD.metadataOf=function(n,r,i){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=YR(n,r),[4,i.get(t)];case 1:return[2,e.sent()]}})})},Object.defineProperty(BD.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(BD.prototype,"isReady",{get:function(){return this._state===FR.READY},enumerable:!1,configurable:!0}),BD.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d,f,p=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._mutex.lock()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,9,,10]),t=bR.get(this.dbname),[4,BD.metadataOf(this.dbname,this.name,this._store)];case 3:return n=e.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:e.sent(),this._blockManager=new yD({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=A_([],N_(this.indexes),!1),i=[],s=r.map(function(e){return mD.createKey(e)}),a=n?n.indexes.map(function(e){return mD.createKey(e)}):[];try{for(o=se(a),u=o.next();!u.done;u=o.next())c=u.value,s.includes(c)||i.push(mD.parseKey(c))}catch(e){d={error:e}}finally{try{u&&!u.done&&(f=o.return)&&f.call(o)}finally{if(d)throw d.error}}return(l=[]).push.apply(l,A_([],N_(r.map(function(e){e=new mD({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store});return p._indexers.push(e),e.ensure()})),!1)),l.push.apply(l,A_([],N_(i.map(function(e){return new mD({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return e.sent(),[4,this._transaction.commit()];case 6:return e.sent(),s.sort().join(",")===a.sort().join(",")?[3,8]:(l=YR(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:l,value:this._metadata,generation:1})]);case 7:e.sent(),e.label=8;case 8:return this._state=FR.READY,this._mutex.unlock(),[3,10];case 9:throw h=e.sent(),this._mutex.unlock(),h;case 10:return[2]}})})},BD.prototype.close=function(){this._state=FR.CLOSED},BD.prototype._hasPropertyOfKeyName=function(e){e=e[this.keyName];return"string"==typeof e&&!!e},BD.prototype._getIndexerBy=function(e){e=(e=void 0===e?null:e)||[this.keyName];var t,n,r=mD.createKey(e);try{for(var i=se(this._indexers),s=i.next();!s.done;s=i.next()){var a=s.value;if(r===mD.createKey(a.fields))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},BD.prototype._upgradeBlockLevel=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=YR(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:t,value:this._metadata,generation:1})];case 1:return e.sent(),[2]}})})},BD.prototype._requestInsert=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return t=a[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return e.sent()?[3,13]:[4,this._blockManager.putToBlock(t,a)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,a)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),n=se(this._indexers),r=n.next(),e.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(a)];case 7:e.sent(),e.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=e.sent(),i={error:i},[3,12];case 11:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 12:return[3,14];case 13:throw A.collectionInsertDuplicate;case 14:return[2]}})})},BD.prototype._requestUpsert=function(d){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h;return ie(this,function(e){switch(e.label){case 0:return t=d[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[3,13]:[4,this._blockManager.putToBlock(t,d)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,d)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),r=se(this._indexers),i=r.next(),e.label=6;case 6:return i.done?[3,9]:[4,(o=i.value).addItem(d)];case 7:e.sent(),e.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return u=e.sent(),u={error:u},[3,12];case 11:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,d)];case 14:e.sent(),e.label=15;case 15:e.trys.push([15,21,22,23]),s=se(this._indexers),a=s.next(),e.label=16;case 16:return a.done?[3,20]:0===(o=a.value).diff(o.getColumnValues(n),o.getColumnValues(d))?[3,19]:[4,o.removeItem(n)];case 17:return e.sent(),[4,o.addItem(d)];case 18:e.sent(),e.label=19;case 19:return a=s.next(),[3,16];case 20:return[3,23];case 21:return l=e.sent(),l={error:l},[3,23];case 22:try{a&&!a.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}return[7];case 23:return[2]}})})},BD.prototype._requestUpdate=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return t=u[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[4,this._blockManager.putToBlock(t,u)]:[3,11];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,9,10,11]),r=se(this._indexers),i=r.next(),e.label=4;case 4:return i.done?[3,8]:0===(s=i.value).diff(s.getColumnValues(n),s.getColumnValues(u))?[3,7]:[4,s.removeItem(n)];case 5:return e.sent(),[4,s.addItem(u)];case 6:e.sent(),e.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return a=e.sent(),a={error:a},[3,11];case 10:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 11:return[2]}})})},BD.prototype._requestRemove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return[4,this._blockManager.getFromBlock(a)];case 1:return(t=e.sent())?[4,this._blockManager.removeFromBlock(a)]:[3,10];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),n=se(this._indexers),r=n.next(),e.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:e.sent(),e.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=e.sent(),i={error:i},[3,10];case 9:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 10:return[2]}})})},BD.prototype._requestClear=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:e.sent(),e.label=2;case 2:e.trys.push([2,7,8,9]),t=se(this._indexers),n=t.next(),e.label=3;case 3:return n.done?[3,6]:[4,n.value.clear()];case 4:e.sent(),e.label=5;case 5:return n=t.next(),[3,3];case 6:return[3,9];case 7:return r=e.sent(),r={error:r},[3,9];case 8:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}return[7];case 9:return[2]}})})},BD.prototype.getByKey=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(n)];case 3:return t=e.sent(),this._mutex.unlock(),[2,jR(t)];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[3,7];case 6:throw A.collectionNotReady;case 7:return[2]}})})},BD.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new iD({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},BD.prototype.insertOne=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestInsert(jR(n))];throw A.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},BD.prototype.insertMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),u.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw A.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=se(u),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(jR(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),s={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,u];case 12:return i=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),i;case 14:return[3,16];case 15:throw A.collectionNotReady;case 16:return[2]}})})},BD.prototype.upsertOne=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpsert(jR(n))];throw A.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},BD.prototype.upsertMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),u.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw A.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=se(u),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(jR(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),s={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,u];case 12:return i=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),i;case 14:return[3,16];case 15:throw A.collectionNotReady;case 16:return[2]}})})},BD.prototype.update=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpdate(jR(n))];throw A.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},BD.prototype.updateIf=function(h,d){return re(this,void 0,void 0,function(){var i,s,t,n,r,a,o,u,c,l=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,15]),a=h.where,i=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,r=h.backward,r=void 0!==r&&r,s=[],[4,new rD({condition:i,blockManager:this._blockManager,backward:r,indexer:this._getIndexerBy(a)}).each(function(r){return re(l,void 0,void 0,function(){var t,n;return ie(this,function(e){if(r.error)throw r.stop(),r.error;if(r.hasNext){if(t=r.nextValue,VR(i,t)&&d.set){if("function"!=typeof d.set)for(n in d.set)t[n]=d.set[n];else d.set(t);s.push(t)}r.next()}else r.stop();return[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=se(s),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(r=n.value,[4,this._requestUpdate(jR(r))]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),u={error:a},[3,11];case 10:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,s];case 13:return o=e.sent(),[4,this._transaction.clear()];case 14:throw e.sent(),this._mutex.unlock(),o;case 15:return[3,17];case 16:throw this._transaction.clear(),A.collectionNotReady;case 17:return[2]}})})},BD.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestRemove(n)];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},BD.prototype.removeIf=function(h){return re(this,void 0,void 0,function(){var r,i,t,n,s,a,o,u,c,l=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,14]),a=h.where,r=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,s=h.backward,s=void 0!==s&&s,i=[],[4,new rD({condition:r,blockManager:this._blockManager,backward:s,indexer:this._getIndexerBy(a)}).each(function(n){return re(l,void 0,void 0,function(){var t;return ie(this,function(e){if(n.error)throw n.stop(),n.error;return n.hasNext?(t=n.nextValue,VR(r,t)&&(t=t[this.keyName],i.push(t)),n.next()):n.stop(),[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=se(i),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(s=n.value,[4,this._requestRemove(s)]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),u={error:a},[3,11];case 10:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,i];case 13:throw o=e.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw this._transaction.clear(),A.collectionNotReady;case 16:return[2]}})})},BD.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},BD.prototype.getBlob=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(t)];case 1:return[2,e.sent()]}})})},BD.prototype.saveBlob=function(t,n){return void 0===n&&(n=null),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.save(t,n)];case 1:return[2,e.sent()]}})})},BD.prototype.removeBlob=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(t)];case 1:return e.sent(),[2]}})})},BD.prototype.removeAllBlobs=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}})})},BD),xD={},LD=(Object.defineProperty(VD.prototype,"rawData",{get:function(){return xD[this.dbname]},set:function(e){xD[this.dbname]=e},enumerable:!1,configurable:!0}),VD.prototype.observe=function(t,e,n){var r=this;this.observer[t]={},e.forEach(function(e){return r.observer[t][e]=n})},VD.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this.dbname=n,xD[this.dbname]={},e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get(B_.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify(B_.value))throw A.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(B_)];case 4:return e.sent(),[7];case 5:return[2]}})})},VD.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,Object.keys(xD[this.dbname]).filter(function(e){return e!==B_.key})]})})},VD.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,GR(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.get?t.get(n):null)throw t;return[2,xD[this.dbname][n]?this._encryption.decrypt(xD[this.dbname][n]):null]}})})},VD.prototype.set=function(i){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return[4,GR(this.delay)];case 1:if(e.sent(),t=i.key,r=i.value,n=this.observer[t],n=n&&n.set?n.set(t):null)throw n;if(n=this._encryption.encrypt(r),r=JSON.stringify(n),t===B_.key||r.length<this.itemSizeLimit)return xD[this.dbname][t]=n,[2,xD[this.dbname][t]];throw A.storeItemSizeExceeded}})})},VD.prototype.setMany=function(t){return re(this,void 0,void 0,function(){var i,s=this;return ie(this,function(e){switch(e.label){case 0:return[4,GR(this.delay)];case 1:return e.sent(),i=[],t.forEach(function(e){var t,n=e.key,e=e.value,r=s.observer[n];r&&r.set&&r.set(n)?i.push(A.collectionWriteFailed):(r=s._encryption.encrypt(e),t=JSON.stringify(r),n===B_.key||t.length<s.itemSizeLimit?(xD[s.dbname][n]=r,i.push(e)):i.push(A.storeItemSizeExceeded))}),[2,i]}})})},VD.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,GR(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.remove?t.remove(n):null)throw t;return xD[this.dbname][n]&&delete xD[this.dbname][n],[2,n]}})})},VD.prototype.removeMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return[4,GR(this.delay)];case 1:e.sent();try{for(t=se(u),n=t.next();!n.done;n=t.next()){if(r=n.value,i=this.observer[r],s=i&&i.remove?i.remove(r):null)throw s;xD[this.dbname][r]&&delete xD[this.dbname][r]}}catch(e){a={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}}return[2,u]}})})},VD.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,GR(this.delay)];case 1:return e.sent(),xD[this.dbname]={},[2]}})})},VD),PD=(GD.prototype.init=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return this.dbname=i,[4,new Promise(function(e,t){var n;r._window&&gD?SD?((n=r._indexedDB.open("_testMozilla")).onerror=function(){return t(A.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}):AD?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(A.storeNotAvailableInPrivateBrowsing):e():t(A.storeNotAvailable)})];case 1:return e.sent(),t=this,[4,new Promise(function(t,n){var e=r._indexedDB.open(i);e.addEventListener("upgradeneeded",function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"})}),e.addEventListener("success",function(e){return t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 2:t._database=e.sent(),e.label=3;case 3:return e.trys.push([3,,5,7]),[4,this.get(B_.key)];case 4:if((n=e.sent())&&JSON.stringify(n)!==JSON.stringify(B_.value))throw A.storeEncryptionInvalid;return[3,7];case 5:return[4,this.set(B_)];case 6:return e.sent(),[7];case 7:return[2]}})})},GD.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").getAllKeys();e.addEventListener("success",function(e){t(e.target.result.filter(function(e){return e!==B_.key}))}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},GD.prototype.get=function(i){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").get(i);e.addEventListener("success",function(e){return t(e.target.result?r._encryption.decrypt(e.target.result.value):null)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},GD.prototype.set=function(t){return re(this,void 0,void 0,function(){var r,i,s=this;return ie(this,function(e){switch(e.label){case 0:return r=t.key,i=t.value,[4,new Promise(function(t,n){var e=s._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").put({key:r,value:s._encryption.encrypt(i)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return e.sent(),[2,i]}})})},GD.prototype.setMany=function(n){return re(this,void 0,void 0,function(){var t,i,s=this;return ie(this,function(e){switch(e.label){case 0:return t=[],i=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),n.forEach(function(e){var n=e.key,r=e.value;t.push(new Promise(function(t){var e=i.put({key:n,value:s._encryption.encrypt(r)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(){t(A.collectionWriteFailed)})}))}),[4,Promise.all(t)];case 1:return e.sent(),[2,n.map(function(e){return e.value})]}})})},GD.prototype.remove=function(i){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").delete(i);n.addEventListener("success",function(){return e(i)}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},GD.prototype.removeMany=function(t){return re(this,void 0,void 0,function(){var i;return ie(this,function(e){switch(e.label){case 0:return i=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),[4,Promise.all(t.map(function(r){return new Promise(function(e,t){var n=i.delete(r);n.addEventListener("success",function(){return e(r)}),n.addEventListener("error",function(e){return t(e.target.error)})})}))];case 1:return[2,e.sent()]}})})},GD.prototype.clear=function(){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").clear();n.addEventListener("success",function(){return e()}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},GD),UD=(HD.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},HD.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},HD.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this.dbname=n,e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get(B_.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify(B_.value))throw A.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(B_)];case 4:return e.sent(),[7];case 5:return[2]}})})},HD.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return t=this._getActualKey(B_.key),[4,this._asyncStorage.getAllKeys()];case 1:return[2,e.sent().filter(function(e){return n._isBelonging(e)&&e!==t}).map(function(e){return e.substring("".concat(n.dbname,"/").length)})]}})})},HD.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(n))];case 1:return[2,(t=e.sent())?this._encryption.decrypt(JSON.parse(t)):null]}})})},HD.prototype.set=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=r.key,n=r.value,n=JSON.stringify(this._encryption.encrypt(n)),t===B_.key||n.length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),n)]:[3,2];case 1:return e.sent(),[2,JSON.parse(n)];case 2:throw A.storeItemSizeExceeded}})})},HD.prototype.setMany=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:t=[],n=[];try{for(r=se(h),i=r.next();!i.done;i=r.next()){s=i.value;try{a=s.key,o=s.value,u=JSON.stringify(this._encryption.encrypt(o)),a===B_.key||u.length<this.itemSizeLimit?(n.push([this._getActualKey(a),u]),t.push(o)):t.push(A.storeItemSizeExceeded)}catch(e){t.push(A.collectionWriteFailed)}}}catch(e){c={error:e}}finally{try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._asyncStorage.multiSet(n)];case 2:return e.sent(),[3,4];case 3:return e.sent(),[2,new Array(t.length).fill(A.collectionWriteFailed)];case 4:return[2,t]}})})},HD.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.removeItem(this._getActualKey(t))];case 1:return e.sent(),[2,t]}})})},HD.prototype.removeMany=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.multiRemove(n.map(function(e){return t._getActualKey(e)}))];case 1:return e.sent(),[2,n]}})})},HD.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this.getAllKeys()];case 1:return t=e.sent(),[4,this.removeMany(t)];case 2:return e.sent(),[4,this.remove(B_.key)];case 3:return e.sent(),[2]}})})},HD),FD=!0,qD=(jD.off=function(){FD=!1},jD.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];FD&&console.log.apply(console,A_(["".concat("[NESTDB]","[LOG]")],N_(e),!1))},jD.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];FD&&console.warn.apply(console,A_(["".concat("[NESTDB]","[WARNING]")],N_(e),!1))},jD.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];FD&&console.error.apply(console,A_(["".concat("[NESTDB]","[ERROR]")],N_(e),!1))},jD);function jD(){}function HD(e){var t=e.AsyncStorage,e=e.encryption,e=void 0===e?K_:e;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=e}function GD(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;e=e.encryption,e=void 0===e?K_:e;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=e}function VD(e){var t=(e=void 0===e?{}:e).itemSizeLimit,t=void 0===t?4194304:t,n=e.delay,n=void 0===n?1:n,e=e.encryption,e=void 0===e?K_:e;this._encryption=e,this.itemSizeLimit=t,this.delay=n,this.observer={}}function BD(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,e=e.store,a=this;this._state=FR.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=A_([[r]],N_(s.filter(function(e){return mD.createKey(e)!==a.keyName})),!1),this._keyHash=i,this._store=e,this._mutex=new DD("".concat(aD(t,n),".lock")),this._blobContainer=new oD({dbname:t,collectionName:n,store:e}),this._transaction=new vD({dbname:t,collectionName:n,store:e})}function KD(e,t){void 0===t&&(t={});var f=this;return this._state=kD.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],RD[e]&&!t.forceCreate||(this.nodeId=CD(),this.key=e,gD&&(!t.startAsInvisible&&"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&f.claimHost()}),window.addEventListener("message",function(e){var t,n,r=e.data,i=r.nodeId,s=r.requestId,a=r.key,o=r.op,u=r.data;if(i!==f.nodeId&&a===f.key)switch(o){case ND.NEWNODE:f._sendSync();break;case ND.CLAIM_HOST:f._sendSync(),f._hostId=i;break;case ND.SYNC_HOST:if(!f.isInSync){f._activationTimeout&&clearTimeout(f._activationTimeout);var c=u.currentItemRequestId,l=u.queue;try{for(var h=se(l),d=h.next();!d.done;d=h.next())!function(t){f._queue.findIndex(function(e){return e.requestId===t.requestId})<0&&f._requestLock({nodeId:t.nodeId,requestId:t.requestId,key:f.key,op:ND.REQUEST_LOCK,ts:t.ts})}(d.value)}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}f._currentItem=f._queue.find(function(e){return e.requestId===c}),f._completeSync()}break;case ND.REMOVENODE:f._queue=f._queue.filter(function(e){return e.nodeId!==r.nodeId}),f._currentItem&&f._currentItem.nodeId===r.nodeId&&(f._currentItem=null,f._acquire(f._queue[0]));break;case ND.REQUEST_LOCK:f._requestLock(r);break;case ND.ACQUIRE_LOCK:l=f._queue.find(function(e){return e.requestId===s});f._acquire(l);break;case ND.RELEASE_LOCK:f._release(s)}}),window.addEventListener("beforeunload",function(){f._send(ND.REMOVENODE)})),RD[e]=this),RD[e]}(fr=OD=OD||{}).INIT="INIT",fr.OPENING="OPENING",fr.OPENED="OPENED",fr.CLOSED="CLOSED";Object.defineProperty(YD.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(YD.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),YD.prototype.commitSchema=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this._state!==OD.OPENING?[3,2]:[4,Promise.all(n.map(function(i){return re(t,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=i.collectionName,n=i.keyName,r=i.index,r=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new MD({dbname:this.name,collectionName:t,keyName:n,keyHash:i.keyHash||null,indexes:r,store:this._store})),[4,this._collections.get(t).init()];case 1:return e.sent(),[2]}})})}))];case 1:return e.sent(),[3,3];case 2:throw A.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},YD.prototype.open=function(){var i;return re(this,void 0,void 0,function(){var o,n,u,r,c=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._globalMutex.lock()];case 1:if(e.sent(),this._state===OD.OPENED)return[3,15];this._state=OD.OPENING,e.label=2;case 2:return e.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return e.sent(),t=this.name,o="".concat(sD(t),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(o)];case 4:return u=null!=(i=e.sent())?i:n,[2,new Promise(function(r,i){function s(r){u.version<c._version?c._event.upgrade(u.version,function(n){return re(c,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:if(n)return[3,5];u.version++,u.collectionNames=Array.from(this._collections.keys()),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.set({key:o,value:u,generation:this._version})];case 2:return e.sent(),r({continued:!0}),[3,4];case 3:return t=e.sent(),r({continued:!1,err:t}),[3,4];case 4:return[3,6];case 5:r({continued:!1,err:n}),e.label=6;case 6:return[2]}})})}):r({continued:!1})}function a(e){var t,n=e.continued,e=void 0===(e=e.err)?null:e;void 0!==n&&n?setTimeout(function(){return s(a)},10):e?(qD.error(e.message),c._globalMutex.unlock(),c._event.error(e),i(e)):(t=[],u.collectionNames.forEach(function(n){c._collections.has(n)||t.push(re(c,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,MD.metadataOf(this.name,n,this._store)];case 1:return(t=e.sent())?(t=new MD({dbname:this.name,collectionName:n,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(n,t),[4,t.init()]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})}))}),Promise.all(t).then(function(){c._state=OD.OPENED,c._globalMutex.unlock(),c._event.success(),r()}).catch(function(e){qD.error(e.message),c._globalMutex.unlock(),c._event.error(e),i(e)}))}s(a)})];case 5:switch((r=e.sent()).code){case HO.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case HO.STORE_NOT_AVAILABLE:return[3,8];case HO.STORE_ENCRYPTION_INVALID:return[3,10]}return[3,13];case 6:return qD.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new LD({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 7:return e.sent(),[3,14];case 8:return qD.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new LD({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 9:return e.sent(),[3,14];case 10:return qD.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return e.sent(),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 12:return e.sent(),[3,14];case 13:throw qD.error(r.message),this._globalMutex.unlock(),this._event.error(r),r;case 14:return[3,15];case 15:return[2]}var t})})},YD.prototype.close=function(){this._collections.forEach(function(e){return e.close()}),this._state=OD.CLOSED},YD.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return e.sent(),[2]}})})},YD.prototype.reset=function(){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.close(),(t=pD.get(this.name))&&t.clearByCondition(function(e){return e.key.startsWith(sD(n.name))}),[4,this._store.clear()];case 1:return e.sent(),[2]}})})},YD.prototype.on=function(e,t){this._event[e]=t},YD.prototype.off=function(e){"function"==typeof this._event[e]&&(this._event[e]="upgrade"===e?zR:BR)},YD.prototype.collection=function(e){return this._collections.get(e)||null};var QD=YD,zD=null,WD=(R.init=function(e){var t,n=e.appId,r=e.appVersion,r=void 0===r?null:r,i=e.modules,i=void 0===i?[]:i,s=e.options,s=void 0===s?new V_:s,a=e.debugMode,a=void 0!==a&&a,o=e.customApiHost,u=e.customWebSocketHost,c=e.newInstance,l=e.logLevel,h=e.localCacheEnabled,h=void 0!==h&&h,d=e.localCacheEncryption,e=e.useAsyncStorageStore,e=void 0===e?null:e;return!zD||void 0!==c&&c?(c="su-".concat(U_()),t=new LD({encryption:d=null!=d?d:{encrypt:function(e){return e},decrypt:function(e){return e}}}),a||(t=e?new UD({AsyncStorage:e,encryption:d}):new PD({encryption:d})),new k(c,{appId:n,appVersion:r,options:s,apiHost:null!=o?o:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=u?u:"wss://ws-".concat(n,".sendbird.com"),store:t,encryption:d,logLevel:l,localCacheEnabled:h,debugMode:a}),e=new R(c,s,A_(A_([],N_(i),!1),[new Cb],!1)),zD=zD||e,e):zD},Object.defineProperty(R,"instance",{get:function(){return zD},enumerable:!1,configurable:!0}),Object.defineProperty(R,"version",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appId",{get:function(){return k.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appInfo",{get:function(){return k.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appVersion",{get:function(){var e;return null!=(e=k.of(this._iid).sdkState.appVersion)?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"debugMode",{get:function(){return k.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"logLevel",{get:function(){return k.of(this._iid).logger.level},set:function(e){k.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isCacheEnabled",{get:function(){return k.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"ekey",{get:function(){return Qy(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"currentUser",{get:function(){var e;return null!=(e=k.of(this._iid).sessionManager.currentUser)?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"connectionState",{get:function(){var e=k.of(this._iid).connectionManager;return e.isConnected?my.OPEN:e.isConnecting?my.CONNECTING:my.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"lastConnectedAt",{get:function(){var e=k.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),R.prototype._getPreferenceCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")},R.prototype._getUserProfileCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")},R.prototype.getMemoryStoreForDebugging=function(){var e=k.of(this._iid),t=e.debugMode,e=e.cacheContext;if(t)return e.store instanceof LD?e.store:null;throw p.debugModeRequired},R.prototype.addExtension=function(e,t){var n=k.of(this._iid).sdkState;-1<["sb_uikit","sb_syncmanager"].indexOf(e)&&(n.extensions[e]=t)},R.prototype.initializeCache=function(o){return re(this,void 0,void 0,function(){var t,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return i=k.of(this._iid),t=i.sdkState,r=i.cacheContext,s=i.connectionManager,i=i.dispatcher,t.userId&&t.userId===o?[3,6]:[4,s.logout()];case 1:return e.sent(),t.userId=o,r.localCacheEnabled?(s="sendbird@".concat(t.appId,"/").concat(o,".db"),r.nestdb&&r.nestdb.state!==OD.CLOSED&&r.nestdb.name===s?[3,3]:((a=r.nestdb=new QD({name:"sendbird@".concat(t.appId,"/").concat(o,".db"),version:1,store:r.store})).on("upgrade",(n=a,function(e,t){0===e?n.commitSchema([{collectionName:"GroupChannel",keyName:"url",index:[kN(CN.LATEST_LAST_MESSAGE),kN(CN.CHRONOLOGICAL),kN(CN.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:"Message",keyName:"messageId",index:[RN(NN.CHANNEL_LATEST),RN(NN.NEWEST_CHILD_MESSAGE)]},{collectionName:"UnsentMessage",keyName:"reqId",index:[RN(NN.CHANNEL_LATEST),RN(NN.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]).then(function(){return t()}).catch(function(e){return t(e)}):t()})),[4,a.open()])):[3,6];case 2:e.sent(),i.dispatch(new e1(this._iid,{userId:o})),e.label=3;case 3:return[4,r.preference.init(this._getPreferenceCacheKey(o))];case 4:return e.sent(),[4,r.preference.get(this._getUserProfileCacheKey(o))];case 5:(a=e.sent())&&new Vg(this._iid,a).apply(),e.label=6;case 6:return[2]}var n})})},R.prototype.clearCachedData=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return(t=k.of(this._iid).cacheContext).localCacheEnabled?(t.nestdb&&t.nestdb.clear(),[4,t.preference.clear()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.clearCachedMessages=function(t){return re(this,void 0,void 0,function(){var n,r,i=this;return ie(this,function(e){switch(e.label){case 0:return C(h("string",t)).throw(p.invalidParameters),n=qN.of(this._iid),r=UN.of(this._iid),n&&r?[4,Promise.all(t.map(function(t){return re(i,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,n.removeMessagesOfChannel(t)];case 1:return e.sent(),[4,r.removeMessagesOfChannel(t)];case 2:return e.sent(),[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.connect=function(a,o){return void 0===o&&(o=null),re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:i=k.of(this._iid),t=i.sdkState,n=i.cacheContext,r=i.connectionManager,i=i.statLogCollector,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.initializeCache(a)];case 2:return e.sent(),[3,4];case 3:return e.sent(),s=k.of(this._iid).logger,n.localCacheEnabled=!1,s.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return[4,i.init("sendbird@".concat(t.appId,"/").concat(a,".statlog"))];case 5:return e.sent(),[4,r.connect(o)];case 6:return e.sent(),this._appStateChangeDetector.start(),t.appState="foreground",[4,null==(s=GN.of(this._iid))?void 0:s.processNonAutoResendRegisteredPendingMessages()];case 7:return e.sent(),this._onlineDetector.start(),[2,this.currentUser]}})})},R.prototype.reconnect=function(){var e=k.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.sessionManager.auth.hasSession;return e&&t.resetAndReconnect().then(function(){n.appState="foreground"}).catch(function(){}),e},R.prototype.disconnect=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return r=k.of(this._iid),t=r.connectionManager,n=r.cacheContext,r=r.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return e.sent(),n.localCacheEnabled?[4,this.clearCachedData()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},R.prototype.setBackgroundState=function(){var e=k.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"foreground"===n.appState&&(n.appState="background",e.debug("going background state"),t.background())},R.prototype.setForegroundState=function(){var e=k.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"background"===n.appState&&(n.appState="foreground",e.debug("going foreground state"),t.resetAndReconnect())},R.prototype.setSessionHandler=function(e){C(!1).throw(p.invalidParameters),k.of(this._iid).sessionManager.handler=e},R.prototype.addUserEventHandler=function(e,t){C(l("string",e)&&!1).throw(p.invalidParameters),k.of(this._iid).userEventHandlers.set(e,t)},R.prototype.removeUserEventHandler=function(e){k.of(this._iid).userEventHandlers.delete(e)},R.prototype.removeAllUserEventHandler=function(){k.of(this._iid).userEventHandlers.clear()},R.prototype.addConnectionHandler=function(e,t){C(l("string",e)&&!1).throw(p.invalidParameters),k.of(this._iid).connectionHandlers.set(e,t)},R.prototype.removeConnectionHandler=function(e){k.of(this._iid).connectionHandlers.delete(e)},R.prototype.removeAllConnectionHandler=function(){k.of(this._iid).connectionHandlers.clear()},R.prototype.createApplicationUserListQuery=function(e){return new fR(this._iid,e=void 0===e?{}:e)},R.prototype.createBlockedUserListQuery=function(e){return new _R(this._iid,e=void 0===e?{}:e)},R.prototype.createFriendListQuery=function(e){return new gR(this._iid,e=void 0===e?{}:e)},R.prototype.createMessageSearchQuery=function(e){return new Tb(this._iid,e)},R.prototype.buildUserFromSerializedData=function(e){e=Mg(e);return new u(this._iid,u.payloadify(e))},R.prototype.updateCurrentUserInfo=function(i){return void 0===i&&(i={}),re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){switch(e.label){case 0:return i=f(f({},g1),i),C(L_((t=i).profileImage,!0)&&l("string",t.profileUrl,!0)&&l("string",t.nickname,!0)).throw(p.invalidParameters),this.currentUser?(n=k.of(this._iid),r=n.sdkState,n=n.requestQueue,r=new I1(f({userId:r.userId},i)),[4,n.send(r)]):[3,2];case 1:return n=e.sent(),r=n.as(T1).user,this.currentUser&&(i.nickname&&(this.currentUser.nickname=r.nickname),(i.profileUrl||i.profileImage)&&(this.currentUser.plainProfileUrl=r.profileUrl)),[2,r];case 2:throw p.connectionRequired}var t})})},R.prototype.updateCurrentUserInfoWithPreferredLanguages=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(h("string",r)).throw(p.invalidParameters),this.currentUser?(t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new I1({userId:n.userId,preferredLanguages:r}),[4,t.send(n)]):[3,2];case 1:return t=e.sent(),n=t.as(T1).user,this.currentUser&&(this.currentUser.preferredLanguages=n.preferredLanguages),[2,n];case 2:throw p.connectionRequired}})})},R.prototype.registerFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(l("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new D1({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,nN.SUCCESS];case 3:return e.sent(),[2,nN.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,nN.PENDING];case 6:return[2]}})})},R.prototype.unregisterFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(l("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new j1({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,nN.SUCCESS];case 3:return e.sent(),[2,nN.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,nN.PENDING];case 6:return[2]}})})},R.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return this.currentUser?(t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new W1({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.registerAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(l("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new w1({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,nN.SUCCESS];case 3:return e.sent(),[2,nN.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,nN.PENDING];case 6:return[2]}})})},R.prototype.unregisterAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(l("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new P1({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,nN.SUCCESS];case 3:return e.sent(),[2,nN.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,nN.PENDING];case 6:return[2]}})})},R.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return this.currentUser?(t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new B1({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.getChannelInvitationPreference=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new pA({userId:n.userId}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(vA).autoAccept}]}})})},R.prototype.setChannelInvitationPreference=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("boolean",r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new _A({userId:n.userId,willAutoAccept:r}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(yA).autoAccept}]}})})},R.prototype.getDoNotDisturb=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new mA({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(gA).preference]}})})},R.prototype.setDoNotDisturb=function(r,i,s,a,o,u){return void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===u&&(u=""),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("boolean",r)&&l("number",i)&&l("number",s)&&l("number",a)&&l("number",o)&&l("string",u)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new EA({userId:n.userId,doNotDisturbOn:r,startHour:i,startMin:s,endHour:a,endMin:o,timezone:u}),[4,t.send(n)];case 1:return[2,e.sent().as(bA).preference]}})})},R.prototype.getSnoozePeriod=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new IA({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(TA).snoozePeriod]}})})},R.prototype.setSnoozePeriod=function(r,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("boolean",r)&&l("number",i)&&l("number",s)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new wA({userId:n.userId,snoozeOn:r,startTs:i,endTs:s}),[4,t.send(n)];case 1:return[2,e.sent().as(SA).snoozePeriod]}})})},R.prototype.getMyPushTokensByToken=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)&&G_(iN,i)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new dA({userId:n.userId,type:i,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(fA).pushTokens]}})})},R.prototype.getPushTriggerOption=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new n1({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(r1).pushTriggerOption]}})})},R.prototype.setPushTriggerOption=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(G_(rN,r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new i1({userId:n.userId,pushTriggerOption:r}),[4,t.send(n)];case 1:return[2,e.sent().as(s1).pushTriggerOption]}})})},R.prototype.getPushTemplate=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new nO({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(rO).name]}})})},R.prototype.setPushTemplate=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(G_(sN,r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new iO({userId:n.userId,templateName:r}),[4,t.send(n)];case 1:return[2,e.sent().as(sO).name]}})})},R.prototype.blockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof u||l("string",r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new CA({userId:n.userId,blockedUserId:r instanceof u?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.blockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.blockUser(t)]})})},R.prototype.unblockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof u||l("string",r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new BA({userId:n.userId,unblockedUserId:r instanceof u?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.unblockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unblockUser(t)]})})},R.prototype.getFriendChangeLogsByToken=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("string",r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new aO({userId:n.userId,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(oO).changelogs]}})})},R.prototype.getAllowFriendDiscovery=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new xO({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(LO).allowFriendDiscovery]}})})},R.prototype.setAllowFriendDiscovery=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(l("boolean",r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new PO({userId:n.userId,allowFriendDiscovery:r}),[4,t.send(n)];case 1:return e.sent(),[2,r]}})})},R.prototype.uploadFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new uO({userId:n.userId,discoveries:r}),[4,t.send(n)];case 1:return[2,e.sent().as(cO).friendDiscoveryRequestId]}})})},R.prototype.deleteFriendDiscovery=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.deleteFriendDiscoveries([t])]})})},R.prototype.deleteFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(h("string",r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new lO({userId:n.userId,discoveryKeys:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.addFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(h("string",r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new wO({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return[2,e.sent().as(SO).users]}})})},R.prototype.deleteFriend=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.deleteFriends([t])]})})},R.prototype.deleteFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(h("string",r)).throw(p.invalidParameters),t=k.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new CO({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.getAllEmoji=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new sR,[4,t.send(n)];case 1:return[2,e.sent().as(aR).emojiContainer]}})})},R.prototype.getEmojiCategory=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new oR({categoryId:r}),[4,t.send(n)];case 1:return[2,e.sent().as(uR).emojiCategory]}})})},R.prototype.getEmoji=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=k.of(this._iid).requestQueue,n=new cR({key:r}),[4,t.send(n)];case 1:return[2,e.sent().as(lR).emoji]}})})},R);function R(a,e,t){var o=this,e=(this._fcmPushToken=null,this._apnsPushToken=null,this._iid=a,this.options=e,k.of(a)),u=e.sdkState,c=e.cacheContext,n=e.dispatcher,r=e.sessionManager,i=e.requestQueue,s=e.logger,l=e.userEventHandlers;this._onlineDetector=new b1({logger:s,connectionDelegate:{reconnect:function(){var e=k.of(a),t=e.sdkState,e=e.connectionManager;"foreground"===t.appState&&e.resetAndReconnect()},disconnect:function(){k.of(a).connectionManager.disconnect()}}}),new GN(a,{localCacheEnabled:c.localCacheEnabled,dispatcher:n,sdkState:u,logger:s}),t.forEach(function(e){e.init(a,{sdkState:u,cacheContext:c,dispatcher:n,sessionManager:r,requestQueue:i,logger:s,onlineDetector:o._onlineDetector}),o[e.name]=e}),this._appStateChangeDetector=new E1,this._appStateChangeDetector.on("resume",function(){s.debug("the page resumes from freeze"),o.setForegroundState()}).on("pause",function(){s.debug("the page freezes"),o.setBackgroundState()}),n.on(function(e){var t;if(e instanceof wy)"USEV"===e.code&&(i=e.as(t1).event).category===DN.FRIEND_DISCOVERED&&(t=$N.getDataAsFriendDiscoveredEvent(a,i).friendDiscoveries,ae(function(){return re(o,void 0,void 0,function(){return ie(this,function(e){return[2,l.forEach(function(e){e.onFriendsDiscovered(t)})]})})}));else if(e instanceof qy){var n=k.of(o._iid).subscribedUnreadMessageCount,r=!1,i=e.ts;if("number"==typeof i&&i>n.ts){if(n.all!==e.all&&(r=!0),n.all=0<=e.all?e.all:0,e.customTypes)for(var s in e.customTypes)n.customTypes[s]!==e.customTypes[s]&&(r=!0),n.customTypes[s]=e.customTypes[s];r=r&&0<n.ts,n.ts=i}r&&ae(function(){return re(o,void 0,void 0,function(){return ie(this,function(e){return[2,l.forEach(function(e){e.onTotalUnreadMessageCountUpdated(n.all,n.customTypes)})]})})})}else e instanceof Gg&&c.localCacheEnabled&&c.preference.set(o._getUserProfileCacheKey(u.userId),Vg.payloadify(e.userProfile))})}function YD(e){var t=e.name,n=e.version,r=e.store,e=e.config;this.name=t,this._version=n,this._state=OD.INIT,this._config=e||new bR({dbname:t}),this._store=r,this._event={success:BR,error:BR,upgrade:zR},this._collections=new Map,this._globalMutex=new DD("".concat(this.name,".lock")),this._config.disableLogger&&qD.off(),new pD({dbname:t,limit:this._config.cacheLimit})}i=new(function(){function e(){y(this,e),g(this,"_ctx",{})}var t,n,r,i;return m(e,[{key:"init",value:function(e){var t=e.appId,e=e.chatInstance;this._consoleLogListener=new SN(ml.NONE),T.addListener(this._consoleLogListener),this._ctx.appId=t,this._ctx.clientId=oe(),this._ctx.sb=e||WD.init({appId:this._ctx.appId,modules:[new ck]}),this._ctx.commandRouter=new hN(this._ctx),this._ctx.deviceManager=new aN,this._ctx.liveEventManager=new gk(this._ctx)}},{key:"setLoggerLevel",value:function(e){return this._consoleLogListener.setLoggerLevel(e)}},{key:"authenticate",value:(i=_(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.commandRouter.authenticate({userId:t,accessToken:n});case 2:return e.next=4,this._ctx.commandRouter.connectWs();case 4:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"deauthenticate",value:(r=_(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.sb.disconnect();case 2:this._ctx.commandRouter.deauthenticate(),this._ctx.liveEventManager.clear(),T.removeAllListener();case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"createLiveEvent",value:(n=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.liveEventManager.createLiveEvent(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getLiveEvent",value:(t=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.liveEventManager.getLiveEvent(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"createLiveEventListQuery",value:function(e){return new Ul(e,this._ctx.commandRouter,this._ctx.liveEventManager)}},{key:"useMedia",value:function(e){return this._ctx.deviceManager.useMedia(e)}},{key:"getCurrentAudioInputDevice",value:function(){return this._ctx.deviceManager.getCurrentAudioInputDevice()}},{key:"getAvailableAudioInputDevices",value:function(){return this._ctx.deviceManager.getAvailableAudioInputDevices()}},{key:"selectAudioInput",value:function(e){return this._ctx.deviceManager.selectDevice("audioinput",e)}},{key:"getCurrentVideoInputDevice",value:function(){return this._ctx.deviceManager.getCurrentVideoInputDevice()}},{key:"getAvailableVideoInputDevices",value:function(){return this._ctx.deviceManager.getAvailableVideoInputDevices()}},{key:"selectVideoInput",value:function(e){return this._ctx.deviceManager.selectDevice("videoinput",e)}}]),e}());D.LiveEvent=C_,D.SendbirdLive=i,Object.defineProperty(D,"__esModule",{value:!0})});