!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sendbirdLive={})}(this,function(D){"use strict";function M(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){m(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function L(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function v(o){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=o.apply(e,a);function i(e){L(r,t,n,i,s,"next",e)}function s(e){L(r,t,n,i,s,"throw",e)}i(void 0)})}}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=U(n),t=(e=r?(e=U(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return E(t)}}function F(e){return function(e){if(Array.isArray(e))return H(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||j(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function G(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=j(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}var V,B="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},K={exports:{}},K=function(a){var u,e=Object.prototype,c=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function o(e,t,n,r){var i,s,a,o,t=t&&t.prototype instanceof _?t:_,t=Object.create(t.prototype),r=new S(r||[]);return t._invoke=(i=e,s=n,a=r,o=h,function(e,t){if(o===f)throw new Error("Generator is already running");if(o===p){if("throw"===e)throw t;return k()}for(a.method=e,a.arg=t;;){var n=a.delegate;if(n){n=function e(t,n){var r=t.iterator[n.method];if(r===u){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=u,e(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}r=l(r,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;r=r.arg;if(!r)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v;{if(!r.done)return r;n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=u)}n.delegate=null;return v}(n,a);if(n){if(n===v)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===h)throw o=p,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=f;n=l(i,s,a);if("normal"===n.type){if(o=a.done?p:d,n.arg!==v)return{value:n.arg,done:a.done}}else"throw"===n.type&&(o=p,a.method="throw",a.arg=n.arg)}}),t}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}a.wrap=o;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",v={};function _(){}function y(){}function m(){}var t={},g=(s(t,r,function(){return this}),Object.getPrototypeOf),g=g&&g(g(C([]))),E=(g&&g!==e&&c.call(g,r)&&(t=g),m.prototype=_.prototype=Object.create(t));function b(e){["next","throw","return"].forEach(function(t){s(e,t,function(e){return this._invoke(t,e)})})}function I(a,o){var t;this._invoke=function(n,r){function e(){return new o(function(e,t){!function t(e,n,r,i){var s,e=l(a[e],a,n);if("throw"!==e.type)return(n=(s=e.arg).value)&&"object"==typeof n&&c.call(n,"__await")?o.resolve(n.__await).then(function(e){t("next",e,r,i)},function(e){t("throw",e,r,i)}):o.resolve(n).then(function(e){s.value=e,r(s)},function(e){return t("throw",e,r,i)});i(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(t){if(t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=u,e.done=!0,e}).next=e}return{next:k}}function k(){return{value:u,done:!0}}return s(E,"constructor",y.prototype=m),s(m,"constructor",y),y.displayName=s(m,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,i,"GeneratorFunction")),e.prototype=Object.create(E),e},a.awrap=function(e){return{__await:e}},b(I.prototype),s(I.prototype,n,function(){return this}),a.AsyncIterator=I,a.async=function(e,t,n,r,i){void 0===i&&(i=Promise);var s=new I(o(e,t,n,r),i);return a.isGeneratorFunction(t)?s:s.next().then(function(e){return e.done?e.value:s.next()})},b(E),s(E,i,"Generator"),s(E,r,function(){return this}),s(E,"toString",function(){return"[object Generator]"}),a.keys=function(n){var e,r=[];for(e in n)r.push(e);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return s.type="throw",s.arg=n,r.next=e,t&&(r.method="next",r.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],s=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),o=c.call(i,"finallyLoc");if(a&&o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}var s=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(n=i.completion).type&&(r=n.arg,T(i)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=u),v}},a}(K.exports);try{regeneratorRuntime=K}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=K:Function("r","regeneratorRuntime = r")(K)}var Q=new Uint8Array(16);var z=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function W(e){return"string"==typeof e&&z.test(e)}for(var Y=[],X=0;X<256;++X)Y.push((X+256).toString(16).substr(1));function J(e,t){t=1<arguments.length&&void 0!==t?t:0,e=(Y[e[t+0]]+Y[e[t+1]]+Y[e[t+2]]+Y[e[t+3]]+"-"+Y[e[t+4]]+Y[e[t+5]]+"-"+Y[e[t+6]]+Y[e[t+7]]+"-"+Y[e[t+8]]+Y[e[t+9]]+"-"+Y[e[t+10]]+Y[e[t+11]]+Y[e[t+12]]+Y[e[t+13]]+Y[e[t+14]]+Y[e[t+15]]).toLowerCase();if(W(e))return e;throw TypeError("Stringified UUID is invalid")}function Z(){try{0}catch(e){}}function $(e,t,n){var r=(e=e||{}).random||(e.rng||function(){if(V=V||"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto))return V(Q);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return J(r)}Z(),Z();function ee(e){return e&&e.Math==Math&&e}function te(e){try{return!!e()}catch(e){return!0}}function ne(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function oe(e){return ot(at(e),8,-1)}function ue(e){if(null==e)throw ht("Can't call method on "+e);return e}function ce(e){return dt(ft(e))}function le(e){return"function"==typeof e}function he(e){return"object"==typeof e?null!==e:pt(e)}function de(e,t){return arguments.length<2?(n=vt[e],_t(n)?n:void 0):vt[e]&&vt[e][t];var n}function fe(e){try{return Nt(e)}catch(e){return"Object"}}function pe(e){if(At(e))return e;throw Rt(Ot(e)+" is not a function")}function ve(e,t){return null==(e=e[t])?void 0:Dt(e)}function _e(t,n){try{qt(Ut,t,{value:n,configurable:!0,writable:!0})}catch(e){Ut[t]=n}return n}function ye(e){return Gt(Ht(e))}function me(e){return"Symbol("+(void 0===e?"":e)+")_"+Wt(++Qt+zt,36)}function ge(e){var t;return Xt(en,e)&&(Zt||"string"==typeof en[e])||(t="Symbol."+e,Zt&&Xt(tn,e)?en[e]=tn[e]:en[e]=($t&&nn?nn:rn)(t)),en[e]}function Ee(e,t){if(!an(e)||on(e))return e;var n=un(e,hn);if(n){if(n=sn(n,e,t=void 0===t?"default":t),!an(n)||on(n))return n;throw ln("Can't convert object to primitive value")}return cn(e,t=void 0===t?"number":t)}function be(e){return e=dn(e,"string"),fn(e)?e:e+""}function Ie(e){return vn?pn.createElement(e):{}}function we(e){if(Sn(e))return e;throw kn(Cn(e)+" is not an object")}function Te(e){return Bn[e]||(Bn[e]=Vn(e))}function Se(e,t,n,r){var i=(r=r||{}).enumerable,s=void 0!==r.name?r.name:t;if(ur(n)&&lr(n,s,r),r.global)i?e[t]=n:hr(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=n:cr.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e}function Ce(e){return(e=+e)!=e||0==e?0:pr(e)}function ke(e,t){return(e=vr(e))<0?_r(e+t,0):yr(e,t)}function Ne(e){return 0<e?gr(mr(e),9007199254740991):0}function Ae(e){return Er(e.length)}function Oe(o){return function(e,t,n){var r,i=br(e),s=wr(i),a=Ir(n,s);if(o&&t!=t){for(;a<s;)if((r=i[a++])!=r)return!0}else for(;a<s;a++)if((o||a in i)&&i[a]===t)return o||a||0;return!o&&-1}}function Re(e,t){var n,r=Sr(e),i=0,s=[];for(n in r)!Tr(kr,n)&&Tr(r,n)&&Nr(s,n);for(;t.length>i;)!Tr(r,n=t[i++])||~Cr(s,n)||Nr(s,n);return s}function De(e,t){return(e=Vr[Gr(e)])==Kr||e!=Br&&(jr(t)?Fr(t):!!t)}function Me(e,t){var n,r,i,s=e.target,a=e.global,o=e.stat,u=a?Qr:o?Qr[s]||Xr(s,{}):(Qr[s]||{}).prototype;if(u)for(n in t){if(r=t[n],i=e.dontCallGetSet?(i=zr(u,n))&&i.value:u[n],!Zr(a?n:s+(o?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;Jr(r,i)}(e.sham||i&&i.sham)&&Wr(r,"sham",!0),Yr(u,n,r,e)}}function xe(e,t){return $r(e),void 0===t?e:ei?ti(e,t):function(){return e.apply(t,arguments)}}function Le(){}function Pe(e){if(!hi(e))return!1;try{return vi(Le,pi,e),!0}catch(e){return!1}}function Ue(e){if(!hi(e))return!1;switch(di(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return mi||!!yi(_i,fi(e))}catch(e){return!0}}function qe(e,t){return new(Ti(e))(0===t?0:t)}function Fe(d){var f=1==d,p=2==d,v=3==d,_=4==d,y=6==d,m=7==d,g=5==d||y;return function(e,t,n,r){for(var i,s,a=ki(e),o=Ci(a),u=Si(t,n),c=Ni(o),l=0,t=r||Ai,h=f?t(e,c):p||m?t(e,0):void 0;l<c;l++)if((g||l in o)&&(s=u(i=o[l],l,a),d))if(f)h[l]=s;else if(s)switch(d){case 3:return!0;case 5:return i;case 6:return l;case 2:Oi(h,i)}else switch(d){case 4:return!1;case 7:Oi(h,i)}return y?-1:v||_?_:h}}function je(t){return 51<=Di||!Ri(function(){var e=[];return(e.constructor={})[Mi]=function(){return{foo:1}},1!==e[t](Boolean).foo})}var He,Ge,Ve,Be,Ke,Qe,ze,We,u,Ye,K=ee("object"==typeof globalThis&&globalThis)||ee("object"==typeof window&&window)||ee("object"==typeof self&&self)||ee("object"==typeof B&&B)||function(){return this}()||Function("return this")(),B={},e=!te(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),Xe=!te(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),Je=Function.prototype.call,Ze=Xe?Je.bind(Je):function(){return Je.apply(Je,arguments)},$e={},et={}.propertyIsEnumerable,tt=Object.getOwnPropertyDescriptor,nt=tt&&!et.call({1:2},1),nt=($e.f=nt?function(e){e=tt(this,e);return!!e&&e.enumerable}:et,Xe),et=Function.prototype,rt=et.bind,it=et.call,st=nt&&rt.bind(it,it),et=nt?function(e){return e&&st(e)}:function(e){return e&&function(){return it.apply(e,arguments)}},rt=et,at=rt({}.toString),ot=rt("".slice),nt=te,ut=oe,ct=Object,lt=et("".split),rt=nt(function(){return!ct("z").propertyIsEnumerable(0)})?function(e){return"String"==ut(e)?lt(e,""):ct(e)}:ct,ht=TypeError,dt=rt,ft=ue,pt=le,vt=K,_t=le,nt=et({}.isPrototypeOf),yt=de("navigator","userAgent")||"",mt=yt,gt=K.process,Et=K.Deno,gt=gt&&gt.versions||Et&&Et.version,Et=gt&&gt.v8,gt=kt=!(kt=Et?0<(It=Et.split("."))[0]&&It[0]<4?1:+(It[0]+It[1]):kt)&&mt&&(!(It=mt.match(/Edge\/(\d+)/))||74<=It[1])&&(It=mt.match(/Chrome\/(\d+)/))?+It[1]:kt,bt=gt,Et=te,mt=!!Object.getOwnPropertySymbols&&!Et(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&bt&&bt<41}),It=mt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,wt=de,Tt=le,St=nt,Ct=Object,kt=It?function(e){return"symbol"==typeof e}:function(e){var t=wt("Symbol");return Tt(t)&&St(t.prototype,Ct(e))},Nt=String,At=le,Ot=fe,Rt=TypeError,Dt=pe,Mt=Ze,xt=le,Lt=he,Pt=TypeError,Et={exports:{}},Ut=K,qt=Object.defineProperty,t=_e,Ft="__core-js_shared__",t=K[Ft]||t(Ft,{}),jt=t,Ht=((Et.exports=function(e,t){return jt[e]||(jt[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.23.4",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.4/LICENSE",source:"https://github.com/zloirock/core-js"}),ue),Gt=Object,Vt=ye,Bt=et({}.hasOwnProperty),Ft=Object.hasOwn||function(e,t){return Bt(Vt(e),t)},Kt=et,Qt=0,zt=Math.random(),Wt=Kt(1..toString),Kt=K,Yt=Et.exports,Xt=Ft,Jt=me,Zt=mt,$t=It,en=Yt("wks"),tn=Kt.Symbol,nn=tn&&tn.for,rn=$t?tn:tn&&tn.withoutSetter||Jt,sn=Ze,an=he,on=kt,un=ve,cn=function(e,t){var n,r;if("string"===t&&xt(n=e.toString)&&!Lt(r=Mt(n,e)))return r;if(xt(n=e.valueOf)&&!Lt(r=Mt(n,e)))return r;if("string"!==t&&xt(n=e.toString)&&!Lt(r=Mt(n,e)))return r;throw Pt("Can't convert object to primitive value")},ln=TypeError,hn=ge("toPrimitive"),dn=Ee,fn=kt,mt=he,pn=K.document,vn=mt(pn)&&mt(pn.createElement),_n=Ie,It=!e&&!te(function(){return 7!=Object.defineProperty(_n("div"),"a",{get:function(){return 7}}).a}),yn=Ze,mn=$e,gn=ne,En=ce,bn=be,In=Ft,wn=It,Tn=Object.getOwnPropertyDescriptor,Yt=(B.f=e?Tn:function(e,t){if(e=En(e),t=bn(t),wn)try{return Tn(e,t)}catch(e){}if(In(e,t))return gn(!yn(mn.f,e,t),e[t])},{}),Kt=e&&te(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),Sn=he,Cn=String,kn=TypeError,Nn=It,An=we,On=be,Rn=TypeError,Dn=Object.defineProperty,Mn=Object.getOwnPropertyDescriptor,xn="enumerable",Ln="configurable",Pn="writable",Jt=(Yt.f=e?Kt?function(e,t,n){var r;return An(e),t=On(t),An(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Pn in n&&!n[Pn]&&((r=Mn(e,t))&&r[Pn]&&(e[t]=n.value,n={configurable:(Ln in n?n:r)[Ln],enumerable:(xn in n?n:r)[xn],writable:!1})),Dn(e,t,n)}:Dn:function(e,t,n){if(An(e),t=On(t),An(n),Nn)try{return Dn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw Rn("Accessors not supported");return"value"in n&&(e[t]=n.value),e},e),Un=Yt,qn=ne,mt=Jt?function(e,t,n){return Un.f(e,t,qn(1,n))}:function(e,t,n){return e[t]=n,e},It={exports:{}},Jt=e,n=Ft,Fn=Function.prototype,jn=Jt&&Object.getOwnPropertyDescriptor,n=n(Fn,"name"),n={EXISTS:n,PROPER:n&&"something"===function(){}.name,CONFIGURABLE:n&&(!Jt||jn(Fn,"name").configurable)},Jt=le,jn=t,Hn=et(Function.toString),Fn=(Jt(jn.inspectSource)||(jn.inspectSource=function(e){return Hn(e)}),jn.inspectSource),Jt=le,jn=Fn,Gn=K.WeakMap,Jt=Jt(Gn)&&/native code/.test(jn(Gn)),jn=Et.exports,Vn=me,Bn=jn("keys"),Gn={},jn=et,Kn=he,Qn=mt,zn=Ft,Wn=Te,r=Gn,Yn="Object already initialized",Xn=K.TypeError,Jn=K.WeakMap,Jt=(ze=Jt||t.state?(He=t.state||(t.state=new Jn),Ge=jn(He.get),Ve=jn(He.has),Be=jn(He.set),Ke=function(e,t){if(Ve(He,e))throw new Xn(Yn);return t.facade=e,Be(He,e,t),t},Qe=function(e){return Ge(He,e)||{}},function(e){return Ve(He,e)}):(r[We=Wn("state")]=!0,Ke=function(e,t){if(zn(e,We))throw new Xn(Yn);return t.facade=e,Qn(e,We,t),t},Qe=function(e){return zn(e,We)?e[We]:{}},function(e){return zn(e,We)}),{set:Ke,get:Qe,has:ze,enforce:function(e){return ze(e)?Qe(e):Ke(e,{})},getterFor:function(t){return function(e){if(Kn(e)&&(e=Qe(e)).type===t)return e;throw Xn("Incompatible receiver, "+t+" required")}}}),t=te,Zn=le,$n=Ft,er=e,tr=n.CONFIGURABLE,nr=Fn,rr=Jt.enforce,ir=Jt.get,sr=Object.defineProperty,ar=er&&!t(function(){return 8!==sr(function(){},"length",{value:8}).length}),or=String(String).split("String"),Jn=It.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!$n(e,"name")||tr&&e.name!==t)&&(er?sr(e,"name",{value:t,configurable:!0}):e.name=t),ar&&n&&$n(n,"arity")&&e.length!==n.arity&&sr(e,"length",{value:n.arity});try{n&&$n(n,"constructor")&&n.constructor?er&&sr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}n=rr(e);return $n(n,"source")||(n.source=or.join("string"==typeof t?t:"")),e},ur=(Function.prototype.toString=Jn(function(){return Zn(this)&&ir(this).source||nr(this)},"toString"),le),cr=Yt,lr=It.exports,hr=_e,jn={},dr=Math.ceil,fr=Math.floor,pr=Math.trunc||function(e){e=+e;return(0<e?fr:dr)(e)},vr=Ce,_r=Math.max,yr=Math.min,mr=Ce,gr=Math.min,Er=Ne,br=ce,Ir=ke,wr=Ae,r={includes:Oe(!0),indexOf:Oe(!1)},Wn=et,Tr=Ft,Sr=ce,Cr=r.indexOf,kr=Gn,Nr=Wn([].push),t=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ar=Re,Or=t.concat("length","prototype"),Jn=(jn.f=Object.getOwnPropertyNames||function(e){return Ar(e,Or)},{}),It=(Jn.f=Object.getOwnPropertySymbols,de),Rr=jn,Dr=Jn,Mr=we,xr=et([].concat),Wn=It("Reflect","ownKeys")||function(e){var t=Rr.f(Mr(e)),n=Dr.f;return n?xr(t,n(e)):t},Lr=Ft,Pr=Wn,Ur=B,qr=Yt,Fr=te,jr=le,Hr=/#|\.prototype\./,Gr=De.normalize=function(e){return String(e).replace(Hr,".").toLowerCase()},Vr=De.data={},Br=De.NATIVE="N",Kr=De.POLYFILL="P",It=De,Qr=K,zr=B.f,Wr=mt,Yr=Se,Xr=_e,Jr=function(e,t,n){for(var r=Pr(t),i=qr.f,s=Ur.f,a=0;a<r.length;a++){var o=r[a];Lr(e,o)||n&&Lr(n,o)||i(e,o,s(t,o))}},Zr=It,$r=pe,ei=Xe,ti=et(et.bind),ni=oe,Wn=Array.isArray||function(e){return"Array"==ni(e)},i={},i=(i[ge("toStringTag")]="z","[object z]"===String(i)),ri=i,ii=le,si=oe,ai=ge("toStringTag"),oi=Object,ui="Arguments"==si(function(){return arguments}()),ri=ri?si:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(t=function(e,t){try{return e[t]}catch(e){}}(e=oi(e),ai))?t:ui?si(e):"Object"==(t=si(e))&&ii(e.callee)?"Arguments":t},ci=et,li=te,hi=le,di=ri,fi=Fn,pi=[],vi=de("Reflect","construct"),_i=/^\s*(?:class|function)\b/,yi=ci(_i.exec),mi=!_i.exec(Le),ci=(Ue.sham=!0,!vi||li(function(){var e;return Pe(Pe.call)||!Pe(Object)||!Pe(function(){e=!0})||e})?Ue:Pe),gi=Wn,Ei=ci,bi=he,Ii=ge("species"),wi=Array,Ti=function(e){var t;return gi(e)&&(t=e.constructor,(Ei(t)&&(t===wi||gi(t.prototype))||bi(t)&&null===(t=t[Ii]))&&(t=void 0)),void 0===t?wi:t},Si=xe,Ci=rt,ki=ye,Ni=Ae,Ai=qe,Oi=et([].push),li={forEach:Fe(0),map:Fe(1),filter:Fe(2),some:Fe(3),every:Fe(4),find:Fe(5),findIndex:Fe(6),filterReject:Fe(7)},Ri=te,Di=gt,Mi=ge("species"),s=Me,xi=li.map,Li=(s({target:"Array",proto:!0,forced:!je("map")},{map:function(e){return xi(this,e,1<arguments.length?arguments[1]:void 0)}}),y(function e(){_(this,e)})),Pi=function(){g(t,Li);var e=b(t);function t(){return _(this,t),e.call(this)}return y(t,[{key:"getApiOption",value:function(){return{auth:this.getAuth(),path:this.getPath(),method:this.getMethod(),body:this.getData(),headers:this.getHeaders()}}},{key:"getAuth",value:function(){return!0}},{key:"getHeaders",value:function(){return{}}}]),t}(),Ui=function(){g(t,Pi);var e=b(t);function t(){return _(this,t),e.call(this)}return y(t,[{key:"getPath",value:function(){return"/v1".concat(this.getSubPath())}}]),t}(),qi=((s=u=u||{}).CREATE="create",s.UPDATE="update",s.GET="get",s.DELETE="delete",s.QUERY="query",s.READY="ready",s.START="start",s.ENTER_HOST="enter_host",s.GET_HOSTS="get_hosts",s.EXIT_HOST="exit_host",s.HOST_ALIVE="host_alive",s.AUDIO="audio",s.VIDEO="video",s.HOST_CREATE_STREAM="host_create_stream",s.HOST_DELETE_STREAM="host_delete_stream",s.HOST_CONNECTED="host_connected",s.ENTER="enter",s.EXIT="exit",s.ALIVE="alive",s.GET_PARTICIPANTS="get_participants",s.CREATE_STREAM="create_stream",s.DELETE_STREAM="delete_stream",s.CONNECTED="connected",s.ATTACH="attach",s.CUSTOM_ITEMS_GET="custom_items_get",s.CUSTOM_ITEMS_UPDATE="custom_items_update",s.CUSTOM_ITEMS_DELETE="custom_items_delete",s.LIVE_EVENT_READY="live_event_ready",s.LIVE_EVENT_STARTED="live_event_started",s.LIVE_EVENT_ENDED="live_event_ended",s.LIVE_EVENT_UPDATED="live_event_updated",s.HOST_ENTERED="host_entered",s.HOST_EXITED="host_exited",s.HOST_DISCONNECTED="host_disconnected",s.HOST_AUDIO_STATUS_CHANGED="host_audio_status_changed",s.HOST_VIDEO_STATUS_CHANGED="host_video_status_changed",s.PARTICIPANT_ENTERED="participant_entered",s.PARTICIPANT_EXITED="participant_exited",(s=Ye=Ye||{}).SINGLE_HOST="single_host",s.MULTIPLE_HOST="multiple_host",function(){g(r,Li);var n=b(r);function r(e){var t;return _(this,r),(t=n.call(this)).payload=t.parseData(e),t}return y(r)}()),Fi=function(){g(t,qi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t)}();function ji(e){return{liveEventId:e.live_event_id,createdAt:e.created_at,setReadyAt:e.set_ready_at,startedAt:e.started_at,endedAt:e.ended_at,state:e.state,isHostStreaming:e.is_host_streaming,createdBy:e.created_by,setReadyBy:e.set_ready_by,startedBy:e.started_by,endedBy:e.ended_by,duration:e.duration,host:e.host?Hi(e.host):void 0,participantCount:e.participant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count,userIdsForHost:e.user_ids_for_host,customItems:e.custom_items,title:e.title,coverUrl:e.cover_url}}function Hi(e){return{hostId:e.host_id,userId:e.user.user_id,nickname:e.user.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,connectedAt:e.connected_at,disconnectedAt:e.disconnected_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,isAudioOn:e.is_audio_on,isVideoOn:e.is_video_on,liveEventId:e.live_event_id}}function Gi(e){return{id:e.rtcstream_id}}function Vi(e){return{participantId:e.participant_id,userId:e.user.user_id,nickname:e.user.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,liveEventId:e.live_event_id}}var s=Me,Bi=li.filter;s({target:"Array",proto:!0,forced:!je("filter")},{filter:function(e){return Bi(this,e,1<arguments.length?arguments[1]:void 0)}});function Ki(e){if(9007199254740991<e)throw es("Maximum allowed index exceeded");return e}function Qi(e,t,n){(t=ts(t))in e?ns.f(e,t,rs(0,n)):e[t]=n}function zi(e){if("Symbol"===ps(e))throw TypeError("Cannot convert a Symbol value to a string");return vs(e)}function Wi(){var e=_s(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}var Yi=ri,Xi=(i||Se(Object.prototype,"toString",i?{}.toString:function(){return"[object "+Yi(this)+"]"},{unsafe:!0}),Re),Ji=t,s=Object.keys||function(e){return Xi(e,Ji)},Zi=ye,$i=s,es=(Me({target:"Object",stat:!0,forced:te(function(){$i(1)})},{keys:function(e){return $i(Zi(e))}}),TypeError),ts=be,ns=Yt,rs=ne,i=Me,a=te,is=Wn,ss=he,as=ye,os=Ae,us=Ki,cs=Qi,ls=qe,hs=je,ds=gt,fs=ge("isConcatSpreadable"),ds=51<=ds||!a(function(){var e=[];return e[fs]=!1,e.concat()[0]!==e}),a=hs("concat"),ps=(i({target:"Array",proto:!0,arity:1,forced:!ds||!a},{concat:function(e){for(var t,n,r,i=as(this),s=ls(i,0),a=0,o=-1,u=arguments.length;o<u;o++)if(function(e){if(!ss(e))return!1;var t=e[fs];return void 0!==t?!!t:is(e)}(r=-1===o?i:arguments[o]))for(n=os(r),us(a+n),t=0;t<n;t++,a++)t in r&&cs(s,a,r[t]);else us(a+1),cs(s,a++,r);return s.length=a,s}}),ri),vs=String,_s=we,ys=Ze,ms=Ft,gs=nt,Es=Wi,bs=RegExp.prototype,hs=n.PROPER,i=Se,Is=we,ws=zi,ds=te,Ts=function(e){var t=e.flags;return void 0!==t||"flags"in bs||ms(e,"flags")||!gs(bs,e)?t:ys(Es,e)},a="toString",Ss=RegExp.prototype[a],ds=ds(function(){return"/a/b"!=Ss.call({source:"a",flags:"b"})}),hs=hs&&Ss.name!=a;function Cs(t){return Object.keys(t).filter(function(e){return null!=t[e]}).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(function(e){if(Array.isArray(e))return e.map(function(e){return encodeURIComponent(e.toString())}).join(",");return encodeURIComponent(e.toString())}(t[e]))}).join("&")}(ds||hs)&&i(RegExp.prototype,a,function(){var e=Is(this);return"/"+ws(e.source)+"/"+ws(Ts(e))},{unsafe:!0});var ks=function(){g(s,Ui);var i=b(s);function s(e,t,n){var r;return _(this,s),m(E(r=i.call(this)),"type",u.QUERY),r.params=r._normalizeParams(e),r.prevToken=t,r.nextToken=n,r}return y(s,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"/live-events?".concat(this._createQuery())}},{key:"getMethod",value:function(){return"GET"}},{key:"_normalizeParams",value:function(e){var t=e.hostType,n=e.liveEventState,r=e.createdAtRange,i=e.participantCountRange,s=e.durationRange,a=e.liveEventIds,o=e.createdByUserIds,e=e.limit;return{hostType:t,liveEventState:n,createdAtRange:r,participantCountRange:i,durationRange:s,liveEventIds:a,createdByUserIds:o,limit:null!=e?Math.min(Math.max(1,e),100):void 0}}},{key:"_createQuery",value:function(){var e;return Cs({hostType:this.params.hostType,liveEventState:this.params.liveEventState,created_at_start_date:null==(e=this.params.createdAtRange)?void 0:e[0],created_at_end_date:null==(e=this.params.createdAtRange)?void 0:e[0],participant_count_gte:null==(e=this.params.participantCountRange)?void 0:e[0],participant_count_lte:null==(e=this.params.participantCountRange)?void 0:e[1],duration_range_gte:null==(e=this.params.durationRange)?void 0:e[0],duration_range_lte:null==(e=this.params.durationRange)?void 0:e[1],liveEventIds:this.params.liveEventIds,createdByUserIds:this.params.createdByUserIds,limit:this.params.limit,prev:this.prevToken,next:this.nextToken})}}]),s}(),Ns=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){var t;return{liveEvents:null==(t=e.live_events)?void 0:t.map(ji),prev:e.prev,next:e.next}}}]),t}(),As=function(){function n(e,t){_(this,n),this.isLoading=!1,this.params=e,this.sender=t,this.prevToken=null,this.nextToken=null}var r,e,t;return y(n,[{key:"hasPrev",get:function(){return!!this.prevToken}},{key:"hasNext",get:function(){return!this.prevToken&&!this.nextToken||!!this.nextToken}},{key:"next",value:(t=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading)throw new Error("query is in progress");e.next=2;break;case 2:if(this.hasNext){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(null,this.nextToken));case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"prev",value:(e=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading)throw new Error("query is in progress");e.next=2;break;case 2:if(this.hasPrev){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(this.prevToken,null));case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_sendQueryCommand",value:(r=v(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n)throw new Error("internal error while creating LiveEventListQueryCommand");e.next=2;break;case 2:return this.isLoading=!0,r=new ks(this.params,t,n),e.next=6,this.sender.send(r);case 6:return r=e.sent,i=r.payload,this.prevToken=i.prev,this.nextToken=i.next,this.isLoading=!1,e.abrupt("return",i.liveEvents);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})}]),n}(),ds={},Os=Yt,Rs=we,Ds=ce,Ms=s;ds.f=e&&!Kt?Object.defineProperties:function(e,t){Rs(e);for(var n,r=Ds(t),i=Ms(t),s=i.length,a=0;a<s;)Os.f(e,n=i[a++],r[n]);return e};function xs(){}function Ls(e){e.write(zs("")),e.close();var t=e.parentWindow.Object;return e=null,t}function Ps(e){Xs[Ys][e]=!0}var Us,qs,hs=de("document","documentElement"),Fs=we,js=ds,Hs=t,i=Gn,Gs=hs,Vs=Ie,Bs="prototype",Ks="script",Qs=Te("IE_PROTO"),zs=function(e){return"<"+Ks+">"+e+"</"+Ks+">"},Ws=function(){try{Us=new ActiveXObject("htmlfile")}catch(e){}Ws="undefined"==typeof document||document.domain&&Us?Ls(Us):(e=Vs("iframe"),t="java"+Ks+":",e.style.display="none",Gs.appendChild(e),e.src=String(t),(t=e.contentWindow.document).open(),t.write(zs("document.F=Object")),t.close(),t.F);for(var e,t,n=Hs.length;n--;)delete Ws[Bs][Hs[n]];return Ws()},a=(i[Qs]=!0,Object.create||function(e,t){var n;return null!==e?(xs[Bs]=Fs(e),n=new xs,xs[Bs]=null,n[Qs]=e):n=Ws(),void 0===t?n:js.f(n,t)}),Kt=ge,ds=a,t=Yt.f,Ys=Kt("unscopables"),Xs=Array.prototype,i=(null==Xs[Ys]&&t(Xs,Ys,{configurable:!0,value:ds(null)}),Me),Js=li.findIndex,Kt=Ps,t="findIndex",Zs=!0,ds=(t in[]&&Array(1)[t](function(){Zs=!1}),i({target:"Array",proto:!0,forced:Zs},{findIndex:function(e){return Js(this,e,1<arguments.length?arguments[1]:void 0)}}),Kt(t),{}),i=!te(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),$s=Ft,ea=le,ta=ye,Kt=i,na=Te("IE_PROTO"),ra=Object,ia=ra.prototype,t=Kt?ra.getPrototypeOf:function(e){e=ta(e);if($s(e,na))return e[na];var t=e.constructor;return ea(t)&&e instanceof t?t.prototype:e instanceof ra?ia:null},i=te,Kt=le,sa=t,aa=Se,oa=ge("iterator"),ua=!1;[].keys&&("next"in(fa=[].keys())?(sa=sa(sa(fa)))!==Object.prototype&&(qs=sa):ua=!0);function ca(e,t,n){(e=e&&!n?e.prototype:e)&&!va(e,_a)&&pa(e,_a,{configurable:!0,value:t})}function la(){return this}function ha(){return this}function da(e,t,n,r,i,s,a){function o(e){if(e===i&&f)return f;if(!Ha&&e in h)return h[e];switch(e){case"keys":case Va:case Ba:return function(){return new n(this,e)}}return function(){return new n(this)}}Ra(n,t,r);var u,c,r=t+" Iterator",l=!1,h=e.prototype,d=h[Ga]||h["@@iterator"]||i&&h[i],f=!Ha&&d||o(i),p="Array"==t&&h.entries||d;if(p&&(p=Da(p.call(new e)))!==Object.prototype&&p.next&&(Da(p)!==ja&&(Ma?Ma(p,ja):Oa(p[Ga])||Pa(p,Ga,ha)),xa(p,r,!0)),qa&&i==Va&&d&&d.name!==Va&&(Fa?La(h,"name",Va):(l=!0,f=function(){return Aa(d,this)})),i)if(u={values:o(Va),keys:s?f:o("keys"),entries:o(Ba)},a)for(c in u)!Ha&&!l&&c in h||Pa(h,c,u[c]);else Na({target:t,proto:!0,forced:Ha||l},u);return h[Ga]!==f&&Pa(h,Ga,f,{name:i}),Ua[t]=f,u}Kt((qs=null==qs||i(function(){var e={};return qs[oa].call(e)!==e})?{}:qs)[oa])||aa(qs,oa,function(){return this});var fa={IteratorPrototype:qs,BUGGY_SAFARI_ITERATORS:ua},pa=Yt.f,va=Ft,_a=ge("toStringTag"),ya=fa.IteratorPrototype,ma=a,ga=ne,Ea=ca,ba=ds,Ia=le,wa=String,Ta=TypeError,Sa=et,Ca=we,ka=function(e){if("object"==typeof e||Ia(e))return e;throw Ta("Can't set "+wa(e)+" as a prototype")},sa=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Sa(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return Ca(e),ka(t),r?n(e,t):e.__proto__=t,e}}():void 0),Na=Me,Aa=Ze,Oa=le,Ra=function(e,t,n,r){t+=" Iterator";return e.prototype=ma(ya,{next:ga(+!r,n)}),Ea(e,t,!1),ba[t]=la,e},Da=t,Ma=sa,xa=ca,La=mt,Pa=Se,Kt=ge,Ua=ds,qa=n.PROPER,Fa=n.CONFIGURABLE,ja=fa.IteratorPrototype,Ha=fa.BUGGY_SAFARI_ITERATORS,Ga=Kt("iterator"),Va="values",Ba="entries",Ka=ce,i=Ps,aa=ds,ua=Jt,t=Yt.f,n=da,fa=e,Qa="Array Iterator",za=ua.set,Wa=ua.getterFor(Qa),Kt=n(Array,"Array",function(e,t){za(this,{type:Qa,target:Ka(e),index:0,kind:t})},function(){var e=Wa(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),ua=aa.Arguments=aa.Array;if(i("keys"),i("values"),i("entries"),fa&&"values"!==ua.name)try{t(ua,"name",{value:"values"})}catch(e){}var n={exports:{}},aa={},Ya=ke,Xa=Ae,Ja=Qi,Za=Array,$a=Math.max,eo=oe,to=ce,no=jn.f,ro=function(e,t,n){for(var r=Xa(e),i=Ya(t,r),s=Ya(void 0===n?r:n,r),a=Za($a(s-i,0)),o=0;i<s;i++,o++)Ja(a,o,e[i]);return a.length=o,a},io="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];aa.f=function(e){if(!io||"Window"!=eo(e))return no(to(e));try{return no(e)}catch(e){return ro(io)}};function so(e){vo(e,bo,{value:{objectID:"O"+Io++,weakData:{}}})}var i=te(function(){var e;"function"==typeof ArrayBuffer&&(e=new ArrayBuffer(8),Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8}))}),fa=te,ao=he,oo=oe,uo=i,co=Object.isExtensible,t=fa(function(){co(1)})||uo?function(e){return!!ao(e)&&((!uo||"ArrayBuffer"!=oo(e))&&(!co||co(e)))}:co,ua=!te(function(){return Object.isExtensible(Object.preventExtensions({}))}),lo=Me,ho=et,i=Gn,fo=he,po=Ft,vo=Yt.f,_o=jn,yo=aa,mo=t,go=ua,Eo=!1,bo=me("meta"),Io=0,wo=n.exports={enable:function(){wo.enable=function(){},Eo=!0;var i=_o.f,s=ho([].splice),e={};e[bo]=1,i(e).length&&(_o.f=function(e){for(var t=i(e),n=0,r=t.length;n<r;n++)if(t[n]===bo){s(t,n,1);break}return t},lo({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:yo.f}))},fastKey:function(e,t){if(!fo(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!po(e,bo)){if(!mo(e))return"F";if(!t)return"E";so(e)}return e[bo].objectID},getWeakData:function(e,t){if(!po(e,bo)){if(!mo(e))return!0;if(!t)return!1;so(e)}return e[bo].weakData},onFreeze:function(e){return go&&Eo&&mo(e)&&!po(e,bo)&&so(e),e}};i[bo]=!0;function To(e){if(null!=e)return Do(e,xo)||Do(e,"@@iterator")||Mo[Ro(e)]}function So(e,t){this.stopped=e,this.result=t}function Co(e,t,n){function r(e){return s&&$o(s,"normal",e),new So(!0,e)}function i(e){return d?(Qo(e),v?_(e[0],e[1],r):_(e[0],e[1])):v?_(e,r):_(e)}var s,a,o,u,c,l,h=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),v=!(!n||!n.INTERRUPTED),_=Bo(t,h);if(f)s=e.iterator;else if(p)s=e;else{if(!(n=Zo(e)))throw eu(zo(e)+" is not iterable");if(Wo(n)){for(a=0,o=Yo(e);a<o;a++)if((u=i(e[a]))&&Xo(tu,u))return u;return new So(!1)}s=Jo(e,n)}for(c=(f?e:s).next;!(l=Ko(c,s)).done;){try{u=i(l.value)}catch(e){$o(s,"throw",e)}if("object"==typeof u&&u&&Xo(tu,u))return u}return new So(!1)}function ko(e,t){if(nu(t,e))return e;throw ru("Incorrect invocation")}var No=ds,Ao=ge("iterator"),Oo=Array.prototype,Ro=ri,Do=ve,Mo=ds,xo=ge("iterator"),Lo=Ze,Po=pe,Uo=we,qo=fe,Fo=To,jo=TypeError,Ho=Ze,Go=we,Vo=ve,Bo=xe,Ko=Ze,Qo=we,zo=fe,Wo=function(e){return void 0!==e&&(No.Array===e||Oo[Ao]===e)},Yo=Ae,Xo=nt,Jo=function(e,t){t=arguments.length<2?Fo(e):t;if(Po(t))return Uo(Lo(t,e));throw jo(qo(e)+" is not iterable")},Zo=To,$o=function(e,t,n){var r,i;Go(e);try{if(!(r=Vo(e,"return"))){if("throw"===t)throw n;return n}r=Ho(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return Go(r),n},eu=TypeError,tu=So.prototype,nu=nt,ru=TypeError,iu=ge("iterator"),su=!1;try{var au=0,ou={next:function(){return{done:!!au++}},return:function(){su=!0}};ou[iu]=function(){return this},Array.from(ou,function(){throw 2})}catch(e){}function uu(e,t){if(!t&&!su)return!1;var n=!1;try{var r={};r[iu]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}function cu(e,t,n){return _u&&pu(t=t.constructor)&&t!==n&&vu(t=t.prototype)&&t!==n.prototype&&_u(e,t),e}function lu(e){var e=Du(e),t=Mu.f;xu&&e&&!e[Lu]&&t(e,Lu,{configurable:!0,get:function(){return this}})}function hu(i){return function(e,t){var n,e=Yu(Xu(e)),t=Wu(t),r=e.length;return t<0||r<=t?i?"":void 0:(n=Zu(e,t))<55296||56319<n||t+1===r||(r=Zu(e,t+1))<56320||57343<r?i?Ju(e,t):n:i?$u(e,t,t+2):r-56320+(n-55296<<10)+65536}}function du(t,e){if(t){if(t[cc]!==hc)try{uc(t,cc,hc)}catch(e){t[cc]=hc}if(t[lc]||uc(t,lc,e),ac[e])for(var n in oc)if(t[n]!==oc[n])try{uc(t,n,oc[n])}catch(e){t[n]=oc[n]}}}var fu,pu=le,vu=he,_u=sa,yu=Me,mu=K,gu=et,Eu=It,bu=Se,Iu=n.exports,wu=Co,Tu=ko,Su=le,Cu=he,ku=te,Nu=uu,Au=ca,Ou=cu,Ru=Se,Du=de,Mu=Yt,xu=e,Lu=ge("species"),Pu=Yt.f,Uu=a,qu=function(e,t,n){for(var r in t)Ru(e,r,t[r],n);return e},Fu=xe,ju=ko,Hu=Co,Gu=da,Vu=lu,Bu=e,Ku=n.exports.fastKey,Qu=Jt.set,zu=Jt.getterFor,fa=(function(e,t,n){function r(e){var n=gu(f[e]);bu(f,e,"add"==e?function(e){return n(this,0===e?0:e),this}:"delete"==e?function(e){return!(l&&!Cu(e))&&n(this,0===e?0:e)}:"get"==e?function(e){return l&&!Cu(e)?void 0:n(this,0===e?0:e)}:"has"==e?function(e){return!(l&&!Cu(e))&&n(this,0===e?0:e)}:function(e,t){return n(this,0===e?0:e,t),this})}var i,s,a,o,u,c=-1!==e.indexOf("Map"),l=-1!==e.indexOf("Weak"),h=c?"set":"add",d=mu[e],f=d&&d.prototype,p=d,v={};return Eu(e,!Su(d)||!(l||f.forEach&&!ku(function(){(new d).entries().next()})))?(p=n.getConstructor(t,e,c,h),Iu.enable()):Eu(e,!0)&&(s=(i=new p)[h](l?{}:-0,1)!=i,a=ku(function(){i.has(1)}),o=Nu(function(e){new d(e)}),u=!l&&ku(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),o||(((p=t(function(e,t){Tu(e,f);e=Ou(new d,e,p);return null!=t&&wu(t,e[h],{that:e,AS_ENTRIES:c}),e})).prototype=f).constructor=p),(a||u)&&(r("delete"),r("has"),c&&r("get")),(u||s)&&r(h),l&&f.clear&&delete f.clear),v[e]=p,yu({global:!0,constructor:!0,forced:p!=d},v),Au(p,e),l||n.setStrong(p,e,c),p}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,n,r,i){function s(e,t,n){var r,i=u(e),s=a(e,t);return s?s.value=n:(i.last=s={index:r=Ku(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=s),t&&(t.next=s),Bu?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e}function a(e,t){var n,e=u(e),r=Ku(t);if("F"!==r)return e.index[r];for(n=e.first;n;n=n.next)if(n.key==t)return n}var e=e(function(e,t){ju(e,o),Qu(e,{type:n,index:Uu(null),first:void 0,last:void 0,size:0}),Bu||(e.size=0),null!=t&&Hu(t,e[i],{that:e,AS_ENTRIES:r})}),o=e.prototype,u=zu(n);return qu(o,{clear:function(){for(var e=u(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Bu?e.size=0:this.size=0},delete:function(e){var t,n,r=u(this),e=a(this,e);return e&&(t=e.next,n=e.previous,delete r.index[e.index],e.removed=!0,n&&(n.next=t),t&&(t.previous=n),r.first==e&&(r.first=t),r.last==e&&(r.last=n),Bu?r.size--:this.size--),!!e},forEach:function(e){for(var t,n=u(this),r=Fu(e,1<arguments.length?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),qu(o,r?{get:function(e){e=a(this,e);return e&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Bu&&Pu(o,"size",{get:function(){return u(this).size}}),e},setStrong:function(e,t,n){var r=t+" Iterator",i=zu(t),s=zu(r);Gu(e,t,function(e,t){Qu(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),Vu(t)}}),et),Wu=Ce,Yu=zi,Xu=ue,Ju=fa("".charAt),Zu=fa("".charCodeAt),$u=fa("".slice),Gn={codeAt:hu(!1),charAt:hu(!0)},ec=Gn.charAt,tc=zi,aa=Jt,t=da,nc="String Iterator",rc=aa.set,ic=aa.getterFor(nc),ua=(t(String,"String",function(e){rc(this,{type:nc,string:tc(e),index:0})},function(){var e=ic(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=ec(t,n),e.index+=t.length,{value:t,done:!1})}),{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),i=Ie("span").classList,ri=i&&i.constructor&&i.constructor.prototype,ds=ri===Object.prototype?void 0:ri,sc=K,ac=ua,ou=ds,oc=Kt,uc=mt,n=ge,cc=n("iterator"),lc=n("toStringTag"),hc=oc.values;for(fu in ac)du(sc[fu]&&sc[fu].prototype,fu);du(ou,"DOMTokenList");function dc(e,t){var n=[][e];return!!n&&Bl(function(){n.call(null,t||function(){return 1},1)})}function fc(t){if(t&&t.forEach!==Wl)try{Yl(t,"forEach",Wl)}catch(e){t.forEach=Wl}}var pc,vc,_c=e,fa=et,yc=Ze,aa=te,mc=s,gc=Jn,Ec=$e,bc=ye,Ic=rt,wc=Object.assign,Tc=Object.defineProperty,Sc=fa([].concat),t=!wc||aa(function(){if(_c&&1!==wc({b:1},wc(Tc({},"a",{enumerable:!0,get:function(){Tc(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=wc({},e)[n]||mc(wc({},t)).join("")!=r})?function(e,t){for(var n=bc(e),r=arguments.length,i=1,s=gc.f,a=Ec.f;i<r;)for(var o,u=Ic(arguments[i++]),c=s?Sc(mc(u),s(u)):mc(u),l=c.length,h=0;h<l;)o=c[h++],_c&&!yc(a,u,o)||(n[o]=u[o]);return n}:wc,i=(Me({target:"Object",stat:!0,arity:2,forced:Object.assign!==t},{assign:t}),Me),Cc=r.includes,ri=Ps,kc=(i({target:"Array",proto:!0,forced:te(function(){return!Array(1).includes()})},{includes:function(e){return Cc(this,e,1<arguments.length?arguments[1]:void 0)}}),ri("includes"),he),Nc=oe,Ac=ge("match"),Oc=function(e){var t;return kc(e)&&(void 0!==(t=e[Ac])?!!t:"RegExp"==Nc(e))},Rc=TypeError,Dc=ge("match"),Kt=Me,Mc=function(e){if(Oc(e))throw Rc("The method doesn't accept regular expressions");return e},xc=ue,Lc=zi,n=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[Dc]=!1,"/./"[t](n)}catch(e){}}return!1},Pc=et("".indexOf),Uc=(Kt({target:"String",proto:!0,forced:!n("includes")},{includes:function(e){return!!~Pc(Lc(xc(this)),Lc(Mc(e)),1<arguments.length?arguments[1]:void 0)}}),D.LiveEventRole=void 0,(ou=D.LiveEventRole||(D.LiveEventRole={})).HOST="host",ou.PARTICIPANT="participant",D.LiveEventState=void 0,(s=D.LiveEventState||(D.LiveEventState={})).CREATED="created",s.READY="ready",s.ONGOING="ongoing",s.PAUSED="paused",s.ENDED="ended",D.HostState=void 0,(Jn=D.HostState||(D.HostState={})).ENTERED="entered",Jn.CONNECTED="connected",Jn.DISCONNECTED="disconnected",Jn.EXITED="exited",D.ParticipantState=void 0,($e=D.ParticipantState||(D.ParticipantState={})).ENTERED="entered",$e.EXITED="exited",function(){g(s,Pi);var i=b(s);function s(e,t,n){var r;return _(this,s),(r=i.call(this)).appId=e,r.userId=t,r.accessToken=n,r}return y(s,[{key:"getAuth",value:function(){return!1}},{key:"getData",value:function(){return{app_id:this.appId,user_id:this.userId,access_token:this.accessToken}}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/login")}},{key:"getMethod",value:function(){return"POST"}}]),s}()),qc=((fa=pc=pc||{}).POST="POST",fa.GET="GET",fa.DELETE="DELETE",fa.OPTION="OPTION",fa.PUT="PUT",function(){g(o,Ui);var a=b(o);function o(e,t,n,r,i){var s;return _(this,o),m(E(s=a.call(this)),"type",u.CREATE),s.hostType=e,s.hostIds=Array.isArray(t)?t:[t],s.title=null===n?"":n,s.coverUrl=null===r?"":r,s.coverFile=null===i?"":i,s}return y(o,[{key:"getData",value:function(){function e(e,t,n,r){void 0!==n&&i.set(t,n)}var i=new FormData;return e(0,"host_type",this.hostType),e(0,"user_ids_for_host",String(this.hostIds)),e(0,"title",this.title),e(0,"cover_url",this.coverUrl),e(0,"cover_file",this.coverFile),i}},{key:"getSubPath",value:function(){return"/live-events"}},{key:"getMethod",value:function(){return pc.POST}}]),o}()),Fc=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEvent:ji(e.live_event)}}}]),t}(),jc=function(){g(r,Ui);var n=b(r);function r(e){var t;return _(this,r),m(E(t=n.call(this)),"type",u.GET),t.liveEventId=e,t}return y(r,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return pc.GET}}]),r}(),Hc=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEvent:ji(e.live_event)}}}]),t}(),Gc=function(){g(i,Ui);var r=b(i);function i(e,t){var n;return _(this,i),m(E(n=r.call(this)),"type",u.ENTER_HOST),m(E(n),"mediaOption",{turnAudioOn:!0,turnVideoOn:!0}),n.liveEventId=e,n.mediaOption=t,n}return y(i,[{key:"getData",value:function(){return{is_audio_on:this.mediaOption.turnAudioOn,is_video_on:this.mediaOption.turnVideoOn}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts")}},{key:"getMethod",value:function(){return pc.POST}}]),i}(),Vc=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{host:Hi(e.host)}}}]),t}(),Bc=function(){g(r,Ui);var n=b(r);function r(e){var t;return _(this,r),m(E(t=n.call(this)),"type",u.READY),t.liveEventId=e,t}return y(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/ready")}},{key:"getMethod",value:function(){return pc.POST}}]),r}(),Kc=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEvent:ji(e.live_event)}}}]),t}(),Qc=function(){g(r,Ui);var n=b(r);function r(e){var t;return _(this,r),m(E(t=n.call(this)),"type",u.START),t.liveEventId=e,t}return y(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/start")}},{key:"getMethod",value:function(){return pc.POST}}]),r}(),zc=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEvent:ji(e.live_event)}}}]),t}(),Wc=function(){g(i,Ui);var r=b(i);function i(e,t){var n;return _(this,i),m(E(n=r.call(this)),"type",u.EXIT_HOST),n.liveEventId=e,n.hostId=t,n}return y(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId)}},{key:"getMethod",value:function(){return pc.DELETE}}]),i}(),Yc=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{host:Hi(e.host)}}}]),t}(),Xc=function(){g(r,Ui);var n=b(r);function r(e){var t;return _(this,r),m(E(t=n.call(this)),"type",u.DELETE),t.liveEventId=e,t}return y(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return pc.DELETE}}]),r}(),Jc=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEvent:ji(e.live_event)}}}]),t}(),Zc=function(){g(r,Ui);var n=b(r);function r(e){var t;return _(this,r),m(E(t=n.call(this)),"type",u.ENTER),t.liveEventId=e,t}return y(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants")}},{key:"getMethod",value:function(){return pc.POST}}]),r}(),$c=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{participant:Vi(e.participant)}}}]),t}(),el=function(){g(i,Ui);var r=b(i);function i(e,t){var n;return _(this,i),m(E(n=r.call(this)),"type",u.EXIT),n.liveEventId=e,n.participantId=t,n}return y(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId)}},{key:"getMethod",value:function(){return pc.DELETE}}]),i}(),tl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{participant:Vi(e.participant)}}}]),t}(),nl=function(){g(s,Ui);var i=b(s);function s(e,t,n){var r;return _(this,s),m(E(r=i.call(this)),"type",u.CONNECTED),r.liveEventId=e,r.participantId=t,r.endpointId=n,r}return y(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId,"/connected")}},{key:"getMethod",value:function(){return pc.POST}}]),s}(),rl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{endpoint:Gi(e.rtcstream)}}}]),t}(),il=function(){g(s,Ui);var i=b(s);function s(e,t,n){var r;return _(this,s),m(E(r=i.call(this)),"type",u.HOST_CONNECTED),r.liveEventId=e,r.hostId=t,r.endpointId=n,r}return y(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams/").concat(this.endpointId,"/connected")}},{key:"getMethod",value:function(){return pc.POST}}]),s}(),sl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{endpoint:Gi(e.rtcstream)}}}]),t}(),al=function(){g(s,Ui);var i=b(s);function s(e,t,n){var r;return _(this,s),m(E(r=i.call(this)),"type",u.DELETE_STREAM),r.liveEventId=e,r.participantId=t,r.endpointId=n,r}return y(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId)}},{key:"getMethod",value:function(){return pc.DELETE}}]),s}(),ol=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{}}}]),t}(),ul=function(){g(s,Ui);var i=b(s);function s(e,t,n){var r;return _(this,s),m(E(r=i.call(this)),"type",u.HOST_DELETE_STREAM),r.liveEventId=e,r.hostId=t,r.endpointId=n,r}return y(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams/").concat(this.endpointId)}},{key:"getMethod",value:function(){return pc.DELETE}}]),s}(),cl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{}}}]),t}(),ll=function(){g(a,Ui);var s=b(a);function a(e,t,n,r){var i;return _(this,a),m(E(i=s.call(this)),"type",u.ATTACH),i.liveEventId=e,i.participantId=t,i.endpointId=n,i.attachTo=r,i}return y(a,[{key:"getData",value:function(){return{attach_to:this.attachTo}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId,"/attach")}},{key:"getMethod",value:function(){return pc.POST}}]),a}(),hl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{endpoint:Gi(e.rtcstream)}}}]),t}(),dl=function(){g(r,Li);var n=b(r);function r(e){var t;return _(this,r),(t=n.call(this)).type=e.type,t.version=e.version,t.messageId=e.message_id,t.payload=t.parseData(e.payload),t}return y(r)}(),fl=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:ji(e.live_event)}}}]),t}(),pl=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:ji(e.live_event)}}}]),t}(),vl=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:ji(e.live_event)}}}]),t}(),_l=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Hi(e.host)}}}]),t}(),yl=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Hi(e.host)}}}]),t}(),ml=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Hi(e.host)}}}]),t}(),gl=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Hi(e.host)}}}]),t}(),El=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Hi(e.host)}}}]),t}(),bl=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,participant:Vi(e.participant),participantCount:e.particpant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}]),t}(),Il=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,participant:Vi(e.participant),participantCount:e.particpant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}]),t}(),wl=function(){g(o,Ui);var a=b(o);function o(e,t,n,r,i){var s;return _(this,o),m(E(s=a.call(this)),"type",u.CREATE_STREAM),s.liveEventId=e,s.participantId=t,s.sdp=n,s.audioAttr=r,s.videoAttr=i,s}return y(o,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams")}},{key:"getMethod",value:function(){return pc.POST}}]),o}(),Tl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{sdp:e.sdp,endpoint:Gi(e.rtcstream)}}}]),t}(),Sl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{hosts:e.hosts.map(Hi)}}}]),t}(),Cl=function(){g(i,Ui);var r=b(i);function i(e,t){var n;return _(this,i),m(E(n=r.call(this)),"type",u.HOST_ALIVE),n.liveEventId=e,n.hostId=t,n}return y(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/alive")}},{key:"getMethod",value:function(){return pc.POST}}]),i}(),kl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Nl=function(){g(o,Ui);var a=b(o);function o(e,t,n,r,i){var s;return _(this,o),m(E(s=a.call(this)),"type",u.HOST_CREATE_STREAM),s.liveEventId=e,s.hostId=t,s.sdp=n,s.audioAttr=r,s.videoAttr=i,s}return y(o,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams")}},{key:"getMethod",value:function(){return pc.POST}}]),o}(),Al=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{sdp:e.sdp,endpoint:Gi(e.rtcstream)}}}]),t}(),Ol=function(){g(i,Ui);var r=b(i);function i(e,t){var n;return _(this,i),m(E(n=r.call(this)),"type",u.ALIVE),n.liveEventId=e,n.participantId=t,n}return y(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/alive")}},{key:"getMethod",value:function(){return pc.POST}}]),i}(),Rl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Dl=function(){g(t,Fi);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{participant:Vi(e.participant)}}}]),t}(),Ml=function(){g(s,Ui);var i=b(s);function s(e,t,n){var r;return _(this,s),m(E(r=i.call(this)),"type",u.AUDIO),r.liveEventId=e,r.hostId=t,r.on=n,r}return y(s,[{key:"getData",value:function(){return{on:this.on}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/audio")}},{key:"getMethod",value:function(){return pc.POST}}]),s}(),xl=function(){g(s,Ui);var i=b(s);function s(e,t,n){var r;return _(this,s),m(E(r=i.call(this)),"type",u.VIDEO),r.liveEventId=e,r.hostId=t,r.on=n,r}return y(s,[{key:"getData",value:function(){return{on:this.on}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/video")}},{key:"getMethod",value:function(){return pc.POST}}]),s}(),Ll=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Hi(e.host)}}}]),t}(),Pl=function(){g(o,Ui);var a=b(o);function o(e,t,n,r,i){var s;return _(this,o),m(E(s=a.call(this)),"type",u.UPDATE),s.liveEventId=e,s.hostIds=null===t?"":Array.isArray(t)?t:[t],s.title=null===n?"":n,s.coverUrl=null===r?"":r,s.coverFile=null===i?"":i,s}return y(o,[{key:"getData",value:function(){function e(e,t,n,r){void 0!==n&&i.set(t,n)}var i=new FormData;return e(0,"user_ids_for_host",String(this.hostIds)),e(0,"title",this.title),e(0,"cover_url",this.coverUrl),e(0,"cover_file",this.coverFile),i}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return pc.PUT}}]),o}(),Ul=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:ji(e.live_event)}}}]),t}(),ql=function(){g(r,Ui);var n=b(r);function r(e){var t;return _(this,r),m(E(t=n.call(this)),"type",u.CUSTOM_ITEMS_GET),t.liveEventId=e,t}return y(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return pc.GET}}]),r}(),Fl=function(){g(i,Ui);var r=b(i);function i(e,t){var n;return _(this,i),m(E(n=r.call(this)),"type",u.CUSTOM_ITEMS_UPDATE),n.liveEventId=e,n.customItems=t,n}return y(i,[{key:"getData",value:function(){return this.customItems}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return pc.PUT}}]),i}(),jl=function(){g(i,Ui);var r=b(i);function i(e,t){var n;return _(this,i),m(E(n=r.call(this)),"type",u.CUSTOM_ITEMS_DELETE),n.liveEventId=e,n.keys=t,n}return y(i,[{key:"getData",value:function(){return this.keys}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return pc.DELETE}}]),i}(),Hl=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,updatedAt:e.updated_at,customItems:e.custom_items,updatedKeys:e.updated_keys}}}]),t}(),Gl=function(){g(t,dl);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,deletedAt:e.deleted_at,customItems:e.custom_items,deletedKeys:e.deleted_keys}}}]),t}(),Vl=function(){function e(){_(this,e)}return y(e,null,[{key:"createAuth",value:function(e,t,n){return new Uc(e,t,n)}},{key:"createLiveEvent",value:function(e,t,n,r,i){return new qc(e,t,n,r,i)}},{key:"updateLiveEvent",value:function(e,t,n,r,i){return new Pl(e,t,n,r,i)}},{key:"createGetLiveEvent",value:function(e){return new jc(e)}},{key:"createEnterHost",value:function(e,t){return new Gc(e,t)}},{key:"createReady",value:function(e){return new Bc(e)}},{key:"createStart",value:function(e){return new Qc(e)}},{key:"createExitHost",value:function(e,t){return new Wc(e,t)}},{key:"createEndLiveEvent",value:function(e){return new Xc(e)}},{key:"createEnter",value:function(e){return new Zc(e)}},{key:"createExit",value:function(e,t){return new el(e,t)}},{key:"createConnected",value:function(e,t,n){return new nl(e,t,n)}},{key:"createHostConnected",value:function(e,t,n){return new il(e,t,n)}},{key:"createStream",value:function(e,t,n,r,i){return new wl(e,t,n,r,i)}},{key:"createHostCreateStream",value:function(e,t,n,r,i){return new Nl(e,t,n,r,i)}},{key:"createDeleteStream",value:function(e,t,n){return new al(e,t,n)}},{key:"createHostDeleteStream",value:function(e,t,n){return new ul(e,t,n)}},{key:"createAttach",value:function(e,t,n,r){return new ll(e,t,n,r)}},{key:"createAudio",value:function(e,t,n){return new Ml(e,t,n)}},{key:"createVideo",value:function(e,t,n){return new xl(e,t,n)}},{key:"createAlive",value:function(e,t){return new Ol(e,t)}},{key:"createHostAlive",value:function(e,t){return new Cl(e,t)}},{key:"createGetCustomItems",value:function(e){return new ql(e)}},{key:"createUpdateCustomItems",value:function(e,t){return new Fl(e,t)}},{key:"createDeleteCustomItems",value:function(e,t){return new jl(e,t)}},{key:"parseResponse",value:function(e,t){try{switch(e.type){case u.CREATE:return new Fc(t);case u.GET:return new Hc(t);case u.DELETE:return new Jc(t);case u.QUERY:return new Ns(t);case u.READY:return new Kc(t);case u.START:return new zc(t);case u.ENTER_HOST:return new Vc(t);case u.GET_HOSTS:return new Sl(t);case u.EXIT_HOST:return new Yc(t);case u.HOST_ALIVE:return new kl(t);case u.AUDIO:return new gl(t);case u.VIDEO:return new El(t);case u.HOST_CREATE_STREAM:return new Al(t);case u.HOST_DELETE_STREAM:return new cl(t);case u.HOST_CONNECTED:return new sl(t);case u.ENTER:return new $c(t);case u.EXIT:return new tl(t);case u.ALIVE:return new Rl(t);case u.GET_PARTICIPANTS:return new Dl(t);case u.CREATE_STREAM:return new Tl(t);case u.DELETE_STREAM:return new ol(t);case u.CONNECTED:return new rl(t);case u.ATTACH:return new hl(t);case u.CUSTOM_ITEMS_UPDATE:return new Hl(t);case u.CUSTOM_ITEMS_DELETE:return new Gl(t)}}catch(e){return}}},{key:"parse",value:function(e){if("live"===e.call_type)try{switch(e.type){case u.LIVE_EVENT_READY:return new fl(e);case u.LIVE_EVENT_STARTED:return new pl(e);case u.LIVE_EVENT_ENDED:return new vl(e);case u.LIVE_EVENT_UPDATED:return new Ul(e);case u.HOST_ENTERED:return new _l(e);case u.HOST_EXITED:return new yl(e);case u.HOST_CONNECTED:return new ml(e);case u.HOST_DISCONNECTED:return new Ll(e);case u.HOST_AUDIO_STATUS_CHANGED:return new gl(e);case u.HOST_VIDEO_STATUS_CHANGED:return new El(e);case u.PARTICIPANT_ENTERED:return new bl(e);case u.PARTICIPANT_EXITED:return new Il(e)}}catch(e){return}}}]),e}(),Bl=te,Kl=li.forEach,Ql=K,zl=ua,aa=ds,Wl=dc("forEach")?[].forEach:function(e){return Kl(this,e,1<arguments.length?arguments[1]:void 0)},Yl=mt;for(vc in zl)zl[vc]&&fc(Ql[vc]&&Ql[vc].prototype);fc(aa);var Xl=fe,Jl=TypeError,t=Me,Zl=ye,$l=ke,eh=Ce,th=Ae,nh=Ki,rh=qe,ih=Qi,sh=function(e,t){if(!delete e[t])throw Jl("Cannot delete property "+Xl(t)+" of "+Xl(e))},i=je("splice"),ah=Math.max,oh=Math.min;t({target:"Array",proto:!0,forced:!i},{splice:function(e,t){var n,r,i,s,a,o,u=Zl(this),c=th(u),l=$l(e,c),e=arguments.length;for(0===e?n=r=0:r=1===e?(n=0,c-l):(n=e-2,oh(ah(eh(t),0),c-l)),nh(c+n-r),i=rh(u,r),s=0;s<r;s++)(a=l+s)in u&&ih(i,s,u[a]);if(n<(i.length=r)){for(s=l;s<c-r;s++)o=s+n,(a=s+r)in u?u[o]=u[a]:sh(u,o);for(s=c;c-r+n<s;s--)sh(u,s-1)}else if(r<n)for(s=c-r;l<s;s--)o=s+n-1,(a=s+r-1)in u?u[o]=u[a]:sh(u,o);for(s=0;s<n;s++)u[s+l]=arguments[s+2];return u.length=c-r+n,i}});var uh,ri=et([].slice),Kt=Me,ch=Wn,lh=ci,hh=he,dh=ke,fh=Ae,ph=ce,vh=Qi,n=ge,_h=ri,s=je("slice"),yh=n("species"),mh=Array,gh=Math.max,Eh=(Kt({target:"Array",proto:!0,forced:!s},{slice:function(e,t){var n,r,i,s=ph(this),a=fh(s),o=dh(e,a),u=dh(void 0===t?a:t,a);if(ch(s)&&(n=s.constructor,(n=lh(n)&&(n===mh||ch(n.prototype))||hh(n)&&null===(n=n[yh])?void 0:n)===mh||void 0===n))return _h(s,o,u);for(r=new(void 0===n?mh:n)(gh(u-o,0)),i=0;o<u;o++,i++)o in s&&vh(r,i,s[o]);return r.length=i,r}}),function(){function e(){_(this,e),m(this,"_listeners",{}),m(this,"on",this.addEventListener),m(this,"off",this.removeEventListener)}return y(e,[{key:"addEventListener",value:function(e,t){var n=this;return e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t),function(){return n.removeEventListener(e,t)}}},{key:"once",value:function(t,n){var r=this;return this.on(t,function e(){n.apply(void 0,arguments),r.removeEventListener(t,e)})}},{key:"removeEventListener",value:function(e,t){if(e in this._listeners)for(var n=this._listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"removeAllEventListeners",value:function(){this._listeners={}}},{key:"_dispatchEvent",value:function(e){if(e in this._listeners){for(var t=this._listeners[e].slice(),n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var s,a=0,o=t.length;a<o;a++)(s=t[a]).call.apply(s,[this].concat(r))}}}]),e}()),Jn=Me,$e=et,bh=r.indexOf,ua=dc,Ih=$e([].indexOf),wh=!!Ih&&1/Ih([1],1,-0)<0,ds=ua("indexOf");Jn({target:"Array",proto:!0,forced:wh||!ds},{indexOf:function(e){var t=1<arguments.length?arguments[1]:void 0;return wh?Ih(this,e,t)||0:bh(this,e,t)}}),(aa=uh=uh||{}).VERBOSE="VERBOSE",aa.DEBUG="DEBUG",aa.INFO="INFO",aa.WARNING="WARNING",aa.ERROR="ERROR",aa.NONE="NONE";function Th(n,e,t,r){var a,i=Jh(n),o=!Xh(function(){var e={};return e[i]=function(){return 7},7!=""[n](e)}),s=o&&!Xh(function(){var e=!1,t=/a/;return"split"===n&&((t={constructor:{}}).constructor[$h]=function(){return t},t.flags="",t[i]=/./[i]),t.exec=function(){return e=!0,null},t[i](""),!e});o&&s&&!t||(a=zh(/./[i]),s=e(i,""[n],function(e,t,n,r,i){var e=zh(e),s=t.exec;return s===Yh||s===ed.exec?o&&!i?{done:!0,value:a(t,n,r)}:{done:!0,value:e(n,t,r)}:{done:!1}}),Wh(String.prototype,n,s[0]),Wh(ed,i,s[1])),r&&Zh(ed[i],"sham",!0)}function Sh(e,t,n){return t+(n?td(e,t).length:1)}function Ch(e,t){var n=e.exec;if(hd(n))return null!==(n=cd(n,e,t))&&ld(n),n;if("RegExp"===dd(e))return cd(fd,e,t);throw pd("RegExp#exec called on incompatible receiver")}var I=new(function(){function e(){_(this,e),this._listeners=[]}return y(e,[{key:"verbose",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[uh.VERBOSE].concat(t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[uh.DEBUG].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[uh.INFO].concat(t))}},{key:"warning",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[uh.WARNING].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[uh.ERROR].concat(t))}},{key:"_log",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,s=G(this._listeners);try{for(s.s();!(i=s.n()).done;){var a=i.value;a._permit.apply(a,[e].concat(n))}}catch(e){s.e(e)}finally{s.f()}}},{key:"addListener",value:function(e){this._listeners.push(e)}},{key:"removeListener",value:function(e){e=this._listeners.indexOf(e);-1!==e&&this._listeners.splice(e,1)}},{key:"removeAllListener",value:function(){this._listeners=[]}}]),e}()),t=te,kh=K.RegExp,i=t(function(){var e=kh("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),Wn=i||t(function(){return!kh("a","y").sticky}),n={BROKEN_CARET:i||t(function(){var e=kh("^r","gy");return e.lastIndex=2,null!=e.exec("str")}),MISSED_STICKY:Wn,UNSUPPORTED_Y:i},Kt=te,Nh=K.RegExp,s=Kt(function(){var e=Nh(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}),r=te,Ah=K.RegExp,$e=r(function(){var e=Ah("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}),Oh=Ze,ua=et,Rh=zi,Dh=Wi,Jn=n,ds=Et.exports,Mh=a,xh=Jt.get,aa=s,t=$e,Lh=ds("native-string-replace",String.prototype.replace),Ph=RegExp.prototype.exec,Uh=Ph,qh=ua("".charAt),Fh=ua("".indexOf),jh=ua("".replace),Hh=ua("".slice),Gh=(Wn=/b*/g,Oh(Ph,i=/a/,"a"),Oh(Ph,Wn,"a"),0!==i.lastIndex||0!==Wn.lastIndex),Vh=Jn.BROKEN_CARET,Bh=void 0!==/()??/.exec("")[1],Kt=Uh=Gh||Bh||Vh||aa||t?function(e){var t,n,r,i,s,a,o=this,u=xh(o),e=Rh(e),c=u.raw;if(c)return c.lastIndex=o.lastIndex,h=Oh(Uh,c,e),o.lastIndex=c.lastIndex,h;var l=u.groups,c=Vh&&o.sticky,h=Oh(Dh,o),u=o.source,d=0,f=e;if(c&&(h=jh(h,"y",""),-1===Fh(h,"g")&&(h+="g"),f=Hh(e,o.lastIndex),0<o.lastIndex&&(!o.multiline||o.multiline&&"\n"!==qh(e,o.lastIndex-1))&&(u="(?: "+u+")",f=" "+f,d++),t=new RegExp("^(?:"+u+")",h)),Bh&&(t=new RegExp("^"+u+"$(?!\\s)",h)),Gh&&(n=o.lastIndex),r=Oh(Ph,c?t:o,f),c?r?(r.input=Hh(r.input,d),r[0]=Hh(r[0],d),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:Gh&&r&&(o.lastIndex=o.global?r.index+r[0].length:n),Bh&&r&&1<r.length&&Oh(Lh,r[0],t,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r&&l)for(r.groups=s=Mh(null),i=0;i<l.length;i++)s[(a=l[i])[0]]=r[a[1]];return r}:Uh,r=(Me({target:"RegExp",proto:!0,forced:/./.exec!==Kt},{exec:Kt}),Xe),n=Function.prototype,Kh=n.apply,Qh=n.call,Et="object"==typeof Reflect&&Reflect.apply||(r?Qh.bind(Kh):function(){return Qh.apply(Kh,arguments)}),zh=et,Wh=Se,Yh=Kt,Xh=te,Jh=ge,Zh=mt,$h=Jh("species"),ed=RegExp.prototype,td=Gn.charAt,a=et,nd=ye,rd=Math.floor,id=a("".charAt),sd=a("".replace),ad=a("".slice),od=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,ud=/\$([$&'`]|\d{1,2})/g,cd=Ze,ld=we,hd=le,dd=oe,fd=Kt,pd=TypeError,vd=Et,_d=Ze,s=et,$e=Th,ds=te,yd=we,md=le,gd=Ce,Ed=Ne,bd=zi,Id=ue,wd=Sh,Td=ve,Sd=function(s,a,o,u,c,e){var l=o+s.length,h=u.length,t=ud;return void 0!==c&&(c=nd(c),t=od),sd(e,t,function(e,t){var n;switch(id(t,0)){case"$":return"$";case"&":return s;case"`":return ad(a,0,o);case"'":return ad(a,l);case"<":n=c[ad(t,1,-1)];break;default:var r,i=+t;if(0==i)return e;if(h<i)return 0!==(r=rd(i/10))&&r<=h?void 0===u[r-1]?id(t,1):u[r-1]+id(t,1):e;n=u[i-1]}return void 0===n?"":n})},Cd=Ch,kd=ge("replace"),Nd=Math.max,Ad=Math.min,Od=s([].concat),Rd=s([].push),Dd=s("".indexOf),Md=s("".slice),ua="$0"==="a".replace(/./,"$0"),xd=!!/./[kd]&&""===/./[kd]("a","$0");$e("replace",function(e,g,E){var b=xd?"$":"$0";return[function(e,t){var n=Id(this),r=null==e?void 0:Td(e,kd);return r?_d(r,e,n,t):_d(g,bd(n),e,t)},function(e,t){var n=yd(this),r=bd(e);if("string"==typeof t&&-1===Dd(t,b)&&-1===Dd(t,"$<")){e=E(g,n,r,t);if(e.done)return e.value}for(var i,s=md(t),a=(s||(t=bd(t)),n.global),o=(a&&(i=n.unicode,n.lastIndex=0),[]);null!==(d=Cd(n,r))&&(Rd(o,d),a);)""===bd(d[0])&&(n.lastIndex=wd(r,Ed(n.lastIndex),i));for(var u,c="",l=0,h=0;h<o.length;h++){for(var d,f=bd((d=o[h])[0]),p=Nd(Ad(gd(d.index),r.length),0),v=[],_=1;_<d.length;_++)Rd(v,void 0===(u=d[_])?u:String(u));var y=d.groups,m=s?(m=Od([f],v,p,r),void 0!==y&&Rd(m,y),bd(vd(t,void 0,m))):Sd(f,r,p,v,y,t);l<=p&&(c+=Md(r,l,p)+m,l=p+f.length)}return c+Md(r,l)}]},!!ds(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!ua||xd);function Ld(t){return function(e){e=Ud(Pd(e));return 1&t&&(e=qd(e,Fd,"")),e=2&t?qd(e,jd,""):e}}var i=et(1..valueOf),Wn="\t\n\v\f\r                　\u2028\u2029\ufeff",Pd=ue,Ud=zi,qd=et("".replace),Jn="[\t\n\v\f\r                　\u2028\u2029\ufeff]",Fd=RegExp("^"+Jn+Jn+"*"),jd=RegExp(Jn+Jn+"*$"),aa={start:Ld(1),end:Ld(2),trim:Ld(3)},t=e,Xe=K,n=et,r=It,mt=Se,Hd=Ft,Gd=cu,Vd=nt,Bd=kt,Kd=Ee,Qd=te,Gn=jn.f,zd=B.f,Wd=Yt.f,Yd=i,Xd=aa.trim,a="Number",Jd=Xe[a],Zd=Jd.prototype,$d=Xe.TypeError,ef=n("".slice),tf=n("".charCodeAt),nf=function(e){var t,n,r,i,s,a,o,u=Kd(e,"number");if(Bd(u))throw $d("Cannot convert a Symbol value to a number");if("string"==typeof u&&2<u.length)if(u=Xd(u),43===(e=tf(u,0))||45===e){if(88===(t=tf(u,2))||120===t)return NaN}else if(48===e){switch(tf(u,1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+u}for(s=(i=ef(u,2)).length,a=0;a<s;a++)if((o=tf(i,a))<48||r<o)return NaN;return parseInt(i,n)}return+u};if(r(a,!Jd(" 0o1")||!Jd("0b1")||Jd("+0x1"))){for(var rf,sf=function(e){var e=arguments.length<1?0:Jd(function(e){e=Kd(e,"number");return"bigint"==typeof e?e:nf(e)}(e)),t=this;return Vd(Zd,t)&&Qd(function(){Yd(t)})?Gd(Object(e),t,sf):e},af=t?Gn(Jd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),of=0;af.length>of;of++)Hd(Jd,rf=af[of])&&!Hd(sf,rf)&&Wd(sf,rf,zd(Jd,rf));mt(Xe,a,(sf.prototype=Zd).constructor=sf,{constructor:!0})}function uf(n){Object.keys(n).forEach(function(e){var t;(void 0===(t=n[e])||Number.isNaN(t)||""===t||Array.isArray(t)&&0===t.length)&&delete n[e]})}var cf,lf,hf,df=function(){var t=v(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getCandidateInfo()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:n=e.sent,i=n.entries(),s=0;case 7:if(!(s<n.size)){e.next=18;break}if(a=i.next(),a=a.value){e.next=11;break}return e.abrupt("continue",15);case 11:if("candidate-pair"===(o=a[1]).type&&"succeeded"===o.state)return r=o.localCandidateId,e.abrupt("break",18);e.next=15;break;case 15:s++,e.next=7;break;case 18:if(!(s<n.size)){e.next=28;break}if(o=i.next(),u=o.value){e.next=22;break}return e.abrupt("continue",25);case 22:if("local-candidate"===(c=u[1]).type&&c.id===r)return e.abrupt("return",{connectionType:null!=(l=c.candidateType)?l:"",protocol:null!=(l=c.protocol)?l:"",relayProtocol:null!=(l=c.relayProtocol)?l:""});e.next=25;break;case 25:s++,e.next=18;break;case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),ff=function(){var t=v(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={},i={},s={},a=new Map,o=new Map,t.forEach(function(e){"codec"===e.type&&a.set(e.id,e),"candidate-pair"===e.type&&"succeeded"===e.state&&(u=e.localCandidateId,n.webrtc_timestamp=e.time),"media-source"===e.type&&o.set(e.kind,e)}),t.forEach(function(e){var t;"local-candidate"===e.type&&e.id===u&&(r.network_type=e.networkType,r.protocol=e.protocol,r.candidate_type=e.candidateType),"audio"!==e.kind&&"audio"!==e.mediaType||("outbound-rtp"===e.type&&(i.codec=null==(t=a.get(e.codecId))?void 0:t.mimeType,i.total_packets_sent=e.packetsSent,i.retransmitted_packets_sent=e.retransmittedPacketsSent),"remote-inbound-rtp"===e.type&&(i.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,i.total_packets_received=e.packetsReceived,i.total_packets_lost_rate=t,i.total_packets_lost=e.packetsLost,i.jitter=1e3*e.jitter),"track"===e.type&&e.remoteSource&&(i.jitter_buffer_delay=e.jitterBufferDelay,i.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount)),"video"!==e.kind&&"video"!==e.mediaType||(s.video_source_width=null==(t=o.get("video"))?void 0:t.width,s.video_source_height=null==(t=o.get("video"))?void 0:t.height,s.video_source_frames_per_second=null==(t=o.get("video"))?void 0:t.framesPerSecond,"outbound-rtp"===e.type&&(s.codec=null==(t=a.get(e.codecId))?void 0:t.mimeType,s.fir_count=e.firCount,s.pli_count=e.pliCount,s.nack_count=e.nackCount,s.qp_sum=e.qpSum,s.retransmitted_packets_sent=e.retransmittedBytesSent,s.quality_limitation_reason=e.qualityLimitationReason,s.quality_limitation_resolution_changes=e.qualityLimitationResolutionChanges),"remote-inbound-rtp"===e.type&&(s.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(s.header_bytes_received=e.headerBytesReceived,s.key_frames_decoded=e.keyFramesDecoded,s.total_decode_time=e.totalDecodeTime,s.total_inter_frame_delay=e.totalInterFrameDelay,s.total_squared_inter_frame_delay=e.totalSquaredInterFrameDelay,t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,s.total_packets_lost=e.packetsLost,s.total_packets_received=e.packetsReceived,s.total_packets_lost_rate=t),"track"===e.type&&(e.remoteSource?(s.jitter_buffer_delay=e.jitterBufferDelay,s.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount,s.received_frame_width=e.frameWidth,s.received_frame_height=e.frameHeight,s.frames_received=e.framesReceived,s.frames_decoded=e.framesDecoded,s.frames_dropped=e.framesDropped,s.freeze_count=e.freezeCount,s.pause_count=e.pauseCount,s.total_freezes_duration=e.totalFreezesDuration,s.total_pauses_duration=e.totalPausesDuration,s.total_frames_duration=e.totalFramesDuration,s.sum_of_squared_frames_duration=e.sumOfSquaredFramesDuration):(s.sent_frame_width=e.frameWidth,s.sent_frame_height=e.frameHeight)))}),uf(r),uf(i),uf(s),n.transport_info=r,n.audio=i,n.video=s,e.abrupt("return",n);case 15:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),pf=function(){var t=v(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getStats()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:return n=e.sent,e.abrupt("return",ff(n));case 6:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),vf=function(){function t(e){_(this,t),this._context=e}return y(t,[{key:"state",get:function(){return this._state}},{key:"_changeState",value:function(e){this._state&&this._state.type===e.type||(this._state&&this._state.destroy(),this._state=e,this._state.context=this._context,this._state.start())}}]),t}(),_f=function(){function t(e){_(this,t),this._stateMutator=e}return y(t,[{key:"context",set:function(e){this._context=e}},{key:"start",value:function(){this._onStart()}},{key:"destroy",value:function(){this._onDestroy()}}]),t}(),yf=function(){function n(e,t){_(this,n),this._context=e,this._stateMutator=t,this._context=e,this._stateMutator=t}return y(n,[{key:"state",get:function(){return this._stateMutator.state}}]),n}(),mf=function(){g(n,_f);var t=b(n);function n(e){return _(this,n),t.call(this,e)}return y(n)}(),gf=((Kt=cf=cf||{}).IDLE="idle",Kt.OFFERING="offering",Kt.ANSWERING="answering",Kt.CONNECTED="connected",Kt.RECONNECTING="reconnecting",Kt.ICE_RESTART_OFFERING="iceRestartOffering",Kt.ICE_RESTART_ANSWERING="iceRestartAnswering",Kt.CLOSED="closed",function(){g(r,mf);var t,n=b(r);function r(e,t){return _(this,r),m(E(e=n.call(this,e)),"type",cf.ANSWERING),e._offerCommand=t,e}return y(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("answering"),this._context.createRTCConnection(),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.prepareSessionDescription(),this._context.sendAnswer().catch(function(e){});case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}()),Ef=function(){g(s,mf);var i=b(s);function s(){var e;_(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(E(e=i.call.apply(i,[this].concat(n))),"type",cf.CLOSED),e}return y(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),s}(),bf=function(){g(r,mf);var t,n=b(r);function r(e,t){return _(this,r),m(E(e=n.call(this,e)),"type",cf.CONNECTED),e._isReconnected=t,e}return y(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toReconnecting(t);case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceDisconnected",value:function(){this._stateMutator.toReconnecting()}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),If=function(){g(r,mf);var t,n=b(r);function r(e,t){return _(this,r),m(E(e=n.call(this,e)),"type",cf.ICE_RESTART_ANSWERING),e._offerCommand=t,e}return y(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartAnswering"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.sendAnswer().catch(function(e){});case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),wf=function(){g(s,mf);var i=b(s);function s(){var e;_(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(E(e=i.call.apply(i,[this].concat(n))),"type",cf.ICE_RESTART_OFFERING),e}return y(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartOffering"),this._context.sendOffer(!0)}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),Tf=function(){g(s,mf);var t,i=b(s);function s(){var e;_(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(E(e=i.call.apply(i,[this].concat(n))),"type",cf.IDLE),e}return y(s,[{key:"_onStart",value:function(){}},{key:"_onDestroy",value:function(){}},{key:"createOffer",value:function(){this._stateMutator.toOffering()}},{key:"onOfferReceived",value:(t=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toAnswering(t);case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),Sf=function(){g(s,mf);var i=b(s);function s(){var e;_(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(E(e=i.call.apply(i,[this].concat(n))),"type",cf.OFFERING),e}return y(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("offering"),this._context.createRTCConnection(),this._context.prepareSessionDescription()}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),Cf=function(){g(r,mf);var n=b(r);function r(e,t){return _(this,r),m(E(e=n.call(this,e)),"type",cf.RECONNECTING),e._offerCommand=t,e}return y(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("reconnecting"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:function(e){this._stateMutator.toIceRestartAnswering(e)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),kf=function(){g(t,vf);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}},{key:"toIdle",value:function(){this._changeState(new Tf(this))}},{key:"toOffering",value:function(){this._changeState(new Sf(this))}},{key:"toAnswering",value:function(e){this._changeState(new gf(this,e))}},{key:"toConnected",value:function(e){this._changeState(new bf(this,e))}},{key:"toReconnecting",value:function(e){this._changeState(new Cf(this,e))}},{key:"toIceRestartOffering",value:function(){this._changeState(new wf(this))}},{key:"toIceRestartAnswering",value:function(e){this._changeState(new If(this,e))}},{key:"toClosed",value:function(){this._changeState(new Ef(this))}}]),t}(),Nf=function(){g(n,yf);var t=b(n);function n(e){return _(this,n),(e=t.call(this,e,new kf(e)))._stateMutator.toIdle(),e}return y(n,[{key:"state",get:function(){return this._stateMutator.state}},{key:"onOfferReceived",value:function(e){I.verbose("[".concat(this.state.type,"] onOfferReceived"));var t=this.state;switch(t.type){case cf.IDLE:case cf.ANSWERING:case cf.CONNECTED:case cf.RECONNECTING:case cf.ICE_RESTART_ANSWERING:t.onOfferReceived(e);break;default:I.error("[".concat(this.state.type,"] onOfferReceived"))}}},{key:"onAnswerReceived",value:function(e){I.verbose("[".concat(this.state.type,"] onAnswerReceived"));var t=this.state;switch(t.type){case cf.OFFERING:case cf.ICE_RESTART_OFFERING:t.onAnswerReceived(e);break;default:I.error("[".concat(this.state.type,"] onAnswerReceived"))}}},{key:"onClose",value:function(){I.verbose("[".concat(this.state.type,"] onClose"));var e=this.state;switch(e.type){case cf.IDLE:case cf.OFFERING:case cf.ANSWERING:case cf.CONNECTED:case cf.RECONNECTING:case cf.ICE_RESTART_OFFERING:case cf.ICE_RESTART_ANSWERING:e.onClose();break;default:I.error("[".concat(this.state.type,"] onClose"))}}},{key:"createOffer",value:function(){I.verbose("[".concat(this.state.type,"] createOffer"));var e=this.state;e.type===cf.IDLE?e.createOffer():I.error("[".concat(this.state.type,"] createOffer"))}},{key:"onIceConnected",value:function(){I.verbose("[".concat(this.state.type,"] onIceConnected"));var e=this.state;switch(e.type){case cf.OFFERING:case cf.ANSWERING:case cf.RECONNECTING:case cf.ICE_RESTART_OFFERING:case cf.ICE_RESTART_ANSWERING:e.onIceConnected();break;default:I.error("[".concat(this.state.type,"] onIceConnected"))}}},{key:"onIceDisconnected",value:function(){I.verbose("[".concat(this.state.type,"] onIceDisconnected"));var e=this.state;e.type===cf.CONNECTED?e.onIceDisconnected():I.error("[".concat(this.state.type,"] onIceDisconnected"))}},{key:"onIceFailed",value:function(){I.verbose("[".concat(this.state.type,"] onIceFailed"));var e=this.state;switch(e.type){case cf.CONNECTED:case cf.RECONNECTING:e.onIceFailed();break;default:I.error("[".concat(this.state.type,"] onIceFailed"))}}}]),n}(),Af=((s=lf=lf||{}).RELAY="relay",s.ALL="all",function(){g(l,Eh);var e,t,n,r,c=b(l);function l(e,t,n,r,i,s,a,o){var u;return _(this,l),(u=c.call(this))._ctx=e,u.id=t,u._signalingClient=n,u._localStream=r,u._isInitiator=i,u._turnCredential=s,u._mediaDirections=a,u._isDisposable=o,u._stateMachine=new Nf({dispatchEvent:u._dispatchEvent.bind(E(u)),isInitiator:u._isInitiator,setRemoteDescription:u._setRemoteDescription.bind(E(u)),sendAnswer:u._sendAnswer.bind(E(u)),sendOffer:u._sendOffer.bind(E(u)),createRTCConnection:u._createRTCConnection.bind(E(u)),prepareSessionDescription:u._prepareSessionDescription.bind(E(u)),isDisposable:u._isDisposable}),r&&r.on("streamChanged",function(e){return u.onLocalStream(e)}),u}return y(l,[{key:"_state",get:function(){return this._stateMachine.state}},{key:"rtcConnection",get:function(){return this._rtcConnection}},{key:"remoteStream",get:function(){return this._remoteStream}},{key:"signalingClient",get:function(){return this._signalingClient}},{key:"onEvent",value:function(e){switch(e.type){case hf.CANDIDATE:return void this._receiveCandidate(e);case hf.OFFER:this._stateMachine.onOfferReceived(e);break;case hf.ANSWER:this._stateMachine.onAnswerReceived(e);break;default:I.error(new Error("unhandled call event ".concat(e)))}}},{key:"createOffer",value:function(){this._stateMachine.createOffer()}},{key:"close",value:function(){this._closeRTCConnection(),this._stateMachine.onClose()}},{key:"onLocalStream",value:function(e){if(this._rtcConnection){var t,n=G(e.getTracks());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._replaceTrack(r)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getCandidateInfo",value:(r=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",df(this.rtcConnection));case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getStatsLog",value:(n=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",pf(this.rtcConnection));case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"_replaceTrack",value:function(e){var t,n=G(this._rtcConnection.getSenders());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.track&&r.track.kind===e.kind&&r.replaceTrack(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_createRTCConnection",value:function(){var e,r=this,t=(this._turnCredential&&(e={iceServers:[{username:this._turnCredential.username,credential:this._turnCredential.password,urls:this._turnCredential.turnUrls}],iceTransportPolicy:this._turnCredential.transportPolicy||lf.ALL}),new RTCPeerConnection(e));t.onnegotiationneeded=function(){r._sendOffer(!1)},t.onicecandidate=function(e){var t,n;e.candidate&&null!=(t=(n=r._signalingClient).sendCandidate)&&t.call(n,e.candidate)},t.onconnectionstatechange=function(){return r._handleConnectionStateChange(t)},t.oniceconnectionstatechange=function(){return r._handleIceConnectionStateChange(t)},t.ontrack=function(e){return r._onRemoteTrack(e)},this._rtcConnection=t}},{key:"_closeRTCConnection",value:function(){this._rtcConnection&&(this._rtcConnection.onnegotiationneeded=null,this._rtcConnection.onicecandidate=null,this._rtcConnection.oniceconnectionstatechange=null,this._rtcConnection.onconnectionstatechange=null,this._rtcConnection.close(),this._rtcConnection=null,delete this._remoteStream)}},{key:"_prepareSessionDescription",value:function(){var e=this._mediaDirections,t=e.audio,e=e.video,n={sendrecv:[],sendonly:[],recvonly:[],none:[]};n[t].push("audio"),n[e].push("video"),n.sendrecv.length&&this._addTracks(n.sendrecv),n.sendonly.length&&this._addSendOnlyTransceivers(n.sendonly),n.recvonly.length&&this._addReceiveOnlyTransceivers(n.recvonly)}},{key:"_addTracks",value:function(t){var n=this,r=(I.debug("_addTracks()"),this._localStream.localStream);r.getTracks().forEach(function(e){t.includes(e.kind)&&n._rtcConnection.addTrack(e,r)})}},{key:"_addReceiveOnlyTransceivers",value:function(e){var t=this;e.forEach(function(e){t._rtcConnection.addTransceiver(e,{direction:"recvonly"})})}},{key:"_addSendOnlyTransceivers",value:function(e){var n=this,r=this._localStream.localStream;e.forEach(function(t){r.getTracks().forEach(function(e){e.kind===t&&n._rtcConnection.addTransceiver(e,{direction:"sendonly",streams:[r]})})})}},{key:"_setRemoteDescription",value:function(e,t){t=t.replace(/a=extmap:0 ulpfec\r\n/,""),e=new RTCSessionDescription({type:e,sdp:t});return this._rtcConnection.setRemoteDescription(e)}},{key:"_sendOffer",value:(t=v(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={iceRestart:t||!1},e.next=3,this._rtcConnection.createOffer(n);case 3:return n=e.sent,e.next=6,this._rtcConnection.setLocalDescription(n);case 6:return e.abrupt("return",this._signalingClient.sendOfferSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_sendAnswer",value:(e=v(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rtcConnection.createAnswer();case 2:return(t=e.sent).sdp=t.sdp.replace("actpass","active"),e.next=6,this._rtcConnection.setLocalDescription(t);case 6:return e.abrupt("return",this._signalingClient.sendAnswerSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_handleIceConnectionStateChange",value:function(e){switch(I.verbose("[".concat(this._state.type,"] iceConnectionState ").concat(e.iceConnectionState)),e.iceConnectionState){case"connected":this._stateMachine.onIceConnected();break;case"disconnected":this._stateMachine.onIceDisconnected();break;case"failed":this._dispatchEvent("iceFailed")}}},{key:"_handleConnectionStateChange",value:function(e){I.verbose("[".concat(this._state.type,"] connectionState ").concat(e.connectionState))}},{key:"_receiveCandidate",value:function(e){e=e.payload.candidate;this._rtcConnection.addIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.sdp}).catch(function(e){I.error(e)})}},{key:"_onRemoteTrack",value:function(e){this._remoteStream=e.streams[0],this._dispatchEvent("remoteStream",this._remoteStream)}}]),l}());($e=hf=hf||{}).OFFER="offer",$e.ANSWER="answer",$e.CANDIDATE="candidate";var Of,Rf,ds="process"==oe(K.process),Df=ci,Mf=fe,xf=TypeError,Lf=we,Pf=function(e){if(Df(e))return e;throw xf(Mf(e)+" is not a constructor")},Uf=ge("species"),qf=TypeError,ua=/(?:ipad|iphone|ipod).*applewebkit/i.test(yt),Ff=K,jf=Et,Jn=xe,Hf=le,Gf=Ft,e=te,Vf=hs,Bf=ri,Kf=Ie,Qf=function(e,t){if(e<t)throw qf("Not enough arguments");return e},nt=ua,kt=ds,jn=Ff.setImmediate,Yt=Ff.clearImmediate,zf=Ff.process,Wf=Ff.Dispatch,Yf=Ff.Function,i=Ff.MessageChannel,Xf=Ff.String,Jf=0,Zf={},$f="onreadystatechange";try{Of=Ff.location}catch(e){}function ep(e){return function(){yp(e)}}function tp(e){yp(e.data)}function np(e){Ff.postMessage(Xf(e),Of.protocol+"//"+Of.host)}function rp(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}function ip(){this.head=null,this.tail=null}function sp(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=Ap(n),this.reject=Ap(r)}function ap(e,t){var n,r,i,s,a=t.value,o=t.state==rv,u=o?e.ok:e.fail,c=e.resolve,l=e.reject,h=e.domain;try{u?(o||(t.rejection===av&&(s=t,Dp(qp,Rp,function(){var e=s.facade;Op?Jp.emit("rejectionHandled",e):cv(nv,e,s.value)})),t.rejection=sv),!0===u?n=a:(h&&h.enter(),n=u(a),h&&(h.exit(),i=!0)),n===e.promise?l(Yp("Promise-chain cycle")):(r=ov(n))?Dp(r,n,c,l):c(n)):l(a)}catch(e){h&&!i&&h.exit(),l(e)}}var op,up,cp,lp,hp,dp,fp,pp,vp,_p,yp=function(e){var t;Gf(Zf,e)&&(t=Zf[e],delete Zf[e],t())},t=(jn&&Yt||(jn=function(e){Qf(arguments.length,1);var t=Hf(e)?e:Yf(e),n=Bf(arguments,1);return Zf[++Jf]=function(){jf(t,void 0,n)},Rf(Jf),Jf},Yt=function(e){delete Zf[e]},kt?Rf=function(e){zf.nextTick(ep(e))}:Wf&&Wf.now?Rf=function(e){Wf.now(ep(e))}:i&&!nt?(r=(n=new i).port2,n.port1.onmessage=tp,Rf=Jn(r.postMessage,r)):Ff.addEventListener&&Hf(Ff.postMessage)&&!Ff.importScripts&&Of&&"file:"!==Of.protocol&&!e(np)?(Rf=np,Ff.addEventListener("message",tp,!1)):Rf=$f in Kf("script")?function(e){Vf.appendChild(Kf("script"))[$f]=function(){Vf.removeChild(this),yp(e)}}:function(e){setTimeout(ep(e),0)}),{set:jn,clear:Yt}),Gn=K,mt=/ipad|iphone|ipod/i.test(yt)&&void 0!==Gn.Pebble,Xe=/web0s(?!.*chrome)/i.test(yt),a=K,Kt=xe,s=B.f,mp=t.set,$e=ua,ci=mt,Et=Xe,gp=ds,Ft=a.MutationObserver||a.WebKitMutationObserver,hs=a.document,Ep=a.process,ri=a.Promise,kt=s(a,"queueMicrotask"),nt=kt&&kt.value,n=(nt||(op=function(){var e,t;for(gp&&(e=Ep.domain)&&e.exit();up;){t=up.fn,up=up.next;try{t()}catch(e){throw up?lp():cp=void 0,e}}cp=void 0,e&&e.enter()},lp=$e||gp||Et||!Ft||!hs?!ci&&ri&&ri.resolve?((i=ri.resolve(void 0)).constructor=ri,fp=Kt(i.then,i),function(){fp(op)}):gp?function(){Ep.nextTick(op)}:(mp=Kt(mp,a),function(){mp(op)}):(hp=!0,dp=hs.createTextNode(""),new Ft(op).observe(dp,{characterData:!0}),function(){dp.data=hp=!hp})),nt||function(e){e={fn:e,next:void 0};cp&&(cp.next=e),up||(up=e,lp()),cp=e}),bp=K,Jn=(ip.prototype={add:function(e){e={item:e,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},ip),r=K.Promise,e="object"==typeof window&&"object"!=typeof Deno,jn=K,Ip=r,Yt=le,Gn=It,wp=Fn,B=ge,Tp=e,Sp=gt,Cp=(Ip&&Ip.prototype,B("species")),kp=!1,Np=Yt(jn.PromiseRejectionEvent),ua={CONSTRUCTOR:Gn("Promise",function(){var e=wp(Ip),t=e!==String(Ip);if(!t&&66===Sp)return!0;if(51<=Sp&&/native code/.test(e))return!1;function n(e){e(function(){},function(){})}e=new Ip(function(e){e(1)});return(e.constructor={})[Cp]=n,!(kp=e.then(function(){})instanceof n)||!t&&Tp&&!Np}),REJECTION_EVENT:Np,SUBCLASSING:kp},mt={},Ap=pe,Xe=(mt.f=function(e){return new sp(e)},Me),Op=ds,Rp=K,Dp=Ze,s=Se,kt=sa,$e=ca,Et=lu,Mp=pe,xp=le,Lp=he,Pp=ko,Up=function(e,t){var e=Lf(e).constructor;return void 0===e||null==(e=Lf(e)[Uf])?t:Pf(e)},qp=t.set,Fp=n,jp=function(e,t){var n=bp.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},Hp=rp,Gp=Jn,ci=Jt,ri=r,i=mt,Vp="Promise",Kt=ua.CONSTRUCTOR,Bp=ua.REJECTION_EVENT,a=ua.SUBCLASSING,Kp=ci.getterFor(Vp),Qp=ci.set,hs=ri&&ri.prototype,zp=ri,Wp=hs,Yp=Rp.TypeError,Xp=Rp.document,Jp=Rp.process,Zp=i.f,$p=Zp,ev=!!(Xp&&Xp.createEvent&&Rp.dispatchEvent),tv="unhandledrejection",nv="rejectionhandled",rv=1,iv=2,sv=1,av=2,ov=function(e){var t;return!(!Lp(e)||!xp(t=e.then))&&t},uv=function(n,i){n.notified||(n.notified=!0,Fp(function(){for(var e,r,t=n.reactions;e=t.get();)ap(e,n);n.notified=!1,i&&!n.rejection&&(r=n,Dp(qp,Rp,function(){var e=r.facade,t=r.value,n=lv(r);if(n&&(n=Hp(function(){Op?Jp.emit("unhandledRejection",t,e):cv(tv,e,t)}),r.rejection=Op||lv(r)?av:sv,n.error))throw n.value}))}))},cv=function(e,t,n){var r;ev?((r=Xp.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Rp.dispatchEvent(r)):r={promise:t,reason:n},!Bp&&(t=Rp["on"+e])?t(r):e===tv&&jp("Unhandled promise rejection",n)},lv=function(e){return e.rejection!==sv&&!e.parent},hv=function(t,n,r){return function(e){t(n,e,r)}},dv=function(e,t,n){e.done||(e.done=!0,(e=n?n:e).value=t,e.state=iv,uv(e,!0))},fv=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw Yp("Promise can't be resolved itself");var r=ov(e);r?Fp(function(){var t={done:!1};try{Dp(r,e,hv(fv,t,n),hv(dv,t,n))}catch(e){dv(t,e,n)}}):(n.value=e,n.state=rv,uv(n,!1))}catch(e){dv({done:!1},e,n)}}};if(Kt&&(Wp=(zp=function(e){Pp(this,Wp),Mp(e),Dp(pp,this);var t=Kp(this);try{e(hv(fv,t),hv(dv,t))}catch(e){dv(t,e)}}).prototype,(pp=function(e){Qp(this,{type:Vp,done:!1,notified:!1,parent:!1,reactions:new Gp,rejection:!1,state:0,value:void 0})}).prototype=s(Wp,"then",function(e,t){var n=Kp(this),r=Zp(Up(this,zp));return n.parent=!0,r.ok=!xp(e)||e,r.fail=xp(t)&&t,r.domain=Op?Jp.domain:void 0,0==n.state?n.reactions.add(r):Fp(function(){ap(r,n)}),r.promise}),vp=function(){var e=new pp,t=Kp(e);this.promise=e,this.resolve=hv(fv,t),this.reject=hv(dv,t)},i.f=Zp=function(e){return e===zp||void 0===e?new vp:$p(e)},xp(ri)&&hs!==Object.prototype)){_p=hs.then,a||s(hs,"then",function(e,t){var n=this;return new zp(function(e,t){Dp(_p,n,e,t)}).then(e,t)},{unsafe:!0});try{delete hs.constructor}catch(e){}kt&&kt(hs,Wp)}Xe({global:!0,constructor:!0,wrap:!0,forced:Kt},{Promise:zp}),$e(zp,Vp,!1),Et(Vp);var pv=r,Ft=uu,nt=ua.CONSTRUCTOR||!Ft(function(e){pv.all(e).then(void 0,function(){})}),vv=Ze,_v=pe,yv=mt,mv=rp,gv=Co,It=(Me({target:"Promise",stat:!0,forced:nt},{all:function(e){var o=this,t=yv.f(o),u=t.resolve,c=t.reject,n=mv(function(){var r=_v(o.resolve),i=[],s=0,a=1;gv(e,function(e){var t=s++,n=!1;a++,vv(r,o,e).then(function(e){n||(n=!0,i[t]=e,--a||u(i))},c)}),--a||u(i)});return n.error&&c(n.value),t.promise}}),Me),Fn=r,e=de,B=le,Yt=Se,jn=Fn&&Fn.prototype;It({target:"Promise",proto:!0,forced:ua.CONSTRUCTOR,real:!0},{catch:function(e){return this.then(void 0,e)}}),B(Fn)&&(Gn=e("Promise").prototype.catch,jn.catch!==Gn&&Yt(jn,"catch",Gn,{unsafe:!0}));var Ev=Ze,bv=pe,Iv=mt,wv=rp,Tv=Co;Me({target:"Promise",stat:!0,forced:nt},{race:function(e){var n=this,r=Iv.f(n),i=r.reject,t=wv(function(){var t=bv(n.resolve);Tv(e,function(e){Ev(t,n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}});function Sv(c){return function(e,t,n,r){o_(t);var i=u_(e),s=c_(i),a=l_(i),o=c?a-1:0,u=c?-1:1;if(n<2)for(;;){if(o in s){r=s[o],o+=u;break}if(o+=u,c?o<0:a<=o)throw h_("Reduce of empty array with no initial value")}for(;c?0<=o:o<a;o+=u)o in s&&(r=t(r,s[o],o,i));return r}}var Cv,kv,Nv=Ze,Av=mt,Ov=(Me({target:"Promise",stat:!0,forced:ua.CONSTRUCTOR},{reject:function(e){var t=Av.f(this);return Nv(t.reject,void 0,e),t.promise}}),we),Rv=he,Dv=mt,sa=Me,t=de,n=ua.CONSTRUCTOR,Mv=function(e,t){if(Ov(e),Rv(t)&&t.constructor===e)return t;e=Dv.f(e);return(0,e.resolve)(t),e.promise},xv=(t("Promise"),sa({target:"Promise",stat:!0,forced:n},{resolve:function(e){return Mv(this,e)}}),y(function e(){var n=this;_(this,e),this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})})),Lv=function(){var r=v(regeneratorRuntime.mark(function e(t,n,r){var i,s,a,o,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=3<l.length&&void 0!==l[3]?l[3]:{count:0,deferred:new xv},i=a.deferred,s=a.count,e.prev=2,e.next=5,n();case 5:a=e.sent,0<s&&null!=(o=r.onRecover)&&o.call(r),i.resolve(a),e.next=19;break;case 10:if(e.prev=10,e.t0=e.catch(2),null!=(o=r.onError)&&o.call(r,e.t0),0<=(u=t.calcTimeout(s+1)))return null!=(c=r.onRetrial)&&c.call(r,s+1,e.t0),setTimeout(function(){Lv(t,n,r,{count:s+1,deferred:i})},u),e.abrupt("return",i.promise);e.next=18;break;case 18:i.reject(e.t0);case 19:return e.abrupt("return",i.promise);case 20:case"end":return e.stop()}},e,null,[[2,10]])}));return function(e,t,n){return r.apply(this,arguments)}}(),Pv=function(){function e(){_(this,e)}return y(e,[{key:"calcTimeout",value:function(e){switch(e){case 1:return 1e3;case 2:return 2e3;case 3:return 3e3;default:return-1}}}]),e}(),Uv=function(){function r(e,t,n){_(this,r),this.interval=e,this.noise=t,this.maxRetrial=n}return y(r,[{key:"calcTimeout",value:function(e){return e>this.maxRetrial?-1:e*this.interval+(Math.random()-.5)*this.noise*2}}]),r}(),qv=function(){function t(e){_(this,t),this._requests=new Map,this.timeoutTime=e}return y(t,[{key:"has",value:function(e){return this._requests.has(e)}},{key:"get",value:function(e){return this._requests.get(e)}},{key:"register",value:function(e){if(!e)throw new Error("invalid request id");if(this._requests.has(e))throw new Error("duplicate requests");var t=new xv;return this._requests.set(e,{deferred:t,timer:this._createTimeoutTimer(e)}),t}},{key:"unregister",value:function(e){if(!this._requests.has(e))return null;var t=this._requests.get(e),n=t.timer,t=t.deferred;return clearTimeout(n),this._requests.delete(e),t}},{key:"_createTimeoutTimer",value:function(e){var t=this;return setTimeout(function(){t.unregister(e).reject(new Error("no response due to timeout"))},this._getTimeoutTime())}},{key:"rejectAll",value:function(e){var t,n=G(this._requests.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value,i=this._requests.get(r);clearTimeout(i.timer),i.deferred.reject(e)}}catch(e){n.e(e)}finally{n.f()}this._requests.clear()}},{key:"_getTimeoutTime",value:function(){return this.timeoutTime}}]),t}(),Fv=function(){function i(e,t,n,r){_(this,i),m(this,"_timeoutTime",6e4),this._ctx=e,this._participantId=t,this._mediaDirections=n,this._endpointId=r,this._requestMap=new qv(this._timeoutTime)}var t,n,r;return y(i,[{key:"sendOfferSdp",value:(r=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._endpointId){e.next=5;break}return e.next=3,this._sendOfferAndUnregisterCreateEndpointRequest(t);case 3:e.next=7;break;case 5:return e.next=7,this._sendOfferAndUnregisterPutEndpointRequest(t);case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_sendOfferAndUnregisterCreateEndpointRequest",value:(n=v(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":create-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return n.apply(this,arguments)})},{key:"_sendOfferAndUnregisterPutEndpointRequest",value:(t=v(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":put-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return t.apply(this,arguments)})},{key:"registerCreateEndpointRequest",value:function(){if(this._endpointId)throw new Error("Cannot register create endpoint request on endpoint recycle");return this._requestMap.register("".concat(this._participantId,":create-endpoint-request"))}},{key:"registerPutEndpointRequest",value:function(){if(this._endpointId)return this._requestMap.register("".concat(this._participantId,":put-endpoint-request"));throw new Error("Cannot register put endpoint request without endpoint id")}},{key:"_sendCreateEndpoint",value:function(e){return this._ctx.sendCreateEndpoint(e)}},{key:"_sendPutEndpoint",value:function(e){return this._ctx.sendPutEndpoint(e)}}]),i}(),jv=function(){g(n,_f);var t=b(n);function n(e){return _(this,n),t.call(this,e)}return y(n)}(),Hv=((Jn=Cv=Cv||{}).PENDING="pending",Jn.ESTABLISHED="established",Jn.CONNECTED="connected",Jn.FAILED="failed",Jn.RELEASING="releasing",Jn.CLOSED="closed",function(){g(s,jv);var i=b(s);function s(){var e;_(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(E(e=i.call.apply(i,[this].concat(n))),"type",Cv.CLOSED),e}return y(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),s}()),Gv=function(){g(n,jv);var t=b(n);function n(e){return _(this,n),m(E(e=t.call(this,e)),"type",Cv.CONNECTED),e}return y(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onICEFailed",value:function(){this._stateMutator.toPending()}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(),Vv=function(){g(i,jv);var r=b(i);function i(e,t,n){return _(this,i),m(E(e=r.call(this,e)),"type",Cv.ESTABLISHED),e._sdp=t,e._hasPendingAttach=n,e}return y(i,[{key:"_onStart",value:function(){this._context.dispatchEvent("established"),this._context.setRemoteDescription(this._sdp),this._hasPendingAttach&&this.onAttach()}},{key:"_onDestroy",value:function(){}},{key:"onPCConnected",value:function(){this._stateMutator.toConnected()}},{key:"onICEFailed",value:function(){this._stateMutator.toPending()}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),i}(),Bv=function(){g(s,jv);var i=b(s);function s(){var e;_(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(E(e=i.call.apply(i,[this].concat(n))),"type",Cv.FAILED),e}return y(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("failed"),this._context.endpoint.id?this._stateMutator.toReleasing():this._stateMutator.toClosed()}},{key:"_onDestroy",value:function(){}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),Kv=function(){g(s,jv);var i=b(s);function s(){var e;_(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(E(e=i.call.apply(i,[this].concat(n))),"type",Cv.PENDING),e}return y(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("pending"),this._request()}},{key:"_onDestroy",value:function(){this._requestTimeout&&clearTimeout(this._requestTimeout),delete this._requestTimeout}},{key:"_request",value:function(){var e=this,t=(this._context.trialCount+=1,this._context.trialCount);9<=t?this._stateMutator.toFailed():1<t?this._requestTimeout=setTimeout(function(){e._context.createSession()},5e3*t+2e3*(Math.random()-.5)):this._context.createSession()}},{key:"onEndpointRequestSucceeded",value:function(e){this._stateMutator.toEstablished(e,this._hasPendingAttach)}},{key:"onEndpointRequestFailed",value:function(){this._request()}},{key:"onAttach",value:function(){this._hasPendingAttach=!0}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),Qv=function(){g(s,jv);var i=b(s);function s(){var e;_(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(E(e=i.call.apply(i,[this].concat(n))),"type",Cv.RELEASING),e}return y(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("releasing"),this._context.closePeerConnection(),this._context.endpoint.id&&this._context.requestRelease()}},{key:"_onDestroy",value:function(){}},{key:"onEndpointRequestSucceeded",value:function(){this._context.requestRelease()}},{key:"onEndpointRequestFailed",value:function(){this._stateMutator.toClosed()}},{key:"onReleased",value:function(){this._stateMutator.toClosed()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),zv=function(){g(t,vf);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t,[{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}},{key:"toPending",value:function(){this._changeState(new Kv(this))}},{key:"toEstablished",value:function(e,t){this._changeState(new Vv(this,e,t))}},{key:"toConnected",value:function(){this._changeState(new Gv(this))}},{key:"toFailed",value:function(){this._changeState(new Bv(this))}},{key:"toReleasing",value:function(){this._changeState(new Qv(this))}},{key:"toClosed",value:function(){this._changeState(new Hv(this))}}]),t}(),Wv=function(){g(n,yf);var t=b(n);function n(e){return _(this,n),(e=t.call(this,e,new zv(e)))._stateMutator.toPending(),e}return y(n,[{key:"state",get:function(){return this._stateMutator.state}},{key:"onEndpointRequestSucceeded",value:function(e){I.verbose("[".concat(this.state.type,"] onEndpointRequestSucceeded"));var t=this.state;switch(t.type){case Cv.PENDING:t.onEndpointRequestSucceeded(e);break;case Cv.RELEASING:t.onEndpointRequestSucceeded();break;default:I.error("[".concat(this.state.type,"] onEndpointRequestSucceeded"))}}},{key:"onEndpointRequestFailed",value:function(){I.verbose("[".concat(this.state.type,"] onEndpointCreateFailed"));var e=this.state;switch(e.type){case Cv.PENDING:case Cv.RELEASING:e.onEndpointRequestFailed();break;default:I.error("[".concat(this.state.type,"] onEndpointCreateFailed"))}}},{key:"onICEFailed",value:function(){I.verbose("[".concat(this.state.type,"] onICEFailed"));var e=this.state;switch(e.type){case Cv.ESTABLISHED:case Cv.CONNECTED:e.onICEFailed();break;default:I.error("[".concat(this.state.type,"] onICEFailed"))}}},{key:"onPCConnected",value:function(){I.verbose("[".concat(this.state.type,"] onPCConnected"));var e=this.state;e.type===Cv.ESTABLISHED?e.onPCConnected():I.error("[".concat(this.state.type,"] onPCConnected"))}},{key:"onAttach",value:function(){I.verbose("[".concat(this.state.type,"] onAttach"));var e=this.state;switch(e.type){case Cv.PENDING:case Cv.ESTABLISHED:case Cv.CONNECTED:e.onAttach();break;default:I.error("[".concat(this.state.type,"] onAttach"))}}},{key:"onRelease",value:function(){I.verbose("[".concat(this.state.type,"] onRelease"));var e=this.state;switch(e.type){case Cv.PENDING:case Cv.ESTABLISHED:case Cv.CONNECTED:e.onRelease();break;default:I.error("[".concat(this.state.type,"] onRelease"))}}},{key:"onReleased",value:function(){I.verbose("[".concat(this.state.type,"] onReleased"));var e=this.state;e.type===Cv.RELEASING?e.onReleased():I.error("[".concat(this.state.type,"] onReleased"))}},{key:"onExit",value:function(){I.verbose("[".concat(this.state.type,"] onExit"));var e=this.state;switch(e.type){case Cv.RELEASING:case Cv.PENDING:case Cv.CONNECTED:case Cv.ESTABLISHED:case Cv.FAILED:e.onExit();break;default:I.error("[".concat(this.state.type,"] onExit"))}}}]),n}(),Yv=function(){g(r,Li);var n=b(r);function r(e){var t;return _(this,r),(t=n.call(this)).payload=e.payload||{},t}return y(r)}(),Xv=function(){g(t,Yv);var e=b(t);function t(){return _(this,t),e.apply(this,arguments)}return y(t)}(),Jv=((Jt=kv=kv||{}).OFFER="offer",Jt.ANSWER="answer",Jt.CANDIDATE="candidate",function(){g(n,Xv);var t=b(n);function n(e){return _(this,n),m(E(e=t.call(this,{payload:e})),"type",kv.ANSWER),e}return y(n)}()),Zv=function(){g(n,Xv);var t=b(n);function n(e){return _(this,n),m(E(e=t.call(this,{payload:e})),"type",kv.CANDIDATE),e}return y(n)}(),$v=function(){g(n,Xv);var t=b(n);function n(e){return _(this,n),m(E(e=t.call(this,{payload:e})),"type",kv.OFFER),e}return y(n)}(),e_=function(){function e(){_(this,e)}return y(e,null,[{key:"createOffer",value:function(e,t){return new $v({peerConnectionId:e,sdp:t})}},{key:"createAnswer",value:function(e,t){return new Jv({peerConnectionId:e,sdp:t})}},{key:"createCandidate",value:function(e,t){return new Zv({peerConnectionId:e,candidate:t})}}]),e}(),t_=function(){g(a,Eh);var s=b(a);function a(e,t,n,r){var i;return _(this,a),m(E(i=s.call(this)),"tmpId",$()),m(E(i),"_createSession",function(){switch(I.debug("_createSession()"),i._type){case"master":i._createMasterSession();break;case"viewer":i._createViewerSession();break;default:I.error("Not supported endpoint type : ",i._type)}}),m(E(i),"_closePeerConnection",function(){I.debug("_closePeerConnection()"),i._pc.removeAllEventListeners(),i._pc.close()}),m(E(i),"_requestAttach",function(){Lv(new Uv(5e3,1e3,8),function(){return i._sendAttach(i._attachedTo)},{onError:function(e){I.error("Fail attach endpoint endpointId = ".concat(i.id,", to = ").concat(i._attachedTo," ErrorCode = ").concat(e.code))}}).then(function(){i._dispatchEvent("attached",i._attachedTo)})}),m(E(i),"_requestRelease",function(){I.debug("_requestRelease()"),i._sendReleaseEndpoint().then(function(){i._stateMachine.onReleased()}).catch(function(e){I.error("Release request failed",e),i._stateMachine.onReleased()})}),m(E(i),"_setRemoteDescription",function(e){I.debug("_setRemoteDescription()");var t=i._pc,e=e_.createAnswer(void 0,e);t.onEvent(e),t.once("connected",function(){i._stateMachine.onPCConnected(),i._sendConnected()}),t.once("iceFailed",function(){i._stateMachine.onICEFailed()})}),i._ctx=e,i._localStream=t,i._type=n,i._participantId=r,i._stateMachine=new Wv({endpoint:E(i),dispatchEvent:i._dispatchEvent.bind(E(i)),createSession:i._createSession,setRemoteDescription:i._setRemoteDescription,closePeerConnection:i._closePeerConnection,requestAttach:i._requestAttach,requestRelease:i._requestRelease,trialCount:0}),i}return y(a,[{key:"pc",get:function(){return this._pc}},{key:"_state",get:function(){return this._stateMachine.state}},{key:"_masterSessionDirection",get:function(){return this._ctx.masterSessionDirection}},{key:"_viewerSessionDirection",get:function(){return this._ctx.viewerSessionDirection}},{key:"attach",value:function(e){I.debug("attach()"),this._attachedTo=e,this._stateMachine.onAttach()}},{key:"release",value:function(){I.debug("release()"),this._stateMachine.onRelease()}},{key:"exit",value:function(){I.debug("exit()"),this._closePeerConnection(),this._stateMachine.onExit()}},{key:"_createMasterSession",value:function(){I.debug("_createMasterSession()"),this._createPeerConnection(this._masterSessionDirection,this._localStream),this._requestCreateEndpoint()}},{key:"_createViewerSession",value:function(){I.debug("_createViewerSession()"),this._createPeerConnection(this._viewerSessionDirection,void 0),this._requestCreateEndpoint()}},{key:"_createPeerConnection",value:function(e,t){I.debug("_createPeerConnection()");var n=new Fv(this._ctx,this._participantId,e,this.id);this._pc=new Af(this._ctx,void 0,n,t,!0,void 0,e,!0),this._dispatchEvent("pcChanged",this._pc)}},{key:"_requestCreateEndpoint",value:function(){var t=this,e=(I.debug("_requestCreateEndpoint()"),this._pc),n=this.id?e.signalingClient.registerPutEndpointRequest():e.signalingClient.registerCreateEndpointRequest();e.createOffer(),n.promise.then(function(e){t.id=e.payload.endpoint.id,t._stateMachine.onEndpointRequestSucceeded(e.payload.sdp)}).catch(function(e){I.error("Endpoint request failed",e),t._stateMachine.onEndpointRequestFailed()})}},{key:"_sendConnected",value:function(){return this._ctx.sendConnected(this)}},{key:"_sendReleaseEndpoint",value:function(){return this._ctx.sendReleaseEndpoint(this)}},{key:"_sendAttach",value:function(e){return this._ctx.sendAttach(this,e)}}]),a}(),n_=function(){g(n,Eh);var e,t=b(n);function n(){return _(this,n),t.call(this)}return y(n,[{key:"stream",get:function(){return this._stream}},{key:"isSharing",get:function(){return!!this._stream}},{key:"startStream",value:(e=v(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getDisplayMedia({video:!0});case 3:t=e.sent,this._stream=t,this._stream.getVideoTracks()[0].onended=function(){n._releaseStream(),n._dispatchEvent("streamStopped")},e.next=19;break;case 8:e.prev=8,e.t0=e.catch(0),e.t1=e.t0.name,e.next="InvalidStateError"===e.t1?13:"NotAllowedError"===e.t1?14:"NotFoundError"===e.t1?15:"NotReadableError"===e.t1?16:17;break;case 13:case 14:case 15:case 16:return e.abrupt("break",18);case 17:throw new Error("");case 18:throw new Error("failed to start screen share");case 19:case"end":return e.stop()}},e,this,[[0,8]])})),function(){return e.apply(this,arguments)})},{key:"stopStream",value:function(){this._releaseStream(),this._dispatchEvent("streamStopped")}},{key:"_releaseStream",value:function(){if(this._stream){var e,t=G(this._stream.getTracks());try{for(t.s();!(e=t.n()).done;)e.value.stop()}catch(e){t.e(e)}finally{t.f()}delete this._stream}}}]),n}(),r_=function(){g(i,Eh);var e,r=b(i);function i(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};return _(this,i),m(E(t=r.call(this)),"_checkScreenSharePrerequisites",function(){if(!navigator.mediaDevices.getDisplayMedia)throw new Error("screen share is not supported in this browser")}),t._deviceManager=e,t._mediaConstraints=n,t._screenShare=new n_,t._screenShare.on("streamStopped",function(){t._releaseMergedStream(),t._dispatchEvent("screenShareStreamStopped")}),t}return y(i,[{key:"mediaConstraints",set:function(e){this._mediaConstraints=e}},{key:"hasPermission",get:function(){var e;return null==(e=this._mediaAccess)?void 0:e.hasPermission}},{key:"localStream",get:function(){return this.isScreenSharing?this._mergedStream:this.getLocalMediaStream()}},{key:"mergedStream",get:function(){return this._mergedStream}},{key:"screenStream",get:function(){return this._screenShare.stream}},{key:"isScreenSharing",get:function(){return this._screenShare.isSharing}},{key:"useScreenStream",value:(e=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkScreenSharePrerequisites(),e.next=3,this._screenShare.startStream();case 3:this._mergeScreenShareStream(),this._dispatchEvent("streamChanged",this.localStream);case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"getLocalMediaStream",value:function(){return this._mediaAccess||this._grantMediaAccess(this._mediaConstraints),this._mediaAccess.stream}},{key:"stopScreenShare",value:function(){this._screenShare.isSharing&&this._screenShare.stopStream()}},{key:"revokeMediaAccess",value:function(){this._mediaAccess&&(this._mediaAccess.dispose(),this._mediaAccess=null)}},{key:"release",value:function(){this.stopScreenShare(),this.revokeMediaAccess()}},{key:"_grantMediaAccess",value:function(e){var t=this;this._mediaAccess=this._deviceManager.useMedia(e),this._mediaAccess.on("streamChanged",function(){t._screenShare.isSharing&&t._mergeScreenShareStream(),t._dispatchEvent("streamChanged",t.localStream)}),this._mediaAccess.on("audioOutputChanged",function(){return t._dispatchEvent("audioOutputChanged")})}},{key:"_mergeScreenShareStream",value:function(){var e;this._screenShare.isSharing&&(e=new MediaStream,this._mediaAccess.stream&&0<this._mediaAccess.stream.getAudioTracks().length&&e.addTrack(this._mediaAccess.stream.getAudioTracks()[0]),e.addTrack(this.screenStream.getVideoTracks()[0]),this._mergedStream=e)}},{key:"_releaseMergedStream",value:function(){this._mergedStream&&(this._mergedStream.removeTrack(this._mergedStream.getAudioTracks()[0]),delete this._mergedStream,this._dispatchEvent("streamChanged",this.localStream))}}]),i}(),i_=function(){function i(e,t,n,r){_(this,i),this._liveEvent=e,this._sender=n,this._deviceManager=t,this._mediaOption=r}var t,n,r;return y(i,[{key:"mediaView",get:function(){return this._mediaView},set:function(e){this._mediaView!==e&&(this._mediaView&&(this._mediaView=null),e?this.isHostStream?this._mediaView=this._updateMediaViewStream(e,this.localStream):this._mediaView=this._updateMediaViewStream(e,this.stream):delete this._mediaView)}},{key:"localStream",get:function(){var e;return null==(e=this._localStream)?void 0:e.localStream}},{key:"stream",get:function(){var e;return null==(e=this._endpoint.pc)?void 0:e.remoteStream}},{key:"isHostStream",get:function(){return this._mediaOption}},{key:"_createLocalStream",value:function(){var e=this;this._localStream=new r_(this._deviceManager,{audio:!0,video:!0}),this._localStream.on("streamChanged",function(){e._onLocalStream()})}},{key:"_createEndpoint",value:function(){var e,t=this;return this.isHostStream?(this._localStream||this._createLocalStream(),new t_({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},this._localStream,"master",this._liveEvent.host.hostId)):(e=new t_({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},void 0,"viewer",this._liveEvent.currentLiveUser.participantId),this._unsubscriber=e.pc.on("remoteStream",function(e){t._onStream()}),e)}},{key:"openStream",value:function(){this._endpoint&&this._teardown(),this._endpoint=this._createEndpoint()}},{key:"closeStream",value:function(e){e&&this._endpoint.release(),this._teardown()}},{key:"attach",value:function(e){this._endpoint.attach(e)}},{key:"toggleAudio",value:function(t){var e;null!=(e=this.localStream.getAudioTracks())&&e.forEach(function(e){e.enabled=t}),this._mediaOption.turnAudioOn=t}},{key:"toggleVideo",value:function(t){var e;null!=(e=this.localStream.getVideoTracks())&&e.forEach(function(e){e.enabled=t}),this._mediaOption.turnVideoOn=t}},{key:"chooseMediaDevice",value:function(e,t){this._deviceManager.selectDevice(e,t)}},{key:"_onLocalStream",value:function(){this.toggleAudio(this._mediaOption.turnAudioOn),this.toggleVideo(this._mediaOption.turnVideoOn),this._mediaView&&this._updateMediaViewStream(this._mediaView,this.localStream)}},{key:"_onStream",value:function(){var e=this.stream;this._mediaView&&this._updateMediaViewStream(this._mediaView,e)}},{key:"_updateMediaViewStream",value:function(e,t){return t&&(e.srcObject=t),e}},{key:"_sendConnected",value:(r=v(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.isHostStream?Vl.createHostConnected(this._liveEvent.liveEventId,this._liveEvent.host.hostId,t.id):Vl.createConnected(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,t.id),e.abrupt("return",this._sender.send(n));case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_sendReleaseEndpoint",value:function(e){e=this.isHostStream?Vl.createHostDeleteStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,e.id):Vl.createDeleteStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id);return this._sender.sendWithRetry(e)}},{key:"_sendAttach",value:function(e,t){e=Vl.createAttach(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id,t);return this._sender.sendWithRetry(e)}},{key:"_sendCreateEndpoint",value:(n=v(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHostStream)return n=Vl.createHostCreateStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,t.sdp,"sendonly","sendonly"),e.abrupt("return",this._sender.send(n));e.next=5;break;case 5:return n=Vl.createStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,t.sdp,"recvonly","recvonly"),e.abrupt("return",this._sender.send(n));case 7:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_sendPutEndpoint",value:(t=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._sendCreateEndpoint(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_teardown",value:function(){var e;null!=(e=this._endpoint)&&e.exit(),(this._endpoint=null)!=(e=this._unsubscriber)&&e.call(this),this._unsubscriber=null}}]),i}(),s_=function(){g(p,Eh);var t,n,e,r,i,s,a,o,u,c,l,h,d,f=b(p);function p(e){var t,n=e.deviceManager,r=e.sender,i=e.sb,s=e.userId,e=e.info;return _(this,p),m(E(t=f.call(this)),"_customItemsUpdatedAt",0),t._deviceManager=n,t._sender=r,t._sb=i,t._userId=s,t._streams=new Map,t._customItems=null,e&&Object.assign(E(t),e),t._unsubscriber=t._sender.on("command",function(e){t._onEvent(e)}),t}return y(p,[{key:"customItems",get:function(){return x({},this._customItems)},set:function(e){this._customItems=e}},{key:"myRole",get:function(){return this.userIdsForHost.includes(this._userId)?D.LiveEventRole.HOST:D.LiveEventRole.PARTICIPANT}},{key:"isHost",get:function(){return this.myRole===D.LiveEventRole.HOST}},{key:"isActiveHost",get:function(){return this.isHost&&!!this.host}},{key:"duration",get:function(){return 0<this._duration?this._duration:Date.now()-this.startedAt},set:function(e){this._duration=e}},{key:"fetchOpenChannel",value:(d=v(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sb.openChannel.getChannelWithoutCache(this.liveEventId);case 2:return t=e.sent,t=this._sb.openChannel.buildOpenChannelFromSerializedData(t),this.openChannel=t,e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"_getOpenChannel",value:(h=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.openChannel)return e.abrupt("return",this.openChannel);e.next=2;break;case 2:return e.abrupt("return",this.fetchOpenChannel());case 3:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"enterAsHost",value:(l=v(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getOpenChannel();case 2:return n=e.sent,e.next=5,n.enter();case 5:return e.prev=5,e.next=8,this._sender.send(Vl.createEnterHost(this.liveEventId,t));case 8:r=e.sent,r=r.payload.host,this._streams.set(r.hostId,new i_(this,this._deviceManager,this._sender,t)),this.upsert({host:r}),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(5),e.next=18,n.exit();case 18:throw e.t0;case 19:this._startToSendAlive();case 20:case"end":return e.stop()}},e,this,[[5,14]])})),function(e){return l.apply(this,arguments)})},{key:"setEventReady",value:(c=v(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:return e.next=4,this._sender.send(Vl.createReady(this.liveEventId));case 4:t=e.sent,t=t.payload.liveEvent,this.upsert(t);case 7:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"startEvent",value:(u=v(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:return e.next=4,this._sender.send(Vl.createStart(this.liveEventId));case 4:n=e.sent,n=n.payload.liveEvent,this.upsert(n),this.isHostStreaming||this.startStreaming(t),this._toggleAudio(t.turnAudioOn),this._toggleVideo(t.turnVideoOn);case 10:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"startStreaming",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");var t=this._streams.get(this.host.hostId);t||(e=new i_(this,this._deviceManager,this._sender,e),this._streams.set(this.host.hostId,e)),t.openStream()}},{key:"endStreaming",value:function(){if(!this.isActiveHost)throw new Error("current host only action");var e=this._streams.get(this.host.hostId);e&&(this._streams.delete(this.host.hostId),e.closeStream(!0))}},{key:"exitAsHost",value:(o=v(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isActiveHost){e.next=2;break}throw new Error("current host only action");case 2:return t=this.host.hostId,e.next=5,this._sender.send(Vl.createExitHost(this.liveEventId,t));case 5:t=e.sent,n=t.payload.host,this.upsert({host:n}),this.teardown();case 9:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"endEvent",value:(a=v(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sender.send(Vl.createEndLiveEvent(this.liveEventId));case 2:t=e.sent,t=t.payload.liveEvent,this.upsert(t),this.teardown();case 6:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"muteAudioInput",value:function(){this._toggleAudio(!1)}},{key:"unmuteAudioInput",value:function(){this._toggleAudio(!0)}},{key:"_toggleAudio",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");this._streams.get(this.host.hostId).toggleAudio(e),this._sender.send(Vl.createAudio(this.liveEventId,this.host.hostId,e))}},{key:"stopVideo",value:function(){this._toggleVideo(!1)}},{key:"startVideo",value:function(){this._toggleVideo(!0)}},{key:"_toggleVideo",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");this._streams.get(this.host.hostId).toggleVideo(e),this._sender.send(Vl.createVideo(this.liveEventId,this.host.hostId,e))}},{key:"selectAudioInput",value:function(e){return this._deviceManager.selectDevice("audioinput",e)}},{key:"selectVideoInput",value:function(e){return this._deviceManager.selectDevice("videoinput",e)}},{key:"enter",value:(s=v(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getOpenChannel();case 2:return t=e.sent,e.next=5,t.enter();case 5:return e.prev=5,e.next=8,this._sender.send(Vl.createEnter(this.liveEventId));case 8:n=e.sent,n=n.payload.participant,this.upsert({currentLiveUser:n}),this._tryOpen(),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(5),e.next=18,t.exit();case 18:throw e.t0;case 19:this._startToSendAlive();case 20:case"end":return e.stop()}},e,this,[[5,14]])})),function(){return s.apply(this,arguments)})},{key:"exit",value:(i=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sender.send(Vl.createExit(this.liveEventId,this.currentLiveUser.participantId));case 2:e.sent.payload.participant,this.teardown();case 5:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"setVideoViewForLiveEvent",value:function(e,t){t=this._streams.get(t);t&&(t.mediaView=e)}},{key:"updateLiveEventInfo",value:(r=v(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Vl.updateLiveEvent(this.liveEventId,t.userIdsForHost,t.title,t.coverUrl,t.coverFile),e.next=3,this._sender.send(n);case 3:n=e.sent,r=n.payload.liveEvent,this.upsert(r);case 6:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"fetchCustomItems",value:(e=v(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Vl.createGetCustomItems(this.liveEventId),e.prev=1,e.next=4,this._sender.send(t);case 4:return t=e.sent,n=t.payload,this._setCustomItems(n.customItems),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),I.error("failed to update customItems"),e.t0;case 14:case"end":return e.stop()}},e,this,[[1,10]])})),function(){return e.apply(this,arguments)})},{key:"updateCustomItems",value:(n=v(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object.keys(t).some(function(e){return"string"!=typeof t[e]}))throw new Error("invalid parameter");e.next=2;break;case 2:return n=Vl.createUpdateCustomItems(this.liveEventId,t),e.prev=3,e.next=6,this._sender.send(n);case 6:return n=e.sent,r=n.payload,this._setCustomItems(r.customItems,r.updatedAt),e.abrupt("return",r);case 12:throw e.prev=12,e.t0=e.catch(3),I.error("failed to update customItems"),e.t0;case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return n.apply(this,arguments)})},{key:"deleteCustomItems",value:(t=v(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.some(function(e){return"string"!=typeof e}))throw new Error("invalid parameter");e.next=2;break;case 2:return n=Vl.createDeleteCustomItems(this.liveEventId,t),e.prev=3,e.next=6,this._sender.send(n);case 6:return n=e.sent,r=n.payload,this._setCustomItems(r.customItems,r.deletedAt),e.abrupt("return",r);case 12:throw e.prev=12,e.t0=e.catch(3),I.error("failed to delete customItems"),e.t0;case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return t.apply(this,arguments)})},{key:"upsert",value:function(e){Object.assign(this,e)}},{key:"teardown",value:function(){null!=(e=this.openChannel)&&e.exit();var e,t,n=G(this._streams.values());try{for(n.s();!(t=n.n()).done;)t.value.closeStream()}catch(e){n.e(e)}finally{n.f()}this._streams.clear(),this._stopToSendAlive(),this.upsert({currentLiveUser:void 0})}},{key:"_setCustomItems",value:function(e,t){return(void 0===t||t>this._customItemsUpdatedAt)&&(this._customItemsUpdatedAt=t,this._customItems=e||{},!0)}},{key:"_onEvent",value:function(e){if(this.liveEventId===e.payload.liveEventId)if(e instanceof fl)this._onReady(e);else if(e instanceof pl)this._onStarted(e);else if(e instanceof vl)this._onEnded(e);else if(e instanceof Ul)this._onUpdated(e);else if(e instanceof _l)this._onHostEntered(e);else if(e instanceof yl)this._onHostExited(e);else if(e instanceof ml)this._onHostConnected(e);else if(e instanceof Ll)this._onHostDisconnected(e);else if(e instanceof gl)this._onHostAudioStatusChanged(e);else if(e instanceof El)this._onHostVideoStatusChanged(e);else if(e instanceof bl)this._onParticipantEntered(e);else if(e instanceof Il)this._onParticipantExited(e);else if(e instanceof Hl)this._onUpdateCustomItems(e);else{if(!(e instanceof Gl))throw new Error("unknown event is received");this._onDeleteCustomItems(e)}}},{key:"_onReady",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventReady",this)}},{key:"_onStarted",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventStarted",this),this._tryOpen()}},{key:"_onEnded",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventEnded",this),this.teardown()}},{key:"_onUpdated",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventUpdated",this)}},{key:"_onHostEntered",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostEntered",this,this.host)}},{key:"_onHostExited",value:function(e){e=e.payload.host;this.upsert({host:void 0}),this._dispatchEvent("hostExited",this,e)}},{key:"_onHostConnected",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostConnected",this,this.host),this._tryOpen()}},{key:"_onHostDisconnected",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostDisconnected",this,this.host)}},{key:"_onHostAudioStatusChanged",value:function(e){e=e.payload.host;this.upsert({host:e}),e.isAudioOn&&this._dispatchEvent("hostUnmutedAudio",this,this.host),e.isAudioOn||this._dispatchEvent("hostMutedAudio",this,this.host)}},{key:"_onHostVideoStatusChanged",value:function(e){e=e.payload.host;this.upsert({host:e}),e.isVideoOn&&this._dispatchEvent("hostStartedVideo",this,this.host),e.isVideoOn||this._dispatchEvent("hostStoppedVideo",this,this.host)}},{key:"_onParticipantEntered",value:function(e){var e=e.payload,t=e.participant,n=e.participantCount,r=e.peakParticipantCount,e=e.cumulativeParticipantCount;this.upsert({participantCount:n,peakParticipantCount:r,cumulativeParticipantCount:e}),this._dispatchEvent("participantEntered",this,t)}},{key:"_onParticipantExited",value:function(e){var e=e.payload,t=e.participant,n=e.participantCount,r=e.peakParticipantCount,e=e.cumulativeParticipantCount;this.upsert({participantCount:n,peakParticipantCount:r,cumulativeParticipantCount:e}),this._dispatchEvent("participantExited",this,t)}},{key:"_onUpdateCustomItems",value:function(e){var e=e.payload,t=e.customItems,n=e.updatedAt;e.updatedKeys,this._setCustomItems(t,n)&&this._dispatchEvent("customItemsUpdated",t,n)}},{key:"_onDeleteCustomItems",value:function(e){var e=e.payload,t=e.customItems,n=e.deletedAt;e.deletedKeys,this._setCustomItems(t,n)&&this._dispatchEvent("customItemsDeleted",t,n)}},{key:"_tryOpen",value:function(){var e,t;this.host&&this.host.state===D.HostState.CONNECTED&&this.state===D.LiveEventState.ONGOING&&(e=this.host.hostId,this._streams.has(e)?t=this._streams.get(e):(t=new i_(this,this._deviceManager,this._sender),this._streams.set(e,t)),t.openStream(),t.attach(e))}},{key:"_tryClose",value:function(){}},{key:"_startToSendAlive",value:function(){var t=this;this.isActiveHost?this._aliveIntervalId=setInterval(function(){var e=Vl.createHostAlive(t.liveEventId,t.host.hostId);t._sender.send(e)},3e3):this._aliveIntervalId=setInterval(function(){var e=Vl.createAlive(t.liveEventId,t.currentLiveUser.participantId);t._sender.send(e)},9e4)}},{key:"_stopToSendAlive",value:function(){this._aliveIntervalId&&(clearInterval(this._aliveIntervalId),delete this._aliveIntervalId)}}]),p}(),a_=function(){function t(e){_(this,t),this._liveEvents=[],this._ctx=e}var n,r;return y(t,[{key:"createLiveEvent",value:(r=v(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Vl.createLiveEvent(Ye.SINGLE_HOST,t.userIdsForHost?[].concat(F(t.userIdsForHost),[this.userId]):[this.userId],t.title,t.coverUrl,t.coverFile),e.next=3,this._ctx.commandRouter.send(n);case 3:return n=e.sent,r=n.payload.liveEvent,r=new s_({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:r}),e.prev=6,e.next=9,r.fetchOpenChannel();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),I.error("failed to fetch initial open channel");case 14:return this._liveEvents.push(r),e.abrupt("return",r);case 16:case"end":return e.stop()}},e,this,[[6,11]])})),function(e){return r.apply(this,arguments)})},{key:"getLiveEvent",value:(n=v(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Vl.createGetLiveEvent(t),e.next=3,this._ctx.commandRouter.send(n);case 3:if(n=e.sent,r=n.payload.liveEvent,-1<(i=this._liveEvents.findIndex(function(e){return e.liveEventId===t})))return(s=this._liveEvents[i]).upsert(r),e.prev=9,e.next=12,s.fetchOpenChannel();e.next=20;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),I.error("failed to fetch initial open channel");case 17:return e.abrupt("return",s);case 20:return a=new s_({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:r}),e.prev=21,e.next=24,a.fetchOpenChannel();case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(21),I.error("failed to fetch initial open channel");case 29:return this._liveEvents.push(a),e.abrupt("return",a);case 31:case"end":return e.stop()}},e,this,[[9,14],[21,26]])})),function(e){return n.apply(this,arguments)})},{key:"clear",value:function(){this._liveEvents=[];var e,t=G(this._liveEvents);try{for(t.s();!(e=t.n()).done;)e.value.teardown()}catch(e){t.e(e)}finally{t.f()}}}]),t}(),o_=pe,u_=ye,c_=rt,l_=Ae,h_=TypeError,ci=Me,d_={left:Sv(!1),right:Sv(!0)}.left,i=gt,ri=ds,a=(ci({target:"Array",proto:!0,forced:!dc("reduce")||!ri&&79<i&&i<83},{reduce:function(e){var t=arguments.length;return d_(this,e,t,1<t?arguments[1]:void 0)}}),Me),f_=li.find,s=Ps,kt="find",p_=!0,hs=(kt in[]&&Array(1)[kt](function(){p_=!1}),a({target:"Array",proto:!0,forced:p_},{find:function(e){return f_(this,e,1<arguments.length?arguments[1]:void 0)}}),s(kt),function(){function n(e,t){_(this,n),this.key=e,this.value=t}return y(n,[{key:"toString",value:function(){return this.key}},{key:"equals",value:function(e){return this.value.width===e.value.width&&this.value.height===e.value.height}}]),n}()),v_=(m(hs,"_720P",new hs("_720P",{width:1280,height:720})),m(hs,"_540P",new hs("_540P",{width:960,height:540})),m(hs,"_480P",new hs("_480P",{width:848,height:480})),m(hs,"_360P",new hs("_360P",{width:640,height:360})),hs._720P),__=function(){g(i,Eh);var r=b(i);function i(e,t){var n;return _(this,i),m(E(n=r.call(this)),"hasPermission",!1),n._streamManger=e,n.constraints=t,n}return y(i,[{key:"stream",get:function(){return this._streamManger.stream}},{key:"dispose",value:function(){var e;this.removeAllEventListeners(),null!=(e=this.onDisposed)&&e.call(this)}},{key:"streamChanged",value:function(e){this._dispatchEvent("streamChanged",e)}},{key:"audioOutputChanged",value:function(){this._dispatchEvent("audioOutputChanged")}}]),i}(),y_=Ze,m_=we,g_=Ne,E_=zi,b_=ue,I_=ve,w_=Sh,T_=Ch;Th("match",function(r,o,u){return[function(e){var t=b_(this),n=null==e?void 0:I_(e,r);return n?y_(n,e,t):new RegExp(e)[r](E_(t))},function(e){var t=m_(this),n=E_(e),e=u(o,t,n);if(e.done)return e.value;if(!t.global)return T_(t,n);for(var r=t.unicode,i=[],s=t.lastIndex=0;null!==(a=T_(t,n));){var a=E_(a[0]);""===(i[s]=a)&&(t.lastIndex=w_(n,g_(t.lastIndex),r)),s++}return 0===s?null:i}]});function S_(e,t){var n,r,i,s,a;t.audio&&0===e.getAudioTracks().length&&e.addTrack((i=C_=C_||new(window.AudioContext||window.webkitAudioContext),k_=i.createOscillator(),n=i.createMediaStreamDestination(),(r=i.createGain()).gain.setValueAtTime(0,i.currentTime),k_.connect(r).connect(n),k_.start(),O_=n.stream.getAudioTracks()[0],n.stream.getAudioTracks()[0])),t.video&&0===e.getVideoTracks().length&&e.addTrack((i=x(x({},v_.value),{},{frameRate:24}),s=i.width,a=i.height,i=i.frameRate,(N_=N_||document.createElement("canvas")).width=s,N_.height=a,N_.getContext("2d").fillRect(0,0,s,a),A_=A_||setInterval(function(){N_.getContext("2d").fillRect(0,0,s,a)},1e3),i=N_.captureStream(i),R_=i.getVideoTracks()[0],i.getVideoTracks()[0]))}var C_,k_,N_,A_,O_,R_,Xe=te,Kt=et,D_=zi,M_=aa.trim,$e=Wn,x_=K.parseInt,Et=K.Symbol,L_=Et&&Et.iterator,P_=/^[+-]?0x/i,U_=Kt(P_.exec),Ft=8!==x_($e+"08")||22!==x_($e+"0x16")||L_&&!Xe(function(){x_(Object(L_))})?function(e,t){e=M_(D_(e));return x_(e,t>>>0||(U_(P_,e)?16:10))}:x_;Me({global:!0,forced:parseInt!=Ft},{parseInt:Ft});function q_(){O_&&O_.stop(),R_&&R_.stop(),R_=O_=null,A_&&(clearInterval(A_),A_=null),k_&&(k_.onended=function(){k_.disconnect(),k_=null},k_.stop())}function F_(e){if(e){var t,n=G(e.getTracks());try{for(n.s();!(t=n.n()).done;)t.value.stop()}catch(e){n.e(e)}finally{n.f()}}}function j_(e,t,n){return(e=e.match(t))&&e.length>=n&&parseInt(e[n],10)}var H_="safari"===function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;var t=window.navigator;if(t.mozGetUserMedia)e.browser="firefox",e.version=j_(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)e.browser="chrome",e.version=j_(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=j_(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=j_(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return e}().browser,G_=function(){function t(e){_(this,t),m(this,"_hasPermission",!1),this._deviceManager=e,this._updateQueued=!1}var e;return y(t,[{key:"updateStream",value:(e=v(regeneratorRuntime.mark(function e(){var t,n,r,i,s,a,o,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._updateAt)return this._updateQueued=!0,e.abrupt("return");e.next=3;break;case 3:if(t=this._deviceManager.mediaAccesses.some(function(e){return e.constraints.audio}),n=this._deviceManager.mediaAccesses.some(function(e){return e.constraints.video}),t||n){e.next=9;break}return F_(this.stream),q_(),e.abrupt("return");case 9:return this._updateAt=Date.now(),(r=this.stream)||(s=new MediaStream,S_(s,{audio:t,video:n}),this.stream=s),H_&&F_(r),e.prev=13,e.next=16,this._deviceManager.getMediaConstraints({usingAudio:t,usingVideo:n});case 16:return s=e.sent,e.next=19,navigator.mediaDevices.getUserMedia(s);case 19:i=e.sent,this._hasPermission=!0,a=G(this._deviceManager.mediaAccesses);try{for(a.s();!(o=a.n()).done;)o.value.hasPermission=!0}catch(e){a.e(e)}finally{a.f()}q_(),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),i=new MediaStream;case 29:S_(i,{audio:t,video:n}),H_||F_(r),this.stream=i,u=G(this._deviceManager.mediaAccesses);try{for(u.s();!(c=u.n()).done;)c.value.streamChanged(this.stream)}catch(e){u.e(e)}finally{u.f()}delete this._updateAt,this._updateQueued?(this._updateQueued=!1,this.updateStream()):this._deviceManager.refreshMediaDevices({audio:t,video:n},!0);case 36:case"end":return e.stop()}},e,this,[[13,26]])})),function(){return e.apply(this,arguments)})}]),t}();function V_(e,t){return(null==e?void 0:e.deviceId)===(null==t?void 0:t.deviceId)&&(null==e?void 0:e.label)===(null==t?void 0:t.label)&&(null==e?void 0:e.groupId)===(null==t?void 0:t.groupId)}var B_=function(){function t(){var e=this;_(this,t),this.mediaAccesses=[],this._availableMediaDevices={audioinput:[],audiooutput:[],videoinput:[]},this._currentMediaDevices={audioinput:void 0,audiooutput:void 0,videoinput:void 0},this._sendbirdCallListeners=new Map,this._streamManager=new G_(this),navigator.mediaDevices.ondevicechange=function(){return e._onDeviceChanged()}}var n,r,e,i;return y(t,[{key:"_onDeviceChanged",value:function(){0!==this.mediaAccesses.length&&this.refreshMediaDevices({audio:this.mediaAccesses.some(function(e){return e.constraints.audio}),video:this.mediaAccesses.some(function(e){return e.constraints.video})})}},{key:"addSendBirdCallListener",value:function(e,t){this._sendbirdCallListeners.set(e,t)}},{key:"removeSendBirdCallListener",value:function(e){this._sendbirdCallListeners.delete(e)}},{key:"removeAllSendBirdCallListener",value:function(){this._sendbirdCallListeners.clear()}},{key:"getCurrentAudioInputDevice",value:function(){return this._currentMediaDevices.audioinput}},{key:"getCurrentAudioOutputDevice",value:function(){return this._currentMediaDevices.audiooutput}},{key:"getCurrentVideoInputDevice",value:function(){return this._currentMediaDevices.videoinput}},{key:"getAvailableAudioInputDevices",value:function(){return this._availableMediaDevices.audioinput}},{key:"getAvailableAudioOutputDevices",value:function(){return this._availableMediaDevices.audiooutput}},{key:"getAvailableVideoInputDevices",value:function(){return this._availableMediaDevices.videoinput}},{key:"_updateStream",value:(i=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._streamManager.updateStream());case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_registerMediaAccess",value:function(e){var t=this;this.mediaAccesses.push(e),e.onDisposed=function(){return t.stopMedia(e)}}},{key:"useMedia",value:function(e){{if(e.audio||e.video)return e=new __(this._streamManager,e),this._registerMediaAccess(e),this._updateStream(),e;I.error(new Error("you should set true for at least 1 media type."))}}},{key:"stopMedia",value:function(e){this.mediaAccesses.splice(this.mediaAccesses.indexOf(e),1),this._updateStream()}},{key:"fetchMediaDevices",value:(e=v(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.reduce(function(e,t){return e[t.kind].push(t),e},{audioinput:[],audiooutput:[],videoinput:[]}));case 4:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"getMediaConstraints",value:(r=v(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.usingAudio,r=t.usingVideo,i={audio:!1,video:!1},e.next=4,this.fetchMediaDevices();case 4:return s=e.sent,a=s.audioinput,s=s.videoinput,n&&a.length&&(a=this.getCurrentAudioInputDevice(),i.audio={deviceId:null==a?void 0:a.deviceId}),r&&s.length&&(a=this.getCurrentVideoInputDevice(),i.video=x(x({deviceId:null==a?void 0:a.deviceId},v_.value),{},{frameRate:24})),e.abrupt("return",i);case 10:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_updateCurrentMediaDevice",value:function(e,t){var n,r=this._availableMediaDevices[e],i=this._currentMediaDevices[e],s=r.find(function(e){return e.deviceId===(null==t?void 0:t.deviceId)});return s||(I.warning("Selected device is unavailable. fallback to default device."),s=(null!=(n=s)?n:0<r.length)?r[0]:null),!V_(i,this._currentMediaDevices[e]=s)}},{key:"_onAudioOutputChanged",value:function(){var e,t=G(this.mediaAccesses);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.constraints.audio&&n.audioOutputChanged()}}catch(e){t.e(e)}finally{t.f()}}},{key:"selectDevice",value:function(e,t){t.kind!==e?I.error(new Error("Tried to select invalid device of type")):this._updateCurrentMediaDevice(e,t)&&("audioinput"!==e&&"videoinput"!==e||this._updateStream(),"audiooutput"===e&&this._onAudioOutputChanged())}},{key:"_updateAvailableDevices",value:function(e,t){var n,r,i,s=this._currentMediaDevices[e];if(!!function(e,t){if(e.length===t.length){for(var n=0;n<t.length;n++)if(!V_(e[n],t[n]))return;return 1}}(this._availableMediaDevices[e],t))return!1;this._availableMediaDevices[e]=t,s=this._updateCurrentMediaDevice(e,s);var a,o=G(this._sendbirdCallListeners.values());try{for(o.s();!(a=o.n()).done;){var u=a.value,c=this._currentMediaDevices[e];switch(e){case"audioinput":null!=(n=u.onAudioInputDeviceChanged)&&n.call(u,c,t);break;case"audiooutput":null!=(r=u.onAudioOutputDeviceChanged)&&r.call(u,c,t);break;case"videoinput":null!=(i=u.onVideoInputDeviceChanged)&&i.call(u,c,t)}}}catch(e){o.e(e)}finally{o.f()}return s}},{key:"refreshMediaDevices",value:(n=v(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.audio,r=t.video,i=1<l.length&&void 0!==l[1]&&l[1],n||r){e.next=4;break}throw new Error("at least one of the audio or video must be true");case 4:return e.next=6,this.fetchMediaDevices();case 6:o=e.sent,s=o.audioinput,a=o.audiooutput,o=o.videoinput,c=u=!1,n&&(u=this._updateAvailableDevices("audioinput",s),c=this._updateAvailableDevices("audiooutput",a)),r&&(u=this._updateAvailableDevices("videoinput",o)||u),!i&&u&&this._updateStream(),c&&this._onAudioOutputChanged();case 16:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]),t}(),K_="v1.0.0-beta.3",Q_=function(){function t(e){_(this,t),this._parse=e}return y(t,[{key:"parseToJson",value:function(e){try{return JSON.parse(e)}catch(e){return{}}}},{key:"validate",value:function(e){var t=e.cmd,n=e.request_id,e=e.call_type;return!!(n||t||e)}},{key:"parseCommand",value:function(e){return e.error?{isValid:!0,error:{requestId:e.request_id,message:e.message,code:e.code}}:{isValid:!0,command:this._parse(e)}}},{key:"parse",value:function(e){e=this.parseToJson(e);return this.validate(e)?this.parseCommand(e):{isValid:!1}}}]),t}(),z_=function(){g(r,Eh);var n=b(r);function r(e){var t;return _(this,r),(t=n.call(this))._ctx=e,t._ws=null,t._retryTimer=null,t._closed=!0,t._sessionKey=null,t._requestMap=new qv(t._getTimeoutTime()),t._messageParser=new Q_(t._ctx.parse),t._hostUrl=null!=(e=t._ctx.websocketHost)?e:"wss://ws-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",t._ctx.appId),t}return y(r,[{key:"connect",value:function(){var r=this;return new Promise(function(e,t){r._sessionKey||t(new Error("tried to connect to websocket server without auth")),r._ws=r._createWebSocket(),r._closed=!1,r._ws.onopen=function(){r._onOpen(),e(null)},r._ws.onmessage=function(e){var e=r._messageParser.parse(e.data),t=e.isValid,n=e.error,e=e.command;t&&(n?r._processError(n):r.processCommand(e))},r._ws.onerror=function(e){return r._onError(e)},r._ws.onclose=function(){r._onClose(),t(new Error("websocket connection failed"))}})}},{key:"_processError",value:function(e){var t=e.requestId,e=(e.code,e.message),t=this._requestMap.unregister(t);t&&t.reject(new Error(e))}},{key:"processCommand",value:function(e){this._dispatchEvent("command",e)}},{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._disconnect(),this._sessionKey=null}},{key:"_disconnect",value:function(){this._ws&&(this._closed=!0,this._removeRetryTimer(),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onerror=null,this._ws.onclose=null,this._ws.close(),this._requestMap.rejectAll(new Error("request failed due to websocket connection lost")),this._ws=null)}},{key:"isConnected",get:function(){return!!this._ws&&1===this._ws.readyState}},{key:"_onOpen",value:function(){}},{key:"_onError",value:function(e){}},{key:"_onClose",value:function(){this._startToReconnect()}},{key:"_createWebSocket",value:function(){var e="/?sbcall_session_token=".concat(encodeURIComponent(this._sessionKey),"&sbcall_client_id=").concat(encodeURIComponent(this._ctx.clientId),"&sendbird=").concat(encodeURIComponent(this._getVersion()));return new WebSocket(this._getHost()+e)}},{key:"_getVersion",value:function(){return"JS,".concat(this._getOsVersion(),",").concat(K_)}},{key:"_getHost",value:function(){return this._hostUrl}},{key:"_startToReconnect",value:function(){this._closed||this._retryTimer||(this._retryTimer=setTimeout(this._reconnect.bind(this),this._getRetryTime()))}},{key:"_reconnect",value:function(){this._removeRetryTimer(),this.connect().catch(function(){})}},{key:"_removeRetryTimer",value:function(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)}},{key:"_getTimeoutTime",value:function(){return 6e4}},{key:"_getRetryTime",value:function(){return 2e3}},{key:"_getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),r}(),W_=function(){function t(e){_(this,t),this._ctx=e,this._fetch=function(){var e;return(e=window).fetch.apply(e,arguments)},this._sessionKey=null,this._hostUrl=null!=(e=this._ctx.apiHost)?e:"https://api-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",this._ctx.appId)}var n;return y(t,[{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._sessionKey=null}},{key:"send",value:(n=v(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getApiOption){e.next=2;break}throw new Error("invalid api request ".concat(JSON.stringify(t)));case 2:if((n=t.getApiOption()).auth&&!this._sessionKey)throw new Error("tried to call private api without auth");e.next=5;break;case 5:return i=x({},n.headers),n.body instanceof FormData||(i["Content-Type"]="application/json"),i.SendBird="JS,".concat(this._getOsVersion(),",").concat(K_),i["SBCall-Client-Id"]=this._ctx.clientId,this._sessionKey&&(i["SBCall-Session-Token"]=this._sessionKey),e.next=12,this._fetch("".concat(this._getHost()).concat(n.path),{method:n.method,body:n.body instanceof FormData?n.body:JSON.stringify(n.body),headers:i});case 12:return r=e.sent,e.next=15,r.text();case 15:i=e.sent,s=null,e.prev=17,s=JSON.parse(i),e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(17),new Error("malformed data");case 24:if(r.ok){e.next=34;break}if(s.error)throw new Error("server error");e.next=29;break;case 29:if(500===r.status)throw new Error("internal server error");e.next=31;break;case 31:if(300<=r.status&&r.status<400)throw new Error("malformed data");e.next=33;break;case 33:throw new Error("request failed");case 34:if(e.prev=34,a=this._ctx.parseResponse(t,s))return e.abrupt("return",a);e.next=38;break;case 38:e.next=43;break;case 40:return e.prev=40,e.t1=e.catch(34),e.abrupt("return",s);case 43:return e.abrupt("return",s);case 44:case"end":return e.stop()}},e,this,[[17,21],[34,40]])})),function(e){return n.apply(this,arguments)})},{key:"_getHost",value:function(){return this._hostUrl}},{key:"_getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),t}(),Y_=function(e,t){return(Y_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Y_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var f=function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function re(e,a,o,u){return new(o=o||Promise)(function(n,t){function r(e){try{s(u.next(e))}catch(e){t(e)}}function i(e){try{s(u.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,i)}s((u=u.apply(e,a||[])).next())})}function ie(r,i){var s,a,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,a&&(o=2&t[0]?a.return:t[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,t[1])).done)return o;switch(a=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!((o=0<(o=u.trys).length&&o[o.length-1])||6!==t[0]&&2!==t[0])){u=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){u.label=t[1];break}if(6===t[0]&&u.label<o[1]){u.label=o[1],o=t;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(t);break}o[2]&&u.ops.pop(),u.trys.pop();continue}t=i.call(r,u)}catch(e){t=[6,e],a=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function se(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function X_(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function J_(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.defineProperty($_,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty($_,"SDK_VERSION",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty($_,"SDK_MAJOR_VERSION",{get:function(){return $_.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty($_,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty($_,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0});var d,Z_=$_;function $_(){}(r=d=d||{})[r.INVALID_TOKEN=400111]="INVALID_TOKEN",r[r.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",r[r.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",r[r.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",r[r.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",r[r.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",r[r.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",r[r.LOST_INSTANCE=700100]="LOST_INSTANCE",r[r.CONNECTION_RENEW=700102]="CONNECTION_RENEW",r[r.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",r[r.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",r[r.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",r[r.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",r[r.INVALID_PARAMETER=800110]="INVALID_PARAMETER",r[r.NETWORK_ERROR=800120]="NETWORK_ERROR",r[r.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",r[r.MALFORMED_DATA=800130]="MALFORMED_DATA",r[r.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",r[r.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",r[r.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",r[r.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",r[r.ACK_TIMEOUT=800180]="ACK_TIMEOUT",r[r.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",r[r.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",r[r.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",r[r.REQUEST_FAILED=800220]="REQUEST_FAILED",r[r.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",r[r.REQUEST_CANCELED=800240]="REQUEST_CANCELED",r[r.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",r[r.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",r[r.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",r[r.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",r[r.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED";function ey(e){return!(e instanceof p&&!e.shouldThrowOutside)}function ty(e,t){return e===t||(e=f({},e),t=f({},t),!(e.hasOwnProperty("messageId")&&t.hasOwnProperty("messageId")&&e.messageId!==t.messageId||e.hasOwnProperty("reqId")&&t.hasOwnProperty("reqId")&&e.reqId!==t.reqId||(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,t.hasOwnProperty("messageId")&&delete t.messageId,t.hasOwnProperty("reqId")&&delete t.reqId,JSON.stringify(e)!==JSON.stringify(t))))}function ny(e){return 0<e&&0<=cy.indexOf(e)}function ry(e,t){if((t=void 0===t?!1:t)&&null===e)return!0;if(!(t=c("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type)){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return t}function iy(e){var t=void 0===(t=e.encryption)?null:t,n=void 0===(n=e.store)?null:n,e=void 0===(e=e.localCacheEnabled)||e;this.nestdb=null,this.store=n,this.preference=new vy({store:n}),this.encryption=null!=t?t:py,this.localCacheEnabled=e}function sy(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}function ay(){}function w(t){var n={};return t&&Object.keys(t).forEach(function(e){void 0!==t[e]&&NaN!==t[e]&&null!==t[e]&&(n[e]=t[e])}),n}o(l,oy=Error),Object.defineProperty(l.prototype,"isInvalidTokenError",{get:function(){return this.code===d.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===d.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===d.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(l,"debugModeRequired",{get:function(){return new l({code:d.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"lostInstance",{get:function(){return new l({code:d.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"connectionRenew",{get:function(){return new l({code:d.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"invalidConnectionStateTransition",{get:function(){return new l({code:d.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"connectionRequired",{get:function(){return new l({code:d.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"connectionCanceled",{get:function(){return new l({code:d.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"invalidParameters",{get:function(){return new l({code:d.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"networkError",{get:function(){return new l({code:d.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"markAsReadAllRateLimitExceeded",{get:function(){return new l({code:d.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"queryInProgress",{get:function(){return new l({code:d.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"noAckTimeout",{get:function(){return new l({code:d.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"loginTimeout",{get:function(){return new l({code:d.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"connectionClosed",{get:function(){return new l({code:d.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"requestFailed",{get:function(){return new l({code:d.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"fileUploadCanceled",{get:function(){return new l({code:d.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"requestCanceled",{get:function(){return new l({code:d.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"sessionTokenRefreshFailed",{get:function(){return new l({code:d.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(l,"sessionTokenRequestFailed",{get:function(){return new l({code:d.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),l.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this};var T,oy,p=l,uy=[d.CONNECTION_REQUIRED,d.NETWORK_ERROR,d.ACK_TIMEOUT,d.WEBSOCKET_CONNECTION_CLOSED,d.WEBSOCKET_CONNECTION_FAILED,d.FILE_UPLOAD_CANCEL_FAILED,d.REQUEST_CANCELED,d.INTERNAL_SERVER_ERROR,d.RATE_LIMIT_EXCEEDED,d.UNKNOWN_SERVER_ERROR],cy=[d.WEBSOCKET_CONNECTION_CLOSED,d.WEBSOCKET_CONNECTION_FAILED,d.CONNECTION_REQUIRED],c=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||("string"!=typeof e?"object"==typeof e?ly(e,t):t instanceof e:typeof t===e)},ly=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||Object.values(e).includes(t)},hy=function(t,e,n){return!(!(n=void 0===n?!1:n)||null!=e)||Array.isArray(e)&&e.every(function(e){return c(t,e)})},dy=(Object.defineProperty(Sy.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){c("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(Sy.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){c("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(Sy.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){c("number",e)&&1e3<=e&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(Sy.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){c("number",e)&&5e3<=e&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),Sy),fy={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},py={encrypt:function(e){return e},decrypt:function(e){return e}},vy=(Ty.prototype._savePreferenceKeys=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:J_([],X_(this._preference.keys()),!1),generation:1})];case 1:return e.sent(),[2]}})})},Ty.prototype.init=function(u){var c;return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return this._keysAddress=u,[4,this._store.get(u)];case 1:t=null!=(c=e.sent())?c:[],e.label=2;case 2:e.trys.push([2,7,8,9]),n=se(t),r=n.next(),e.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._store.get(i)]);case 4:(s=e.sent())&&this._preference.set(i,s),e.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return s=e.sent(),a={error:s},[3,9];case 8:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 9:return[2]}})})},Ty.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,null!=(n=this._preference.get(t))?n:null]})})},Ty.prototype.set=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=!this._preference.has(n),[4,this._store.set({key:n,value:r,generation:1})];case 1:return e.sent(),this._preference.set(n,r),t?[4,this._savePreferenceKeys()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},Ty.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.remove(t)];case 1:return e.sent(),this._preference.delete(t),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},Ty.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.removeMany(J_([],X_(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},Ty),_y=(Object.defineProperty(wy.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),wy.prototype.clear=function(){this.authToken=null,this.sessionKey=null},wy),yy=(Iy.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},Iy.prototype.on=function(e,t){return this._register(e,-1,t)},Iy.prototype.once=function(e,t){return this._register(e,1,t)},Iy.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},Iy),my=(by.prototype.on=function(e,t){return new yy({container:this._container}).on(e,t)},by.prototype.once=function(e,t){return new yy({container:this._container}).once(e,t)},by.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var s=[];try{for(var a=se(i.keys()),o=a.next();!o.done;o=a.next()){var u=o.value,c=i.get(u);c.handler(t),0<c.occurence&&(c.occurence--,0===c.occurence&&s.push(u))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}s.forEach(function(e){return i.delete(e)})}},by),gy=(Ey.prototype.on=function(e){return this._dispatcher.on("event",e)},Ey.prototype.once=function(e){return this._dispatcher.once("event",e)},Ey.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},Ey);function Ey(){this._dispatcher=new my}function by(){this._container={}}function Iy(e){e=e.container;this._container={},this._container=e,this.key=sy()}function wy(){this.sessionKey=null,this.authToken=null}function Ty(e){e=e.store;this._preference=new Map,this._store=e}function Sy(e){var e=void 0===e?{}:e,t=e.useMemberInfoInMessage,t=void 0!==t&&t,n=e.typingIndicatorInvalidateTime,n=void 0===n?1e4:n,r=e.typingIndicatorThrottle,r=void 0===r?1e3:r,e=e.websocketResponseTimeout,e=void 0===e?1e4:e;this._useMemberInfoInMessage=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=t,this._typingIndicatorInvalidateTime=n,this._typingIndicatorThrottle=r,this._websocketResponseTimeout=e}function l(e){var t=e.code,t=void 0===t?0:t,e=e.message,e=oy.call(this,e)||this;return e.shouldThrowOutside=!1,e.name="SendbirdError",e.code=t,Object.setPrototypeOf(e,l.prototype),e}(It=T=T||{}).GET="GET",It.POST="POST",It.PUT="PUT",It.DELETE="DELETE";o(Fy,Ry=ay),Fy.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},Object.defineProperty(Fy.prototype,"query",{get:function(){var t=this,n=w(this.params);return"?".concat(Object.keys(n).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t.stringifyParams(n[e])))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(Fy.prototype,"payload",{get:function(){var r,i=this,s=w(this.params);return Object.keys(s).some(function(e){return ry(s[e])})?(r=new FormData,Object.keys(s).forEach(function(e){var t,n=s[e];ry(n)?r.append(e,n,null!=(t=n.name)?t:"filename"):r.append(e,i.stringifyParams(n))}),r):JSON.stringify(s)},enumerable:!1,configurable:!0});var Cy,ky,Ny,Ay,Oy,Ry,h=Fy,S=(o(qy,Oy=ay),Object.defineProperty(qy.prototype,"payload",{get:function(){return f({},this._payload)},enumerable:!1,configurable:!0}),qy.prototype.as=function(e){return new e(this._iid,this.payload)},qy),Dy=(o(Uy,Ay=ay),Uy),My=(o(Py,Ny=ay),Py),xy=(o(Ly,ky=ay),Ly);function Ly(e){var t=ky.call(this)||this;return t.statLog=e,t}function Py(){return null!==Ny&&Ny.apply(this,arguments)||this}function Uy(e){var t=Ay.call(this)||this;return t.requestId=e,t}function qy(e,t){var n=Oy.call(this)||this;return n._iid=e,n._payload=t,n}function Fy(){var e=null!==Ry&&Ry.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=sy(),e}(B=Cy=Cy||{}).WEBSOCKET_CONNECT="ws:connect",B.API_RESULT="api:result";function jy(){}nm.payloadify=function(e){return w({stat_type:e.type,ts:e.createdAt,data:w(e.data)})};var Hy,Gy,Vy,By,Ky=nm,Qy=(Object.defineProperty(tm.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",e=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(Z_.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(e)},enumerable:!1,configurable:!0}),tm.prototype._createHeader=function(e,t){void 0===t&&(t=null);var n=this._sdkState,r=n.appId,n=n.appVersion,n=f(f({},e.headers),{SendBird:"JS,".concat(Z_.OS_VERSION,",").concat(Z_.SDK_VERSION,",").concat(r).concat(n?",".concat(n):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(n["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(n["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(n["App-Id"]=r,n["Access-Token"]=this._auth.authToken),n},tm.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new xy(new Ky({type:Cy.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},tm.prototype.send=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:r=h.path,t=h.method,i=![T.GET,T.DELETE].includes(t),n=this._sdkState.api,n="".concat(n.host).concat(r).concat(i?"":h.query),r=i?h.payload:null,i=this._createHeader(h,r instanceof FormData?r:null),a=new AbortController,s=a.signal,this._abortControl.set(h.requestId,a),a=Date.now(),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(n,{method:t,body:r,headers:i,signal:s})];case 2:return[4,(o=e.sent()).json()];case 3:if(c=e.sent(),o.ok||o.redirected)return this._logger.debug("receive api response",h.requestId),this._statLogApiResult(h,a,null),[2,new S(this._iid,c)];throw c?(u=new p(c)).isSessionKeyExpiredError&&this._dispatcher.dispatch(new My):u=p.requestFailed,this._statLogApiResult(h,a,u),u;case 4:throw c=e.sent(),this._statLogApiResult(h,a,c),c instanceof p?(this._logger.debug("fail api request",c),c):"AbortError"===c.name?p.requestCanceled:(l=p.networkError,this._logger.debug("fail api request",l),l);case 5:return[2]}})})},tm.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},tm.prototype.cancelAll=function(){var e,t;try{for(var n=se(this._abortControl.values()),r=n.next();!r.done;r=n.next())r.value.abort()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},tm),zy=(o(em,By=ay),em.createFromRawMessage=function(e,t){var n=t.substring(0,4),r=null;try{r=JSON.parse(t.substring(4))}catch(e){n="NOOP"}finally{return new em(e,n,r)}},em.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},em.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},em),Wy=(o($y,Vy=ay),$y.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},$y),Yy=(o(Zy,Gy=Wy),Zy),Xy=(Object.defineProperty(Jy.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),Jy.prototype.ping=function(){var e,t=this,n=new Yy;try{var r=null!=(e=this.sdkState.websocket.pongTimeout)?e:5e3;this._pingTimeoutTimer=setTimeout(function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)},r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n},Jy.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},Jy.prototype.refreshTimer=function(){var e=this,t=(this._logger.debug("pinger.refreshTimer()"),null!=(t=this.sdkState.websocket.pingInterval)?t:15e3);this.stop(),this._pingTimer=setInterval(function(){e.ping()},t)},Jy.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},Jy.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},Jy);function Jy(e){var t=e.pingDelegate,n=e.sdkState,e=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=e}function Zy(){return Gy.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}function $y(e){var t=e.code,n=e.ackRequired,e=e.payload,e=void 0===e?null:e,r=this;return(r=Vy.call(this)||this).code=t,r.payload=e,r.requestId=null!=(t=r.payload.req_id)?t:sy(),r.ackRequired=n,r.payload.req_id=r.requestId,r}function em(e,t,n,r){void 0===r&&(r="");var i=this;return(i=By.call(this)||this)._iid=e,i.code=t,i.payload=n,i.requestId=n?null!=(e=n.req_id)?e:r:"",i}function tm(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,s=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on(function(e){e instanceof Dy&&s.cancel(e.requestId)}),this._logger=t}function nm(e){var t=e.type,n=e.data,e=e.ts,e=void 0===e?Date.now():e;this.type=t,this.createdAt=e,this.data=n}(Fn=Hy=Hy||{}).CONNECTING="CONNECTING",Fn.OPEN="OPEN",Fn.CLOSED="CLOSED";function rm(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}o(dm,am=my),Object.defineProperty(dm.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return Hy.CONNECTING;case 1:return Hy.OPEN}return Hy.CLOSED},enumerable:!1,configurable:!0}),dm.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach(function(e){e&&c("string",e)&&(e=zy.createFromRawMessage(t._iid,e),t._logger.debug("receive websocket event",e),"LOGI"===e.code?(e.payload&&!e.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",e)):"PONG"===e.code?t._pinger&&t._pinger.pong():"EXPR"===e.code?e.payload&&0<e.payload.expires_in&&t._dispatcher.dispatch(new My):"NOOP"!==e.code&&t.dispatch("message",e))})},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",p.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close")},this.lastActive=Date.now()},dm.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=jy,this._ws.onmessage=jy,this._ws.onerror=jy,this._ws.onclose=function(){e.dispatch("close")},this._ws.close(),this._ws=null)},dm.prototype.send=function(e){if(!this._ws)throw p.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},dm.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e)};var im,sm,am,om=dm,um=(o(hm,sm=ay),hm),cm=(lm.prototype._sendApiRequest=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(t)];case 1:return[2,e.sent()]}})})},lm.prototype._sendWebsocketRequest=function(s){return re(this,void 0,void 0,function(){var n,r,t,i=this;return ie(this,function(e){if(n=new rm,s.ackRequired){r=null,t=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),i._ackStateMap.has(s.requestId)&&(i._ackStateMap.delete(s.requestId),r&&(clearTimeout(r),r=null),e?(i._logger.debug("fail websocket request",e),n.reject(e)):(i._logger.debug("receive websocket ack",s.requestId),n.resolve(t)))};try{r=setTimeout(function(){return t(p.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(s.requestId,{resolve:function(e){return t(null,e)},reject:function(e){return t(e)}}),this.websocketClient.send(s)}catch(e){t(e)}}else try{this.websocketClient.send(s),n.resolve(null)}catch(e){n.reject(e)}return[2,n.promise]})})},lm.prototype.send=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t instanceof h?[4,this._sendApiRequest(t)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return t instanceof Wy?[4,this._sendWebsocketRequest(t)]:[3,4];case 4:throw p.invalidParameters}})})},lm.prototype.cancel=function(e){this.apiClient.cancel(e)},lm.prototype.cancelAll=function(){this.apiClient.cancelAll()},lm);function lm(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,s=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=t,this.apiClient=new Qy(e,{auth:n,sdkState:r,dispatcher:i,logger:t}),this.websocketClient=new om(e,{sdkState:r,dispatcher:i,logger:t}),this.websocketClient.on("message",function(e){var t;e.payload.unread_cnt&&s._dispatcher.dispatch(new um(e.payload.unread_cnt)),e.requestId?s._ackStateMap.has(e.requestId)&&(t=s._ackStateMap.get(e.requestId),"EROR"!==e.code?t.resolve(e):t.reject(new p({code:e.payload.code,message:e.payload.message}))):s._dispatcher.dispatch(e)}).on("close",function(){s._ackStateMap.forEach(function(e){e.reject(p.connectionClosed)}),s._ackStateMap.clear()})}function hm(e){var t=e.all,n=e.custom_types,e=e.ts,r=sm.call(this)||this;return r.all=t,r.customTypes=n,r.ts=e,r}function dm(e,t){var n=t.sdkState,r=t.dispatcher,t=t.logger,i=am.call(this)||this;return i._pinger=null,i.lastActive=0,i._iid=e,i._sdkState=n,i._dispatcher=r,i._logger=t,i._sdkState.websocket.pingerDisabled||(i._pinger=new Xy({pingDelegate:{send:function(e){return i.send(e)},error:function(e){return i.error(e)}},sdkState:i._sdkState,logger:t})),i}(e=im=im||{})[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.LOGOUT=6]="LOGOUT";function fm(t){return re(void 0,void 0,void 0,function(){return ie(this,function(e){return[2,new Promise(function(e){return setTimeout(e,t)})]})})}function pm(a,o,u){return void 0===u&&(u=new zm),re(void 0,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:t=0,n=null,r=function(e){return n=null!=(e=void 0===e?null:e)?e:new Error("Halted")},i=function(){t=0},e.label=1;case 1:if(!(-1===o||t<o))return[3,9];e.label=2;case 2:return e.trys.push([2,4,,8]),[4,a(r,i)];case 3:if(s=e.sent(),n)throw n;return[2,s];case 4:if(s=e.sent(),n)return[3,6];if(++t===o)throw s;return[4,fm(u.calcTimeout(t))];case 5:return e.sent(),[3,7];case 6:throw n;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})}function ae(n){re(void 0,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:if((t=e.sent())instanceof p)return t.throwOutside(),[3,3];throw t;case 3:return[2]}})})}function vm(e,t){return null!==(t=void 0===t?null:t)&&tg.set(e,t),null!=(t=tg.get(e))?t:""}function _m(e){this.emojiHash=(e=void 0===e?{}:e).emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[]}o(Og,qm=ay);var ym,mm,gm,Em,bm,Im,wm,Tm,Sm,Cm,km,Nm,Am,Om,Rm,Dm,Mm,xm,Lm,Pm,Um,qm,Fm,jm=Og,Hm=(Object.defineProperty(Ag.prototype,"isReady",{get:function(){return this._currentConnectionStateType===im.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(Ag.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===im.CONNECTING||this._currentConnectionStateType===im.RECONNECTING},enumerable:!1,configurable:!0}),Ag.prototype.send=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return i instanceof Wy?this.isReady?(this._logger.debug("send websocket request",i),[4,this.commandRouter.send(i)]):[3,2]:[3,4];case 1:case 5:return[2,e.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",i),t=new rm,this._lazyCallQueue.push({command:i,deferred:t,timeout:setTimeout(function(){return r.timeout(i.requestId)},1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),p.connectionRequired;case 3:return[3,7];case 4:return i instanceof h?this._auth.hasSession?(this._logger.debug("send api request",i),[4,this.commandRouter.send(i)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",i),t=new rm,this._lazyCallQueue.push({command:i,deferred:t,timeout:setTimeout(function(){return r.timeout(i.requestId)},1e4)}),[2,t.promise];throw n=p.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}})})},Ag.prototype.forceSend=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._logger.debug("send websocket request (forced)",t),[4,this.commandRouter.send(t)];case 1:return[2,e.sent()]}})})},Ag.prototype.timeout=function(t){this._logger.debug("timeout request",t);var e=this._lazyCallQueue.findIndex(function(e){return e.command.requestId===t});-1<e&&(this._lazyCallQueue[e].deferred.reject(p.connectionRequired),this._lazyCallQueue.splice(e,1))},Ag.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},Ag.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},Ag),Gm=(o(Ng,Um=h),Ng),Vm=(o(kg,Pm=Wy),kg),Bm=(o(Cg,Lm=S),Cg),Km=(o(Sg,xm=zy),Sg),Qm=(o(Tg,Mm=ay),Tg),zm=(wg.prototype.calcTimeout=function(){return 0},wg),Wm=(Ig.prototype.createRefreshWebsocketCommand=function(e){return new Vm({authToken:e,expiringSession:!0})},Ig.prototype._refreshSessionKey=function(a,o){return re(this,void 0,void 0,function(){var t,n,r,i,s=this;return ie(this,function(e){switch(e.label){case 0:if(this._currentConnectionStateType!==im.CONNECTED)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this.createRefreshWebsocketCommand(a),[4,this._requestQueue.forceSend(t)];case 2:if(t=e.sent(),r=t.as(Km),n=r.newKey,r=r.error)throw r;return this.auth.sessionKey=null!=n?n:this.auth.sessionKey,this._logger.debug("session refreshed"),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2];case 3:if(r=e.sent(),ey(r))throw r;return r.isSessionTokenExpiredError?(this._handleError(o),[2]):[3,4];case 4:return e.trys.push([4,6,,7]),i=new Gm({userId:this._sdkState.userId,authToken:a,expiringSession:!0}),[4,pm(function(n){return re(s,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(i)];case 1:return t=e.sent(),t=t.as(Bm).key,this.auth.sessionKey=t,[3,3];case 2:throw(t=e.sent()).isSessionTokenExpiredError&&n(p.sessionTokenRefreshFailed),t;case 3:return[2]}})})},3)];case 5:return e.sent(),this._logger.debug("session refreshed"),[3,7];case 6:return e.sent(),this._handleError(o),[2];case 7:return ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2]}})})},Ig.prototype._handleError=function(e){var t=this,n=p.sessionTokenRefreshFailed;ae(function(){return re(t,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionError(n),[2]})})}),e&&e.reject(n)},Ig.prototype.refresh=function(){return re(this,void 0,void 0,function(){var n,t,r,i=this;return ie(this,function(e){return this.handler?(n=new rm,t=function(e){e?(i._logger.debug("session refreshing.."),i.auth.authToken=e,i._refreshSessionKey(e,n)):(i._logger.debug("session closed"),ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionClosed(),[2]})})}),n.resolve())},r=function(){i._dispatcher.dispatch(new Qm);var t=p.sessionTokenRequestFailed;i.handler&&(ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionError(t),[2]})})}),n.reject(t))},this._logger.debug("session expired"),this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,n):ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionTokenRequired(t,r),[2]})})}),[2,n.promise]):[2]})})},Ig),Yt=(bg.prototype.run=function(e){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},bg.prototype.onConnect=function(e,t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},bg.prototype.onReconnect=function(e,t){return t.resetReconnectCount,re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},bg.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},bg.prototype.onLogout=function(e){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},bg),Ym=(o(Eg,Dm=Yt),Eg.prototype.run=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return t=r.sdkState.userId,r.logout(),ae(function(){return re(n,void 0,void 0,function(){return ie(this,function(e){return r.connectionHandlers.forEach(function(e){e.onDisconnected(t)}),[2]})})}),[4,r.changeState(new eg)];case 1:return e.sent(),[2]}})})},Eg),Xm=(o(gg,Rm=Yt),gg.prototype.run=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),this._autoReconnect?[4,t.changeState(new Jm)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},gg.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new $m({authToken:n}))];case 1:return e.sent(),[2]}})})},gg.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Jm)];case 1:return e.sent(),[2]}})})},gg.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Ym)];case 1:return e.sent(),[2]}})})},gg),Jm=(o(mg,Om=Yt),mg.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},mg.prototype.run=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s=this;return ie(this,function(e){switch(e.label){case 0:t=new rm,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectStarted()}),[2]})})}),e.label=1;case 1:return e.trys.push([1,4,,9]),r=a.sdkState.websocket,n=r.reconnectMaxRetry,r=r.reconnectRetryStrategy,[4,pm(function(n,r){return re(s,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this._haltConnect=n,this._resetConnect=r,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.connect()];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof p&&t.code===d.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},n,r)];case 2:return e.sent(),[4,a.changeState(new Zm)];case 3:return e.sent(),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectSucceeded()}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return i=e.sent(),ey(i)?[3,7]:!(i instanceof p)||i.code===d.CONNECTION_CANCELED?[3,6]:[4,a.changeState(new Xm({autoReconnect:!1}))];case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectFailed()}),this.flushCallbacks(i),[2]})})}),[3,8];case 7:throw i;case 8:return[3,9];case 9:return[2,t.promise]}})})},mg.prototype.onConnect=function(n,e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new rm,this._resetConnect&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},mg.prototype.onReconnect=function(n,e){var e=e.resetReconnectCount,r=void 0!==e&&e;return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new rm,this._resetConnect&&r&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},mg.prototype.onDisconnect=function(t,e){var n=e.error,r=void 0===n?null:n,n=e.autoReconnect,i=void 0===n||n;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=r?r:p.connectionCanceled),[4,t.changeState(new Xm({autoReconnect:i}))];case 1:return e.sent(),[2]}})})},mg.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,t.changeState(new Ym)];case 1:return e.sent(),[2]}})})},mg),Zm=(o(yg,Am=Yt),yg.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new Jm)];case 1:return e.sent(),[2]}})})},yg.prototype.onDisconnect=function(t,e){var n=e.autoReconnect;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Xm({autoReconnect:n}))];case 1:return e.sent(),[2]}})})},yg.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Ym)];case 1:return e.sent(),[2]}})})},yg),$m=(o(_g,Nm=Yt),_g.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},_g.prototype.run=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:t=new rm,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),e.label=1;case 1:return e.trys.push([1,4,,9]),[4,pm(function(n){return re(r,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this._haltConnect=n,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i.connect(this._authToken)];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof p&&t.code===d.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},i.sdkState.websocket.connectMaxRetry)];case 2:return e.sent(),[4,i.changeState(new Zm)];case 3:return e.sent(),ae(function(){return re(r,void 0,void 0,function(){return ie(this,function(e){return i.connectionHandlers.forEach(function(e){e.onConnected(i.sdkState.userId)}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return n=e.sent(),ey(n)?[3,7]:(i.disconnect(),!(n instanceof p)||n.code===d.CONNECTION_CANCELED?[3,6]:[4,i.changeState(new eg)]);case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(r,void 0,void 0,function(){return ie(this,function(e){return this.flushCallbacks(n),[2]})})}),[3,8];case 7:throw n;case 8:return[3,9];case 9:return[2,t.promise]}})})},_g.prototype.onConnect=function(e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new rm,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},_g.prototype.onDisconnect=function(t,e){var e=e.error,n=void 0===e?null:e;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=n?n:p.connectionCanceled),[4,t.changeState(new Ym)];case 1:return e.sent(),[2]}})})},_g.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,t.changeState(new Ym)];case 1:return e.sent(),[2]}})})},_g),eg=(o(vg,km=Yt),vg.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new $m({authToken:n}))];case 1:return e.sent(),[2]}})})},vg),tg=new Map,jn=(pg.payloadify=function(e){return e?{}:null},pg),ng="/".concat("v3","/users"),rg="/".concat("v3","/storage/file"),ig="/".concat("v3","/group_channels"),sg="/".concat("v3","/open_channels"),ag="/".concat("v3","/sdk/open_channels"),og="/".concat("v3","/search"),ug="/".concat("v3","/report"),cg="/".concat("v3","/emojis"),lg="/".concat("v3","/emoji_categories"),hg="/".concat("v3","/sdk/statistics"),dg=(o(fg,Cm=h),fg);function fg(e){var t=e.userId,e=e.metadata,n=Cm.call(this)||this;return n.method=T.POST,n.path="".concat(ng,"/").concat(t,"/metadata"),n.params={metadata:e},n}function pg(e){this._iid="",this._iid=e}function vg(){var e=null!==km&&km.apply(this,arguments)||this;return e.type=im.INITIALIZED,e.name="initialized",e}function _g(e){var e=e.authToken,t=Nm.call(this)||this;return t.type=im.CONNECTING,t.name="connecting",t._authToken="",t._haltConnect=null,t._callbacks=[],t._authToken=e,t}function yg(){var e=null!==Am&&Am.apply(this,arguments)||this;return e.type=im.CONNECTED,e.name="connected",e}function mg(){var e=null!==Om&&Om.apply(this,arguments)||this;return e.type=im.RECONNECTING,e.name="reconnecting",e._haltConnect=null,e._resetConnect=null,e._callbacks=[],e}function gg(e){var e=e.autoReconnect,t=Rm.call(this)||this;return t.type=im.DISCONNECTED,t.name="disconnected",t._autoReconnect=!1,t._autoReconnect=e,t}function Eg(){var e=null!==Dm&&Dm.apply(this,arguments)||this;return e.type=im.LOGOUT,e.name="logout",e}function bg(){this.type=im.NONE,this.name="none"}function Ig(e){var t=e.auth,n=e.sdkState,r=e.dispatcher,i=e.requestQueue,e=e.logger,s=this;this._currentConnectionStateType=im.INITIALIZED,this.auth=t,this._sdkState=n,this._dispatcher=r,this._requestQueue=i,this._logger=e,this._dispatcher.on(function(e){var t;e instanceof jm?(t=e.stateType,s._currentConnectionStateType=t):e instanceof My&&s.refresh()})}function wg(){}function Tg(){return null!==Mm&&Mm.apply(this,arguments)||this}function Sg(e,t,n){e=xm.call(this,e,"LOGI",n)||this;return e.error=null,e.newKey=n.new_key,e.error=n.error?new p(n.error):null,e}function Cg(e,t){e=Lm.call(this,e,t)||this,t=t.key;return e.key=t,e}function kg(e){var t=e.authToken,e=e.expiringSession;return Pm.call(this,{code:"LOGI",payload:{token:t,expiring_session:void 0===e||e?1:0},ackRequired:!0})||this}function Ng(e){var t=e.userId,n=e.authToken,e=e.expiringSession,e=void 0===e||e,r=Um.call(this)||this;return r.path="/users/".concat(t,"/session_key"),r.method=T.POST,r.params={token:n,expiring_session:!!e},r.requireAuth=!1,r}function Ag(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,a=this;this._currentConnectionStateType=im.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new cm(e,{auth:n,sdkState:r,dispatcher:i,logger:t}),this._auth=n,this._logger=t,this._dispatcher=i,this._dispatcher.on(function(e){if(e instanceof jm){e=e.stateType;switch(a._currentConnectionStateType=e){case im.CONNECTED:var t=a._lazyCallQueue;a._lazyCallQueue=[],t.forEach(function(s){return re(a,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:t=s.command,n=s.deferred,r=s.timeout,clearTimeout(r),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.send(t)];case 2:return r=e.sent(),n.resolve(r),[3,4];case 3:return i=e.sent(),n.reject(i),[3,4];case 4:return[2]}})})});break;case im.INITIALIZED:case im.DISCONNECTED:case im.LOGOUT:t=a._lazyCallQueue,a._lazyCallQueue=[],t.forEach(function(r){return re(a,void 0,void 0,function(){var t,n;return ie(this,function(e){return t=r.deferred,n=r.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(p.connectionClosed):t.reject(p.connectionRequired),[2]})})})}}})}function Og(e){var e=e.stateType,t=qm.call(this)||this;return t.stateType=e,t}o(function(e,t){return(e=Fm.call(this,e,t)||this).metadata=t,e},Fm=S),(Gn=ym=ym||{}).BASE="base",Gn.GROUP="group",Gn.OPEN="open",(nt=mm=mm||{}).OPERATOR="operator",nt.NONE="none",(mt=gm=gm||{}).BASE="base",mt.USER="user",mt.FILE="file",mt.ADMIN="admin",(ua=Em=Em||{}).ALL="",ua.USER="MESG",ua.FILE="FILE",ua.ADMIN="ADMM",(t=bm=bm||{}).USER="MESG",t.FILE="FILE",t.ADMIN="ADMM",(sa=Im=Im||{}).USERS="users",sa.CHANNEL="channel",(n=wm=wm||{}).ALL="all",n.NONE="none",n.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",(Jn=Tm=Tm||{}).DEFAULT="default",Jn.SUPPRESS="suppress",(Jt=Sm=Sm||{}).PENDING="pending",Jt.SCHEDULED="scheduled",Jt.SUCCEEDED="succeeded",Jt.FAILED="failed",Jt.CANCELED="canceled";function Rg(e){switch(e){case ym.GROUP:return ig;case ym.OPEN:return sg;default:return null}}function Dg(e){switch(e){case ym.GROUP:return"".concat(ug,"/group_channels");case ym.OPEN:return"".concat(ug,"/open_channels");default:return null}}function Mg(e,t,n){return e=jg(e.mentionType,e.mentionedUserIds,n),t=jg(t.mentionType,t.mentionedUserIds,n),!e&&t?1:e&&!t?-1:0}var xg,Lg,Pg,Ug,qg,Fg,jg=function(e,t,n){var r,i;switch(e){case Im.CHANNEL:return!0;case Im.USERS:if(t)try{for(var s=se(t),a=s.next();!a.done;a=s.next())if(a.value===n)return!0}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},Hg=(o(Xg,qg=h),Xg),Gg=(o(Yg,Ug=S),Yg),Vg=(o(Wg,Pg=h),Wg),Bg=(o(zg,Lg=S),zg),Kg=(o(Qg,xg=h),Qg);function Qg(e){var t=e.userId,e=e.metadataKey,n=xg.call(this)||this;return n.method=T.DELETE,n.path="".concat(ng,"/").concat(t,"/metadata/").concat(e),n}function zg(e,t){e=Lg.call(this,e,t)||this;return e.metadata=t,e}function Wg(e){var t=e.userId,n=e.metadata,e=e.upsert,r=Pg.call(this)||this;return r.method=T.PUT,r.path="".concat(ng,"/").concat(t,"/metadata"),r.params={metadata:n,upsert:e},r}function Yg(e,t){e=Ug.call(this,e,t)||this;return e.metaData=null!=t?t:{},e}function Xg(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metadata;return(t=qg.call(this)||this).method=T.POST,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:e,include_ts:!0},t}o(function(){return null!==Fg&&Fg.apply(this,arguments)||this},Fg=S);o(eE,Jg=h);var Jg,Zg,$g=eE;function eE(e){var e=e.userId,t=Jg.call(this)||this;return t.method=T.DELETE,t.path="".concat(ng,"/").concat(e,"/metadata"),t}o(function(){return null!==Zg&&Zg.apply(this,arguments)||this},Zg=S);function tE(e,t){return void 0===t&&(t=null),(e=JSON.parse(JSON.stringify(e)))._iid&&delete e._iid,t&&t(e),e}function nE(e,t){return void 0===t&&(t=null),e=JSON.parse(JSON.stringify(e)),t&&t(e),e}function C(t){return{do:function(e){t||e()},throw:function(e){if(!t)throw e}}}var rE;(rt=rE=rE||{}).ONLINE="online",rt.OFFLINE="offline",rt.NON_AVAILABLE="nonavailable";o(SE,lE=jn),SE.payloadify=function(e){return e?w(f(f({},lE.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null},Object.defineProperty(SE.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(vm(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),SE.prototype.serialize=function(){return tE(this)},SE.prototype._isValidMetaData=function(t){return!Array.isArray(t)&&0<Object.keys(t).length&&Object.keys(t).map(function(e){return t[e]}).every(function(e){return c("string",e)})},SE.prototype._applyMetaData=function(t,n){var r=this;void 0===n&&(n=!1),Object.keys(t).forEach(function(e){n?delete r.metaData[e]:r.metaData[e]=t[e]})},SE.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(this._isValidMetaData(r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new dg({userId:n.userId,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Gg).metaData,this._applyMetaData(n),[2,this.metaData]}})})},SE.prototype.updateMetaData=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(this._isValidMetaData(r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Vg({userId:n.userId,metadata:r,upsert:i}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Bg).metadata,this._applyMetaData(n),[2,this.metaData]}})})},SE.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)).throw(p.invalidParameters),n=N.of(this._iid),t=n.sdkState,n=n.requestQueue,t=new Kg({userId:t.userId,metadataKey:r}),[4,n.send(t)];case 1:return e.sent(),this._applyMetaData(((n={})[r]=!0,n),!0),[2,this.metaData]}})})},SE.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new $g({userId:n.userId}),[4,t.send(n)];case 1:return e.sent(),this.metaData={},[2]}})})};var iE,sE,aE,oE,uE,cE,lE,k=SE,hE=(o(TE,cE=ay),TE),dE=(wE.payloadify=function(e){return f(f({},k.payloadify(e.user)),{emoji_hash:e.appInfo.emojiHash,file_upload_size_limit:e.appInfo.uploadSizeLimit,application_attributes:e.appInfo.applicationAttributes,premium_feature_list:e.appInfo.premiumFeatureList,login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},wE.prototype.apply=function(){var t=this.reconnectInterval,n=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,e=N.of(this._iid);e.sdkState.websocket.pingInterval=1e3*this.pingInterval,e.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,e.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,e.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(e){return 0<e?1e3*Math.min(t*Math.pow(r,e-1),n):10}},e.appInfo=this.appInfo,e.sessionManager.currentUser=this.user,e.connectedAt=this.connectedAt,this.firstConnectedAt||(e.firstConnectedAt=this.connectedAt),e.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,e.concurrentCallLimit=this.concurrentCallLimit,e.backOffDelay=this.backOffDelay,e.dispatcher.dispatch(new hE({userProfile:this}))},wE),fE=(o(IE,uE=zy),IE.asError=function(e){return new IE(null,"LOGI",f({user_id:null,error:!0},e))},IE.prototype.applyTo=function(e){if(this.error)throw this.error;var t=N.of(e);if(!t)throw p.lostInstance;t.sessionManager.auth.sessionKey=this.key,vm(e,this.ekey),this.userProfile.apply()},IE),pE=(o(bE,oE=ay),bE),vE=(o(EE,aE=my),Object.defineProperty(EE.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),EE.prototype.changeState=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._currentState=t,this._dispatcher.dispatch(new jm({stateType:t.type})),this._logger.debug("connection state changes to ".concat(t.name)),[4,this._currentState.run(this)];case 1:return e.sent(),[2]}})})},EE.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,i=t.userId,t=t.extensions,s=this._sessionManager.auth,a=t.sb_syncmanager?"s".concat(t.sb_syncmanager):"",t=t.sb_uikit?"u".concat(t.sb_uikit):"",a="JS/c".concat(Z_.SDK_VERSION,"/").concat(a,"/").concat(t);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(Z_.OS_VERSION),"&sv=").concat(encodeURIComponent(Z_.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(s.hasSession?"&key=".concat(encodeURIComponent(s.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(a,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=1")},EE.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new pE(e))},EE.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new xy(new Ky({type:Cy.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},EE.prototype.connect=function(i){return void 0===i&&(i=""),re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){return t=this._url(i),n=new rm,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){r._loginTimer=null,r._dispatcher.dispatch(fE.asError(p.loginTimeout))},this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]})})},EE.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(fE.asError(p.connectionRenew))},EE.prototype.disconnect=function(){this._websocketClient.disconnect()},EE.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()},EE),_E=(Object.defineProperty(gE.prototype,"isConnected",{get:function(){return this._context.currentState.type===im.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(gE.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===im.CONNECTING||e.type===im.RECONNECTING},enumerable:!1,configurable:!0}),gE.prototype.connect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onConnect(this._context,t)];case 1:return e.sent(),[2]}})})},gE.prototype.reconnect=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},gE.prototype.resetAndReconnect=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},gE.prototype.background=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}})})},gE.prototype.disconnect=function(t){return void 0===t&&(t=null),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:t,autoReconnect:!0})];case 1:return e.sent(),[2]}})})},gE.prototype.logout=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}})})},gE),yE=(o(mE,sE=h),mE);function mE(e){var t=e.deviceId,e=e.statLogs,n=sE.call(this)||this;return n.method=T.POST,n.path="".concat(hg),n.params={device_id:t,log_entries:e.map(function(e){return Ky.payloadify(e)})},n}function gE(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.disableAutoReconnect,t=void 0!==t&&t,u=this;this._context=null,this._logger=o,this._context=new vE(e,{sdkState:n,connectionHandlers:r,sessionManager:i,websocketClient:s,dispatcher:a,logger:o}),t||s.on("close",function(){"foreground"===n.appState&&setTimeout(function(){u._logger.debug("try reconnect by websocket connection closed"),u.reconnect()},100)})}function EE(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.entryState,t=void 0===t?new eg:t,u=aE.call(this)||this;return u._currentState=null,u._loginTimer=null,u._connectingAt=0,u._connectionRequestQueue=[],u._iid=e,u.sdkState=n,u.connectionHandlers=r,u._sessionManager=i,u._websocketClient=s,u._dispatcher=a,u._logger=o,u._currentState=t,u._websocketClient.on("message",function(e){var t;"LOGI"===e.code&&(u._loginTimer&&(clearTimeout(u._loginTimer),u._loginTimer=null),(t=e.as(fE)).error?(t.error.isSessionKeyExpiredError&&u._dispatcher.dispatch(new My),u._connectionRequestQueue.forEach(function(e){return e.reject(t.error)}),u._statLogConnection(t.error)):(t.applyTo(u._iid),u._connectionRequestQueue.forEach(function(e){return e.resolve()}),e=t.userProfile,u._enableStatLog(e.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),u._statLogConnection(null)),u._connectionRequestQueue=[])}).on("close",function(){0<u._connectionRequestQueue.length&&(u._connectionRequestQueue.forEach(function(e){return e.reject(p.networkError)}),u._connectionRequestQueue=[],u._statLogConnection(p.networkError))}),u}function bE(e){var t=oE.call(this)||this;return t.enabled=e,t}function IE(e,t,n){var r=this;return(r=uE.call(this,e,t,n)||this).error=null,r.userProfile=new dE(e,n),r.key=n.key,r.ekey=null!=(t=n.ekey)?t:"",r.error=n.error?new p(n):null,r}function wE(e,t){this._iid=e,this.appInfo=new _m(t),this.user=new k(e,t),this.connectedAt=1e3*(null!=(e=t.login_ts)?e:0),this.firstConnectedAt=0,this.pingInterval=null!=(e=t.ping_interval)?e:15e3,this.pongTimeout=null!=(e=t.pong_timeout)?e:5e3,this.reconnectInterval=null!=(e=null==(e=t.reconnect)?void 0:e.interval)?e:3e3,this.reconnectMaxInterval=null!=(e=null==(e=t.reconnect)?void 0:e.max_interval)?e:6e4,this.reconnectRetryCount=null!=(e=null==(e=t.reconnect)?void 0:e.retry_cnt)?e:5,this.reconnectIntervalMultiple=null!=(e=null==(e=t.reconnect)?void 0:e.mul)?e:2,this.maxUnreadCountOnSuperGroup=null!=(e=t.max_unread_cnt_on_super_group)?e:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!=(e=t.concurrent_call_limit)?e:5,this.backOffDelay=null!=(e=t.back_off_delay)?e:100}function TE(e){var e=e.userProfile,t=cE.call(this)||this;return t.userProfile=e,t}function SE(e,t){var n=this;return(n=lE.call(this,e)||this).userId=null!=(e=null!=(e=t.guest_id)?e:t.user_id)?e:"",n.nickname=null!=(e=null!=(e=t.nickname)?e:t.name)?e:"",n.plainProfileUrl=null!=(e=null!=(e=t.profile_url)?e:t.image)?e:"",n.requireAuth=null!=(e=t.require_auth_for_profile_image)&&e,n.metaData=null!=(e=t.metadata)?e:{},n.connectionStatus=rE.NON_AVAILABLE,ly(rE,t.is_online)?n.connectionStatus=t.is_online:c("boolean",t.is_online)&&(n.connectionStatus=t.is_online?rE.ONLINE:rE.OFFLINE),n.isActive=null==(e=t.is_active)||e,n.lastSeenAt=null!=(e=t.last_seen_at)?e:null,n.preferredLanguages=t.preferred_languages?J_([],X_(t.preferred_languages),!1):null,n.friendDiscoveryKey=null!=(e=t.friend_discovery_key)?e:null,n.friendName=null!=(e=t.friend_name)?e:null,n}(gt=iE=iE||{})[gt.PENDING=0]="PENDING",gt[gt.ENABLED=1]="ENABLED",gt[gt.DISABLED=2]="DISABLED";Object.defineProperty(NE.prototype,"isEnabled",{get:function(){return this.enabledstate===iE.ENABLED},enumerable:!1,configurable:!0}),NE.prototype._save=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map(function(e){return Ky.payloadify(e)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},NE.prototype._flush=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(!this.isEnabled)return[3,7];if(this.isFlushing)return[3,7];this.isFlushing=!0,e.label=1;case 1:return e.trys.push([1,5,6,7]),0<(t=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length?(n=new yE({deviceId:this.deviceId,statLogs:t}),[4,this.requestQueue.send(n)]):[3,4];case 2:return e.sent(),this.queue=this.queue.slice(t.length),[4,this._save()];case 3:e.sent(),e.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return e.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return[2]}})})},NE.prototype.init=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.key=r,this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.get(this.key)]:[3,4];case 1:return(t=e.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map(function(e){return new Ky({type:e.stat_type,ts:e.ts,data:e.data})}),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,108e5<=Date.now()-this.lastFlushedAt&&this.queue.length>=this.minLimit?(t=Math.min(Math.floor(18e4*Math.random()),100),[4,fm(t)]):[3,4]):[3,4];case 2:return e.sent(),[4,this._flush()];case 3:e.sent(),e.label=4;case 4:return this.dispatcher.on(function(e){var t;e instanceof xy?(t=e.statLog,n.put(t)):e instanceof pE&&(n.enabledstate=e.enabled?iE.ENABLED:iE.DISABLED,n.isEnabled?n.queue.length>=n.limit&&n._flush():n.clear())}),[2]}})})},NE.prototype.put=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.enabledstate===iE.DISABLED?[3,3]:(this.queue.push(t),[4,this._save()]);case 1:return e.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},NE.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})};var CE,kE=NE;function NE(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,i=e.baseLimit,i=void 0===i?100:i,s=e.maxLimit,s=void 0===s?1e3:s,e=e.minLimit,e=void 0===e?10:e;this.queue=[],this.enabledstate=iE.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=sy(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=i,this.limit=i,this.maxLimit=s,this.minLimit=e}(ds=CE=CE||{})[ds.NONE=0]="NONE",ds[ds.VERBOSE=1]="VERBOSE",ds[ds.DEBUG=2]="DEBUG",ds[ds.INFO=3]="INFO",ds[ds.WARN=4]="WARN",ds[ds.ERROR=5]="ERROR";VE.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=CE.VERBOSE&&console.log.apply(console,J_(["[verbose]"],X_(e),!1))},VE.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=CE.DEBUG&&console.log.apply(console,J_(["[debug]"],X_(e),!1))},VE.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=CE.INFO&&console.log.apply(console,J_(["[info]"],X_(e),!1))},VE.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=CE.WARN&&console.warn.apply(console,J_(["[warn]"],X_(e),!1))},VE.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=CE.ERROR&&console.error.apply(console,J_(["[error]"],X_(e),!1))};var AE,OE,RE,DE,ME=VE,xE={},N=(GE.of=function(e){if(xE[e])return xE[e];throw p.lostInstance},GE),ci=(HE.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,t=(t.onlineDetector,t.cacheContext),t=void 0===t?null:t;this._iid=e,this._cacheContext=t,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=s,this._logger=a},HE),LE=(o(jE,DE=h),jE),PE=(o(FE,RE=S),FE),UE=(o(qE,OE=jn),qE.payloadify=function(e){return e?w(f(f({},OE.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(e){return k.payloadify(e)}):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null},qE);function qE(e,t){var n=this;return(n=OE.call(this,e)||this).replyCount=0,n.mostRepliedUsers=null,n.lastRepliedAt=0,n.updatedAt=0,n.replyCount=null!=(e=t.reply_count)?e:0,n.mostRepliedUsers=t.hasOwnProperty("most_replies")&&hy("object",t.most_replies)?t.most_replies.map(function(e){return new k(n._iid,e)}):[],n.lastRepliedAt=null!=(e=t.last_replied_at)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,n}function FE(e,t){var n=this;return(n=RE.call(this,e,t)||this).url=t.url,n.fileSize=null!=(e=t.file_size)?e:0,n.thumbnailSizes=null!=(e=t.thumbnails)?e:[],n.requireAuth=null!=(e=t.require_auth)&&e,n}function jE(e){var t=DE.call(this)||this;if(t.method=T.POST,t.path="".concat(rg),t.params=w({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var n=0;n<e.thumbnailSizes.length;n++){var r=e.thumbnailSizes[n],i=r.maxWidth,r=r.maxHeight;t.params["thumbnail".concat(n+1)]="".concat(i,",").concat(r)}return t.requestId=e.requestId,t}function HE(){}function GE(e,t){var n,r,i,s;return this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,xE[e]||(xE[e]=this,n=null!=(n=t.options)?n:new dy,r=this.sdkState={appId:t.appId,appVersion:null!=(r=t.appVersion)?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!=(r=t.apiHost)?r:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!=(r=t.websocketHost)?r:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new zm,responseTimeout:n.websocketResponseTimeout}},this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0},i=this.logger=new ME,this.logger.level=null!=(s=t.logLevel)?s:CE.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new iy({encryption:t.encryption,store:t.store,localCacheEnabled:null!=(s=t.localCacheEnabled)&&s}),this.debugMode=null!=(s=t.debugMode)&&s,this.maxSuperGroupChannelUnreadCount=Z_.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=n.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=n.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=n.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null,t=this.dispatcher=new gy,s=new _y,this.requestQueue=new Hm(e,{auth:s,sdkState:r,dispatcher:t,logger:i}),this.sessionManager=new Wm({auth:s,sdkState:r,dispatcher:t,requestQueue:this.requestQueue,logger:i}),this.connectionManager=new _E(e,{sdkState:r,connectionHandlers:this.connectionHandlers,dispatcher:t,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,logger:i}),this.statLogCollector=new kE({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:t})),xE[e]}function VE(){this.level=CE.WARN}(ri=AE=AE||{}).ADD="add",ri.DELETE="delete";function BE(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=c("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,e=e.updated_at;t&&c("string",n)&&c("string",r)&&ly(AE,r)&&c("string",i)&&i&&c("number",e)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=e)}Object.defineProperty(t0.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),t0.payloadify=function(e){return e?w({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},t0.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case AE.ADD:t<0&&this.userIds.push(e.userId);break;case AE.DELETE:0<=t&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}};var KE,QE=t0,zE=(e0.payloadify=function(e){return e?w({key:e.key,value:null!=(e=e.value)?e:[]}):null},e0),WE=($E.payloadify=function(e){var t;return e?w({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!=(t=e.width)?t:0,height:null!=(t=e.height)?t:0,alt:e.alt}):null},$E),YE=(ZE.payloadify=function(e){return e?w({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?WE.payloadify(e.defaultImage):null}):null},ZE),XE=(JE.payloadify=function(e){return e?w({name:e.name,volume:e.volume}):null},JE);function JE(e){var t;this.name=null,this.volume=0,this.name=null!=(t=e.name)?t:"default",this.volume=null!=(t=e.volume)?t:1}function ZE(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new WE(e["og:image"]))}function $E(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}function e0(e){this.key=e.key,this.value=hy("string",e.value)?J_([],X_(e.value),!1):[]}function t0(e){var t,n,r=e.key,i=null!=(i=J_([],X_(e.user_ids),!1))?i:[],s=e.updated_at,a=(c("string",r)&&r&&hy("string",i)&&0<i.length&&c("number",s)&&(this.key=r,this.userIds=i,this.updatedAt=s),{});try{for(var o=se(this.userIds),u=o.next();!u.done;u=o.next())a[u.value]=this.updatedAt}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._version=a}(i=KE=KE||{}).PENDING="pending",i.IN_QUEUE="in_queue",i.SENT="sent",i.FAILED="failed",i.CANCELED="canceled",i.REMOVED="removed";function n0(e){return c("number",e.prevResultSize)&&c("number",e.nextResultSize)&&c("boolean",e.isInclusive)&&c("boolean",e.reverse)&&c("string",e.messageTypeFilter)&&ly(Em,e.messageTypeFilter)&&hy("string",e.customTypesFilter,!0)&&hy("string",e.senderUserIdsFilter,!0)&&c("boolean",e.includeMetaArray)&&c("boolean",e.includeReactions)&&c("boolean",e.includeParentMessageInfo)}o(j0,f0=jn),j0.payloadify=function(e){var t;return e?w(f(f({},f0.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:function(e){switch(e){case gm.BASE:return"";case gm.USER:return"MESG";case gm.FILE:return"FILE";case gm.ADMIN:return"ADMM"}}(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null==(t=e.mentionedUsers)?void 0:t.map(function(e){return k.payloadify(e)}),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?UE.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(e){return QE.payloadify(e)}),sorted_metaarray:null==(t=e.metaArrays)?void 0:t.map(function(e){return zE.payloadify(e)}),og_tag:YE.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:XE.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null==(t=e.scheduledInfo)?void 0:t.scheduledMessageId,scheduled_at:null==(t=e.scheduledInfo)?void 0:t.scheduledAt,scheduled_status:e._scheduledStatus})):null},j0.prototype.isIdentical=function(e){return this.messageId===e.messageId},j0.prototype.isEqual=function(e){return ty(this,e)},j0.prototype.isUserMessage=function(){return this.messageType===gm.USER},j0.prototype.isFileMessage=function(){return this.messageType===gm.FILE},j0.prototype.isAdminMessage=function(){return this.messageType===gm.ADMIN},j0.prototype.serialize=function(){return tE(this)},j0.prototype.getMetaArraysByKeys=function(t){return this.metaArrays.filter(function(e){return t.includes(e.key)})},j0.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},j0.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new QE(QE.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},j0.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1};var r0,i0,s0,a0,o0,u0,c0,l0,h0,d0,f0,p0=j0,v0=(o(F0,d0=k),F0.payloadify=function(e){return e?w(f(f({},d0.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null},F0),_0=(o(q0,h0=p0),q0.payloadify=function(e){return e?w(f(f({},h0.payloadify.call(this,e)),{user:v0.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null},Object.defineProperty(q0.prototype,"isResendable",{get:function(){return this.sendingStatus===Sm.FAILED&&0<(e=this.errorCode)&&0<=uy.indexOf(e);var e},enumerable:!1,configurable:!0}),q0.prototype.isIdentical=function(e){return 0<this.messageId&&0<e.messageId?this.messageId===e.messageId:this.reqId===e.reqId},q0),y0=(U0.payloadify=function(e){return e?w({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(U0.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),U0),m0={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Em.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},g0=(o(P0,l0=p0),P0.payloadify=function(e){return e?w(f(f({},l0.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:I0(e.parentMessage)})):null},P0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},m0),n),C(0<this.messageId&&c("number",t)&&n0(n)).throw(p.invalidParameters),[4,Ib.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},P0),E0=(L0.payloadify=function(e){return e?w({type:e.type,vendor:e.vendor,detail:e.detail}):null},L0),b0=(o(x0,c0=_0),x0.payloadify=function(e){return e?w(f(f({},c0.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(e){return E0.payloadify(e)}),parent_message_info:I0(e.parentMessage)})):null},x0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},m0),n),C(0<this.messageId&&c("number",t)&&n0(n)).throw(p.invalidParameters),[4,Ib.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},x0),I0=function(e){if(e)switch(e.messageType){case gm.USER:return b0.payloadify(e);case gm.FILE:return T0.payloadify(e);case gm.ADMIN:return g0.payloadify(e)}return null},w0=function(e,t){switch(t.type){case"MESG":return new b0(e,t);case"FILE":return new T0(e,t);case"ADMM":case"BRDM":return new g0(e,t)}return null},T0=(o(M0,u0=_0),M0.payloadify=function(e){return e?w(f(f({},u0.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map(function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:I0(e.parentMessage)})):null},Object.defineProperty(M0.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(vm(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),M0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},m0),n),C(0<this.messageId&&c("number",t)&&n0(n)).throw(p.invalidParameters),[4,Ib.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},M0),S0=(o(D0,o0=Wy),D0),C0=(o(R0,a0=h),R0),k0=(o(O0,s0=zy),O0),N0=(o(A0,i0=S),A0);function A0(e,t){var n,r=this,e=((r=i0.call(this,e,t)||this).message=new T0(e,t),N.of(e).sdkState);return r.isMentioned=jg(r.message.mentionType,null!=(n=r.message.mentionedUserIds)?n:r.message.mentionedUsers.map(function(e){return e.userId}),e.userId),r.forceUpdateLastMessage=null!=(n=t.force_update_last_message)&&n,r}function O0(e,t,n){var r,i=this,e=((i=s0.call(this,e,"FILE",n)||this).message=new T0(e,n),N.of(e).sdkState);return i.isMentioned=jg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function R0(e){var t=this,t=a0.call(this)||this,n=[];return e.mentionType===Im.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),t.method=T.POST,t.path="".concat(Rg(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),t.params=w({message_type:gm.FILE,user_id:e.userId,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:n,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes.map(function(e){return y0.payloadify(e)}),require_auth:e.requireAuth,sorted_metaarray:null==(n=e.metaArrays)?void 0:n.map(function(e){return zE.payloadify(e)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:XE.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,req_id:e.reqId}),t}function D0(e){var t,n=[];return e.mentionType===Im.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),o0.call(this,{code:"FILE",ackRequired:!0,payload:w({channel_url:e.channelUrl,url:e.url,name:null!=(t=e.fileName)?t:"",type:null!=(t=e.mimeType)?t:"",size:null!=(t=e.fileSize)?t:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==Tm.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function M0(e,t){var n,r=this,i=((r=u0.call(this,e,t)||this).messageParams=null,r.plainUrl="",r.requireAuth=!1,r.name=null,r.size=0,r.type=null,r.thumbnails=[],r.messageSurvivalSeconds=-1,r.messageType=gm.FILE,null!=(i=t.file)?i:null);return r.plainUrl=(null!=(n=null!=(n=null==i?void 0:i.url)?n:t.url)?n:"").split("?auth=")[0],r.name=null!=(n=null!=(n=null==i?void 0:i.name)?n:t.name)?n:"File",r.size=null!=(n=null!=(n=null==i?void 0:i.size)?n:t.size)?n:0,r.data=null!=(n=null!=(n=null==i?void 0:i.data)?n:t.custom)?n:"",r.type=i?null!=(n=i.type)?n:"":null!=(i=t.type)?i:"",r.requireAuth=null!=(n=t.require_auth)&&n,r.thumbnails=t.thumbnails?t.thumbnails.map(function(e){return new y0(f(f({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(r.requireAuth?"?auth=".concat(vm(r._iid)):"")}))}):[],r.messageSurvivalSeconds=null!=(i=t.message_survival_seconds)?i:-1,t.parent_message_info&&(n=t.parent_message_info,i=f(f({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(i=n.file)?void 0:i.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=w0(e,i)),r}function x0(e,t){var n,r,i,s=this;if((s=c0.call(this,e,t)||this).message="",s.messageParams=null,s.translations={},s.translationTargetLanguages=[],s.messageSurvivalSeconds=-1,s.plugins=[],s.message=t.message,s.messageType=gm.USER,s.translations=null!=(r=t.translations)?r:{},s.translationTargetLanguages=null!=(r=t.target_langs)?r:[],s.translations==={}&&0<s.translationTargetLanguages.length)try{for(var a=se(s.translationTargetLanguages),o=a.next();!o.done;o=a.next()){var u=o.value;s.translations[u]=""}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s.messageSurvivalSeconds=null!=(r=t.message_survival_seconds)?r:-1,s.plugins=t.plugins?t.plugins.map(function(e){return new E0(e)}):[],t.parent_message_info&&(i=t.parent_message_info,t=f(f({},i),{created_at:i.ts,message_id:s.parentMessageId,channel_url:s.channelUrl,channel_type:s.channelType,file:i.file,url:null==(n=i.file)?void 0:n.url,require_auth:null==(r=i.file)?void 0:r.require_auth}),s.parentMessage=w0(e,w(t))),s}function L0(e){var t;this.type=null,this.vendor=null,this.detail={},this.type=null!=(t=e.type)?t:"",this.vendor=null!=(t=e.vendor)?t:"",e.hasOwnProperty("detail")&&c("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}function P0(e,t){var n,r=this;return(r=l0.call(this,e,t)||this).message=null,r.translations={},r.message=null!=(n=t.message)?n:"",r.messageType=gm.ADMIN,r.translations=null!=(n=t.translations)?n:{},t.parent_message_info&&(n=t.parent_message_info,n=f(f({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(t=n.file)?void 0:t.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=w0(e,n)),r}function U0(e){var t;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!=(t=e.real_width)?t:e.width,this.realHeight=null!=(t=e.real_height)?t:e.height}function q0(e,t){var n=this;if((n=h0.call(this,e,t)||this).sender=null,n.reqId="",n.replyToChannel=!1,n.sendingStatus=null,n.errorCode=0,n.sender=t.user?new v0(n._iid,t.user):t.sender_id,n.reqId=null!=(e=null!=(e=t.req_id)?e:t.request_id)?e:"",n.replyToChannel=null!=(e=t.is_reply_to_channel)&&e,t.request_state&&ly(Sm,t.request_state)&&(n.sendingStatus=t.request_state),!n.sendingStatus)if(0<n.messageId)n.sendingStatus=Sm.SUCCEEDED;else if(n.scheduledInfo)switch(n._scheduledStatus=t.scheduled_status,t.scheduled_status){case KE.SENT:case KE.IN_QUEUE:n.sendingStatus=Sm.SUCCEEDED;break;case KE.PENDING:n.sendingStatus=Sm.SCHEDULED;break;case KE.FAILED:case KE.REMOVED:n.sendingStatus=Sm.FAILED;break;case KE.CANCELED:n.sendingStatus=Sm.CANCELED}else n.sendingStatus=Sm.PENDING;return n.errorCode=null!=(e=t.error_code)?e:0,n}function F0(e,t){e=d0.call(this,e,t)||this;return e.role=null,e.isBlockedByMe=!1,e.role=ly(mm,t.role)?t.role:mm.NONE,t.hasOwnProperty("is_blocked_by_me")&&(e.isBlockedByMe=t.is_blocked_by_me),e}function j0(e,t){var n=this,e=((n=f0.call(this,e)||this).channelUrl=null,n.channelType=ym.BASE,n.messageId=0,n.parentMessageId=null,n.parentMessage=null,n.silent=!1,n.isOperatorMessage=!1,n.messageType=gm.BASE,n.data=null,n.customType=null,n.mentionType=null,n.mentionedUsers=[],n.mentionedUserIds=[],n.mentionedMessageTemplate=null,n.threadInfo=null,n.reactions=[],n.metaArrays=[],n.ogMetaData=null,n.appleCriticalAlertOptions=null,n.createdAt=0,n.updatedAt=0,n.scheduledInfo=null,n._scheduledStatus=null,n.messageId=null!=(e=null!=(e=t.msg_id)?e:t.message_id)?e:0,n.channelUrl=t.channel_url,n.channelType=ly(ym,t.channel_type)?t.channel_type:ym.GROUP,t.channel&&(t.channel.channel_url&&(n.channelUrl=t.channel.channel_url),t.channel.channel_type&&(n.channelType=t.channel.channel_type)),n.parentMessageId=null!=(e="string"==typeof t.parent_message_id?parseInt(t.parent_message_id):t.parent_message_id)?e:0,n.data=null!=(e=t.data)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.mentionType=ly(Im,t.mention_type)?t.mention_type:null,t.mentioned_users),e=(n.mentionedUsers=e?e.map(function(e){return new k(n._iid,e)}):null,t.mentioned_user_ids);n.mentionedUserIds=null!=e?e:null,n.mentionedMessageTemplate=null!=(e=t.mentioned_message_template)?e:"",n.threadInfo=t.thread_info?new UE(n._iid,t.thread_info):null,n.reactions=t.reactions?t.reactions.map(function(e){return new QE(e)}):[];for(var r=null!=(e=t.metaarray)?e:{},i=null!=(e=t.metaarray_key_order)?e:Object.keys(r).sort(function(e,t){return e.localeCompare(t)}),s=0;s<i.length;s++){var a=i[s];n.metaArrays.push(new zE({key:a,value:r[a]||[]}))}return t.sorted_metaarray&&(n.metaArrays=t.sorted_metaarray.map(function(e){return new zE(e)})),n.ogMetaData=t.og_tag?new YE(t.og_tag):null,n.silent=null!=(e=t.silent)&&e,n.isOperatorMessage=null!=(e=t.is_op_msg)&&e,n.appleCriticalAlertOptions=t.apple_critical_alert_options?new XE(t.apple_critical_alert_options):null,n.createdAt=null!=(e=null!=(e=t.created_at)?e:t.ts)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,"number"==typeof t.scheduled_message_id&&"number"==typeof t.scheduled_at&&t.scheduled_status&&(n.scheduledInfo={scheduledMessageId:t.scheduled_message_id,scheduledAt:t.scheduled_at},n._scheduledStatus=t.scheduled_status),n}(li=r0=r0||{})[li.PENDING=0]="PENDING",li[li.UPLOADING=1]="UPLOADING",li[li.UPLOADED=2]="UPLOADED",li[li.SENDING=3]="SENDING",li[li.FAILED=4]="FAILED";function H0(e){return ly(wm,e.replyType)&&c("boolean",e.includeReactions)&&c("boolean",e.includeMetaArray)&&c("boolean",e.includeParentMessageInfo)&&c("boolean",e.includeThreadInfo)&&c("boolean",e.includePollDetails)}Object.defineProperty(Q0.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===im.CONNECTED||this._connectionState===im.CONNECTING||this._connectionState===im.RECONNECTING},enumerable:!1,configurable:!0}),Q0.prototype._sendFileMessage=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this._shouldSendThroughWebSocket?(t=new S0(f(f({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)]):[3,2];case 1:return[2,e.sent().as(k0).message];case 2:return t=new C0(f(f({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,userId:this._sdkState.userId,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)];case 3:return[2,e.sent().as(N0).message]}})})},Q0.prototype._resolveMessageQueue=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:if(!(t=this._queueMap.get(h.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,e.label=1;case 1:e.trys.push([1,15,16,17]),i=se(t.messageQueue),s=i.next(),e.label=2;case 2:if(s.done)return[3,14];switch((a=s.value).state){case r0.PENDING:case r0.UPLOADING:return[3,3];case r0.UPLOADED:return[3,4];case r0.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(a),[3,13];case 4:if(!r)return[3,10];e.label=5;case 5:return e.trys.push([5,8,,9]),a.state=r0.SENDING,[4,this._sendFileMessage(h,a)];case 6:return o=e.sent(),a.deferred.resolve(o),[4,fm(100)];case 7:return e.sent(),[3,9];case 8:return o=e.sent(),a.deferred.reject(o),[3,9];case 9:return[3,11];case 10:n.push(a),e.label=11;case 11:return[3,13];case 12:return a.deferred.reject(a.error.code===d.REQUEST_CANCELED?p.fileUploadCanceled:a.error),[3,13];case 13:return s=i.next(),[3,2];case 14:return[3,17];case 15:return c=e.sent(),c={error:c},[3,17];case 16:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 17:return u=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,u?[4,this._resolveMessageQueue(h)]:[3,19];case 18:e.sent(),e.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,e.label=21;case 21:return[2]}})})},Q0.prototype._uploadNextPendingItem=function(c){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=this._queueMap.get(c.url),(n=t.messageQueue.find(function(e){return e.state===r0.PENDING}))?ry(n.params.file)?t.uploadQueue.length<6?(n.state=r0.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!e.sent())return[3,8];e.label=2;case 2:return e.trys.push([2,4,5,7]),r=new LE({file:n.params.file,channelUrl:c.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return r=e.sent(),a=r.as(PE),o=a.url,i=a.fileSize,i=void 0===i?n.params.fileSize:i,s=a.thumbnailSizes,s=void 0===s?n.params.thumbnailSizes:s,a=a.requireAuth,a=void 0!==a&&a,n.params.fileUrl=o,n.params.fileSize=i,n.params.thumbnailSizes=s,n.params.requireAuth=a,n.requireAuth=a,n.state=r0.UPLOADED,[3,7];case 4:return o=e.sent(),n.state=r0.FAILED,n.error=o,[3,7];case 5:return 0<=(u=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(u,1),this._uploadNextPendingItem(c)),[4,this._resolveMessageQueue(c)];case 6:return e.sent(),[7];case 7:return[3,10];case 8:return n.state=r0.FAILED,n.error=p.connectionRequired,0<=(u=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(u,1),this._uploadNextPendingItem(c)),[4,this._resolveMessageQueue(c)];case 9:e.sent(),e.label=10;case 10:return[3,13];case 11:return n.params.thumbnailSizes=[],n.state=r0.UPLOADED,[4,this._resolveMessageQueue(c)];case 12:e.sent(),e.label=13;case 13:return[2]}})})},Q0.prototype.request=function(n,r,i){var s;return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new rm,ry(i.file)&&(i.fileName=null!=(s=i.fileName)?s:i.file.name,i.mimeType=null!=(s=i.mimeType)?s:i.file.type,i.fileSize=null!=(s=i.fileSize)?s:i.file.size),this._queueMap.has(n.url)||this._queueMap.set(n.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(n.url).messageQueue.push({requestId:r,params:i,state:r0.PENDING,deferred:t,requireAuth:i.requireAuth}),this._uploadNextPendingItem(n),[2,t.promise]})})},Q0.prototype.cancel=function(e,t){void 0===t&&(t=null);var n,r,i=this._queueMap.get(e.url);if(i){i=t?[i.messageQueue.find(function(e){return e.requestId===t})]:J_([],X_(i.messageQueue),!1);try{for(var s=se(i),a=s.next();!a.done;a=s.next()){var o=a.value;if(o)switch(o.state){case r0.PENDING:o.state=r0.FAILED,o.error=p.requestCanceled,this._resolveMessageQueue(e);break;case r0.UPLOADING:this._requestQueue.cancel(o.requestId)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}};var G0,V0=Q0,B0={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Em.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:wm.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},K0={replyType:wm.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includePollDetails:!1};function Q0(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,t=t.cacheContext,a=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=t,this._dispatcher=r,this._dispatcher.on(function(e){e instanceof jm&&(a._connectionState=e.stateType)}),this._onlineDetector=s}(a=G0=G0||{}).UNKNOWN="UNKNOWN",a.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",a.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",a.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",a.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",a.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",a.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",a.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",a.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",a.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",a.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",a.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",a.REQUEST_MESSAGE="REQUEST_MESSAGE",a.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",a.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",a.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",a.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",a.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",a.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",a.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",a.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",a.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",a.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";o(eb,Y0=ay);var z0,W0,Y0,X0,J0=eb,Z0=(o($0,W0=ay),$0);function $0(e){var t=e.messageIds,e=e.source,n=W0.call(this)||this;return n.messageIds=t,n.source=e,n}function eb(e){var t=e.messages,e=e.source,n=Y0.call(this)||this;return n.messages=t,n.source=e,n}function tb(e){var t=e.reqId,e=e.source,n=X0.call(this)||this;return n.reqId=t,n.source=e,n}o(tb,X0=ay);o(Hb,db=h);var nb,rb,ib,sb,ab,ob,ub,cb,lb,hb,db,fb=Hb,pb=(o(jb,hb=S),jb),vb=(o(Fb,lb=h),Fb),_b=(o(qb,cb=S),qb),yb=(o(Ub,ub=h),Ub),mb=(o(Pb,ob=S),Pb),gb=(o(Lb,ab=h),Lb),Eb=(o(xb,sb=S),xb),bb={},Ib=(Mb.of=function(e){return bb[e]},Mb.prototype.buildMessageFromSerializedData=function(e){var t=nE(e);switch(t.messageType){case gm.USER:return new b0(this._iid,b0.payloadify(t));case gm.FILE:return new T0(this._iid,T0.payloadify(t));case gm.ADMIN:return new g0(this._iid,g0.payloadify(t))}return null},Mb.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return w({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations)})},Mb.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return w({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),fileType:e.fileType,requireAuth:t.requireAuth})},Mb.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return f(f({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},Mb.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return f(f({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},Mb.prototype.buildSenderFromSerializedData=function(e){e=nE(e);return new v0(this._iid,v0.payloadify(e))},Mb.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=new fb(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(pb).message]}})})},Mb.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=new gb(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(Eb).message]}})})},Mb.prototype.getMessagesByTimestamp=function(r,i,s,a,o){return void 0===o&&(o=G0.REQUEST_MESSAGE),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=new vb(f(f({channelType:i,channelUrl:r,timestamp:s},B0),a)),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(_b).messages,this._dispatcher.dispatch(new J0({messages:n,source:o})),[2,n]}})})},Mb.prototype.getThreadedMessagesByTimestamp=function(i,s,a,o){return void 0===o&&(o=G0.REQUEST_THREADED_MESSAGE),re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=new vb(f(f(f({channelUrl:i.channelUrl,channelType:i.channelType,timestamp:s},m0),a),{replyType:wm.ALL,parentMessageId:i.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(_b).messages,(r=n.slice(1)).forEach(function(e){e.parentMessage=i}),this._dispatcher.dispatch(new J0({messages:r,source:o})),[2,{parentMessage:n[0],threadedMessages:r}]}})})},Mb.prototype.getMessageChangelogs=function(a,o,u,c,l){return void 0===l&&(l=G0.REQUEST_MESSAGE_CHANGELOGS),re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return t=new yb(w(f(f({channelType:o,channelUrl:a,timestamp:"number"==typeof u?u:null,token:"string"==typeof u?u:null},K0),c))),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),i=t.as(mb),n=i.updatedMessages,s=i.deletedMessagesInfo,r=i.hasMore,i=i.nextToken,s=s.map(function(e){return e.messageId}),0<n.length&&this._dispatcher.dispatch(new J0({messages:n,source:l})),0<s.length&&this._dispatcher.dispatch(new Z0({messageIds:s,source:l})),[2,{updatedMessages:n,deletedMessageIds:s,hasMore:r,token:i}]}})})},Mb),wb=(Db.prototype._trigger=function(e,t){switch(t.sendingStatus){case Sm.PENDING:this._onPending(t);break;case Sm.FAILED:case Sm.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);break;case Sm.SCHEDULED:case Sm.SUCCEEDED:this._onSucceeded(t)}},Db.prototype.onPending=function(e){return this._onPending=e,this},Db.prototype.onFailed=function(e){return this._onFailed=e,this},Db.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},Db),Tb=(o(Rb,ib=jn),Rb),Sb={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,includePollDetails:!1},s=(Object.defineProperty(Ob.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(Ob.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),Ob.prototype._validate=function(){return c("number",this.limit)&&0<this.limit},Ob),Cb=(o(Ab,rb=h),Ab),kb=(o(Nb,nb=S),Nb);function Nb(t,e){var n=nb.call(this,t,e)||this;return n.messages=e.results.map(function(e){return w0(t,e)}),n.hasNext=e.has_next,n.nextToken=e.end_cursor,n}function Ab(e){var t=e.channelCustomType,n=e.keyword,r=e.limit,i=e.reverse,s=e.exactMatch,a=e.channelUrl,o=e.order,u=e.messageTimestampFrom,c=e.messageTimestampTo,l=e.advancedQuery,h=e.targetFields,e=e.nextToken,d=rb.call(this)||this;return d.method=T.GET,d.path="".concat(og,"/messages"),d.params={custom_type:t,query:n,limit:r,reverse:i,exact_match:s,channel_url:a,message_ts_from:u,message_ts_to:c,sort_field:o,advanced_query:l,target_fields:h,after:e},d}function Ob(e,t){this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!=(e=t.limit)?e:20}function Rb(e,t){var n=ib.call(this,e)||this,r=(n.threadInfo=null,n.targetMessageId=0,n.channelUrl=null,n.channelType=null,t.thread_info),i=t.root_message_id,s=t.channel_url,t=t.channel_type;return r&&c("object",r)&&c("number",i)&&c("string",s)&&c("string",t)&&(n.threadInfo=new UE(e,r),n.targetMessageId=i,n.channelUrl=s,n.channelType=t),n}function Db(){this._onPending=jy,this._onFailed=jy,this._onSucceeded=jy}function Mb(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,t=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._onlineDetector=s,this._cacheContext=t,this.fileMessageQueue=new V0(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:t}),bb[e]=this}function xb(e,t){var n=sb.call(this,e,t)||this;return n.message=t?w0(e,f({},t)):null,n}function Lb(e){var t=e.channelUrl,e=e.scheduledMessageId,n=ab.call(this)||this;return n.method=T.GET,n.path="".concat(ig,"/").concat(encodeURIComponent(t),"/scheduled_messages/").concat(encodeURIComponent(e)),n.params={},n}function Pb(t,e){var n=ob.call(this,t,e)||this;return n.updatedMessages=e.updated.map(function(e){return w0(t,e)}),n.deletedMessagesInfo=e.deleted.map(function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}}),n.hasMore=e.has_more,n.nextToken=e.next,n}function Ub(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,i=e.token,s=e.replyType,a=e.includeMetaArray,o=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,e=e.includePollDetails,l=ub.call(this)||this;return l.method=T.GET,l.path="".concat(Rg(t),"/").concat(encodeURIComponent(n),"/messages/changelogs"),l.params={change_ts:r,token:i,with_sorted_meta_array:a,include_reactions:o,include_thread_info:u,include_reply_type:s,include_parent_message_info:c,include_poll_details:e},l}function qb(t,e){var n=cb.call(this,t,e)||this;return n.messages=e.messages.map(function(e){return w0(t,e)}),n}function Fb(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,r=void 0===r?null:r,i=e.token,i=void 0===i?null:i,s=e.prevResultSize,a=e.nextResultSize,o=e.isInclusive,u=e.reverse,c=e.messageTypeFilter,l=e.customTypesFilter,h=e.senderUserIdsFilter,d=e.replyType,f=e.includeMetaArray,p=e.includeReactions,v=e.parentMessageId,_=e.includeThreadInfo,y=e.includeParentMessageInfo,m=e.showSubchannelMessagesOnly,e=e.includePollDetails,g=lb.call(this)||this;return g.method=T.GET,g.path="".concat(Rg(t),"/").concat(encodeURIComponent(n),"/messages"),g.params=w({is_sdk:!0,prev_limit:s,next_limit:a,include:o,reverse:u,message_ts:r,message_id:i,message_type:null!=c?c:null,custom_types:l,sender_ids:h,include_reply_type:d,with_sorted_meta_array:f,include_reactions:p,parent_message_id:v,include_thread_info:_,include_parent_message_info:y,show_subchannel_message_only:m,include_poll_details:e}),g}function jb(e,t){var n=hb.call(this,e,t)||this;return n.message=t?w0(e,f({},t)):null,n}function Hb(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,i=e.includeMetaArray,s=e.includeReactions,a=e.includeThreadInfo,o=e.includeParentMessageInfo,e=e.includePollDetails,u=db.call(this)||this;return u.method=T.GET,u.path="".concat(Rg(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r)),u.params={is_sdk:!0,with_sorted_meta_array:i,include_reactions:s,include_thread_info:a,include_parent_message_info:o,include_poll_details:e},u}(kt=z0=z0||{}).SCORE="score",kt.TIMESTAMP="ts";o($b,Kb=s),$b.prototype._validate=function(){return Kb.prototype._validate.call(this)&&c("string",this.keyword)&&0<this.keyword.length&&c("boolean",this.reverse)&&c("boolean",this.exactMatch)&&c("string",this.channelUrl)&&c("string",this.channelCustomType)&&(c("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(c("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&ly(z0,this.order)&&c("boolean",this.advancedQuery)&&hy("string",this.targetFields,!0)},$b.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new Cb(f(f({},this),{nextToken:this._nextToken||null})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(kb),r=n.messages,i=n.hasNext,s=n.nextToken,this._nextToken=s,this._hasNext=i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})};var Gb,Vb,Bb,Kb,Qb=$b,hs=(o(Zb,Bb=s),Zb.prototype._validate=function(){return Bb.prototype._validate.call(this)&&c("string",this.channelUrl)&&ly(ym,this.channelType)},Zb),zb=(o(Jb,Vb=hs),Jb.prototype._validate=function(){return Vb.prototype._validate.call(this)&&c("boolean",this.reverse)&&ly(Em,this.messageTypeFilter)&&ly(wm,this.replyType)&&hy("string",this.customTypesFilter,!0)&&hy("string",this.senderUserIdsFilter,!0)&&c("boolean",this.includeMetaArray)&&c("boolean",this.includeReactions)&&c("boolean",this.includeParentMessageInfo)&&c("boolean",this.includeThreadInfo)&&c("boolean",this.showSubchannelMessagesOnly)},Jb.prototype.load=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Ib.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return t=e.sent(),this._edge=Math.min.apply(Math,J_([Number.MAX_SAFE_INTEGER],X_(t.map(function(e){return e.createdAt})),!1)),this._hasNext=t.length>=this.limit,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},Jb),Wb={channelUrl:null,scheduledMessageId:0},Yb=(o(Xb,Gb=ci),Xb.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;Gb.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new Ib(e,{sdkState:n,dispatcher:r,requestQueue:s,onlineDetector:o,cacheContext:t})},Xb.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},Xb.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},Xb.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){return n=f(f({},Sb),n),C(c("string",(t=n).channelUrl)&&c("string",t.channelType)&&ly(ym,t.channelType)&&c("number",t.messageId)&&c("boolean",t.includeMetaArray)&&c("boolean",t.includeParentMessageInfo)&&c("boolean",t.includeThreadInfo)&&c("boolean",t.includePollDetails)).throw(p.invalidParameters),[2,this._manager.getMessage(n)];var t})})},Xb.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){return n=f(f({},Wb),n),C(c("string",(t=n).channelUrl)&&c("number",t.scheduledMessageId)).throw(p.invalidParameters),[2,this._manager.getScheduledMessage(n)];var t})})},Xb);function Xb(){var e=null!==Gb&&Gb.apply(this,arguments)||this;return e.name="message",e}function Jb(e,t,n,r){var i=this;return(i=Vb.call(this,e,t,n,r)||this).reverse=!1,i.messageTypeFilter=Em.ALL,i.customTypesFilter=null,i.senderUserIdsFilter=null,i.replyType=wm.NONE,i.includeMetaArray=!1,i.includeReactions=!1,i.includeParentMessageInfo=!1,i.includeThreadInfo=!1,i.showSubchannelMessagesOnly=!1,i._edge=Number.MAX_SAFE_INTEGER,i.reverse=null!=(e=r.reverse)&&e,i.messageTypeFilter=null!=(t=r.messageTypeFilter)?t:Em.ALL,i.customTypesFilter=null!=(n=r.customTypesFilter)?n:null,i.senderUserIdsFilter=null!=(e=r.senderUserIdsFilter)?e:null,i.replyType=null!=(t=r.replyType)?t:wm.NONE,i.includeMetaArray=null!=(n=r.includeMetaArray)&&n,i.includeReactions=null!=(e=r.includeReactions)&&e,i.includeParentMessageInfo=null!=(t=r.includeParentMessageInfo)&&t,i.includeThreadInfo=null!=(n=r.includeThreadInfo)&&n,i.showSubchannelMessagesOnly=null!=(e=r.showSubchannelMessagesOnly)&&e,i}function Zb(e,t,n,r){e=Bb.call(this,e,r)||this;return e.channelUrl=t,e.channelType=n,e}function $b(e,t){var n=this;return(n=Kb.call(this,e,t)||this).keyword="",n.reverse=!1,n.exactMatch=!1,n.channelUrl="",n.channelCustomType="",n.messageTimestampFrom=null,n.messageTimestampTo=null,n.order=z0.SCORE,n.advancedQuery=!1,n.targetFields=null,n._nextToken="",n.keyword=t.keyword,n.reverse=null!=(e=t.reverse)&&e,n.exactMatch=null!=(e=t.exactMatch)&&e,n.channelUrl=null!=(e=t.channelUrl)?e:"",n.channelCustomType=null!=(e=t.channelCustomType)?e:"",n.messageTimestampFrom=null!=(e=t.messageTimestampFrom)?e:null,n.messageTimestampTo=null!=(e=t.messageTimestampTo)?e:null,n.order=null!=(e=t.order)?e:z0.SCORE,n.advancedQuery=null!=(e=t.advancedQuery)&&e,n.targetFields=null!=(e=t.targetFields)?e:null,n}function eI(e){return c("string",e.data,!0)&&c("string",e.customType,!0)&&ly(Im,e.mentionType)&&hy("string",e.mentionedUserIds,!0)&&hy(k,e.mentionedUsers,!0)&&c("string",e.mentionedMessageTemplate,!0)&&hy(zE,e.metaArrays,!0)&&c("number",e.parentMessageId,!0)&&c("boolean",e.isReplyToChannel)&&ly(Tm,e.pushNotificationDeliveryOption,!0)&&c(XE,e.appleCriticalAlertOptions,!0)}function tI(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}var nI,Ze={data:null,customType:null,mentionType:Im.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},rI=f(f({},Ze),{message:null,translationTargetLanguages:null});(aa=nI=nI||{}).FILE="file",aa.BLOB="blob",aa.BLOB_LIKE_OBJECT="blobLikeObject",aa.URL="url";function iI(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob}function sI(e){return e===nI.BLOB||e===nI.FILE}function aI(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}function oI(e){return eI(e)&&(ry(e.file)||c("string",e.fileUrl))&&c("string",e.fileName,!0)&&c("string",e.mimeType,!0)&&c("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every(function(e){return c("object",e)&&0<e.maxWidth&&0<e.maxHeight}))}var uI,cI=f(f({},Ze),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1});(Wn=uI=uI||{}).MUTED="muted",Wn.BANNED="banned";function lI(e){return c("string",e.data,!0)&&c("string",e.customType,!0)&&ly(Im,e.mentionType)&&hy("string",e.mentionedUserIds,!0)&&hy(k,e.mentionedUsers,!0)&&c("string",e.mentionedMessageTemplate,!0)&&hy(zE,e.metaArrays,!0)&&ly(Tm,e.pushNotificationDeliveryOption,!0)&&c(XE,e.appleCriticalAlertOptions,!0)}KI.payloadify=function(e){return e?w({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null};var hI,dI,fI,pI,vI,_I,yI,mI,gI,EI,bI,II=KI,wI=(o(BI,bI=k),BI.payloadify=function(e){return e?w(f(f({},bI.payloadify.call(this,e)),II.payloadify(e.restrictionInfo))):null},BI),K={data:null,customType:null,mentionType:Im.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},TI=f(f({},K),{message:null,translationTargetLanguages:null}),SI=f({},K),CI=(o(VI,EI=h),VI),kI=(o(GI,gI=S),GI),NI=(o(HI,mI=hs),HI.prototype._validate=function(){return mI.prototype._validate.call(this)},HI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:(t=[],this._hasNext?(this._isLoading=!0,n=N.of(this._iid).requestQueue,r=new CI(f(f({},this),{channelUrl:this.channelUrl,token:this._token})),[4,n.send(r)]):[3,2]):[3,5];case 1:return n=e.sent(),r=n.as(kI),i=r.operators,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,t];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},HI),AI=(o(jI,yI=h),jI),OI=(o(FI,_I=S),FI),RI=(o(qI,vI=hs),qI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new AI(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(OI),r=n.mutedUsers,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},qI),DI=(o(UI,pI=h),UI),MI=(o(PI,fI=S),PI),xI=(o(LI,dI=hs),LI.prototype._validate=function(){return dI.prototype._validate.call(this)},LI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new DI(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(MI),r=n.bannedUsers,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},LI);function LI(e,t,n,r){return dI.call(this,e,t,n,r)||this}function PI(t,e){var n=fI.call(this,t,e)||this,r=(n.token=null,n.bannedUsers=[],e.next),e=e.banned_list;return n.token=r,e&&0<e.length&&(n.bannedUsers=e.map(function(e){return new wI(t,e.user)})),n}function UI(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.limit,e=e.token;return(t=pI.call(this)||this).method=T.GET,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=w({limit:i,token:e}),t}function qI(e,t,n,r){return vI.call(this,e,t,n,r)||this}function FI(t,e){var n=_I.call(this,t,e)||this,r=(n.token=null,n.mutedUsers=[],e.next),e=e.muted_list;return n.token=r,e&&0<e.length&&(n.mutedUsers=e.map(function(e){return new wI(t,e)})),n}function jI(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.limit,e=e.token;return(t=yI.call(this)||this).method=T.GET,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={limit:i,token:e},t}function HI(e,t,n,r){return mI.call(this,e,t,n,r)||this}function GI(t,e){var n=gI.call(this,t,e)||this;return n.operators=e.operators.map(function(e){return new k(t,e)}),n.token=e.next,n}function VI(e){var t=e.channelUrl,n=e.channelType,r=e.token,e=e.limit,i=EI.call(this)||this;return i.method=T.GET,i.path="".concat(Rg(n),"/").concat(encodeURIComponent(t),"/operators"),i.params={token:r,limit:e},i}function BI(e,t){e=bI.call(this,e,t)||this;return e.restrictionInfo=null,e.restrictionInfo=new II(t),e}function KI(e){var t;this.restrictionType=null,this.description=null,this.endAt=-1,ly(uI,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!=(t=e.description)?t:null,this.endAt=null!=(t=null!=(t=e.end_at)?t:e.muted_end_at)?t:-1}(Et=hI=hI||{}).SPAM="spam",Et.HARASSING="harassing",Et.SUSPICIOUS="suspicious",Et.INAPPROPRIATE="inappropriate";o(YI,QI=h);var QI,zI,WI=YI;function YI(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=QI.call(this)||this).method=T.POST,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}o(function(){return null!==zI&&zI.apply(this,arguments)||this},zI=S);o($I,XI=h);var XI,JI,ZI=$I;function $I(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=XI.call(this)||this).method=T.DELETE,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}o(function(e,t){return JI.call(this,e,t)||this},JI=S);o(rT,mw=h);var ew,tw,nw,rw,iw,sw,aw,ow,uw,cw,lw,hw,dw,fw,pw,vw,_w,yw,mw,gw,Ew=rT,bw=(o(nT,yw=S),nT),Iw=(o(tT,_w=h),tT),ww=(o(eT,vw=S),eT),Tw=(o($w,pw=h),$w),Sw=(o(Zw,fw=S),Zw),Cw=(o(Jw,dw=zy),Jw),kw=(o(Xw,hw=h),Xw),Nw=(o(Yw,lw=S),Yw),Aw=(o(Ww,cw=h),Ww),Ow=(o(zw,uw=S),zw),Rw=(o(Qw,ow=h),Qw),Dw=(o(Kw,aw=S),Kw),Mw=(o(Bw,sw=h),Bw),xw=(o(Vw,iw=S),Vw),Lw=(o(Gw,rw=h),Gw),Pw=(o(Hw,nw=S),Hw),Uw=(o(jw,tw=zy),jw),qw=(o(Fw,ew=h),Fw);function Fw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=ew.call(this)||this).method=T.DELETE,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/metacounter/").concat(e),t.params=null,t}function jw(e,t,n){e=tw.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function Hw(e,t){e=nw.call(this,e,t)||this;return e.metaCounter=t,e}function Gw(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.metaCounter,s=e.upsert,s=void 0!==s&&s,e=e.mode,e=void 0===e?"set":e;return(t=rw.call(this)||this).method=T.PUT,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:i,upsert:s,mode:e},t}function Vw(e,t){e=iw.call(this,e,t)||this;return e.metaCounter=t,e}function Bw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metaCounter;return(t=sw.call(this)||this).method=T.POST,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:e},t}function Kw(e,t){e=aw.call(this,e,t)||this;return e.metaCounter=t,e}function Qw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=ow.call(this)||this).method=T.GET,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={keys:e},t}function zw(e,t){e=uw.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function Ww(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=cw.call(this)||this).method=T.PUT,t.path="".concat(Rg(e),"/").concat(encodeURIComponent(n),"/metadata"),t.params={include_ts:!0},t}function Yw(e,t){e=lw.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function Xw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=hw.call(this)||this).method=T.DELETE,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/metadata/").concat(e),t.params={include_ts:!0},t}function Jw(e,t,n){e=dw.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function Zw(e,t){var e=fw.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function $w(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.metadata,e=e.upsert;return(t=pw.call(this)||this).method=T.PUT,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:i,include_ts:!0,upsert:null!=e&&e},t}function eT(e,t){var e=vw.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function tT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=_w.call(this)||this).method=T.GET,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={keys:e,include_ts:!0},t}function nT(e,t){var e=yw.call(this,e,t)||this,n=(e.isMuted=!1,e.startAt=null,e.endAt=null,e.remainingDuration=null,e.description=null,t.is_muted),r=t.start_at,i=t.end_at,s=t.remaining_duration,t=t.description;return e.isMuted=n,e.startAt=r,e.endAt=i,e.remainingDuration=s,e.description=t,e}function rT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=mw.call(this)||this).method=T.GET,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/mute/").concat(e),t}o(function(e,t){return gw.call(this,e,t)||this},gw=S);o(oT,iT=h);var iT,sT,aT=oT;function oT(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=iT.call(this)||this).method=T.DELETE,t.path="".concat(Rg(e),"/").concat(encodeURIComponent(n),"/metacounter"),t.params=null,t}o(function(){return null!==sT&&sT.apply(this,arguments)||this},sT=S);o(hT,uT=h);var uT,cT,lT=hT;function hT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.userId,s=e.seconds,e=e.description;return(t=uT.call(this)||this).method=T.POST,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={user_id:i,seconds:s,description:e},t}o(function(e,t){return cT.call(this,e,t)||this},cT=S);o(mT,fT=zy);var dT,fT,pT,vT=mT,_T=(o(yT,dT=h),yT);function yT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=dT.call(this)||this).method=T.DELETE,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/mute/").concat(encodeURIComponent(e)),t}function mT(e,t,n){var r=fT.call(this,e,"SYEV",n)||this;return r.user=new wI(e,n.data),r}o(function(){return null!==pT&&pT.apply(this,arguments)||this},pT=S);o(ST,ET=zy);var gT,ET,bT,IT=ST,wT=(o(TT,gT=h),TT);function TT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.userId,s=e.seconds,e=e.description;return(t=gT.call(this)||this).method=T.POST,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=w({user_id:i,seconds:s,description:e}),t}function ST(e,t,n){var r=ET.call(this,e,"SYEV",n)||this;return r.user=new wI(e,n.data),r}o(function(){return null!==bT&&bT.apply(this,arguments)||this},bT=S);o(DT,kT=zy);var CT,kT,NT,AT=DT,OT=(o(RT,CT=h),RT);function RT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=CT.call(this)||this).method=T.DELETE,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/ban/").concat(encodeURIComponent(e)),t}function DT(e,t,n){var r=kT.call(this,e,"SYEV",n)||this;return r.memberCount=null,r.joinedMemberCount=null,r.user=new wI(e,n.data),n.data.member_count&&(r.memberCount=n.data.member_count),n.data.joined_member_count&&(r.joinedMemberCount=n.data.joined_member_count),r}o(function(){return null!==NT&&NT.apply(this,arguments)||this},NT=S);o(FT,xT=zy);var MT,xT,LT,PT=FT,UT=(o(qT,MT=h),qT);function qT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.freezing;return(t=MT.call(this)||this).method=T.PUT,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(n),"/freeze"),t.params={freeze:e},t}function FT(e,t,n){var r=xT.call(this,e,"SYEV",n)||this;return r.user=new wI(e,n.data),r}o(function(){return null!==LT&&LT.apply(this,arguments)||this},LT=S);o(gS,XT=zy);var jT,HT,GT,VT,BT,KT,QT,zT,WT,YT,XT,JT,ZT=gS,$T=(o(mS,YT=h),mS),eS=(o(yS,WT=h),yS),tS=(o(_S,zT=h),_S),nS=(o(vS,QT=Wy),vS),rS=(o(pS,KT=zy),pS),iS=(o(fS,BT=Wy),fS),sS=(o(dS,VT=zy),dS),aS=(o(hS,GT=Wy),hS),oS=(o(lS,HT=zy),lS),uS=(o(cS,jT=h),cS);function cS(e){var t=jT.call(this)||this;return t.method=T.DELETE,t.path="".concat(Rg(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),t}function lS(e,t,n){var r,i=this,e=((i=HT.call(this,e,"FEDI",n)||this).message=new T0(e,n),N.of(e).sdkState);return i.mentionCountChange=Mg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function hS(e){var t=[];return e.mentionType===Im.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),GT.call(this,{code:"FEDI",ackRequired:!0,payload:w({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function dS(e,t,n){var r,i=this,e=((i=VT.call(this,e,"MEDI",n)||this).message=new b0(e,n),N.of(e).sdkState);return i.mentionCountChange=Mg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function fS(e){var t=[];return e.mentionType===Im.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),BT.call(this,{code:"MEDI",ackRequired:!0,payload:w({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function pS(e,t,n){var r,i=this,e=((i=KT.call(this,e,"MESG",n)||this).message=new b0(e,n),N.of(e).sdkState);return i.isMentioned=jg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function vS(e){var t=[];return e.mentionType===Im.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),QT.call(this,{code:"MESG",ackRequired:!0,payload:w({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==Tm.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function _S(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,a=e.offendingUserId,o=e.messageId,e=e.description;return(t=zT.call(this)||this).method=T.POST,t.path="".concat(Dg(r),"/").concat(encodeURIComponent(n),"/messages/").concat(o),t.params={report_category:i,reporting_user_id:s,report_description:e,offending_user_id:a},t}function yS(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,a=e.offendingUserId,e=e.description;return(t=WT.call(this)||this).method=T.POST,t.path="/report/users/".concat(a),t.params={channel_url:n,channel_type:r===ym.OPEN?"open_channels":"group_channels",report_category:i,reporting_user_id:s,report_description:e},t}function mS(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,e=e.description;return(t=YT.call(this)||this).method=T.POST,t.path="".concat(Dg(r),"/").concat(encodeURIComponent(n)),t.params={report_category:i,reporting_user_id:s,report_description:e},t}function gS(e,t,n){e=XT.call(this,e,"SYEV",n)||this;return e.freeze=n.data.freeze,e}o(function(){return null!==JT&&JT.apply(this,arguments)||this},JT=S);o(iC,RS=zy);var ES,bS,IS,wS,TS,SS,CS,kS,NS,AS,OS,RS,DS,MS,xS,LS,PS=iC,US=(o(rC,OS=h),rC),qS=(o(nC,AS=S),nC),FS=(o(tC,NS=h),tC),jS=(o(eC,kS=S),eC),HS=(o($S,CS=h),$S),GS=(o(ZS,SS=S),ZS),VS=(o(JS,TS=h),JS),BS=(o(XS,wS=S),XS),KS=(o(YS,IS=h),YS),QS=(o(WS,bS=S),WS),zS=(o(A,ES=jn),A.payloadify=function(e){return w(f(f({},ES.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:k.payloadify(e.creator),created_at:e.createdAt/1e3}))},A.prototype.isGroupChannel=function(){return this.channelType===ym.GROUP},A.prototype.isOpenChannel=function(){return this.channelType===ym.OPEN},Object.defineProperty(A.prototype,"cachedMetaData",{get:function(){var n={};return this._cachedMetaData.forEach(function(e,t){e.isRemoved||(n[t]=e.value)}),n},enumerable:!1,configurable:!0}),A.prototype._upsertCachedMetaData=function(n,r){var i=this;Object.keys(n).forEach(function(e){var t=i._cachedMetaData.get(e);(!t||t.updatedAt<=r)&&i._cachedMetaData.set(e,{value:n[e],isRemoved:!1,updatedAt:r})})},A.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach(function(e){e=n._cachedMetaData.get(e);e&&e.updatedAt<t&&(e.isRemoved=!1,e.updatedAt=t)})},A.prototype._generateRequestId=function(){return"rq-".concat(sy())},A.prototype.isIdentical=function(e){return e&&this.url===e.url},A.prototype.isEqual=function(e){return ty(this,e)},A.prototype.createOperatorListQuery=function(e){return new NI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},A.prototype.createMutedUserListQuery=function(e){return new RI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},A.prototype.createBannedUserListQuery=function(e){return new xI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},A.prototype.createPreviousMessageListQuery=function(e){return new zb(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},A.prototype.addOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",r)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new WI({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.removeOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",r)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new ZI({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.getMyMutedInfo=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Ew({channelUrl:this.url,channelType:this.channelType,userId:n.userId}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(bw),r=n.isMuted,i=n.startAt,s=n.endAt,a=n.remainingDuration,o=n.description,[2,{isMuted:r,startAt:i,endAt:s,remainingDuration:a,description:o}]}})})},A.prototype.getMetaData=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",s)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new Iw({channelUrl:this.url,channelType:this.channelType,keys:s}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(ww),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},A.prototype.getAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Iw({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(ww),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},A.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Hg({channelUrl:this.url,channelType:this.channelType,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Gg).metaData,this._upsertCachedMetaData(n,0),[2,n]}})})},A.prototype.updateMetaData=function(s,a){return void 0===a&&(a=!1),re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Tw({channelUrl:this.url,channelType:this.channelType,metadata:s,upsert:a}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Sw),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},A.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new kw({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Nw).ts,this._removeFromCachedMetaData([r],n),[2]}})})},A.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Aw({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Ow).ts,this._removeFromCachedMetaData(J_([],X_(this._cachedMetaData.keys()),!1),n),[2]}})})},A.prototype.getMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",r)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new Rw({channelUrl:this.url,channelType:this.channelType,keys:r}),[4,t.send(n)];case 1:return[2,e.sent().as(Dw).metaCounter]}})})},A.prototype.getAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Rw({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return[2,e.sent().as(Dw).metaCounter]}})})},A.prototype.createMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Mw({channelUrl:this.url,channelType:this.channelType,metaCounter:r}),[4,t.send(n)];case 1:return[2,e.sent().as(xw).metaCounter]}})})},A.prototype.updateMetaCounters=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Lw({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:i}),[4,t.send(n)];case 1:return[2,e.sent().as(Pw).metaCounter]}})})},A.prototype.increaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Lw({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return[2,e.sent().as(Pw).metaCounter]}})})},A.prototype.decreaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Lw({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return[2,e.sent().as(Pw).metaCounter]}})})},A.prototype.deleteMetaCounter=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new qw({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.deleteAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new aT({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.muteUser=function(t,n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.muteUserWithUserId(t.userId,n,r)]})})},A.prototype.muteUserWithUserId=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)&&c("number",i,!0)&&c("string",s,!0)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new lT({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.unmuteUser=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unmuteUserWithUserId(t.userId)]})})},A.prototype.unmuteUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new _T({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.banUser=function(t,n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.banUserWithUserId(t.userId,n,r)]})})},A.prototype.banUserWithUserId=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)&&c("number",i,!0)&&c("string",s,!0)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new wT({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.unbanUser=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unbanUserWithUserId(t.userId)]})})},A.prototype.unbanUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new OT({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.freeze=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new UT({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!0,[2]}})})},A.prototype.unfreeze=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new UT({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!1,[2]}})})},A.prototype.getMessagesByTimestamp=function(n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return r=f(f({},B0),r),C(c("number",n)&&(c("number",(t=r).prevResultSize)&&c("number",t.nextResultSize)&&c("boolean",t.isInclusive)&&c("boolean",t.reverse)&&c("string",t.messageTypeFilter)&&ly(Em,t.messageTypeFilter)&&hy("string",t.customTypesFilter,!0)&&hy("string",t.senderUserIdsFilter,!0)&&ly(wm,t.replyType)&&c("boolean",t.includeMetaArray)&&c("boolean",t.includeReactions)&&c("boolean",t.includeParentMessageInfo)&&c("boolean",t.includeThreadInfo)&&c("boolean",t.showSubchannelMessagesOnly))).throw(p.invalidParameters),[4,Ib.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,n,r)];case 1:return[2,e.sent()]}var t})})},A.prototype.getMessageChangeLogsSinceTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},K0),n),C(c("number",t)&&H0(n)).throw(p.invalidParameters),[4,Ib.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},A.prototype.getMessageChangeLogsSinceToken=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},K0),n),C(c("string",t)&&H0(n)).throw(p.invalidParameters),[4,Ib.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},A.prototype._createPendingSendableMessagePayload=function(e,t,n){var r=N.of(this._iid).sessionManager;return w({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(e){return zE.payloadify(e)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?XE.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:v0.payloadify(r.currentUser),req_id:t,request_state:Sm.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:e.mentionedUsers})},A.prototype._createPendingUserMessage=function(e,t,n){var r={};if(e.translationTargetLanguages)try{for(var i=se(e.translationTargetLanguages),s=i.next();!s.done;s=i.next())r[s.value]=""}catch(e){o={error:e}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(o)throw o.error}}var a=w(f(f({},this._createPendingSendableMessagePayload(e,t,n)),{type:gm.USER,message:e.message,translations:r})),o=new b0(this._iid,a);return o.messageParams=e,o},A.prototype._createPendingScheduledUserMessage=function(e,t,n){t=this._createPendingUserMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},A.prototype._createPendingFileMessage=function(e,t,n){t=w(f(f({},this._createPendingSendableMessagePayload(e,t,n)),{type:gm.FILE,url:e.fileUrl,file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}}):[]})),n=new T0(this._iid,t);return n.messageParams=e,n},A.prototype._createPendingScheduledFileMessage=function(e,t,n){t=this._createPendingFileMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},A.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===d.REQUEST_CANCELED?e.sendingStatus=Sm.CANCELED:n||(e.sendingStatus=Sm.FAILED)},A.prototype.sendUserMessage=function(e){return e=f(f({},rI),e),C(eI(t=e)&&c("string",t.message)&&hy("string",t.translationTargetLanguages,!0)).throw(p.invalidParameters),this._sendUserMessage(e);var t},A.prototype._sendUserMessage=function(r,i,e){var n,s=this,t=(void 0===i&&(i=Date.now()),void 0===e&&(e=null),N.of(this._iid)),a=t.dispatcher,t=t.requestQueue,o=e,u=new wb,e=(o||(o=this._generateRequestId(),n=N.of(this._iid).dispatcher,fm(2).then(function(){var t=s._createPendingUserMessage(r,o,i);n.dispatch(new J0({messages:[t],source:G0.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})})),new nS(f({channelUrl:this.url,channelType:this.channelType,reqId:o},r)));return t.send(e).then(function(e){var t=e.as(rS).message;a.dispatch(new J0({messages:[t],source:G0.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})}).catch(function(n){if(ey(n))throw n;fm(2).then(function(){var t=s._createPendingUserMessage(r,o,i),e=N.of(s._iid).cacheContext.localCacheEnabled&&ny(n.code);s._markMessageAsFailed(t,n,e),a.dispatch(new J0({messages:[t],source:t.sendingStatus===Sm.PENDING?G0.REQUEST_RESEND_MESSAGE:G0.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(n,t)]})})})})}),u},A.prototype._autoResendUserMessage=function(e){return C(e instanceof b0).throw(p.invalidParameters),this._sendUserMessage(e.messageParams,e.createdAt,e.reqId)},A.prototype.resendUserMessage=function(r){var i;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof b0&&!r.scheduledInfo).throw(p.invalidParameters),t=new rm,n=null!=(i=r.messageParams)?i:w({data:r.data,customType:r.customType,mentionType:r.mentionType,mentionedUsers:r.mentionedUsers,mentionedUserIds:r.mentionedUserIds,mentionedMessageTemplate:r.mentionedMessageTemplate,metaArrays:r.metaArrays,parentMessageId:r.parentMessageId,appleCriticalAlertOptions:r.appleCriticalAlertOptions,message:r.message,translationTargetLanguages:Object.keys(r.translations)}),this._sendUserMessage(n).onFailed(function(e){return t.reject(e)}).onSucceeded(function(e){return t.resolve(e)}),[2,t.promise]})})},A.prototype.updateUserMessage=function(s,a){return re(this,void 0,void 0,function(){var n,r,i;return ie(this,function(e){switch(e.label){case 0:return a=f(f({},TI),a),C(c("number",s)&&(lI(t=a)&&c("string",t.message,!0)&&hy("string",t.translationTargetLanguages,!0))).throw(p.invalidParameters),r=N.of(this._iid),n=r.dispatcher,r=r.requestQueue,i=new iS(f({channelType:this.channelType,channelUrl:this.url,messageId:s},a)),[4,r.send(i)];case 1:return r=e.sent(),i=r.as(sS).message,n.dispatch(new J0({messages:[i],source:G0.EVENT_MESSAGE_UPDATED})),[2,i]}var t})})},A.prototype.copyUserMessage=function(r,i){var s;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof A&&i instanceof b0&&i.sendingStatus===Sm.SUCCEEDED&&r.url===i.channelUrl&&!i.scheduledInfo).throw(p.invalidParameters),t=new rm,n=null!=(s=i.messageParams)?s:f(f({},i),{mentionType:i.mentionType,mentionedUserIds:null!=(s=i.mentionedUserIds)?s:null==(s=i.mentionedUsers)?void 0:s.map(function(e){return e.userId}),translationTargetLanguages:Object.keys(i.translations),pushNotificationDeliveryOption:Tm.DEFAULT,parentMessageId:null,isReplyToChannel:!1}),r._sendUserMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},A.prototype.translateUserMessage=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof b0&&0<r.messageId&&hy("string",i)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new HS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,translationTargetLanguages:i}),[4,t.send(n)];case 1:return[2,e.sent().as(GS).message]}})})},A.prototype._createScheduledUserMessage=function(e,r){var i=this,t=N.of(this._iid).requestQueue,s=Date.now(),a=this._generateRequestId(),n=(fm(2).then(function(){var t=i._createPendingScheduledUserMessage(e,a,s);ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}),new VS(f({reqId:a,channelType:this.channelType,channelUrl:this.url},e)));t.send(n).then(function(e){var t=e.as(BS).message;ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(ey(n))throw n;fm(2).then(function(){var t=i._createPendingScheduledUserMessage(e,a,s);i._markMessageAsFailed(t,n),ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(n,t)]})})})})})},A.prototype.sendFileMessage=function(e){return e=f(f({},cI),e),C(oI(e)).throw(p.invalidParameters),this._sendFileMessage(e)},A.prototype._sendFileMessage=function(r,i,e){var s=this,a=(void 0===i&&(i=Date.now()),void 0===e&&(e=null),N.of(this._iid).dispatcher),t=Ib.of(this._iid).fileMessageQueue,o=e,u=new wb;return o||(o=this._generateRequestId(),fm(2).then(function(){var t=s._createPendingFileMessage(r,o,i);a.dispatch(new J0({messages:[t],source:G0.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})})),t.request(this,o,r).then(function(t){a.dispatch(new J0({messages:[t],source:G0.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})}).catch(function(n){if(ey(n))throw n;fm(2).then(function(){var t=s._createPendingFileMessage(r,o,i),e=N.of(s._iid).cacheContext.localCacheEnabled&&ny(n.code);s._markMessageAsFailed(t,n,e),a.dispatch(new J0({messages:[t],source:t.sendingStatus===Sm.PENDING?G0.REQUEST_RESEND_MESSAGE:G0.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(n,t)]})})})})}),u},A.prototype._autoResendFileMessage=function(e){C(e instanceof T0).throw(p.invalidParameters);var t=N.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.createdAt,e.reqId).onFailed(function(e){t.debug("autoResendFileMessage failed",e)}).onSucceeded(function(e){t.debug("autoResendFileMessage success",e)})},A.prototype._createScheduledFileMessage=function(e,r,i,s){var a=this,t=N.of(this._iid).requestQueue,n=new KS(f(f({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));t.send(n).then(function(e){var t=e.as(QS).message;ae(function(){return re(a,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(ey(n))throw n;fm(2).then(function(){var t=a._createPendingScheduledFileMessage(e,i,s);a._markMessageAsFailed(t,n),ae(function(){return re(a,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(n,t)]})})})})})},A.prototype.sendFileMessages=function(e){C(e.every(function(e){return oI(f(f({},cI),e))})).throw(p.invalidParameters);var t,n,r=new wb;try{for(var i=se(e),s=i.next();!s.done;s=i.next()){var a=s.value;this.sendFileMessage(a).onPending(function(e){return r._trigger(null,e)}).onFailed(function(e,t){return r._trigger(e,t)}).onSucceeded(function(e){return r._trigger(null,e)})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},A.prototype.resendFileMessage=function(i,s){var a;return re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){return C(i instanceof T0&&s instanceof Blob&&!i.scheduledInfo).throw(p.invalidParameters),n=new rm,r=null!=(a=i.messageParams)?a:(t=s,w({data:i.data,customType:i.customType,mentionType:i.mentionType,mentionedUsers:i.mentionedUsers,mentionedUserIds:i.mentionedUserIds,metaArrays:i.metaArrays,parentMessageId:i.parentMessageId,appleCriticalAlertOptions:i.appleCriticalAlertOptions,file:t=void 0===s?null:t,fileUrl:i.url,fileName:i.name,fileSize:i.size,mimeType:i.type,thumbnailSizes:i.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}})})),this._sendFileMessage(r).onFailed(function(e){return n.reject(e)}).onSucceeded(function(e){return n.resolve(e)}),[2,n.promise];var t})})},A.prototype.updateFileMessage=function(i,s){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return s=f(f({},SI),s),C(c("number",i)&&lI(s)).throw(p.invalidParameters),n=N.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new aS(f({channelType:this.channelType,channelUrl:this.url,messageId:i},s)),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(oS).message,t.dispatch(new J0({messages:[r],source:G0.EVENT_MESSAGE_UPDATED})),[2,r]}})})},A.prototype.cancelUploadingFileMessage=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(c("string",t)).throw(p.invalidParameters),Ib.of(this._iid).fileMessageQueue.cancel(this,t),[2,!0]})})},A.prototype.copyFileMessage=function(r,i){var s;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof A&&i instanceof T0&&i.sendingStatus===Sm.SUCCEEDED&&r.url===i.channelUrl&&!i.scheduledInfo).throw(p.invalidParameters),t=new rm,n=f(f({},i),{fileUrl:i.url,fileName:i.name,fileSize:i.size,mimeType:i.type,mentionType:i.mentionType,mentionedUserIds:null!=(s=i.mentionedUserIds)?s:null==(s=i.mentionedUsers)?void 0:s.map(function(e){return e.userId}),pushNotificationDeliveryOption:Tm.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:i.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),requireAuth:i.requireAuth}),r._sendFileMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},A.prototype.deleteMessage=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof _0).throw(p.invalidParameters),0<r.messageId?(t=N.of(this._iid).requestQueue,n=new uS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},A.prototype.addReaction=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof p0&&0<r.messageId&&c("string",i)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new US({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:i}),[4,t.send(n)];case 1:return[2,e.sent().as(qS).reactionEvent]}})})},A.prototype.deleteReaction=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof p0&&0<r.messageId&&c("string",i)).throw(p.invalidParameters),t=N.of(this._iid).requestQueue,n=new FS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:i}),[4,t.send(n)];case 1:return[2,e.sent().as(jS).reactionEvent]}})})},A.prototype._updateMessageMetaArray=function(i,s,a,o){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return n=N.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new iS({channelType:this.channelType,channelUrl:this.url,messageId:i,metaArrayParams:{array:s,mode:a,upsert:o}}),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(sS).message,t.dispatch(new J0({messages:[r],source:G0.EVENT_MESSAGE_UPDATED})),[2,r]}})})},A.prototype.createMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return C(n instanceof _0&&0<n.messageId&&hy("string",r)).throw(p.invalidParameters),t=r.map(function(e){return new zE({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"add",!0)]})})},A.prototype.deleteMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return C(n instanceof _0&&0<n.messageId&&hy("string",r)).throw(p.invalidParameters),t=r.map(function(e){return new zE({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"remove",!0)]})})},A.prototype.addMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(t instanceof _0&&0<t.messageId&&n.every(function(e){return e instanceof zE})).throw(p.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"add",!0)]})})},A.prototype.removeMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(t instanceof _0&&0<t.messageId&&n.every(function(e){return e instanceof zE})).throw(p.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"remove",!0)]})})},A.prototype.report=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ly(hI,r)&&c("string",i)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new $T({channelUrl:this.url,channelType:this.channelType,userId:n.userId,category:r,description:i}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.reportUser=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof k&&ly(hI,i)&&c("string",s)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new eS({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.userId,category:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.reportMessage=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof _0&&ly(hI,i)&&c("string",s)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new tS({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.sender.userId,messageId:r.messageId,category:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A);function A(e,t){var n=this;return(n=ES.call(this,e)||this).url="",n.channelType=ym.BASE,n.name="",n.coverUrl="",n.customType="",n.data="",n.isFrozen=!1,n.isEphemeral=!1,n.creator=null,n.createdAt=0,n.url=t.channel_url,n.name=null!=(e=t.name)?e:"",n.coverUrl=null!=(e=t.cover_url)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.data=null!=(e=t.data)?e:"",n.isFrozen=!!c("boolean",t.freeze)&&t.freeze,n.isEphemeral=!!c("boolean",t.is_ephemeral)&&t.is_ephemeral,n.creator=t.created_by?new k(n._iid,t.created_by):null,n.createdAt=1e3*t.created_at,n._cachedMetaData=new Map,t.metadata&&t.ts&&Object.keys(t.metadata).forEach(function(e){n._cachedMetaData.set(e,{value:t.metadata[e],isRemoved:!1,updatedAt:t.ts})}),n}function WS(e,t){var n=bS.call(this,e,t)||this;return n.message=new T0(e,t),n}function YS(e){var t=this,t=IS.call(this)||this,n=[],r=(e.mentionType===Im.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),i=e.channelUrl;return t.method=T.POST,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(i),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:bm.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return y0.payloadify(e)}):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return zE.payloadify(e)}),apple_critical_alert_options:XE.payloadify(e.appleCriticalAlertOptions),push_option:e.pushNotificationDeliveryOption},t}function XS(e,t){var n=wS.call(this,e,t)||this;return n.message=new b0(e,t),n}function JS(e){var t=this,t=TS.call(this)||this,n=[],r=(e.mentionType===Im.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),i=e.channelUrl;return t.method=T.POST,t.path="".concat(Rg(r),"/").concat(encodeURIComponent(i),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:bm.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return zE.payloadify(e)}),apple_critical_alert_options:XE.payloadify(e.appleCriticalAlertOptions),target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption},t}function ZS(e,t){var n=SS.call(this,e,t)||this;return n.message=new b0(e,t),n}function $S(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.translationTargetLanguages,i=CS.call(this)||this;return i.method=T.POST,i.path="".concat(Rg(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r),"/translation"),i.params={target_langs:e},i}function eC(e,t){e=kS.call(this,e,t)||this;return e.reactionEvent=new BE(f({},t)),e}function tC(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,i=NS.call(this)||this;return i.method=T.DELETE,i.path="".concat(Rg(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),i.params={reaction:e},i}function nC(e,t){e=AS.call(this,e,t)||this;return e.reactionEvent=new BE(t),e}function rC(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,i=OS.call(this)||this;return i.method=T.POST,i.path="".concat(Rg(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),i.params={reaction:e},i}function iC(e,t,n){e=RS.call(this,e,"DELM",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.messageId=Number(n.msg_id),e}(Kt=DS=DS||{}).SUCCESS="success",Kt.PENDING="pending",Kt.ERROR="error",($e=MS=MS||{}).DEFAULT="default",$e.ALL="all",$e.MENTION_ONLY="mention_only",$e.OFF="off",(Xe=xS=xS||{}).FCM="gcm",Xe.APNS="apns",Xe.UNKNOWN="unknown",(Ft=LS=LS||{}).ALTERNATIVE="alternative",Ft.DEFAULT="default";var sC;(r=sC=sC||{}).LATEST_LAST_MESSAGE="latest_last_message",r.CHRONOLOGICAL="chronological",r.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",r.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";function aC(e){switch(e){case sC.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case sC.CHRONOLOGICAL:return["-createdAt","syncIndex"];case sC.CHANNEL_NAME_ALPHABETICAL:return["name"]}}cC.prototype.clone=function(){var t=new cC,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach(function(e){t[e]=n[e]}),t},cC.prototype.match=function(e){switch(this.messageTypeFilter){case Em.USER:if(e.messageType!==gm.USER)return!1;break;case Em.FILE:if(e.messageType!==gm.FILE)return!1;break;case Em.ADMIN:if(e.messageType!==gm.ADMIN)return!1}if(this.customTypesFilter&&0<this.customTypesFilter.length&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&0<this.senderUserIdsFilter.length){if(!(e instanceof _0))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case wm.NONE:if(0<e.parentMessageId)return!1;break;case wm.ONLY_REPLY_TO_CHANNEL:if(e instanceof _0&&0<e.parentMessageId&&!e.replyToChannel)return!1}return!0};var oC,uC=cC;function cC(){this.messageTypeFilter=Em.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=wm.NONE}(B=oC=oC||{}).CHANNEL_LATEST="channel_latest",B.NEWEST_CHILD_MESSAGE="newest_child_message";function lC(e){switch(e){case oC.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case oC.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}}f(f({},rI),{scheduledAt:null}),f(f({},Ze),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1});var hC,dC,fC,pC,vC={},_C=(o(SC,pC=jn),SC.of=function(e){return vC[e]},Object.defineProperty(SC.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(SC.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),SC.prototype._serialize=function(e){if(0<e.messageId)throw p.invalidParameters;var t,n=f({},e.serialize());return e instanceof b0?(e.messageParams&&(n.messageParams=tI(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,f(f({},tI(t)),{scheduledAt:t.scheduledAt})))):e instanceof T0&&(e.messageParams&&(n.messageParams=aI(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,f(f({},aI(t)),{scheduledAt:t.scheduledAt})))),n},SC.prototype._deserialize=function(e){return e?(e=f(f({},e),{messageId:parseInt(e.messageId)}),Ib.of(this._iid).buildMessageFromSerializedData(e)):null},SC.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},SC.prototype.fetch=function(e){var t=e.channelUrl,i=void 0===t?null:t,t=e.filter,s=void 0===t?new uC:t,t=e.order,a=void 0===t?oC.CHANNEL_LATEST:t,t=e.sendingStatus,o=void 0===t?null:t,t=e.backward,u=void 0!==t&&t,t=e.parentMessageId,c=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(n=lC(a),t={"/where":function(e){return!!(a!==oC.NEWEST_CHILD_MESSAGE||c&&0!==e.parentMessageId&&e.parentMessageId===c)&&s.match(r._deserialize(e))}},i&&(t.channelUrl=i),o&&(t.sendingStatus=o),t={where:t,index:n,backward:u},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({})];case 2:return n=e.sent(),[2,Promise.all(n.map(function(o){return re(r,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return t=Ib.of(this._iid),n=this._deserialize(o),(r=o.messageParams)?n instanceof b0?(n.messageParams=t.buildUserMessageCreateParamsFromSerializedData(r,n),[3,4]):[3,1]:[3,4];case 1:return n instanceof T0?r.fileKey&&"string"==typeof r.fileKey&&sI(r.fileType)?(i=r,[4,this.collection.getBlob(r.fileKey)]):[3,3]:[3,4];case 2:i.file=e.sent(),e.label=3;case 3:n.messageParams=t.buildFileMessageCreateParamsFromSerializedData(r,n),e.label=4;case 4:return n.scheduledInfo&&o.scheduledInfo&&o.scheduledInfo.scheduledMessageParams?n instanceof b0?(s=o.scheduledInfo.scheduledMessageParams,n.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(s,n),[3,8]):[3,5]:[3,8];case 5:return n instanceof T0?(s=o.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof s.fileKey&&sI(s.fileType)?(a=s,[4,this.collection.getBlob(s.fileKey)]):[3,7]:[3,8];case 6:a.file=e.sent(),e.label=7;case 7:n.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(s,n),e.label=8;case 8:return[2,n]}})})}))];case 3:return[2,[]]}})})},SC.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new uC),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.fetch({filter:n,order:oC.NEWEST_CHILD_MESSAGE,channelUrl:t.channelUrl,backward:!1,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},SC.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,3];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},SC.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},SC.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=se(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})},SC.prototype.removeMessagesOfChannel=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t}})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},SC.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},SC.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(i){return re(t,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return i instanceof T0?i.messageParams&&(t=i.messageParams).file&&iI(t.file)?[4,this.collection.saveBlob(t.file,i.reqId)]:[3,2]:[3,4];case 1:r=e.sent(),t.fileKey=r,t.fileType=nI.BLOB,e.label=2;case 2:return i.scheduledInfo&&i.scheduledInfo.scheduledMessageParams&&(n=i.scheduledInfo.scheduledMessageParams).file&&iI(n.file)?[4,this.collection.saveBlob(n.file,i.reqId)]:[3,4];case 3:r=e.sent(),n.fileKey=r,n.fileType=nI.BLOB,e.label=4;case 4:return[2]}})})}))];case 1:return e.sent(),[2]}})})},SC),yC={},mC=(o(TC,fC=jn),TC.of=function(e){return yC[e]},Object.defineProperty(TC.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(TC.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),TC.prototype._serialize=function(e){return f(f({},e.serialize()),{messageId:"".concat(e.messageId)})},TC.prototype._deserialize=function(e){return e=f(f({},e),{messageId:parseInt(e.messageId)}),Ib.of(this._iid).buildMessageFromSerializedData(e)},TC.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},TC.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,t=e.limit,s=void 0===t?100:t,t=e.filter,a=void 0===t?new uC:t,t=e.order,o=void 0===t?oC.CHANNEL_LATEST:t,t=e.backward,u=void 0!==t&&t,t=e.parentMessageId,c=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=lC(o),t={where:{channelUrl:r,"/where":function(e){if(i)switch(o){case oC.CHANNEL_LATEST:if(!u&&e.createdAt>i||u&&e.createdAt<i)return!1;break;case oC.NEWEST_CHILD_MESSAGE:if(!c||0===e.parentMessageId||e.parentMessageId!==c)return!1}return a.match(n._deserialize(e))}},index:t,backward:u},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({limit:s})];case 2:return t=e.sent(),[2,Promise.all(t.map(function(i){return re(n,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=this._deserialize(i),(n=i.messageParams)?t instanceof b0?(t.messageParams=n,[3,4]):[3,1]:[3,4];case 1:return t instanceof T0?n.fileKey&&"string"==typeof n.fileKey&&sI(n.fileType)?(r=n,[4,this.collection.getBlob(n.fileKey)]):[3,3]:[3,4];case 2:r.file=e.sent(),e.label=3;case 3:t.messageParams=n,e.label=4;case 4:return[2,t]}})})}))];case 3:return[2,[]]}})})},TC.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new uC),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.fetch({channelUrl:t.channelUrl,token:Date.now(),limit:null,backward:!1,filter:n,order:oC.NEWEST_CHILD_MESSAGE,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},TC.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,5];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:return e.sent(),[4,this.upsertChildMessages(r)];case 3:return e.sent(),[4,this._unsentMessageCache.upsertChildMessages(r)];case 4:e.sent(),e.label=5;case 5:return[2]}})})},TC.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},TC.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=se(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})},TC.prototype.removeMessagesOfChannel=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:n},index:lC(oC.CHANNEL_LATEST)})]:[3,6];case 1:return e.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync"))];case 2:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync.meta"))];case 3:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs"))];case 4:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs.meta"))];case 5:e.sent(),e.label=6;case 6:return[2]}})})},TC.prototype.removeUnderOffset=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t,createdAt:{"<":n}},index:lC(oC.CHANNEL_LATEST)})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},TC.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},TC.prototype.countBetween=function(r,i,s){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=lC(oC.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:r,"/where":function(e){e=n._deserialize(e);return s.includes(e.createdAt)&&i.match(e)}},index:t}).count()]):[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},TC.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return r instanceof T0&&r.messageParams&&(t=r.messageParams).file&&iI(t.file)?[4,this.collection.saveBlob(t.file,r.reqId)]:[3,2];case 1:n=e.sent(),t.fileKey=n,e.label=2;case 2:return[2]}})})}))];case 1:return e.sent(),[2]}})})},TC),gC=(o(wC,dC=ay),wC),EC={},bC=(IC.of=function(e){return EC[e]},IC.prototype.processNonAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=se(t),r=n.next();!r.done;r=n.next())0===(i=r.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=Sm.FAILED,i.errorCode=d.ACK_TIMEOUT,this._dispatcher.dispatch(new J0({messages:[i],source:G0.LOCAL_MESSAGE_FAILED})))}catch(e){s={error:e}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}}return[2]}})})},IC.prototype.processAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=se(t),r=n.next();!r.done;r=n.next())(i=r.value).errorCode&&ny(i.errorCode)&&(s=(new Date).getTime(),a=i.createdAt+2592e5,s<=a?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),i.sendingStatus=Sm.FAILED,this._dispatcher.dispatch(new J0({messages:[i],source:G0.LOCAL_MESSAGE_FAILED}))))}catch(e){o={error:e}}finally{try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}}return[2]}})})},IC.prototype.completeCurrentAndProcessNextAutoResend=function(e){this._localCacheEnabled&&(e.sendingStatus===Sm.SUCCEEDED||e.sendingStatus===Sm.FAILED&&!ny(e.errorCode))&&(0<=(e=this.indexOf(e))&&this._autoResendQueue.splice(e,1),0===e&&this._processNextAutoResend())},IC.prototype._fetchAllCachedPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return(t=_C.of(this._iid))?[4,t.fetch({sendingStatus:Sm.PENDING,backward:!0})]:[3,2];case 1:return n=e.sent(),[3,3];case 2:n=[],e.label=3;case 3:return[2,n]}})})},IC.prototype.indexOf=function(e){return 0<this._autoResendQueue.length?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId):-1},IC.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId)},IC.prototype._processNextAutoResend=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{0<this._autoResendQueue.length?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new gC({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}return[2]})})},IC);function IC(e,t){var n=t.localCacheEnabled,r=t.dispatcher,i=t.sdkState,t=t.logger,s=this;(EC[e]=this)._iid=e,(EC[e]=this)._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=t,this._sdkState=i,this._localCacheEnabled&&r.on(function(e){if(e instanceof jm)switch(e.stateType){case im.CONNECTED:s._isProcessingAutoResend||s.processAutoResendRegisteredPendingMessages().then(function(){return s._processNextAutoResend()});break;case im.DISCONNECTED:s._isProcessingAutoResend=!1}})}function wC(e){var e=e.message,t=dC.call(this)||this;return t.message=e,t}function TC(e,t){var n=t.sdkState,r=t.cacheContext,t=t.unsentMessageCache,i=fC.call(this,e)||this;return i._sdkState=n,i._cacheContext=r,i._unsentMessageCache=t,yC[e]=i}function SC(e,t){var n=t.sdkState,t=t.cacheContext,r=pC.call(this,e)||this;return r._sdkState=n,r._cacheContext=t,vC[e]=r}(Fn=hC=hC||{})[Fn.USER_BLOCK=20001]="USER_BLOCK",Fn[Fn.USER_UNBLOCK=2e4]="USER_UNBLOCK",Fn[Fn.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED";KC.getDataAsUserBlockEvent=function(e,t){var t=t.data,n=t.blocker,t=t.blockee;return{blocker:new k(e,n),blockee:new k(e,t)}},KC.getDataAsFriendDiscoveredEvent=function(t,e){e=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(e)?e.map(function(e){return new k(t,e)}):[]}};var CC,kC,NC,AC,OC,RC,DC=KC,MC=(o(BC,RC=ay),BC),xC=(o(VC,OC=zy),VC),LC=(o(GC,AC=h),GC),PC=(o(HC,NC=S),HC),UC=(o(jC,kC=h),jC),qC=(o(FC,CC=S),FC);function FC(e,t){e=CC.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function jC(e){var t=e.userId,e=e.pushTriggerOption,n=kC.call(this)||this;return n.method=T.PUT,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push_preference"),n.params={push_trigger_option:e},n}function HC(e,t){e=NC.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function GC(e){var e=e.userId,t=AC.call(this)||this;return t.method=T.GET,t.path="".concat(ng,"/").concat(encodeURIComponent(e),"/push_preference"),t}function VC(e,t,n){e=OC.call(this,e,"USEV",n)||this;return e.event=new DC(n),e}function BC(e,t){var t=t.userId,n=RC.call(this)||this;return n._iid=e,n.userId=t,n}function KC(e){this.category=e.cat,this.data=e.data}var QC,zC,WC,YC,XC,JC,ZC={profileImage:null,profileUrl:null,nickname:null},$C=(o(function(){return null!==QC&&QC.apply(this,arguments)||this},QC=jn),o(uk,XC=my),Object.defineProperty(uk.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),uk.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=null,e.dispatch("pause")},3e4)),this._currentState=document.visibilityState},uk.prototype.start=function(){this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})},uk.prototype.stop=function(){this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})},uk),ek=(Object.defineProperty(ok.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),ok.prototype._onlineWorker=function(){this.connectionDelegate.reconnect()},ok.prototype._offlineWorker=function(){this.connectionDelegate.disconnect()},ok.prototype.start=function(){this.isAvailable&&(window.addEventListener("online",this._onlineWorker),window.addEventListener("offline",this._offlineWorker))},ok.prototype.stop=function(){this.isAvailable&&(window.removeEventListener("online",this._onlineWorker,!1),window.removeEventListener("offline",this._offlineWorker,!1))},ok.prototype.isOnline=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this.isAvailable?[2,navigator.onLine]:[2,new Promise(function(e,t){fetch("https://www.google.com",{method:T.GET}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},ok),tk=(o(ak,YC=h),ak),nk=(o(sk,WC=S),sk),rk=(o(ik,zC=h),ik);function ik(e){var t=e.userId,e=e.token,n=zC.call(this)||this;return n.method=T.POST,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push/apns"),n.params={apns_device_token:e,always_push:!0},n}function sk(e,t){var n=WC.call(this,e,t)||this;return n.user=null,n.user=new k(e,f({},t)),n}function ak(e){var t=e.userId,n=e.nickname,n=void 0===n?null:n,r=e.profileUrl,r=void 0===r?null:r,i=e.profileImage,i=void 0===i?null:i,e=e.preferredLanguages,e=void 0===e?null:e,s=YC.call(this)||this;return s.method=T.PUT,s.path="".concat(ng,"/").concat(encodeURIComponent(t)),s.params=w({nickname:n,profile_url:r,profile_file:i,preferred_languages:e}),s}function ok(e){var t=e.logger,e=e.connectionDelegate,e=void 0===e?null:e;this.logger=t,e&&(this.connectionDelegate=e),this._onlineWorker=this._onlineWorker.bind(this),this._offlineWorker=this._offlineWorker.bind(this)}function uk(){var e=XC.call(this)||this;return e._pauseDelayTimer=null,e._currentState="visible",e._toggleState=e._toggleState.bind(e),e}o(function(e,t){var n=JC.call(this,e,t)||this;return n.token=t.token,n.type=t.type?xS[t.type.toLowerCase()]:xS.UNKNOWN,n.user=new k(e,t.user),n},JC=S);o(dk,ck=h);var ck,lk,hk=dk;function dk(e){var t=e.userId,e=e.token,n=ck.call(this)||this;return n.method=T.POST,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push/gcm"),n.params={gcm_reg_token:e,always_push:!0},n}o(function(e,t){var n=lk.call(this,e,t)||this;return n.token=t.token,n.type=t.type?xS[t.type.toLowerCase()]:xS.UNKNOWN,n.user=new k(e,t.user),n},lk=S);o(_k,fk=h);var fk,pk,vk=_k;function _k(e){var t=e.userId,e=e.token,n=fk.call(this)||this;return n.method=T.DELETE,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push/apns/").concat(encodeURIComponent(e)),n}o(function(e,t){var n=pk.call(this,e,t)||this;return n.token=t.token,n.user=new k(e,t.user),n},pk=S);o(Ek,yk=h);var yk,mk,gk=Ek;function Ek(e){var t=e.userId,e=e.token,n=yk.call(this)||this;return n.method=T.DELETE,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push/gcm/").concat(encodeURIComponent(e)),n}o(function(e,t){var n=mk.call(this,e,t)||this;return n.token=t.token,n.user=new k(e,t.user),n},mk=S);o(Tk,bk=h);var bk,Ik,wk=Tk;function Tk(e){var e=e.userId,t=bk.call(this)||this;return t.method=T.DELETE,t.path="".concat(ng,"/").concat(encodeURIComponent(e),"/push/apns"),t}o(function(e,t){var n=Ik.call(this,e,t)||this;return n.type=t.type?xS[t.type.toLowerCase()]:xS.UNKNOWN,n.user=new k(e,t.user),n},Ik=S);o(Nk,Sk=h);var Sk,Ck,kk=Nk;function Nk(e){var e=e.userId,t=Sk.call(this)||this;return t.method=T.DELETE,t.path="".concat(ng,"/").concat(encodeURIComponent(e),"/push/gcm"),t}o(function(e,t){var n=Ck.call(this,e,t)||this;return n.type=t.type?xS[t.type.toLowerCase()]:xS.UNKNOWN,n.user=new k(e,t.user),n},Ck=S);o(EN,Vk=h);var Ak,Ok,Rk,Dk,Mk,xk,Lk,Pk,Uk,qk,Fk,jk,Hk,Gk,Vk,Bk,Kk=EN,Qk=(o(gN,Gk=S),gN),zk=(o(mN,Hk=h),mN),Wk=(o(yN,jk=S),yN),Yk=(o(_N,Fk=h),_N),Xk=(o(vN,qk=S),vN),Jk=(o(pN,Uk=h),pN),Zk=(o(fN,Pk=S),fN),$k=(o(dN,Lk=h),dN),eN=(o(hN,xk=S),hN),tN=(o(lN,Mk=h),lN),nN=(o(cN,Dk=S),cN),rN=(o(uN,Rk=h),uN),iN=(o(oN,Ok=S),oN),sN=(o(aN,Ak=h),aN);function aN(e){var t=e.userId,e=e.blockedUserId,n=Ak.call(this)||this;return n.method=T.POST,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/block"),n.params={target_id:e},n}function oN(e,t){e=Ok.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function uN(e){var t=e.userId,n=e.snoozeOn,r=e.startTs,e=e.endTs,i=Rk.call(this)||this;return i.method=T.PUT,i.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push_preference"),i.params={snooze_enabled:n,snooze_start_ts:r,snooze_end_ts:e},i}function cN(e,t){e=Dk.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function lN(e){var e=e.userId,t=Mk.call(this)||this;return t.method=T.GET,t.path="".concat(ng,"/").concat(encodeURIComponent(e),"/push_preference"),t}function hN(e,t){e=xk.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function dN(e){var t=e.userId,n=e.doNotDisturbOn,r=e.startHour,i=e.startMin,s=e.endHour,a=e.endMin,e=e.timezone,o=Lk.call(this)||this;return o.method=T.PUT,o.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push_preference"),o.params={do_not_disturb:n,start_hour:r,start_min:i,end_hour:s,end_min:a,timezone:e},o}function fN(e,t){e=Pk.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function pN(e){var e=e.userId,t=Uk.call(this)||this;return t.method=T.GET,t.path="".concat(ng,"/").concat(encodeURIComponent(e),"/push_preference"),t}function vN(e,t){e=qk.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function _N(e){var t=e.userId,e=e.willAutoAccept,n=Fk.call(this)||this;return n.method=T.PUT,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/channel_invitation_preference"),n.params={auto_accept:e},n}function yN(e,t){e=jk.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function mN(e){var e=e.userId,t=Hk.call(this)||this;return t.method=T.GET,t.path="".concat(ng,"/").concat(encodeURIComponent(e),"/channel_invitation_preference"),t}function gN(e,t){e=Gk.call(this,e,t)||this;return e.pushTokens={type:t.type?xS[t.type.toLowerCase()]:xS.UNKNOWN,deviceTokens:t.device_tokens,hasMore:t.has_more,token:t.token},e}function EN(e){var t=e.userId,n=e.type,r=e.token,e=e.ts,i=Vk.call(this)||this;return i.method=T.GET,i.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push/").concat(encodeURIComponent(n),"/device_tokens"),i.params={created_ts:e,token:r},i}o(function(e,t){var n=Bk.call(this,e,t)||this;return n.user=new k(e,t),n},Bk=S);o(TN,bN=h);var bN,IN,wN=TN;function TN(e){var t=e.userId,e=e.unblockedUserId,n=bN.call(this)||this;return n.method=T.DELETE,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/block/").concat(encodeURIComponent(e)),n}o(function(){return null!==IN&&IN.apply(this,arguments)||this},IN=S);o(ZN,MN=h);var SN,CN,kN,NN,AN,ON,RN,DN,MN,xN,LN=ZN,PN=(o(JN,DN=S),JN),UN=(o(XN,RN=h),XN),qN=(o(YN,ON=S),YN),FN=(o(WN,AN=h),WN),jN=(o(zN,NN=S),zN),HN=(o(QN,kN=h),QN),GN=(o(KN,CN=S),KN),VN=(o(BN,SN=h),BN);function BN(e){var t=e.userId,e=e.discoveryKeys,n=SN.call(this)||this;return n.method=T.DELETE,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discovery_keys:e},n}function KN(e,t){e=CN.call(this,e,t)||this;return e.friendDiscoveryRequestId=t.friend_discovery_request_id,e}function QN(e){var t=e.userId,e=e.discoveries,n=kN.call(this)||this;return n.method=T.PUT,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discoveries:e.map(function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}})},n}function zN(t,e){var n=NN.call(this,t,e)||this;return n.changelogs={addedUsers:e.added.map(function(e){return new k(t,e)}),updatedUsers:e.updated.map(function(e){return new k(t,e)}),deletedUserIds:e.deleted,hasMore:e.has_more,token:e.next},n}function WN(e){var t=e.userId,e=e.token,n=AN.call(this)||this;return n.method=T.GET,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/friends/changelogs"),n.params={token:e},n}function YN(e,t){e=ON.call(this,e,t)||this;return e.name=t.name,e}function XN(e){var t=e.userId,e=e.templateName,n=RN.call(this)||this;return n.method=T.PUT,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/push/template"),n.params={name:e},n}function JN(e,t){e=DN.call(this,e,t)||this;return e.name=t.name,e}function ZN(e){var e=e.userId,t=MN.call(this)||this;return t.method=T.GET,t.path="".concat(ng,"/").concat(encodeURIComponent(e),"/push/template"),t}o(function(){return null!==xN&&xN.apply(this,arguments)||this},xN=S);o(u1,t1=h);var $N,e1,t1,n1,r1=u1,i1=(o(o1,e1=S),o1),s1=(o(a1,$N=h),a1);function a1(e){var t=e.userId,e=e.userIds,n=$N.call(this)||this;return n.method=T.DELETE,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}function o1(t,e){var n=e1.call(this,t,e)||this;return n.users=e.users.map(function(e){return new k(t,e)}),n}function u1(e){var t=e.userId,e=e.userIds,n=t1.call(this)||this;return n.method=T.POST,n.path="".concat(ng,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}o(function(){return null!==n1&&n1.apply(this,arguments)||this},n1=S);o(m1,h1=h);var c1,l1,h1,d1,f1=m1,p1=(o(y1,l1=S),y1),v1=(o(_1,c1=h),_1);function _1(e){var t=e.userId,e=e.allowFriendDiscovery,n=c1.call(this)||this;return n.method=T.PUT,n.path="".concat(ng,"/").concat(t,"/allow_friend_discovery"),n.params={allow_friend_discovery:e},n}function y1(e,t){e=l1.call(this,e,t)||this;return e.allowFriendDiscovery=t.allow_friend_discovery,e}function m1(e){var e=e.userId,t=h1.call(this)||this;return t.method=T.GET,t.path="".concat(ng,"/").concat(e,"/allow_friend_discovery"),t.params={},t}o(function(){return null!==d1&&d1.apply(this,arguments)||this},d1=S);function g1(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map(function(e){return new U1(e)}):[]}var E1,b1,I1,w1,T1,S1,C1,k1,N1,A1,O1,R1,D1,M1,x1,L1,P1=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url},U1=function(e){var t;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!=(t=e.id)?t:0,this.name=null!=(t=e.name)?t:"",this.url=null!=(t=e.url)?t:"",this.emojis=e.emojis?e.emojis.map(function(e){return new P1(e)}):[]},q1=(o(_A,L1=h),_A),F1=(o(vA,x1=S),vA),j1=(o(pA,M1=h),pA),H1=(o(fA,D1=S),fA),G1=(o(dA,R1=h),dA),V1=(o(hA,O1=S),hA),B1=(o(lA,A1=h),lA),K1=(o(cA,N1=S),cA),Q1=(o(uA,k1=s),uA.prototype._validate=function(){return k1.prototype._validate.call(this)&&hy("string",this.userIdsFilter,!0)&&c("string",this.metaDataKeyFilter,!0)&&hy("string",this.metaDataValuesFilter,!0)&&c("string",this.metaDataKeyFilter,!0)},uA.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new B1(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(K1),r=n.users,i=n.next,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},uA),z1=(o(oA,C1=h),oA),W1=(o(aA,S1=S),aA),Y1=(o(sA,T1=s),sA.prototype._validate=function(){return T1.prototype._validate.call(this)&&hy("string",this.userIdsFilter,!0)},sA.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new z1(f(f({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(W1),r=n.users,i=n.next,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},sA),X1=(o(iA,w1=h),iA),J1=(o(rA,I1=S),rA),Z1=(o(nA,b1=s),nA.prototype._validate=function(){return b1.prototype._validate.call(this)},nA.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new X1(f(f({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(J1),r=n.users,i=n.hasMore,s=n.next,this._token=s,this._hasNext=i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},nA),$1={},eA=(tA.get=function(e){return $1[e]},tA);function tA(e){var t=e.dbname,n=e.itemSizeLimit,r=e.cacheLimit,r=void 0===r?256:r,i=e.blockHashBase,i=void 0===i?2:i,s=e.blockHashMultiplier,s=void 0===s?10:s,a=e.blockHashConstant,a=void 0===a?11:a,o=e.transactionApplyDelay,o=void 0===o?200:o,e=e.disableLogger,e=void 0!==e&&e;return $1[t]||(this.itemSizeLimit=void 0===n?1048576:n,this.cacheLimit=r,this.blockHashBase=i,this.blockHashMultiplier=s,this.blockHashConstant=a,this.transactionApplyDelay=o,this.disableLogger=e,$1[t]=this),$1[t]}function nA(){return null!==b1&&b1.apply(this,arguments)||this}function rA(t,e){var n=I1.call(this,t,e)||this;return n.hasMore=e.has_more,n.users=e.users.map(function(e){return new k(t,e)}),n.next=e.next,n}function iA(e){var t=e.userId,n=e.limit,e=e.token,r=w1.call(this)||this;return r.method=T.GET,r.path="".concat(ng,"/").concat(encodeURIComponent(t),"/friends"),r.params={limit:n,token:e},r}function sA(e,t){var n=this;return(n=T1.call(this,e,t)||this).userIdsFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n}function aA(t,e){var n=S1.call(this,t,e)||this;return n.users=e.users.map(function(e){return new k(t,e)}),n.next=e.next,n}function oA(e){var t=e.userId,n=e.limit,r=e.token,e=e.userIdsFilter,i=C1.call(this)||this;return i.method=T.GET,i.path="".concat(ng,"/").concat(t,"/block"),i.params=w({limit:n,token:r,user_ids:e}),i}function uA(e,t){var n=this;return(n=k1.call(this,e,t)||this).userIdsFilter=null,n.metaDataKeyFilter=null,n.metaDataValuesFilter=null,n.nicknameStartsWithFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n.metaDataKeyFilter=null!=(e=t.metaDataKeyFilter)?e:null,n.metaDataValuesFilter=null!=(e=t.metaDataValuesFilter)?e:null,n.nicknameStartsWithFilter=t.nicknameStartsWithFilter||null,n}function cA(t,e){var n=N1.call(this,t,e)||this;return n.users=e.users.map(function(e){return new k(t,e)}),n.next=e.next,n}function lA(e){var t=e.limit,n=e.token,r=e.userIdsFilter,i=e.metaDataKeyFilter,s=e.metaDataValuesFilter,e=e.nicknameStartsWithFilter,a=A1.call(this)||this;return a.method=T.GET,a.path=ng,a.params=w({limit:t,token:n,user_ids:r,metadatakey:i,metadatavalues_in:s,nickname_startswith:e}),a}function hA(e,t){e=O1.call(this,e,t)||this;return e.emoji=new P1(t),e}function dA(e){var e=e.key,t=R1.call(this)||this;return t.method=T.GET,t.path="".concat(cg,"/").concat(e),t}function fA(e,t){e=D1.call(this,e,t)||this;return e.emojiCategory=new U1(t),e}function pA(e){var e=e.categoryId,t=M1.call(this)||this;return t.method=T.GET,t.path="".concat(lg,"/").concat(e),t}function vA(e,t){e=x1.call(this,e,t)||this;return e.emojiContainer=new g1(t),e}function _A(){var e=L1.call(this)||this;return e.method=T.GET,e.path=lg,e}(e=E1=E1||{})[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND";o(O,mA=Error),Object.defineProperty(O,"storeNotDefined",{get:function(){return new O({code:E1.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailable",{get:function(){return new O({code:E1.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailableInPrivateBrowsing",{get:function(){return new O({code:E1.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeIsFull",{get:function(){return new O({code:E1.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeKeyTypeIsInvalid",{get:function(){return new O({code:E1.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenIntegrity",{get:function(){return new O({code:E1.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenBlob",{get:function(){return new O({code:E1.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeEncryptionInvalid",{get:function(){return new O({code:E1.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeItemSizeExceeded",{get:function(){return new O({code:E1.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeReadFailed",{get:function(){return new O({code:E1.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeWriteFailed",{get:function(){return new O({code:E1.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"databaseSchemaNotOnUpgrade",{get:function(){return new O({code:E1.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionNotReady",{get:function(){return new O({code:E1.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotMatch",{get:function(){return new O({code:E1.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionQueryNotValid",{get:function(){return new O({code:E1.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionInsertDuplicate",{get:function(){return new O({code:E1.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotFound",{get:function(){return new O({code:E1.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotGiven",{get:function(){return new O({code:E1.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionWriteFailed",{get:function(){return new O({code:E1.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionItemSizeExceeded",{get:function(){return new O({code:E1.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTableIsRequired",{get:function(){return new O({code:E1.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTypesNotMatch",{get:function(){return new O({code:E1.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"compareTypesNotMatch",{get:function(){return new O({code:E1.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"circularReferenceFound",{get:function(){return new O({code:E1.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0});var yA,mA,gA=O;function O(e){var t=e.code,t=void 0===t?E1.UNKNOWN_ERROR:t,e=e.message,e=mA.call(this,void 0===e?"Unknown error occurred.":e)||this;return e.code=t,Object.setPrototypeOf(e,O.prototype),e}(Yt=yA=yA||{}).INIT="init",Yt.READY="ready",Yt.CLOSED="closed";function EA(e,t){if(void 0===t&&(t=new WeakMap),"object"!=typeof e||null===e)return e;if(t.has(e))throw gA.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map(function(e){return EA(e,t)});else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=EA(e[r],t);return t.delete(e),n}function bA(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw gA.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n}function IA(t){return new Promise(function(e){setTimeout(function(){return e()},t)})}function wA(e,t){if(t){if("function"==typeof e)return e(t);for(var n in e)if(["/and","&&"].includes(n)){if(e[n].some(function(e){return!wA(e,t)}))return}else if(["/or","||"].includes(n)){if(e[n].every(function(e){return!wA(e,t)}))return}else if("/where"===n){if(!(0,e[n])(t))return}else{var r=n;if("object"==typeof e[r]){var i,s=e[r];for(i in s)switch(i){case"/eq":case"=":if((a=t[r])!==(o=s[i]))return;break;case"/neq":case"!=":if((a=t[r])===(o=s[i]))return;break;case"/gt":case">":var a=t[r],o=s[i];if(0<bA(a,o))break;return;case"/gte":case">=":if(a=t[r],o=s[i],0<=bA(a,o))break;return;case"/lt":case"<":if(a=t[r],o=s[i],bA(a,o)<0)break;return;case"/lte":case"<=":if(a=t[r],o=s[i],bA(a,o)<=0)break;return;case"/in":if(a=t[r],(o=s[i]).includes(a))break;return;case"/nin":if(a=t[r],(o=s[i]).includes(a))return;break;case"/contain":if(a=t[r],o=s[i],a.includes(o))break;return;case"/regex":if(a=t[r],(o=s[i]).test(a))break;return;case"/where":if(a=t[r],!(0,s[i])(a))return}}else if("function"==typeof e[r]){if(!e[r](t[r]))return}else if(e[r]!==t[r])return}return 1}}function TA(){}function SA(){return Promise.resolve()}function CA(e){return e}function kA(e,t){t(null)}var NA=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t};function AA(e,t){return"".concat(jA(e,t),".metadata")}function OA(e,t){return"".concat(jA(e,t),"/block.")}function RA(e,t){return"".concat(jA(e,t),"/blob.")}function DA(e,t,n,r){return void 0===r&&(r=0),"".concat(RA(e,t)).concat(n,".").concat(r)}Object.defineProperty(KA.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(KA.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(KA.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(KA.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(KA.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),KA.prototype.prev=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:if(!this.hasPrevious)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._prevValue,[4,(n=this)._backward()];case 2:return n._prevValue=e.sent()||null,this._nextValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},KA.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:if(!this.hasNext)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._nextValue,[4,(n=this)._forward()];case 2:return n._nextValue=e.sent()||null,this._prevValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},KA.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()};var MA,xA,LA,PA=KA,UA=(BA.prototype.findOptimizedStartPosition=function(){var s=this,a=["=","/eq",">",">=","/gt","/gte"],o=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var e=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var t in this._indexer.fields){var n=this._indexer.fields[t],r=1;if("-"===n[0]&&(n=n.slice(1),r=-1),this.condition[n])if("object"==typeof this.condition[n]){var i,u=0<r?o:a;for(i in this.condition[n])if(u.includes(i))for(var c=e;0<=c;c--)if(r*bA(this._indexer.origin[c].columnValues[t],this.condition[n][i])<=0){e=c;break}}else for(c=e;0<=c;c--)if(r*bA(this._indexer.origin[c].columnValues[t],this.condition[n])<=0){e=c;break}}return Math.min(e+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=this,t=0;t<this._indexer.fields.length;t++)!function(n){var r=h._indexer.fields[n],i=1;if("-"===r[0]&&(r=r.slice(1),i=-1),h.condition[r])if("object"==typeof h.condition[r])Object.keys(h.condition[r]).forEach(function(e){if((0<i?a:o).includes(e))for(var t=l;t<s._indexer.origin.length;t++)if(0<=i*bA(s._indexer.origin[t].columnValues[n],s.condition[r][e])){l=t;break}});else for(var e=l;e<h._indexer.origin.length;e++)if(0<=i*bA(h._indexer.origin[e].columnValues[n],h.condition[r])){l=e;break}}(t);return Math.max(l-1,0)},BA.prototype.each=function(c){return re(this,void 0,void 0,function(){var r,i,s,a,t,n,o,u=this;return ie(this,function(e){switch(e.label){case 0:if(r=this.findOptimizedStartPosition(),i=0,this.backward&&this._indexer.origin[r]&&(i=this._indexer.origin[r].keys.length-1),s=function(){if(u._indexer.origin[r]){if(!u._indexer.origin[r].keys[++i]){if(!u._indexer.origin[++r])return!1;i=0}return!0}return!1},a=function(){if(u._indexer.origin[r]){if(!u._indexer.origin[r].keys[--i]){if(!u._indexer.origin[--r])return!1;i=u._indexer.origin[r].keys.length-1}return!0}return!1},t=null,!this._indexer.origin[r])return[3,4];n=this.backward?a:s,e.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])];case 2:if(o=e.sent(),wA(this.condition,o))return t=o,[3,4];e.label=3;case 3:if(n())return[3,1];e.label=4;case 4:return[4,new Promise(function(e){e=new PA({initialNextValue:EA(t),iterator:c,forward:function(){return re(u,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:t=this.backward?a:s,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])]:[3,3];case 2:return n=e.sent(),wA(this.condition,n)?[2,EA(n)]:[3,1];case 3:return[2,null]}})})},backward:function(){return re(u,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:t=this.backward?s:a,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])]:[3,3];case 2:return n=e.sent(),wA(this.condition,n)?[2,EA(n)]:[3,1];case 3:return[2,null]}})})},complete:e});c(e)})];case 5:return[2,e.sent()]}})})},BA),qA=(VA.prototype.fetch=function(a){return void 0===a&&(a={}),re(this,void 0,void 0,function(){var n,r,i,t,s=this;return ie(this,function(e){switch(e.label){case 0:if(n=Math.max(a.offset||0,0),0===(r="number"==typeof a.limit?a.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(r<0)throw gA.collectionQueryNotValid;e.label=1;case 1:return e.trys.push([1,4,,5]),i=[],[4,this._mutex.lock()];case 2:return e.sent(),[4,this._iterator.each(function(t){return re(s,void 0,void 0,function(){return ie(this,function(e){return!t.error&&t.hasNext?0===n?(i.push(t.nextValue),0<r&&r<=i.length?t.stop():t.next()):(n--,t.next()):t.stop(),[2]})})})];case 3:return e.sent(),this._mutex.unlock(),[2,i];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[2]}})})},VA.prototype.count=function(){return re(this,void 0,void 0,function(){var n,t,r=this;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),n=0,[4,this._mutex.lock()];case 1:return e.sent(),[4,this._iterator.each(function(t){return re(r,void 0,void 0,function(){return ie(this,function(e){return!t.error&&t.hasNext?(n++,t.next()):t.stop(),[2]})})})];case 2:return e.sent(),this._mutex.unlock(),[2,n];case 3:throw t=e.sent(),this._mutex.unlock(),t;case 4:return[2]}})})},VA),FA=function(e){return"".concat("nest","@").concat(e)},jA=function(e,t){return"".concat(FA(e),"/").concat(t)},HA=(GA.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(0<n){for(var r=Math.ceil(e.data.length/n),r="".concat(r,".").concat(e.type,".").concat(t),i=[],s=0;s<e.data.length;s+=n){var a=e.data.slice(s,s+n);i.push(a)}return{blobId:r,shards:i}}return{blobId:null,shards:null}},GA.prototype._encode=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){var t=new FileReader;t.onload=function(){e({data:t.result,type:n.type})},t.readAsDataURL(n)})];case 1:return[2,e.sent()]}})})},GA.prototype._decode=function(o){return re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return"undefined"==typeof fetch?[3,3]:[4,fetch(o.data)];case 1:return[4,e.sent().blob()];case 2:return[2,e.sent()];case 3:for(t=[],n=atob(o.data.split(",")[1]),r=0;r<n.length;r+=512){for(i=n.slice(r,r+512),s=new Array(i.length),a=0;a<i.length;a++)s[a]=i.charCodeAt(a);t.push(new Uint8Array(s))}return[2,new Blob(t,{type:o.type})]}})})},GA.prototype.get=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(t=[],n=X_(a.split("."),2),r=n[0],n=n[1],!(0<(r=parseInt(r))))return[3,6];i=0,e.label=1;case 1:return i<r?(s=DA(this.dbname,this.collectionName,a,i),[4,this._store.get(s)]):[3,4];case 2:if(!(s=e.sent())||!s.d)throw gA.storeBrokenBlob;t.push(s.d),e.label=3;case 3:return i++,[3,1];case 4:return[4,this._decode({data:t.join(""),type:n})];case 5:return[2,e.sent()];case 6:return[2,null]}})})},GA.prototype.save=function(o,u){return void 0===u&&(u="".concat(Date.now())),re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return t=[],[4,this._encode(o)];case 1:if(n=e.sent(),n=this._makeShards(n,u),r=n.blobId,i=n.shards,!r)return[3,3];for(s=0;s<i.length;s++)a=DA(this.dbname,this.collectionName,r,s),t.push({key:a,value:{d:i[s]},generation:1});return[4,this._store.setMany(t)];case 2:if(e.sent().some(function(e){return e instanceof Error}))throw gA.storeWriteFailed;return[2,r];case 3:return[2,null]}})})},GA.prototype.remove=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:if(t=[],n=X_(s.split("."),1),n=n[0],!(0<(r=parseInt(n))))return[3,2];for(i=0;i<r;i++)t.push(DA(this.dbname,this.collectionName,s,i));return[4,this._store.removeMany(t)];case 1:e.sent(),e.label=2;case 2:return[2]}})})},GA.prototype.clear=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=RA(this.dbname,this.collectionName),n=[],[4,this._store.getAllKeys()];case 1:r=e.sent();try{for(i=se(r),s=i.next();!s.done;s=i.next())(a=s.value).startsWith(t)&&n.push(a)}catch(e){o={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(o)throw o.error}}return[4,this._store.removeMany(r)];case 2:return e.sent(),[2]}})})},GA);function GA(e){var t=e.dbname,n=e.collectionName,e=e.store;this.dbname=t,this.collectionName=n,this._store=e}function VA(e){var t=e.condition,t=void 0===t?{}:t,n=e.backward,n=void 0!==n&&n,r=e.mutex,i=e.blockManager,e=e.indexer;this._mutex=r,this._iterator=new UA({condition:t,backward:n,blockManager:i,indexer:e})}function BA(e){var t=e.condition,n=e.backward,n=void 0!==n&&n,r=e.blockManager,e=e.indexer;this.condition=void 0===t?{}:t,this.backward=n,this._blockManager=r,this._indexer=e}function KA(e){var t=e.initialPrevValue,n=e.initialNextValue,n=void 0===n?null:n,r=e.iterator,i=e.map,i=void 0===i?CA:i,s=e.backward,s=void 0===s?SA:s,a=e.forward,a=void 0===a?SA:a,e=e.complete,e=void 0===e?TA:e;this._prevValue=void 0===t?null:t,this._nextValue=n,this._error=null,this._map=i,this._backward=s,this._forward=a,this._iterator=r,this._complete=e}(Gn=MA=MA||{})[Gn.COMMIT=0]="COMMIT",Gn[Gn.WRITE=1]="WRITE",Gn[Gn.ERROR=2]="ERROR",(nt=xA=xA||{}).PENDING="pending",nt.PERSISTENT="persistent",nt.VOLATILE="volatile",(mt=LA=LA||{})[mt.NO_CACHE=0]="NO_CACHE",mt[mt.DEFAULT=1]="DEFAULT",mt[mt.PERSISTENT=2]="PERSISTENT";var QA=[xA.PENDING,xA.VOLATILE],zA={},WA=(iO.get=function(e){return zA[e]},Object.defineProperty(iO.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),iO.prototype.find=function(r,i,s){return void 0===s&&(s=LA.DEFAULT),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return(t=this.get(i))?[3,2]:[4,r.get(i)];case 1:return(n=e.sent())&&(t={key:i,value:n,generation:1,state:s===LA.PERSISTENT?xA.PERSISTENT:xA.VOLATILE},this.put(t)),[3,3];case 2:s===LA.PERSISTENT&&(t.state=xA.PERSISTENT),e.label=3;case 3:return[2,t]}})})},iO.prototype.get=function(e,t){void 0===t&&(t=LA.DEFAULT);var e=this._items.map(function(e){return e.key}).indexOf(e);return-1<e?(e=this._items[e],t===LA.PERSISTENT&&(e.state=xA.PERSISTENT),t!==LA.NO_CACHE&&this.put(e),e):null},iO.prototype.put=function(e){var t,n;if(0<this._limit){var r=this._items.map(function(e){return e.key}).indexOf(e.key);if(-1<r)QA.includes(this._items[r].state)&&QA.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter(function(e){return e.state===xA.VOLATILE}).length-this._limit;if(0<i){var s=[];try{for(var a=se(this._items),o=a.next();!o.done;o=a.next()){var u=o.value;u.state===xA.VOLATILE&&0<i?i--:s.push(u)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this._items=s}}}},iO.prototype.remove=function(e){e=this._items.map(function(e){return e.key}).indexOf(e);-1<e&&this._items.splice(e,1)},iO.prototype.clearByCondition=function(t){this._items=this._items.filter(function(e){return!t(e)})},iO.prototype.clear=function(e){this._items=(e=void 0===e?!1:e)?[]:this._items.filter(function(e){return e.state!==xA.VOLATILE})},iO),YA=(Object.defineProperty(rO.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(rO.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),rO.prototype._getReducedRecordset=function(n){return void 0===n&&(n=[]),re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=e.sent()||[]).push.apply(t,J_([],X_(n),!1)),[2,this._reduceRecordSet(t)]}})})},rO.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;0<=r;r--){for(var i=e[r],s=[],a=i.requests.length-1;0<=a;a--){var o=i.requests[a],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0)}0<s.length&&(i.requests=s,t.unshift(i))}return t},rO.prototype._applyRecord=function(c,l){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:t=WA.get(this.dbname),n=l.generation,r=l.requests,i=null,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.setMany(r.map(function(e){return f(f({},e.data),{generation:n})}))];case 2:for(s=e.sent(),a=0;a<r.length;a++)s[a]instanceof Error&&(i=i||s[a],o=r[a].data,t.put(f(f({},o),{generation:n,state:xA.PERSISTENT})));return[3,4];case 3:return u=e.sent(),i=u,[3,4];case 4:return i?[3,6]:(u=c.filter(function(e){return e.generation!==n}),[4,this._store.set({key:this.recordsetKey,value:u,generation:n})]);case 5:return e.sent(),this._onWrite.forEach(function(e){e(r.map(function(e){return e.data}))}),[3,7];case 6:this._onError.forEach(function(e){return e(i)}),e.label=7;case 7:return[2]}})})},rO.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return[4,(t=this)._store.get(this.metadataKey)];case 1:return t._metadata=e.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:n=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),r=se(n),i=r.next(),e.label=4;case 4:return i.done?[3,7]:(s=i.value,[4,this._applyRecord(n,s)]);case 5:e.sent(),e.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return s=e.sent(),a={error:s},[3,10];case 9:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},rO.prototype.on=function(e,t,n){switch(e){case MA.COMMIT:this._onCommit.set(t,n);break;case MA.WRITE:this._onWrite.set(t,n);break;case MA.ERROR:this._onError.set(t,n)}},rO.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t=void 0===t?null:t}),WA.get(this.dbname).put(f({state:xA.PENDING,generation:this.generation},e))},rO.prototype.requestMultipleWrite=function(e,t){void 0===t&&(t=null);var n,r,i=WA.get(this.dbname);try{for(var s=se(e),a=s.next();!a.done;a=s.next()){var o=a.value;this._requests.push({data:o,options:t}),i.put(f({state:xA.PENDING,generation:this.generation},o))}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},rO.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return WA.get(this.dbname).clearByCondition(function(e){return e.state===xA.PENDING}),this._requests=[],[2]})})},rO.prototype.commit=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d=this;return ie(this,function(e){switch(e.label){case 0:if(!(0<(t=this._requests).length))return[3,4];for(n=[],r={},u=t.length-1;0<=u;u--)i=t[u],c=i.data,r[c.key]||(r[c.key]=!0,n.unshift(i));return s={generation:this.generation,requests:n},[4,this._getReducedRecordset([s])];case 1:return a=e.sent(),[4,this._store.set({key:this.recordsetKey,value:a,generation:this.generation})];case 2:return e.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(e.sent(),o=WA.get(this.dbname),u=0;u<n.length;u++)l=n[u],c=l.data,l=l.options,o.put(f(f({},c),{generation:s.generation,state:l&&l.persistent?xA.PERSISTENT:xA.VOLATILE}));this._requests=[],this._onCommit.forEach(function(e){e(t.map(function(e){return e.data}))}),h=eA.get(this.dbname),setTimeout(function(){try{d._applyRecord(a,s)}catch(t){d._onError.forEach(function(e){return e(t)})}},h.transactionApplyDelay),e.label=4;case 4:return[2]}})})},rO),XA=(nO.createFromCacheItem=function(e){return e?new nO(e.value):null},Object.defineProperty(nO.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(nO.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),nO.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},nO.prototype.getItemByKey=function(t){var n=this;return this._items.find(function(e){e=e[n.keyName];return t===e})},nO.prototype.has=function(e){var t=this;return this._items.map(function(e){return e[t.keyName]}).includes(e)},nO.prototype.add=function(e){var t=this,n=this._items.map(function(e){return e[t.keyName]}).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},nO.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},nO.prototype.clear=function(){this._items=[]},nO),JA=(Object.defineProperty(tO.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),tO.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,e="".concat(function(e,t,n){t=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||NA)(e,t)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(OA(n,r)).concat(i,".").concat(e);var n,r,i},tO.prototype._findBlock=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:t=WA.get(this.dbname),n=this.metadata.blockLevel,e.label=1;case 1:return 0<n?(r=this.createBlockId(s,n),[4,t.find(this._store,r)]):[3,4];case 2:if((r=e.sent())&&(i=XA.createFromCacheItem(r)).getItemByKey(s))return[2,i];e.label=3;case 3:return n--,[3,1];case 4:return[2,null]}})})},tO.prototype.getFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return[2,(t=e.sent())?t.getItemByKey(n):null]}})})},tO.prototype.putToBlock=function(i,s){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return n=eA.get(this.dbname),t=this.createBlockId(i),n=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,WA.get(this.dbname).find(this._store,t)];case 1:return r=e.sent(),(r=r?XA.createFromCacheItem(r):new XA({blockId:t,keyName:this.keyName,items:[],limit:n})).add(s)?(this._transaction.requestWrite({key:r.blockId,value:r.serialize()}),[2,!0]):[2,!1]}})})},tO.prototype.removeFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return(t=e.sent())&&t.remove(n)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}})})},tO.prototype.clearAllBlocks=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=OA(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return n=e.sent(),n=n.filter(function(e){return e.startsWith(t)}),[4,this._store.removeMany(n)];case 2:e.sent(),r=WA.get(this.dbname);try{for(i=se(n),s=i.next();!s.done;s=i.next())a=s.value,r.remove(a)}catch(e){o={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(o)throw o.error}}return[2]}})})},tO),ZA=(eO.createKey=function(e){return e.join(">")},eO.parseKey=function(e){return e.split(">")},eO.prototype._addItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),n=X_(this.indexOf(e),2),r=n[0];return n[1]?!this._table[r].keys.includes(t)&&(this._table[r].keys.push(t),!0):(this._table.splice(r,0,{columnValues:e,keys:[t]}),!0)},eO.prototype._removeItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),e=X_(this.indexOf(e),2),n=e[0];if(e[1]){e=this._table[n].keys.indexOf(t);if(-1<e)return this._table[n].keys.splice(e,1),0===this._table[n].keys.length&&this._table.splice(n,1),!0}return!1},Object.defineProperty(eO.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(eO.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),eO.prototype.getColumnValues=function(e){var t,n,r=[];try{for(var i=se(this.fields),s=i.next();!s.done;s=i.next()){var a,o=s.value,u=e[o="-"===o[0]?o.slice(1):o];if(a=typeof u,null!==u&&"undefined"!=a&&"boolean"!=a&&"number"!=a&&"string"!=a)throw gA.indexTypesNotMatch;r.push(e[o])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},eO.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,n=bA(e[n],t[n]);if(0!==n)return r*n}return 0},eO.prototype.indexOf=function(e){if(0<this._table.length){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(0<i)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},eO.prototype.ensure=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d,f,p,v;return ie(this,function(e){switch(e.label){case 0:return[4,(t=WA.get(this.dbname)).find(this._store,this.indexerKey,LA.PERSISTENT)];case 1:return(n=e.sent())?[3,11]:(r=OA(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:i=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),s=se(i),a=s.next(),e.label=4;case 4:return a.done?[3,7]:(o=a.value).startsWith(r)?[4,t.find(this._store,o,LA.NO_CACHE)]:[3,6];case 5:o=e.sent(),h=XA.createFromCacheItem(o);try{for(p=void 0,u=se(h.items),c=u.next();!c.done;c=u.next())l=c.value,this._addItem(l)}catch(e){p={error:e}}finally{try{c&&!c.done&&(v=u.return)&&v.call(u)}finally{if(p)throw p.error}}e.label=6;case 6:return a=s.next(),[3,4];case 7:return[3,10];case 8:return h=e.sent(),d={error:h},[3,10];case 9:try{a&&!a.done&&(f=s.return)&&f.call(s)}finally{if(d)throw d.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=n.value,this._table=EA(this._origin),e.label=12;case 12:return[2]}})})},eO.prototype.drop=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return WA.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}})})},eO.prototype.addItem=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._addItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},eO.prototype.removeItem=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._removeItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},eO.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},eO.prototype.commit=function(){this._origin=this._table,this._table=EA(this._origin)},eO.prototype.abort=function(){this._table=EA(this._origin)},eO),$A="undefined"!=typeof document&&"undefined"!=typeof navigator;function eO(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,e=e.store,a=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=(t=this.dbname,n=this.collectionName,r=this.fields.join(">"),"".concat(jA(t,n),"/index.").concat(r)),this._transaction=s,this._store=e,this._transaction.on(MA.COMMIT,this.indexerKey,function(){return a.commit()}),this._transaction.on(MA.ERROR,this.indexerKey,function(){return a.abort()})}function tO(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,i=void 0===i?NA:i,s=e.transaction,e=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=i,this.metadata=r,this._transaction=s,this._store=e}function nO(e){var t=e.blockId,n=e.keyName,r=e.items,r=void 0===r?[]:r,e=e.limit;this.blockId=t,this.keyName=n,this.limit=e,this._items=J_([],X_(r),!1)}function rO(e){var t=e.dbname,n=e.collectionName,e=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey="".concat(jA(t,n),"/trans.metadata"),this.recordsetKey="".concat(jA(t,n),"/trans.recordset"),this._store=e}function iO(e){var t=e.dbname,e=e.limit,e=void 0===e?256:e;return zA[t]||(this.dbname=t,this._items=[],this._limit=e,zA[t]=this),zA[t]}$A&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var sO=$A&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");$A&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),$A&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),$A&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");function aO(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}var oO,uO,cO=$A&&navigator.userAgent&&navigator.userAgent.includes("Edge/");(ua=oO=oO||{})[ua.PROCESSING=0]="PROCESSING",ua[ua.DONE=1]="DONE",(t=uO=uO||{}).NEWNODE="newnode",t.REMOVENODE="removenode",t.CLAIM_HOST="claimhost",t.SYNC_HOST="synchost",t.REQUEST_LOCK="requestlock",t.ACQUIRE_LOCK="acquirelock",t.RELEASE_LOCK="releaselock";var lO,hO={},dO=(Object.defineProperty(SO.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(SO.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(SO.prototype,"isInSync",{get:function(){return this._state==oO.DONE},enumerable:!1,configurable:!0}),SO.prototype._send=function(e,t){var n,e={nodeId:this.nodeId,requestId:null!=(n=null==(t=void 0===t?{}:t)?void 0:t.requestId)?n:aO(),key:this.key,op:e,data:null!=(n=t.data)?n:null,ts:Date.now()};return $A&&window.postMessage(e,"*"),e},SO.prototype._acquire=function(e){(e=void 0===e?null:e)?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null},SO.prototype._release=function(t){var e,n;this._currentItem&&this._currentItem.requestId===t&&(e=this._currentItem,this._currentItem=null,e.nodeId===this.nodeId&&this._send(uO.RELEASE_LOCK,{requestId:e.requestId}),-1<(n=this._queue.findIndex(function(e){return e.requestId===t}))&&this._queue.splice(n,1),e.onReleased(t))},SO.prototype._requestLock=function(i){var s=this;return new Promise(function(t){var e,n={nodeId:i.nodeId,requestId:i.requestId,ts:i.ts,onAcquired:function(e){s.isHost&&s._send(uO.ACQUIRE_LOCK,{requestId:e}),t()},onReleased:function(){s._acquire(s._queue[0])}},r=!1;for(e in s._queue)if(s._queue[e].ts>n.ts){s._queue.splice(parseInt(e),0,n),r=!0;break}r||s._queue.push(n),s._currentItem||s._acquire(s._queue[0])})},SO.prototype._sendSync=function(){var e;this.isHost&&this._send(uO.SYNC_HOST,{data:{currentItemRequestId:null==(e=this._currentItem)?void 0:e.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},SO.prototype._waitUntilSyncCompleted=function(){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(e){t._activationQueue.push(e)})]:[2]})})},SO.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout(function(){e._completeSync()},8))},SO.prototype._completeSync=function(){this.isInSync||(this._state=oO.DONE,this._activationQueue.forEach(function(e){return e()}),this._activationQueue=[])},SO.prototype.registerNode=function(){this._send(uO.NEWNODE),this._waitSync()},SO.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(uO.CLAIM_HOST),this._waitSync()},SO.prototype.lock=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),t=this._send(uO.REQUEST_LOCK),[4,this._requestLock(t)];case 2:return e.sent(),[2]}})})},SO.prototype.unlock=function(){var e;this._release(null==(e=this._currentItem)?void 0:e.requestId)},SO),fO=(TO.metadataOf=function(n,r,i){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=AA(n,r),[4,i.get(t)];case 1:return[2,e.sent()]}})})},Object.defineProperty(TO.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(TO.prototype,"isReady",{get:function(){return this._state===yA.READY},enumerable:!1,configurable:!0}),TO.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d,f,p=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._mutex.lock()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,9,,10]),t=eA.get(this.dbname),[4,TO.metadataOf(this.dbname,this.name,this._store)];case 3:return n=e.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:e.sent(),this._blockManager=new JA({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=J_([],X_(this.indexes),!1),i=[],s=r.map(function(e){return ZA.createKey(e)}),a=n?n.indexes.map(function(e){return ZA.createKey(e)}):[];try{for(o=se(a),u=o.next();!u.done;u=o.next())c=u.value,s.includes(c)||i.push(ZA.parseKey(c))}catch(e){d={error:e}}finally{try{u&&!u.done&&(f=o.return)&&f.call(o)}finally{if(d)throw d.error}}return(l=[]).push.apply(l,J_([],X_(r.map(function(e){e=new ZA({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store});return p._indexers.push(e),e.ensure()})),!1)),l.push.apply(l,J_([],X_(i.map(function(e){return new ZA({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return e.sent(),[4,this._transaction.commit()];case 6:return e.sent(),s.sort().join(",")===a.sort().join(",")?[3,8]:(l=AA(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:l,value:this._metadata,generation:1})]);case 7:e.sent(),e.label=8;case 8:return this._state=yA.READY,this._mutex.unlock(),[3,10];case 9:throw h=e.sent(),this._mutex.unlock(),h;case 10:return[2]}})})},TO.prototype.close=function(){this._state=yA.CLOSED},TO.prototype._hasPropertyOfKeyName=function(e){e=e[this.keyName];return"string"==typeof e&&!!e},TO.prototype._getIndexerBy=function(e){e=(e=void 0===e?null:e)||[this.keyName];var t,n,r=ZA.createKey(e);try{for(var i=se(this._indexers),s=i.next();!s.done;s=i.next()){var a=s.value;if(r===ZA.createKey(a.fields))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},TO.prototype._upgradeBlockLevel=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=AA(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:t,value:this._metadata,generation:1})];case 1:return e.sent(),[2]}})})},TO.prototype._requestInsert=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return t=a[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return e.sent()?[3,13]:[4,this._blockManager.putToBlock(t,a)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,a)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),n=se(this._indexers),r=n.next(),e.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(a)];case 7:e.sent(),e.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=e.sent(),i={error:i},[3,12];case 11:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 12:return[3,14];case 13:throw gA.collectionInsertDuplicate;case 14:return[2]}})})},TO.prototype._requestUpsert=function(d){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h;return ie(this,function(e){switch(e.label){case 0:return t=d[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[3,13]:[4,this._blockManager.putToBlock(t,d)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,d)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),r=se(this._indexers),i=r.next(),e.label=6;case 6:return i.done?[3,9]:[4,(o=i.value).addItem(d)];case 7:e.sent(),e.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return u=e.sent(),u={error:u},[3,12];case 11:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,d)];case 14:e.sent(),e.label=15;case 15:e.trys.push([15,21,22,23]),s=se(this._indexers),a=s.next(),e.label=16;case 16:return a.done?[3,20]:0===(o=a.value).diff(o.getColumnValues(n),o.getColumnValues(d))?[3,19]:[4,o.removeItem(n)];case 17:return e.sent(),[4,o.addItem(d)];case 18:e.sent(),e.label=19;case 19:return a=s.next(),[3,16];case 20:return[3,23];case 21:return l=e.sent(),l={error:l},[3,23];case 22:try{a&&!a.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}return[7];case 23:return[2]}})})},TO.prototype._requestUpdate=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return t=u[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[4,this._blockManager.putToBlock(t,u)]:[3,11];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,9,10,11]),r=se(this._indexers),i=r.next(),e.label=4;case 4:return i.done?[3,8]:0===(s=i.value).diff(s.getColumnValues(n),s.getColumnValues(u))?[3,7]:[4,s.removeItem(n)];case 5:return e.sent(),[4,s.addItem(u)];case 6:e.sent(),e.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return a=e.sent(),a={error:a},[3,11];case 10:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 11:return[2]}})})},TO.prototype._requestRemove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return[4,this._blockManager.getFromBlock(a)];case 1:return(t=e.sent())?[4,this._blockManager.removeFromBlock(a)]:[3,10];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),n=se(this._indexers),r=n.next(),e.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:e.sent(),e.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=e.sent(),i={error:i},[3,10];case 9:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 10:return[2]}})})},TO.prototype._requestClear=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:e.sent(),e.label=2;case 2:e.trys.push([2,7,8,9]),t=se(this._indexers),n=t.next(),e.label=3;case 3:return n.done?[3,6]:[4,n.value.clear()];case 4:e.sent(),e.label=5;case 5:return n=t.next(),[3,3];case 6:return[3,9];case 7:return r=e.sent(),r={error:r},[3,9];case 8:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}return[7];case 9:return[2]}})})},TO.prototype.getByKey=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(n)];case 3:return t=e.sent(),this._mutex.unlock(),[2,EA(t)];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[3,7];case 6:throw gA.collectionNotReady;case 7:return[2]}})})},TO.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new qA({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},TO.prototype.insertOne=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestInsert(EA(n))];throw gA.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw gA.collectionNotReady;case 9:return[2]}})})},TO.prototype.insertMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),u.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw gA.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=se(u),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(EA(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),s={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,u];case 12:return i=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),i;case 14:return[3,16];case 15:throw gA.collectionNotReady;case 16:return[2]}})})},TO.prototype.upsertOne=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpsert(EA(n))];throw gA.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw gA.collectionNotReady;case 9:return[2]}})})},TO.prototype.upsertMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),u.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw gA.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=se(u),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(EA(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),s={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,u];case 12:return i=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),i;case 14:return[3,16];case 15:throw gA.collectionNotReady;case 16:return[2]}})})},TO.prototype.update=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpdate(EA(n))];throw gA.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw gA.collectionNotReady;case 9:return[2]}})})},TO.prototype.updateIf=function(h,d){return re(this,void 0,void 0,function(){var i,s,t,n,r,a,o,u,c,l=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,15]),a=h.where,i=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,r=h.backward,r=void 0!==r&&r,s=[],[4,new UA({condition:i,blockManager:this._blockManager,backward:r,indexer:this._getIndexerBy(a)}).each(function(r){return re(l,void 0,void 0,function(){var t,n;return ie(this,function(e){if(r.error)throw r.stop(),r.error;if(r.hasNext){if(t=r.nextValue,wA(i,t)&&d.set){if("function"!=typeof d.set)for(n in d.set)t[n]=d.set[n];else d.set(t);s.push(t)}r.next()}else r.stop();return[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=se(s),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(r=n.value,[4,this._requestUpdate(EA(r))]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),u={error:a},[3,11];case 10:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,s];case 13:return o=e.sent(),[4,this._transaction.clear()];case 14:throw e.sent(),this._mutex.unlock(),o;case 15:return[3,17];case 16:throw this._transaction.clear(),gA.collectionNotReady;case 17:return[2]}})})},TO.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestRemove(n)];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw gA.collectionNotReady;case 9:return[2]}})})},TO.prototype.removeIf=function(h){return re(this,void 0,void 0,function(){var r,i,t,n,s,a,o,u,c,l=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,14]),a=h.where,r=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,s=h.backward,s=void 0!==s&&s,i=[],[4,new UA({condition:r,blockManager:this._blockManager,backward:s,indexer:this._getIndexerBy(a)}).each(function(n){return re(l,void 0,void 0,function(){var t;return ie(this,function(e){if(n.error)throw n.stop(),n.error;return n.hasNext?(t=n.nextValue,wA(r,t)&&(t=t[this.keyName],i.push(t)),n.next()):n.stop(),[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=se(i),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(s=n.value,[4,this._requestRemove(s)]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),u={error:a},[3,11];case 10:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,i];case 13:throw o=e.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw this._transaction.clear(),gA.collectionNotReady;case 16:return[2]}})})},TO.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw gA.collectionNotReady;case 9:return[2]}})})},TO.prototype.getBlob=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(t)];case 1:return[2,e.sent()]}})})},TO.prototype.saveBlob=function(t,n){return void 0===n&&(n=null),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.save(t,n)];case 1:return[2,e.sent()]}})})},TO.prototype.removeBlob=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(t)];case 1:return e.sent(),[2]}})})},TO.prototype.removeAllBlobs=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}})})},TO),pO={},vO=(Object.defineProperty(wO.prototype,"rawData",{get:function(){return pO[this.dbname]},set:function(e){pO[this.dbname]=e},enumerable:!1,configurable:!0}),wO.prototype.observe=function(t,e,n){var r=this;this.observer[t]={},e.forEach(function(e){return r.observer[t][e]=n})},wO.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this.dbname=n,pO[this.dbname]={},e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get(fy.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify(fy.value))throw gA.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(fy)];case 4:return e.sent(),[7];case 5:return[2]}})})},wO.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,Object.keys(pO[this.dbname]).filter(function(e){return e!==fy.key})]})})},wO.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,IA(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.get?t.get(n):null)throw t;return[2,pO[this.dbname][n]?this._encryption.decrypt(pO[this.dbname][n]):null]}})})},wO.prototype.set=function(i){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return[4,IA(this.delay)];case 1:if(e.sent(),t=i.key,r=i.value,n=this.observer[t],n=n&&n.set?n.set(t):null)throw n;if(n=this._encryption.encrypt(r),r=JSON.stringify(n),t===fy.key||r.length<this.itemSizeLimit)return pO[this.dbname][t]=n,[2,pO[this.dbname][t]];throw gA.storeItemSizeExceeded}})})},wO.prototype.setMany=function(t){return re(this,void 0,void 0,function(){var i,s=this;return ie(this,function(e){switch(e.label){case 0:return[4,IA(this.delay)];case 1:return e.sent(),i=[],t.forEach(function(e){var t,n=e.key,e=e.value,r=s.observer[n];r&&r.set&&r.set(n)?i.push(gA.collectionWriteFailed):(r=s._encryption.encrypt(e),t=JSON.stringify(r),n===fy.key||t.length<s.itemSizeLimit?(pO[s.dbname][n]=r,i.push(e)):i.push(gA.storeItemSizeExceeded))}),[2,i]}})})},wO.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,IA(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.remove?t.remove(n):null)throw t;return pO[this.dbname][n]&&delete pO[this.dbname][n],[2,n]}})})},wO.prototype.removeMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return[4,IA(this.delay)];case 1:e.sent();try{for(t=se(u),n=t.next();!n.done;n=t.next()){if(r=n.value,i=this.observer[r],s=i&&i.remove?i.remove(r):null)throw s;pO[this.dbname][r]&&delete pO[this.dbname][r]}}catch(e){a={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}}return[2,u]}})})},wO.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,IA(this.delay)];case 1:return e.sent(),pO[this.dbname]={},[2]}})})},wO),_O=(IO.prototype.init=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return this.dbname=i,[4,new Promise(function(e,t){var n;r._window&&$A?sO?((n=r._indexedDB.open("_testMozilla")).onerror=function(){return t(gA.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}):cO?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(gA.storeNotAvailableInPrivateBrowsing):e():t(gA.storeNotAvailable)})];case 1:return e.sent(),t=this,[4,new Promise(function(t,n){var e=r._indexedDB.open(i);e.addEventListener("upgradeneeded",function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"})}),e.addEventListener("success",function(e){return t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 2:t._database=e.sent(),e.label=3;case 3:return e.trys.push([3,,5,7]),[4,this.get(fy.key)];case 4:if((n=e.sent())&&JSON.stringify(n)!==JSON.stringify(fy.value))throw gA.storeEncryptionInvalid;return[3,7];case 5:return[4,this.set(fy)];case 6:return e.sent(),[7];case 7:return[2]}})})},IO.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").getAllKeys();e.addEventListener("success",function(e){t(e.target.result.filter(function(e){return e!==fy.key}))}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},IO.prototype.get=function(i){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").get(i);e.addEventListener("success",function(e){return t(e.target.result?r._encryption.decrypt(e.target.result.value):null)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},IO.prototype.set=function(t){return re(this,void 0,void 0,function(){var r,i,s=this;return ie(this,function(e){switch(e.label){case 0:return r=t.key,i=t.value,[4,new Promise(function(t,n){var e=s._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").put({key:r,value:s._encryption.encrypt(i)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return e.sent(),[2,i]}})})},IO.prototype.setMany=function(n){return re(this,void 0,void 0,function(){var t,i,s=this;return ie(this,function(e){switch(e.label){case 0:return t=[],i=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),n.forEach(function(e){var n=e.key,r=e.value;t.push(new Promise(function(t){var e=i.put({key:n,value:s._encryption.encrypt(r)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(){t(gA.collectionWriteFailed)})}))}),[4,Promise.all(t)];case 1:return e.sent(),[2,n.map(function(e){return e.value})]}})})},IO.prototype.remove=function(i){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").delete(i);n.addEventListener("success",function(){return e(i)}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},IO.prototype.removeMany=function(t){return re(this,void 0,void 0,function(){var i;return ie(this,function(e){switch(e.label){case 0:return i=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),[4,Promise.all(t.map(function(r){return new Promise(function(e,t){var n=i.delete(r);n.addEventListener("success",function(){return e(r)}),n.addEventListener("error",function(e){return t(e.target.error)})})}))];case 1:return[2,e.sent()]}})})},IO.prototype.clear=function(){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").clear();n.addEventListener("success",function(){return e()}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},IO),yO=(bO.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},bO.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},bO.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this.dbname=n,e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get(fy.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify(fy.value))throw gA.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(fy)];case 4:return e.sent(),[7];case 5:return[2]}})})},bO.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return t=this._getActualKey(fy.key),[4,this._asyncStorage.getAllKeys()];case 1:return[2,e.sent().filter(function(e){return n._isBelonging(e)&&e!==t}).map(function(e){return e.substring("".concat(n.dbname,"/").length)})]}})})},bO.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(n))];case 1:return[2,(t=e.sent())?this._encryption.decrypt(JSON.parse(t)):null]}})})},bO.prototype.set=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=r.key,n=r.value,n=JSON.stringify(this._encryption.encrypt(n)),t===fy.key||n.length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),n)]:[3,2];case 1:return e.sent(),[2,JSON.parse(n)];case 2:throw gA.storeItemSizeExceeded}})})},bO.prototype.setMany=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:t=[],n=[];try{for(r=se(h),i=r.next();!i.done;i=r.next()){s=i.value;try{a=s.key,o=s.value,u=JSON.stringify(this._encryption.encrypt(o)),a===fy.key||u.length<this.itemSizeLimit?(n.push([this._getActualKey(a),u]),t.push(o)):t.push(gA.storeItemSizeExceeded)}catch(e){t.push(gA.collectionWriteFailed)}}}catch(e){c={error:e}}finally{try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._asyncStorage.multiSet(n)];case 2:return e.sent(),[3,4];case 3:return e.sent(),[2,new Array(t.length).fill(gA.collectionWriteFailed)];case 4:return[2,t]}})})},bO.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.removeItem(this._getActualKey(t))];case 1:return e.sent(),[2,t]}})})},bO.prototype.removeMany=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.multiRemove(n.map(function(e){return t._getActualKey(e)}))];case 1:return e.sent(),[2,n]}})})},bO.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this.getAllKeys()];case 1:return t=e.sent(),[4,this.removeMany(t)];case 2:return e.sent(),[4,this.remove(fy.key)];case 3:return e.sent(),[2]}})})},bO),mO=!0,gO=(EO.off=function(){mO=!1},EO.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];mO&&console.log.apply(console,J_(["".concat("[NESTDB]","[LOG]")],X_(e),!1))},EO.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];mO&&console.warn.apply(console,J_(["".concat("[NESTDB]","[WARNING]")],X_(e),!1))},EO.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];mO&&console.error.apply(console,J_(["".concat("[NESTDB]","[ERROR]")],X_(e),!1))},EO);function EO(){}function bO(e){var t=e.AsyncStorage,e=e.encryption,e=void 0===e?py:e;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=e}function IO(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;e=e.encryption,e=void 0===e?py:e;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=e}function wO(e){var t=(e=void 0===e?{}:e).itemSizeLimit,t=void 0===t?4194304:t,n=e.delay,n=void 0===n?1:n,e=e.encryption,e=void 0===e?py:e;this._encryption=e,this.itemSizeLimit=t,this.delay=n,this.observer={}}function TO(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,e=e.store,a=this;this._state=yA.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=J_([[r]],X_(s.filter(function(e){return ZA.createKey(e)!==a.keyName})),!1),this._keyHash=i,this._store=e,this._mutex=new dO("".concat(jA(t,n),".lock")),this._blobContainer=new HA({dbname:t,collectionName:n,store:e}),this._transaction=new YA({dbname:t,collectionName:n,store:e})}function SO(e,t){void 0===t&&(t={});var f=this;return this._state=oO.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],hO[e]&&!t.forceCreate||(this.nodeId=aO(),this.key=e,$A&&(!t.startAsInvisible&&"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&f.claimHost()}),window.addEventListener("message",function(e){var t,n,r=e.data,i=r.nodeId,s=r.requestId,a=r.key,o=r.op,u=r.data;if(i!==f.nodeId&&a===f.key)switch(o){case uO.NEWNODE:f._sendSync();break;case uO.CLAIM_HOST:f._sendSync(),f._hostId=i;break;case uO.SYNC_HOST:if(!f.isInSync){f._activationTimeout&&clearTimeout(f._activationTimeout);var c=u.currentItemRequestId,l=u.queue;try{for(var h=se(l),d=h.next();!d.done;d=h.next())!function(t){f._queue.findIndex(function(e){return e.requestId===t.requestId})<0&&f._requestLock({nodeId:t.nodeId,requestId:t.requestId,key:f.key,op:uO.REQUEST_LOCK,ts:t.ts})}(d.value)}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}f._currentItem=f._queue.find(function(e){return e.requestId===c}),f._completeSync()}break;case uO.REMOVENODE:f._queue=f._queue.filter(function(e){return e.nodeId!==r.nodeId}),f._currentItem&&f._currentItem.nodeId===r.nodeId&&(f._currentItem=null,f._acquire(f._queue[0]));break;case uO.REQUEST_LOCK:f._requestLock(r);break;case uO.ACQUIRE_LOCK:l=f._queue.find(function(e){return e.requestId===s});f._acquire(l);break;case uO.RELEASE_LOCK:f._release(s)}}),window.addEventListener("beforeunload",function(){f._send(uO.REMOVENODE)})),hO[e]=this),hO[e]}(sa=lO=lO||{}).INIT="INIT",sa.OPENING="OPENING",sa.OPENED="OPENED",sa.CLOSED="CLOSED";Object.defineProperty(OO.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(OO.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),OO.prototype.commitSchema=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this._state!==lO.OPENING?[3,2]:[4,Promise.all(n.map(function(i){return re(t,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=i.collectionName,n=i.keyName,r=i.index,r=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new fO({dbname:this.name,collectionName:t,keyName:n,keyHash:i.keyHash||null,indexes:r,store:this._store})),[4,this._collections.get(t).init()];case 1:return e.sent(),[2]}})})}))];case 1:return e.sent(),[3,3];case 2:throw gA.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},OO.prototype.open=function(){var i;return re(this,void 0,void 0,function(){var o,n,u,r,c=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._globalMutex.lock()];case 1:if(e.sent(),this._state===lO.OPENED)return[3,15];this._state=lO.OPENING,e.label=2;case 2:return e.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return e.sent(),t=this.name,o="".concat(FA(t),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(o)];case 4:return u=null!=(i=e.sent())?i:n,[2,new Promise(function(r,i){function s(r){u.version<c._version?c._event.upgrade(u.version,function(n){return re(c,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:if(n)return[3,5];u.version++,u.collectionNames=Array.from(this._collections.keys()),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.set({key:o,value:u,generation:this._version})];case 2:return e.sent(),r({continued:!0}),[3,4];case 3:return t=e.sent(),r({continued:!1,err:t}),[3,4];case 4:return[3,6];case 5:r({continued:!1,err:n}),e.label=6;case 6:return[2]}})})}):r({continued:!1})}function a(e){var t,n=e.continued,e=void 0===(e=e.err)?null:e;void 0!==n&&n?setTimeout(function(){return s(a)},10):e?(gO.error(e.message),c._globalMutex.unlock(),c._event.error(e),i(e)):(t=[],u.collectionNames.forEach(function(n){c._collections.has(n)||t.push(re(c,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,fO.metadataOf(this.name,n,this._store)];case 1:return(t=e.sent())?(t=new fO({dbname:this.name,collectionName:n,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(n,t),[4,t.init()]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})}))}),Promise.all(t).then(function(){c._state=lO.OPENED,c._globalMutex.unlock(),c._event.success(),r()}).catch(function(e){gO.error(e.message),c._globalMutex.unlock(),c._event.error(e),i(e)}))}s(a)})];case 5:switch((r=e.sent()).code){case E1.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case E1.STORE_NOT_AVAILABLE:return[3,8];case E1.STORE_ENCRYPTION_INVALID:return[3,10]}return[3,13];case 6:return gO.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new vO({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 7:return e.sent(),[3,14];case 8:return gO.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new vO({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 9:return e.sent(),[3,14];case 10:return gO.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return e.sent(),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 12:return e.sent(),[3,14];case 13:throw gO.error(r.message),this._globalMutex.unlock(),this._event.error(r),r;case 14:return[3,15];case 15:return[2]}var t})})},OO.prototype.close=function(){this._collections.forEach(function(e){return e.close()}),this._state=lO.CLOSED},OO.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return e.sent(),[2]}})})},OO.prototype.reset=function(){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.close(),(t=WA.get(this.name))&&t.clearByCondition(function(e){return e.key.startsWith(FA(n.name))}),[4,this._store.clear()];case 1:return e.sent(),[2]}})})},OO.prototype.on=function(e,t){this._event[e]=t},OO.prototype.off=function(e){"function"==typeof this._event[e]&&(this._event[e]="upgrade"===e?kA:TA)},OO.prototype.collection=function(e){return this._collections.get(e)||null};var CO,kO=OO,NO=null,AO=(R.init=function(e){var t,n=e.appId,r=e.appVersion,r=void 0===r?null:r,i=e.modules,i=void 0===i?[]:i,s=e.options,s=void 0===s?new dy:s,a=e.debugMode,a=void 0!==a&&a,o=e.customApiHost,u=e.customWebSocketHost,c=e.newInstance,l=e.logLevel,h=e.localCacheEnabled,h=void 0!==h&&h,d=e.localCacheEncryption,e=e.useAsyncStorageStore,e=void 0===e?null:e;return!NO||void 0!==c&&c?(c="su-".concat(sy()),t=new vO({encryption:d=null!=d?d:{encrypt:function(e){return e},decrypt:function(e){return e}}}),a||(t=e?new yO({AsyncStorage:e,encryption:d}):new _O({encryption:d})),new N(c,{appId:n,appVersion:r,options:s,apiHost:null!=o?o:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=u?u:"wss://ws-".concat(n,".sendbird.com"),store:t,encryption:d,logLevel:l,localCacheEnabled:h,debugMode:a}),e=new R(c,s,J_(J_([],X_(i),!1),[new Yb],!1)),NO=NO||e,e):NO},Object.defineProperty(R,"instance",{get:function(){return NO},enumerable:!1,configurable:!0}),Object.defineProperty(R,"version",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appId",{get:function(){return N.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appInfo",{get:function(){return N.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appVersion",{get:function(){var e;return null!=(e=N.of(this._iid).sdkState.appVersion)?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"debugMode",{get:function(){return N.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"logLevel",{get:function(){return N.of(this._iid).logger.level},set:function(e){N.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isCacheEnabled",{get:function(){return N.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"ekey",{get:function(){return vm(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"currentUser",{get:function(){var e;return null!=(e=N.of(this._iid).sessionManager.currentUser)?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"connectionState",{get:function(){var e=N.of(this._iid).connectionManager;return e.isConnected?Hy.OPEN:e.isConnecting?Hy.CONNECTING:Hy.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"lastConnectedAt",{get:function(){var e=N.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),R.prototype._getPreferenceCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")},R.prototype._getUserProfileCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")},R.prototype.getMemoryStoreForDebugging=function(){var e=N.of(this._iid),t=e.debugMode,e=e.cacheContext;if(t)return e.store instanceof vO?e.store:null;throw p.debugModeRequired},R.prototype.addExtension=function(e,t){var n=N.of(this._iid).sdkState;-1<["sb_uikit","sb_syncmanager"].indexOf(e)&&(n.extensions[e]=t)},R.prototype.initializeCache=function(o){return re(this,void 0,void 0,function(){var t,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return i=N.of(this._iid),t=i.sdkState,r=i.cacheContext,s=i.connectionManager,i=i.dispatcher,t.userId&&t.userId===o?[3,6]:[4,s.logout()];case 1:return e.sent(),t.userId=o,r.localCacheEnabled?(s="sendbird@".concat(t.appId,"/").concat(o,".db"),r.nestdb&&r.nestdb.state!==lO.CLOSED&&r.nestdb.name===s?[3,3]:((a=r.nestdb=new kO({name:"sendbird@".concat(t.appId,"/").concat(o,".db"),version:1,store:r.store})).on("upgrade",(n=a,function(e,t){0===e?n.commitSchema([{collectionName:"GroupChannel",keyName:"url",index:[aC(sC.LATEST_LAST_MESSAGE),aC(sC.CHRONOLOGICAL),aC(sC.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:"Message",keyName:"messageId",index:[lC(oC.CHANNEL_LATEST),lC(oC.NEWEST_CHILD_MESSAGE)]},{collectionName:"UnsentMessage",keyName:"reqId",index:[lC(oC.CHANNEL_LATEST),lC(oC.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]).then(function(){return t()}).catch(function(e){return t(e)}):t()})),[4,a.open()])):[3,6];case 2:e.sent(),i.dispatch(new MC(this._iid,{userId:o})),e.label=3;case 3:return[4,r.preference.init(this._getPreferenceCacheKey(o))];case 4:return e.sent(),[4,r.preference.get(this._getUserProfileCacheKey(o))];case 5:(a=e.sent())&&new dE(this._iid,a).apply(),e.label=6;case 6:return[2]}var n})})},R.prototype.clearCachedData=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return(t=N.of(this._iid).cacheContext).localCacheEnabled?(t.nestdb&&t.nestdb.clear(),[4,t.preference.clear()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.clearCachedMessages=function(t){return re(this,void 0,void 0,function(){var n,r,i=this;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",t)).throw(p.invalidParameters),n=mC.of(this._iid),r=_C.of(this._iid),n&&r?[4,Promise.all(t.map(function(t){return re(i,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,n.removeMessagesOfChannel(t)];case 1:return e.sent(),[4,r.removeMessagesOfChannel(t)];case 2:return e.sent(),[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.connect=function(a,o){return void 0===o&&(o=null),re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:i=N.of(this._iid),t=i.sdkState,n=i.cacheContext,r=i.connectionManager,i=i.statLogCollector,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.initializeCache(a)];case 2:return e.sent(),[3,4];case 3:return e.sent(),s=N.of(this._iid).logger,n.localCacheEnabled=!1,s.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return[4,i.init("sendbird@".concat(t.appId,"/").concat(a,".statlog"))];case 5:return e.sent(),[4,r.connect(o)];case 6:return e.sent(),this._appStateChangeDetector.start(),t.appState="foreground",[4,null==(s=bC.of(this._iid))?void 0:s.processNonAutoResendRegisteredPendingMessages()];case 7:return e.sent(),this._onlineDetector.start(),[2,this.currentUser]}})})},R.prototype.reconnect=function(){var e=N.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.sessionManager.auth.hasSession;return e&&t.resetAndReconnect().then(function(){n.appState="foreground"}).catch(function(){}),e},R.prototype.disconnect=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return r=N.of(this._iid),t=r.connectionManager,n=r.cacheContext,r=r.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return e.sent(),n.localCacheEnabled?[4,this.clearCachedData()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},R.prototype.setBackgroundState=function(){var e=N.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"foreground"===n.appState&&(n.appState="background",e.debug("going background state"),t.background())},R.prototype.setForegroundState=function(){var e=N.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"background"===n.appState&&(n.appState="foreground",e.debug("going foreground state"),t.resetAndReconnect())},R.prototype.setSessionHandler=function(e){C(!1).throw(p.invalidParameters),N.of(this._iid).sessionManager.handler=e},R.prototype.addUserEventHandler=function(e,t){C(c("string",e)&&!1).throw(p.invalidParameters),N.of(this._iid).userEventHandlers.set(e,t)},R.prototype.removeUserEventHandler=function(e){N.of(this._iid).userEventHandlers.delete(e)},R.prototype.removeAllUserEventHandler=function(){N.of(this._iid).userEventHandlers.clear()},R.prototype.addConnectionHandler=function(e,t){C(c("string",e)&&!1).throw(p.invalidParameters),N.of(this._iid).connectionHandlers.set(e,t)},R.prototype.removeConnectionHandler=function(e){N.of(this._iid).connectionHandlers.delete(e)},R.prototype.removeAllConnectionHandler=function(){N.of(this._iid).connectionHandlers.clear()},R.prototype.createApplicationUserListQuery=function(e){return new Q1(this._iid,e=void 0===e?{}:e)},R.prototype.createBlockedUserListQuery=function(e){return new Y1(this._iid,e=void 0===e?{}:e)},R.prototype.createFriendListQuery=function(e){return new Z1(this._iid,e=void 0===e?{}:e)},R.prototype.createMessageSearchQuery=function(e){return new Qb(this._iid,e)},R.prototype.buildUserFromSerializedData=function(e){e=nE(e);return new k(this._iid,k.payloadify(e))},R.prototype.updateCurrentUserInfo=function(i){return void 0===i&&(i={}),re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){switch(e.label){case 0:return i=f(f({},ZC),i),C(ry((t=i).profileImage,!0)&&c("string",t.profileUrl,!0)&&c("string",t.nickname,!0)).throw(p.invalidParameters),this.currentUser?(n=N.of(this._iid),r=n.sdkState,n=n.requestQueue,r=new tk(f({userId:r.userId},i)),[4,n.send(r)]):[3,2];case 1:return n=e.sent(),r=n.as(nk).user,this.currentUser&&(i.nickname&&(this.currentUser.nickname=r.nickname),(i.profileUrl||i.profileImage)&&(this.currentUser.plainProfileUrl=r.profileUrl)),[2,r];case 2:throw p.connectionRequired}var t})})},R.prototype.updateCurrentUserInfoWithPreferredLanguages=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",r)).throw(p.invalidParameters),this.currentUser?(t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new tk({userId:n.userId,preferredLanguages:r}),[4,t.send(n)]):[3,2];case 1:return t=e.sent(),n=t.as(nk).user,this.currentUser&&(this.currentUser.preferredLanguages=n.preferredLanguages),[2,n];case 2:throw p.connectionRequired}})})},R.prototype.registerFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(c("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new hk({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,DS.SUCCESS];case 3:return e.sent(),[2,DS.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,DS.PENDING];case 6:return[2]}})})},R.prototype.unregisterFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(c("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new gk({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,DS.SUCCESS];case 3:return e.sent(),[2,DS.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,DS.PENDING];case 6:return[2]}})})},R.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return this.currentUser?(t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new kk({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.registerAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(c("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new rk({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,DS.SUCCESS];case 3:return e.sent(),[2,DS.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,DS.PENDING];case 6:return[2]}})})},R.prototype.unregisterAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(c("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new vk({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,DS.SUCCESS];case 3:return e.sent(),[2,DS.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,DS.PENDING];case 6:return[2]}})})},R.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return this.currentUser?(t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new wk({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.getChannelInvitationPreference=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new zk({userId:n.userId}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(Wk).autoAccept}]}})})},R.prototype.setChannelInvitationPreference=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("boolean",r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Yk({userId:n.userId,willAutoAccept:r}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(Xk).autoAccept}]}})})},R.prototype.getDoNotDisturb=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Jk({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(Zk).preference]}})})},R.prototype.setDoNotDisturb=function(r,i,s,a,o,u){return void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===u&&(u=""),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("boolean",r)&&c("number",i)&&c("number",s)&&c("number",a)&&c("number",o)&&c("string",u)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new $k({userId:n.userId,doNotDisturbOn:r,startHour:i,startMin:s,endHour:a,endMin:o,timezone:u}),[4,t.send(n)];case 1:return[2,e.sent().as(eN).preference]}})})},R.prototype.getSnoozePeriod=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new tN({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(nN).snoozePeriod]}})})},R.prototype.setSnoozePeriod=function(r,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("boolean",r)&&c("number",i)&&c("number",s)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new rN({userId:n.userId,snoozeOn:r,startTs:i,endTs:s}),[4,t.send(n)];case 1:return[2,e.sent().as(iN).snoozePeriod]}})})},R.prototype.getMyPushTokensByToken=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)&&ly(xS,i)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Kk({userId:n.userId,type:i,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(Qk).pushTokens]}})})},R.prototype.getPushTriggerOption=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new LC({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(PC).pushTriggerOption]}})})},R.prototype.setPushTriggerOption=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ly(MS,r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new UC({userId:n.userId,pushTriggerOption:r}),[4,t.send(n)];case 1:return[2,e.sent().as(qC).pushTriggerOption]}})})},R.prototype.getPushTemplate=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new LN({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(PN).name]}})})},R.prototype.setPushTemplate=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ly(LS,r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new UN({userId:n.userId,templateName:r}),[4,t.send(n)];case 1:return[2,e.sent().as(qN).name]}})})},R.prototype.blockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof k||c("string",r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new sN({userId:n.userId,blockedUserId:r instanceof k?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.blockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.blockUser(t)]})})},R.prototype.unblockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof k||c("string",r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new wN({userId:n.userId,unblockedUserId:r instanceof k?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.unblockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unblockUser(t)]})})},R.prototype.getFriendChangeLogsByToken=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new FN({userId:n.userId,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(jN).changelogs]}})})},R.prototype.getAllowFriendDiscovery=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new f1({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(p1).allowFriendDiscovery]}})})},R.prototype.setAllowFriendDiscovery=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("boolean",r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new v1({userId:n.userId,allowFriendDiscovery:r}),[4,t.send(n)];case 1:return e.sent(),[2,r]}})})},R.prototype.uploadFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new HN({userId:n.userId,discoveries:r}),[4,t.send(n)];case 1:return[2,e.sent().as(GN).friendDiscoveryRequestId]}})})},R.prototype.deleteFriendDiscovery=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.deleteFriendDiscoveries([t])]})})},R.prototype.deleteFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new VN({userId:n.userId,discoveryKeys:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.addFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new r1({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return[2,e.sent().as(i1).users]}})})},R.prototype.deleteFriend=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.deleteFriends([t])]})})},R.prototype.deleteFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(hy("string",r)).throw(p.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new s1({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.getAllEmoji=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new q1,[4,t.send(n)];case 1:return[2,e.sent().as(F1).emojiContainer]}})})},R.prototype.getEmojiCategory=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new j1({categoryId:r}),[4,t.send(n)];case 1:return[2,e.sent().as(H1).emojiCategory]}})})},R.prototype.getEmoji=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new G1({key:r}),[4,t.send(n)];case 1:return[2,e.sent().as(V1).emoji]}})})},R);function R(a,e,t){var o=this,e=(this._fcmPushToken=null,this._apnsPushToken=null,this._iid=a,this.options=e,N.of(a)),u=e.sdkState,c=e.cacheContext,n=e.dispatcher,r=e.sessionManager,i=e.requestQueue,s=e.logger,l=e.userEventHandlers;this._onlineDetector=new ek({logger:s,connectionDelegate:{reconnect:function(){var e=N.of(a),t=e.sdkState,e=e.connectionManager;"foreground"===t.appState&&e.resetAndReconnect()},disconnect:function(){N.of(a).connectionManager.disconnect()}}}),new bC(a,{localCacheEnabled:c.localCacheEnabled,dispatcher:n,sdkState:u,logger:s}),t.forEach(function(e){e.init(a,{sdkState:u,cacheContext:c,dispatcher:n,sessionManager:r,requestQueue:i,logger:s,onlineDetector:o._onlineDetector}),o[e.name]=e}),this._appStateChangeDetector=new $C,this._appStateChangeDetector.on("resume",function(){s.debug("the page resumes from freeze"),o.setForegroundState()}).on("pause",function(){s.debug("the page freezes"),o.setBackgroundState()}),n.on(function(e){var t;if(e instanceof zy)"USEV"===e.code&&(i=e.as(xC).event).category===hC.FRIEND_DISCOVERED&&(t=DC.getDataAsFriendDiscoveredEvent(a,i).friendDiscoveries,ae(function(){return re(o,void 0,void 0,function(){return ie(this,function(e){return[2,l.forEach(function(e){e.onFriendsDiscovered(t)})]})})}));else if(e instanceof um){var n=N.of(o._iid).subscribedUnreadMessageCount,r=!1,i=e.ts;if("number"==typeof i&&i>n.ts){if(n.all!==e.all&&(r=!0),n.all=0<=e.all?e.all:0,e.customTypes)for(var s in e.customTypes)n.customTypes[s]!==e.customTypes[s]&&(r=!0),n.customTypes[s]=e.customTypes[s];r=r&&0<n.ts,n.ts=i}r&&ae(function(){return re(o,void 0,void 0,function(){return ie(this,function(e){return[2,l.forEach(function(e){e.onTotalUnreadMessageCountUpdated(n.all,n.customTypes)})]})})})}else e instanceof hE&&c.localCacheEnabled&&c.preference.set(o._getUserProfileCacheKey(u.userId),dE.payloadify(e.userProfile))})}function OO(e){var t=e.name,n=e.version,r=e.store,e=e.config;this.name=t,this._version=n,this._state=lO.INIT,this._config=e||new eA({dbname:t}),this._store=r,this._event={success:TA,error:TA,upgrade:kA},this._collections=new Map,this._globalMutex=new dO("".concat(this.name,".lock")),this._config.disableLogger&&gO.off(),new WA({dbname:t,limit:this._config.cacheLimit})}(n=CO=CO||{})[n.NONE=0]="NONE",n[n.CHANNEL_ENTER=10102]="CHANNEL_ENTER",n[n.CHANNEL_EXIT=10103]="CHANNEL_EXIT",n[n.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",n[n.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",n[n.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",n[n.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",n[n.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",n[n.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",n[n.TYPING_START=10900]="TYPING_START",n[n.TYPING_END=10901]="TYPING_END",n[n.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",n[n.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",n[n.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",n[n.CHANNEL_INVITE=10020]="CHANNEL_INVITE",n[n.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",n[n.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",n[n.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",n[n.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",n[n.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",n[n.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",n[n.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",n[n.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE";Object.defineProperty($O.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===ym.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty($O.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===ym.OPEN},enumerable:!1,configurable:!0});var RO,DO,MO,xO,LO,PO,UO,qO=$O,FO=(o(ZO,UO=zy),ZO),jO=(o(JO,PO=FO),JO),HO=(o(XO,LO=zy),XO),GO=(o(YO,xO=zy),YO),VO=(o(WO,MO=zy),WO),BO=(o(zO,DO=zy),zO),KO=(o(QO,RO=zy),QO);function QO(e,t,n){var r=RO.call(this,e,"MTHD",n)||this;return r.event=new Tb(e,n),r}function zO(e,t,n){e=DO.call(this,e,"MRCT",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.event=new BE(n),e}function WO(e,t,n){var r,i=this,e=((i=MO.call(this,e,"AEDI",n)||this).message=new g0(e,n),N.of(e).sdkState);return i.mentionCountChange=Mg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function YO(e,t,n){var r,i=this,e=((i=xO.call(this,e,"ADMM",n)||this).message=new g0(e,n),N.of(e).sdkState);return i.isMentioned=jg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function XO(e,t,n){e=LO.call(this,e,"MCNT",n)||this;return e.groupChannelMemberCounts=n.group_channels.map(function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}}),e.openChannelMemberCounts=n.open_channels.map(function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}}),e}function JO(e,t,n){var r=PO.call(this,e,t,n)||this,e=n.data.operators,t=void 0===e?[]:e;return r.operators=t.map(function(e){return new k(r._iid,e)}),r}function ZO(e,t,n){e=UO.call(this,e,"SYEV",n)||this;return e.event=new qO(n),e}function $O(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}o(fR,rR=jn),Object.defineProperty(fR.prototype,"enteredChannels",{get:function(){var t=this;return this._enteredChannelUrls.map(function(e){return t._channels.get(e)}).filter(function(e){return null!==e})},enumerable:!1,configurable:!0}),fR.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},fR.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},fR.prototype.exit=function(e){e=this._enteredChannelUrls.indexOf(e);0<=e&&this._enteredChannelUrls.splice(e,1)},fR.prototype.exitAll=function(){this._enteredChannelUrls=[]},fR.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,null!=(n=this._channels.get(t))?n:null]})})},fR.prototype.upsert=function(t){return re(this,void 0,void 0,function(){var n=this;return ie(this,function(e){return t.forEach(function(e){var t;n._channels.has(e.url)?(t=n._channels.get(e.url),Object.assign(t,e)):n._channels.set(e.url,e)}),[2]})})},fR.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._channels.delete(t),this.exit(t),[2]})})},fR.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]})})};var eR,tR,nR,rR,iR,sR=fR,aR={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},oR=(o(dR,nR=h),dR),uR=(o(hR,tR=S),hR),cR=(o(lR,eR=h),lR);function lR(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,i=e.name,s=e.data,a=e.customType,e=e.operatorUserIds;return(t=eR.call(this)||this).method=T.POST,t.path=sg,t.params=w({channel_url:n,cover_url:c("string",r)?r:null,cover_file:ry(r)?r:null,name:i,data:s,custom_type:a,operators:e}),t}function hR(e,t){var n=tR.call(this,e,t)||this;return n.channel=null,n.channel=new ZR(e,t),n}function dR(e){var t=e.channelUrl,e=e.isInternalCall,n=nR.call(this)||this;return n.method=T.GET,n.path="".concat(e?ag:sg,"/").concat(encodeURIComponent(t)),n}function fR(){var e=null!==rR&&rR.apply(this,arguments)||this;return e._channels=new Map,e._enteredChannelUrls=[],e}o(function(e,t){var n=iR.call(this,e,t)||this;return n.channel=new ZR(e,t),n},iR=S);o(WR,wR=Wy);var pR,vR,_R,yR,mR,gR,ER,bR,IR,wR,TR,SR=WR,CR=(o(zR,IR=zy),zR),kR=(o(QR,bR=Wy),QR),NR=(o(KR,ER=zy),KR),AR={},OR=(BR.of=function(e){return AR[e]},BR.prototype.buildOpenChannelFromSerializedData=function(e){e=nE(e);return new ZR(e._iid,ZR.payloadify(e))},BR.prototype.getChannelFromCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.get(t)];case 1:return[2,e.sent()]}})})},BR.prototype.upsertChannelsToCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.upsert(t)];case 1:return e.sent(),[2]}})})},BR.prototype.removeChannelsFromCache=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,7]),t=se(a),n=t.next(),e.label=1;case 1:return n.done?[3,4]:(r=n.value,[4,this._openChannelCache.remove(r)]);case 2:e.sent(),e.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=e.sent(),i={error:r},[3,7];case 6:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}})})},BR.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},BR.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},BR.prototype._handleEvent=function(ne){return re(this,void 0,void 0,function(){var a,U,o,t,u,c,q,l,n,r,F,j,s,H,G,h,i,d,f,p,v,_,y,V,B,m,g,E,K,Q,b,I,w,T,S,C,k,z,N,W,A,Y,O,R,D,M,x,L,X,J,Z,$,ee,te,P=this;return ie(this,function(e){switch(e.label){case 0:switch(e.trys.push([0,51,,52]),ne.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"SYEV":return[3,27]}return[3,50];case 1:return t=null,"MESG"===ne.code?t=ne.as(rS):"FILE"===ne.code?t=ne.as(k0):"ADMM"!==ne.code&&"BRDM"!=ne.code||(t=ne.as(GO)),t?(a=t.message,U=t.isMentioned,a.channelType!==ym.OPEN?[3,3]:[4,this.getChannel(a.channelUrl,!0)]):[3,3];case 2:o=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(o.url)&&r.onMessageReceived(o,a),U&&r.onMentionReceived(o,a)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=3;case 3:return[3,50];case 4:return t=null,"MEDI"===ne.code?t=ne.as(sS):"FEDI"===ne.code?t=ne.as(oS):"AEDI"===ne.code&&(t=ne.as(VO)),!t||(u=t.message).channelType!==ym.OPEN?[3,6]:[4,this.getChannel(u.channelUrl,!0)];case 5:c=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(c.url)&&r.onMessageUpdated(c,u)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=6;case 6:return[3,50];case 7:return n=ne.as(PS),f=n.channelUrl,r=n.channelType,q=n.messageId,r!==ym.OPEN?[3,9]:[4,this.getChannel(f,!0)];case 8:l=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(l.url)&&r.onMessageDeleted(l,q)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=9;case 9:return[3,50];case 10:return n=ne.as(BO),f=n.channelUrl,r=n.channelType,F=n.event,r!==ym.OPEN?[3,12]:[4,this.getChannel(f,!0)];case 11:j=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onReactionUpdated(j,F)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=12;case 12:return[3,50];case 13:return(s=ne.as(KO).event).channelType!==ym.OPEN?[3,15]:[4,this.getChannel(s.channelUrl,!0)];case 14:H=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onThreadInfoUpdated(H,s)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=15;case 15:return[3,50];case 16:G=ne.as(HO).openChannelMemberCounts,h=[],e.label=17;case 17:e.trys.push([17,22,23,24]),i=se(G),d=i.next(),e.label=18;case 18:return d.done?[3,21]:(p=d.value,f=p.channelUrl,E=p.participantCount,p=p.updatedAt,[4,this.getChannelFromCache(f)]);case 19:(v=e.sent())&&v._updateParticipantCount(E,p)&&h.push(v),e.label=20;case 20:return d=i.next(),[3,18];case 21:return[3,24];case 22:return v=e.sent(),ee={error:v},[3,24];case 23:try{d&&!d.done&&(te=i.return)&&te.call(i)}finally{if(ee)throw ee.error}return[7];case 24:return 0<h.length?[4,this.upsertChannelsToCache(h)]:[3,26];case 25:e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onChannelMemberCountChanged(h)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=26;case 26:return[3,50];case 27:if((_=ne.as(FO).event).isOpenChannelEvent)switch(_.category){case CO.CHANNEL_ENTER:return[3,28];case CO.CHANNEL_EXIT:return[3,30];case CO.CHANNEL_OPERATOR_UPDATE:return[3,32];case CO.USER_CHANNEL_MUTE:case CO.USER_CHANNEL_UNMUTE:return[3,34];case CO.USER_CHANNEL_BAN:case CO.USER_CHANNEL_UNBAN:return[3,36];case CO.CHANNEL_FREEZE:case CO.CHANNEL_UNFREEZE:return[3,38];case CO.CHANNEL_DELETED:return[3,40];case CO.CHANNEL_PROP_CHANGED:return[3,43];case CO.CHANNEL_META_DATA_CHANGED:return[3,45];case CO.CHANNEL_META_COUNTERS_CHANGED:return[3,47]}return[3,49];case 28:return[4,this.getChannel(_.channelUrl,!0)];case 29:return y=e.sent(),g=ne.as(CR),E=g.participantCount,V=g.user,B=y._updateParticipantCount(E,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserEntered(y,V),B&&e.onChannelParticipantCountChanged(y)}),[2]})})}),[3,49];case 30:return[4,this.getChannel(_.channelUrl,!0)];case 31:return m=e.sent(),g=ne.as(NR),E=g.participantCount,K=g.user,Q=m._updateParticipantCount(E,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserExited(m,K),Q&&e.onChannelParticipantCountChanged(m)}),[2]})})}),[3,49];case 32:return[4,this.getChannel(_.channelUrl,!0)];case 33:return b=e.sent(),I=ne.as(jO).operators,b.operators=I,this.upsertChannelsToCache([b]),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onOperatorUpdated(b,I)}),[2]})})}),[3,49];case 34:return[4,this.getChannel(_.channelUrl,!0)];case 35:return w=e.sent(),T=_.category===CO.USER_CHANNEL_MUTE,S=ne.as(T?vT:IT).user,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){T?e.onUserMuted(w,S):e.onUserUnmuted(w,S)}),[2]})})}),[3,49];case 36:return[4,this.getChannel(_.channelUrl,!0)];case 37:return C=e.sent(),k=_.category===CO.USER_CHANNEL_BAN,z=ne.as(k?AT:PT).user,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){k?e.onUserBanned(C,z):e.onUserUnbanned(C,z)}),[2]})})}),[3,49];case 38:return[4,this.getChannel(_.channelUrl,!0)];case 39:return N=e.sent(),W=ne.as(ZT).freeze,N.isFrozen=W,this.upsertChannelsToCache([N]),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){W?e.onChannelFrozen(N):e.onChannelUnfrozen(N)}),[2]})})}),[3,49];case 40:return[4,this.getChannel(_.channelUrl,!0)];case 41:return A=e.sent(),[4,this.removeChannelsFromCache([A.url])];case 42:return e.sent(),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelDeleted(A.url,A.channelType)}),[2]})})}),[3,49];case 43:return[4,this.getChannelWithoutCache(_.channelUrl,!0)];case 44:return Y=e.sent(),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelChanged(Y)}),[2]})})}),[3,49];case 45:return[4,this.getChannel(_.channelUrl,!0)];case 46:return O=e.sent(),L=ne.as(Cw),R=L.created,D=L.updated,M=L.deleted,R&&O._upsertCachedMetaData(R,_.ts),D&&O._upsertCachedMetaData(D,_.ts),M&&O._removeFromCachedMetaData(M,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){R&&e.onMetaDataCreated(O,R),D&&e.onMetaDataUpdated(O,D),M&&e.onMetaDataDeleted(O,M)}),[2]})})}),[3,49];case 47:return[4,this.getChannel(_.channelUrl,!0)];case 48:return x=e.sent(),L=ne.as(Uw),X=L.created,J=L.updated,Z=L.deleted,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){X&&e.onMetaCounterCreated(x,X),J&&e.onMetaCounterUpdated(x,J),Z&&e.onMetaCounterDeleted(x,Z)}),[2]})})}),[3,49];case 49:return[3,50];case 50:return[3,52];case 51:if($=e.sent(),ey($))throw $;return[3,52];case 52:return[2]}})})},BR.prototype.addHandler=function(e,t){this._openChannelHandlers.set(e,t)},BR.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},BR.prototype.clearHandler=function(){this._openChannelHandlers.clear()},BR.prototype.getChannel=function(n,e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:C(c("string",n)).throw(p.invalidParameters),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.getChannelFromCache(n)];case 2:return(t=e.sent())?[2,t]:[3,4];case 3:return e.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(n)];case 5:return[2,e.sent()]}})})},BR.prototype.getChannelWithoutCache=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(c("string",r)).throw(p.invalidParameters),t=new oR({channelUrl:r,isInternalCall:i}),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(uR).channel,[4,this.upsertChannelsToCache([n])];case 2:return e.sent(),[2,n]}})})},BR.prototype.createChannel=function(i){return re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){switch(e.label){case 0:return i=f(f({},aR),i),C(hy("string",(t=i).operatorUserIds,!0)&&(c("string",t.coverUrlOrImage)||ry(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&c("string",t.name,!0)&&c("string",t.data,!0)&&c("string",t.customType,!0)&&(c("string",t.channelUrl)&&/^\w+$/.test(t.channelUrl)||null===t.channelUrl)).throw(p.invalidParameters),n=new cR(i),[4,this._requestQueue.send(n)];case 1:return n=e.sent(),r=n.as(uR).channel,this.upsertChannelsToCache([r]),[2,r]}var t})})},BR),RR={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},DR=(o(VR,gR=h),VR),MR=(o(GR,mR=S),GR),xR=(o(HR,yR=hs),HR.prototype._validate=function(){return yR.prototype._validate.call(this)},HR.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new DR(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(MR),r=n.participants,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},HR),LR=(o(jR,_R=h),jR),PR=(o(FR,vR=S),FR),UR=(o(qR,pR=h),qR);function qR(e){var t=this,e=e.channelUrl;return(t=pR.call(this)||this).method=T.DELETE,t.path="".concat(sg,"/").concat(encodeURIComponent(e)),t}function FR(e,t){var n=vR.call(this,e,t)||this;return n.channel=new ZR(e,t),n}function jR(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,i=e.name,s=e.data,a=e.customType,e=e.operatorUserIds;return(t=_R.call(this)||this).method=T.PUT,t.path="".concat(sg,"/").concat(encodeURIComponent(n)),t.params=w({cover_url:c("string",r)?r:null,cover_file:ry(r)?r:null,name:i,data:s,custom_type:a,operators:e}),t}function HR(e,t,n){return yR.call(this,e,t,ym.OPEN,n)||this}function GR(t,e){var n=mR.call(this,t,e)||this,r=(n.token=null,n.participants=[],e.next),e=e.participants;return n.token=r,n.participants=e.map(function(e){return new k(t,e)}),n}function VR(e){var t=this,n=e.channelUrl,r=e.token,e=e.limit;return(t=gR.call(this)||this).method=T.GET,t.path="".concat(sg,"/").concat(encodeURIComponent(n),"/participants"),t.params={token:r,limit:e},t}function BR(e,t){var n=t.sdkState,r=t.dispatcher,t=t.requestQueue,a=this;this._sdkState=n,this._requestQueue=t,this._dispatcher=r,this._openChannelCache=new sR(e),this._openChannelHandlers=new Map,this._dispatcher.on(function(e){var t,n;if(e instanceof zy)a._handleEvent(e);else if(e instanceof jm&&e.stateType===im.CONNECTED){var r=a._openChannelCache.enteredChannels;try{for(var i=se(r),s=i.next();!s.done;s=i.next())s.value.enter()}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}),AR[e]=this}function KR(e,t,n){var r,i=this,i=ER.call(this,e,"EXIT",n)||this;return n.data&&(i.participantCount=null!=(r=n.data.participant_count)?r:0,i.user=new k(e,n.data),i.ts=null!=(r=n.data.edge_ts)?r:0),i}function QR(e){e=e.channelUrl;return bR.call(this,{code:"EXIT",payload:{channel_url:e},ackRequired:!0})||this}function zR(e,t,n){var r,i=this,i=IR.call(this,e,"ENTR",n)||this;return n.data&&(i.participantCount=null!=(r=n.data.participant_count)?r:0,i.user=new k(e,n.data),i.ts=null!=(r=n.data.edge_ts)?r:0),i}function WR(e){e=e.channelUrl;return wR.call(this,{code:"ENTR",payload:{channel_url:e},ackRequired:!0})||this}o(function(e,t){return TR.call(this,e,t)||this},TR=S);o($R,YR=zS),$R.payloadify=function(e){return e?w(f(f({},zS.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map(function(e){return k.payloadify(e)})})):null},$R.prototype.serialize=function(){return tE(this)},$R.prototype.isOperator=function(t){return t instanceof k?this.isOperator(t.userId):this.operators.some(function(e){return e.userId===t})},$R.prototype._updateParticipantCount=function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)},$R.prototype.createParticipantListQuery=function(e){return new xR(this._iid,this.url,e)},$R.prototype.refresh=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,OR.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}})})},$R.prototype.enter=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new SR({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(CR),r=n.participantCount,i=n.ts,this._updateParticipantCount(r,i),OR.of(this._iid).setEnteredToCache(this),[2]}})})},$R.prototype.exit=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new kR({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(NR),r=n.participantCount,i=n.ts,this._updateParticipantCount(r,i),OR.of(this._iid).setExitedToCache(this),Ib.of(this._iid).fileMessageQueue.cancel(this),[2]}})})},$R.prototype.updateChannel=function(s){return re(this,void 0,void 0,function(){var n,r,i;return ie(this,function(e){switch(e.label){case 0:return s=f(f({},RR),s),C(hy("string",(t=s).operatorUserIds,!0)&&(c("string",t.coverUrlOrImage)||ry(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&c("string",t.name,!0)&&c("string",t.data,!0)&&c("string",t.customType,!0)).throw(p.invalidParameters),r=N.of(this._iid).requestQueue,n=new LR(f({channelUrl:this.url},s)),[4,r.send(n)];case 1:return r=e.sent(),i=r.as(PR).channel,[4,OR.of(this._iid).upsertChannelsToCache([i])];case 2:return e.sent(),[2,i]}var t})})},$R.prototype.updateChannelWithOperatorUserIds=function(n,r,i,s,a){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=f(f({},RR),{name:n,coverUrlOrImage:r,data:i,operatorUserIds:s,customType:a}),[2,this.updateChannel(t)]})})},$R.prototype.delete=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new UR({channelUrl:this.url}),[4,t.send(n)];case 1:return e.sent(),[4,OR.of(this._iid).removeChannelsFromCache([this.url])];case 2:return e.sent(),[2]}})})};var YR,XR,JR,ZR=$R;function $R(t,e){var n,r=this;return(r=YR.call(this,t,e)||this)._lastParticipantCountUpdated=0,r.participantCount=0,r.operators=[],r.channelType=ym.OPEN,r.participantCount=null!=(n=e.participant_count)?n:0,r.operators=Array.isArray(e.operators)?e.operators.map(function(e){return new k(t,e)}):[],r}function eD(t){void 0===t&&(t={});var n=XR.call(this)||this;return Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&(n[e]=t[e])}),n}function tD(){var e=null!==JR&&JR.apply(this,arguments)||this;return e.onUserEntered=jy,e.onUserExited=jy,e.onChannelParticipantCountChanged=jy,e}o(tD,JR=function(){this.onUserMuted=jy,this.onUserUnmuted=jy,this.onUserBanned=jy,this.onUserUnbanned=jy,this.onChannelChanged=jy,this.onChannelDeleted=jy,this.onChannelFrozen=jy,this.onChannelUnfrozen=jy,this.onOperatorUpdated=jy,this.onChannelMemberCountChanged=jy,this.onMetaDataCreated=jy,this.onMetaDataUpdated=jy,this.onMetaDataDeleted=jy,this.onMetaCounterCreated=jy,this.onMetaCounterUpdated=jy,this.onMetaCounterDeleted=jy,this.onMessageReceived=jy,this.onMessageUpdated=jy,this.onMessageDeleted=jy,this.onMentionReceived=jy,this.onReactionUpdated=jy,this.onThreadInfoUpdated=jy}),o(eD,XR=tD);o(fD,sD=h);var nD,rD,iD,sD,aD=fD,oD=(o(dD,iD=S),dD),uD=(o(hD,rD=s),hD.prototype._validate=function(){return rD.prototype._validate.call(this)&&c("boolean",this.includeFrozen)&&c("boolean",this.includeMetaData)&&c("string",this.nameKeyword,!0)&&c("string",this.urlKeyword,!0)&&hy("string",this.customTypes,!0)},hD.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new aD(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,3]:[3,6];case 1:return t=e.sent(),n=t.as(oD),r=n.channels,i=n.token,this._token=i,this._hasNext=!!i,[4,OR.of(this._iid).upsertChannelsToCache(r)];case 2:return e.sent(),this._isLoading=!1,[2,r];case 3:return[2,[]];case 4:throw p.queryInProgress;case 5:return[3,7];case 6:throw p.invalidParameters;case 7:return[2]}})})},hD),cD=(o(lD,nD=ci),lD.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;nD.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new OR(e,{sdkState:n,dispatcher:r,requestQueue:s})},lD.prototype.createOpenChannelListQuery=function(e){return new uD(this._iid,e=void 0===e?{}:e)},lD.prototype.addOpenChannelHandler=function(e,t){this._manager.addHandler(e,t)},lD.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},lD.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},lD.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},lD.prototype.getChannel=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.getChannel(t)]})})},lD.prototype.getChannelWithoutCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.getChannelWithoutCache(t)]})})},lD.prototype.createChannel=function(t){return void 0===t&&(t={}),re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.createChannel(t)]})})},lD.prototype.createChannelWithOperatorUserIds=function(n,r,i,s,a){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return(t=f({},aR)).name=n,t.coverUrlOrImage=r,t.data=i,t.operatorUserIds=s,t.customType=a,[2,this._manager.createChannel(t)]})})},lD);function lD(){var e=null!==nD&&nD.apply(this,arguments)||this;return e.name="openChannel",e}function hD(e,t){var n=this;return(n=rD.call(this,e,t)||this).includeFrozen=!0,n.includeMetaData=!0,n.nameKeyword=null,n.urlKeyword=null,n.customTypes=null,n.includeFrozen=null==(e=t.includeFrozen)||e,n.includeMetaData=null==(e=t.includeMetaData)||e,n.nameKeyword=null!=(e=t.nameKeyword)?e:null,n.urlKeyword=null!=(e=t.urlKeyword)?e:null,n.customTypes=null!=(e=t.customTypes)?e:null,n}function dD(t,e){var n=iD.call(this,t,e)||this,r=(n.token=null,n.channels=[],n.ts=null,e.next),i=e.channels,e=e.ts;return n.token=r,i&&0<i.length&&(n.channels=i.map(function(e){return new ZR(t,e)})),n.ts="number"==typeof e?e:null,n}function fD(e){var t=this,n=e.token,r=e.limit,i=e.nameKeyword,s=e.urlKeyword,a=e.customTypes,o=e.includeFrozen,e=e.includeMetaData;return(t=sD.call(this)||this).method=T.GET,t.path=sg,t.params=w({token:n,limit:r,name_contains:i,url_contains:s,custom_types:a,show_frozen:o,show_metadata:e}),t}function pD(i){return function(e,t,n){var e=bD(ID(e)),t=ED(t),r=e.length,n=void 0===n?" ":bD(n);return t<=r||""==n?e:((r=wD(n,SD((t=t-r)/n.length))).length>t&&(r=TD(r,0,t)),i?e+r:r+e)}}var vD=function(){g(s,Eh);var t,n,r,i=b(s);function s(e){var t;return _(this,s),(t=i.call(this))._ctx=e,t.wsClient=new z_(x(x({},e),{},{parse:function(e){return Vl.parse(e)}})),t.apiClient=new W_(x(x({},e),{},{parseResponse:function(e,t){return Vl.parseResponse(e,t)}})),t._unsubscriber=t.wsClient.on("command",function(e){t._dispatchEvent("command",e)}),t}return y(s,[{key:"connectWs",value:function(){return this.wsClient.connect()}},{key:"sendAPI",value:function(e){return this.apiClient.send(e)}},{key:"send",value:(r=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sendAPI(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"sendWithRetry",value:(n=v(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o=this,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<u.length&&void 0!==u[1]?u[1]:new Pv,s=2<u.length&&void 0!==u[2]?u[2]:{count:0,deferred:new xv},r=s.deferred,i=s.count,e.prev=3,e.next=6,this.send(t);case 6:s=e.sent,r.resolve(s),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),0<(a=n.calcTimeout(i))?setTimeout(function(){o.sendWithRetry(t,n,{count:i+1,deferred:r})},a):r.reject(e.t0);case 14:return e.abrupt("return",r.promise);case 15:case"end":return e.stop()}},e,this,[[3,10]])})),function(e){return n.apply(this,arguments)})},{key:"_setSessionKey",value:function(e){this.apiClient.setSessionKey(e),this.wsClient.setSessionKey(e)}},{key:"authenticate",value:(t=v(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userId,r=t.accessToken,this._ctx.sb||(this._ctx.sb=AO.init({appId:this._ctx.appId,modules:[new cD]})),e.prev=2,e.next=5,this._ctx.sb.connect(n,r);case 5:return i=Vl.createAuth(this._ctx.appId,n,r),e.next=8,this.send(i);case 8:i=e.sent,this._setSessionKey(i.sbcall_session_token),this._ctx.liveEventManager.userId=i.user.user_id,e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(2),I.error("failed to authenticate user ".concat(n)),e.t0;case 17:case"end":return e.stop()}},e,this,[[2,13]])})),function(e){return t.apply(this,arguments)})},{key:"deauthenticate",value:function(){this.apiClient.clearSessionKey(),this.wsClient.clearSessionKey()}}]),s}(),_D=Ce,yD=zi,mD=ue,gD=RangeError,Jn=et,ED=Ne,bD=zi,ID=ue,wD=Jn(function(e){var t=yD(mD(this)),n="",r=_D(e);if(r<0||r==1/0)throw gD("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}),TD=Jn("".slice),SD=Math.ceil,Jt={start:pD(!1),end:pD(!0)},rt=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(yt),gt=Me,CD=Jt.start,kD=(gt({target:"String",proto:!0,forced:rt},{padStart:function(e){return CD(this,e,1<arguments.length?arguments[1]:void 0)}}),{VERBOSE:{level:-1,name:uh.VERBOSE,public:!1},DEBUG:{level:1,name:uh.DEBUG,public:!1},INFO:{level:2,name:uh.INFO,public:!0},WARNING:{level:3,name:uh.WARNING,public:!0},ERROR:{level:4,name:uh.ERROR,public:!0},NONE:{level:100,name:uh.NONE,public:!0}}),ND=function(){function t(e){_(this,t),this.level=e||uh.NONE}return y(t,[{key:"setLoggerLevel",value:function(e){var t;return null!=(t=kD[e])&&t.public&&(this.level=e),this.level}},{key:"_enabledFor",value:function(e){try{return kD[this.level].level<=kD[e].level}catch(e){return!1}}}]),t}(),AD=function(){g(n,ND);var t=b(n);function n(e){return _(this,n),t.call(this,e)}return y(n,[{key:"_getLogType",value:function(e){switch(e){case uh.ERROR:return"error";case uh.WARNING:return"warn";default:return"log"}}},{key:"_getTimeString",value:function(e){var t=e.getFullYear().toString().padStart(2,"0"),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),a=e.getSeconds().toString().padStart(2,"0"),e=e.getMilliseconds().toString().padStart(2,"0");return"[".concat(t,".").concat(n,".").concat(r," ").concat(i,":").concat(s,":").concat(a,":").concat(e,"]")}},{key:"_permit",value:function(e){var t=this._getLogType(e),n=new Date;if(this._enabledFor(e)&&console&&console[t]){for(var n="".concat(this._getTimeString(n)," [").concat(e,"]"),r=arguments.length,i=new Array(1<r?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];(e=console)[t].apply(e,[n].concat(i))}}}]),n}(),ds=function(){function e(){_(this,e),m(this,"_ctx",{})}var t,n,r,i;return y(e,[{key:"init",value:function(e){var t=e.appId,e=e.chatInstance;e&&(this._ctx.sb=e),this._consoleLogListener=new AD(uh.NONE),I.addListener(this._consoleLogListener),this._ctx.appId=t,this._ctx.clientId=$(),this._ctx.commandRouter=new vD(this._ctx),this._ctx.deviceManager=new B_,this._ctx.liveEventManager=new a_(this._ctx)}},{key:"setLoggerLevel",value:function(e){return this._consoleLogListener.setLoggerLevel(e)}},{key:"authenticate",value:(i=v(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.commandRouter.authenticate({userId:t,accessToken:n});case 2:return e.next=4,this._ctx.commandRouter.connectWs();case 4:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"deauthenticate",value:(r=v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.sb.disconnect();case 2:this._ctx.commandRouter.deauthenticate(),this._ctx.liveEventManager.clear(),I.removeAllListener();case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"createLiveEvent",value:(n=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.liveEventManager.createLiveEvent(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getLiveEvent",value:(t=v(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.liveEventManager.getLiveEvent(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"createLiveEventListQuery",value:function(e){return new As(e,this._ctx.commandRouter)}},{key:"getAvailableAudioInputDevices",value:function(){return this._ctx.deviceManager.getAvailableAudioInputDevices()}},{key:"getAvailableVideoInputDevices",value:function(){return this._ctx.deviceManager.getAvailableVideoInputDevices()}}]),e}(),i=(D.ErrorCode=void 0,(ri=D.ErrorCode||(D.ErrorCode={}))[ri.LIVE_EVENT_ID_NOT_FOUND=2800100]="LIVE_EVENT_ID_NOT_FOUND",ri[ri.ACTION_NOT_ALLOWED_IN_CURRENT_STATE=2800101]="ACTION_NOT_ALLOWED_IN_CURRENT_STATE",ri[ri.ACTION_NOT_ALLOWED_FOR_PARTICIPANT=2800102]="ACTION_NOT_ALLOWED_FOR_PARTICIPANT",ri[ri.USER_NOT_ENTERED_LIVE_EVENT=2800103]="USER_NOT_ENTERED_LIVE_EVENT",ri[ri.STREAM_NOT_STARTED=2800104]="STREAM_NOT_STARTED",ri[ri.CONNECTION_TO_MEDIA_STREAM_FAILED=2800105]="CONNECTION_TO_MEDIA_STREAM_FAILED",ri[ri.UNKNOWN_NETWORK_ERROR=2800400]="UNKNOWN_NETWORK_ERROR",ri[ri.QUERY_IN_PROGRESS=2800900]="QUERY_IN_PROGRESS",ri[ri.OPEN_CHANNEL_NOT_FETCHED=2800901]="OPEN_CHANNEL_NOT_FETCHED",new ds);D.LiveEvent=s_,D.SendbirdLive=i,Object.defineProperty(D,"__esModule",{value:!0})});