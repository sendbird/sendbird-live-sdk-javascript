!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sendbirdLive={})}(this,function(D){"use strict";function M(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function L(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function h(o){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=o.apply(e,a);function i(e){L(r,t,n,i,s,"next",e)}function s(e){L(r,t,n,i,s,"throw",e)}i(void 0)})}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=U(n),t=(e=r?(e=U(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return v(t)}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function j(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}var H,G="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},V={exports:{}},V=function(a){var u,e=Object.prototype,c=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function o(e,t,n,r){var i,s,a,o,t=t&&t.prototype instanceof _?t:_,t=Object.create(t.prototype),r=new S(r||[]);return t._invoke=(i=e,s=n,a=r,o=h,function(e,t){if(o===f)throw new Error("Generator is already running");if(o===p){if("throw"===e)throw t;return k()}for(a.method=e,a.arg=t;;){var n=a.delegate;if(n){n=function e(t,n){var r=t.iterator[n.method];if(r===u){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=u,e(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}r=l(r,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;r=r.arg;if(!r)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v;{if(!r.done)return r;n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=u)}n.delegate=null;return v}(n,a);if(n){if(n===v)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===h)throw o=p,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=f;n=l(i,s,a);if("normal"===n.type){if(o=a.done?p:d,n.arg!==v)return{value:n.arg,done:a.done}}else"throw"===n.type&&(o=p,a.method="throw",a.arg=n.arg)}}),t}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}a.wrap=o;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",v={};function _(){}function y(){}function m(){}var t={},g=(s(t,r,function(){return this}),Object.getPrototypeOf),g=g&&g(g(C([]))),E=(g&&g!==e&&c.call(g,r)&&(t=g),m.prototype=_.prototype=Object.create(t));function b(e){["next","throw","return"].forEach(function(t){s(e,t,function(e){return this._invoke(t,e)})})}function I(a,o){var t;this._invoke=function(n,r){function e(){return new o(function(e,t){!function t(e,n,r,i){var s,e=l(a[e],a,n);if("throw"!==e.type)return(n=(s=e.arg).value)&&"object"==typeof n&&c.call(n,"__await")?o.resolve(n.__await).then(function(e){t("next",e,r,i)},function(e){t("throw",e,r,i)}):o.resolve(n).then(function(e){s.value=e,r(s)},function(e){return t("throw",e,r,i)});i(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(t){if(t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=u,e.done=!0,e}).next=e}return{next:k}}function k(){return{value:u,done:!0}}return s(E,"constructor",y.prototype=m),s(m,"constructor",y),y.displayName=s(m,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,i,"GeneratorFunction")),e.prototype=Object.create(E),e},a.awrap=function(e){return{__await:e}},b(I.prototype),s(I.prototype,n,function(){return this}),a.AsyncIterator=I,a.async=function(e,t,n,r,i){void 0===i&&(i=Promise);var s=new I(o(e,t,n,r),i);return a.isGeneratorFunction(t)?s:s.next().then(function(e){return e.done?e.value:s.next()})},b(E),s(E,i,"Generator"),s(E,r,function(){return this}),s(E,"toString",function(){return"[object Generator]"}),a.keys=function(n){var e,r=[];for(e in n)r.push(e);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return s.type="throw",s.arg=n,r.next=e,t&&(r.method="next",r.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],s=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),o=c.call(i,"finallyLoc");if(a&&o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}var s=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(n=i.completion).type&&(r=n.arg,T(i)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=u),v}},a}(V.exports);try{regeneratorRuntime=V}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=V:Function("r","regeneratorRuntime = r")(V)}var B=new Uint8Array(16);var Q=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function K(e){return"string"==typeof e&&Q.test(e)}for(var z=[],W=0;W<256;++W)z.push((W+256).toString(16).substr(1));function Y(e,t){t=1<arguments.length&&void 0!==t?t:0,e=(z[e[t+0]]+z[e[t+1]]+z[e[t+2]]+z[e[t+3]]+"-"+z[e[t+4]]+z[e[t+5]]+"-"+z[e[t+6]]+z[e[t+7]]+"-"+z[e[t+8]]+z[e[t+9]]+"-"+z[e[t+10]]+z[e[t+11]]+z[e[t+12]]+z[e[t+13]]+z[e[t+14]]+z[e[t+15]]).toLowerCase();if(K(e))return e;throw TypeError("Stringified UUID is invalid")}function X(){try{0}catch(e){}}function J(e,t,n){var r=(e=e||{}).random||(e.rng||function(){if(H=H||"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto))return H(B);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return Y(r)}X(),X();function Z(e){return e&&e.Math==Math&&e}function $(e){try{return!!e()}catch(e){return!0}}function ee(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function te(e){return st(it(e),8,-1)}function ne(e){if(null==e)throw ct("Can't call method on "+e);return e}function oe(e){return lt(ht(e))}function ue(e){return"function"==typeof e}function ce(e){return"object"==typeof e?null!==e:dt(e)}function le(e,t){return arguments.length<2?(n=ft[e],pt(n)?n:void 0):ft[e]&&ft[e][t];var n}function he(e){try{return Ct(e)}catch(e){return"Object"}}function de(e){if(kt(e))return e;throw At(Nt(e)+" is not a function")}function fe(e,t){return null==(e=e[t])?void 0:Ot(e)}function pe(t,n){try{Pt(Lt,t,{value:n,configurable:!0,writable:!0})}catch(e){Lt[t]=n}return n}function ve(e){return jt(Ft(e))}function _e(e){return"Symbol("+(void 0===e?"":e)+")_"+Kt(++Bt+Qt,36)}function ye(e){var t;return Wt(Zt,e)&&(Xt||"string"==typeof Zt[e])||(t="Symbol."+e,Xt&&Wt($t,e)?Zt[e]=$t[e]:Zt[e]=(Jt&&en?en:tn)(t)),Zt[e]}function me(e,t){if(!rn(e)||sn(e))return e;var n=an(e,cn);if(n){if(n=nn(n,e,t=void 0===t?"default":t),!rn(n)||sn(n))return n;throw un("Can't convert object to primitive value")}return on(e,t=void 0===t?"number":t)}function ge(e){return e=ln(e,"string"),hn(e)?e:e+""}function Ee(e){return fn?dn.createElement(e):{}}function be(e){if(wn(e))return e;throw Sn(Tn(e)+" is not an object")}function Ie(e){return Gn[e]||(Gn[e]=Hn(e))}function we(e,t,n,r){var i=(r=r||{}).enumerable,s=void 0!==r.name?r.name:t;if(ar(n)&&ur(n,s,r),r.global)i?e[t]=n:cr(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=n:or.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e}function Te(e){return(e=+e)!=e||0==e?0:dr(e)}function Se(e,t){return(e=fr(e))<0?pr(e+t,0):vr(e,t)}function Ce(e){return 0<e?yr(_r(e),9007199254740991):0}function ke(e){return mr(e.length)}function Ne(o){return function(e,t,n){var r,i=gr(e),s=br(i),a=Er(n,s);if(o&&t!=t){for(;a<s;)if((r=i[a++])!=r)return!0}else for(;a<s;a++)if((o||a in i)&&i[a]===t)return o||a||0;return!o&&-1}}function Ae(e,t){var n,r=wr(e),i=0,s=[];for(n in r)!Ir(Sr,n)&&Ir(r,n)&&Cr(s,n);for(;t.length>i;)!Ir(r,n=t[i++])||~Tr(s,n)||Cr(s,n);return s}function Oe(e,t){return(e=Hr[jr(e)])==Vr||e!=Gr&&(qr(t)?Ur(t):!!t)}function Re(e,t){var n,r,i,s=e.target,a=e.global,o=e.stat,u=a?Br:o?Br[s]||Wr(s,{}):(Br[s]||{}).prototype;if(u)for(n in t){if(r=t[n],i=e.dontCallGetSet?(i=Qr(u,n))&&i.value:u[n],!Xr(a?n:s+(o?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;Yr(r,i)}(e.sham||i&&i.sham)&&Kr(r,"sham",!0),zr(u,n,r,e)}}function De(e,t){return Jr(e),void 0===t?e:Zr?$r(e,t):function(){return e.apply(t,arguments)}}function Me(){}function xe(e){if(!ci(e))return!1;try{return fi(Me,di,e),!0}catch(e){return!1}}function Le(e){if(!ci(e))return!1;switch(li(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return _i||!!vi(pi,hi(e))}catch(e){return!0}}function Pe(e,t){return new(Ii(e))(0===t?0:t)}function Ue(d){var f=1==d,p=2==d,v=3==d,_=4==d,y=6==d,m=7==d,g=5==d||y;return function(e,t,n,r){for(var i,s,a=Si(e),o=Ti(a),u=wi(t,n),c=Ci(o),l=0,t=r||ki,h=f?t(e,c):p||m?t(e,0):void 0;l<c;l++)if((g||l in o)&&(s=u(i=o[l],l,a),d))if(f)h[l]=s;else if(s)switch(d){case 3:return!0;case 5:return i;case 6:return l;case 2:Ni(h,i)}else switch(d){case 4:return!1;case 7:Ni(h,i)}return y?-1:v||_?_:h}}function qe(t){return 51<=Oi||!Ai(function(){var e=[];return(e.constructor={})[Ri]=function(){return{foo:1}},1!==e[t](Boolean).foo})}var Fe,je,He,Ge,Ve,Be,Qe,Ke,c,ze,V=Z("object"==typeof globalThis&&globalThis)||Z("object"==typeof window&&window)||Z("object"==typeof self&&self)||Z("object"==typeof G&&G)||function(){return this}()||Function("return this")(),G={},e=!$(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),We=!$(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),Ye=Function.prototype.call,Xe=We?Ye.bind(Ye):function(){return Ye.apply(Ye,arguments)},Je={},Ze={}.propertyIsEnumerable,$e=Object.getOwnPropertyDescriptor,et=$e&&!Ze.call({1:2},1),et=(Je.f=et?function(e){e=$e(this,e);return!!e&&e.enumerable}:Ze,We),Ze=Function.prototype,tt=Ze.bind,nt=Ze.call,rt=et&&tt.bind(nt,nt),Ze=et?function(e){return e&&rt(e)}:function(e){return e&&function(){return nt.apply(e,arguments)}},tt=Ze,it=tt({}.toString),st=tt("".slice),et=$,at=te,ot=Object,ut=Ze("".split),tt=et(function(){return!ot("z").propertyIsEnumerable(0)})?function(e){return"String"==at(e)?ut(e,""):ot(e)}:ot,ct=TypeError,lt=tt,ht=ne,dt=ue,ft=V,pt=ue,et=Ze({}.isPrototypeOf),vt=le("navigator","userAgent")||"",_t=vt,yt=V.process,mt=V.Deno,yt=yt&&yt.versions||mt&&mt.version,mt=yt&&yt.v8,yt=St=!(St=mt?0<(Et=mt.split("."))[0]&&Et[0]<4?1:+(Et[0]+Et[1]):St)&&_t&&(!(Et=_t.match(/Edge\/(\d+)/))||74<=Et[1])&&(Et=_t.match(/Chrome\/(\d+)/))?+Et[1]:St,gt=yt,mt=$,_t=!!Object.getOwnPropertySymbols&&!mt(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&gt&&gt<41}),Et=_t&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,bt=le,It=ue,wt=et,Tt=Object,St=Et?function(e){return"symbol"==typeof e}:function(e){var t=bt("Symbol");return It(t)&&wt(t.prototype,Tt(e))},Ct=String,kt=ue,Nt=he,At=TypeError,Ot=de,Rt=Xe,Dt=ue,Mt=ce,xt=TypeError,mt={exports:{}},Lt=V,Pt=Object.defineProperty,t=pe,Ut="__core-js_shared__",t=V[Ut]||t(Ut,{}),qt=t,Ft=((mt.exports=function(e,t){return qt[e]||(qt[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.23.4",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.4/LICENSE",source:"https://github.com/zloirock/core-js"}),ne),jt=Object,Ht=ve,Gt=Ze({}.hasOwnProperty),Ut=Object.hasOwn||function(e,t){return Gt(Ht(e),t)},Vt=Ze,Bt=0,Qt=Math.random(),Kt=Vt(1..toString),Vt=V,zt=mt.exports,Wt=Ut,Yt=_e,Xt=_t,Jt=Et,Zt=zt("wks"),$t=Vt.Symbol,en=$t&&$t.for,tn=Jt?$t:$t&&$t.withoutSetter||Yt,nn=Xe,rn=ce,sn=St,an=fe,on=function(e,t){var n,r;if("string"===t&&Dt(n=e.toString)&&!Mt(r=Rt(n,e)))return r;if(Dt(n=e.valueOf)&&!Mt(r=Rt(n,e)))return r;if("string"!==t&&Dt(n=e.toString)&&!Mt(r=Rt(n,e)))return r;throw xt("Can't convert object to primitive value")},un=TypeError,cn=ye("toPrimitive"),ln=me,hn=St,_t=ce,dn=V.document,fn=_t(dn)&&_t(dn.createElement),pn=Ee,Et=!e&&!$(function(){return 7!=Object.defineProperty(pn("div"),"a",{get:function(){return 7}}).a}),vn=Xe,_n=Je,yn=ee,mn=oe,gn=ge,En=Ut,bn=Et,In=Object.getOwnPropertyDescriptor,zt=(G.f=e?In:function(e,t){if(e=mn(e),t=gn(t),bn)try{return In(e,t)}catch(e){}if(En(e,t))return yn(!vn(_n.f,e,t),e[t])},{}),Vt=e&&$(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),wn=ce,Tn=String,Sn=TypeError,Cn=Et,kn=be,Nn=ge,An=TypeError,On=Object.defineProperty,Rn=Object.getOwnPropertyDescriptor,Dn="enumerable",Mn="configurable",xn="writable",Yt=(zt.f=e?Vt?function(e,t,n){var r;return kn(e),t=Nn(t),kn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&xn in n&&!n[xn]&&((r=Rn(e,t))&&r[xn]&&(e[t]=n.value,n={configurable:(Mn in n?n:r)[Mn],enumerable:(Dn in n?n:r)[Dn],writable:!1})),On(e,t,n)}:On:function(e,t,n){if(kn(e),t=Nn(t),kn(n),Cn)try{return On(e,t,n)}catch(e){}if("get"in n||"set"in n)throw An("Accessors not supported");return"value"in n&&(e[t]=n.value),e},e),Ln=zt,Pn=ee,_t=Yt?function(e,t,n){return Ln.f(e,t,Pn(1,n))}:function(e,t,n){return e[t]=n,e},Et={exports:{}},Yt=e,n=Ut,Un=Function.prototype,qn=Yt&&Object.getOwnPropertyDescriptor,n=n(Un,"name"),n={EXISTS:n,PROPER:n&&"something"===function(){}.name,CONFIGURABLE:n&&(!Yt||qn(Un,"name").configurable)},Yt=ue,qn=t,Fn=Ze(Function.toString),Un=(Yt(qn.inspectSource)||(qn.inspectSource=function(e){return Fn(e)}),qn.inspectSource),Yt=ue,qn=Un,jn=V.WeakMap,Yt=Yt(jn)&&/native code/.test(qn(jn)),qn=mt.exports,Hn=_e,Gn=qn("keys"),jn={},qn=Ze,Vn=ce,Bn=_t,Qn=Ut,Kn=Ie,r=jn,zn="Object already initialized",Wn=V.TypeError,Yn=V.WeakMap,Yt=(Qe=Yt||t.state?(Fe=t.state||(t.state=new Yn),je=qn(Fe.get),He=qn(Fe.has),Ge=qn(Fe.set),Ve=function(e,t){if(He(Fe,e))throw new Wn(zn);return t.facade=e,Ge(Fe,e,t),t},Be=function(e){return je(Fe,e)||{}},function(e){return He(Fe,e)}):(r[Ke=Kn("state")]=!0,Ve=function(e,t){if(Qn(e,Ke))throw new Wn(zn);return t.facade=e,Bn(e,Ke,t),t},Be=function(e){return Qn(e,Ke)?e[Ke]:{}},function(e){return Qn(e,Ke)}),{set:Ve,get:Be,has:Qe,enforce:function(e){return Qe(e)?Be(e):Ve(e,{})},getterFor:function(t){return function(e){if(Vn(e)&&(e=Be(e)).type===t)return e;throw Wn("Incompatible receiver, "+t+" required")}}}),t=$,Xn=ue,Jn=Ut,Zn=e,$n=n.CONFIGURABLE,er=Un,tr=Yt.enforce,nr=Yt.get,rr=Object.defineProperty,ir=Zn&&!t(function(){return 8!==rr(function(){},"length",{value:8}).length}),sr=String(String).split("String"),Yn=Et.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Jn(e,"name")||$n&&e.name!==t)&&(Zn?rr(e,"name",{value:t,configurable:!0}):e.name=t),ir&&n&&Jn(n,"arity")&&e.length!==n.arity&&rr(e,"length",{value:n.arity});try{n&&Jn(n,"constructor")&&n.constructor?Zn&&rr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}n=tr(e);return Jn(n,"source")||(n.source=sr.join("string"==typeof t?t:"")),e},ar=(Function.prototype.toString=Yn(function(){return Xn(this)&&nr(this).source||er(this)},"toString"),ue),or=zt,ur=Et.exports,cr=pe,qn={},lr=Math.ceil,hr=Math.floor,dr=Math.trunc||function(e){e=+e;return(0<e?hr:lr)(e)},fr=Te,pr=Math.max,vr=Math.min,_r=Te,yr=Math.min,mr=Ce,gr=oe,Er=Se,br=ke,r={includes:Ne(!0),indexOf:Ne(!1)},Kn=Ze,Ir=Ut,wr=oe,Tr=r.indexOf,Sr=jn,Cr=Kn([].push),t=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],kr=Ae,Nr=t.concat("length","prototype"),Yn=(qn.f=Object.getOwnPropertyNames||function(e){return kr(e,Nr)},{}),Et=(Yn.f=Object.getOwnPropertySymbols,le),Ar=qn,Or=Yn,Rr=be,Dr=Ze([].concat),Kn=Et("Reflect","ownKeys")||function(e){var t=Ar.f(Rr(e)),n=Or.f;return n?Dr(t,n(e)):t},Mr=Ut,xr=Kn,Lr=G,Pr=zt,Ur=$,qr=ue,Fr=/#|\.prototype\./,jr=Oe.normalize=function(e){return String(e).replace(Fr,".").toLowerCase()},Hr=Oe.data={},Gr=Oe.NATIVE="N",Vr=Oe.POLYFILL="P",Et=Oe,Br=V,Qr=G.f,Kr=_t,zr=we,Wr=pe,Yr=function(e,t,n){for(var r=xr(t),i=Pr.f,s=Lr.f,a=0;a<r.length;a++){var o=r[a];Mr(e,o)||n&&Mr(n,o)||i(e,o,s(t,o))}},Xr=Et,Jr=de,Zr=We,$r=Ze(Ze.bind),ei=te,Kn=Array.isArray||function(e){return"Array"==ei(e)},i={},i=(i[ye("toStringTag")]="z","[object z]"===String(i)),ti=i,ni=ue,ri=te,ii=ye("toStringTag"),si=Object,ai="Arguments"==ri(function(){return arguments}()),ti=ti?ri:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(t=function(e,t){try{return e[t]}catch(e){}}(e=si(e),ii))?t:ai?ri(e):"Object"==(t=ri(e))&&ni(e.callee)?"Arguments":t},oi=Ze,ui=$,ci=ue,li=ti,hi=Un,di=[],fi=le("Reflect","construct"),pi=/^\s*(?:class|function)\b/,vi=oi(pi.exec),_i=!pi.exec(Me),oi=(Le.sham=!0,!fi||ui(function(){var e;return xe(xe.call)||!xe(Object)||!xe(function(){e=!0})||e})?Le:xe),yi=Kn,mi=oi,gi=ce,Ei=ye("species"),bi=Array,Ii=function(e){var t;return yi(e)&&(t=e.constructor,(mi(t)&&(t===bi||yi(t.prototype))||gi(t)&&null===(t=t[Ei]))&&(t=void 0)),void 0===t?bi:t},wi=De,Ti=tt,Si=ve,Ci=ke,ki=Pe,Ni=Ze([].push),ui={forEach:Ue(0),map:Ue(1),filter:Ue(2),some:Ue(3),every:Ue(4),find:Ue(5),findIndex:Ue(6),filterReject:Ue(7)},Ai=$,Oi=yt,Ri=ye("species"),s=Re,Di=ui.map,Mi=(s({target:"Array",proto:!0,forced:!qe("map")},{map:function(e){return Di(this,e,1<arguments.length?arguments[1]:void 0)}}),f(function e(){d(this,e)})),xi=function(){p(t,Mi);var e=_(t);function t(){return d(this,t),e.call(this)}return f(t,[{key:"getApiOption",value:function(){return{auth:this.getAuth(),path:this.getPath(),method:this.getMethod(),body:this.getData(),headers:this.getHeaders()}}},{key:"getAuth",value:function(){return!0}},{key:"getHeaders",value:function(){return{}}}]),t}(),Li=function(){p(t,xi);var e=_(t);function t(){return d(this,t),e.call(this)}return f(t,[{key:"getPath",value:function(){return"/v1".concat(this.getSubPath())}}]),t}(),Pi=((s=c=c||{}).CREATE="create",s.GET="get",s.DELETE="delete",s.QUERY="query",s.READY="ready",s.START="start",s.ENTER_HOST="enter_host",s.GET_HOSTS="get_hosts",s.EXIT_HOST="exit_host",s.HOST_ALIVE="host_alive",s.AUDIO="audio",s.VIDEO="video",s.HOST_CREATE_STREAM="host_create_stream",s.HOST_DELETE_STREAM="host_delete_stream",s.HOST_CONNECTED="host_connected",s.ENTER="enter",s.EXIT="exit",s.ALIVE="alive",s.GET_PARTICIPANTS="get_participants",s.CREATE_STREAM="create_stream",s.DELETE_STREAM="delete_stream",s.CONNECTED="connected",s.ATTACH="attach",s.LIVE_EVENT_READY="live_event_ready",s.LIVE_EVENT_STARTED="live_event_started",s.LIVE_EVENT_ENDED="live_event_ended",s.HOST_ENTERED="host_entered",s.HOST_EXITED="host_exited",s.HOST_DISCONNECTED="host_disconnected",s.HOST_AUDIO_STATUS_CHANGED="host_audio_status_changed",s.HOST_VIDEO_STATUS_CHANGED="host_video_status_changed",s.PARTICIPANT_ENTERED="participant_entered",s.PARTICIPANT_EXITED="participant_exited",(s=ze=ze||{}).SINGLE_HOST="single_host",s.MULTIPLE_HOST="multiple_host",function(){p(r,Mi);var n=_(r);function r(e){var t;return d(this,r),(t=n.call(this)).payload=t.parseData(e),t}return f(r)}()),Ui=function(){p(t,Pi);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t)}();function qi(e){return{liveEventId:e.live_event_id,createdAt:e.created_at,setReadyAt:e.set_ready_at,startedAt:e.started_at,endedAt:e.ended_at,state:e.state,isHostStreaming:e.is_host_streaming,createdBy:e.created_by,setReadyBy:e.set_ready_by,startedBy:e.started_by,endedBy:e.ended_by,duration:e.duration,host:e.host?Fi(e.host):void 0,participantCount:e.participantCount,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count,userIdsForHost:e.user_ids_for_host,customItems:e.custom_items}}function Fi(e){return{hostId:e.host_id,userId:e.user.user_id,nickname:e.user.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,connectedAt:e.connected_at,disconnectedAt:e.disconnected_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,isAudioOn:e.is_audio_on,isVideoOn:e.is_video_on,liveEventId:e.live_event_id}}function ji(e){return{id:e.rtcstream_id}}function Hi(e){return{participantId:e.participant_id,userId:e.user.user_id,nickname:e.user.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,liveEventId:e.live_event_id}}var s=Re,Gi=ui.filter;s({target:"Array",proto:!0,forced:!qe("filter")},{filter:function(e){return Gi(this,e,1<arguments.length?arguments[1]:void 0)}});function Vi(e){if(9007199254740991<e)throw Zi("Maximum allowed index exceeded");return e}function Bi(e,t,n){(t=$i(t))in e?es.f(e,t,ts(0,n)):e[t]=n}function Qi(e){if("Symbol"===ds(e))throw TypeError("Cannot convert a Symbol value to a string");return fs(e)}function Ki(){var e=ps(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}var zi=ti,Wi=(i||we(Object.prototype,"toString",i?{}.toString:function(){return"[object "+zi(this)+"]"},{unsafe:!0}),Ae),Yi=t,s=Object.keys||function(e){return Wi(e,Yi)},Xi=ve,Ji=s,Zi=(Re({target:"Object",stat:!0,forced:$(function(){Ji(1)})},{keys:function(e){return Ji(Xi(e))}}),TypeError),$i=ge,es=zt,ts=ee,i=Re,a=$,ns=Kn,rs=ce,is=ve,ss=ke,as=Vi,os=Bi,us=Pe,cs=qe,ls=yt,hs=ye("isConcatSpreadable"),ls=51<=ls||!a(function(){var e=[];return e[hs]=!1,e.concat()[0]!==e}),a=cs("concat"),ds=(i({target:"Array",proto:!0,arity:1,forced:!ls||!a},{concat:function(e){for(var t,n,r,i=is(this),s=us(i,0),a=0,o=-1,u=arguments.length;o<u;o++)if(function(e){if(!rs(e))return!1;var t=e[hs];return void 0!==t?!!t:ns(e)}(r=-1===o?i:arguments[o]))for(n=ss(r),as(a+n),t=0;t<n;t++,a++)t in r&&os(s,a,r[t]);else as(a+1),os(s,a++,r);return s.length=a,s}}),ti),fs=String,ps=be,vs=Xe,_s=Ut,ys=et,ms=Ki,gs=RegExp.prototype,cs=n.PROPER,i=we,Es=be,bs=Qi,ls=$,Is=function(e){var t=e.flags;return void 0!==t||"flags"in gs||_s(e,"flags")||!ys(gs,e)?t:vs(ms,e)},a="toString",ws=RegExp.prototype[a],ls=ls(function(){return"/a/b"!=ws.call({source:"a",flags:"b"})}),cs=cs&&ws.name!=a;function Ts(t){return Object.keys(t).filter(function(e){return null!=t[e]}).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(function(e){if(Array.isArray(e))return e.map(function(e){return encodeURIComponent(e.toString())}).join(",");return encodeURIComponent(e.toString())}(t[e]))}).join("&")}(ls||cs)&&i(RegExp.prototype,a,function(){var e=Es(this);return"/"+bs(e.source)+"/"+bs(Is(e))},{unsafe:!0});var Ss=function(){p(s,Li);var i=_(s);function s(e,t,n){var r;return d(this,s),u(v(r=i.call(this)),"type",c.QUERY),r.params=r._normalizeParams(e),r.prevToken=t,r.nextToken=n,r}return f(s,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"/live-events?".concat(this._createQuery())}},{key:"getMethod",value:function(){return"GET"}},{key:"_normalizeParams",value:function(e){var t=e.hostType,n=e.liveEventState,r=e.createdAtRange,i=e.participantCountRange,s=e.durationRange,a=e.liveEventIds,o=e.createdByUserIds,e=e.limit;return{hostType:t,liveEventState:n,createdAtRange:r,participantCountRange:i,durationRange:s,liveEventIds:a,createdByUserIds:o,limit:null!=e?Math.min(Math.max(1,e),100):void 0}}},{key:"_createQuery",value:function(){var e;return Ts({hostType:this.params.hostType,liveEventState:this.params.liveEventState,created_at_start_date:null==(e=this.params.createdAtRange)?void 0:e[0],created_at_end_date:null==(e=this.params.createdAtRange)?void 0:e[0],participant_count_gte:null==(e=this.params.participantCountRange)?void 0:e[0],participant_count_lte:null==(e=this.params.participantCountRange)?void 0:e[1],duration_range_gte:null==(e=this.params.durationRange)?void 0:e[0],duration_range_lte:null==(e=this.params.durationRange)?void 0:e[1],liveEventIds:this.params.liveEventIds,createdByUserIds:this.params.createdByUserIds,limit:this.params.limit,prev:this.prevToken,next:this.nextToken})}}]),s}(),Cs=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){var t;return{liveEvents:null==(t=e.live_events)?void 0:t.map(qi),prev:e.prev,next:e.next}}}]),t}(),ks=function(){function n(e,t){d(this,n),this.isLoading=!1,this.params=e,this.sender=t,this.prevToken=null,this.nextToken=null}var r,e,t;return f(n,[{key:"hasPrev",get:function(){return!!this.prevToken}},{key:"hasNext",get:function(){return!this.prevToken&&!this.nextToken||!!this.nextToken}},{key:"next",value:(t=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading)throw new Error("query is in progress");e.next=2;break;case 2:if(this.hasNext){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(null,this.nextToken));case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"prev",value:(e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading)throw new Error("query is in progress");e.next=2;break;case 2:if(this.hasPrev){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(this.prevToken,null));case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_sendQueryCommand",value:(r=h(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n)throw new Error("internal error while creating LiveEventListQueryCommand");e.next=2;break;case 2:return r=new Ss(this.params,t,n),e.next=5,this.sender.send(r);case 5:return r=e.sent,i=r.payload,this.isLoading=!0,this.prevToken=i.prev,this.nextToken=i.next,this.isLoading=!1,e.abrupt("return",i.liveEvents);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})}]),n}(),ls={},Ns=zt,As=be,Os=oe,Rs=s;ls.f=e&&!Vt?Object.defineProperties:function(e,t){As(e);for(var n,r=Os(t),i=Rs(t),s=i.length,a=0;a<s;)Ns.f(e,n=i[a++],r[n]);return e};function Ds(){}function Ms(e){e.write(Qs("")),e.close();var t=e.parentWindow.Object;return e=null,t}function xs(e){Ws[zs][e]=!0}var Ls,Ps,cs=le("document","documentElement"),Us=be,qs=ls,Fs=t,i=jn,js=cs,Hs=Ee,Gs="prototype",Vs="script",Bs=Ie("IE_PROTO"),Qs=function(e){return"<"+Vs+">"+e+"</"+Vs+">"},Ks=function(){try{Ls=new ActiveXObject("htmlfile")}catch(e){}Ks="undefined"==typeof document||document.domain&&Ls?Ms(Ls):(e=Hs("iframe"),t="java"+Vs+":",e.style.display="none",js.appendChild(e),e.src=String(t),(t=e.contentWindow.document).open(),t.write(Qs("document.F=Object")),t.close(),t.F);for(var e,t,n=Fs.length;n--;)delete Ks[Gs][Fs[n]];return Ks()},a=(i[Bs]=!0,Object.create||function(e,t){var n;return null!==e?(Ds[Gs]=Us(e),n=new Ds,Ds[Gs]=null,n[Bs]=e):n=Ks(),void 0===t?n:qs.f(n,t)}),Vt=ye,ls=a,t=zt.f,zs=Vt("unscopables"),Ws=Array.prototype,i=(null==Ws[zs]&&t(Ws,zs,{configurable:!0,value:ls(null)}),Re),Ys=ui.findIndex,Vt=xs,t="findIndex",Xs=!0,ls=(t in[]&&Array(1)[t](function(){Xs=!1}),i({target:"Array",proto:!0,forced:Xs},{findIndex:function(e){return Ys(this,e,1<arguments.length?arguments[1]:void 0)}}),Vt(t),{}),i=!$(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Js=Ut,Zs=ue,$s=ve,Vt=i,ea=Ie("IE_PROTO"),ta=Object,na=ta.prototype,t=Vt?ta.getPrototypeOf:function(e){e=$s(e);if(Js(e,ea))return e[ea];var t=e.constructor;return Zs(t)&&e instanceof t?t.prototype:e instanceof ta?na:null},i=$,Vt=ue,ra=t,ia=we,sa=ye("iterator"),aa=!1;[].keys&&("next"in(ha=[].keys())?(ra=ra(ra(ha)))!==Object.prototype&&(Ps=ra):aa=!0);function oa(e,t,n){(e=e&&!n?e.prototype:e)&&!fa(e,pa)&&da(e,pa,{configurable:!0,value:t})}function ua(){return this}function ca(){return this}function la(e,t,n,r,i,s,a){function o(e){if(e===i&&f)return f;if(!Fa&&e in h)return h[e];switch(e){case"keys":case Ha:case Ga:return function(){return new n(this,e)}}return function(){return new n(this)}}Aa(n,t,r);var u,c,r=t+" Iterator",l=!1,h=e.prototype,d=h[ja]||h["@@iterator"]||i&&h[i],f=!Fa&&d||o(i),p="Array"==t&&h.entries||d;if(p&&(p=Oa(p.call(new e)))!==Object.prototype&&p.next&&(Oa(p)!==qa&&(Ra?Ra(p,qa):Na(p[ja])||xa(p,ja,ca)),Da(p,r,!0)),Pa&&i==Ha&&d&&d.name!==Ha&&(Ua?Ma(h,"name",Ha):(l=!0,f=function(){return ka(d,this)})),i)if(u={values:o(Ha),keys:s?f:o("keys"),entries:o(Ga)},a)for(c in u)!Fa&&!l&&c in h||xa(h,c,u[c]);else Ca({target:t,proto:!0,forced:Fa||l},u);return h[ja]!==f&&xa(h,ja,f,{name:i}),La[t]=f,u}Vt((Ps=null==Ps||i(function(){var e={};return Ps[sa].call(e)!==e})?{}:Ps)[sa])||ia(Ps,sa,function(){return this});var ha={IteratorPrototype:Ps,BUGGY_SAFARI_ITERATORS:aa},da=zt.f,fa=Ut,pa=ye("toStringTag"),va=ha.IteratorPrototype,_a=a,ya=ee,ma=oa,ga=ls,Ea=ue,ba=String,Ia=TypeError,wa=Ze,Ta=be,Sa=function(e){if("object"==typeof e||Ea(e))return e;throw Ia("Can't set "+ba(e)+" as a prototype")},ra=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=wa(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return Ta(e),Sa(t),r?n(e,t):e.__proto__=t,e}}():void 0),Ca=Re,ka=Xe,Na=ue,Aa=function(e,t,n,r){t+=" Iterator";return e.prototype=_a(va,{next:ya(+!r,n)}),ma(e,t,!1),ga[t]=ua,e},Oa=t,Ra=ra,Da=oa,Ma=_t,xa=we,Vt=ye,La=ls,Pa=n.PROPER,Ua=n.CONFIGURABLE,qa=ha.IteratorPrototype,Fa=ha.BUGGY_SAFARI_ITERATORS,ja=Vt("iterator"),Ha="values",Ga="entries",Va=oe,i=xs,ia=ls,aa=Yt,t=zt.f,n=la,ha=e,Ba="Array Iterator",Qa=aa.set,Ka=aa.getterFor(Ba),Vt=n(Array,"Array",function(e,t){Qa(this,{type:Ba,target:Va(e),index:0,kind:t})},function(){var e=Ka(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),aa=ia.Arguments=ia.Array;if(i("keys"),i("values"),i("entries"),ha&&"values"!==aa.name)try{t(aa,"name",{value:"values"})}catch(e){}var n={exports:{}},ia={},za=Se,Wa=ke,Ya=Bi,Xa=Array,Ja=Math.max,Za=te,$a=oe,eo=qn.f,to=function(e,t,n){for(var r=Wa(e),i=za(t,r),s=za(void 0===n?r:n,r),a=Xa(Ja(s-i,0)),o=0;i<s;i++,o++)Ya(a,o,e[i]);return a.length=o,a},no="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];ia.f=function(e){if(!no||"Window"!=Za(e))return eo($a(e));try{return eo(e)}catch(e){return to(no)}};function ro(e){fo(e,go,{value:{objectID:"O"+Eo++,weakData:{}}})}var i=$(function(){var e;"function"==typeof ArrayBuffer&&(e=new ArrayBuffer(8),Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8}))}),ha=$,io=ce,so=te,ao=i,oo=Object.isExtensible,t=ha(function(){oo(1)})||ao?function(e){return!!io(e)&&((!ao||"ArrayBuffer"!=so(e))&&(!oo||oo(e)))}:oo,aa=!$(function(){return Object.isExtensible(Object.preventExtensions({}))}),uo=Re,co=Ze,i=jn,lo=ce,ho=Ut,fo=zt.f,po=qn,vo=ia,_o=t,yo=aa,mo=!1,go=_e("meta"),Eo=0,bo=n.exports={enable:function(){bo.enable=function(){},mo=!0;var i=po.f,s=co([].splice),e={};e[go]=1,i(e).length&&(po.f=function(e){for(var t=i(e),n=0,r=t.length;n<r;n++)if(t[n]===go){s(t,n,1);break}return t},uo({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:vo.f}))},fastKey:function(e,t){if(!lo(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!ho(e,go)){if(!_o(e))return"F";if(!t)return"E";ro(e)}return e[go].objectID},getWeakData:function(e,t){if(!ho(e,go)){if(!_o(e))return!0;if(!t)return!1;ro(e)}return e[go].weakData},onFreeze:function(e){return yo&&mo&&_o(e)&&!ho(e,go)&&ro(e),e}};i[go]=!0;function Io(e){if(null!=e)return Oo(e,Do)||Oo(e,"@@iterator")||Ro[Ao(e)]}function wo(e,t){this.stopped=e,this.result=t}function To(e,t,n){function r(e){return s&&Jo(s,"normal",e),new wo(!0,e)}function i(e){return d?(Bo(e),v?_(e[0],e[1],r):_(e[0],e[1])):v?_(e,r):_(e)}var s,a,o,u,c,l,h=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),v=!(!n||!n.INTERRUPTED),_=Go(t,h);if(f)s=e.iterator;else if(p)s=e;else{if(!(n=Xo(e)))throw Zo(Qo(e)+" is not iterable");if(Ko(n)){for(a=0,o=zo(e);a<o;a++)if((u=i(e[a]))&&Wo($o,u))return u;return new wo(!1)}s=Yo(e,n)}for(c=(f?e:s).next;!(l=Vo(c,s)).done;){try{u=i(l.value)}catch(e){Jo(s,"throw",e)}if("object"==typeof u&&u&&Wo($o,u))return u}return new wo(!1)}function So(e,t){if(eu(t,e))return e;throw tu("Incorrect invocation")}var Co=ls,ko=ye("iterator"),No=Array.prototype,Ao=ti,Oo=fe,Ro=ls,Do=ye("iterator"),Mo=Xe,xo=de,Lo=be,Po=he,Uo=Io,qo=TypeError,Fo=Xe,jo=be,Ho=fe,Go=De,Vo=Xe,Bo=be,Qo=he,Ko=function(e){return void 0!==e&&(Co.Array===e||No[ko]===e)},zo=ke,Wo=et,Yo=function(e,t){t=arguments.length<2?Uo(e):t;if(xo(t))return Lo(Mo(t,e));throw qo(Po(e)+" is not iterable")},Xo=Io,Jo=function(e,t,n){var r,i;jo(e);try{if(!(r=Ho(e,"return"))){if("throw"===t)throw n;return n}r=Fo(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return jo(r),n},Zo=TypeError,$o=wo.prototype,eu=et,tu=TypeError,nu=ye("iterator"),ru=!1;try{var iu=0,su={next:function(){return{done:!!iu++}},return:function(){ru=!0}};su[nu]=function(){return this},Array.from(su,function(){throw 2})}catch(e){}function au(e,t){if(!t&&!ru)return!1;var n=!1;try{var r={};r[nu]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}function ou(e,t,n){return pu&&du(t=t.constructor)&&t!==n&&fu(t=t.prototype)&&t!==n.prototype&&pu(e,t),e}function uu(e){var e=Ou(e),t=Ru.f;Du&&e&&!e[Mu]&&t(e,Mu,{configurable:!0,get:function(){return this}})}function cu(i){return function(e,t){var n,e=zu(Wu(e)),t=Ku(t),r=e.length;return t<0||r<=t?i?"":void 0:(n=Xu(e,t))<55296||56319<n||t+1===r||(r=Xu(e,t+1))<56320||57343<r?i?Yu(e,t):n:i?Ju(e,t,t+2):r-56320+(n-55296<<10)+65536}}function lu(t,e){if(t){if(t[oc]!==cc)try{ac(t,oc,cc)}catch(e){t[oc]=cc}if(t[uc]||ac(t,uc,e),ic[e])for(var n in sc)if(t[n]!==sc[n])try{ac(t,n,sc[n])}catch(e){t[n]=sc[n]}}}var hu,du=ue,fu=ce,pu=ra,vu=Re,_u=V,yu=Ze,mu=Et,gu=we,Eu=n.exports,bu=To,Iu=So,wu=ue,Tu=ce,Su=$,Cu=au,ku=oa,Nu=ou,Au=we,Ou=le,Ru=zt,Du=e,Mu=ye("species"),xu=zt.f,Lu=a,Pu=function(e,t,n){for(var r in t)Au(e,r,t[r],n);return e},Uu=De,qu=So,Fu=To,ju=la,Hu=uu,Gu=e,Vu=n.exports.fastKey,Bu=Yt.set,Qu=Yt.getterFor,ha=(function(e,t,n){function r(e){var n=yu(f[e]);gu(f,e,"add"==e?function(e){return n(this,0===e?0:e),this}:"delete"==e?function(e){return!(l&&!Tu(e))&&n(this,0===e?0:e)}:"get"==e?function(e){return l&&!Tu(e)?void 0:n(this,0===e?0:e)}:"has"==e?function(e){return!(l&&!Tu(e))&&n(this,0===e?0:e)}:function(e,t){return n(this,0===e?0:e,t),this})}var i,s,a,o,u,c=-1!==e.indexOf("Map"),l=-1!==e.indexOf("Weak"),h=c?"set":"add",d=_u[e],f=d&&d.prototype,p=d,v={};return mu(e,!wu(d)||!(l||f.forEach&&!Su(function(){(new d).entries().next()})))?(p=n.getConstructor(t,e,c,h),Eu.enable()):mu(e,!0)&&(s=(i=new p)[h](l?{}:-0,1)!=i,a=Su(function(){i.has(1)}),o=Cu(function(e){new d(e)}),u=!l&&Su(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),o||(((p=t(function(e,t){Iu(e,f);e=Nu(new d,e,p);return null!=t&&bu(t,e[h],{that:e,AS_ENTRIES:c}),e})).prototype=f).constructor=p),(a||u)&&(r("delete"),r("has"),c&&r("get")),(u||s)&&r(h),l&&f.clear&&delete f.clear),v[e]=p,vu({global:!0,constructor:!0,forced:p!=d},v),ku(p,e),l||n.setStrong(p,e,c),p}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,n,r,i){function s(e,t,n){var r,i=u(e),s=a(e,t);return s?s.value=n:(i.last=s={index:r=Vu(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=s),t&&(t.next=s),Gu?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e}function a(e,t){var n,e=u(e),r=Vu(t);if("F"!==r)return e.index[r];for(n=e.first;n;n=n.next)if(n.key==t)return n}var e=e(function(e,t){qu(e,o),Bu(e,{type:n,index:Lu(null),first:void 0,last:void 0,size:0}),Gu||(e.size=0),null!=t&&Fu(t,e[i],{that:e,AS_ENTRIES:r})}),o=e.prototype,u=Qu(n);return Pu(o,{clear:function(){for(var e=u(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Gu?e.size=0:this.size=0},delete:function(e){var t,n,r=u(this),e=a(this,e);return e&&(t=e.next,n=e.previous,delete r.index[e.index],e.removed=!0,n&&(n.next=t),t&&(t.previous=n),r.first==e&&(r.first=t),r.last==e&&(r.last=n),Gu?r.size--:this.size--),!!e},forEach:function(e){for(var t,n=u(this),r=Uu(e,1<arguments.length?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),Pu(o,r?{get:function(e){e=a(this,e);return e&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Gu&&xu(o,"size",{get:function(){return u(this).size}}),e},setStrong:function(e,t,n){var r=t+" Iterator",i=Qu(t),s=Qu(r);ju(e,t,function(e,t){Bu(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),Hu(t)}}),Ze),Ku=Te,zu=Qi,Wu=ne,Yu=ha("".charAt),Xu=ha("".charCodeAt),Ju=ha("".slice),jn={codeAt:cu(!1),charAt:cu(!0)},Zu=jn.charAt,$u=Qi,ia=Yt,t=la,ec="String Iterator",tc=ia.set,nc=ia.getterFor(ec),aa=(t(String,"String",function(e){tc(this,{type:ec,string:$u(e),index:0})},function(){var e=nc(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=Zu(t,n),e.index+=t.length,{value:t,done:!1})}),{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),i=Ee("span").classList,ti=i&&i.constructor&&i.constructor.prototype,ls=ti===Object.prototype?void 0:ti,rc=V,ic=aa,su=ls,sc=Vt,ac=_t,n=ye,oc=n("iterator"),uc=n("toStringTag"),cc=sc.values;for(hu in ic)lu(rc[hu]&&rc[hu].prototype,hu);lu(su,"DOMTokenList");function lc(e,t){var n=[][e];return!!n&&Ll(function(){n.call(null,t||function(){return 1},1)})}function hc(t){if(t&&t.forEach!==Fl)try{jl(t,"forEach",Fl)}catch(e){t.forEach=Fl}}var dc,fc,pc=e,ha=Ze,vc=Xe,ia=$,_c=s,yc=Yn,mc=Je,gc=ve,Ec=tt,bc=Object.assign,Ic=Object.defineProperty,wc=ha([].concat),t=!bc||ia(function(){if(pc&&1!==bc({b:1},bc(Ic({},"a",{enumerable:!0,get:function(){Ic(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=bc({},e)[n]||_c(bc({},t)).join("")!=r})?function(e,t){for(var n=gc(e),r=arguments.length,i=1,s=yc.f,a=mc.f;i<r;)for(var o,u=Ec(arguments[i++]),c=s?wc(_c(u),s(u)):_c(u),l=c.length,h=0;h<l;)o=c[h++],pc&&!vc(a,u,o)||(n[o]=u[o]);return n}:bc,i=(Re({target:"Object",stat:!0,arity:2,forced:Object.assign!==t},{assign:t}),Re),Tc=r.includes,ti=xs,Sc=(i({target:"Array",proto:!0,forced:$(function(){return!Array(1).includes()})},{includes:function(e){return Tc(this,e,1<arguments.length?arguments[1]:void 0)}}),ti("includes"),ce),Cc=te,kc=ye("match"),Nc=function(e){var t;return Sc(e)&&(void 0!==(t=e[kc])?!!t:"RegExp"==Cc(e))},Ac=TypeError,Oc=ye("match"),Vt=Re,Rc=function(e){if(Nc(e))throw Ac("The method doesn't accept regular expressions");return e},Dc=ne,Mc=Qi,n=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[Oc]=!1,"/./"[t](n)}catch(e){}}return!1},xc=Ze("".indexOf),Lc=(Vt({target:"String",proto:!0,forced:!n("includes")},{includes:function(e){return!!~xc(Mc(Dc(this)),Mc(Rc(e)),1<arguments.length?arguments[1]:void 0)}}),D.LiveEventRole=void 0,(su=D.LiveEventRole||(D.LiveEventRole={})).HOST="host",su.PARTICIPANT="participant",D.LiveEventState=void 0,(s=D.LiveEventState||(D.LiveEventState={})).CREATED="created",s.READY="ready",s.ONGOING="ongoing",s.PAUSED="paused",s.ENDED="ended",D.HostState=void 0,(Yn=D.HostState||(D.HostState={})).ENTERED="entered",Yn.CONNECTED="connected",Yn.DISCONNECTED="disconnected",Yn.EXITED="exited",D.ParticipantState=void 0,(Je=D.ParticipantState||(D.ParticipantState={})).ENTERED="entered",Je.EXITED="exited",function(){p(s,xi);var i=_(s);function s(e,t,n){var r;return d(this,s),(r=i.call(this)).appId=e,r.userId=t,r.accessToken=n,r}return f(s,[{key:"getAuth",value:function(){return!1}},{key:"getData",value:function(){return{app_id:this.appId,user_id:this.userId,access_token:this.accessToken}}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/login")}},{key:"getMethod",value:function(){return"POST"}}]),s}()),Pc=((ha=dc=dc||{}).POST="POST",ha.GET="GET",ha.DELETE="DELETE",ha.OPTION="OPTION",function(){p(i,Li);var r=_(i);function i(e,t){var n;return d(this,i),u(v(n=r.call(this)),"type",c.CREATE),n.hostType=e,n.hostIds=Array.isArray(t)?t:[t],n}return f(i,[{key:"getData",value:function(){return{host_type:this.hostType,user_ids_for_host:this.hostIds}}},{key:"getSubPath",value:function(){return"/live-events"}},{key:"getMethod",value:function(){return dc.POST}}]),i}()),Uc=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEvent:qi(e.live_event)}}}]),t}(),qc=function(){p(r,Li);var n=_(r);function r(e){var t;return d(this,r),u(v(t=n.call(this)),"type",c.GET),t.liveEventId=e,t}return f(r,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return dc.GET}}]),r}(),Fc=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEvent:qi(e.live_event)}}}]),t}(),jc=function(){p(i,Li);var r=_(i);function i(e,t){var n;return d(this,i),u(v(n=r.call(this)),"type",c.ENTER_HOST),u(v(n),"mediaOption",{turnAudioOn:!0,turnVideoOn:!0}),n.liveEventId=e,n.mediaOption=t,n}return f(i,[{key:"getData",value:function(){return{is_audio_on:this.mediaOption.turnAudioOn,is_video_on:this.mediaOption.turnVideoOn}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts")}},{key:"getMethod",value:function(){return dc.POST}}]),i}(),Hc=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{host:Fi(e.host)}}}]),t}(),Gc=function(){p(r,Li);var n=_(r);function r(e){var t;return d(this,r),u(v(t=n.call(this)),"type",c.READY),t.liveEventId=e,t}return f(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/ready")}},{key:"getMethod",value:function(){return dc.POST}}]),r}(),Vc=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEvent:qi(e.live_event)}}}]),t}(),Bc=function(){p(r,Li);var n=_(r);function r(e){var t;return d(this,r),u(v(t=n.call(this)),"type",c.START),t.liveEventId=e,t}return f(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/start")}},{key:"getMethod",value:function(){return dc.POST}}]),r}(),Qc=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEvent:qi(e.live_event)}}}]),t}(),Kc=function(){p(i,Li);var r=_(i);function i(e,t){var n;return d(this,i),u(v(n=r.call(this)),"type",c.EXIT_HOST),n.liveEventId=e,n.hostId=t,n}return f(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId)}},{key:"getMethod",value:function(){return dc.DELETE}}]),i}(),zc=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{host:Fi(e.host)}}}]),t}(),Wc=function(){p(r,Li);var n=_(r);function r(e){var t;return d(this,r),u(v(t=n.call(this)),"type",c.DELETE),t.liveEventId=e,t}return f(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return dc.DELETE}}]),r}(),Yc=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEvent:qi(e.live_event)}}}]),t}(),Xc=function(){p(r,Li);var n=_(r);function r(e){var t;return d(this,r),u(v(t=n.call(this)),"type",c.ENTER),t.liveEventId=e,t}return f(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants")}},{key:"getMethod",value:function(){return dc.POST}}]),r}(),Jc=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{participant:Hi(e.participant)}}}]),t}(),Zc=function(){p(i,Li);var r=_(i);function i(e,t){var n;return d(this,i),u(v(n=r.call(this)),"type",c.EXIT),n.liveEventId=e,n.participantId=t,n}return f(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId)}},{key:"getMethod",value:function(){return dc.DELETE}}]),i}(),$c=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{participant:Hi(e.participant)}}}]),t}(),el=function(){p(s,Li);var i=_(s);function s(e,t,n){var r;return d(this,s),u(v(r=i.call(this)),"type",c.CONNECTED),r.liveEventId=e,r.participantId=t,r.endpointId=n,r}return f(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId,"/connected")}},{key:"getMethod",value:function(){return dc.POST}}]),s}(),tl=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{endpoint:ji(e.rtcstream)}}}]),t}(),nl=function(){p(s,Li);var i=_(s);function s(e,t,n){var r;return d(this,s),u(v(r=i.call(this)),"type",c.HOST_CONNECTED),r.liveEventId=e,r.hostId=t,r.endpointId=n,r}return f(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams/").concat(this.endpointId,"/connected")}},{key:"getMethod",value:function(){return dc.POST}}]),s}(),rl=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{endpoint:ji(e.rtcstream)}}}]),t}(),il=function(){p(s,Li);var i=_(s);function s(e,t,n){var r;return d(this,s),u(v(r=i.call(this)),"type",c.DELETE_STREAM),r.liveEventId=e,r.participantId=t,r.endpointId=n,r}return f(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId)}},{key:"getMethod",value:function(){return dc.DELETE}}]),s}(),sl=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{}}}]),t}(),al=function(){p(s,Li);var i=_(s);function s(e,t,n){var r;return d(this,s),u(v(r=i.call(this)),"type",c.HOST_DELETE_STREAM),r.liveEventId=e,r.hostId=t,r.endpointId=n,r}return f(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams/").concat(this.endpointId)}},{key:"getMethod",value:function(){return dc.DELETE}}]),s}(),ol=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{}}}]),t}(),ul=function(){p(a,Li);var s=_(a);function a(e,t,n,r){var i;return d(this,a),u(v(i=s.call(this)),"type",c.ATTACH),i.liveEventId=e,i.participantId=t,i.endpointId=n,i.attachTo=r,i}return f(a,[{key:"getData",value:function(){return{attach_to:this.attachTo}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId,"/attach")}},{key:"getMethod",value:function(){return dc.POST}}]),a}(),cl=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{endpoint:ji(e.rtcstream)}}}]),t}(),ll=function(){p(r,Mi);var n=_(r);function r(e){var t;return d(this,r),(t=n.call(this)).type=e.type,t.version=e.version,t.messageId=e.message_id,t.payload=t.parseData(e.payload),t}return f(r)}(),hl=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:qi(e.live_event)}}}]),t}(),dl=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:qi(e.live_event)}}}]),t}(),fl=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:qi(e.live_event)}}}]),t}(),pl=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fi(e.host)}}}]),t}(),vl=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fi(e.host)}}}]),t}(),_l=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fi(e.host)}}}]),t}(),yl=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fi(e.host)}}}]),t}(),ml=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fi(e.host)}}}]),t}(),gl=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,participant:Hi(e.participant),participantCount:e.particpant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}]),t}(),El=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,participant:Hi(e.participant),participantCount:e.particpant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}]),t}(),bl=function(){p(o,Li);var a=_(o);function o(e,t,n,r,i){var s;return d(this,o),u(v(s=a.call(this)),"type",c.CREATE_STREAM),s.liveEventId=e,s.participantId=t,s.sdp=n,s.audioAttr=r,s.videoAttr=i,s}return f(o,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams")}},{key:"getMethod",value:function(){return dc.POST}}]),o}(),Il=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{sdp:e.sdp,endpoint:ji(e.rtcstream)}}}]),t}(),wl=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{hosts:e.hosts.map(Fi)}}}]),t}(),Tl=function(){p(i,Li);var r=_(i);function i(e,t){var n;return d(this,i),u(v(n=r.call(this)),"type",c.HOST_ALIVE),n.liveEventId=e,n.hostId=t,n}return f(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/alive")}},{key:"getMethod",value:function(){return dc.POST}}]),i}(),Sl=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Cl=function(){p(o,Li);var a=_(o);function o(e,t,n,r,i){var s;return d(this,o),u(v(s=a.call(this)),"type",c.HOST_CREATE_STREAM),s.liveEventId=e,s.hostId=t,s.sdp=n,s.audioAttr=r,s.videoAttr=i,s}return f(o,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams")}},{key:"getMethod",value:function(){return dc.POST}}]),o}(),kl=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{sdp:e.sdp,endpoint:ji(e.rtcstream)}}}]),t}(),Nl=function(){p(i,Li);var r=_(i);function i(e,t){var n;return d(this,i),u(v(n=r.call(this)),"type",c.ALIVE),n.liveEventId=e,n.participantId=t,n}return f(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/alive")}},{key:"getMethod",value:function(){return dc.POST}}]),i}(),Al=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Ol=function(){p(t,Ui);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{participant:Hi(e.participant)}}}]),t}(),Rl=function(){p(s,Li);var i=_(s);function s(e,t,n){var r;return d(this,s),u(v(r=i.call(this)),"type",c.AUDIO),r.liveEventId=e,r.hostId=t,r.on=n,r}return f(s,[{key:"getData",value:function(){return{on:this.on}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/audio")}},{key:"getMethod",value:function(){return dc.POST}}]),s}(),Dl=function(){p(s,Li);var i=_(s);function s(e,t,n){var r;return d(this,s),u(v(r=i.call(this)),"type",c.VIDEO),r.liveEventId=e,r.hostId=t,r.on=n,r}return f(s,[{key:"getData",value:function(){return{on:this.on}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/video")}},{key:"getMethod",value:function(){return dc.POST}}]),s}(),Ml=function(){p(t,ll);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fi(e.host)}}}]),t}(),xl=function(){function e(){d(this,e)}return f(e,null,[{key:"createAuth",value:function(e,t,n){return new Lc(e,t,n)}},{key:"createLiveEvent",value:function(e,t){return new Pc(e,t)}},{key:"createGetLiveEvent",value:function(e){return new qc(e)}},{key:"createEnterHost",value:function(e,t){return new jc(e,t)}},{key:"createReady",value:function(e){return new Gc(e)}},{key:"createStart",value:function(e){return new Bc(e)}},{key:"createExitHost",value:function(e,t){return new Kc(e,t)}},{key:"createEndLiveEvent",value:function(e){return new Wc(e)}},{key:"createEnter",value:function(e){return new Xc(e)}},{key:"createExit",value:function(e,t){return new Zc(e,t)}},{key:"createConnected",value:function(e,t,n){return new el(e,t,n)}},{key:"createHostConnected",value:function(e,t,n){return new nl(e,t,n)}},{key:"createStream",value:function(e,t,n,r,i){return new bl(e,t,n,r,i)}},{key:"createHostCreateStream",value:function(e,t,n,r,i){return new Cl(e,t,n,r,i)}},{key:"createDeleteStream",value:function(e,t,n){return new il(e,t,n)}},{key:"createHostDeleteStream",value:function(e,t,n){return new al(e,t,n)}},{key:"createAttach",value:function(e,t,n,r){return new ul(e,t,n,r)}},{key:"createAudio",value:function(e,t,n){return new Rl(e,t,n)}},{key:"createVideo",value:function(e,t,n){return new Dl(e,t,n)}},{key:"createAlive",value:function(e,t){return new Nl(e,t)}},{key:"createHostAlive",value:function(e,t){return new Tl(e,t)}},{key:"parseResponse",value:function(e,t){try{switch(e.type){case c.CREATE:return new Uc(t);case c.GET:return new Fc(t);case c.DELETE:return new Yc(t);case c.QUERY:return new Cs(t);case c.READY:return new Vc(t);case c.START:return new Qc(t);case c.ENTER_HOST:return new Hc(t);case c.GET_HOSTS:return new wl(t);case c.EXIT_HOST:return new zc(t);case c.HOST_ALIVE:return new Sl(t);case c.AUDIO:return new yl(t);case c.VIDEO:return new ml(t);case c.HOST_CREATE_STREAM:return new kl(t);case c.HOST_DELETE_STREAM:return new ol(t);case c.HOST_CONNECTED:return new rl(t);case c.ENTER:return new Jc(t);case c.EXIT:return new $c(t);case c.ALIVE:return new Al(t);case c.GET_PARTICIPANTS:return new Ol(t);case c.CREATE_STREAM:return new Il(t);case c.DELETE_STREAM:return new sl(t);case c.CONNECTED:return new tl(t);case c.ATTACH:return new cl(t)}}catch(e){return}}},{key:"parse",value:function(e){if("live"===e.call_type)try{switch(e.type){case c.LIVE_EVENT_READY:return new hl(e);case c.LIVE_EVENT_STARTED:return new dl(e);case c.LIVE_EVENT_ENDED:return new fl(e);case c.HOST_ENTERED:return new pl(e);case c.HOST_EXITED:return new vl(e);case c.HOST_CONNECTED:return new _l(e);case c.HOST_DISCONNECTED:return new Ml(e);case c.HOST_AUDIO_STATUS_CHANGED:return new yl(e);case c.HOST_VIDEO_STATUS_CHANGED:return new ml(e);case c.PARTICIPANT_ENTERED:return new gl(e);case c.PARTICIPANT_EXITED:return new El(e)}}catch(e){return}}}]),e}(),Ll=$,Pl=ui.forEach,Ul=V,ql=aa,ia=ls,Fl=lc("forEach")?[].forEach:function(e){return Pl(this,e,1<arguments.length?arguments[1]:void 0)},jl=_t;for(fc in ql)ql[fc]&&hc(Ul[fc]&&Ul[fc].prototype);hc(ia);var Hl=he,Gl=TypeError,t=Re,Vl=ve,Bl=Se,Ql=Te,Kl=ke,zl=Vi,Wl=Pe,Yl=Bi,Xl=function(e,t){if(!delete e[t])throw Gl("Cannot delete property "+Hl(t)+" of "+Hl(e))},i=qe("splice"),Jl=Math.max,Zl=Math.min;t({target:"Array",proto:!0,forced:!i},{splice:function(e,t){var n,r,i,s,a,o,u=Vl(this),c=Kl(u),l=Bl(e,c),e=arguments.length;for(0===e?n=r=0:r=1===e?(n=0,c-l):(n=e-2,Zl(Jl(Ql(t),0),c-l)),zl(c+n-r),i=Wl(u,r),s=0;s<r;s++)(a=l+s)in u&&Yl(i,s,u[a]);if(n<(i.length=r)){for(s=l;s<c-r;s++)o=s+n,(a=s+r)in u?u[o]=u[a]:Xl(u,o);for(s=c;c-r+n<s;s--)Xl(u,s-1)}else if(r<n)for(s=c-r;l<s;s--)o=s+n-1,(a=s+r-1)in u?u[o]=u[a]:Xl(u,o);for(s=0;s<n;s++)u[s+l]=arguments[s+2];return u.length=c-r+n,i}});var $l,ti=Ze([].slice),Vt=Re,eh=Kn,th=oi,nh=ce,rh=Se,ih=ke,sh=oe,ah=Bi,n=ye,oh=ti,s=qe("slice"),uh=n("species"),ch=Array,lh=Math.max,hh=(Vt({target:"Array",proto:!0,forced:!s},{slice:function(e,t){var n,r,i,s=sh(this),a=ih(s),o=rh(e,a),u=rh(void 0===t?a:t,a);if(eh(s)&&(n=s.constructor,(n=th(n)&&(n===ch||eh(n.prototype))||nh(n)&&null===(n=n[uh])?void 0:n)===ch||void 0===n))return oh(s,o,u);for(r=new(void 0===n?ch:n)(lh(u-o,0)),i=0;o<u;o++,i++)o in s&&ah(r,i,s[o]);return r.length=i,r}}),function(){function e(){d(this,e),u(this,"_listeners",{}),u(this,"on",this.addEventListener),u(this,"off",this.removeEventListener)}return f(e,[{key:"addEventListener",value:function(e,t){var n=this;return e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t),function(){return n.removeEventListener(e,t)}}},{key:"once",value:function(t,n){var r=this;return this.on(t,function e(){n.apply(void 0,arguments),r.removeEventListener(t,e)})}},{key:"removeEventListener",value:function(e,t){if(e in this._listeners)for(var n=this._listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"removeAllEventListeners",value:function(){this._listeners={}}},{key:"_dispatchEvent",value:function(e){if(e in this._listeners){for(var t=this._listeners[e].slice(),n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var s,a=0,o=t.length;a<o;a++)(s=t[a]).call.apply(s,[this].concat(r))}}}]),e}()),Yn=Re,Je=Ze,dh=r.indexOf,aa=lc,fh=Je([].indexOf),ph=!!fh&&1/fh([1],1,-0)<0,ls=aa("indexOf");Yn({target:"Array",proto:!0,forced:ph||!ls},{indexOf:function(e){var t=1<arguments.length?arguments[1]:void 0;return ph?fh(this,e,t)||0:dh(this,e,t)}}),(ia=$l=$l||{}).VERBOSE="VERBOSE",ia.DEBUG="DEBUG",ia.INFO="INFO",ia.WARNING="WARNING",ia.ERROR="ERROR",ia.NONE="NONE";function vh(n,e,t,r){var a,i=Gh(n),o=!Hh(function(){var e={};return e[i]=function(){return 7},7!=""[n](e)}),s=o&&!Hh(function(){var e=!1,t=/a/;return"split"===n&&((t={constructor:{}}).constructor[Bh]=function(){return t},t.flags="",t[i]=/./[i]),t.exec=function(){return e=!0,null},t[i](""),!e});o&&s&&!t||(a=qh(/./[i]),s=e(i,""[n],function(e,t,n,r,i){var e=qh(e),s=t.exec;return s===jh||s===Qh.exec?o&&!i?{done:!0,value:a(t,n,r)}:{done:!0,value:e(n,t,r)}:{done:!1}}),Fh(String.prototype,n,s[0]),Fh(Qh,i,s[1])),r&&Vh(Qh[i],"sham",!0)}function _h(e,t,n){return t+(n?Kh(e,t).length:1)}function yh(e,t){var n=e.exec;if(nd(n))return null!==(n=ed(n,e,t))&&td(n),n;if("RegExp"===rd(e))return ed(id,e,t);throw sd("RegExp#exec called on incompatible receiver")}var o=new(function(){function e(){d(this,e),this._listeners=[]}return f(e,[{key:"verbose",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[$l.VERBOSE].concat(t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[$l.DEBUG].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[$l.INFO].concat(t))}},{key:"warning",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[$l.WARNING].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[$l.ERROR].concat(t))}},{key:"_log",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,s=j(this._listeners);try{for(s.s();!(i=s.n()).done;){var a=i.value;a._permit.apply(a,[e].concat(n))}}catch(e){s.e(e)}finally{s.f()}}},{key:"addListener",value:function(e){this._listeners.push(e)}},{key:"removeListener",value:function(e){e=this._listeners.indexOf(e);-1!==e&&this._listeners.splice(e,1)}},{key:"removeAllListener",value:function(){this._listeners=[]}}]),e}()),t=$,mh=V.RegExp,i=t(function(){var e=mh("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),Kn=i||t(function(){return!mh("a","y").sticky}),n={BROKEN_CARET:i||t(function(){var e=mh("^r","gy");return e.lastIndex=2,null!=e.exec("str")}),MISSED_STICKY:Kn,UNSUPPORTED_Y:i},Vt=$,gh=V.RegExp,s=Vt(function(){var e=gh(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}),r=$,Eh=V.RegExp,Je=r(function(){var e=Eh("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}),bh=Xe,aa=Ze,Ih=Qi,wh=Ki,Yn=n,ls=mt.exports,Th=a,Sh=Yt.get,ia=s,t=Je,Ch=ls("native-string-replace",String.prototype.replace),kh=RegExp.prototype.exec,Nh=kh,Ah=aa("".charAt),Oh=aa("".indexOf),Rh=aa("".replace),Dh=aa("".slice),Mh=(Kn=/b*/g,bh(kh,i=/a/,"a"),bh(kh,Kn,"a"),0!==i.lastIndex||0!==Kn.lastIndex),xh=Yn.BROKEN_CARET,Lh=void 0!==/()??/.exec("")[1],Vt=Nh=Mh||Lh||xh||ia||t?function(e){var t,n,r,i,s,a,o=this,u=Sh(o),e=Ih(e),c=u.raw;if(c)return c.lastIndex=o.lastIndex,h=bh(Nh,c,e),o.lastIndex=c.lastIndex,h;var l=u.groups,c=xh&&o.sticky,h=bh(wh,o),u=o.source,d=0,f=e;if(c&&(h=Rh(h,"y",""),-1===Oh(h,"g")&&(h+="g"),f=Dh(e,o.lastIndex),0<o.lastIndex&&(!o.multiline||o.multiline&&"\n"!==Ah(e,o.lastIndex-1))&&(u="(?: "+u+")",f=" "+f,d++),t=new RegExp("^(?:"+u+")",h)),Lh&&(t=new RegExp("^"+u+"$(?!\\s)",h)),Mh&&(n=o.lastIndex),r=bh(kh,c?t:o,f),c?r?(r.input=Dh(r.input,d),r[0]=Dh(r[0],d),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:Mh&&r&&(o.lastIndex=o.global?r.index+r[0].length:n),Lh&&r&&1<r.length&&bh(Ch,r[0],t,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r&&l)for(r.groups=s=Th(null),i=0;i<l.length;i++)s[(a=l[i])[0]]=r[a[1]];return r}:Nh,r=(Re({target:"RegExp",proto:!0,forced:/./.exec!==Vt},{exec:Vt}),We),n=Function.prototype,Ph=n.apply,Uh=n.call,mt="object"==typeof Reflect&&Reflect.apply||(r?Uh.bind(Ph):function(){return Uh.apply(Ph,arguments)}),qh=Ze,Fh=we,jh=Vt,Hh=$,Gh=ye,Vh=_t,Bh=Gh("species"),Qh=RegExp.prototype,Kh=jn.charAt,a=Ze,zh=ve,Wh=Math.floor,Yh=a("".charAt),Xh=a("".replace),Jh=a("".slice),Zh=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,$h=/\$([$&'`]|\d{1,2})/g,ed=Xe,td=be,nd=ue,rd=te,id=Vt,sd=TypeError,ad=mt,od=Xe,s=Ze,Je=vh,ls=$,ud=be,cd=ue,ld=Te,hd=Ce,dd=Qi,fd=ne,pd=_h,vd=fe,_d=function(s,a,o,u,c,e){var l=o+s.length,h=u.length,t=$h;return void 0!==c&&(c=zh(c),t=Zh),Xh(e,t,function(e,t){var n;switch(Yh(t,0)){case"$":return"$";case"&":return s;case"`":return Jh(a,0,o);case"'":return Jh(a,l);case"<":n=c[Jh(t,1,-1)];break;default:var r,i=+t;if(0==i)return e;if(h<i)return 0!==(r=Wh(i/10))&&r<=h?void 0===u[r-1]?Yh(t,1):u[r-1]+Yh(t,1):e;n=u[i-1]}return void 0===n?"":n})},yd=yh,md=ye("replace"),gd=Math.max,Ed=Math.min,bd=s([].concat),Id=s([].push),wd=s("".indexOf),Td=s("".slice),aa="$0"==="a".replace(/./,"$0"),Sd=!!/./[md]&&""===/./[md]("a","$0");Je("replace",function(e,g,E){var b=Sd?"$":"$0";return[function(e,t){var n=fd(this),r=null==e?void 0:vd(e,md);return r?od(r,e,n,t):od(g,dd(n),e,t)},function(e,t){var n=ud(this),r=dd(e);if("string"==typeof t&&-1===wd(t,b)&&-1===wd(t,"$<")){e=E(g,n,r,t);if(e.done)return e.value}for(var i,s=cd(t),a=(s||(t=dd(t)),n.global),o=(a&&(i=n.unicode,n.lastIndex=0),[]);null!==(d=yd(n,r))&&(Id(o,d),a);)""===dd(d[0])&&(n.lastIndex=pd(r,hd(n.lastIndex),i));for(var u,c="",l=0,h=0;h<o.length;h++){for(var d,f=dd((d=o[h])[0]),p=gd(Ed(ld(d.index),r.length),0),v=[],_=1;_<d.length;_++)Id(v,void 0===(u=d[_])?u:String(u));var y=d.groups,m=s?(m=bd([f],v,p,r),void 0!==y&&Id(m,y),dd(ad(t,void 0,m))):_d(f,r,p,v,y,t);l<=p&&(c+=Td(r,l,p)+m,l=p+f.length)}return c+Td(r,l)}]},!!ls(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!aa||Sd);function Cd(t){return function(e){e=Nd(kd(e));return 1&t&&(e=Ad(e,Od,"")),e=2&t?Ad(e,Rd,""):e}}var i=Ze(1..valueOf),Kn="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",kd=ne,Nd=Qi,Ad=Ze("".replace),Yn="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",Od=RegExp("^"+Yn+Yn+"*"),Rd=RegExp(Yn+Yn+"*$"),ia={start:Cd(1),end:Cd(2),trim:Cd(3)},t=e,We=V,n=Ze,r=Et,_t=we,Dd=Ut,Md=ou,xd=et,Ld=St,Pd=me,Ud=$,jn=qn.f,qd=G.f,Fd=zt.f,jd=i,Hd=ia.trim,a="Number",Gd=We[a],Vd=Gd.prototype,Bd=We.TypeError,Qd=n("".slice),Kd=n("".charCodeAt),zd=function(e){var t,n,r,i,s,a,o,u=Pd(e,"number");if(Ld(u))throw Bd("Cannot convert a Symbol value to a number");if("string"==typeof u&&2<u.length)if(u=Hd(u),43===(e=Kd(u,0))||45===e){if(88===(t=Kd(u,2))||120===t)return NaN}else if(48===e){switch(Kd(u,1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+u}for(s=(i=Qd(u,2)).length,a=0;a<s;a++)if((o=Kd(i,a))<48||r<o)return NaN;return parseInt(i,n)}return+u};if(r(a,!Gd(" 0o1")||!Gd("0b1")||Gd("+0x1"))){for(var Wd,Yd=function(e){var e=arguments.length<1?0:Gd(function(e){e=Pd(e,"number");return"bigint"==typeof e?e:zd(e)}(e)),t=this;return xd(Vd,t)&&Ud(function(){jd(t)})?Md(Object(e),t,Yd):e},Xd=t?jn(Gd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Jd=0;Xd.length>Jd;Jd++)Dd(Gd,Wd=Xd[Jd])&&!Dd(Yd,Wd)&&Fd(Yd,Wd,qd(Gd,Wd));_t(We,a,(Yd.prototype=Vd).constructor=Yd,{constructor:!0})}function Zd(n){Object.keys(n).forEach(function(e){var t;void 0!==(t=n[e])&&!Number.isNaN(t)&&""!==t&&t!==[]||delete n[e]})}var $d,ef,tf,nf=function(){var t=h(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getCandidateInfo()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:n=e.sent,i=n.entries(),s=0;case 7:if(!(s<n.size)){e.next=18;break}if(a=i.next(),a=a.value){e.next=11;break}return e.abrupt("continue",15);case 11:if("candidate-pair"===(o=a[1]).type&&"succeeded"===o.state)return r=o.localCandidateId,e.abrupt("break",18);e.next=15;break;case 15:s++,e.next=7;break;case 18:if(!(s<n.size)){e.next=28;break}if(o=i.next(),u=o.value){e.next=22;break}return e.abrupt("continue",25);case 22:if("local-candidate"===(c=u[1]).type&&c.id===r)return e.abrupt("return",{connectionType:null!=(l=c.candidateType)?l:"",protocol:null!=(l=c.protocol)?l:"",relayProtocol:null!=(l=c.relayProtocol)?l:""});e.next=25;break;case 25:s++,e.next=18;break;case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),rf=function(){var t=h(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={},i={},s={},a=new Map,o=new Map,t.forEach(function(e){"codec"===e.type&&a.set(e.id,e),"candidate-pair"===e.type&&"succeeded"===e.state&&(u=e.localCandidateId,n.webrtc_timestamp=e.time),"media-source"===e.type&&o.set(e.kind,e)}),t.forEach(function(e){var t;"local-candidate"===e.type&&e.id===u&&(r.network_type=e.networkType,r.protocol=e.protocol,r.candidate_type=e.candidateType),"audio"!==e.kind&&"audio"!==e.mediaType||("outbound-rtp"===e.type&&(i.codec=null==(t=a.get(e.codecId))?void 0:t.mimeType,i.total_packets_sent=e.packetsSent,i.retransmitted_packets_sent=e.retransmittedPacketsSent),"remote-inbound-rtp"===e.type&&(i.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,i.total_packets_received=e.packetsReceived,i.total_packets_lost_rate=t,i.total_packets_lost=e.packetsLost,i.jitter=1e3*e.jitter),"track"===e.type&&e.remoteSource&&(i.jitter_buffer_delay=e.jitterBufferDelay,i.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount)),"video"!==e.kind&&"video"!==e.mediaType||(s.video_source_width=null==(t=o.get("video"))?void 0:t.width,s.video_source_height=null==(t=o.get("video"))?void 0:t.height,s.video_source_frames_per_second=null==(t=o.get("video"))?void 0:t.framesPerSecond,"outbound-rtp"===e.type&&(s.codec=null==(t=a.get(e.codecId))?void 0:t.mimeType,s.fir_count=e.firCount,s.pli_count=e.pliCount,s.nack_count=e.nackCount,s.qp_sum=e.qpSum,s.retransmitted_packets_sent=e.retransmittedBytesSent,s.quality_limitation_reason=e.qualityLimitationReason,s.quality_limitation_resolution_changes=e.qualityLimitationResolutionChanges),"remote-inbound-rtp"===e.type&&(s.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(s.header_bytes_received=e.headerBytesReceived,s.key_frames_decoded=e.keyFramesDecoded,s.total_decode_time=e.totalDecodeTime,s.total_inter_frame_delay=e.totalInterFrameDelay,s.total_squared_inter_frame_delay=e.totalSquaredInterFrameDelay,t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,s.total_packets_lost=e.packetsLost,s.total_packets_received=e.packetsReceived,s.total_packets_lost_rate=t),"track"===e.type&&(e.remoteSource?(s.jitter_buffer_delay=e.jitterBufferDelay,s.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount,s.received_frame_width=e.frameWidth,s.received_frame_height=e.frameHeight,s.frames_received=e.framesReceived,s.frames_decoded=e.framesDecoded,s.frames_dropped=e.framesDropped,s.freeze_count=e.freezeCount,s.pause_count=e.pauseCount,s.total_freezes_duration=e.totalFreezesDuration,s.total_pauses_duration=e.totalPausesDuration,s.total_frames_duration=e.totalFramesDuration,s.sum_of_squared_frames_duration=e.sumOfSquaredFramesDuration):(s.sent_frame_width=e.frameWidth,s.sent_frame_height=e.frameHeight)))}),Zd(r),Zd(i),Zd(s),n.transport_info=r,n.audio=i,n.video=s,e.abrupt("return",n);case 15:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),sf=function(){var t=h(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getStats()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:return n=e.sent,e.abrupt("return",rf(n));case 6:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),af=function(){function t(e){d(this,t),this._context=e}return f(t,[{key:"state",get:function(){return this._state}},{key:"_changeState",value:function(e){this._state&&this._state.type===e.type||(this._state&&this._state.destroy(),this._state=e,this._state.context=this._context,this._state.start())}}]),t}(),of=function(){function t(e){d(this,t),this._stateMutator=e}return f(t,[{key:"context",set:function(e){this._context=e}},{key:"start",value:function(){this._onStart()}},{key:"destroy",value:function(){this._onDestroy()}}]),t}(),uf=function(){function n(e,t){d(this,n),this._context=e,this._stateMutator=t,this._context=e,this._stateMutator=t}return f(n,[{key:"state",get:function(){return this._stateMutator.state}}]),n}(),cf=function(){p(n,of);var t=_(n);function n(e){return d(this,n),t.call(this,e)}return f(n)}(),lf=((Vt=$d=$d||{}).IDLE="idle",Vt.OFFERING="offering",Vt.ANSWERING="answering",Vt.CONNECTED="connected",Vt.RECONNECTING="reconnecting",Vt.ICE_RESTART_OFFERING="iceRestartOffering",Vt.ICE_RESTART_ANSWERING="iceRestartAnswering",Vt.CLOSED="closed",function(){p(r,cf);var t,n=_(r);function r(e,t){return d(this,r),u(v(e=n.call(this,e)),"type",$d.ANSWERING),e._offerCommand=t,e}return f(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("answering"),this._context.createRTCConnection(),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.prepareSessionDescription(),this._context.sendAnswer().catch(function(e){});case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}()),hf=function(){p(s,cf);var i=_(s);function s(){var e;d(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u(v(e=i.call.apply(i,[this].concat(n))),"type",$d.CLOSED),e}return f(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),s}(),df=function(){p(r,cf);var t,n=_(r);function r(e,t){return d(this,r),u(v(e=n.call(this,e)),"type",$d.CONNECTED),e._isReconnected=t,e}return f(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toReconnecting(t);case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceDisconnected",value:function(){this._stateMutator.toReconnecting()}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),ff=function(){p(r,cf);var t,n=_(r);function r(e,t){return d(this,r),u(v(e=n.call(this,e)),"type",$d.ICE_RESTART_ANSWERING),e._offerCommand=t,e}return f(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartAnswering"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.sendAnswer().catch(function(e){});case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),pf=function(){p(s,cf);var i=_(s);function s(){var e;d(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u(v(e=i.call.apply(i,[this].concat(n))),"type",$d.ICE_RESTART_OFFERING),e}return f(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartOffering"),this._context.sendOffer(!0)}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),vf=function(){p(s,cf);var t,i=_(s);function s(){var e;d(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u(v(e=i.call.apply(i,[this].concat(n))),"type",$d.IDLE),e}return f(s,[{key:"_onStart",value:function(){}},{key:"_onDestroy",value:function(){}},{key:"createOffer",value:function(){this._stateMutator.toOffering()}},{key:"onOfferReceived",value:(t=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toAnswering(t);case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),_f=function(){p(s,cf);var i=_(s);function s(){var e;d(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u(v(e=i.call.apply(i,[this].concat(n))),"type",$d.OFFERING),e}return f(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("offering"),this._context.createRTCConnection(),this._context.prepareSessionDescription()}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),yf=function(){p(r,cf);var n=_(r);function r(e,t){return d(this,r),u(v(e=n.call(this,e)),"type",$d.RECONNECTING),e._offerCommand=t,e}return f(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("reconnecting"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:function(e){this._stateMutator.toIceRestartAnswering(e)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),mf=function(){p(t,af);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}},{key:"toIdle",value:function(){this._changeState(new vf(this))}},{key:"toOffering",value:function(){this._changeState(new _f(this))}},{key:"toAnswering",value:function(e){this._changeState(new lf(this,e))}},{key:"toConnected",value:function(e){this._changeState(new df(this,e))}},{key:"toReconnecting",value:function(e){this._changeState(new yf(this,e))}},{key:"toIceRestartOffering",value:function(){this._changeState(new pf(this))}},{key:"toIceRestartAnswering",value:function(e){this._changeState(new ff(this,e))}},{key:"toClosed",value:function(){this._changeState(new hf(this))}}]),t}(),gf=function(){p(n,uf);var t=_(n);function n(e){return d(this,n),(e=t.call(this,e,new mf(e)))._stateMutator.toIdle(),e}return f(n,[{key:"state",get:function(){return this._stateMutator.state}},{key:"onOfferReceived",value:function(e){o.verbose("[".concat(this.state.type,"] onOfferReceived"));var t=this.state;switch(t.type){case $d.IDLE:case $d.ANSWERING:case $d.CONNECTED:case $d.RECONNECTING:case $d.ICE_RESTART_ANSWERING:t.onOfferReceived(e);break;default:o.error("[".concat(this.state.type,"] onOfferReceived"))}}},{key:"onAnswerReceived",value:function(e){o.verbose("[".concat(this.state.type,"] onAnswerReceived"));var t=this.state;switch(t.type){case $d.OFFERING:case $d.ICE_RESTART_OFFERING:t.onAnswerReceived(e);break;default:o.error("[".concat(this.state.type,"] onAnswerReceived"))}}},{key:"onClose",value:function(){o.verbose("[".concat(this.state.type,"] onClose"));var e=this.state;switch(e.type){case $d.IDLE:case $d.OFFERING:case $d.ANSWERING:case $d.CONNECTED:case $d.RECONNECTING:case $d.ICE_RESTART_OFFERING:case $d.ICE_RESTART_ANSWERING:e.onClose();break;default:o.error("[".concat(this.state.type,"] onClose"))}}},{key:"createOffer",value:function(){o.verbose("[".concat(this.state.type,"] createOffer"));var e=this.state;e.type===$d.IDLE?e.createOffer():o.error("[".concat(this.state.type,"] createOffer"))}},{key:"onIceConnected",value:function(){o.verbose("[".concat(this.state.type,"] onIceConnected"));var e=this.state;switch(e.type){case $d.OFFERING:case $d.ANSWERING:case $d.RECONNECTING:case $d.ICE_RESTART_OFFERING:case $d.ICE_RESTART_ANSWERING:e.onIceConnected();break;default:o.error("[".concat(this.state.type,"] onIceConnected"))}}},{key:"onIceDisconnected",value:function(){o.verbose("[".concat(this.state.type,"] onIceDisconnected"));var e=this.state;e.type===$d.CONNECTED?e.onIceDisconnected():o.error("[".concat(this.state.type,"] onIceDisconnected"))}},{key:"onIceFailed",value:function(){o.verbose("[".concat(this.state.type,"] onIceFailed"));var e=this.state;switch(e.type){case $d.CONNECTED:case $d.RECONNECTING:e.onIceFailed();break;default:o.error("[".concat(this.state.type,"] onIceFailed"))}}}]),n}(),Ef=((s=ef=ef||{}).RELAY="relay",s.ALL="all",function(){p(l,hh);var e,t,n,r,c=_(l);function l(e,t,n,r,i,s,a,o){var u;return d(this,l),(u=c.call(this))._ctx=e,u.id=t,u._signalingClient=n,u._localStream=r,u._isInitiator=i,u._turnCredential=s,u._mediaDirections=a,u._isDisposable=o,u._stateMachine=new gf({dispatchEvent:u._dispatchEvent.bind(v(u)),isInitiator:u._isInitiator,setRemoteDescription:u._setRemoteDescription.bind(v(u)),sendAnswer:u._sendAnswer.bind(v(u)),sendOffer:u._sendOffer.bind(v(u)),createRTCConnection:u._createRTCConnection.bind(v(u)),prepareSessionDescription:u._prepareSessionDescription.bind(v(u)),isDisposable:u._isDisposable}),r&&r.on("streamChanged",function(e){return u.onLocalStream(e)}),u}return f(l,[{key:"_state",get:function(){return this._stateMachine.state}},{key:"rtcConnection",get:function(){return this._rtcConnection}},{key:"remoteStream",get:function(){return this._remoteStream}},{key:"signalingClient",get:function(){return this._signalingClient}},{key:"onEvent",value:function(e){switch(e.type){case tf.CANDIDATE:return void this._receiveCandidate(e);case tf.OFFER:this._stateMachine.onOfferReceived(e);break;case tf.ANSWER:this._stateMachine.onAnswerReceived(e);break;default:o.error(new Error("unhandled call event ".concat(e)))}}},{key:"createOffer",value:function(){this._stateMachine.createOffer()}},{key:"close",value:function(){this._closeRTCConnection(),this._stateMachine.onClose()}},{key:"onLocalStream",value:function(e){if(this._rtcConnection){var t,n=j(e.getTracks());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._replaceTrack(r)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getCandidateInfo",value:(r=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",nf(this.rtcConnection));case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getStatsLog",value:(n=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",sf(this.rtcConnection));case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"_replaceTrack",value:function(e){var t,n=j(this._rtcConnection.getSenders());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.track&&r.track.kind===e.kind&&r.replaceTrack(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_createRTCConnection",value:function(){var e,r=this,t=(this._turnCredential&&(e={iceServers:[{username:this._turnCredential.username,credential:this._turnCredential.password,urls:this._turnCredential.turnUrls}],iceTransportPolicy:this._turnCredential.transportPolicy||ef.ALL}),new RTCPeerConnection(e));t.onnegotiationneeded=function(){r._sendOffer(!1)},t.onicecandidate=function(e){var t,n;e.candidate&&null!=(t=(n=r._signalingClient).sendCandidate)&&t.call(n,e.candidate)},t.onconnectionstatechange=function(){return r._handleConnectionStateChange(t)},t.oniceconnectionstatechange=function(){return r._handleIceConnectionStateChange(t)},t.ontrack=function(e){return r._onRemoteTrack(e)},this._rtcConnection=t}},{key:"_closeRTCConnection",value:function(){this._rtcConnection&&(this._rtcConnection.onnegotiationneeded=null,this._rtcConnection.onicecandidate=null,this._rtcConnection.oniceconnectionstatechange=null,this._rtcConnection.onconnectionstatechange=null,this._rtcConnection.close(),this._rtcConnection=null,delete this._remoteStream)}},{key:"_prepareSessionDescription",value:function(){var e=this._mediaDirections,t=e.audio,e=e.video,n={sendrecv:[],sendonly:[],recvonly:[],none:[]};n[t].push("audio"),n[e].push("video"),n.sendrecv.length&&this._addTracks(n.sendrecv),n.sendonly.length&&this._addSendOnlyTransceivers(n.sendonly),n.recvonly.length&&this._addReceiveOnlyTransceivers(n.recvonly)}},{key:"_addTracks",value:function(t){var n=this,r=(o.debug("_addTracks()"),this._localStream.localStream);r.getTracks().forEach(function(e){t.includes(e.kind)&&n._rtcConnection.addTrack(e,r)})}},{key:"_addReceiveOnlyTransceivers",value:function(e){var t=this;e.forEach(function(e){t._rtcConnection.addTransceiver(e,{direction:"recvonly"})})}},{key:"_addSendOnlyTransceivers",value:function(e){var n=this,r=this._localStream.localStream;e.forEach(function(t){r.getTracks().forEach(function(e){e.kind===t&&n._rtcConnection.addTransceiver(e,{direction:"sendonly",streams:[r]})})})}},{key:"_setRemoteDescription",value:function(e,t){t=t.replace(/a=extmap:0 ulpfec\r\n/,""),e=new RTCSessionDescription({type:e,sdp:t});return this._rtcConnection.setRemoteDescription(e)}},{key:"_sendOffer",value:(t=h(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={iceRestart:t||!1},e.next=3,this._rtcConnection.createOffer(n);case 3:return n=e.sent,e.next=6,this._rtcConnection.setLocalDescription(n);case 6:return e.abrupt("return",this._signalingClient.sendOfferSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_sendAnswer",value:(e=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rtcConnection.createAnswer();case 2:return(t=e.sent).sdp=t.sdp.replace("actpass","active"),e.next=6,this._rtcConnection.setLocalDescription(t);case 6:return e.abrupt("return",this._signalingClient.sendAnswerSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_handleIceConnectionStateChange",value:function(e){switch(o.verbose("[".concat(this._state.type,"] iceConnectionState ").concat(e.iceConnectionState)),e.iceConnectionState){case"connected":this._stateMachine.onIceConnected();break;case"disconnected":this._stateMachine.onIceDisconnected();break;case"failed":this._dispatchEvent("iceFailed")}}},{key:"_handleConnectionStateChange",value:function(e){o.verbose("[".concat(this._state.type,"] connectionState ").concat(e.connectionState))}},{key:"_receiveCandidate",value:function(e){e=e.payload.candidate;this._rtcConnection.addIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.sdp}).catch(function(e){o.error(e)})}},{key:"_onRemoteTrack",value:function(e){this._remoteStream=e.streams[0],this._dispatchEvent("remoteStream",this._remoteStream)}}]),l}());(Je=tf=tf||{}).OFFER="offer",Je.ANSWER="answer",Je.CANDIDATE="candidate";var bf,If,ls="process"==te(V.process),wf=oi,Tf=he,Sf=TypeError,Cf=be,kf=function(e){if(wf(e))return e;throw Sf(Tf(e)+" is not a constructor")},Nf=ye("species"),Af=TypeError,aa=/(?:ipad|iphone|ipod).*applewebkit/i.test(vt),Of=V,Rf=mt,Yn=De,Df=ue,Mf=Ut,e=$,xf=cs,Lf=ti,Pf=Ee,Uf=function(e,t){if(e<t)throw Af("Not enough arguments");return e},et=aa,St=ls,qn=Of.setImmediate,zt=Of.clearImmediate,qf=Of.process,Ff=Of.Dispatch,jf=Of.Function,i=Of.MessageChannel,Hf=Of.String,Gf=0,Vf={},Bf="onreadystatechange";try{bf=Of.location}catch(e){}function Qf(e){return function(){up(e)}}function Kf(e){up(e.data)}function zf(e){Of.postMessage(Hf(e),bf.protocol+"//"+bf.host)}function Wf(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}function Yf(){this.head=null,this.tail=null}function Xf(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=Ep(n),this.reject=Ep(r)}function Jf(e,t){var n,r,i,s,a=t.value,o=t.state==Wp,u=o?e.ok:e.fail,c=e.resolve,l=e.reject,h=e.domain;try{u?(o||(t.rejection===Jp&&(s=t,wp(Ap,Ip,function(){var e=s.facade;bp?Gp.emit("rejectionHandled",e):ev(zp,e,s.value)})),t.rejection=Xp),!0===u?n=a:(h&&h.enter(),n=u(a),h&&(h.exit(),i=!0)),n===e.promise?l(jp("Promise-chain cycle")):(r=Zp(n))?wp(r,n,c,l):c(n)):l(a)}catch(e){h&&!i&&h.exit(),l(e)}}var Zf,$f,ep,tp,np,rp,ip,sp,ap,op,up=function(e){var t;Mf(Vf,e)&&(t=Vf[e],delete Vf[e],t())},t=(qn&&zt||(qn=function(e){Uf(arguments.length,1);var t=Df(e)?e:jf(e),n=Lf(arguments,1);return Vf[++Gf]=function(){Rf(t,void 0,n)},If(Gf),Gf},zt=function(e){delete Vf[e]},St?If=function(e){qf.nextTick(Qf(e))}:Ff&&Ff.now?If=function(e){Ff.now(Qf(e))}:i&&!et?(r=(n=new i).port2,n.port1.onmessage=Kf,If=Yn(r.postMessage,r)):Of.addEventListener&&Df(Of.postMessage)&&!Of.importScripts&&bf&&"file:"!==bf.protocol&&!e(zf)?(If=zf,Of.addEventListener("message",Kf,!1)):If=Bf in Pf("script")?function(e){xf.appendChild(Pf("script"))[Bf]=function(){xf.removeChild(this),up(e)}}:function(e){setTimeout(Qf(e),0)}),{set:qn,clear:zt}),jn=V,_t=/ipad|iphone|ipod/i.test(vt)&&void 0!==jn.Pebble,We=/web0s(?!.*chrome)/i.test(vt),a=V,Vt=De,s=G.f,cp=t.set,Je=aa,oi=_t,mt=We,lp=ls,Ut=a.MutationObserver||a.WebKitMutationObserver,cs=a.document,hp=a.process,ti=a.Promise,St=s(a,"queueMicrotask"),et=St&&St.value,n=(et||(Zf=function(){var e,t;for(lp&&(e=hp.domain)&&e.exit();$f;){t=$f.fn,$f=$f.next;try{t()}catch(e){throw $f?tp():ep=void 0,e}}ep=void 0,e&&e.enter()},tp=Je||lp||mt||!Ut||!cs?!oi&&ti&&ti.resolve?((i=ti.resolve(void 0)).constructor=ti,ip=Vt(i.then,i),function(){ip(Zf)}):lp?function(){hp.nextTick(Zf)}:(cp=Vt(cp,a),function(){cp(Zf)}):(np=!0,rp=cs.createTextNode(""),new Ut(Zf).observe(rp,{characterData:!0}),function(){rp.data=np=!np})),et||function(e){e={fn:e,next:void 0};ep&&(ep.next=e),$f||($f=e,tp()),ep=e}),dp=V,Yn=(Yf.prototype={add:function(e){e={item:e,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},Yf),r=V.Promise,e="object"==typeof window&&"object"!=typeof Deno,qn=V,fp=r,zt=ue,jn=Et,pp=Un,G=ye,vp=e,_p=yt,yp=(fp&&fp.prototype,G("species")),mp=!1,gp=zt(qn.PromiseRejectionEvent),aa={CONSTRUCTOR:jn("Promise",function(){var e=pp(fp),t=e!==String(fp);if(!t&&66===_p)return!0;if(51<=_p&&/native code/.test(e))return!1;function n(e){e(function(){},function(){})}e=new fp(function(e){e(1)});return(e.constructor={})[yp]=n,!(mp=e.then(function(){})instanceof n)||!t&&vp&&!gp}),REJECTION_EVENT:gp,SUBCLASSING:mp},_t={},Ep=de,We=(_t.f=function(e){return new Xf(e)},Re),bp=ls,Ip=V,wp=Xe,s=we,St=ra,Je=oa,mt=uu,Tp=de,Sp=ue,Cp=ce,kp=So,Np=function(e,t){var e=Cf(e).constructor;return void 0===e||null==(e=Cf(e)[Nf])?t:kf(e)},Ap=t.set,Op=n,Rp=function(e,t){var n=dp.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},Dp=Wf,Mp=Yn,oi=Yt,ti=r,i=_t,xp="Promise",Vt=aa.CONSTRUCTOR,Lp=aa.REJECTION_EVENT,a=aa.SUBCLASSING,Pp=oi.getterFor(xp),Up=oi.set,cs=ti&&ti.prototype,qp=ti,Fp=cs,jp=Ip.TypeError,Hp=Ip.document,Gp=Ip.process,Vp=i.f,Bp=Vp,Qp=!!(Hp&&Hp.createEvent&&Ip.dispatchEvent),Kp="unhandledrejection",zp="rejectionhandled",Wp=1,Yp=2,Xp=1,Jp=2,Zp=function(e){var t;return!(!Cp(e)||!Sp(t=e.then))&&t},$p=function(n,i){n.notified||(n.notified=!0,Op(function(){for(var e,r,t=n.reactions;e=t.get();)Jf(e,n);n.notified=!1,i&&!n.rejection&&(r=n,wp(Ap,Ip,function(){var e=r.facade,t=r.value,n=tv(r);if(n&&(n=Dp(function(){bp?Gp.emit("unhandledRejection",t,e):ev(Kp,e,t)}),r.rejection=bp||tv(r)?Jp:Xp,n.error))throw n.value}))}))},ev=function(e,t,n){var r;Qp?((r=Hp.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Ip.dispatchEvent(r)):r={promise:t,reason:n},!Lp&&(t=Ip["on"+e])?t(r):e===Kp&&Rp("Unhandled promise rejection",n)},tv=function(e){return e.rejection!==Xp&&!e.parent},nv=function(t,n,r){return function(e){t(n,e,r)}},rv=function(e,t,n){e.done||(e.done=!0,(e=n?n:e).value=t,e.state=Yp,$p(e,!0))},iv=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw jp("Promise can't be resolved itself");var r=Zp(e);r?Op(function(){var t={done:!1};try{wp(r,e,nv(iv,t,n),nv(rv,t,n))}catch(e){rv(t,e,n)}}):(n.value=e,n.state=Wp,$p(n,!1))}catch(e){rv({done:!1},e,n)}}};if(Vt&&(Fp=(qp=function(e){kp(this,Fp),Tp(e),wp(sp,this);var t=Pp(this);try{e(nv(iv,t),nv(rv,t))}catch(e){rv(t,e)}}).prototype,(sp=function(e){Up(this,{type:xp,done:!1,notified:!1,parent:!1,reactions:new Mp,rejection:!1,state:0,value:void 0})}).prototype=s(Fp,"then",function(e,t){var n=Pp(this),r=Vp(Np(this,qp));return n.parent=!0,r.ok=!Sp(e)||e,r.fail=Sp(t)&&t,r.domain=bp?Gp.domain:void 0,0==n.state?n.reactions.add(r):Op(function(){Jf(r,n)}),r.promise}),ap=function(){var e=new sp,t=Pp(e);this.promise=e,this.resolve=nv(iv,t),this.reject=nv(rv,t)},i.f=Vp=function(e){return e===qp||void 0===e?new ap:Bp(e)},Sp(ti)&&cs!==Object.prototype)){op=cs.then,a||s(cs,"then",function(e,t){var n=this;return new qp(function(e,t){wp(op,n,e,t)}).then(e,t)},{unsafe:!0});try{delete cs.constructor}catch(e){}St&&St(cs,Fp)}We({global:!0,constructor:!0,wrap:!0,forced:Vt},{Promise:qp}),Je(qp,xp,!1),mt(xp);var sv=r,Ut=au,et=aa.CONSTRUCTOR||!Ut(function(e){sv.all(e).then(void 0,function(){})}),av=Xe,ov=de,uv=_t,cv=Wf,lv=To,Et=(Re({target:"Promise",stat:!0,forced:et},{all:function(e){var o=this,t=uv.f(o),u=t.resolve,c=t.reject,n=cv(function(){var r=ov(o.resolve),i=[],s=0,a=1;lv(e,function(e){var t=s++,n=!1;a++,av(r,o,e).then(function(e){n||(n=!0,i[t]=e,--a||u(i))},c)}),--a||u(i)});return n.error&&c(n.value),t.promise}}),Re),Un=r,e=le,G=ue,zt=we,qn=Un&&Un.prototype;Et({target:"Promise",proto:!0,forced:aa.CONSTRUCTOR,real:!0},{catch:function(e){return this.then(void 0,e)}}),G(Un)&&(jn=e("Promise").prototype.catch,qn.catch!==jn&&zt(qn,"catch",jn,{unsafe:!0}));var hv=Xe,dv=de,fv=_t,pv=Wf,vv=To;Re({target:"Promise",stat:!0,forced:et},{race:function(e){var n=this,r=fv.f(n),i=r.reject,t=pv(function(){var t=dv(n.resolve);vv(e,function(e){hv(t,n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}});function _v(c){return function(e,t,n,r){Zv(t);var i=$v(e),s=e_(i),a=t_(i),o=c?a-1:0,u=c?-1:1;if(n<2)for(;;){if(o in s){r=s[o],o+=u;break}if(o+=u,c?o<0:a<=o)throw n_("Reduce of empty array with no initial value")}for(;c?0<=o:o<a;o+=u)o in s&&(r=t(r,s[o],o,i));return r}}var yv,mv,gv=Xe,Ev=_t,bv=(Re({target:"Promise",stat:!0,forced:aa.CONSTRUCTOR},{reject:function(e){var t=Ev.f(this);return gv(t.reject,void 0,e),t.promise}}),be),Iv=ce,wv=_t,ra=Re,t=le,n=aa.CONSTRUCTOR,Tv=function(e,t){if(bv(e),Iv(t)&&t.constructor===e)return t;e=wv.f(e);return(0,e.resolve)(t),e.promise},Sv=(t("Promise"),ra({target:"Promise",stat:!0,forced:n},{resolve:function(e){return Tv(this,e)}}),f(function e(){var n=this;d(this,e),this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})})),Cv=function(){var r=h(regeneratorRuntime.mark(function e(t,n,r){var i,s,a,o,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=3<l.length&&void 0!==l[3]?l[3]:{count:0,deferred:new Sv},i=a.deferred,s=a.count,e.prev=2,e.next=5,n();case 5:a=e.sent,0<s&&null!=(o=r.onRecover)&&o.call(r),i.resolve(a),e.next=19;break;case 10:if(e.prev=10,e.t0=e.catch(2),null!=(o=r.onError)&&o.call(r,e.t0),0<=(u=t.calcTimeout(s+1)))return null!=(c=r.onRetrial)&&c.call(r,s+1,e.t0),setTimeout(function(){Cv(t,n,r,{count:s+1,deferred:i})},u),e.abrupt("return",i.promise);e.next=18;break;case 18:i.reject(e.t0);case 19:return e.abrupt("return",i.promise);case 20:case"end":return e.stop()}},e,null,[[2,10]])}));return function(e,t,n){return r.apply(this,arguments)}}(),kv=function(){function e(){d(this,e)}return f(e,[{key:"calcTimeout",value:function(e){switch(e){case 1:return 1e3;case 2:return 2e3;case 3:return 3e3;default:return-1}}}]),e}(),Nv=function(){function r(e,t,n){d(this,r),this.interval=e,this.noise=t,this.maxRetrial=n}return f(r,[{key:"calcTimeout",value:function(e){return e>this.maxRetrial?-1:e*this.interval+(Math.random()-.5)*this.noise*2}}]),r}(),Av=function(){function t(e){d(this,t),this._requests=new Map,this.timeoutTime=e}return f(t,[{key:"has",value:function(e){return this._requests.has(e)}},{key:"get",value:function(e){return this._requests.get(e)}},{key:"register",value:function(e){if(!e)throw new Error("invalid request id");if(this._requests.has(e))throw new Error("duplicate requests");var t=new Sv;return this._requests.set(e,{deferred:t,timer:this._createTimeoutTimer(e)}),t}},{key:"unregister",value:function(e){if(!this._requests.has(e))return null;var t=this._requests.get(e),n=t.timer,t=t.deferred;return clearTimeout(n),this._requests.delete(e),t}},{key:"_createTimeoutTimer",value:function(e){var t=this;return setTimeout(function(){t.unregister(e).reject(new Error("no response due to timeout"))},this._getTimeoutTime())}},{key:"rejectAll",value:function(e){var t,n=j(this._requests.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value,i=this._requests.get(r);clearTimeout(i.timer),i.deferred.reject(e)}}catch(e){n.e(e)}finally{n.f()}this._requests.clear()}},{key:"_getTimeoutTime",value:function(){return this.timeoutTime}}]),t}(),Ov=function(){function i(e,t,n,r){d(this,i),u(this,"_timeoutTime",6e4),this._ctx=e,this._participantId=t,this._mediaDirections=n,this._endpointId=r,this._requestMap=new Av(this._timeoutTime)}var t,n,r;return f(i,[{key:"sendOfferSdp",value:(r=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._endpointId){e.next=5;break}return e.next=3,this._sendOfferAndUnregisterCreateEndpointRequest(t);case 3:e.next=7;break;case 5:return e.next=7,this._sendOfferAndUnregisterPutEndpointRequest(t);case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_sendOfferAndUnregisterCreateEndpointRequest",value:(n=h(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":create-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return n.apply(this,arguments)})},{key:"_sendOfferAndUnregisterPutEndpointRequest",value:(t=h(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":put-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return t.apply(this,arguments)})},{key:"registerCreateEndpointRequest",value:function(){if(this._endpointId)throw new Error("Cannot register create endpoint request on endpoint recycle");return this._requestMap.register("".concat(this._participantId,":create-endpoint-request"))}},{key:"registerPutEndpointRequest",value:function(){if(this._endpointId)return this._requestMap.register("".concat(this._participantId,":put-endpoint-request"));throw new Error("Cannot register put endpoint request without endpoint id")}},{key:"_sendCreateEndpoint",value:function(e){return this._ctx.sendCreateEndpoint(e)}},{key:"_sendPutEndpoint",value:function(e){return this._ctx.sendPutEndpoint(e)}}]),i}(),Rv=function(){p(n,of);var t=_(n);function n(e){return d(this,n),t.call(this,e)}return f(n)}(),Dv=((Yn=yv=yv||{}).PENDING="pending",Yn.ESTABLISHED="established",Yn.CONNECTED="connected",Yn.FAILED="failed",Yn.RELEASING="releasing",Yn.CLOSED="closed",function(){p(s,Rv);var i=_(s);function s(){var e;d(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u(v(e=i.call.apply(i,[this].concat(n))),"type",yv.CLOSED),e}return f(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),s}()),Mv=function(){p(n,Rv);var t=_(n);function n(e){return d(this,n),u(v(e=t.call(this,e)),"type",yv.CONNECTED),e}return f(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onICEFailed",value:function(){this._stateMutator.toPending()}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(),xv=function(){p(i,Rv);var r=_(i);function i(e,t,n){return d(this,i),u(v(e=r.call(this,e)),"type",yv.ESTABLISHED),e._sdp=t,e._hasPendingAttach=n,e}return f(i,[{key:"_onStart",value:function(){this._context.dispatchEvent("established"),this._context.setRemoteDescription(this._sdp),this._hasPendingAttach&&this.onAttach()}},{key:"_onDestroy",value:function(){}},{key:"onPCConnected",value:function(){this._stateMutator.toConnected()}},{key:"onICEFailed",value:function(){this._stateMutator.toPending()}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),i}(),Lv=function(){p(s,Rv);var i=_(s);function s(){var e;d(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u(v(e=i.call.apply(i,[this].concat(n))),"type",yv.FAILED),e}return f(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("failed"),this._context.endpoint.id?this._stateMutator.toReleasing():this._stateMutator.toClosed()}},{key:"_onDestroy",value:function(){}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),Pv=function(){p(s,Rv);var i=_(s);function s(){var e;d(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u(v(e=i.call.apply(i,[this].concat(n))),"type",yv.PENDING),e}return f(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("pending"),this._request()}},{key:"_onDestroy",value:function(){this._requestTimeout&&clearTimeout(this._requestTimeout),delete this._requestTimeout}},{key:"_request",value:function(){var e=this,t=(this._context.trialCount+=1,this._context.trialCount);9<=t?this._stateMutator.toFailed():1<t?this._requestTimeout=setTimeout(function(){e._context.createSession()},5e3*t+2e3*(Math.random()-.5)):this._context.createSession()}},{key:"onEndpointRequestSucceeded",value:function(e){this._stateMutator.toEstablished(e,this._hasPendingAttach)}},{key:"onEndpointRequestFailed",value:function(){this._request()}},{key:"onAttach",value:function(){this._hasPendingAttach=!0}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),Uv=function(){p(s,Rv);var i=_(s);function s(){var e;d(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u(v(e=i.call.apply(i,[this].concat(n))),"type",yv.RELEASING),e}return f(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("releasing"),this._context.closePeerConnection(),this._context.endpoint.id&&this._context.requestRelease()}},{key:"_onDestroy",value:function(){}},{key:"onEndpointRequestSucceeded",value:function(){this._context.requestRelease()}},{key:"onEndpointRequestFailed",value:function(){this._stateMutator.toClosed()}},{key:"onReleased",value:function(){this._stateMutator.toClosed()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),qv=function(){p(t,af);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t,[{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}},{key:"toPending",value:function(){this._changeState(new Pv(this))}},{key:"toEstablished",value:function(e,t){this._changeState(new xv(this,e,t))}},{key:"toConnected",value:function(){this._changeState(new Mv(this))}},{key:"toFailed",value:function(){this._changeState(new Lv(this))}},{key:"toReleasing",value:function(){this._changeState(new Uv(this))}},{key:"toClosed",value:function(){this._changeState(new Dv(this))}}]),t}(),Fv=function(){p(n,uf);var t=_(n);function n(e){return d(this,n),(e=t.call(this,e,new qv(e)))._stateMutator.toPending(),e}return f(n,[{key:"state",get:function(){return this._stateMutator.state}},{key:"onEndpointRequestSucceeded",value:function(e){o.verbose("[".concat(this.state.type,"] onEndpointRequestSucceeded"));var t=this.state;switch(t.type){case yv.PENDING:t.onEndpointRequestSucceeded(e);break;case yv.RELEASING:t.onEndpointRequestSucceeded();break;default:o.error("[".concat(this.state.type,"] onEndpointRequestSucceeded"))}}},{key:"onEndpointRequestFailed",value:function(){o.verbose("[".concat(this.state.type,"] onEndpointCreateFailed"));var e=this.state;switch(e.type){case yv.PENDING:case yv.RELEASING:e.onEndpointRequestFailed();break;default:o.error("[".concat(this.state.type,"] onEndpointCreateFailed"))}}},{key:"onICEFailed",value:function(){o.verbose("[".concat(this.state.type,"] onICEFailed"));var e=this.state;switch(e.type){case yv.ESTABLISHED:case yv.CONNECTED:e.onICEFailed();break;default:o.error("[".concat(this.state.type,"] onICEFailed"))}}},{key:"onPCConnected",value:function(){o.verbose("[".concat(this.state.type,"] onPCConnected"));var e=this.state;e.type===yv.ESTABLISHED?e.onPCConnected():o.error("[".concat(this.state.type,"] onPCConnected"))}},{key:"onAttach",value:function(){o.verbose("[".concat(this.state.type,"] onAttach"));var e=this.state;switch(e.type){case yv.PENDING:case yv.ESTABLISHED:case yv.CONNECTED:e.onAttach();break;default:o.error("[".concat(this.state.type,"] onAttach"))}}},{key:"onRelease",value:function(){o.verbose("[".concat(this.state.type,"] onRelease"));var e=this.state;switch(e.type){case yv.PENDING:case yv.ESTABLISHED:case yv.CONNECTED:e.onRelease();break;default:o.error("[".concat(this.state.type,"] onRelease"))}}},{key:"onReleased",value:function(){o.verbose("[".concat(this.state.type,"] onReleased"));var e=this.state;e.type===yv.RELEASING?e.onReleased():o.error("[".concat(this.state.type,"] onReleased"))}},{key:"onExit",value:function(){o.verbose("[".concat(this.state.type,"] onExit"));var e=this.state;switch(e.type){case yv.RELEASING:case yv.PENDING:case yv.CONNECTED:case yv.ESTABLISHED:case yv.FAILED:e.onExit();break;default:o.error("[".concat(this.state.type,"] onExit"))}}}]),n}(),jv=function(){p(r,Mi);var n=_(r);function r(e){var t;return d(this,r),(t=n.call(this)).payload=e.payload||{},t}return f(r)}(),Hv=function(){p(t,jv);var e=_(t);function t(){return d(this,t),e.apply(this,arguments)}return f(t)}(),Gv=((Yt=mv=mv||{}).OFFER="offer",Yt.ANSWER="answer",Yt.CANDIDATE="candidate",function(){p(n,Hv);var t=_(n);function n(e){return d(this,n),u(v(e=t.call(this,{payload:e})),"type",mv.ANSWER),e}return f(n)}()),Vv=function(){p(n,Hv);var t=_(n);function n(e){return d(this,n),u(v(e=t.call(this,{payload:e})),"type",mv.CANDIDATE),e}return f(n)}(),Bv=function(){p(n,Hv);var t=_(n);function n(e){return d(this,n),u(v(e=t.call(this,{payload:e})),"type",mv.OFFER),e}return f(n)}(),Qv=function(){function e(){d(this,e)}return f(e,null,[{key:"createOffer",value:function(e,t){return new Bv({peerConnectionId:e,sdp:t})}},{key:"createAnswer",value:function(e,t){return new Gv({peerConnectionId:e,sdp:t})}},{key:"createCandidate",value:function(e,t){return new Vv({peerConnectionId:e,candidate:t})}}]),e}(),Kv=function(){p(a,hh);var s=_(a);function a(e,t,n,r){var i;return d(this,a),u(v(i=s.call(this)),"tmpId",J()),u(v(i),"_createSession",function(){switch(o.debug("_createSession()"),i._type){case"master":i._createMasterSession();break;case"viewer":i._createViewerSession();break;default:o.error("Not supported endpoint type : ",i._type)}}),u(v(i),"_closePeerConnection",function(){o.debug("_closePeerConnection()"),i._pc.removeAllEventListeners(),i._pc.close()}),u(v(i),"_requestAttach",function(){Cv(new Nv(5e3,1e3,8),function(){return i._sendAttach(i._attachedTo)},{onError:function(e){o.error("Fail attach endpoint endpointId = ".concat(i.id,", to = ").concat(i._attachedTo," ErrorCode = ").concat(e.code))}}).then(function(){i._dispatchEvent("attached",i._attachedTo)})}),u(v(i),"_requestRelease",function(){o.debug("_requestRelease()"),i._sendReleaseEndpoint().then(function(){i._stateMachine.onReleased()}).catch(function(e){o.error("Release request failed",e),i._stateMachine.onReleased()})}),u(v(i),"_setRemoteDescription",function(e){o.debug("_setRemoteDescription()");var t=i._pc,e=Qv.createAnswer(void 0,e);t.onEvent(e),t.once("connected",function(){i._stateMachine.onPCConnected(),i._sendConnected()}),t.once("iceFailed",function(){i._stateMachine.onICEFailed()})}),i._ctx=e,i._localStream=t,i._type=n,i._participantId=r,i._stateMachine=new Fv({endpoint:v(i),dispatchEvent:i._dispatchEvent.bind(v(i)),createSession:i._createSession,setRemoteDescription:i._setRemoteDescription,closePeerConnection:i._closePeerConnection,requestAttach:i._requestAttach,requestRelease:i._requestRelease,trialCount:0}),i}return f(a,[{key:"pc",get:function(){return this._pc}},{key:"_state",get:function(){return this._stateMachine.state}},{key:"_masterSessionDirection",get:function(){return this._ctx.masterSessionDirection}},{key:"_viewerSessionDirection",get:function(){return this._ctx.viewerSessionDirection}},{key:"attach",value:function(e){o.debug("attach()"),this._attachedTo=e,this._stateMachine.onAttach()}},{key:"release",value:function(){o.debug("release()"),this._stateMachine.onRelease()}},{key:"exit",value:function(){o.debug("exit()"),this._closePeerConnection(),this._stateMachine.onExit()}},{key:"_createMasterSession",value:function(){o.debug("_createMasterSession()"),this._createPeerConnection(this._masterSessionDirection,this._localStream),this._requestCreateEndpoint()}},{key:"_createViewerSession",value:function(){o.debug("_createViewerSession()"),this._createPeerConnection(this._viewerSessionDirection,void 0),this._requestCreateEndpoint()}},{key:"_createPeerConnection",value:function(e,t){o.debug("_createPeerConnection()");var n=new Ov(this._ctx,this._participantId,e,this.id);this._pc=new Ef(this._ctx,void 0,n,t,!0,void 0,e,!0),this._dispatchEvent("pcChanged",this._pc)}},{key:"_requestCreateEndpoint",value:function(){var t=this,e=(o.debug("_requestCreateEndpoint()"),this._pc),n=this.id?e.signalingClient.registerPutEndpointRequest():e.signalingClient.registerCreateEndpointRequest();e.createOffer(),n.promise.then(function(e){t.id=e.payload.endpoint.id,t._stateMachine.onEndpointRequestSucceeded(e.payload.sdp)}).catch(function(e){o.error("Endpoint request failed",e),t._stateMachine.onEndpointRequestFailed()})}},{key:"_sendConnected",value:function(){return this._ctx.sendConnected(this)}},{key:"_sendReleaseEndpoint",value:function(){return this._ctx.sendReleaseEndpoint(this)}},{key:"_sendAttach",value:function(e){return this._ctx.sendAttach(this,e)}}]),a}(),zv=function(){p(n,hh);var e,t=_(n);function n(){return d(this,n),t.call(this)}return f(n,[{key:"stream",get:function(){return this._stream}},{key:"isSharing",get:function(){return!!this._stream}},{key:"startStream",value:(e=h(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getDisplayMedia({video:!0});case 3:t=e.sent,this._stream=t,this._stream.getVideoTracks()[0].onended=function(){n._releaseStream(),n._dispatchEvent("streamStopped")},e.next=19;break;case 8:e.prev=8,e.t0=e.catch(0),e.t1=e.t0.name,e.next="InvalidStateError"===e.t1?13:"NotAllowedError"===e.t1?14:"NotFoundError"===e.t1?15:"NotReadableError"===e.t1?16:17;break;case 13:case 14:case 15:case 16:return e.abrupt("break",18);case 17:throw new Error("");case 18:throw new Error("failed to start screen share");case 19:case"end":return e.stop()}},e,this,[[0,8]])})),function(){return e.apply(this,arguments)})},{key:"stopStream",value:function(){this._releaseStream(),this._dispatchEvent("streamStopped")}},{key:"_releaseStream",value:function(){if(this._stream){var e,t=j(this._stream.getTracks());try{for(t.s();!(e=t.n()).done;)e.value.stop()}catch(e){t.e(e)}finally{t.f()}delete this._stream}}}]),n}(),Wv=function(){p(i,hh);var e,r=_(i);function i(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};return d(this,i),u(v(t=r.call(this)),"_checkScreenSharePrerequisites",function(){if(!navigator.mediaDevices.getDisplayMedia)throw new Error("screen share is not supported in this browser")}),t._deviceManager=e,t._mediaConstraints=n,t._screenShare=new zv,t._screenShare.on("streamStopped",function(){t._releaseMergedStream(),t._dispatchEvent("screenShareStreamStopped")}),t}return f(i,[{key:"mediaConstraints",set:function(e){this._mediaConstraints=e}},{key:"hasPermission",get:function(){var e;return null==(e=this._mediaAccess)?void 0:e.hasPermission}},{key:"localStream",get:function(){return this.isScreenSharing?this._mergedStream:this.getLocalMediaStream()}},{key:"mergedStream",get:function(){return this._mergedStream}},{key:"screenStream",get:function(){return this._screenShare.stream}},{key:"isScreenSharing",get:function(){return this._screenShare.isSharing}},{key:"useScreenStream",value:(e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkScreenSharePrerequisites(),e.next=3,this._screenShare.startStream();case 3:this._mergeScreenShareStream(),this._dispatchEvent("streamChanged",this.localStream);case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"getLocalMediaStream",value:function(){return this._mediaAccess||this._grantMediaAccess(this._mediaConstraints),this._mediaAccess.stream}},{key:"stopScreenShare",value:function(){this._screenShare.isSharing&&this._screenShare.stopStream()}},{key:"revokeMediaAccess",value:function(){this._mediaAccess&&(this._mediaAccess.dispose(),this._mediaAccess=null)}},{key:"release",value:function(){this.stopScreenShare(),this.revokeMediaAccess()}},{key:"_grantMediaAccess",value:function(e){var t=this;this._mediaAccess=this._deviceManager.useMedia(e),this._mediaAccess.on("streamChanged",function(){t._screenShare.isSharing&&t._mergeScreenShareStream(),t._dispatchEvent("streamChanged",t.localStream)}),this._mediaAccess.on("audioOutputChanged",function(){return t._dispatchEvent("audioOutputChanged")})}},{key:"_mergeScreenShareStream",value:function(){var e;this._screenShare.isSharing&&(e=new MediaStream,this._mediaAccess.stream&&0<this._mediaAccess.stream.getAudioTracks().length&&e.addTrack(this._mediaAccess.stream.getAudioTracks()[0]),e.addTrack(this.screenStream.getVideoTracks()[0]),this._mergedStream=e)}},{key:"_releaseMergedStream",value:function(){this._mergedStream&&(this._mergedStream.removeTrack(this._mergedStream.getAudioTracks()[0]),delete this._mergedStream,this._dispatchEvent("streamChanged",this.localStream))}}]),i}(),Yv=function(){function i(e,t,n,r){d(this,i),this._liveEvent=e,this._sender=n,this._deviceManager=t,this._mediaOption=r}var t,n,r;return f(i,[{key:"mediaView",get:function(){return this._mediaView},set:function(e){this._mediaView!==e&&(this._mediaView&&(this._mediaView=null),e?this._mediaView=this._updateMediaViewStream(e,this.stream):delete this._mediaView)}},{key:"localStream",get:function(){return this._localStream.localStream}},{key:"stream",get:function(){var e;return null==(e=this._endpoint.pc)?void 0:e.remoteStream}},{key:"_createLocalStream",value:function(){var e=this;this._localStream=new Wv(this._deviceManager,{audio:!0,video:!0}),this._localStream.on("streamChanged",function(){e._onLocalStream()})}},{key:"_createEndpoint",value:function(){var e,t=this;return this._liveEvent.isHost?(this._localStream||this._createLocalStream(),new Kv({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},this._localStream,"master",this._liveEvent.host.hostId)):(e=new Kv({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},void 0,"viewer",this._liveEvent.currentLiveUser.participantId),this._unsubscriber=e.pc.on("remoteStream",function(e){t._onStream()}),e)}},{key:"openStream",value:function(){this._endpoint&&this._teardown(),this._endpoint=this._createEndpoint()}},{key:"closeStream",value:function(e){e&&this._endpoint.release(),this._teardown()}},{key:"attach",value:function(e){this._endpoint.attach(e)}},{key:"toggleAudio",value:function(t){var e;null!=(e=this.localStream.getAudioTracks())&&e.forEach(function(e){e.enabled=t}),this._mediaOption.turnAudioOn=t}},{key:"toggleVideo",value:function(t){var e;null!=(e=this.localStream.getVideoTracks())&&e.forEach(function(e){e.enabled=t}),this._mediaOption.turnVideoOn=t}},{key:"chooseMediaDevice",value:function(e,t){this._deviceManager.selectDevice(e,t)}},{key:"_onLocalStream",value:function(){this.toggleAudio(this._mediaOption.turnAudioOn),this.toggleVideo(this._mediaOption.turnVideoOn)}},{key:"_onStream",value:function(){var e=this.stream;this._mediaView&&this._updateMediaViewStream(this._mediaView,e)}},{key:"_updateMediaViewStream",value:function(e,t){return t&&(e.srcObject=t),e}},{key:"_sendConnected",value:(r=h(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._liveEvent.isHost?xl.createHostConnected(this._liveEvent.liveEventId,this._liveEvent.host.hostId,t.id):xl.createConnected(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,t.id),e.abrupt("return",this._sender.send(n));case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_sendReleaseEndpoint",value:function(e){e=this._liveEvent.isHost?xl.createHostDeleteStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,e.id):xl.createDeleteStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id);return this._sender.sendWithRetry(e)}},{key:"_sendAttach",value:function(e,t){e=xl.createAttach(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id,t);return this._sender.sendWithRetry(e)}},{key:"_sendCreateEndpoint",value:(n=h(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._liveEvent.isActiveHost)return n=xl.createHostCreateStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,t.sdp,"sendonly","sendonly"),e.abrupt("return",this._sender.send(n));e.next=5;break;case 5:return n=xl.createStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,t.sdp,"recvonly","recvonly"),e.abrupt("return",this._sender.send(n));case 7:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_sendPutEndpoint",value:(t=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._sendCreateEndpoint(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_teardown",value:function(){var e;null!=(e=this._endpoint)&&e.exit(),(this._endpoint=null)!=(e=this._unsubscriber)&&e.call(this),this._unsubscriber=null}}]),i}(),Xv=function(){p(l,hh);var e,t,n,r,i,s,a,o,u,c=_(l);function l(e){var t,n=e.deviceManager,r=e.sender,i=e.sb,s=e.userId,e=e.info;return d(this,l),(t=c.call(this))._deviceManager=n,t._sender=r,t._sb=i,t._userId=s,t._streams=new Map,e&&Object.assign(v(t),e),t._unsubscriber=t._sender.on("command",function(e){t._onEvent(e)}),t}return f(l,[{key:"myRole",get:function(){return this.userIdsForHost.includes(this._userId)?D.LiveEventRole.HOST:D.LiveEventRole.PARTICIPANT}},{key:"isHost",get:function(){return this.myRole===D.LiveEventRole.HOST}},{key:"isActiveHost",get:function(){return this.isHost&&!!this.host}},{key:"fetchOpenChannel",value:(u=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sb.openChannel.getChannelWithoutCache(this.liveEventId);case 2:return t=e.sent,t=this._sb.openChannel.buildOpenChannelFromSerializedData(t),this.openChannel=t,e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"_getOpenChannel",value:(o=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.openChannel)return e.abrupt("return",this.openChannel);e.next=2;break;case 2:return e.abrupt("return",this.fetchOpenChannel());case 3:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"enterAsHost",value:(a=h(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getOpenChannel();case 2:return n=e.sent,e.next=5,n.enter();case 5:return e.prev=5,e.next=8,this._sender.send(xl.createEnterHost(this.liveEventId,t));case 8:r=e.sent,r=r.payload.host,this._streams.set(r.hostId,new Yv(this,this._deviceManager,this._sender,t)),this.upsert({host:r}),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(5),e.next=18,n.exit();case 18:throw e.t0;case 19:this._startToSendAlive();case 20:case"end":return e.stop()}},e,this,[[5,14]])})),function(e){return a.apply(this,arguments)})},{key:"setEventReady",value:(s=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:return e.next=4,this._sender.send(xl.createReady(this.liveEventId));case 4:t=e.sent,t=t.payload.liveEvent,this.upsert(t);case 7:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"startEvent",value:(i=h(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:return e.next=4,this._sender.send(xl.createStart(this.liveEventId));case 4:n=e.sent,n=n.payload.liveEvent,this.upsert(n),this.isHostStreaming||this.startStreaming(t),this._toggleAudio(t.turnAudioOn),this._toggleVideo(t.turnVideoOn);case 10:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"startStreaming",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");e=new Yv(this,this._deviceManager,this._sender,e);this._streams.set(this.host.hostId,e),e.openStream()}},{key:"endStreaming",value:function(){if(!this.isActiveHost)throw new Error("current host only action");var e=this._streams.get(this.host.hostId);e&&(this._streams.delete(this.host.hostId),e.closeStream(!0))}},{key:"exitAsHost",value:(r=h(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.host.hostId,e.next=3,this._sender.send(xl.createExitHost(this.liveEventId,t));case 3:t=e.sent,n=t.payload.host,this.upsert({host:n}),this.teardown();case 7:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"endEvent",value:(n=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sender.send(xl.createEndLiveEvent(this.liveEventId));case 2:t=e.sent,t=t.payload.liveEvent,this.upsert(t),this.teardown();case 6:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"muteAudioInput",value:function(){this._toggleAudio(!1)}},{key:"unmuteAudioInput",value:function(){this._toggleAudio(!0)}},{key:"_toggleAudio",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");this._streams.get(this.host.hostId).toggleAudio(e),this._sender.send(xl.createAudio(this.liveEventId,this.host.hostId,e))}},{key:"stopVideo",value:function(){this._toggleVideo(!1)}},{key:"startVideo",value:function(){this._toggleVideo(!0)}},{key:"_toggleVideo",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");this._streams.get(this.host.hostId).toggleVideo(e),this._sender.send(xl.createVideo(this.liveEventId,this.host.hostId,e))}},{key:"selectAudioInput",value:function(e){return this._deviceManager.selectDevice("audioinput",e)}},{key:"selectVideoInput",value:function(e){return this._deviceManager.selectDevice("videoinput",e)}},{key:"enter",value:(t=h(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getOpenChannel();case 2:return t=e.sent,e.next=5,t.enter();case 5:return e.prev=5,e.next=8,this._sender.send(xl.createEnter(this.liveEventId));case 8:n=e.sent,n=n.payload.participant,this.upsert({currentLiveUser:n}),this._tryOpen(),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(5),e.next=18,t.exit();case 18:throw e.t0;case 19:this._startToSendAlive();case 20:case"end":return e.stop()}},e,this,[[5,14]])})),function(){return t.apply(this,arguments)})},{key:"exit",value:(e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sender.send(xl.createExit(this.liveEventId,this.currentLiveUser.participantId));case 2:e.sent.payload.participant,this.upsert({currentLiveUser:void 0}),this.teardown();case 6:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"setVideoViewForLiveEvent",value:function(e,t){t=this._streams.get(t);t&&(t.mediaView=e)}},{key:"upsert",value:function(e){Object.assign(this,x({},e))}},{key:"teardown",value:function(){null!=(e=this.openChannel)&&e.exit();var e,t,n=j(this._streams.values());try{for(n.s();!(t=n.n()).done;)t.value.closeStream()}catch(e){n.e(e)}finally{n.f()}this._streams.clear(),this._stopToSendAlive()}},{key:"_onEvent",value:function(e){if(this.liveEventId===e.payload.liveEventId)if(e instanceof hl)this._onReady(e);else if(e instanceof dl)this._onStarted(e);else if(e instanceof fl)this._onEnded(e);else if(e instanceof pl)this._onHostEntered(e);else if(e instanceof vl)this._onHostExited(e);else if(e instanceof _l)this._onHostConnected(e);else if(e instanceof Ml)this._onHostDisconnected(e);else if(e instanceof yl)this._onHostAudioStatusChanged(e);else if(e instanceof ml)this._onHostVideoStatusChanged(e);else if(e instanceof gl)this._onParticipantEntered(e);else{if(!(e instanceof El))throw new Error("unknown event is received");this._onParticipantExited(e)}}},{key:"_onReady",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventReady",this)}},{key:"_onStarted",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventStarted",this),this._tryOpen()}},{key:"_onEnded",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventEnded",this),this.teardown()}},{key:"_onHostEntered",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostEntered",this,this.host)}},{key:"_onHostExited",value:function(e){e=e.payload.host;this.upsert({host:void 0}),this._dispatchEvent("hostExited",this,e)}},{key:"_onHostConnected",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostConnected",this,this.host),this._tryOpen()}},{key:"_onHostDisconnected",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostDisconnected",this,this.host)}},{key:"_onHostAudioStatusChanged",value:function(e){e=e.payload.host;this.upsert({host:e}),e.isAudioOn&&this._dispatchEvent("hostUnmutedAudio",this,this.host),e.isAudioOn||this._dispatchEvent("hostMutedAudio",this,this.host)}},{key:"_onHostVideoStatusChanged",value:function(e){e=e.payload.host;this.upsert({host:e}),e.isVideoOn&&this._dispatchEvent("hostStartedVideo",this,this.host),e.isVideoOn||this._dispatchEvent("hostStoppedVideo",this,this.host)}},{key:"_onParticipantEntered",value:function(e){e=e.payload.participant;this._dispatchEvent("participantEntered",this,e)}},{key:"_onParticipantExited",value:function(e){e=e.payload.participant;this._dispatchEvent("participantExited",this,e)}},{key:"_tryOpen",value:function(){var e,t;this.host&&this.host.state===D.HostState.CONNECTED&&this.state===D.LiveEventState.ONGOING&&(e=this.host.hostId,this._streams.has(e)?t=this._streams.get(e):(t=new Yv(this,this._deviceManager,this._sender),this._streams.set(e,t)),t.openStream(),t.attach(e))}},{key:"_tryClose",value:function(){}},{key:"_startToSendAlive",value:function(){var t=this;this.isActiveHost?this._aliveIntervalId=setInterval(function(){var e=xl.createHostAlive(t.liveEventId,t.host.hostId);t._sender.send(e)},3e3):this._aliveIntervalId=setInterval(function(){var e=xl.createAlive(t.liveEventId,t.currentLiveUser.participantId);t._sender.send(e)},9e4)}},{key:"_stopToSendAlive",value:function(){this._aliveIntervalId&&(clearInterval(this._aliveIntervalId),delete this._aliveIntervalId)}}]),l}(),Jv=function(){function t(e){d(this,t),this._liveEvents=[],this._ctx=e}var n,r;return f(t,[{key:"createLiveEvent",value:(r=h(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.commandRouter.send(xl.createLiveEvent(ze.SINGLE_HOST,t.userIdsForHost));case 2:return n=e.sent,n=n.payload.liveEvent,n=new Xv({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:n}),e.prev=5,e.next=8,n.fetchOpenChannel();case 8:if(t.title)return e.next=11,n.openChannel.updateChannel({name:t.title});e.next=11;break;case 11:if(t.coverImage)return e.next=14,n.openChannel.updateChannel({coverUrlOrImage:t.coverImage});e.next=14;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),o.error("failed to fetch initial open channel");case 19:return this._liveEvents.push(n),e.abrupt("return",n);case 21:case"end":return e.stop()}},e,this,[[5,16]])})),function(e){return r.apply(this,arguments)})},{key:"getLiveEvent",value:(n=h(regeneratorRuntime.mark(function e(t){var n,r,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.commandRouter.send(xl.createGetLiveEvent(t));case 2:if(n=e.sent,n=n.payload.liveEvent,-1<(r=this._liveEvents.findIndex(function(e){return e.liveEventId===t})))return(i=this._liveEvents[r]).upsert(n),e.prev=8,e.next=11,i.fetchOpenChannel();e.next=19;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),o.error("failed to fetch initial open channel");case 16:return e.abrupt("return",i);case 19:return s=new Xv({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:n}),e.prev=20,e.next=23,s.fetchOpenChannel();case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(20),o.error("failed to fetch initial open channel");case 28:return this._liveEvents.push(s),e.abrupt("return",s);case 30:case"end":return e.stop()}},e,this,[[8,13],[20,25]])})),function(e){return n.apply(this,arguments)})},{key:"clear",value:function(){this._liveEvents=[];var e,t=j(this._liveEvents);try{for(t.s();!(e=t.n()).done;)e.value.teardown()}catch(e){t.e(e)}finally{t.f()}}}]),t}(),Zv=de,$v=ve,e_=tt,t_=ke,n_=TypeError,oi=Re,r_={left:_v(!1),right:_v(!0)}.left,i=yt,ti=ls,a=(oi({target:"Array",proto:!0,forced:!lc("reduce")||!ti&&79<i&&i<83},{reduce:function(e){var t=arguments.length;return r_(this,e,t,1<t?arguments[1]:void 0)}}),Re),i_=ui.find,s=xs,St="find",s_=!0,cs=(St in[]&&Array(1)[St](function(){s_=!1}),a({target:"Array",proto:!0,forced:s_},{find:function(e){return i_(this,e,1<arguments.length?arguments[1]:void 0)}}),s(St),function(){function n(e,t){d(this,n),this.key=e,this.value=t}return f(n,[{key:"toString",value:function(){return this.key}},{key:"equals",value:function(e){return this.value.width===e.value.width&&this.value.height===e.value.height}}]),n}()),a_=(u(cs,"_720P",new cs("_720P",{width:1280,height:720})),u(cs,"_540P",new cs("_540P",{width:960,height:540})),u(cs,"_480P",new cs("_480P",{width:848,height:480})),u(cs,"_360P",new cs("_360P",{width:640,height:360})),cs._720P),o_=function(){p(i,hh);var r=_(i);function i(e,t){var n;return d(this,i),u(v(n=r.call(this)),"hasPermission",!1),n._streamManger=e,n.constraints=t,n}return f(i,[{key:"stream",get:function(){return this._streamManger.stream}},{key:"dispose",value:function(){var e;this.removeAllEventListeners(),null!=(e=this.onDisposed)&&e.call(this)}},{key:"streamChanged",value:function(e){this._dispatchEvent("streamChanged",e)}},{key:"audioOutputChanged",value:function(){this._dispatchEvent("audioOutputChanged")}}]),i}(),u_=Xe,c_=be,l_=Ce,h_=Qi,d_=ne,f_=fe,p_=_h,v_=yh;vh("match",function(r,o,u){return[function(e){var t=d_(this),n=null==e?void 0:f_(e,r);return n?u_(n,e,t):new RegExp(e)[r](h_(t))},function(e){var t=c_(this),n=h_(e),e=u(o,t,n);if(e.done)return e.value;if(!t.global)return v_(t,n);for(var r=t.unicode,i=[],s=t.lastIndex=0;null!==(a=v_(t,n));){var a=h_(a[0]);""===(i[s]=a)&&(t.lastIndex=p_(n,l_(t.lastIndex),r)),s++}return 0===s?null:i}]});function __(e,t){var n,r,i,s,a;t.audio&&0===e.getAudioTracks().length&&e.addTrack((i=y_=y_||new(window.AudioContext||window.webkitAudioContext),m_=i.createOscillator(),n=i.createMediaStreamDestination(),(r=i.createGain()).gain.setValueAtTime(0,i.currentTime),m_.connect(r).connect(n),m_.start(),b_=n.stream.getAudioTracks()[0],n.stream.getAudioTracks()[0])),t.video&&0===e.getVideoTracks().length&&e.addTrack((i=x(x({},a_.value),{},{frameRate:24}),s=i.width,a=i.height,i=i.frameRate,(g_=g_||document.createElement("canvas")).width=s,g_.height=a,g_.getContext("2d").fillRect(0,0,s,a),E_=E_||setInterval(function(){g_.getContext("2d").fillRect(0,0,s,a)},1e3),i=g_.captureStream(i),I_=i.getVideoTracks()[0],i.getVideoTracks()[0]))}var y_,m_,g_,E_,b_,I_,We=$,Vt=Ze,w_=Qi,T_=ia.trim,Je=Kn,S_=V.parseInt,mt=V.Symbol,C_=mt&&mt.iterator,k_=/^[+-]?0x/i,N_=Vt(k_.exec),Ut=8!==S_(Je+"08")||22!==S_(Je+"0x16")||C_&&!We(function(){S_(Object(C_))})?function(e,t){e=T_(w_(e));return S_(e,t>>>0||(N_(k_,e)?16:10))}:S_;Re({global:!0,forced:parseInt!=Ut},{parseInt:Ut});function A_(){b_&&b_.stop(),I_&&I_.stop(),I_=b_=null,E_&&(clearInterval(E_),E_=null),m_&&(m_.onended=function(){m_.disconnect(),m_=null},m_.stop())}function O_(e){if(e){var t,n=j(e.getTracks());try{for(n.s();!(t=n.n()).done;)t.value.stop()}catch(e){n.e(e)}finally{n.f()}}}function R_(e,t,n){return(e=e.match(t))&&e.length>=n&&parseInt(e[n],10)}var D_="safari"===function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;var t=window.navigator;if(t.mozGetUserMedia)e.browser="firefox",e.version=R_(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)e.browser="chrome",e.version=R_(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=R_(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=R_(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return e}().browser,M_=function(){function t(e){d(this,t),u(this,"_hasPermission",!1),this._deviceManager=e,this._updateQueued=!1}var e;return f(t,[{key:"updateStream",value:(e=h(regeneratorRuntime.mark(function e(){var t,n,r,i,s,a,o,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._updateAt)return this._updateQueued=!0,e.abrupt("return");e.next=3;break;case 3:if(t=this._deviceManager.mediaAccesses.some(function(e){return e.constraints.audio}),n=this._deviceManager.mediaAccesses.some(function(e){return e.constraints.video}),t||n){e.next=9;break}return O_(this.stream),A_(),e.abrupt("return");case 9:return this._updateAt=Date.now(),(r=this.stream)||(s=new MediaStream,__(s,{audio:t,video:n}),this.stream=s),D_&&O_(r),e.prev=13,e.next=16,this._deviceManager.getMediaConstraints({usingAudio:t,usingVideo:n});case 16:return s=e.sent,e.next=19,navigator.mediaDevices.getUserMedia(s);case 19:i=e.sent,this._hasPermission=!0,a=j(this._deviceManager.mediaAccesses);try{for(a.s();!(o=a.n()).done;)o.value.hasPermission=!0}catch(e){a.e(e)}finally{a.f()}A_(),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),i=new MediaStream;case 29:__(i,{audio:t,video:n}),D_||O_(r),this.stream=i,u=j(this._deviceManager.mediaAccesses);try{for(u.s();!(c=u.n()).done;)c.value.streamChanged(this.stream)}catch(e){u.e(e)}finally{u.f()}delete this._updateAt,this._updateQueued?(this._updateQueued=!1,this.updateStream()):this._deviceManager.refreshMediaDevices({audio:t,video:n},!0);case 36:case"end":return e.stop()}},e,this,[[13,26]])})),function(){return e.apply(this,arguments)})}]),t}();function x_(e,t){return(null==e?void 0:e.deviceId)===(null==t?void 0:t.deviceId)&&(null==e?void 0:e.label)===(null==t?void 0:t.label)&&(null==e?void 0:e.groupId)===(null==t?void 0:t.groupId)}var L_=function(){function t(){var e=this;d(this,t),this.mediaAccesses=[],this._availableMediaDevices={audioinput:[],audiooutput:[],videoinput:[]},this._currentMediaDevices={audioinput:void 0,audiooutput:void 0,videoinput:void 0},this._sendbirdCallListeners=new Map,this._streamManager=new M_(this),navigator.mediaDevices.ondevicechange=function(){return e._onDeviceChanged()}}var n,r,e,i;return f(t,[{key:"_onDeviceChanged",value:function(){0!==this.mediaAccesses.length&&this.refreshMediaDevices({audio:this.mediaAccesses.some(function(e){return e.constraints.audio}),video:this.mediaAccesses.some(function(e){return e.constraints.video})})}},{key:"addSendBirdCallListener",value:function(e,t){this._sendbirdCallListeners.set(e,t)}},{key:"removeSendBirdCallListener",value:function(e){this._sendbirdCallListeners.delete(e)}},{key:"removeAllSendBirdCallListener",value:function(){this._sendbirdCallListeners.clear()}},{key:"getCurrentAudioInputDevice",value:function(){return this._currentMediaDevices.audioinput}},{key:"getCurrentAudioOutputDevice",value:function(){return this._currentMediaDevices.audiooutput}},{key:"getCurrentVideoInputDevice",value:function(){return this._currentMediaDevices.videoinput}},{key:"getAvailableAudioInputDevices",value:function(){return this._availableMediaDevices.audioinput}},{key:"getAvailableAudioOutputDevices",value:function(){return this._availableMediaDevices.audiooutput}},{key:"getAvailableVideoInputDevices",value:function(){return this._availableMediaDevices.videoinput}},{key:"_updateStream",value:(i=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._streamManager.updateStream());case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_registerMediaAccess",value:function(e){var t=this;this.mediaAccesses.push(e),e.onDisposed=function(){return t.stopMedia(e)}}},{key:"useMedia",value:function(e){{if(e.audio||e.video)return e=new o_(this._streamManager,e),this._registerMediaAccess(e),this._updateStream(),e;o.error(new Error("you should set true for at least 1 media type."))}}},{key:"stopMedia",value:function(e){this.mediaAccesses.splice(this.mediaAccesses.indexOf(e),1),this._updateStream()}},{key:"fetchMediaDevices",value:(e=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.reduce(function(e,t){return e[t.kind].push(t),e},{audioinput:[],audiooutput:[],videoinput:[]}));case 4:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"getMediaConstraints",value:(r=h(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.usingAudio,r=t.usingVideo,i={audio:!1,video:!1},e.next=4,this.fetchMediaDevices();case 4:return s=e.sent,a=s.audioinput,s=s.videoinput,n&&a.length&&(a=this.getCurrentAudioInputDevice(),i.audio={deviceId:null==a?void 0:a.deviceId}),r&&s.length&&(a=this.getCurrentVideoInputDevice(),i.video=x(x({deviceId:null==a?void 0:a.deviceId},a_.value),{},{frameRate:24})),e.abrupt("return",i);case 10:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_updateCurrentMediaDevice",value:function(e,t){var n,r=this._availableMediaDevices[e],i=this._currentMediaDevices[e],s=r.find(function(e){return e.deviceId===(null==t?void 0:t.deviceId)});return s||(o.warning("Selected device is unavailable. fallback to default device."),s=(null!=(n=s)?n:0<r.length)?r[0]:null),!x_(i,this._currentMediaDevices[e]=s)}},{key:"_onAudioOutputChanged",value:function(){var e,t=j(this.mediaAccesses);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.constraints.audio&&n.audioOutputChanged()}}catch(e){t.e(e)}finally{t.f()}}},{key:"selectDevice",value:function(e,t){t.kind!==e?o.error(new Error("Tried to select invalid device of type")):this._updateCurrentMediaDevice(e,t)&&("audioinput"!==e&&"videoinput"!==e||this._updateStream(),"audiooutput"===e&&this._onAudioOutputChanged())}},{key:"_updateAvailableDevices",value:function(e,t){var n,r,i,s=this._currentMediaDevices[e];if(!!function(e,t){if(e.length===t.length){for(var n=0;n<t.length;n++)if(!x_(e[n],t[n]))return;return 1}}(this._availableMediaDevices[e],t))return!1;this._availableMediaDevices[e]=t,s=this._updateCurrentMediaDevice(e,s);var a,o=j(this._sendbirdCallListeners.values());try{for(o.s();!(a=o.n()).done;){var u=a.value,c=this._currentMediaDevices[e];switch(e){case"audioinput":null!=(n=u.onAudioInputDeviceChanged)&&n.call(u,c,t);break;case"audiooutput":null!=(r=u.onAudioOutputDeviceChanged)&&r.call(u,c,t);break;case"videoinput":null!=(i=u.onVideoInputDeviceChanged)&&i.call(u,c,t)}}}catch(e){o.e(e)}finally{o.f()}return s}},{key:"refreshMediaDevices",value:(n=h(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.audio,r=t.video,i=1<l.length&&void 0!==l[1]&&l[1],n||r){e.next=4;break}throw new Error("at least one of the audio or video must be true");case 4:return e.next=6,this.fetchMediaDevices();case 6:o=e.sent,s=o.audioinput,a=o.audiooutput,o=o.videoinput,c=u=!1,n&&(u=this._updateAvailableDevices("audioinput",s),c=this._updateAvailableDevices("audiooutput",a)),r&&(u=this._updateAvailableDevices("videoinput",o)||u),!i&&u&&this._updateStream(),c&&this._onAudioOutputChanged();case 16:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]),t}(),P_="v1.0.0-beta",U_=function(){function t(e){d(this,t),this._parse=e}return f(t,[{key:"parseToJson",value:function(e){try{return JSON.parse(e)}catch(e){return{}}}},{key:"validate",value:function(e){var t=e.cmd,n=e.request_id,e=e.call_type;return!!(n||t||e)}},{key:"parseCommand",value:function(e){return e.error?{isValid:!0,error:{requestId:e.request_id,message:e.message,code:e.code}}:{isValid:!0,command:this._parse(e)}}},{key:"parse",value:function(e){e=this.parseToJson(e);return this.validate(e)?this.parseCommand(e):{isValid:!1}}}]),t}(),q_=function(){p(r,hh);var n=_(r);function r(e){var t;return d(this,r),(t=n.call(this))._ctx=e,t._ws=null,t._retryTimer=null,t._closed=!0,t._sessionKey=null,t._requestMap=new Av(t._getTimeoutTime()),t._messageParser=new U_(t._ctx.parse),t._hostUrl=null!=(e=t._ctx.websocketHost)?e:"wss://ws-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",t._ctx.appId),t}return f(r,[{key:"connect",value:function(){var r=this;return new Promise(function(e,t){r._sessionKey||t(new Error("tried to connect to websocket server without auth")),r._ws=r._createWebSocket(),r._closed=!1,r._ws.onopen=function(){r._onOpen(),e(null)},r._ws.onmessage=function(e){var e=r._messageParser.parse(e.data),t=e.isValid,n=e.error,e=e.command;t&&(n?r._processError(n):r.processCommand(e))},r._ws.onerror=function(e){return r._onError(e)},r._ws.onclose=function(){r._onClose(),t(new Error("websocket connection failed"))}})}},{key:"_processError",value:function(e){var t=e.requestId,e=(e.code,e.message),t=this._requestMap.unregister(t);t&&t.reject(new Error(e))}},{key:"processCommand",value:function(e){this._dispatchEvent("command",e)}},{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._disconnect(),this._sessionKey=null}},{key:"_disconnect",value:function(){this._ws&&(this._closed=!0,this._removeRetryTimer(),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onerror=null,this._ws.onclose=null,this._ws.close(),this._requestMap.rejectAll(new Error("request failed due to websocket connection lost")),this._ws=null)}},{key:"isConnected",get:function(){return!!this._ws&&1===this._ws.readyState}},{key:"_onOpen",value:function(){}},{key:"_onError",value:function(e){}},{key:"_onClose",value:function(){this._startToReconnect()}},{key:"_createWebSocket",value:function(){var e="/?sbcall_session_token=".concat(encodeURIComponent(this._sessionKey),"&sbcall_client_id=").concat(encodeURIComponent(this._ctx.clientId),"&sendbird=").concat(encodeURIComponent(this._getVersion()));return new WebSocket(this._getHost()+e)}},{key:"_getVersion",value:function(){return"JS,".concat(this._getOsVersion(),",").concat(P_)}},{key:"_getHost",value:function(){return this._hostUrl}},{key:"_startToReconnect",value:function(){this._closed||this._retryTimer||(this._retryTimer=setTimeout(this._reconnect.bind(this),this._getRetryTime()))}},{key:"_reconnect",value:function(){this._removeRetryTimer(),this.connect().catch(function(){})}},{key:"_removeRetryTimer",value:function(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)}},{key:"_getTimeoutTime",value:function(){return 6e4}},{key:"_getRetryTime",value:function(){return 2e3}},{key:"_getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),r}(),F_=function(){function t(e){d(this,t),this._ctx=e,this._fetch=function(){var e;return(e=window).fetch.apply(e,arguments)},this._sessionKey=null,this._hostUrl=null!=(e=this._ctx.apiHost)?e:"https://api-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",this._ctx.appId)}var n;return f(t,[{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._sessionKey=null}},{key:"send",value:(n=h(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getApiOption){e.next=2;break}throw new Error("invalid api request ".concat(JSON.stringify(t)));case 2:if((n=t.getApiOption()).auth&&!this._sessionKey)throw new Error("tried to call private api without auth");e.next=5;break;case 5:return(i=x({"Content-Type":"application/json"},n.headers)).SendBird="JS,".concat(this._getOsVersion(),",").concat(P_),i["SBCall-Client-Id"]=this._ctx.clientId,this._sessionKey&&(i["SBCall-Session-Token"]=this._sessionKey),e.next=11,this._fetch("".concat(this._getHost()).concat(n.path),{method:n.method,body:JSON.stringify(n.body),headers:i});case 11:return r=e.sent,e.next=14,r.text();case 14:i=e.sent,s=null,e.prev=16,s=JSON.parse(i),e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(16),new Error("malformed data");case 23:if(r.ok){e.next=33;break}if(s.error)throw new Error("server error");e.next=28;break;case 28:if(500===r.status)throw new Error("internal server error");e.next=30;break;case 30:if(300<=r.status&&r.status<400)throw new Error("malformed data");e.next=32;break;case 32:throw new Error("request failed");case 33:if(e.prev=33,a=this._ctx.parseResponse(t,s))return e.abrupt("return",a);e.next=37;break;case 37:e.next=42;break;case 39:return e.prev=39,e.t1=e.catch(33),e.abrupt("return",s);case 42:return e.abrupt("return",s);case 43:case"end":return e.stop()}},e,this,[[16,20],[33,39]])})),function(e){return n.apply(this,arguments)})},{key:"_getHost",value:function(){return this._hostUrl}},{key:"_getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),t}(),j_=function(e,t){return(j_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}j_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var y=function(){return(y=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function re(e,a,o,u){return new(o=o||Promise)(function(n,t){function r(e){try{s(u.next(e))}catch(e){t(e)}}function i(e){try{s(u.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,i)}s((u=u.apply(e,a||[])).next())})}function ie(r,i){var s,a,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,a&&(o=2&t[0]?a.return:t[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,t[1])).done)return o;switch(a=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!((o=0<(o=u.trys).length&&o[o.length-1])||6!==t[0]&&2!==t[0])){u=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){u.label=t[1];break}if(6===t[0]&&u.label<o[1]){u.label=o[1],o=t;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(t);break}o[2]&&u.ops.pop(),u.trys.pop();continue}t=i.call(r,u)}catch(e){t=[6,e],a=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function se(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function H_(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function G_(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.defineProperty(B_,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(B_,"SDK_VERSION",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(B_,"SDK_MAJOR_VERSION",{get:function(){return B_.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(B_,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(B_,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0});var m,V_=B_;function B_(){}(r=m=m||{})[r.INVALID_TOKEN=400111]="INVALID_TOKEN",r[r.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",r[r.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",r[r.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",r[r.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",r[r.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",r[r.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",r[r.LOST_INSTANCE=700100]="LOST_INSTANCE",r[r.CONNECTION_RENEW=700102]="CONNECTION_RENEW",r[r.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",r[r.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",r[r.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",r[r.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",r[r.INVALID_PARAMETER=800110]="INVALID_PARAMETER",r[r.NETWORK_ERROR=800120]="NETWORK_ERROR",r[r.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",r[r.MALFORMED_DATA=800130]="MALFORMED_DATA",r[r.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",r[r.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",r[r.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",r[r.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",r[r.ACK_TIMEOUT=800180]="ACK_TIMEOUT",r[r.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",r[r.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",r[r.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",r[r.REQUEST_FAILED=800220]="REQUEST_FAILED",r[r.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",r[r.REQUEST_CANCELED=800240]="REQUEST_CANCELED",r[r.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",r[r.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",r[r.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",r[r.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",r[r.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED";function Q_(e){return!(e instanceof g&&!e.shouldThrowOutside)}function K_(e,t){return e===t||(e=y({},e),t=y({},t),!(e.hasOwnProperty("messageId")&&t.hasOwnProperty("messageId")&&e.messageId!==t.messageId||e.hasOwnProperty("reqId")&&t.hasOwnProperty("reqId")&&e.reqId!==t.reqId||(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,t.hasOwnProperty("messageId")&&delete t.messageId,t.hasOwnProperty("reqId")&&delete t.reqId,JSON.stringify(e)!==JSON.stringify(t))))}function z_(e){return 0<e&&0<=ey.indexOf(e)}function W_(e,t){if((t=void 0===t?!1:t)&&null===e)return!0;if(!(t=I("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type)){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return t}function Y_(e){var t=void 0===(t=e.encryption)?null:t,n=void 0===(n=e.store)?null:n,e=void 0===(e=e.localCacheEnabled)||e;this.nestdb=null,this.store=n,this.preference=new ay({store:n}),this.encryption=null!=t?t:sy,this.localCacheEnabled=e}function X_(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}function J_(){}function E(t){var n={};return t&&Object.keys(t).forEach(function(e){void 0!==t[e]&&NaN!==t[e]&&null!==t[e]&&(n[e]=t[e])}),n}l(w,Z_=Error),Object.defineProperty(w.prototype,"isInvalidTokenError",{get:function(){return this.code===m.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===m.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===m.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(w,"debugModeRequired",{get:function(){return new w({code:m.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"lostInstance",{get:function(){return new w({code:m.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"connectionRenew",{get:function(){return new w({code:m.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"invalidConnectionStateTransition",{get:function(){return new w({code:m.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"connectionRequired",{get:function(){return new w({code:m.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"connectionCanceled",{get:function(){return new w({code:m.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"invalidParameters",{get:function(){return new w({code:m.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"networkError",{get:function(){return new w({code:m.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"markAsReadAllRateLimitExceeded",{get:function(){return new w({code:m.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"queryInProgress",{get:function(){return new w({code:m.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"noAckTimeout",{get:function(){return new w({code:m.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"loginTimeout",{get:function(){return new w({code:m.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"connectionClosed",{get:function(){return new w({code:m.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"requestFailed",{get:function(){return new w({code:m.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"fileUploadCanceled",{get:function(){return new w({code:m.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"requestCanceled",{get:function(){return new w({code:m.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"sessionTokenRefreshFailed",{get:function(){return new w({code:m.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(w,"sessionTokenRequestFailed",{get:function(){return new w({code:m.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),w.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this};var b,Z_,g=w,$_=[m.CONNECTION_REQUIRED,m.NETWORK_ERROR,m.ACK_TIMEOUT,m.WEBSOCKET_CONNECTION_CLOSED,m.WEBSOCKET_CONNECTION_FAILED,m.FILE_UPLOAD_CANCEL_FAILED,m.REQUEST_CANCELED,m.INTERNAL_SERVER_ERROR,m.RATE_LIMIT_EXCEEDED,m.UNKNOWN_SERVER_ERROR],ey=[m.WEBSOCKET_CONNECTION_CLOSED,m.WEBSOCKET_CONNECTION_FAILED,m.CONNECTION_REQUIRED],I=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||("string"!=typeof e?"object"==typeof e?ty(e,t):t instanceof e:typeof t===e)},ty=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||Object.values(e).includes(t)},ny=function(t,e,n){return!(!(n=void 0===n?!1:n)||null!=e)||Array.isArray(e)&&e.every(function(e){return I(t,e)})},ry=(Object.defineProperty(_y.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){I("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(_y.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){I("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(_y.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){I("number",e)&&1e3<=e&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(_y.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){I("number",e)&&5e3<=e&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),_y),iy={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},sy={encrypt:function(e){return e},decrypt:function(e){return e}},ay=(vy.prototype._savePreferenceKeys=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:G_([],H_(this._preference.keys()),!1),generation:1})];case 1:return e.sent(),[2]}})})},vy.prototype.init=function(u){var c;return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return this._keysAddress=u,[4,this._store.get(u)];case 1:t=null!=(c=e.sent())?c:[],e.label=2;case 2:e.trys.push([2,7,8,9]),n=se(t),r=n.next(),e.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._store.get(i)]);case 4:(s=e.sent())&&this._preference.set(i,s),e.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return s=e.sent(),a={error:s},[3,9];case 8:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 9:return[2]}})})},vy.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,null!=(n=this._preference.get(t))?n:null]})})},vy.prototype.set=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=!this._preference.has(n),[4,this._store.set({key:n,value:r,generation:1})];case 1:return e.sent(),this._preference.set(n,r),t?[4,this._savePreferenceKeys()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},vy.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.remove(t)];case 1:return e.sent(),this._preference.delete(t),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},vy.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.removeMany(G_([],H_(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},vy),oy=(Object.defineProperty(py.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),py.prototype.clear=function(){this.authToken=null,this.sessionKey=null},py),uy=(fy.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},fy.prototype.on=function(e,t){return this._register(e,-1,t)},fy.prototype.once=function(e,t){return this._register(e,1,t)},fy.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},fy),cy=(dy.prototype.on=function(e,t){return new uy({container:this._container}).on(e,t)},dy.prototype.once=function(e,t){return new uy({container:this._container}).once(e,t)},dy.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var s=[];try{for(var a=se(i.keys()),o=a.next();!o.done;o=a.next()){var u=o.value,c=i.get(u);c.handler(t),0<c.occurence&&(c.occurence--,0===c.occurence&&s.push(u))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}s.forEach(function(e){return i.delete(e)})}},dy),ly=(hy.prototype.on=function(e){return this._dispatcher.on("event",e)},hy.prototype.once=function(e){return this._dispatcher.once("event",e)},hy.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},hy);function hy(){this._dispatcher=new cy}function dy(){this._container={}}function fy(e){e=e.container;this._container={},this._container=e,this.key=X_()}function py(){this.sessionKey=null,this.authToken=null}function vy(e){e=e.store;this._preference=new Map,this._store=e}function _y(e){var e=void 0===e?{}:e,t=e.useMemberInfoInMessage,t=void 0!==t&&t,n=e.typingIndicatorInvalidateTime,n=void 0===n?1e4:n,r=e.typingIndicatorThrottle,r=void 0===r?1e3:r,e=e.websocketResponseTimeout,e=void 0===e?1e4:e;this._useMemberInfoInMessage=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=t,this._typingIndicatorInvalidateTime=n,this._typingIndicatorThrottle=r,this._websocketResponseTimeout=e}function w(e){var t=e.code,t=void 0===t?0:t,e=e.message,e=Z_.call(this,e)||this;return e.shouldThrowOutside=!1,e.name="SendbirdError",e.code=t,Object.setPrototypeOf(e,w.prototype),e}(Et=b=b||{}).GET="GET",Et.POST="POST",Et.PUT="PUT",Et.DELETE="DELETE";l(Oy,Iy=J_),Oy.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},Object.defineProperty(Oy.prototype,"query",{get:function(){var t=this,n=E(this.params);return"?".concat(Object.keys(n).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t.stringifyParams(n[e])))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(Oy.prototype,"payload",{get:function(){var r,i=this,s=E(this.params);return Object.keys(s).some(function(e){return W_(s[e])})?(r=new FormData,Object.keys(s).forEach(function(e){var t,n=s[e];W_(n)?r.append(e,n,null!=(t=n.name)?t:"filename"):r.append(e,i.stringifyParams(n))}),r):JSON.stringify(s)},enumerable:!1,configurable:!0});var yy,my,gy,Ey,by,Iy,T=Oy,S=(l(Ay,by=J_),Object.defineProperty(Ay.prototype,"payload",{get:function(){return y({},this._payload)},enumerable:!1,configurable:!0}),Ay.prototype.as=function(e){return new e(this._iid,this.payload)},Ay),wy=(l(Ny,Ey=J_),Ny),Ty=(l(ky,gy=J_),ky),Sy=(l(Cy,my=J_),Cy);function Cy(e){var t=my.call(this)||this;return t.statLog=e,t}function ky(){return null!==gy&&gy.apply(this,arguments)||this}function Ny(e){var t=Ey.call(this)||this;return t.requestId=e,t}function Ay(e,t){var n=by.call(this)||this;return n._iid=e,n._payload=t,n}function Oy(){var e=null!==Iy&&Iy.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=X_(),e}(G=yy=yy||{}).WEBSOCKET_CONNECT="ws:connect",G.API_RESULT="api:result";function Ry(){}zy.payloadify=function(e){return E({stat_type:e.type,ts:e.createdAt,data:E(e.data)})};var Dy,My,xy,Ly,Py=zy,Uy=(Object.defineProperty(Ky.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",e=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(V_.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(e)},enumerable:!1,configurable:!0}),Ky.prototype._createHeader=function(e,t){void 0===t&&(t=null);var n=this._sdkState,r=n.appId,n=n.appVersion,n=y(y({},e.headers),{SendBird:"JS,".concat(V_.OS_VERSION,",").concat(V_.SDK_VERSION,",").concat(r).concat(n?",".concat(n):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(n["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(n["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(n["App-Id"]=r,n["Access-Token"]=this._auth.authToken),n},Ky.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new Sy(new Py({type:yy.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},Ky.prototype.send=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:r=h.path,t=h.method,i=![b.GET,b.DELETE].includes(t),n=this._sdkState.api,n="".concat(n.host).concat(r).concat(i?"":h.query),r=i?h.payload:null,i=this._createHeader(h,r instanceof FormData?r:null),a=new AbortController,s=a.signal,this._abortControl.set(h.requestId,a),a=Date.now(),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(n,{method:t,body:r,headers:i,signal:s})];case 2:return[4,(o=e.sent()).json()];case 3:if(c=e.sent(),o.ok||o.redirected)return this._logger.debug("receive api response",h.requestId),this._statLogApiResult(h,a,null),[2,new S(this._iid,c)];throw c?(u=new g(c)).isSessionKeyExpiredError&&this._dispatcher.dispatch(new Ty):u=g.requestFailed,this._statLogApiResult(h,a,u),u;case 4:throw c=e.sent(),this._statLogApiResult(h,a,c),c instanceof g?(this._logger.debug("fail api request",c),c):"AbortError"===c.name?g.requestCanceled:(l=g.networkError,this._logger.debug("fail api request",l),l);case 5:return[2]}})})},Ky.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},Ky.prototype.cancelAll=function(){var e,t;try{for(var n=se(this._abortControl.values()),r=n.next();!r.done;r=n.next())r.value.abort()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},Ky),qy=(l(Qy,Ly=J_),Qy.createFromRawMessage=function(e,t){var n=t.substring(0,4),r=null;try{r=JSON.parse(t.substring(4))}catch(e){n="NOOP"}finally{return new Qy(e,n,r)}},Qy.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},Qy.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},Qy),Fy=(l(By,xy=J_),By.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},By),jy=(l(Vy,My=Fy),Vy),Hy=(Object.defineProperty(Gy.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),Gy.prototype.ping=function(){var e,t=this,n=new jy;try{var r=null!=(e=this.sdkState.websocket.pongTimeout)?e:5e3;this._pingTimeoutTimer=setTimeout(function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)},r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n},Gy.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},Gy.prototype.refreshTimer=function(){var e=this,t=(this._logger.debug("pinger.refreshTimer()"),null!=(t=this.sdkState.websocket.pingInterval)?t:15e3);this.stop(),this._pingTimer=setInterval(function(){e.ping()},t)},Gy.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},Gy.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},Gy);function Gy(e){var t=e.pingDelegate,n=e.sdkState,e=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=e}function Vy(){return My.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}function By(e){var t=e.code,n=e.ackRequired,e=e.payload,e=void 0===e?null:e,r=this;return(r=xy.call(this)||this).code=t,r.payload=e,r.requestId=null!=(t=r.payload.req_id)?t:X_(),r.ackRequired=n,r.payload.req_id=r.requestId,r}function Qy(e,t,n,r){void 0===r&&(r="");var i=this;return(i=Ly.call(this)||this)._iid=e,i.code=t,i.payload=n,i.requestId=n?null!=(e=n.req_id)?e:r:"",i}function Ky(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,s=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on(function(e){e instanceof wy&&s.cancel(e.requestId)}),this._logger=t}function zy(e){var t=e.type,n=e.data,e=e.ts,e=void 0===e?Date.now():e;this.type=t,this.createdAt=e,this.data=n}(Un=Dy=Dy||{}).CONNECTING="CONNECTING",Un.OPEN="OPEN",Un.CLOSED="CLOSED";function Wy(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}l(rm,Jy=cy),Object.defineProperty(rm.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return Dy.CONNECTING;case 1:return Dy.OPEN}return Dy.CLOSED},enumerable:!1,configurable:!0}),rm.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach(function(e){e&&I("string",e)&&(e=qy.createFromRawMessage(t._iid,e),t._logger.debug("receive websocket event",e),"LOGI"===e.code?(e.payload&&!e.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",e)):"PONG"===e.code?t._pinger&&t._pinger.pong():"EXPR"===e.code?e.payload&&0<e.payload.expires_in&&t._dispatcher.dispatch(new Ty):"NOOP"!==e.code&&t.dispatch("message",e))})},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",g.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close")},this.lastActive=Date.now()},rm.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=Ry,this._ws.onmessage=Ry,this._ws.onerror=Ry,this._ws.onclose=function(){e.dispatch("close")},this._ws.close(),this._ws=null)},rm.prototype.send=function(e){if(!this._ws)throw g.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},rm.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e)};var Yy,Xy,Jy,Zy=rm,$y=(l(nm,Xy=J_),nm),em=(tm.prototype._sendApiRequest=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(t)];case 1:return[2,e.sent()]}})})},tm.prototype._sendWebsocketRequest=function(s){return re(this,void 0,void 0,function(){var n,r,t,i=this;return ie(this,function(e){if(n=new Wy,s.ackRequired){r=null,t=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),i._ackStateMap.has(s.requestId)&&(i._ackStateMap.delete(s.requestId),r&&(clearTimeout(r),r=null),e?(i._logger.debug("fail websocket request",e),n.reject(e)):(i._logger.debug("receive websocket ack",s.requestId),n.resolve(t)))};try{r=setTimeout(function(){return t(g.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(s.requestId,{resolve:function(e){return t(null,e)},reject:function(e){return t(e)}}),this.websocketClient.send(s)}catch(e){t(e)}}else try{this.websocketClient.send(s),n.resolve(null)}catch(e){n.reject(e)}return[2,n.promise]})})},tm.prototype.send=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t instanceof T?[4,this._sendApiRequest(t)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return t instanceof Fy?[4,this._sendWebsocketRequest(t)]:[3,4];case 4:throw g.invalidParameters}})})},tm.prototype.cancel=function(e){this.apiClient.cancel(e)},tm.prototype.cancelAll=function(){this.apiClient.cancelAll()},tm);function tm(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,s=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=t,this.apiClient=new Uy(e,{auth:n,sdkState:r,dispatcher:i,logger:t}),this.websocketClient=new Zy(e,{sdkState:r,dispatcher:i,logger:t}),this.websocketClient.on("message",function(e){var t;e.payload.unread_cnt&&s._dispatcher.dispatch(new $y(e.payload.unread_cnt)),e.requestId?s._ackStateMap.has(e.requestId)&&(t=s._ackStateMap.get(e.requestId),"EROR"!==e.code?t.resolve(e):t.reject(new g({code:e.payload.code,message:e.payload.message}))):s._dispatcher.dispatch(e)}).on("close",function(){s._ackStateMap.forEach(function(e){e.reject(g.connectionClosed)}),s._ackStateMap.clear()})}function nm(e){var t=e.all,n=e.custom_types,e=e.ts,r=Xy.call(this)||this;return r.all=t,r.customTypes=n,r.ts=e,r}function rm(e,t){var n=t.sdkState,r=t.dispatcher,t=t.logger,i=Jy.call(this)||this;return i._pinger=null,i.lastActive=0,i._iid=e,i._sdkState=n,i._dispatcher=r,i._logger=t,i._sdkState.websocket.pingerDisabled||(i._pinger=new Hy({pingDelegate:{send:function(e){return i.send(e)},error:function(e){return i.error(e)}},sdkState:i._sdkState,logger:t})),i}(e=Yy=Yy||{})[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.LOGOUT=6]="LOGOUT";function im(t){return re(void 0,void 0,void 0,function(){return ie(this,function(e){return[2,new Promise(function(e){return setTimeout(e,t)})]})})}function sm(a,o,u){return void 0===u&&(u=new qm),re(void 0,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:t=0,n=null,r=function(e){return n=null!=(e=void 0===e?null:e)?e:new Error("Halted")},i=function(){t=0},e.label=1;case 1:if(!(-1===o||t<o))return[3,9];e.label=2;case 2:return e.trys.push([2,4,,8]),[4,a(r,i)];case 3:if(s=e.sent(),n)throw n;return[2,s];case 4:if(s=e.sent(),n)return[3,6];if(++t===o)throw s;return[4,im(u.calcTimeout(t))];case 5:return e.sent(),[3,7];case 6:throw n;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})}function ae(n){re(void 0,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:if((t=e.sent())instanceof g)return t.throwOutside(),[3,3];throw t;case 3:return[2]}})})}function am(e,t){return null!==(t=void 0===t?null:t)&&Km.set(e,t),null!=(t=Km.get(e))?t:""}function om(e){this.emojiHash=(e=void 0===e?{}:e).emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[]}l(bg,Am=J_);var um,cm,lm,hm,dm,fm,pm,vm,_m,ym,mm,gm,Em,bm,Im,wm,Tm,Sm,Cm,km,Nm,Am,Om,Rm=bg,Dm=(Object.defineProperty(Eg.prototype,"isReady",{get:function(){return this._currentConnectionStateType===Yy.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(Eg.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===Yy.CONNECTING||this._currentConnectionStateType===Yy.RECONNECTING},enumerable:!1,configurable:!0}),Eg.prototype.send=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return i instanceof Fy?this.isReady?(this._logger.debug("send websocket request",i),[4,this.commandRouter.send(i)]):[3,2]:[3,4];case 1:case 5:return[2,e.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",i),t=new Wy,this._lazyCallQueue.push({command:i,deferred:t,timeout:setTimeout(function(){return r.timeout(i.requestId)},1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),g.connectionRequired;case 3:return[3,7];case 4:return i instanceof T?this._auth.hasSession?(this._logger.debug("send api request",i),[4,this.commandRouter.send(i)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",i),t=new Wy,this._lazyCallQueue.push({command:i,deferred:t,timeout:setTimeout(function(){return r.timeout(i.requestId)},1e4)}),[2,t.promise];throw n=g.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}})})},Eg.prototype.forceSend=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._logger.debug("send websocket request (forced)",t),[4,this.commandRouter.send(t)];case 1:return[2,e.sent()]}})})},Eg.prototype.timeout=function(t){this._logger.debug("timeout request",t);var e=this._lazyCallQueue.findIndex(function(e){return e.command.requestId===t});-1<e&&(this._lazyCallQueue[e].deferred.reject(g.connectionRequired),this._lazyCallQueue.splice(e,1))},Eg.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},Eg.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},Eg),Mm=(l(gg,Nm=T),gg),xm=(l(mg,km=Fy),mg),Lm=(l(yg,Cm=S),yg),Pm=(l(_g,Sm=qy),_g),Um=(l(vg,Tm=J_),vg),qm=(pg.prototype.calcTimeout=function(){return 0},pg),Fm=(fg.prototype.createRefreshWebsocketCommand=function(e){return new xm({authToken:e,expiringSession:!0})},fg.prototype._refreshSessionKey=function(a,o){return re(this,void 0,void 0,function(){var t,n,r,i,s=this;return ie(this,function(e){switch(e.label){case 0:if(this._currentConnectionStateType!==Yy.CONNECTED)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this.createRefreshWebsocketCommand(a),[4,this._requestQueue.forceSend(t)];case 2:if(t=e.sent(),r=t.as(Pm),n=r.newKey,r=r.error)throw r;return this.auth.sessionKey=null!=n?n:this.auth.sessionKey,this._logger.debug("session refreshed"),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2];case 3:if(r=e.sent(),Q_(r))throw r;return r.isSessionTokenExpiredError?(this._handleError(o),[2]):[3,4];case 4:return e.trys.push([4,6,,7]),i=new Mm({userId:this._sdkState.userId,authToken:a,expiringSession:!0}),[4,sm(function(n){return re(s,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(i)];case 1:return t=e.sent(),t=t.as(Lm).key,this.auth.sessionKey=t,[3,3];case 2:throw(t=e.sent()).isSessionTokenExpiredError&&n(g.sessionTokenRefreshFailed),t;case 3:return[2]}})})},3)];case 5:return e.sent(),this._logger.debug("session refreshed"),[3,7];case 6:return e.sent(),this._handleError(o),[2];case 7:return ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2]}})})},fg.prototype._handleError=function(e){var t=this,n=g.sessionTokenRefreshFailed;ae(function(){return re(t,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionError(n),[2]})})}),e&&e.reject(n)},fg.prototype.refresh=function(){return re(this,void 0,void 0,function(){var n,t,r,i=this;return ie(this,function(e){return this.handler?(n=new Wy,t=function(e){e?(i._logger.debug("session refreshing.."),i.auth.authToken=e,i._refreshSessionKey(e,n)):(i._logger.debug("session closed"),ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionClosed(),[2]})})}),n.resolve())},r=function(){i._dispatcher.dispatch(new Um);var t=g.sessionTokenRequestFailed;i.handler&&(ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionError(t),[2]})})}),n.reject(t))},this._logger.debug("session expired"),this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,n):ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionTokenRequired(t,r),[2]})})}),[2,n.promise]):[2]})})},fg),zt=(dg.prototype.run=function(e){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},dg.prototype.onConnect=function(e,t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},dg.prototype.onReconnect=function(e,t){return t.resetReconnectCount,re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},dg.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},dg.prototype.onLogout=function(e){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},dg),jm=(l(hg,wm=zt),hg.prototype.run=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return t=r.sdkState.userId,r.logout(),ae(function(){return re(n,void 0,void 0,function(){return ie(this,function(e){return r.connectionHandlers.forEach(function(e){e.onDisconnected(t)}),[2]})})}),[4,r.changeState(new Qm)];case 1:return e.sent(),[2]}})})},hg),Hm=(l(lg,Im=zt),lg.prototype.run=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),this._autoReconnect?[4,t.changeState(new Gm)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},lg.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new Bm({authToken:n}))];case 1:return e.sent(),[2]}})})},lg.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Gm)];case 1:return e.sent(),[2]}})})},lg.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new jm)];case 1:return e.sent(),[2]}})})},lg),Gm=(l(cg,bm=zt),cg.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},cg.prototype.run=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s=this;return ie(this,function(e){switch(e.label){case 0:t=new Wy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectStarted()}),[2]})})}),e.label=1;case 1:return e.trys.push([1,4,,9]),r=a.sdkState.websocket,n=r.reconnectMaxRetry,r=r.reconnectRetryStrategy,[4,sm(function(n,r){return re(s,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this._haltConnect=n,this._resetConnect=r,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.connect()];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof g&&t.code===m.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},n,r)];case 2:return e.sent(),[4,a.changeState(new Vm)];case 3:return e.sent(),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectSucceeded()}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return i=e.sent(),Q_(i)?[3,7]:!(i instanceof g)||i.code===m.CONNECTION_CANCELED?[3,6]:[4,a.changeState(new Hm({autoReconnect:!1}))];case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectFailed()}),this.flushCallbacks(i),[2]})})}),[3,8];case 7:throw i;case 8:return[3,9];case 9:return[2,t.promise]}})})},cg.prototype.onConnect=function(n,e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new Wy,this._resetConnect&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},cg.prototype.onReconnect=function(n,e){var e=e.resetReconnectCount,r=void 0!==e&&e;return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new Wy,this._resetConnect&&r&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},cg.prototype.onDisconnect=function(t,e){var n=e.error,r=void 0===n?null:n,n=e.autoReconnect,i=void 0===n||n;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=r?r:g.connectionCanceled),[4,t.changeState(new Hm({autoReconnect:i}))];case 1:return e.sent(),[2]}})})},cg.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(g.connectionCanceled),[4,t.changeState(new jm)];case 1:return e.sent(),[2]}})})},cg),Vm=(l(ug,Em=zt),ug.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new Gm)];case 1:return e.sent(),[2]}})})},ug.prototype.onDisconnect=function(t,e){var n=e.autoReconnect;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Hm({autoReconnect:n}))];case 1:return e.sent(),[2]}})})},ug.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new jm)];case 1:return e.sent(),[2]}})})},ug),Bm=(l(og,gm=zt),og.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},og.prototype.run=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:t=new Wy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),e.label=1;case 1:return e.trys.push([1,4,,9]),[4,sm(function(n){return re(r,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this._haltConnect=n,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i.connect(this._authToken)];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof g&&t.code===m.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},i.sdkState.websocket.connectMaxRetry)];case 2:return e.sent(),[4,i.changeState(new Vm)];case 3:return e.sent(),ae(function(){return re(r,void 0,void 0,function(){return ie(this,function(e){return i.connectionHandlers.forEach(function(e){e.onConnected(i.sdkState.userId)}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return n=e.sent(),Q_(n)?[3,7]:(i.disconnect(),!(n instanceof g)||n.code===m.CONNECTION_CANCELED?[3,6]:[4,i.changeState(new Qm)]);case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(r,void 0,void 0,function(){return ie(this,function(e){return this.flushCallbacks(n),[2]})})}),[3,8];case 7:throw n;case 8:return[3,9];case 9:return[2,t.promise]}})})},og.prototype.onConnect=function(e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new Wy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},og.prototype.onDisconnect=function(t,e){var e=e.error,n=void 0===e?null:e;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=n?n:g.connectionCanceled),[4,t.changeState(new jm)];case 1:return e.sent(),[2]}})})},og.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(g.connectionCanceled),[4,t.changeState(new jm)];case 1:return e.sent(),[2]}})})},og),Qm=(l(ag,mm=zt),ag.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Bm({authToken:n}))];case 1:return e.sent(),[2]}})})},ag),Km=new Map,qn=(sg.payloadify=function(e){return e?{}:null},sg),zm="/".concat("v3","/users"),Wm="/".concat("v3","/storage/file"),Ym="/".concat("v3","/group_channels"),Xm="/".concat("v3","/open_channels"),Jm="/".concat("v3","/sdk/open_channels"),Zm="/".concat("v3","/search"),$m="/".concat("v3","/report"),eg="/".concat("v3","/emojis"),tg="/".concat("v3","/emoji_categories"),ng="/".concat("v3","/sdk/statistics"),rg=(l(ig,ym=T),ig);function ig(e){var t=e.userId,e=e.metadata,n=ym.call(this)||this;return n.method=b.POST,n.path="".concat(zm,"/").concat(t,"/metadata"),n.params={metadata:e},n}function sg(e){this._iid="",this._iid=e}function ag(){var e=null!==mm&&mm.apply(this,arguments)||this;return e.type=Yy.INITIALIZED,e.name="initialized",e}function og(e){var e=e.authToken,t=gm.call(this)||this;return t.type=Yy.CONNECTING,t.name="connecting",t._authToken="",t._haltConnect=null,t._callbacks=[],t._authToken=e,t}function ug(){var e=null!==Em&&Em.apply(this,arguments)||this;return e.type=Yy.CONNECTED,e.name="connected",e}function cg(){var e=null!==bm&&bm.apply(this,arguments)||this;return e.type=Yy.RECONNECTING,e.name="reconnecting",e._haltConnect=null,e._resetConnect=null,e._callbacks=[],e}function lg(e){var e=e.autoReconnect,t=Im.call(this)||this;return t.type=Yy.DISCONNECTED,t.name="disconnected",t._autoReconnect=!1,t._autoReconnect=e,t}function hg(){var e=null!==wm&&wm.apply(this,arguments)||this;return e.type=Yy.LOGOUT,e.name="logout",e}function dg(){this.type=Yy.NONE,this.name="none"}function fg(e){var t=e.auth,n=e.sdkState,r=e.dispatcher,i=e.requestQueue,e=e.logger,s=this;this._currentConnectionStateType=Yy.INITIALIZED,this.auth=t,this._sdkState=n,this._dispatcher=r,this._requestQueue=i,this._logger=e,this._dispatcher.on(function(e){var t;e instanceof Rm?(t=e.stateType,s._currentConnectionStateType=t):e instanceof Ty&&s.refresh()})}function pg(){}function vg(){return null!==Tm&&Tm.apply(this,arguments)||this}function _g(e,t,n){e=Sm.call(this,e,"LOGI",n)||this;return e.error=null,e.newKey=n.new_key,e.error=n.error?new g(n.error):null,e}function yg(e,t){e=Cm.call(this,e,t)||this,t=t.key;return e.key=t,e}function mg(e){var t=e.authToken,e=e.expiringSession;return km.call(this,{code:"LOGI",payload:{token:t,expiring_session:void 0===e||e?1:0},ackRequired:!0})||this}function gg(e){var t=e.userId,n=e.authToken,e=e.expiringSession,e=void 0===e||e,r=Nm.call(this)||this;return r.path="/users/".concat(t,"/session_key"),r.method=b.POST,r.params={token:n,expiring_session:!!e},r.requireAuth=!1,r}function Eg(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,a=this;this._currentConnectionStateType=Yy.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new em(e,{auth:n,sdkState:r,dispatcher:i,logger:t}),this._auth=n,this._logger=t,this._dispatcher=i,this._dispatcher.on(function(e){if(e instanceof Rm){e=e.stateType;switch(a._currentConnectionStateType=e){case Yy.CONNECTED:var t=a._lazyCallQueue;a._lazyCallQueue=[],t.forEach(function(s){return re(a,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:t=s.command,n=s.deferred,r=s.timeout,clearTimeout(r),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.send(t)];case 2:return r=e.sent(),n.resolve(r),[3,4];case 3:return i=e.sent(),n.reject(i),[3,4];case 4:return[2]}})})});break;case Yy.INITIALIZED:case Yy.DISCONNECTED:case Yy.LOGOUT:t=a._lazyCallQueue,a._lazyCallQueue=[],t.forEach(function(r){return re(a,void 0,void 0,function(){var t,n;return ie(this,function(e){return t=r.deferred,n=r.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(g.connectionClosed):t.reject(g.connectionRequired),[2]})})})}}})}function bg(e){var e=e.stateType,t=Am.call(this)||this;return t.stateType=e,t}l(function(e,t){return(e=Om.call(this,e,t)||this).metadata=t,e},Om=S),(jn=um=um||{}).BASE="base",jn.GROUP="group",jn.OPEN="open",(et=cm=cm||{}).OPERATOR="operator",et.NONE="none",(_t=lm=lm||{}).BASE="base",_t.USER="user",_t.FILE="file",_t.ADMIN="admin",(aa=hm=hm||{}).ALL="",aa.USER="MESG",aa.FILE="FILE",aa.ADMIN="ADMM",(t=dm=dm||{}).USER="MESG",t.FILE="FILE",t.ADMIN="ADMM",(ra=fm=fm||{}).USERS="users",ra.CHANNEL="channel",(n=pm=pm||{}).ALL="all",n.NONE="none",n.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",(Yn=vm=vm||{}).DEFAULT="default",Yn.SUPPRESS="suppress",(Yt=_m=_m||{}).PENDING="pending",Yt.SCHEDULED="scheduled",Yt.SUCCEEDED="succeeded",Yt.FAILED="failed",Yt.CANCELED="canceled";function Ig(e){switch(e){case um.GROUP:return Ym;case um.OPEN:return Xm;default:return null}}function wg(e){switch(e){case um.GROUP:return"".concat($m,"/group_channels");case um.OPEN:return"".concat($m,"/open_channels");default:return null}}function Tg(e,t,n){return e=Rg(e.mentionType,e.mentionedUserIds,n),t=Rg(t.mentionType,t.mentionedUserIds,n),!e&&t?1:e&&!t?-1:0}var Sg,Cg,kg,Ng,Ag,Og,Rg=function(e,t,n){var r,i;switch(e){case fm.CHANNEL:return!0;case fm.USERS:if(t)try{for(var s=se(t),a=s.next();!a.done;a=s.next())if(a.value===n)return!0}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},Dg=(l(Hg,Ag=T),Hg),Mg=(l(jg,Ng=S),jg),xg=(l(Fg,kg=T),Fg),Lg=(l(qg,Cg=S),qg),Pg=(l(Ug,Sg=T),Ug);function Ug(e){var t=e.userId,e=e.metadataKey,n=Sg.call(this)||this;return n.method=b.DELETE,n.path="".concat(zm,"/").concat(t,"/metadata/").concat(e),n}function qg(e,t){e=Cg.call(this,e,t)||this;return e.metadata=t,e}function Fg(e){var t=e.userId,n=e.metadata,e=e.upsert,r=kg.call(this)||this;return r.method=b.PUT,r.path="".concat(zm,"/").concat(t,"/metadata"),r.params={metadata:n,upsert:e},r}function jg(e,t){e=Ng.call(this,e,t)||this;return e.metaData=null!=t?t:{},e}function Hg(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metadata;return(t=Ag.call(this)||this).method=b.POST,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:e,include_ts:!0},t}l(function(){return null!==Og&&Og.apply(this,arguments)||this},Og=S);l(Qg,Gg=T);var Gg,Vg,Bg=Qg;function Qg(e){var e=e.userId,t=Gg.call(this)||this;return t.method=b.DELETE,t.path="".concat(zm,"/").concat(e,"/metadata"),t}l(function(){return null!==Vg&&Vg.apply(this,arguments)||this},Vg=S);function Kg(e,t){return void 0===t&&(t=null),(e=JSON.parse(JSON.stringify(e)))._iid&&delete e._iid,t&&t(e),e}function zg(e,t){return void 0===t&&(t=null),e=JSON.parse(JSON.stringify(e)),t&&t(e),e}function C(t){return{do:function(e){t||e()},throw:function(e){if(!t)throw e}}}var Wg;(tt=Wg=Wg||{}).ONLINE="online",tt.OFFLINE="offline",tt.NON_AVAILABLE="nonavailable";l(_E,tE=qn),_E.payloadify=function(e){return e?E(y(y({},tE.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null},Object.defineProperty(_E.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(am(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),_E.prototype.serialize=function(){return Kg(this)},_E.prototype._isValidMetaData=function(t){return!Array.isArray(t)&&0<Object.keys(t).length&&Object.keys(t).map(function(e){return t[e]}).every(function(e){return I("string",e)})},_E.prototype._applyMetaData=function(t,n){var r=this;void 0===n&&(n=!1),Object.keys(t).forEach(function(e){n?delete r.metaData[e]:r.metaData[e]=t[e]})},_E.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(this._isValidMetaData(r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new rg({userId:n.userId,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Mg).metaData,this._applyMetaData(n),[2,this.metaData]}})})},_E.prototype.updateMetaData=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(this._isValidMetaData(r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new xg({userId:n.userId,metadata:r,upsert:i}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Lg).metadata,this._applyMetaData(n),[2,this.metaData]}})})},_E.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)).throw(g.invalidParameters),n=N.of(this._iid),t=n.sdkState,n=n.requestQueue,t=new Pg({userId:t.userId,metadataKey:r}),[4,n.send(t)];case 1:return e.sent(),this._applyMetaData(((n={})[r]=!0,n),!0),[2,this.metaData]}})})},_E.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Bg({userId:n.userId}),[4,t.send(n)];case 1:return e.sent(),this.metaData={},[2]}})})};var Yg,Xg,Jg,Zg,$g,eE,tE,k=_E,nE=(l(vE,eE=J_),vE),rE=(pE.payloadify=function(e){return y(y({},k.payloadify(e.user)),{emoji_hash:e.appInfo.emojiHash,file_upload_size_limit:e.appInfo.uploadSizeLimit,application_attributes:e.appInfo.applicationAttributes,premium_feature_list:e.appInfo.premiumFeatureList,login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},pE.prototype.apply=function(){var t=this.reconnectInterval,n=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,e=N.of(this._iid);e.sdkState.websocket.pingInterval=1e3*this.pingInterval,e.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,e.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,e.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(e){return 0<e?1e3*Math.min(t*Math.pow(r,e-1),n):10}},e.appInfo=this.appInfo,e.sessionManager.currentUser=this.user,e.connectedAt=this.connectedAt,this.firstConnectedAt||(e.firstConnectedAt=this.connectedAt),e.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,e.concurrentCallLimit=this.concurrentCallLimit,e.backOffDelay=this.backOffDelay,e.dispatcher.dispatch(new nE({userProfile:this}))},pE),iE=(l(fE,$g=qy),fE.asError=function(e){return new fE(null,"LOGI",y({user_id:null,error:!0},e))},fE.prototype.applyTo=function(e){if(this.error)throw this.error;var t=N.of(e);if(!t)throw g.lostInstance;t.sessionManager.auth.sessionKey=this.key,am(e,this.ekey),this.userProfile.apply()},fE),sE=(l(dE,Zg=J_),dE),aE=(l(hE,Jg=cy),Object.defineProperty(hE.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),hE.prototype.changeState=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._currentState=t,this._dispatcher.dispatch(new Rm({stateType:t.type})),this._logger.debug("connection state changes to ".concat(t.name)),[4,this._currentState.run(this)];case 1:return e.sent(),[2]}})})},hE.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,i=t.userId,t=t.extensions,s=this._sessionManager.auth,a=t.sb_syncmanager?"s".concat(t.sb_syncmanager):"",t=t.sb_uikit?"u".concat(t.sb_uikit):"",a="JS/c".concat(V_.SDK_VERSION,"/").concat(a,"/").concat(t);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(V_.OS_VERSION),"&sv=").concat(encodeURIComponent(V_.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(s.hasSession?"&key=".concat(encodeURIComponent(s.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(a,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=1")},hE.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new sE(e))},hE.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new Sy(new Py({type:yy.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},hE.prototype.connect=function(i){return void 0===i&&(i=""),re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){return t=this._url(i),n=new Wy,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){r._loginTimer=null,r._dispatcher.dispatch(iE.asError(g.loginTimeout))},this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]})})},hE.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(iE.asError(g.connectionRenew))},hE.prototype.disconnect=function(){this._websocketClient.disconnect()},hE.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()},hE),oE=(Object.defineProperty(lE.prototype,"isConnected",{get:function(){return this._context.currentState.type===Yy.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(lE.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===Yy.CONNECTING||e.type===Yy.RECONNECTING},enumerable:!1,configurable:!0}),lE.prototype.connect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onConnect(this._context,t)];case 1:return e.sent(),[2]}})})},lE.prototype.reconnect=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},lE.prototype.resetAndReconnect=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},lE.prototype.background=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}})})},lE.prototype.disconnect=function(t){return void 0===t&&(t=null),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:t,autoReconnect:!0})];case 1:return e.sent(),[2]}})})},lE.prototype.logout=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}})})},lE),uE=(l(cE,Xg=T),cE);function cE(e){var t=e.deviceId,e=e.statLogs,n=Xg.call(this)||this;return n.method=b.POST,n.path="".concat(ng),n.params={device_id:t,log_entries:e.map(function(e){return Py.payloadify(e)})},n}function lE(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.disableAutoReconnect,t=void 0!==t&&t,u=this;this._context=null,this._logger=o,this._context=new aE(e,{sdkState:n,connectionHandlers:r,sessionManager:i,websocketClient:s,dispatcher:a,logger:o}),t||s.on("close",function(){"foreground"===n.appState&&setTimeout(function(){u._logger.debug("try reconnect by websocket connection closed"),u.reconnect()},100)})}function hE(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.entryState,t=void 0===t?new Qm:t,u=Jg.call(this)||this;return u._currentState=null,u._loginTimer=null,u._connectingAt=0,u._connectionRequestQueue=[],u._iid=e,u.sdkState=n,u.connectionHandlers=r,u._sessionManager=i,u._websocketClient=s,u._dispatcher=a,u._logger=o,u._currentState=t,u._websocketClient.on("message",function(e){var t;"LOGI"===e.code&&(u._loginTimer&&(clearTimeout(u._loginTimer),u._loginTimer=null),(t=e.as(iE)).error?(t.error.isSessionKeyExpiredError&&u._dispatcher.dispatch(new Ty),u._connectionRequestQueue.forEach(function(e){return e.reject(t.error)}),u._statLogConnection(t.error)):(t.applyTo(u._iid),u._connectionRequestQueue.forEach(function(e){return e.resolve()}),e=t.userProfile,u._enableStatLog(e.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),u._statLogConnection(null)),u._connectionRequestQueue=[])}).on("close",function(){0<u._connectionRequestQueue.length&&(u._connectionRequestQueue.forEach(function(e){return e.reject(g.networkError)}),u._connectionRequestQueue=[],u._statLogConnection(g.networkError))}),u}function dE(e){var t=Zg.call(this)||this;return t.enabled=e,t}function fE(e,t,n){var r=this;return(r=$g.call(this,e,t,n)||this).error=null,r.userProfile=new rE(e,n),r.key=n.key,r.ekey=null!=(t=n.ekey)?t:"",r.error=n.error?new g(n):null,r}function pE(e,t){this._iid=e,this.appInfo=new om(t),this.user=new k(e,t),this.connectedAt=1e3*(null!=(e=t.login_ts)?e:0),this.firstConnectedAt=0,this.pingInterval=null!=(e=t.ping_interval)?e:15e3,this.pongTimeout=null!=(e=t.pong_timeout)?e:5e3,this.reconnectInterval=null!=(e=null==(e=t.reconnect)?void 0:e.interval)?e:3e3,this.reconnectMaxInterval=null!=(e=null==(e=t.reconnect)?void 0:e.max_interval)?e:6e4,this.reconnectRetryCount=null!=(e=null==(e=t.reconnect)?void 0:e.retry_cnt)?e:5,this.reconnectIntervalMultiple=null!=(e=null==(e=t.reconnect)?void 0:e.mul)?e:2,this.maxUnreadCountOnSuperGroup=null!=(e=t.max_unread_cnt_on_super_group)?e:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!=(e=t.concurrent_call_limit)?e:5,this.backOffDelay=null!=(e=t.back_off_delay)?e:100}function vE(e){var e=e.userProfile,t=eE.call(this)||this;return t.userProfile=e,t}function _E(e,t){var n=this;return(n=tE.call(this,e)||this).userId=null!=(e=null!=(e=t.guest_id)?e:t.user_id)?e:"",n.nickname=null!=(e=null!=(e=t.nickname)?e:t.name)?e:"",n.plainProfileUrl=null!=(e=null!=(e=t.profile_url)?e:t.image)?e:"",n.requireAuth=null!=(e=t.require_auth_for_profile_image)&&e,n.metaData=null!=(e=t.metadata)?e:{},n.connectionStatus=Wg.NON_AVAILABLE,ty(Wg,t.is_online)?n.connectionStatus=t.is_online:I("boolean",t.is_online)&&(n.connectionStatus=t.is_online?Wg.ONLINE:Wg.OFFLINE),n.isActive=null==(e=t.is_active)||e,n.lastSeenAt=null!=(e=t.last_seen_at)?e:null,n.preferredLanguages=t.preferred_languages?G_([],H_(t.preferred_languages),!1):null,n.friendDiscoveryKey=null!=(e=t.friend_discovery_key)?e:null,n.friendName=null!=(e=t.friend_name)?e:null,n}(yt=Yg=Yg||{})[yt.PENDING=0]="PENDING",yt[yt.ENABLED=1]="ENABLED",yt[yt.DISABLED=2]="DISABLED";Object.defineProperty(gE.prototype,"isEnabled",{get:function(){return this.enabledstate===Yg.ENABLED},enumerable:!1,configurable:!0}),gE.prototype._save=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map(function(e){return Py.payloadify(e)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},gE.prototype._flush=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(!this.isEnabled)return[3,7];if(this.isFlushing)return[3,7];this.isFlushing=!0,e.label=1;case 1:return e.trys.push([1,5,6,7]),0<(t=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length?(n=new uE({deviceId:this.deviceId,statLogs:t}),[4,this.requestQueue.send(n)]):[3,4];case 2:return e.sent(),this.queue=this.queue.slice(t.length),[4,this._save()];case 3:e.sent(),e.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return e.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return[2]}})})},gE.prototype.init=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.key=r,this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.get(this.key)]:[3,4];case 1:return(t=e.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map(function(e){return new Py({type:e.stat_type,ts:e.ts,data:e.data})}),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,108e5<=Date.now()-this.lastFlushedAt&&this.queue.length>=this.minLimit?(t=Math.min(Math.floor(18e4*Math.random()),100),[4,im(t)]):[3,4]):[3,4];case 2:return e.sent(),[4,this._flush()];case 3:e.sent(),e.label=4;case 4:return this.dispatcher.on(function(e){var t;e instanceof Sy?(t=e.statLog,n.put(t)):e instanceof sE&&(n.enabledstate=e.enabled?Yg.ENABLED:Yg.DISABLED,n.isEnabled?n.queue.length>=n.limit&&n._flush():n.clear())}),[2]}})})},gE.prototype.put=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.enabledstate===Yg.DISABLED?[3,3]:(this.queue.push(t),[4,this._save()]);case 1:return e.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},gE.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})};var yE,mE=gE;function gE(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,i=e.baseLimit,i=void 0===i?100:i,s=e.maxLimit,s=void 0===s?1e3:s,e=e.minLimit,e=void 0===e?10:e;this.queue=[],this.enabledstate=Yg.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=X_(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=i,this.limit=i,this.maxLimit=s,this.minLimit=e}(ls=yE=yE||{})[ls.NONE=0]="NONE",ls[ls.VERBOSE=1]="VERBOSE",ls[ls.DEBUG=2]="DEBUG",ls[ls.INFO=3]="INFO",ls[ls.WARN=4]="WARN",ls[ls.ERROR=5]="ERROR";xE.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yE.VERBOSE&&console.log.apply(console,G_(["[verbose]"],H_(e),!1))},xE.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yE.DEBUG&&console.log.apply(console,G_(["[debug]"],H_(e),!1))},xE.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yE.INFO&&console.log.apply(console,G_(["[info]"],H_(e),!1))},xE.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yE.WARN&&console.warn.apply(console,G_(["[warn]"],H_(e),!1))},xE.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yE.ERROR&&console.error.apply(console,G_(["[error]"],H_(e),!1))};var EE,bE,IE,wE,TE=xE,SE={},N=(ME.of=function(e){if(SE[e])return SE[e];throw g.lostInstance},ME),oi=(DE.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,t=(t.onlineDetector,t.cacheContext),t=void 0===t?null:t;this._iid=e,this._cacheContext=t,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=s,this._logger=a},DE),CE=(l(RE,wE=T),RE),kE=(l(OE,IE=S),OE),NE=(l(AE,bE=qn),AE.payloadify=function(e){return e?E(y(y({},bE.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(e){return k.payloadify(e)}):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null},AE);function AE(e,t){var n=this;return(n=bE.call(this,e)||this).replyCount=0,n.mostRepliedUsers=null,n.lastRepliedAt=0,n.updatedAt=0,n.replyCount=null!=(e=t.reply_count)?e:0,n.mostRepliedUsers=t.hasOwnProperty("most_replies")&&ny("object",t.most_replies)?t.most_replies.map(function(e){return new k(n._iid,e)}):[],n.lastRepliedAt=null!=(e=t.last_replied_at)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,n}function OE(e,t){var n=this;return(n=IE.call(this,e,t)||this).url=t.url,n.fileSize=null!=(e=t.file_size)?e:0,n.thumbnailSizes=null!=(e=t.thumbnails)?e:[],n.requireAuth=null!=(e=t.require_auth)&&e,n}function RE(e){var t=wE.call(this)||this;if(t.method=b.POST,t.path="".concat(Wm),t.params=E({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var n=0;n<e.thumbnailSizes.length;n++){var r=e.thumbnailSizes[n],i=r.maxWidth,r=r.maxHeight;t.params["thumbnail".concat(n+1)]="".concat(i,",").concat(r)}return t.requestId=e.requestId,t}function DE(){}function ME(e,t){var n,r,i,s;return this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,SE[e]||(SE[e]=this,n=null!=(n=t.options)?n:new ry,r=this.sdkState={appId:t.appId,appVersion:null!=(r=t.appVersion)?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!=(r=t.apiHost)?r:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!=(r=t.websocketHost)?r:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new qm,responseTimeout:n.websocketResponseTimeout}},this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0},i=this.logger=new TE,this.logger.level=null!=(s=t.logLevel)?s:yE.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new Y_({encryption:t.encryption,store:t.store,localCacheEnabled:null!=(s=t.localCacheEnabled)&&s}),this.debugMode=null!=(s=t.debugMode)&&s,this.maxSuperGroupChannelUnreadCount=V_.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=n.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=n.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=n.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null,t=this.dispatcher=new ly,s=new oy,this.requestQueue=new Dm(e,{auth:s,sdkState:r,dispatcher:t,logger:i}),this.sessionManager=new Fm({auth:s,sdkState:r,dispatcher:t,requestQueue:this.requestQueue,logger:i}),this.connectionManager=new oE(e,{sdkState:r,connectionHandlers:this.connectionHandlers,dispatcher:t,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,logger:i}),this.statLogCollector=new mE({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:t})),SE[e]}function xE(){this.level=yE.WARN}(ti=EE=EE||{}).ADD="add",ti.DELETE="delete";function LE(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=I("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,e=e.updated_at;t&&I("string",n)&&I("string",r)&&ty(EE,r)&&I("string",i)&&i&&I("number",e)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=e)}Object.defineProperty(KE.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),KE.payloadify=function(e){return e?E({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},KE.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case EE.ADD:t<0&&this.userIds.push(e.userId);break;case EE.DELETE:0<=t&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}};var PE,UE=KE,qE=(QE.payloadify=function(e){return e?E({key:e.key,value:null!=(e=e.value)?e:[]}):null},QE),FE=(BE.payloadify=function(e){var t;return e?E({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!=(t=e.width)?t:0,height:null!=(t=e.height)?t:0,alt:e.alt}):null},BE),jE=(VE.payloadify=function(e){return e?E({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?FE.payloadify(e.defaultImage):null}):null},VE),HE=(GE.payloadify=function(e){return e?E({name:e.name,volume:e.volume}):null},GE);function GE(e){var t;this.name=null,this.volume=0,this.name=null!=(t=e.name)?t:"default",this.volume=null!=(t=e.volume)?t:1}function VE(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new FE(e["og:image"]))}function BE(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}function QE(e){this.key=e.key,this.value=ny("string",e.value)?G_([],H_(e.value),!1):[]}function KE(e){var t,n,r=e.key,i=null!=(i=G_([],H_(e.user_ids),!1))?i:[],s=e.updated_at,a=(I("string",r)&&r&&ny("string",i)&&0<i.length&&I("number",s)&&(this.key=r,this.userIds=i,this.updatedAt=s),{});try{for(var o=se(this.userIds),u=o.next();!u.done;u=o.next())a[u.value]=this.updatedAt}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._version=a}(i=PE=PE||{}).PENDING="pending",i.IN_QUEUE="in_queue",i.SENT="sent",i.FAILED="failed",i.CANCELED="canceled",i.REMOVED="removed";function zE(e){return I("number",e.prevResultSize)&&I("number",e.nextResultSize)&&I("boolean",e.isInclusive)&&I("boolean",e.reverse)&&I("string",e.messageTypeFilter)&&ty(hm,e.messageTypeFilter)&&ny("string",e.customTypesFilter,!0)&&ny("string",e.senderUserIdsFilter,!0)&&I("boolean",e.includeMetaArray)&&I("boolean",e.includeReactions)&&I("boolean",e.includeParentMessageInfo)}l(R0,i0=qn),R0.payloadify=function(e){var t;return e?E(y(y({},i0.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:function(e){switch(e){case lm.BASE:return"";case lm.USER:return"MESG";case lm.FILE:return"FILE";case lm.ADMIN:return"ADMM"}}(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null==(t=e.mentionedUsers)?void 0:t.map(function(e){return k.payloadify(e)}),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?NE.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(e){return UE.payloadify(e)}),sorted_metaarray:null==(t=e.metaArrays)?void 0:t.map(function(e){return qE.payloadify(e)}),og_tag:jE.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:HE.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null==(t=e.scheduledInfo)?void 0:t.scheduledMessageId,scheduled_at:null==(t=e.scheduledInfo)?void 0:t.scheduledAt,scheduled_status:e._scheduledStatus})):null},R0.prototype.isIdentical=function(e){return this.messageId===e.messageId},R0.prototype.isEqual=function(e){return K_(this,e)},R0.prototype.isUserMessage=function(){return this.messageType===lm.USER},R0.prototype.isFileMessage=function(){return this.messageType===lm.FILE},R0.prototype.isAdminMessage=function(){return this.messageType===lm.ADMIN},R0.prototype.serialize=function(){return Kg(this)},R0.prototype.getMetaArraysByKeys=function(t){return this.metaArrays.filter(function(e){return t.includes(e.key)})},R0.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},R0.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new UE(UE.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},R0.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1};var WE,YE,XE,JE,ZE,$E,e0,t0,n0,r0,i0,s0=R0,a0=(l(O0,r0=k),O0.payloadify=function(e){return e?E(y(y({},r0.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null},O0),o0=(l(A0,n0=s0),A0.payloadify=function(e){return e?E(y(y({},n0.payloadify.call(this,e)),{user:a0.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null},Object.defineProperty(A0.prototype,"isResendable",{get:function(){return this.sendingStatus===_m.FAILED&&0<(e=this.errorCode)&&0<=$_.indexOf(e);var e},enumerable:!1,configurable:!0}),A0.prototype.isIdentical=function(e){return 0<this.messageId&&0<e.messageId?this.messageId===e.messageId:this.reqId===e.reqId},A0),u0=(N0.payloadify=function(e){return e?E({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(N0.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),N0),c0={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:hm.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},l0=(l(k0,t0=s0),k0.payloadify=function(e){return e?E(y(y({},t0.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:f0(e.parentMessage)})):null},k0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=y(y({},c0),n),C(0<this.messageId&&I("number",t)&&zE(n)).throw(g.invalidParameters),[4,fb.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},k0),h0=(C0.payloadify=function(e){return e?E({type:e.type,vendor:e.vendor,detail:e.detail}):null},C0),d0=(l(S0,e0=o0),S0.payloadify=function(e){return e?E(y(y({},e0.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(e){return h0.payloadify(e)}),parent_message_info:f0(e.parentMessage)})):null},S0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=y(y({},c0),n),C(0<this.messageId&&I("number",t)&&zE(n)).throw(g.invalidParameters),[4,fb.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},S0),f0=function(e){if(e)switch(e.messageType){case lm.USER:return d0.payloadify(e);case lm.FILE:return v0.payloadify(e);case lm.ADMIN:return l0.payloadify(e)}return null},p0=function(e,t){switch(t.type){case"MESG":return new d0(e,t);case"FILE":return new v0(e,t);case"ADMM":case"BRDM":return new l0(e,t)}return null},v0=(l(T0,$E=o0),T0.payloadify=function(e){return e?E(y(y({},$E.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map(function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:f0(e.parentMessage)})):null},Object.defineProperty(T0.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(am(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),T0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=y(y({},c0),n),C(0<this.messageId&&I("number",t)&&zE(n)).throw(g.invalidParameters),[4,fb.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},T0),_0=(l(w0,ZE=Fy),w0),y0=(l(I0,JE=T),I0),m0=(l(b0,XE=qy),b0),g0=(l(E0,YE=S),E0);function E0(e,t){var n,r=this,e=((r=YE.call(this,e,t)||this).message=new v0(e,t),N.of(e).sdkState);return r.isMentioned=Rg(r.message.mentionType,null!=(n=r.message.mentionedUserIds)?n:r.message.mentionedUsers.map(function(e){return e.userId}),e.userId),r.forceUpdateLastMessage=null!=(n=t.force_update_last_message)&&n,r}function b0(e,t,n){var r,i=this,e=((i=XE.call(this,e,"FILE",n)||this).message=new v0(e,n),N.of(e).sdkState);return i.isMentioned=Rg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function I0(e){var t=this,t=JE.call(this)||this,n=[];return e.mentionType===fm.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),t.method=b.POST,t.path="".concat(Ig(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),t.params=E({message_type:lm.FILE,user_id:e.userId,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:n,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes.map(function(e){return u0.payloadify(e)}),require_auth:e.requireAuth,sorted_metaarray:null==(n=e.metaArrays)?void 0:n.map(function(e){return qE.payloadify(e)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:HE.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,req_id:e.reqId}),t}function w0(e){var t,n=[];return e.mentionType===fm.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),ZE.call(this,{code:"FILE",ackRequired:!0,payload:E({channel_url:e.channelUrl,url:e.url,name:null!=(t=e.fileName)?t:"",type:null!=(t=e.mimeType)?t:"",size:null!=(t=e.fileSize)?t:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==vm.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function T0(e,t){var n,r=this,i=((r=$E.call(this,e,t)||this).messageParams=null,r.plainUrl="",r.requireAuth=!1,r.name=null,r.size=0,r.type=null,r.thumbnails=[],r.messageSurvivalSeconds=-1,r.messageType=lm.FILE,null!=(i=t.file)?i:null);return r.plainUrl=(null!=(n=null!=(n=null==i?void 0:i.url)?n:t.url)?n:"").split("?auth=")[0],r.name=null!=(n=null!=(n=null==i?void 0:i.name)?n:t.name)?n:"File",r.size=null!=(n=null!=(n=null==i?void 0:i.size)?n:t.size)?n:0,r.data=null!=(n=null!=(n=null==i?void 0:i.data)?n:t.custom)?n:"",r.type=i?null!=(n=i.type)?n:"":null!=(i=t.type)?i:"",r.requireAuth=null!=(n=t.require_auth)&&n,r.thumbnails=t.thumbnails?t.thumbnails.map(function(e){return new u0(y(y({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(r.requireAuth?"?auth=".concat(am(r._iid)):"")}))}):[],r.messageSurvivalSeconds=null!=(i=t.message_survival_seconds)?i:-1,t.parent_message_info&&(n=t.parent_message_info,i=y(y({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(i=n.file)?void 0:i.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=p0(e,i)),r}function S0(e,t){var n,r,i,s=this;if((s=e0.call(this,e,t)||this).message="",s.messageParams=null,s.translations={},s.translationTargetLanguages=[],s.messageSurvivalSeconds=-1,s.plugins=[],s.message=t.message,s.messageType=lm.USER,s.translations=null!=(r=t.translations)?r:{},s.translationTargetLanguages=null!=(r=t.target_langs)?r:[],s.translations==={}&&0<s.translationTargetLanguages.length)try{for(var a=se(s.translationTargetLanguages),o=a.next();!o.done;o=a.next()){var u=o.value;s.translations[u]=""}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s.messageSurvivalSeconds=null!=(r=t.message_survival_seconds)?r:-1,s.plugins=t.plugins?t.plugins.map(function(e){return new h0(e)}):[],t.parent_message_info&&(i=t.parent_message_info,t=y(y({},i),{created_at:i.ts,message_id:s.parentMessageId,channel_url:s.channelUrl,channel_type:s.channelType,file:i.file,url:null==(n=i.file)?void 0:n.url,require_auth:null==(r=i.file)?void 0:r.require_auth}),s.parentMessage=p0(e,E(t))),s}function C0(e){var t;this.type=null,this.vendor=null,this.detail={},this.type=null!=(t=e.type)?t:"",this.vendor=null!=(t=e.vendor)?t:"",e.hasOwnProperty("detail")&&I("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}function k0(e,t){var n,r=this;return(r=t0.call(this,e,t)||this).message=null,r.translations={},r.message=null!=(n=t.message)?n:"",r.messageType=lm.ADMIN,r.translations=null!=(n=t.translations)?n:{},t.parent_message_info&&(n=t.parent_message_info,n=y(y({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(t=n.file)?void 0:t.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=p0(e,n)),r}function N0(e){var t;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!=(t=e.real_width)?t:e.width,this.realHeight=null!=(t=e.real_height)?t:e.height}function A0(e,t){var n=this;if((n=n0.call(this,e,t)||this).sender=null,n.reqId="",n.replyToChannel=!1,n.sendingStatus=null,n.errorCode=0,n.sender=t.user?new a0(n._iid,t.user):t.sender_id,n.reqId=null!=(e=null!=(e=t.req_id)?e:t.request_id)?e:"",n.replyToChannel=null!=(e=t.is_reply_to_channel)&&e,t.request_state&&ty(_m,t.request_state)&&(n.sendingStatus=t.request_state),!n.sendingStatus)if(0<n.messageId)n.sendingStatus=_m.SUCCEEDED;else if(n.scheduledInfo)switch(n._scheduledStatus=t.scheduled_status,t.scheduled_status){case PE.SENT:case PE.IN_QUEUE:n.sendingStatus=_m.SUCCEEDED;break;case PE.PENDING:n.sendingStatus=_m.SCHEDULED;break;case PE.FAILED:case PE.REMOVED:n.sendingStatus=_m.FAILED;break;case PE.CANCELED:n.sendingStatus=_m.CANCELED}else n.sendingStatus=_m.PENDING;return n.errorCode=null!=(e=t.error_code)?e:0,n}function O0(e,t){e=r0.call(this,e,t)||this;return e.role=null,e.isBlockedByMe=!1,e.role=ty(cm,t.role)?t.role:cm.NONE,t.hasOwnProperty("is_blocked_by_me")&&(e.isBlockedByMe=t.is_blocked_by_me),e}function R0(e,t){var n=this,e=((n=i0.call(this,e)||this).channelUrl=null,n.channelType=um.BASE,n.messageId=0,n.parentMessageId=null,n.parentMessage=null,n.silent=!1,n.isOperatorMessage=!1,n.messageType=lm.BASE,n.data=null,n.customType=null,n.mentionType=null,n.mentionedUsers=[],n.mentionedUserIds=[],n.mentionedMessageTemplate=null,n.threadInfo=null,n.reactions=[],n.metaArrays=[],n.ogMetaData=null,n.appleCriticalAlertOptions=null,n.createdAt=0,n.updatedAt=0,n.scheduledInfo=null,n._scheduledStatus=null,n.messageId=null!=(e=null!=(e=t.msg_id)?e:t.message_id)?e:0,n.channelUrl=t.channel_url,n.channelType=ty(um,t.channel_type)?t.channel_type:um.GROUP,t.channel&&(t.channel.channel_url&&(n.channelUrl=t.channel.channel_url),t.channel.channel_type&&(n.channelType=t.channel.channel_type)),n.parentMessageId=null!=(e="string"==typeof t.parent_message_id?parseInt(t.parent_message_id):t.parent_message_id)?e:0,n.data=null!=(e=t.data)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.mentionType=ty(fm,t.mention_type)?t.mention_type:null,t.mentioned_users),e=(n.mentionedUsers=e?e.map(function(e){return new k(n._iid,e)}):null,t.mentioned_user_ids);n.mentionedUserIds=null!=e?e:null,n.mentionedMessageTemplate=null!=(e=t.mentioned_message_template)?e:"",n.threadInfo=t.thread_info?new NE(n._iid,t.thread_info):null,n.reactions=t.reactions?t.reactions.map(function(e){return new UE(e)}):[];for(var r=null!=(e=t.metaarray)?e:{},i=null!=(e=t.metaarray_key_order)?e:Object.keys(r).sort(function(e,t){return e.localeCompare(t)}),s=0;s<i.length;s++){var a=i[s];n.metaArrays.push(new qE({key:a,value:r[a]||[]}))}return t.sorted_metaarray&&(n.metaArrays=t.sorted_metaarray.map(function(e){return new qE(e)})),n.ogMetaData=t.og_tag?new jE(t.og_tag):null,n.silent=null!=(e=t.silent)&&e,n.isOperatorMessage=null!=(e=t.is_op_msg)&&e,n.appleCriticalAlertOptions=t.apple_critical_alert_options?new HE(t.apple_critical_alert_options):null,n.createdAt=null!=(e=null!=(e=t.created_at)?e:t.ts)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,"number"==typeof t.scheduled_message_id&&"number"==typeof t.scheduled_at&&t.scheduled_status&&(n.scheduledInfo={scheduledMessageId:t.scheduled_message_id,scheduledAt:t.scheduled_at},n._scheduledStatus=t.scheduled_status),n}(ui=WE=WE||{})[ui.PENDING=0]="PENDING",ui[ui.UPLOADING=1]="UPLOADING",ui[ui.UPLOADED=2]="UPLOADED",ui[ui.SENDING=3]="SENDING",ui[ui.FAILED=4]="FAILED";function D0(e){return ty(pm,e.replyType)&&I("boolean",e.includeReactions)&&I("boolean",e.includeMetaArray)&&I("boolean",e.includeParentMessageInfo)&&I("boolean",e.includeThreadInfo)&&I("boolean",e.includePollDetails)}Object.defineProperty(U0.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===Yy.CONNECTED||this._connectionState===Yy.CONNECTING||this._connectionState===Yy.RECONNECTING},enumerable:!1,configurable:!0}),U0.prototype._sendFileMessage=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this._shouldSendThroughWebSocket?(t=new _0(y(y({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)]):[3,2];case 1:return[2,e.sent().as(m0).message];case 2:return t=new y0(y(y({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,userId:this._sdkState.userId,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)];case 3:return[2,e.sent().as(g0).message]}})})},U0.prototype._resolveMessageQueue=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:if(!(t=this._queueMap.get(h.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,e.label=1;case 1:e.trys.push([1,15,16,17]),i=se(t.messageQueue),s=i.next(),e.label=2;case 2:if(s.done)return[3,14];switch((a=s.value).state){case WE.PENDING:case WE.UPLOADING:return[3,3];case WE.UPLOADED:return[3,4];case WE.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(a),[3,13];case 4:if(!r)return[3,10];e.label=5;case 5:return e.trys.push([5,8,,9]),a.state=WE.SENDING,[4,this._sendFileMessage(h,a)];case 6:return o=e.sent(),a.deferred.resolve(o),[4,im(100)];case 7:return e.sent(),[3,9];case 8:return o=e.sent(),a.deferred.reject(o),[3,9];case 9:return[3,11];case 10:n.push(a),e.label=11;case 11:return[3,13];case 12:return a.deferred.reject(a.error.code===m.REQUEST_CANCELED?g.fileUploadCanceled:a.error),[3,13];case 13:return s=i.next(),[3,2];case 14:return[3,17];case 15:return c=e.sent(),c={error:c},[3,17];case 16:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 17:return u=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,u?[4,this._resolveMessageQueue(h)]:[3,19];case 18:e.sent(),e.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,e.label=21;case 21:return[2]}})})},U0.prototype._uploadNextPendingItem=function(c){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=this._queueMap.get(c.url),(n=t.messageQueue.find(function(e){return e.state===WE.PENDING}))?W_(n.params.file)?t.uploadQueue.length<6?(n.state=WE.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!e.sent())return[3,8];e.label=2;case 2:return e.trys.push([2,4,5,7]),r=new CE({file:n.params.file,channelUrl:c.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return r=e.sent(),a=r.as(kE),o=a.url,i=a.fileSize,i=void 0===i?n.params.fileSize:i,s=a.thumbnailSizes,s=void 0===s?n.params.thumbnailSizes:s,a=a.requireAuth,a=void 0!==a&&a,n.params.fileUrl=o,n.params.fileSize=i,n.params.thumbnailSizes=s,n.params.requireAuth=a,n.requireAuth=a,n.state=WE.UPLOADED,[3,7];case 4:return o=e.sent(),n.state=WE.FAILED,n.error=o,[3,7];case 5:return 0<=(u=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(u,1),this._uploadNextPendingItem(c)),[4,this._resolveMessageQueue(c)];case 6:return e.sent(),[7];case 7:return[3,10];case 8:return n.state=WE.FAILED,n.error=g.connectionRequired,0<=(u=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(u,1),this._uploadNextPendingItem(c)),[4,this._resolveMessageQueue(c)];case 9:e.sent(),e.label=10;case 10:return[3,13];case 11:return n.params.thumbnailSizes=[],n.state=WE.UPLOADED,[4,this._resolveMessageQueue(c)];case 12:e.sent(),e.label=13;case 13:return[2]}})})},U0.prototype.request=function(n,r,i){var s;return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new Wy,W_(i.file)&&(i.fileName=null!=(s=i.fileName)?s:i.file.name,i.mimeType=null!=(s=i.mimeType)?s:i.file.type,i.fileSize=null!=(s=i.fileSize)?s:i.file.size),this._queueMap.has(n.url)||this._queueMap.set(n.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(n.url).messageQueue.push({requestId:r,params:i,state:WE.PENDING,deferred:t,requireAuth:i.requireAuth}),this._uploadNextPendingItem(n),[2,t.promise]})})},U0.prototype.cancel=function(e,t){void 0===t&&(t=null);var n,r,i=this._queueMap.get(e.url);if(i){i=t?[i.messageQueue.find(function(e){return e.requestId===t})]:G_([],H_(i.messageQueue),!1);try{for(var s=se(i),a=s.next();!a.done;a=s.next()){var o=a.value;if(o)switch(o.state){case WE.PENDING:o.state=WE.FAILED,o.error=g.requestCanceled,this._resolveMessageQueue(e);break;case WE.UPLOADING:this._requestQueue.cancel(o.requestId)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}};var M0,x0=U0,L0={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:hm.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:pm.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},P0={replyType:pm.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includePollDetails:!1};function U0(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,t=t.cacheContext,a=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=t,this._dispatcher=r,this._dispatcher.on(function(e){e instanceof Rm&&(a._connectionState=e.stateType)}),this._onlineDetector=s}(a=M0=M0||{}).UNKNOWN="UNKNOWN",a.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",a.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",a.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",a.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",a.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",a.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",a.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",a.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",a.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",a.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",a.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",a.REQUEST_MESSAGE="REQUEST_MESSAGE",a.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",a.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",a.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",a.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",a.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",a.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",a.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",a.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",a.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",a.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";l(Q0,j0=J_);var q0,F0,j0,H0,G0=Q0,V0=(l(B0,F0=J_),B0);function B0(e){var t=e.messageIds,e=e.source,n=F0.call(this)||this;return n.messageIds=t,n.source=e,n}function Q0(e){var t=e.messages,e=e.source,n=j0.call(this)||this;return n.messages=t,n.source=e,n}function K0(e){var t=e.reqId,e=e.source,n=H0.call(this)||this;return n.reqId=t,n.source=e,n}l(K0,H0=J_);l(Db,rb=T);var z0,W0,Y0,X0,J0,Z0,$0,eb,tb,nb,rb,ib=Db,sb=(l(Rb,nb=S),Rb),ab=(l(Ob,tb=T),Ob),ob=(l(Ab,eb=S),Ab),ub=(l(Nb,$0=T),Nb),cb=(l(kb,Z0=S),kb),lb=(l(Cb,J0=T),Cb),hb=(l(Sb,X0=S),Sb),db={},fb=(Tb.of=function(e){return db[e]},Tb.prototype.buildMessageFromSerializedData=function(e){var t=zg(e);switch(t.messageType){case lm.USER:return new d0(this._iid,d0.payloadify(t));case lm.FILE:return new v0(this._iid,v0.payloadify(t));case lm.ADMIN:return new l0(this._iid,l0.payloadify(t))}return null},Tb.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return E({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations)})},Tb.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return E({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),fileType:e.fileType,requireAuth:t.requireAuth})},Tb.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return y(y({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},Tb.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return y(y({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},Tb.prototype.buildSenderFromSerializedData=function(e){e=zg(e);return new a0(this._iid,a0.payloadify(e))},Tb.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=new ib(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(sb).message]}})})},Tb.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=new lb(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(hb).message]}})})},Tb.prototype.getMessagesByTimestamp=function(r,i,s,a,o){return void 0===o&&(o=M0.REQUEST_MESSAGE),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=new ab(y(y({channelType:i,channelUrl:r,timestamp:s},L0),a)),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(ob).messages,this._dispatcher.dispatch(new G0({messages:n,source:o})),[2,n]}})})},Tb.prototype.getThreadedMessagesByTimestamp=function(i,s,a,o){return void 0===o&&(o=M0.REQUEST_THREADED_MESSAGE),re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=new ab(y(y(y({channelUrl:i.channelUrl,channelType:i.channelType,timestamp:s},c0),a),{replyType:pm.ALL,parentMessageId:i.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(ob).messages,(r=n.slice(1)).forEach(function(e){e.parentMessage=i}),this._dispatcher.dispatch(new G0({messages:r,source:o})),[2,{parentMessage:n[0],threadedMessages:r}]}})})},Tb.prototype.getMessageChangelogs=function(a,o,u,c,l){return void 0===l&&(l=M0.REQUEST_MESSAGE_CHANGELOGS),re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return t=new ub(E(y(y({channelType:o,channelUrl:a,timestamp:"number"==typeof u?u:null,token:"string"==typeof u?u:null},P0),c))),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),i=t.as(cb),n=i.updatedMessages,s=i.deletedMessagesInfo,r=i.hasMore,i=i.nextToken,s=s.map(function(e){return e.messageId}),0<n.length&&this._dispatcher.dispatch(new G0({messages:n,source:l})),0<s.length&&this._dispatcher.dispatch(new V0({messageIds:s,source:l})),[2,{updatedMessages:n,deletedMessageIds:s,hasMore:r,token:i}]}})})},Tb),pb=(wb.prototype._trigger=function(e,t){switch(t.sendingStatus){case _m.PENDING:this._onPending(t);break;case _m.FAILED:case _m.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);break;case _m.SCHEDULED:case _m.SUCCEEDED:this._onSucceeded(t)}},wb.prototype.onPending=function(e){return this._onPending=e,this},wb.prototype.onFailed=function(e){return this._onFailed=e,this},wb.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},wb),vb=(l(Ib,Y0=qn),Ib),_b={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,includePollDetails:!1},s=(Object.defineProperty(bb.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(bb.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),bb.prototype._validate=function(){return I("number",this.limit)&&0<this.limit},bb),yb=(l(Eb,W0=T),Eb),mb=(l(gb,z0=S),gb);function gb(t,e){var n=z0.call(this,t,e)||this;return n.messages=e.results.map(function(e){return p0(t,e)}),n.hasNext=e.has_next,n.nextToken=e.end_cursor,n}function Eb(e){var t=e.channelCustomType,n=e.keyword,r=e.limit,i=e.reverse,s=e.exactMatch,a=e.channelUrl,o=e.order,u=e.messageTimestampFrom,c=e.messageTimestampTo,l=e.advancedQuery,h=e.targetFields,e=e.nextToken,d=W0.call(this)||this;return d.method=b.GET,d.path="".concat(Zm,"/messages"),d.params={custom_type:t,query:n,limit:r,reverse:i,exact_match:s,channel_url:a,message_ts_from:u,message_ts_to:c,sort_field:o,advanced_query:l,target_fields:h,after:e},d}function bb(e,t){this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!=(e=t.limit)?e:20}function Ib(e,t){var n=Y0.call(this,e)||this,r=(n.threadInfo=null,n.targetMessageId=0,n.channelUrl=null,n.channelType=null,t.thread_info),i=t.root_message_id,s=t.channel_url,t=t.channel_type;return r&&I("object",r)&&I("number",i)&&I("string",s)&&I("string",t)&&(n.threadInfo=new NE(e,r),n.targetMessageId=i,n.channelUrl=s,n.channelType=t),n}function wb(){this._onPending=Ry,this._onFailed=Ry,this._onSucceeded=Ry}function Tb(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,t=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._onlineDetector=s,this._cacheContext=t,this.fileMessageQueue=new x0(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:t}),db[e]=this}function Sb(e,t){var n=X0.call(this,e,t)||this;return n.message=t?p0(e,y({},t)):null,n}function Cb(e){var t=e.channelUrl,e=e.scheduledMessageId,n=J0.call(this)||this;return n.method=b.GET,n.path="".concat(Ym,"/").concat(encodeURIComponent(t),"/scheduled_messages/").concat(encodeURIComponent(e)),n.params={},n}function kb(t,e){var n=Z0.call(this,t,e)||this;return n.updatedMessages=e.updated.map(function(e){return p0(t,e)}),n.deletedMessagesInfo=e.deleted.map(function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}}),n.hasMore=e.has_more,n.nextToken=e.next,n}function Nb(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,i=e.token,s=e.replyType,a=e.includeMetaArray,o=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,e=e.includePollDetails,l=$0.call(this)||this;return l.method=b.GET,l.path="".concat(Ig(t),"/").concat(encodeURIComponent(n),"/messages/changelogs"),l.params={change_ts:r,token:i,with_sorted_meta_array:a,include_reactions:o,include_thread_info:u,include_reply_type:s,include_parent_message_info:c,include_poll_details:e},l}function Ab(t,e){var n=eb.call(this,t,e)||this;return n.messages=e.messages.map(function(e){return p0(t,e)}),n}function Ob(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,r=void 0===r?null:r,i=e.token,i=void 0===i?null:i,s=e.prevResultSize,a=e.nextResultSize,o=e.isInclusive,u=e.reverse,c=e.messageTypeFilter,l=e.customTypesFilter,h=e.senderUserIdsFilter,d=e.replyType,f=e.includeMetaArray,p=e.includeReactions,v=e.parentMessageId,_=e.includeThreadInfo,y=e.includeParentMessageInfo,m=e.showSubchannelMessagesOnly,e=e.includePollDetails,g=tb.call(this)||this;return g.method=b.GET,g.path="".concat(Ig(t),"/").concat(encodeURIComponent(n),"/messages"),g.params=E({is_sdk:!0,prev_limit:s,next_limit:a,include:o,reverse:u,message_ts:r,message_id:i,message_type:null!=c?c:null,custom_types:l,sender_ids:h,include_reply_type:d,with_sorted_meta_array:f,include_reactions:p,parent_message_id:v,include_thread_info:_,include_parent_message_info:y,show_subchannel_message_only:m,include_poll_details:e}),g}function Rb(e,t){var n=nb.call(this,e,t)||this;return n.message=t?p0(e,y({},t)):null,n}function Db(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,i=e.includeMetaArray,s=e.includeReactions,a=e.includeThreadInfo,o=e.includeParentMessageInfo,e=e.includePollDetails,u=rb.call(this)||this;return u.method=b.GET,u.path="".concat(Ig(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r)),u.params={is_sdk:!0,with_sorted_meta_array:i,include_reactions:s,include_thread_info:a,include_parent_message_info:o,include_poll_details:e},u}(St=q0=q0||{}).SCORE="score",St.TIMESTAMP="ts";l(Bb,Pb=s),Bb.prototype._validate=function(){return Pb.prototype._validate.call(this)&&I("string",this.keyword)&&0<this.keyword.length&&I("boolean",this.reverse)&&I("boolean",this.exactMatch)&&I("string",this.channelUrl)&&I("string",this.channelCustomType)&&(I("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(I("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&ty(q0,this.order)&&I("boolean",this.advancedQuery)&&ny("string",this.targetFields,!0)},Bb.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new yb(y(y({},this),{nextToken:this._nextToken||null})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(mb),r=n.messages,i=n.hasNext,s=n.nextToken,this._nextToken=s,this._hasNext=i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})};var Mb,xb,Lb,Pb,Ub=Bb,cs=(l(Vb,Lb=s),Vb.prototype._validate=function(){return Lb.prototype._validate.call(this)&&I("string",this.channelUrl)&&ty(um,this.channelType)},Vb),qb=(l(Gb,xb=cs),Gb.prototype._validate=function(){return xb.prototype._validate.call(this)&&I("boolean",this.reverse)&&ty(hm,this.messageTypeFilter)&&ty(pm,this.replyType)&&ny("string",this.customTypesFilter,!0)&&ny("string",this.senderUserIdsFilter,!0)&&I("boolean",this.includeMetaArray)&&I("boolean",this.includeReactions)&&I("boolean",this.includeParentMessageInfo)&&I("boolean",this.includeThreadInfo)&&I("boolean",this.showSubchannelMessagesOnly)},Gb.prototype.load=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,fb.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return t=e.sent(),this._edge=Math.min.apply(Math,G_([Number.MAX_SAFE_INTEGER],H_(t.map(function(e){return e.createdAt})),!1)),this._hasNext=t.length>=this.limit,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})},Gb),Fb={channelUrl:null,scheduledMessageId:0},jb=(l(Hb,Mb=oi),Hb.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;Mb.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new fb(e,{sdkState:n,dispatcher:r,requestQueue:s,onlineDetector:o,cacheContext:t})},Hb.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},Hb.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},Hb.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){return n=y(y({},_b),n),C(I("string",(t=n).channelUrl)&&I("string",t.channelType)&&ty(um,t.channelType)&&I("number",t.messageId)&&I("boolean",t.includeMetaArray)&&I("boolean",t.includeParentMessageInfo)&&I("boolean",t.includeThreadInfo)&&I("boolean",t.includePollDetails)).throw(g.invalidParameters),[2,this._manager.getMessage(n)];var t})})},Hb.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){return n=y(y({},Fb),n),C(I("string",(t=n).channelUrl)&&I("number",t.scheduledMessageId)).throw(g.invalidParameters),[2,this._manager.getScheduledMessage(n)];var t})})},Hb);function Hb(){var e=null!==Mb&&Mb.apply(this,arguments)||this;return e.name="message",e}function Gb(e,t,n,r){var i=this;return(i=xb.call(this,e,t,n,r)||this).reverse=!1,i.messageTypeFilter=hm.ALL,i.customTypesFilter=null,i.senderUserIdsFilter=null,i.replyType=pm.NONE,i.includeMetaArray=!1,i.includeReactions=!1,i.includeParentMessageInfo=!1,i.includeThreadInfo=!1,i.showSubchannelMessagesOnly=!1,i._edge=Number.MAX_SAFE_INTEGER,i.reverse=null!=(e=r.reverse)&&e,i.messageTypeFilter=null!=(t=r.messageTypeFilter)?t:hm.ALL,i.customTypesFilter=null!=(n=r.customTypesFilter)?n:null,i.senderUserIdsFilter=null!=(e=r.senderUserIdsFilter)?e:null,i.replyType=null!=(t=r.replyType)?t:pm.NONE,i.includeMetaArray=null!=(n=r.includeMetaArray)&&n,i.includeReactions=null!=(e=r.includeReactions)&&e,i.includeParentMessageInfo=null!=(t=r.includeParentMessageInfo)&&t,i.includeThreadInfo=null!=(n=r.includeThreadInfo)&&n,i.showSubchannelMessagesOnly=null!=(e=r.showSubchannelMessagesOnly)&&e,i}function Vb(e,t,n,r){e=Lb.call(this,e,r)||this;return e.channelUrl=t,e.channelType=n,e}function Bb(e,t){var n=this;return(n=Pb.call(this,e,t)||this).keyword="",n.reverse=!1,n.exactMatch=!1,n.channelUrl="",n.channelCustomType="",n.messageTimestampFrom=null,n.messageTimestampTo=null,n.order=q0.SCORE,n.advancedQuery=!1,n.targetFields=null,n._nextToken="",n.keyword=t.keyword,n.reverse=null!=(e=t.reverse)&&e,n.exactMatch=null!=(e=t.exactMatch)&&e,n.channelUrl=null!=(e=t.channelUrl)?e:"",n.channelCustomType=null!=(e=t.channelCustomType)?e:"",n.messageTimestampFrom=null!=(e=t.messageTimestampFrom)?e:null,n.messageTimestampTo=null!=(e=t.messageTimestampTo)?e:null,n.order=null!=(e=t.order)?e:q0.SCORE,n.advancedQuery=null!=(e=t.advancedQuery)&&e,n.targetFields=null!=(e=t.targetFields)?e:null,n}function Qb(e){return I("string",e.data,!0)&&I("string",e.customType,!0)&&ty(fm,e.mentionType)&&ny("string",e.mentionedUserIds,!0)&&ny(k,e.mentionedUsers,!0)&&I("string",e.mentionedMessageTemplate,!0)&&ny(qE,e.metaArrays,!0)&&I("number",e.parentMessageId,!0)&&I("boolean",e.isReplyToChannel)&&ty(vm,e.pushNotificationDeliveryOption,!0)&&I(HE,e.appleCriticalAlertOptions,!0)}function Kb(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}var zb,Xe={data:null,customType:null,mentionType:fm.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},Wb=y(y({},Xe),{message:null,translationTargetLanguages:null});(ia=zb=zb||{}).FILE="file",ia.BLOB="blob",ia.BLOB_LIKE_OBJECT="blobLikeObject",ia.URL="url";function Yb(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob}function Xb(e){return e===zb.BLOB||e===zb.FILE}function Jb(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}function Zb(e){return Qb(e)&&(W_(e.file)||I("string",e.fileUrl))&&I("string",e.fileName,!0)&&I("string",e.mimeType,!0)&&I("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every(function(e){return I("object",e)&&0<e.maxWidth&&0<e.maxHeight}))}var $b,eI=y(y({},Xe),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1});(Kn=$b=$b||{}).MUTED="muted",Kn.BANNED="banned";function tI(e){return I("string",e.data,!0)&&I("string",e.customType,!0)&&ty(fm,e.mentionType)&&ny("string",e.mentionedUserIds,!0)&&ny(k,e.mentionedUsers,!0)&&I("string",e.mentionedMessageTemplate,!0)&&ny(qE,e.metaArrays,!0)&&ty(vm,e.pushNotificationDeliveryOption,!0)&&I(HE,e.appleCriticalAlertOptions,!0)}PI.payloadify=function(e){return e?E({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null};var nI,rI,iI,sI,aI,oI,uI,cI,lI,hI,dI,fI=PI,pI=(l(LI,dI=k),LI.payloadify=function(e){return e?E(y(y({},dI.payloadify.call(this,e)),fI.payloadify(e.restrictionInfo))):null},LI),V={data:null,customType:null,mentionType:fm.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},vI=y(y({},V),{message:null,translationTargetLanguages:null}),_I=y({},V),yI=(l(xI,hI=T),xI),mI=(l(MI,lI=S),MI),gI=(l(DI,cI=cs),DI.prototype._validate=function(){return cI.prototype._validate.call(this)},DI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:(t=[],this._hasNext?(this._isLoading=!0,n=N.of(this._iid).requestQueue,r=new yI(y(y({},this),{channelUrl:this.channelUrl,token:this._token})),[4,n.send(r)]):[3,2]):[3,5];case 1:return n=e.sent(),r=n.as(mI),i=r.operators,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,t];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})},DI),EI=(l(RI,uI=T),RI),bI=(l(OI,oI=S),OI),II=(l(AI,aI=cs),AI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new EI(y(y({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(bI),r=n.mutedUsers,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})},AI),wI=(l(NI,sI=T),NI),TI=(l(kI,iI=S),kI),SI=(l(CI,rI=cs),CI.prototype._validate=function(){return rI.prototype._validate.call(this)},CI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new wI(y(y({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(TI),r=n.bannedUsers,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})},CI);function CI(e,t,n,r){return rI.call(this,e,t,n,r)||this}function kI(t,e){var n=iI.call(this,t,e)||this,r=(n.token=null,n.bannedUsers=[],e.next),e=e.banned_list;return n.token=r,e&&0<e.length&&(n.bannedUsers=e.map(function(e){return new pI(t,e.user)})),n}function NI(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.limit,e=e.token;return(t=sI.call(this)||this).method=b.GET,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=E({limit:i,token:e}),t}function AI(e,t,n,r){return aI.call(this,e,t,n,r)||this}function OI(t,e){var n=oI.call(this,t,e)||this,r=(n.token=null,n.mutedUsers=[],e.next),e=e.muted_list;return n.token=r,e&&0<e.length&&(n.mutedUsers=e.map(function(e){return new pI(t,e)})),n}function RI(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.limit,e=e.token;return(t=uI.call(this)||this).method=b.GET,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={limit:i,token:e},t}function DI(e,t,n,r){return cI.call(this,e,t,n,r)||this}function MI(t,e){var n=lI.call(this,t,e)||this;return n.operators=e.operators.map(function(e){return new k(t,e)}),n.token=e.next,n}function xI(e){var t=e.channelUrl,n=e.channelType,r=e.token,e=e.limit,i=hI.call(this)||this;return i.method=b.GET,i.path="".concat(Ig(n),"/").concat(encodeURIComponent(t),"/operators"),i.params={token:r,limit:e},i}function LI(e,t){e=dI.call(this,e,t)||this;return e.restrictionInfo=null,e.restrictionInfo=new fI(t),e}function PI(e){var t;this.restrictionType=null,this.description=null,this.endAt=-1,ty($b,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!=(t=e.description)?t:null,this.endAt=null!=(t=null!=(t=e.end_at)?t:e.muted_end_at)?t:-1}(mt=nI=nI||{}).SPAM="spam",mt.HARASSING="harassing",mt.SUSPICIOUS="suspicious",mt.INAPPROPRIATE="inappropriate";l(jI,UI=T);var UI,qI,FI=jI;function jI(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=UI.call(this)||this).method=b.POST,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}l(function(){return null!==qI&&qI.apply(this,arguments)||this},qI=S);l(BI,HI=T);var HI,GI,VI=BI;function BI(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=HI.call(this)||this).method=b.DELETE,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}l(function(e,t){return GI.call(this,e,t)||this},GI=S);l(Ww,cw=T);var QI,KI,zI,WI,YI,XI,JI,ZI,$I,ew,tw,nw,rw,iw,sw,aw,ow,uw,cw,lw,hw=Ww,dw=(l(zw,uw=S),zw),fw=(l(Kw,ow=T),Kw),pw=(l(Qw,aw=S),Qw),vw=(l(Bw,sw=T),Bw),_w=(l(Vw,iw=S),Vw),yw=(l(Gw,rw=qy),Gw),mw=(l(Hw,nw=T),Hw),gw=(l(jw,tw=S),jw),Ew=(l(Fw,ew=T),Fw),bw=(l(qw,$I=S),qw),Iw=(l(Uw,ZI=T),Uw),ww=(l(Pw,JI=S),Pw),Tw=(l(Lw,XI=T),Lw),Sw=(l(xw,YI=S),xw),Cw=(l(Mw,WI=T),Mw),kw=(l(Dw,zI=S),Dw),Nw=(l(Rw,KI=qy),Rw),Aw=(l(Ow,QI=T),Ow);function Ow(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=QI.call(this)||this).method=b.DELETE,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/metacounter/").concat(e),t.params=null,t}function Rw(e,t,n){e=KI.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function Dw(e,t){e=zI.call(this,e,t)||this;return e.metaCounter=t,e}function Mw(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.metaCounter,s=e.upsert,s=void 0!==s&&s,e=e.mode,e=void 0===e?"set":e;return(t=WI.call(this)||this).method=b.PUT,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:i,upsert:s,mode:e},t}function xw(e,t){e=YI.call(this,e,t)||this;return e.metaCounter=t,e}function Lw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metaCounter;return(t=XI.call(this)||this).method=b.POST,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:e},t}function Pw(e,t){e=JI.call(this,e,t)||this;return e.metaCounter=t,e}function Uw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=ZI.call(this)||this).method=b.GET,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={keys:e},t}function qw(e,t){e=$I.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function Fw(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=ew.call(this)||this).method=b.PUT,t.path="".concat(Ig(e),"/").concat(encodeURIComponent(n),"/metadata"),t.params={include_ts:!0},t}function jw(e,t){e=tw.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function Hw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=nw.call(this)||this).method=b.DELETE,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/metadata/").concat(e),t.params={include_ts:!0},t}function Gw(e,t,n){e=rw.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function Vw(e,t){var e=iw.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function Bw(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.metadata,e=e.upsert;return(t=sw.call(this)||this).method=b.PUT,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:i,include_ts:!0,upsert:null!=e&&e},t}function Qw(e,t){var e=aw.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function Kw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=ow.call(this)||this).method=b.GET,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={keys:e,include_ts:!0},t}function zw(e,t){var e=uw.call(this,e,t)||this,n=(e.isMuted=!1,e.startAt=null,e.endAt=null,e.remainingDuration=null,e.description=null,t.is_muted),r=t.start_at,i=t.end_at,s=t.remaining_duration,t=t.description;return e.isMuted=n,e.startAt=r,e.endAt=i,e.remainingDuration=s,e.description=t,e}function Ww(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=cw.call(this)||this).method=b.GET,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/mute/").concat(e),t}l(function(e,t){return lw.call(this,e,t)||this},lw=S);l(Zw,Yw=T);var Yw,Xw,Jw=Zw;function Zw(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=Yw.call(this)||this).method=b.DELETE,t.path="".concat(Ig(e),"/").concat(encodeURIComponent(n),"/metacounter"),t.params=null,t}l(function(){return null!==Xw&&Xw.apply(this,arguments)||this},Xw=S);l(nT,$w=T);var $w,eT,tT=nT;function nT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.userId,s=e.seconds,e=e.description;return(t=$w.call(this)||this).method=b.POST,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={user_id:i,seconds:s,description:e},t}l(function(e,t){return eT.call(this,e,t)||this},eT=S);l(cT,iT=qy);var rT,iT,sT,aT=cT,oT=(l(uT,rT=T),uT);function uT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=rT.call(this)||this).method=b.DELETE,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/mute/").concat(encodeURIComponent(e)),t}function cT(e,t,n){var r=iT.call(this,e,"SYEV",n)||this;return r.user=new pI(e,n.data),r}l(function(){return null!==sT&&sT.apply(this,arguments)||this},sT=S);l(_T,hT=qy);var lT,hT,dT,fT=_T,pT=(l(vT,lT=T),vT);function vT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.userId,s=e.seconds,e=e.description;return(t=lT.call(this)||this).method=b.POST,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=E({user_id:i,seconds:s,description:e}),t}function _T(e,t,n){var r=hT.call(this,e,"SYEV",n)||this;return r.user=new pI(e,n.data),r}l(function(){return null!==dT&&dT.apply(this,arguments)||this},dT=S);l(wT,mT=qy);var yT,mT,gT,ET=wT,bT=(l(IT,yT=T),IT);function IT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=yT.call(this)||this).method=b.DELETE,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/ban/").concat(encodeURIComponent(e)),t}function wT(e,t,n){var r=mT.call(this,e,"SYEV",n)||this;return r.memberCount=null,r.joinedMemberCount=null,r.user=new pI(e,n.data),n.data.member_count&&(r.memberCount=n.data.member_count),n.data.joined_member_count&&(r.joinedMemberCount=n.data.joined_member_count),r}l(function(){return null!==gT&&gT.apply(this,arguments)||this},gT=S);l(OT,ST=qy);var TT,ST,CT,kT=OT,NT=(l(AT,TT=T),AT);function AT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.freezing;return(t=TT.call(this)||this).method=b.PUT,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(n),"/freeze"),t.params={freeze:e},t}function OT(e,t,n){var r=ST.call(this,e,"SYEV",n)||this;return r.user=new pI(e,n.data),r}l(function(){return null!==CT&&CT.apply(this,arguments)||this},CT=S);l(lS,HT=qy);var RT,DT,MT,xT,LT,PT,UT,qT,FT,jT,HT,GT,VT=lS,BT=(l(cS,jT=T),cS),QT=(l(uS,FT=T),uS),KT=(l(oS,qT=T),oS),zT=(l(aS,UT=Fy),aS),WT=(l(sS,PT=qy),sS),YT=(l(iS,LT=Fy),iS),XT=(l(rS,xT=qy),rS),JT=(l(nS,MT=Fy),nS),ZT=(l(tS,DT=qy),tS),$T=(l(eS,RT=T),eS);function eS(e){var t=RT.call(this)||this;return t.method=b.DELETE,t.path="".concat(Ig(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),t}function tS(e,t,n){var r,i=this,e=((i=DT.call(this,e,"FEDI",n)||this).message=new v0(e,n),N.of(e).sdkState);return i.mentionCountChange=Tg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function nS(e){var t=[];return e.mentionType===fm.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),MT.call(this,{code:"FEDI",ackRequired:!0,payload:E({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function rS(e,t,n){var r,i=this,e=((i=xT.call(this,e,"MEDI",n)||this).message=new d0(e,n),N.of(e).sdkState);return i.mentionCountChange=Tg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function iS(e){var t=[];return e.mentionType===fm.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),LT.call(this,{code:"MEDI",ackRequired:!0,payload:E({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function sS(e,t,n){var r,i=this,e=((i=PT.call(this,e,"MESG",n)||this).message=new d0(e,n),N.of(e).sdkState);return i.isMentioned=Rg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function aS(e){var t=[];return e.mentionType===fm.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),UT.call(this,{code:"MESG",ackRequired:!0,payload:E({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==vm.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function oS(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,a=e.offendingUserId,o=e.messageId,e=e.description;return(t=qT.call(this)||this).method=b.POST,t.path="".concat(wg(r),"/").concat(encodeURIComponent(n),"/messages/").concat(o),t.params={report_category:i,reporting_user_id:s,report_description:e,offending_user_id:a},t}function uS(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,a=e.offendingUserId,e=e.description;return(t=FT.call(this)||this).method=b.POST,t.path="/report/users/".concat(a),t.params={channel_url:n,channel_type:r===um.OPEN?"open_channels":"group_channels",report_category:i,reporting_user_id:s,report_description:e},t}function cS(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,e=e.description;return(t=jT.call(this)||this).method=b.POST,t.path="".concat(wg(r),"/").concat(encodeURIComponent(n)),t.params={report_category:i,reporting_user_id:s,report_description:e},t}function lS(e,t,n){e=HT.call(this,e,"SYEV",n)||this;return e.freeze=n.data.freeze,e}l(function(){return null!==GT&&GT.apply(this,arguments)||this},GT=S);l(YS,IS=qy);var hS,dS,fS,pS,vS,_S,yS,mS,gS,ES,bS,IS,wS,TS,SS,CS,kS=YS,NS=(l(WS,bS=T),WS),AS=(l(zS,ES=S),zS),OS=(l(KS,gS=T),KS),RS=(l(QS,mS=S),QS),DS=(l(BS,yS=T),BS),MS=(l(VS,_S=S),VS),xS=(l(GS,vS=T),GS),LS=(l(HS,pS=S),HS),PS=(l(jS,fS=T),jS),US=(l(FS,dS=S),FS),qS=(l(A,hS=qn),A.payloadify=function(e){return E(y(y({},hS.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:k.payloadify(e.creator),created_at:e.createdAt/1e3}))},A.prototype.isGroupChannel=function(){return this.channelType===um.GROUP},A.prototype.isOpenChannel=function(){return this.channelType===um.OPEN},Object.defineProperty(A.prototype,"cachedMetaData",{get:function(){var n={};return this._cachedMetaData.forEach(function(e,t){e.isRemoved||(n[t]=e.value)}),n},enumerable:!1,configurable:!0}),A.prototype._upsertCachedMetaData=function(n,r){var i=this;Object.keys(n).forEach(function(e){var t=i._cachedMetaData.get(e);(!t||t.updatedAt<=r)&&i._cachedMetaData.set(e,{value:n[e],isRemoved:!1,updatedAt:r})})},A.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach(function(e){e=n._cachedMetaData.get(e);e&&e.updatedAt<t&&(e.isRemoved=!1,e.updatedAt=t)})},A.prototype._generateRequestId=function(){return"rq-".concat(X_())},A.prototype.isIdentical=function(e){return e&&this.url===e.url},A.prototype.isEqual=function(e){return K_(this,e)},A.prototype.createOperatorListQuery=function(e){return new gI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},A.prototype.createMutedUserListQuery=function(e){return new II(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},A.prototype.createBannedUserListQuery=function(e){return new SI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},A.prototype.createPreviousMessageListQuery=function(e){return new qb(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},A.prototype.addOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",r)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new FI({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.removeOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",r)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new VI({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.getMyMutedInfo=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new hw({channelUrl:this.url,channelType:this.channelType,userId:n.userId}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(dw),r=n.isMuted,i=n.startAt,s=n.endAt,a=n.remainingDuration,o=n.description,[2,{isMuted:r,startAt:i,endAt:s,remainingDuration:a,description:o}]}})})},A.prototype.getMetaData=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",s)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new fw({channelUrl:this.url,channelType:this.channelType,keys:s}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(pw),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},A.prototype.getAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new fw({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(pw),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},A.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Dg({channelUrl:this.url,channelType:this.channelType,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Mg).metaData,this._upsertCachedMetaData(n,0),[2,n]}})})},A.prototype.updateMetaData=function(s,a){return void 0===a&&(a=!1),re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new vw({channelUrl:this.url,channelType:this.channelType,metadata:s,upsert:a}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(_w),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},A.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new mw({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(gw).ts,this._removeFromCachedMetaData([r],n),[2]}})})},A.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Ew({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(bw).ts,this._removeFromCachedMetaData(G_([],H_(this._cachedMetaData.keys()),!1),n),[2]}})})},A.prototype.getMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",r)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new Iw({channelUrl:this.url,channelType:this.channelType,keys:r}),[4,t.send(n)];case 1:return[2,e.sent().as(ww).metaCounter]}})})},A.prototype.getAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Iw({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return[2,e.sent().as(ww).metaCounter]}})})},A.prototype.createMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Tw({channelUrl:this.url,channelType:this.channelType,metaCounter:r}),[4,t.send(n)];case 1:return[2,e.sent().as(Sw).metaCounter]}})})},A.prototype.updateMetaCounters=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Cw({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:i}),[4,t.send(n)];case 1:return[2,e.sent().as(kw).metaCounter]}})})},A.prototype.increaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Cw({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return[2,e.sent().as(kw).metaCounter]}})})},A.prototype.decreaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Cw({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return[2,e.sent().as(kw).metaCounter]}})})},A.prototype.deleteMetaCounter=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new Aw({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.deleteAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new Jw({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.muteUser=function(t,n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.muteUserWithUserId(t.userId,n,r)]})})},A.prototype.muteUserWithUserId=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)&&I("number",i,!0)&&I("string",s,!0)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new tT({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.unmuteUser=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unmuteUserWithUserId(t.userId)]})})},A.prototype.unmuteUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new oT({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.banUser=function(t,n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.banUserWithUserId(t.userId,n,r)]})})},A.prototype.banUserWithUserId=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)&&I("number",i,!0)&&I("string",s,!0)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new pT({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.unbanUser=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unbanUserWithUserId(t.userId)]})})},A.prototype.unbanUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new bT({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.freeze=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new NT({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!0,[2]}})})},A.prototype.unfreeze=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new NT({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!1,[2]}})})},A.prototype.getMessagesByTimestamp=function(n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return r=y(y({},L0),r),C(I("number",n)&&(I("number",(t=r).prevResultSize)&&I("number",t.nextResultSize)&&I("boolean",t.isInclusive)&&I("boolean",t.reverse)&&I("string",t.messageTypeFilter)&&ty(hm,t.messageTypeFilter)&&ny("string",t.customTypesFilter,!0)&&ny("string",t.senderUserIdsFilter,!0)&&ty(pm,t.replyType)&&I("boolean",t.includeMetaArray)&&I("boolean",t.includeReactions)&&I("boolean",t.includeParentMessageInfo)&&I("boolean",t.includeThreadInfo)&&I("boolean",t.showSubchannelMessagesOnly))).throw(g.invalidParameters),[4,fb.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,n,r)];case 1:return[2,e.sent()]}var t})})},A.prototype.getMessageChangeLogsSinceTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=y(y({},P0),n),C(I("number",t)&&D0(n)).throw(g.invalidParameters),[4,fb.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},A.prototype.getMessageChangeLogsSinceToken=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=y(y({},P0),n),C(I("string",t)&&D0(n)).throw(g.invalidParameters),[4,fb.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},A.prototype._createPendingSendableMessagePayload=function(e,t,n){var r=N.of(this._iid).sessionManager;return E({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(e){return qE.payloadify(e)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?HE.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:a0.payloadify(r.currentUser),req_id:t,request_state:_m.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:e.mentionedUsers})},A.prototype._createPendingUserMessage=function(e,t,n){var r={};if(e.translationTargetLanguages)try{for(var i=se(e.translationTargetLanguages),s=i.next();!s.done;s=i.next())r[s.value]=""}catch(e){o={error:e}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(o)throw o.error}}var a=E(y(y({},this._createPendingSendableMessagePayload(e,t,n)),{type:lm.USER,message:e.message,translations:r})),o=new d0(this._iid,a);return o.messageParams=e,o},A.prototype._createPendingScheduledUserMessage=function(e,t,n){t=this._createPendingUserMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},A.prototype._createPendingFileMessage=function(e,t,n){t=E(y(y({},this._createPendingSendableMessagePayload(e,t,n)),{type:lm.FILE,url:e.fileUrl,file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}}):[]})),n=new v0(this._iid,t);return n.messageParams=e,n},A.prototype._createPendingScheduledFileMessage=function(e,t,n){t=this._createPendingFileMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},A.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===m.REQUEST_CANCELED?e.sendingStatus=_m.CANCELED:n||(e.sendingStatus=_m.FAILED)},A.prototype.sendUserMessage=function(e){return e=y(y({},Wb),e),C(Qb(t=e)&&I("string",t.message)&&ny("string",t.translationTargetLanguages,!0)).throw(g.invalidParameters),this._sendUserMessage(e);var t},A.prototype._sendUserMessage=function(r,i,e){var n,s=this,t=(void 0===i&&(i=Date.now()),void 0===e&&(e=null),N.of(this._iid)),a=t.dispatcher,t=t.requestQueue,o=e,u=new pb,e=(o||(o=this._generateRequestId(),n=N.of(this._iid).dispatcher,im(2).then(function(){var t=s._createPendingUserMessage(r,o,i);n.dispatch(new G0({messages:[t],source:M0.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})})),new zT(y({channelUrl:this.url,channelType:this.channelType,reqId:o},r)));return t.send(e).then(function(e){var t=e.as(WT).message;a.dispatch(new G0({messages:[t],source:M0.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})}).catch(function(n){if(Q_(n))throw n;im(2).then(function(){var t=s._createPendingUserMessage(r,o,i),e=N.of(s._iid).cacheContext.localCacheEnabled&&z_(n.code);s._markMessageAsFailed(t,n,e),a.dispatch(new G0({messages:[t],source:t.sendingStatus===_m.PENDING?M0.REQUEST_RESEND_MESSAGE:M0.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(n,t)]})})})})}),u},A.prototype._autoResendUserMessage=function(e){return C(e instanceof d0).throw(g.invalidParameters),this._sendUserMessage(e.messageParams,e.createdAt,e.reqId)},A.prototype.resendUserMessage=function(r){var i;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof d0&&!r.scheduledInfo).throw(g.invalidParameters),t=new Wy,n=null!=(i=r.messageParams)?i:E({data:r.data,customType:r.customType,mentionType:r.mentionType,mentionedUsers:r.mentionedUsers,mentionedUserIds:r.mentionedUserIds,mentionedMessageTemplate:r.mentionedMessageTemplate,metaArrays:r.metaArrays,parentMessageId:r.parentMessageId,appleCriticalAlertOptions:r.appleCriticalAlertOptions,message:r.message,translationTargetLanguages:Object.keys(r.translations)}),this._sendUserMessage(n).onFailed(function(e){return t.reject(e)}).onSucceeded(function(e){return t.resolve(e)}),[2,t.promise]})})},A.prototype.updateUserMessage=function(s,a){return re(this,void 0,void 0,function(){var n,r,i;return ie(this,function(e){switch(e.label){case 0:return a=y(y({},vI),a),C(I("number",s)&&(tI(t=a)&&I("string",t.message,!0)&&ny("string",t.translationTargetLanguages,!0))).throw(g.invalidParameters),r=N.of(this._iid),n=r.dispatcher,r=r.requestQueue,i=new YT(y({channelType:this.channelType,channelUrl:this.url,messageId:s},a)),[4,r.send(i)];case 1:return r=e.sent(),i=r.as(XT).message,n.dispatch(new G0({messages:[i],source:M0.EVENT_MESSAGE_UPDATED})),[2,i]}var t})})},A.prototype.copyUserMessage=function(r,i){var s;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof A&&i instanceof d0&&i.sendingStatus===_m.SUCCEEDED&&r.url===i.channelUrl&&!i.scheduledInfo).throw(g.invalidParameters),t=new Wy,n=null!=(s=i.messageParams)?s:y(y({},i),{mentionType:i.mentionType,mentionedUserIds:null!=(s=i.mentionedUserIds)?s:null==(s=i.mentionedUsers)?void 0:s.map(function(e){return e.userId}),translationTargetLanguages:Object.keys(i.translations),pushNotificationDeliveryOption:vm.DEFAULT,parentMessageId:null,isReplyToChannel:!1}),r._sendUserMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},A.prototype.translateUserMessage=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof d0&&0<r.messageId&&ny("string",i)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new DS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,translationTargetLanguages:i}),[4,t.send(n)];case 1:return[2,e.sent().as(MS).message]}})})},A.prototype._createScheduledUserMessage=function(e,r){var i=this,t=N.of(this._iid).requestQueue,s=Date.now(),a=this._generateRequestId(),n=(im(2).then(function(){var t=i._createPendingScheduledUserMessage(e,a,s);ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}),new xS(y({reqId:a,channelType:this.channelType,channelUrl:this.url},e)));t.send(n).then(function(e){var t=e.as(LS).message;ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(Q_(n))throw n;im(2).then(function(){var t=i._createPendingScheduledUserMessage(e,a,s);i._markMessageAsFailed(t,n),ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(n,t)]})})})})})},A.prototype.sendFileMessage=function(e){return e=y(y({},eI),e),C(Zb(e)).throw(g.invalidParameters),this._sendFileMessage(e)},A.prototype._sendFileMessage=function(r,i,e){var s=this,a=(void 0===i&&(i=Date.now()),void 0===e&&(e=null),N.of(this._iid).dispatcher),t=fb.of(this._iid).fileMessageQueue,o=e,u=new pb;return o||(o=this._generateRequestId(),im(2).then(function(){var t=s._createPendingFileMessage(r,o,i);a.dispatch(new G0({messages:[t],source:M0.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})})),t.request(this,o,r).then(function(t){a.dispatch(new G0({messages:[t],source:M0.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})}).catch(function(n){if(Q_(n))throw n;im(2).then(function(){var t=s._createPendingFileMessage(r,o,i),e=N.of(s._iid).cacheContext.localCacheEnabled&&z_(n.code);s._markMessageAsFailed(t,n,e),a.dispatch(new G0({messages:[t],source:t.sendingStatus===_m.PENDING?M0.REQUEST_RESEND_MESSAGE:M0.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(n,t)]})})})})}),u},A.prototype._autoResendFileMessage=function(e){C(e instanceof v0).throw(g.invalidParameters);var t=N.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.createdAt,e.reqId).onFailed(function(e){t.debug("autoResendFileMessage failed",e)}).onSucceeded(function(e){t.debug("autoResendFileMessage success",e)})},A.prototype._createScheduledFileMessage=function(e,r,i,s){var a=this,t=N.of(this._iid).requestQueue,n=new PS(y(y({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));t.send(n).then(function(e){var t=e.as(US).message;ae(function(){return re(a,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(Q_(n))throw n;im(2).then(function(){var t=a._createPendingScheduledFileMessage(e,i,s);a._markMessageAsFailed(t,n),ae(function(){return re(a,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(n,t)]})})})})})},A.prototype.sendFileMessages=function(e){C(e.every(function(e){return Zb(y(y({},eI),e))})).throw(g.invalidParameters);var t,n,r=new pb;try{for(var i=se(e),s=i.next();!s.done;s=i.next()){var a=s.value;this.sendFileMessage(a).onPending(function(e){return r._trigger(null,e)}).onFailed(function(e,t){return r._trigger(e,t)}).onSucceeded(function(e){return r._trigger(null,e)})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},A.prototype.resendFileMessage=function(i,s){var a;return re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){return C(i instanceof v0&&s instanceof Blob&&!i.scheduledInfo).throw(g.invalidParameters),n=new Wy,r=null!=(a=i.messageParams)?a:(t=s,E({data:i.data,customType:i.customType,mentionType:i.mentionType,mentionedUsers:i.mentionedUsers,mentionedUserIds:i.mentionedUserIds,metaArrays:i.metaArrays,parentMessageId:i.parentMessageId,appleCriticalAlertOptions:i.appleCriticalAlertOptions,file:t=void 0===s?null:t,fileUrl:i.url,fileName:i.name,fileSize:i.size,mimeType:i.type,thumbnailSizes:i.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}})})),this._sendFileMessage(r).onFailed(function(e){return n.reject(e)}).onSucceeded(function(e){return n.resolve(e)}),[2,n.promise];var t})})},A.prototype.updateFileMessage=function(i,s){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return s=y(y({},_I),s),C(I("number",i)&&tI(s)).throw(g.invalidParameters),n=N.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new JT(y({channelType:this.channelType,channelUrl:this.url,messageId:i},s)),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(ZT).message,t.dispatch(new G0({messages:[r],source:M0.EVENT_MESSAGE_UPDATED})),[2,r]}})})},A.prototype.cancelUploadingFileMessage=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(I("string",t)).throw(g.invalidParameters),fb.of(this._iid).fileMessageQueue.cancel(this,t),[2,!0]})})},A.prototype.copyFileMessage=function(r,i){var s;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return C(r instanceof A&&i instanceof v0&&i.sendingStatus===_m.SUCCEEDED&&r.url===i.channelUrl&&!i.scheduledInfo).throw(g.invalidParameters),t=new Wy,n=y(y({},i),{fileUrl:i.url,fileName:i.name,fileSize:i.size,mimeType:i.type,mentionType:i.mentionType,mentionedUserIds:null!=(s=i.mentionedUserIds)?s:null==(s=i.mentionedUsers)?void 0:s.map(function(e){return e.userId}),pushNotificationDeliveryOption:vm.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:i.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),requireAuth:i.requireAuth}),r._sendFileMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},A.prototype.deleteMessage=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof o0).throw(g.invalidParameters),0<r.messageId?(t=N.of(this._iid).requestQueue,n=new $T({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},A.prototype.addReaction=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof s0&&0<r.messageId&&I("string",i)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new NS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:i}),[4,t.send(n)];case 1:return[2,e.sent().as(AS).reactionEvent]}})})},A.prototype.deleteReaction=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof s0&&0<r.messageId&&I("string",i)).throw(g.invalidParameters),t=N.of(this._iid).requestQueue,n=new OS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:i}),[4,t.send(n)];case 1:return[2,e.sent().as(RS).reactionEvent]}})})},A.prototype._updateMessageMetaArray=function(i,s,a,o){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return n=N.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new YT({channelType:this.channelType,channelUrl:this.url,messageId:i,metaArrayParams:{array:s,mode:a,upsert:o}}),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(XT).message,t.dispatch(new G0({messages:[r],source:M0.EVENT_MESSAGE_UPDATED})),[2,r]}})})},A.prototype.createMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return C(n instanceof o0&&0<n.messageId&&ny("string",r)).throw(g.invalidParameters),t=r.map(function(e){return new qE({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"add",!0)]})})},A.prototype.deleteMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return C(n instanceof o0&&0<n.messageId&&ny("string",r)).throw(g.invalidParameters),t=r.map(function(e){return new qE({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"remove",!0)]})})},A.prototype.addMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(t instanceof o0&&0<t.messageId&&n.every(function(e){return e instanceof qE})).throw(g.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"add",!0)]})})},A.prototype.removeMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){return C(t instanceof o0&&0<t.messageId&&n.every(function(e){return e instanceof qE})).throw(g.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"remove",!0)]})})},A.prototype.report=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ty(nI,r)&&I("string",i)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new BT({channelUrl:this.url,channelType:this.channelType,userId:n.userId,category:r,description:i}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.reportUser=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof k&&ty(nI,i)&&I("string",s)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new QT({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.userId,category:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A.prototype.reportMessage=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof o0&&ty(nI,i)&&I("string",s)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new KT({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.sender.userId,messageId:r.messageId,category:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},A);function A(e,t){var n=this;return(n=hS.call(this,e)||this).url="",n.channelType=um.BASE,n.name="",n.coverUrl="",n.customType="",n.data="",n.isFrozen=!1,n.isEphemeral=!1,n.creator=null,n.createdAt=0,n.url=t.channel_url,n.name=null!=(e=t.name)?e:"",n.coverUrl=null!=(e=t.cover_url)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.data=null!=(e=t.data)?e:"",n.isFrozen=!!I("boolean",t.freeze)&&t.freeze,n.isEphemeral=!!I("boolean",t.is_ephemeral)&&t.is_ephemeral,n.creator=t.created_by?new k(n._iid,t.created_by):null,n.createdAt=1e3*t.created_at,n._cachedMetaData=new Map,t.metadata&&t.ts&&Object.keys(t.metadata).forEach(function(e){n._cachedMetaData.set(e,{value:t.metadata[e],isRemoved:!1,updatedAt:t.ts})}),n}function FS(e,t){var n=dS.call(this,e,t)||this;return n.message=new v0(e,t),n}function jS(e){var t=this,t=fS.call(this)||this,n=[],r=(e.mentionType===fm.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),i=e.channelUrl;return t.method=b.POST,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(i),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:dm.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return u0.payloadify(e)}):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return qE.payloadify(e)}),apple_critical_alert_options:HE.payloadify(e.appleCriticalAlertOptions),push_option:e.pushNotificationDeliveryOption},t}function HS(e,t){var n=pS.call(this,e,t)||this;return n.message=new d0(e,t),n}function GS(e){var t=this,t=vS.call(this)||this,n=[],r=(e.mentionType===fm.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),i=e.channelUrl;return t.method=b.POST,t.path="".concat(Ig(r),"/").concat(encodeURIComponent(i),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:dm.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return qE.payloadify(e)}),apple_critical_alert_options:HE.payloadify(e.appleCriticalAlertOptions),target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption},t}function VS(e,t){var n=_S.call(this,e,t)||this;return n.message=new d0(e,t),n}function BS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.translationTargetLanguages,i=yS.call(this)||this;return i.method=b.POST,i.path="".concat(Ig(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r),"/translation"),i.params={target_langs:e},i}function QS(e,t){e=mS.call(this,e,t)||this;return e.reactionEvent=new LE(y({},t)),e}function KS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,i=gS.call(this)||this;return i.method=b.DELETE,i.path="".concat(Ig(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),i.params={reaction:e},i}function zS(e,t){e=ES.call(this,e,t)||this;return e.reactionEvent=new LE(t),e}function WS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,i=bS.call(this)||this;return i.method=b.POST,i.path="".concat(Ig(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),i.params={reaction:e},i}function YS(e,t,n){e=IS.call(this,e,"DELM",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.messageId=Number(n.msg_id),e}(Vt=wS=wS||{}).SUCCESS="success",Vt.PENDING="pending",Vt.ERROR="error",(Je=TS=TS||{}).DEFAULT="default",Je.ALL="all",Je.MENTION_ONLY="mention_only",Je.OFF="off",(We=SS=SS||{}).FCM="gcm",We.APNS="apns",We.UNKNOWN="unknown",(Ut=CS=CS||{}).ALTERNATIVE="alternative",Ut.DEFAULT="default";var XS;(r=XS=XS||{}).LATEST_LAST_MESSAGE="latest_last_message",r.CHRONOLOGICAL="chronological",r.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",r.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";function JS(e){switch(e){case XS.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case XS.CHRONOLOGICAL:return["-createdAt","syncIndex"];case XS.CHANNEL_NAME_ALPHABETICAL:return["name"]}}eC.prototype.clone=function(){var t=new eC,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach(function(e){t[e]=n[e]}),t},eC.prototype.match=function(e){switch(this.messageTypeFilter){case hm.USER:if(e.messageType!==lm.USER)return!1;break;case hm.FILE:if(e.messageType!==lm.FILE)return!1;break;case hm.ADMIN:if(e.messageType!==lm.ADMIN)return!1}if(this.customTypesFilter&&0<this.customTypesFilter.length&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&0<this.senderUserIdsFilter.length){if(!(e instanceof o0))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case pm.NONE:if(0<e.parentMessageId)return!1;break;case pm.ONLY_REPLY_TO_CHANNEL:if(e instanceof o0&&0<e.parentMessageId&&!e.replyToChannel)return!1}return!0};var ZS,$S=eC;function eC(){this.messageTypeFilter=hm.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=pm.NONE}(G=ZS=ZS||{}).CHANNEL_LATEST="channel_latest",G.NEWEST_CHILD_MESSAGE="newest_child_message";function tC(e){switch(e){case ZS.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case ZS.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}}y(y({},Wb),{scheduledAt:null}),y(y({},Xe),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1});var nC,rC,iC,sC,aC={},oC=(l(_C,sC=qn),_C.of=function(e){return aC[e]},Object.defineProperty(_C.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(_C.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),_C.prototype._serialize=function(e){if(0<e.messageId)throw g.invalidParameters;var t,n=y({},e.serialize());return e instanceof d0?(e.messageParams&&(n.messageParams=Kb(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,y(y({},Kb(t)),{scheduledAt:t.scheduledAt})))):e instanceof v0&&(e.messageParams&&(n.messageParams=Jb(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,y(y({},Jb(t)),{scheduledAt:t.scheduledAt})))),n},_C.prototype._deserialize=function(e){return e?(e=y(y({},e),{messageId:parseInt(e.messageId)}),fb.of(this._iid).buildMessageFromSerializedData(e)):null},_C.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},_C.prototype.fetch=function(e){var t=e.channelUrl,i=void 0===t?null:t,t=e.filter,s=void 0===t?new $S:t,t=e.order,a=void 0===t?ZS.CHANNEL_LATEST:t,t=e.sendingStatus,o=void 0===t?null:t,t=e.backward,u=void 0!==t&&t,t=e.parentMessageId,c=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(n=tC(a),t={"/where":function(e){return!!(a!==ZS.NEWEST_CHILD_MESSAGE||c&&0!==e.parentMessageId&&e.parentMessageId===c)&&s.match(r._deserialize(e))}},i&&(t.channelUrl=i),o&&(t.sendingStatus=o),t={where:t,index:n,backward:u},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({})];case 2:return n=e.sent(),[2,Promise.all(n.map(function(o){return re(r,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return t=fb.of(this._iid),n=this._deserialize(o),(r=o.messageParams)?n instanceof d0?(n.messageParams=t.buildUserMessageCreateParamsFromSerializedData(r,n),[3,4]):[3,1]:[3,4];case 1:return n instanceof v0?r.fileKey&&"string"==typeof r.fileKey&&Xb(r.fileType)?(i=r,[4,this.collection.getBlob(r.fileKey)]):[3,3]:[3,4];case 2:i.file=e.sent(),e.label=3;case 3:n.messageParams=t.buildFileMessageCreateParamsFromSerializedData(r,n),e.label=4;case 4:return n.scheduledInfo&&o.scheduledInfo&&o.scheduledInfo.scheduledMessageParams?n instanceof d0?(s=o.scheduledInfo.scheduledMessageParams,n.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(s,n),[3,8]):[3,5]:[3,8];case 5:return n instanceof v0?(s=o.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof s.fileKey&&Xb(s.fileType)?(a=s,[4,this.collection.getBlob(s.fileKey)]):[3,7]:[3,8];case 6:a.file=e.sent(),e.label=7;case 7:n.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(s,n),e.label=8;case 8:return[2,n]}})})}))];case 3:return[2,[]]}})})},_C.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new $S),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.fetch({filter:n,order:ZS.NEWEST_CHILD_MESSAGE,channelUrl:t.channelUrl,backward:!1,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},_C.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,3];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},_C.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},_C.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=se(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})},_C.prototype.removeMessagesOfChannel=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t}})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},_C.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},_C.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(i){return re(t,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return i instanceof v0?i.messageParams&&(t=i.messageParams).file&&Yb(t.file)?[4,this.collection.saveBlob(t.file,i.reqId)]:[3,2]:[3,4];case 1:r=e.sent(),t.fileKey=r,t.fileType=zb.BLOB,e.label=2;case 2:return i.scheduledInfo&&i.scheduledInfo.scheduledMessageParams&&(n=i.scheduledInfo.scheduledMessageParams).file&&Yb(n.file)?[4,this.collection.saveBlob(n.file,i.reqId)]:[3,4];case 3:r=e.sent(),n.fileKey=r,n.fileType=zb.BLOB,e.label=4;case 4:return[2]}})})}))];case 1:return e.sent(),[2]}})})},_C),uC={},cC=(l(vC,iC=qn),vC.of=function(e){return uC[e]},Object.defineProperty(vC.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(vC.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),vC.prototype._serialize=function(e){return y(y({},e.serialize()),{messageId:"".concat(e.messageId)})},vC.prototype._deserialize=function(e){return e=y(y({},e),{messageId:parseInt(e.messageId)}),fb.of(this._iid).buildMessageFromSerializedData(e)},vC.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},vC.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,t=e.limit,s=void 0===t?100:t,t=e.filter,a=void 0===t?new $S:t,t=e.order,o=void 0===t?ZS.CHANNEL_LATEST:t,t=e.backward,u=void 0!==t&&t,t=e.parentMessageId,c=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=tC(o),t={where:{channelUrl:r,"/where":function(e){if(i)switch(o){case ZS.CHANNEL_LATEST:if(!u&&e.createdAt>i||u&&e.createdAt<i)return!1;break;case ZS.NEWEST_CHILD_MESSAGE:if(!c||0===e.parentMessageId||e.parentMessageId!==c)return!1}return a.match(n._deserialize(e))}},index:t,backward:u},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({limit:s})];case 2:return t=e.sent(),[2,Promise.all(t.map(function(i){return re(n,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=this._deserialize(i),(n=i.messageParams)?t instanceof d0?(t.messageParams=n,[3,4]):[3,1]:[3,4];case 1:return t instanceof v0?n.fileKey&&"string"==typeof n.fileKey&&Xb(n.fileType)?(r=n,[4,this.collection.getBlob(n.fileKey)]):[3,3]:[3,4];case 2:r.file=e.sent(),e.label=3;case 3:t.messageParams=n,e.label=4;case 4:return[2,t]}})})}))];case 3:return[2,[]]}})})},vC.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new $S),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.fetch({channelUrl:t.channelUrl,token:Date.now(),limit:null,backward:!1,filter:n,order:ZS.NEWEST_CHILD_MESSAGE,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},vC.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,5];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:return e.sent(),[4,this.upsertChildMessages(r)];case 3:return e.sent(),[4,this._unsentMessageCache.upsertChildMessages(r)];case 4:e.sent(),e.label=5;case 5:return[2]}})})},vC.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},vC.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=se(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})},vC.prototype.removeMessagesOfChannel=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:n},index:tC(ZS.CHANNEL_LATEST)})]:[3,6];case 1:return e.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync"))];case 2:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync.meta"))];case 3:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs"))];case 4:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs.meta"))];case 5:e.sent(),e.label=6;case 6:return[2]}})})},vC.prototype.removeUnderOffset=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t,createdAt:{"<":n}},index:tC(ZS.CHANNEL_LATEST)})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},vC.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},vC.prototype.countBetween=function(r,i,s){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=tC(ZS.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:r,"/where":function(e){e=n._deserialize(e);return s.includes(e.createdAt)&&i.match(e)}},index:t}).count()]):[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},vC.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return r instanceof v0&&r.messageParams&&(t=r.messageParams).file&&Yb(t.file)?[4,this.collection.saveBlob(t.file,r.reqId)]:[3,2];case 1:n=e.sent(),t.fileKey=n,e.label=2;case 2:return[2]}})})}))];case 1:return e.sent(),[2]}})})},vC),lC=(l(pC,rC=J_),pC),hC={},dC=(fC.of=function(e){return hC[e]},fC.prototype.processNonAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=se(t),r=n.next();!r.done;r=n.next())0===(i=r.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=_m.FAILED,i.errorCode=m.ACK_TIMEOUT,this._dispatcher.dispatch(new G0({messages:[i],source:M0.LOCAL_MESSAGE_FAILED})))}catch(e){s={error:e}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}}return[2]}})})},fC.prototype.processAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=se(t),r=n.next();!r.done;r=n.next())(i=r.value).errorCode&&z_(i.errorCode)&&(s=(new Date).getTime(),a=i.createdAt+2592e5,s<=a?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),i.sendingStatus=_m.FAILED,this._dispatcher.dispatch(new G0({messages:[i],source:M0.LOCAL_MESSAGE_FAILED}))))}catch(e){o={error:e}}finally{try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}}return[2]}})})},fC.prototype.completeCurrentAndProcessNextAutoResend=function(e){this._localCacheEnabled&&(e.sendingStatus===_m.SUCCEEDED||e.sendingStatus===_m.FAILED&&!z_(e.errorCode))&&(0<=(e=this.indexOf(e))&&this._autoResendQueue.splice(e,1),0===e&&this._processNextAutoResend())},fC.prototype._fetchAllCachedPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return(t=oC.of(this._iid))?[4,t.fetch({sendingStatus:_m.PENDING,backward:!0})]:[3,2];case 1:return n=e.sent(),[3,3];case 2:n=[],e.label=3;case 3:return[2,n]}})})},fC.prototype.indexOf=function(e){return 0<this._autoResendQueue.length?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId):-1},fC.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId)},fC.prototype._processNextAutoResend=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{0<this._autoResendQueue.length?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new lC({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}return[2]})})},fC);function fC(e,t){var n=t.localCacheEnabled,r=t.dispatcher,i=t.sdkState,t=t.logger,s=this;(hC[e]=this)._iid=e,(hC[e]=this)._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=t,this._sdkState=i,this._localCacheEnabled&&r.on(function(e){if(e instanceof Rm)switch(e.stateType){case Yy.CONNECTED:s._isProcessingAutoResend||s.processAutoResendRegisteredPendingMessages().then(function(){return s._processNextAutoResend()});break;case Yy.DISCONNECTED:s._isProcessingAutoResend=!1}})}function pC(e){var e=e.message,t=rC.call(this)||this;return t.message=e,t}function vC(e,t){var n=t.sdkState,r=t.cacheContext,t=t.unsentMessageCache,i=iC.call(this,e)||this;return i._sdkState=n,i._cacheContext=r,i._unsentMessageCache=t,uC[e]=i}function _C(e,t){var n=t.sdkState,t=t.cacheContext,r=sC.call(this,e)||this;return r._sdkState=n,r._cacheContext=t,aC[e]=r}(Un=nC=nC||{})[Un.USER_BLOCK=20001]="USER_BLOCK",Un[Un.USER_UNBLOCK=2e4]="USER_UNBLOCK",Un[Un.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED";PC.getDataAsUserBlockEvent=function(e,t){var t=t.data,n=t.blocker,t=t.blockee;return{blocker:new k(e,n),blockee:new k(e,t)}},PC.getDataAsFriendDiscoveredEvent=function(t,e){e=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(e)?e.map(function(e){return new k(t,e)}):[]}};var yC,mC,gC,EC,bC,IC,wC=PC,TC=(l(LC,IC=J_),LC),SC=(l(xC,bC=qy),xC),CC=(l(MC,EC=T),MC),kC=(l(DC,gC=S),DC),NC=(l(RC,mC=T),RC),AC=(l(OC,yC=S),OC);function OC(e,t){e=yC.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function RC(e){var t=e.userId,e=e.pushTriggerOption,n=mC.call(this)||this;return n.method=b.PUT,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push_preference"),n.params={push_trigger_option:e},n}function DC(e,t){e=gC.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function MC(e){var e=e.userId,t=EC.call(this)||this;return t.method=b.GET,t.path="".concat(zm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function xC(e,t,n){e=bC.call(this,e,"USEV",n)||this;return e.event=new wC(n),e}function LC(e,t){var t=t.userId,n=IC.call(this)||this;return n._iid=e,n.userId=t,n}function PC(e){this.category=e.cat,this.data=e.data}var UC,qC,FC,jC,HC,GC,VC={profileImage:null,profileUrl:null,nickname:null},BC=(l(function(){return null!==UC&&UC.apply(this,arguments)||this},UC=qn),l($C,HC=cy),Object.defineProperty($C.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),$C.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=null,e.dispatch("pause")},3e4)),this._currentState=document.visibilityState},$C.prototype.start=function(){this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})},$C.prototype.stop=function(){this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})},$C),QC=(Object.defineProperty(ZC.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),ZC.prototype._onlineWorker=function(){this.connectionDelegate.reconnect()},ZC.prototype._offlineWorker=function(){this.connectionDelegate.disconnect()},ZC.prototype.start=function(){this.isAvailable&&(window.addEventListener("online",this._onlineWorker),window.addEventListener("offline",this._offlineWorker))},ZC.prototype.stop=function(){this.isAvailable&&(window.removeEventListener("online",this._onlineWorker,!1),window.removeEventListener("offline",this._offlineWorker,!1))},ZC.prototype.isOnline=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this.isAvailable?[2,navigator.onLine]:[2,new Promise(function(e,t){fetch("https://www.google.com",{method:b.GET}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},ZC),KC=(l(JC,jC=T),JC),zC=(l(XC,FC=S),XC),WC=(l(YC,qC=T),YC);function YC(e){var t=e.userId,e=e.token,n=qC.call(this)||this;return n.method=b.POST,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push/apns"),n.params={apns_device_token:e,always_push:!0},n}function XC(e,t){var n=FC.call(this,e,t)||this;return n.user=null,n.user=new k(e,y({},t)),n}function JC(e){var t=e.userId,n=e.nickname,n=void 0===n?null:n,r=e.profileUrl,r=void 0===r?null:r,i=e.profileImage,i=void 0===i?null:i,e=e.preferredLanguages,e=void 0===e?null:e,s=jC.call(this)||this;return s.method=b.PUT,s.path="".concat(zm,"/").concat(encodeURIComponent(t)),s.params=E({nickname:n,profile_url:r,profile_file:i,preferred_languages:e}),s}function ZC(e){var t=e.logger,e=e.connectionDelegate,e=void 0===e?null:e;this.logger=t,e&&(this.connectionDelegate=e),this._onlineWorker=this._onlineWorker.bind(this),this._offlineWorker=this._offlineWorker.bind(this)}function $C(){var e=HC.call(this)||this;return e._pauseDelayTimer=null,e._currentState="visible",e._toggleState=e._toggleState.bind(e),e}l(function(e,t){var n=GC.call(this,e,t)||this;return n.token=t.token,n.type=t.type?SS[t.type.toLowerCase()]:SS.UNKNOWN,n.user=new k(e,t.user),n},GC=S);l(rk,ek=T);var ek,tk,nk=rk;function rk(e){var t=e.userId,e=e.token,n=ek.call(this)||this;return n.method=b.POST,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push/gcm"),n.params={gcm_reg_token:e,always_push:!0},n}l(function(e,t){var n=tk.call(this,e,t)||this;return n.token=t.token,n.type=t.type?SS[t.type.toLowerCase()]:SS.UNKNOWN,n.user=new k(e,t.user),n},tk=S);l(ok,ik=T);var ik,sk,ak=ok;function ok(e){var t=e.userId,e=e.token,n=ik.call(this)||this;return n.method=b.DELETE,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push/apns/").concat(encodeURIComponent(e)),n}l(function(e,t){var n=sk.call(this,e,t)||this;return n.token=t.token,n.user=new k(e,t.user),n},sk=S);l(hk,uk=T);var uk,ck,lk=hk;function hk(e){var t=e.userId,e=e.token,n=uk.call(this)||this;return n.method=b.DELETE,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push/gcm/").concat(encodeURIComponent(e)),n}l(function(e,t){var n=ck.call(this,e,t)||this;return n.token=t.token,n.user=new k(e,t.user),n},ck=S);l(vk,dk=T);var dk,fk,pk=vk;function vk(e){var e=e.userId,t=dk.call(this)||this;return t.method=b.DELETE,t.path="".concat(zm,"/").concat(encodeURIComponent(e),"/push/apns"),t}l(function(e,t){var n=fk.call(this,e,t)||this;return n.type=t.type?SS[t.type.toLowerCase()]:SS.UNKNOWN,n.user=new k(e,t.user),n},fk=S);l(gk,_k=T);var _k,yk,mk=gk;function gk(e){var e=e.userId,t=_k.call(this)||this;return t.method=b.DELETE,t.path="".concat(zm,"/").concat(encodeURIComponent(e),"/push/gcm"),t}l(function(e,t){var n=yk.call(this,e,t)||this;return n.type=t.type?SS[t.type.toLowerCase()]:SS.UNKNOWN,n.user=new k(e,t.user),n},yk=S);l(hN,xk=T);var Ek,bk,Ik,wk,Tk,Sk,Ck,kk,Nk,Ak,Ok,Rk,Dk,Mk,xk,Lk,Pk=hN,Uk=(l(lN,Mk=S),lN),qk=(l(cN,Dk=T),cN),Fk=(l(uN,Rk=S),uN),jk=(l(oN,Ok=T),oN),Hk=(l(aN,Ak=S),aN),Gk=(l(sN,Nk=T),sN),Vk=(l(iN,kk=S),iN),Bk=(l(rN,Ck=T),rN),Qk=(l(nN,Sk=S),nN),Kk=(l(tN,Tk=T),tN),zk=(l(eN,wk=S),eN),Wk=(l($k,Ik=T),$k),Yk=(l(Zk,bk=S),Zk),Xk=(l(Jk,Ek=T),Jk);function Jk(e){var t=e.userId,e=e.blockedUserId,n=Ek.call(this)||this;return n.method=b.POST,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/block"),n.params={target_id:e},n}function Zk(e,t){e=bk.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function $k(e){var t=e.userId,n=e.snoozeOn,r=e.startTs,e=e.endTs,i=Ik.call(this)||this;return i.method=b.PUT,i.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push_preference"),i.params={snooze_enabled:n,snooze_start_ts:r,snooze_end_ts:e},i}function eN(e,t){e=wk.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function tN(e){var e=e.userId,t=Tk.call(this)||this;return t.method=b.GET,t.path="".concat(zm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function nN(e,t){e=Sk.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function rN(e){var t=e.userId,n=e.doNotDisturbOn,r=e.startHour,i=e.startMin,s=e.endHour,a=e.endMin,e=e.timezone,o=Ck.call(this)||this;return o.method=b.PUT,o.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push_preference"),o.params={do_not_disturb:n,start_hour:r,start_min:i,end_hour:s,end_min:a,timezone:e},o}function iN(e,t){e=kk.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function sN(e){var e=e.userId,t=Nk.call(this)||this;return t.method=b.GET,t.path="".concat(zm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function aN(e,t){e=Ak.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function oN(e){var t=e.userId,e=e.willAutoAccept,n=Ok.call(this)||this;return n.method=b.PUT,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/channel_invitation_preference"),n.params={auto_accept:e},n}function uN(e,t){e=Rk.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function cN(e){var e=e.userId,t=Dk.call(this)||this;return t.method=b.GET,t.path="".concat(zm,"/").concat(encodeURIComponent(e),"/channel_invitation_preference"),t}function lN(e,t){e=Mk.call(this,e,t)||this;return e.pushTokens={type:t.type?SS[t.type.toLowerCase()]:SS.UNKNOWN,deviceTokens:t.device_tokens,hasMore:t.has_more,token:t.token},e}function hN(e){var t=e.userId,n=e.type,r=e.token,e=e.ts,i=xk.call(this)||this;return i.method=b.GET,i.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push/").concat(encodeURIComponent(n),"/device_tokens"),i.params={created_ts:e,token:r},i}l(function(e,t){var n=Lk.call(this,e,t)||this;return n.user=new k(e,t),n},Lk=S);l(vN,dN=T);var dN,fN,pN=vN;function vN(e){var t=e.userId,e=e.unblockedUserId,n=dN.call(this)||this;return n.method=b.DELETE,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/block/").concat(encodeURIComponent(e)),n}l(function(){return null!==fN&&fN.apply(this,arguments)||this},fN=S);l(VN,TN=T);var _N,yN,mN,gN,EN,bN,IN,wN,TN,SN,CN=VN,kN=(l(GN,wN=S),GN),NN=(l(HN,IN=T),HN),AN=(l(jN,bN=S),jN),ON=(l(FN,EN=T),FN),RN=(l(qN,gN=S),qN),DN=(l(UN,mN=T),UN),MN=(l(PN,yN=S),PN),xN=(l(LN,_N=T),LN);function LN(e){var t=e.userId,e=e.discoveryKeys,n=_N.call(this)||this;return n.method=b.DELETE,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discovery_keys:e},n}function PN(e,t){e=yN.call(this,e,t)||this;return e.friendDiscoveryRequestId=t.friend_discovery_request_id,e}function UN(e){var t=e.userId,e=e.discoveries,n=mN.call(this)||this;return n.method=b.PUT,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discoveries:e.map(function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}})},n}function qN(t,e){var n=gN.call(this,t,e)||this;return n.changelogs={addedUsers:e.added.map(function(e){return new k(t,e)}),updatedUsers:e.updated.map(function(e){return new k(t,e)}),deletedUserIds:e.deleted,hasMore:e.has_more,token:e.next},n}function FN(e){var t=e.userId,e=e.token,n=EN.call(this)||this;return n.method=b.GET,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/friends/changelogs"),n.params={token:e},n}function jN(e,t){e=bN.call(this,e,t)||this;return e.name=t.name,e}function HN(e){var t=e.userId,e=e.templateName,n=IN.call(this)||this;return n.method=b.PUT,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/push/template"),n.params={name:e},n}function GN(e,t){e=wN.call(this,e,t)||this;return e.name=t.name,e}function VN(e){var e=e.userId,t=TN.call(this)||this;return t.method=b.GET,t.path="".concat(zm,"/").concat(encodeURIComponent(e),"/push/template"),t}l(function(){return null!==SN&&SN.apply(this,arguments)||this},SN=S);l($N,KN=T);var BN,QN,KN,zN,WN=$N,YN=(l(ZN,QN=S),ZN),XN=(l(JN,BN=T),JN);function JN(e){var t=e.userId,e=e.userIds,n=BN.call(this)||this;return n.method=b.DELETE,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}function ZN(t,e){var n=QN.call(this,t,e)||this;return n.users=e.users.map(function(e){return new k(t,e)}),n}function $N(e){var t=e.userId,e=e.userIds,n=KN.call(this)||this;return n.method=b.POST,n.path="".concat(zm,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}l(function(){return null!==zN&&zN.apply(this,arguments)||this},zN=S);l(c1,n1=T);var e1,t1,n1,r1,i1=c1,s1=(l(u1,t1=S),u1),a1=(l(o1,e1=T),o1);function o1(e){var t=e.userId,e=e.allowFriendDiscovery,n=e1.call(this)||this;return n.method=b.PUT,n.path="".concat(zm,"/").concat(t,"/allow_friend_discovery"),n.params={allow_friend_discovery:e},n}function u1(e,t){e=t1.call(this,e,t)||this;return e.allowFriendDiscovery=t.allow_friend_discovery,e}function c1(e){var e=e.userId,t=n1.call(this)||this;return t.method=b.GET,t.path="".concat(zm,"/").concat(e,"/allow_friend_discovery"),t.params={},t}l(function(){return null!==r1&&r1.apply(this,arguments)||this},r1=S);function l1(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map(function(e){return new N1(e)}):[]}var h1,d1,f1,p1,v1,_1,y1,m1,g1,E1,b1,I1,w1,T1,S1,C1,k1=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url},N1=function(e){var t;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!=(t=e.id)?t:0,this.name=null!=(t=e.name)?t:"",this.url=null!=(t=e.url)?t:"",this.emojis=e.emojis?e.emojis.map(function(e){return new k1(e)}):[]},A1=(l(oA,C1=T),oA),O1=(l(aA,S1=S),aA),R1=(l(sA,T1=T),sA),D1=(l(iA,w1=S),iA),M1=(l(rA,I1=T),rA),x1=(l(nA,b1=S),nA),L1=(l(tA,E1=T),tA),P1=(l(eA,g1=S),eA),U1=(l($1,m1=s),$1.prototype._validate=function(){return m1.prototype._validate.call(this)&&ny("string",this.userIdsFilter,!0)&&I("string",this.metaDataKeyFilter,!0)&&ny("string",this.metaDataValuesFilter,!0)&&I("string",this.metaDataKeyFilter,!0)},$1.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new L1(y(y({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(P1),r=n.users,i=n.next,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})},$1),q1=(l(Z1,y1=T),Z1),F1=(l(J1,_1=S),J1),j1=(l(X1,v1=s),X1.prototype._validate=function(){return v1.prototype._validate.call(this)&&ny("string",this.userIdsFilter,!0)},X1.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new q1(y(y({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(F1),r=n.users,i=n.next,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})},X1),H1=(l(Y1,p1=T),Y1),G1=(l(W1,f1=S),W1),V1=(l(z1,d1=s),z1.prototype._validate=function(){return d1.prototype._validate.call(this)},z1.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new H1(y(y({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(G1),r=n.users,i=n.hasMore,s=n.next,this._token=s,this._hasNext=i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})},z1),B1={},Q1=(K1.get=function(e){return B1[e]},K1);function K1(e){var t=e.dbname,n=e.itemSizeLimit,r=e.cacheLimit,r=void 0===r?256:r,i=e.blockHashBase,i=void 0===i?2:i,s=e.blockHashMultiplier,s=void 0===s?10:s,a=e.blockHashConstant,a=void 0===a?11:a,o=e.transactionApplyDelay,o=void 0===o?200:o,e=e.disableLogger,e=void 0!==e&&e;return B1[t]||(this.itemSizeLimit=void 0===n?1048576:n,this.cacheLimit=r,this.blockHashBase=i,this.blockHashMultiplier=s,this.blockHashConstant=a,this.transactionApplyDelay=o,this.disableLogger=e,B1[t]=this),B1[t]}function z1(){return null!==d1&&d1.apply(this,arguments)||this}function W1(t,e){var n=f1.call(this,t,e)||this;return n.hasMore=e.has_more,n.users=e.users.map(function(e){return new k(t,e)}),n.next=e.next,n}function Y1(e){var t=e.userId,n=e.limit,e=e.token,r=p1.call(this)||this;return r.method=b.GET,r.path="".concat(zm,"/").concat(encodeURIComponent(t),"/friends"),r.params={limit:n,token:e},r}function X1(e,t){var n=this;return(n=v1.call(this,e,t)||this).userIdsFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n}function J1(t,e){var n=_1.call(this,t,e)||this;return n.users=e.users.map(function(e){return new k(t,e)}),n.next=e.next,n}function Z1(e){var t=e.userId,n=e.limit,r=e.token,e=e.userIdsFilter,i=y1.call(this)||this;return i.method=b.GET,i.path="".concat(zm,"/").concat(t,"/block"),i.params=E({limit:n,token:r,user_ids:e}),i}function $1(e,t){var n=this;return(n=m1.call(this,e,t)||this).userIdsFilter=null,n.metaDataKeyFilter=null,n.metaDataValuesFilter=null,n.nicknameStartsWithFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n.metaDataKeyFilter=null!=(e=t.metaDataKeyFilter)?e:null,n.metaDataValuesFilter=null!=(e=t.metaDataValuesFilter)?e:null,n.nicknameStartsWithFilter=t.nicknameStartsWithFilter||null,n}function eA(t,e){var n=g1.call(this,t,e)||this;return n.users=e.users.map(function(e){return new k(t,e)}),n.next=e.next,n}function tA(e){var t=e.limit,n=e.token,r=e.userIdsFilter,i=e.metaDataKeyFilter,s=e.metaDataValuesFilter,e=e.nicknameStartsWithFilter,a=E1.call(this)||this;return a.method=b.GET,a.path=zm,a.params=E({limit:t,token:n,user_ids:r,metadatakey:i,metadatavalues_in:s,nickname_startswith:e}),a}function nA(e,t){e=b1.call(this,e,t)||this;return e.emoji=new k1(t),e}function rA(e){var e=e.key,t=I1.call(this)||this;return t.method=b.GET,t.path="".concat(eg,"/").concat(e),t}function iA(e,t){e=w1.call(this,e,t)||this;return e.emojiCategory=new N1(t),e}function sA(e){var e=e.categoryId,t=T1.call(this)||this;return t.method=b.GET,t.path="".concat(tg,"/").concat(e),t}function aA(e,t){e=S1.call(this,e,t)||this;return e.emojiContainer=new l1(t),e}function oA(){var e=C1.call(this)||this;return e.method=b.GET,e.path=tg,e}(e=h1=h1||{})[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND";l(O,cA=Error),Object.defineProperty(O,"storeNotDefined",{get:function(){return new O({code:h1.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailable",{get:function(){return new O({code:h1.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailableInPrivateBrowsing",{get:function(){return new O({code:h1.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeIsFull",{get:function(){return new O({code:h1.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeKeyTypeIsInvalid",{get:function(){return new O({code:h1.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenIntegrity",{get:function(){return new O({code:h1.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenBlob",{get:function(){return new O({code:h1.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeEncryptionInvalid",{get:function(){return new O({code:h1.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeItemSizeExceeded",{get:function(){return new O({code:h1.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeReadFailed",{get:function(){return new O({code:h1.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeWriteFailed",{get:function(){return new O({code:h1.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"databaseSchemaNotOnUpgrade",{get:function(){return new O({code:h1.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionNotReady",{get:function(){return new O({code:h1.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotMatch",{get:function(){return new O({code:h1.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionQueryNotValid",{get:function(){return new O({code:h1.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionInsertDuplicate",{get:function(){return new O({code:h1.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotFound",{get:function(){return new O({code:h1.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotGiven",{get:function(){return new O({code:h1.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionWriteFailed",{get:function(){return new O({code:h1.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionItemSizeExceeded",{get:function(){return new O({code:h1.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTableIsRequired",{get:function(){return new O({code:h1.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTypesNotMatch",{get:function(){return new O({code:h1.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"compareTypesNotMatch",{get:function(){return new O({code:h1.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"circularReferenceFound",{get:function(){return new O({code:h1.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0});var uA,cA,lA=O;function O(e){var t=e.code,t=void 0===t?h1.UNKNOWN_ERROR:t,e=e.message,e=cA.call(this,void 0===e?"Unknown error occurred.":e)||this;return e.code=t,Object.setPrototypeOf(e,O.prototype),e}(zt=uA=uA||{}).INIT="init",zt.READY="ready",zt.CLOSED="closed";function hA(e,t){if(void 0===t&&(t=new WeakMap),"object"!=typeof e||null===e)return e;if(t.has(e))throw lA.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map(function(e){return hA(e,t)});else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=hA(e[r],t);return t.delete(e),n}function dA(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw lA.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n}function fA(t){return new Promise(function(e){setTimeout(function(){return e()},t)})}function pA(e,t){if(t){if("function"==typeof e)return e(t);for(var n in e)if(["/and","&&"].includes(n)){if(e[n].some(function(e){return!pA(e,t)}))return}else if(["/or","||"].includes(n)){if(e[n].every(function(e){return!pA(e,t)}))return}else if("/where"===n){if(!(0,e[n])(t))return}else{var r=n;if("object"==typeof e[r]){var i,s=e[r];for(i in s)switch(i){case"/eq":case"=":if((a=t[r])!==(o=s[i]))return;break;case"/neq":case"!=":if((a=t[r])===(o=s[i]))return;break;case"/gt":case">":var a=t[r],o=s[i];if(0<dA(a,o))break;return;case"/gte":case">=":if(a=t[r],o=s[i],0<=dA(a,o))break;return;case"/lt":case"<":if(a=t[r],o=s[i],dA(a,o)<0)break;return;case"/lte":case"<=":if(a=t[r],o=s[i],dA(a,o)<=0)break;return;case"/in":if(a=t[r],(o=s[i]).includes(a))break;return;case"/nin":if(a=t[r],(o=s[i]).includes(a))return;break;case"/contain":if(a=t[r],o=s[i],a.includes(o))break;return;case"/regex":if(a=t[r],(o=s[i]).test(a))break;return;case"/where":if(a=t[r],!(0,s[i])(a))return}}else if("function"==typeof e[r]){if(!e[r](t[r]))return}else if(e[r]!==t[r])return}return 1}}function vA(){}function _A(){return Promise.resolve()}function yA(e){return e}function mA(e,t){t(null)}var gA=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t};function EA(e,t){return"".concat(RA(e,t),".metadata")}function bA(e,t){return"".concat(RA(e,t),"/block.")}function IA(e,t){return"".concat(RA(e,t),"/blob.")}function wA(e,t,n,r){return void 0===r&&(r=0),"".concat(IA(e,t)).concat(n,".").concat(r)}Object.defineProperty(PA.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(PA.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(PA.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(PA.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(PA.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),PA.prototype.prev=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:if(!this.hasPrevious)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._prevValue,[4,(n=this)._backward()];case 2:return n._prevValue=e.sent()||null,this._nextValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},PA.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:if(!this.hasNext)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._nextValue,[4,(n=this)._forward()];case 2:return n._nextValue=e.sent()||null,this._prevValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},PA.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()};var TA,SA,CA,kA=PA,NA=(LA.prototype.findOptimizedStartPosition=function(){var s=this,a=["=","/eq",">",">=","/gt","/gte"],o=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var e=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var t in this._indexer.fields){var n=this._indexer.fields[t],r=1;if("-"===n[0]&&(n=n.slice(1),r=-1),this.condition[n])if("object"==typeof this.condition[n]){var i,u=0<r?o:a;for(i in this.condition[n])if(u.includes(i))for(var c=e;0<=c;c--)if(r*dA(this._indexer.origin[c].columnValues[t],this.condition[n][i])<=0){e=c;break}}else for(c=e;0<=c;c--)if(r*dA(this._indexer.origin[c].columnValues[t],this.condition[n])<=0){e=c;break}}return Math.min(e+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=this,t=0;t<this._indexer.fields.length;t++)!function(n){var r=h._indexer.fields[n],i=1;if("-"===r[0]&&(r=r.slice(1),i=-1),h.condition[r])if("object"==typeof h.condition[r])Object.keys(h.condition[r]).forEach(function(e){if((0<i?a:o).includes(e))for(var t=l;t<s._indexer.origin.length;t++)if(0<=i*dA(s._indexer.origin[t].columnValues[n],s.condition[r][e])){l=t;break}});else for(var e=l;e<h._indexer.origin.length;e++)if(0<=i*dA(h._indexer.origin[e].columnValues[n],h.condition[r])){l=e;break}}(t);return Math.max(l-1,0)},LA.prototype.each=function(c){return re(this,void 0,void 0,function(){var r,i,s,a,t,n,o,u=this;return ie(this,function(e){switch(e.label){case 0:if(r=this.findOptimizedStartPosition(),i=0,this.backward&&this._indexer.origin[r]&&(i=this._indexer.origin[r].keys.length-1),s=function(){if(u._indexer.origin[r]){if(!u._indexer.origin[r].keys[++i]){if(!u._indexer.origin[++r])return!1;i=0}return!0}return!1},a=function(){if(u._indexer.origin[r]){if(!u._indexer.origin[r].keys[--i]){if(!u._indexer.origin[--r])return!1;i=u._indexer.origin[r].keys.length-1}return!0}return!1},t=null,!this._indexer.origin[r])return[3,4];n=this.backward?a:s,e.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])];case 2:if(o=e.sent(),pA(this.condition,o))return t=o,[3,4];e.label=3;case 3:if(n())return[3,1];e.label=4;case 4:return[4,new Promise(function(e){e=new kA({initialNextValue:hA(t),iterator:c,forward:function(){return re(u,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:t=this.backward?a:s,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])]:[3,3];case 2:return n=e.sent(),pA(this.condition,n)?[2,hA(n)]:[3,1];case 3:return[2,null]}})})},backward:function(){return re(u,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:t=this.backward?s:a,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])]:[3,3];case 2:return n=e.sent(),pA(this.condition,n)?[2,hA(n)]:[3,1];case 3:return[2,null]}})})},complete:e});c(e)})];case 5:return[2,e.sent()]}})})},LA),AA=(xA.prototype.fetch=function(a){return void 0===a&&(a={}),re(this,void 0,void 0,function(){var n,r,i,t,s=this;return ie(this,function(e){switch(e.label){case 0:if(n=Math.max(a.offset||0,0),0===(r="number"==typeof a.limit?a.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(r<0)throw lA.collectionQueryNotValid;e.label=1;case 1:return e.trys.push([1,4,,5]),i=[],[4,this._mutex.lock()];case 2:return e.sent(),[4,this._iterator.each(function(t){return re(s,void 0,void 0,function(){return ie(this,function(e){return!t.error&&t.hasNext?0===n?(i.push(t.nextValue),0<r&&r<=i.length?t.stop():t.next()):(n--,t.next()):t.stop(),[2]})})})];case 3:return e.sent(),this._mutex.unlock(),[2,i];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[2]}})})},xA.prototype.count=function(){return re(this,void 0,void 0,function(){var n,t,r=this;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),n=0,[4,this._mutex.lock()];case 1:return e.sent(),[4,this._iterator.each(function(t){return re(r,void 0,void 0,function(){return ie(this,function(e){return!t.error&&t.hasNext?(n++,t.next()):t.stop(),[2]})})})];case 2:return e.sent(),this._mutex.unlock(),[2,n];case 3:throw t=e.sent(),this._mutex.unlock(),t;case 4:return[2]}})})},xA),OA=function(e){return"".concat("nest","@").concat(e)},RA=function(e,t){return"".concat(OA(e),"/").concat(t)},DA=(MA.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(0<n){for(var r=Math.ceil(e.data.length/n),r="".concat(r,".").concat(e.type,".").concat(t),i=[],s=0;s<e.data.length;s+=n){var a=e.data.slice(s,s+n);i.push(a)}return{blobId:r,shards:i}}return{blobId:null,shards:null}},MA.prototype._encode=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){var t=new FileReader;t.onload=function(){e({data:t.result,type:n.type})},t.readAsDataURL(n)})];case 1:return[2,e.sent()]}})})},MA.prototype._decode=function(o){return re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return"undefined"==typeof fetch?[3,3]:[4,fetch(o.data)];case 1:return[4,e.sent().blob()];case 2:return[2,e.sent()];case 3:for(t=[],n=atob(o.data.split(",")[1]),r=0;r<n.length;r+=512){for(i=n.slice(r,r+512),s=new Array(i.length),a=0;a<i.length;a++)s[a]=i.charCodeAt(a);t.push(new Uint8Array(s))}return[2,new Blob(t,{type:o.type})]}})})},MA.prototype.get=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(t=[],n=H_(a.split("."),2),r=n[0],n=n[1],!(0<(r=parseInt(r))))return[3,6];i=0,e.label=1;case 1:return i<r?(s=wA(this.dbname,this.collectionName,a,i),[4,this._store.get(s)]):[3,4];case 2:if(!(s=e.sent())||!s.d)throw lA.storeBrokenBlob;t.push(s.d),e.label=3;case 3:return i++,[3,1];case 4:return[4,this._decode({data:t.join(""),type:n})];case 5:return[2,e.sent()];case 6:return[2,null]}})})},MA.prototype.save=function(o,u){return void 0===u&&(u="".concat(Date.now())),re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return t=[],[4,this._encode(o)];case 1:if(n=e.sent(),n=this._makeShards(n,u),r=n.blobId,i=n.shards,!r)return[3,3];for(s=0;s<i.length;s++)a=wA(this.dbname,this.collectionName,r,s),t.push({key:a,value:{d:i[s]},generation:1});return[4,this._store.setMany(t)];case 2:if(e.sent().some(function(e){return e instanceof Error}))throw lA.storeWriteFailed;return[2,r];case 3:return[2,null]}})})},MA.prototype.remove=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:if(t=[],n=H_(s.split("."),1),n=n[0],!(0<(r=parseInt(n))))return[3,2];for(i=0;i<r;i++)t.push(wA(this.dbname,this.collectionName,s,i));return[4,this._store.removeMany(t)];case 1:e.sent(),e.label=2;case 2:return[2]}})})},MA.prototype.clear=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=IA(this.dbname,this.collectionName),n=[],[4,this._store.getAllKeys()];case 1:r=e.sent();try{for(i=se(r),s=i.next();!s.done;s=i.next())(a=s.value).startsWith(t)&&n.push(a)}catch(e){o={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(o)throw o.error}}return[4,this._store.removeMany(r)];case 2:return e.sent(),[2]}})})},MA);function MA(e){var t=e.dbname,n=e.collectionName,e=e.store;this.dbname=t,this.collectionName=n,this._store=e}function xA(e){var t=e.condition,t=void 0===t?{}:t,n=e.backward,n=void 0!==n&&n,r=e.mutex,i=e.blockManager,e=e.indexer;this._mutex=r,this._iterator=new NA({condition:t,backward:n,blockManager:i,indexer:e})}function LA(e){var t=e.condition,n=e.backward,n=void 0!==n&&n,r=e.blockManager,e=e.indexer;this.condition=void 0===t?{}:t,this.backward=n,this._blockManager=r,this._indexer=e}function PA(e){var t=e.initialPrevValue,n=e.initialNextValue,n=void 0===n?null:n,r=e.iterator,i=e.map,i=void 0===i?yA:i,s=e.backward,s=void 0===s?_A:s,a=e.forward,a=void 0===a?_A:a,e=e.complete,e=void 0===e?vA:e;this._prevValue=void 0===t?null:t,this._nextValue=n,this._error=null,this._map=i,this._backward=s,this._forward=a,this._iterator=r,this._complete=e}(jn=TA=TA||{})[jn.COMMIT=0]="COMMIT",jn[jn.WRITE=1]="WRITE",jn[jn.ERROR=2]="ERROR",(et=SA=SA||{}).PENDING="pending",et.PERSISTENT="persistent",et.VOLATILE="volatile",(_t=CA=CA||{})[_t.NO_CACHE=0]="NO_CACHE",_t[_t.DEFAULT=1]="DEFAULT",_t[_t.PERSISTENT=2]="PERSISTENT";var UA=[SA.PENDING,SA.VOLATILE],qA={},FA=(YA.get=function(e){return qA[e]},Object.defineProperty(YA.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),YA.prototype.find=function(r,i,s){return void 0===s&&(s=CA.DEFAULT),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return(t=this.get(i))?[3,2]:[4,r.get(i)];case 1:return(n=e.sent())&&(t={key:i,value:n,generation:1,state:s===CA.PERSISTENT?SA.PERSISTENT:SA.VOLATILE},this.put(t)),[3,3];case 2:s===CA.PERSISTENT&&(t.state=SA.PERSISTENT),e.label=3;case 3:return[2,t]}})})},YA.prototype.get=function(e,t){void 0===t&&(t=CA.DEFAULT);var e=this._items.map(function(e){return e.key}).indexOf(e);return-1<e?(e=this._items[e],t===CA.PERSISTENT&&(e.state=SA.PERSISTENT),t!==CA.NO_CACHE&&this.put(e),e):null},YA.prototype.put=function(e){var t,n;if(0<this._limit){var r=this._items.map(function(e){return e.key}).indexOf(e.key);if(-1<r)UA.includes(this._items[r].state)&&UA.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter(function(e){return e.state===SA.VOLATILE}).length-this._limit;if(0<i){var s=[];try{for(var a=se(this._items),o=a.next();!o.done;o=a.next()){var u=o.value;u.state===SA.VOLATILE&&0<i?i--:s.push(u)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this._items=s}}}},YA.prototype.remove=function(e){e=this._items.map(function(e){return e.key}).indexOf(e);-1<e&&this._items.splice(e,1)},YA.prototype.clearByCondition=function(t){this._items=this._items.filter(function(e){return!t(e)})},YA.prototype.clear=function(e){this._items=(e=void 0===e?!1:e)?[]:this._items.filter(function(e){return e.state!==SA.VOLATILE})},YA),jA=(Object.defineProperty(WA.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(WA.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),WA.prototype._getReducedRecordset=function(n){return void 0===n&&(n=[]),re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=e.sent()||[]).push.apply(t,G_([],H_(n),!1)),[2,this._reduceRecordSet(t)]}})})},WA.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;0<=r;r--){for(var i=e[r],s=[],a=i.requests.length-1;0<=a;a--){var o=i.requests[a],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0)}0<s.length&&(i.requests=s,t.unshift(i))}return t},WA.prototype._applyRecord=function(c,l){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:t=FA.get(this.dbname),n=l.generation,r=l.requests,i=null,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.setMany(r.map(function(e){return y(y({},e.data),{generation:n})}))];case 2:for(s=e.sent(),a=0;a<r.length;a++)s[a]instanceof Error&&(i=i||s[a],o=r[a].data,t.put(y(y({},o),{generation:n,state:SA.PERSISTENT})));return[3,4];case 3:return u=e.sent(),i=u,[3,4];case 4:return i?[3,6]:(u=c.filter(function(e){return e.generation!==n}),[4,this._store.set({key:this.recordsetKey,value:u,generation:n})]);case 5:return e.sent(),this._onWrite.forEach(function(e){e(r.map(function(e){return e.data}))}),[3,7];case 6:this._onError.forEach(function(e){return e(i)}),e.label=7;case 7:return[2]}})})},WA.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return[4,(t=this)._store.get(this.metadataKey)];case 1:return t._metadata=e.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:n=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),r=se(n),i=r.next(),e.label=4;case 4:return i.done?[3,7]:(s=i.value,[4,this._applyRecord(n,s)]);case 5:e.sent(),e.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return s=e.sent(),a={error:s},[3,10];case 9:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},WA.prototype.on=function(e,t,n){switch(e){case TA.COMMIT:this._onCommit.set(t,n);break;case TA.WRITE:this._onWrite.set(t,n);break;case TA.ERROR:this._onError.set(t,n)}},WA.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t=void 0===t?null:t}),FA.get(this.dbname).put(y({state:SA.PENDING,generation:this.generation},e))},WA.prototype.requestMultipleWrite=function(e,t){void 0===t&&(t=null);var n,r,i=FA.get(this.dbname);try{for(var s=se(e),a=s.next();!a.done;a=s.next()){var o=a.value;this._requests.push({data:o,options:t}),i.put(y({state:SA.PENDING,generation:this.generation},o))}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},WA.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return FA.get(this.dbname).clearByCondition(function(e){return e.state===SA.PENDING}),this._requests=[],[2]})})},WA.prototype.commit=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d=this;return ie(this,function(e){switch(e.label){case 0:if(!(0<(t=this._requests).length))return[3,4];for(n=[],r={},u=t.length-1;0<=u;u--)i=t[u],c=i.data,r[c.key]||(r[c.key]=!0,n.unshift(i));return s={generation:this.generation,requests:n},[4,this._getReducedRecordset([s])];case 1:return a=e.sent(),[4,this._store.set({key:this.recordsetKey,value:a,generation:this.generation})];case 2:return e.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(e.sent(),o=FA.get(this.dbname),u=0;u<n.length;u++)l=n[u],c=l.data,l=l.options,o.put(y(y({},c),{generation:s.generation,state:l&&l.persistent?SA.PERSISTENT:SA.VOLATILE}));this._requests=[],this._onCommit.forEach(function(e){e(t.map(function(e){return e.data}))}),h=Q1.get(this.dbname),setTimeout(function(){try{d._applyRecord(a,s)}catch(t){d._onError.forEach(function(e){return e(t)})}},h.transactionApplyDelay),e.label=4;case 4:return[2]}})})},WA),HA=(zA.createFromCacheItem=function(e){return e?new zA(e.value):null},Object.defineProperty(zA.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(zA.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),zA.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},zA.prototype.getItemByKey=function(t){var n=this;return this._items.find(function(e){e=e[n.keyName];return t===e})},zA.prototype.has=function(e){var t=this;return this._items.map(function(e){return e[t.keyName]}).includes(e)},zA.prototype.add=function(e){var t=this,n=this._items.map(function(e){return e[t.keyName]}).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},zA.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},zA.prototype.clear=function(){this._items=[]},zA),GA=(Object.defineProperty(KA.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),KA.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,e="".concat(function(e,t,n){t=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||gA)(e,t)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(bA(n,r)).concat(i,".").concat(e);var n,r,i},KA.prototype._findBlock=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:t=FA.get(this.dbname),n=this.metadata.blockLevel,e.label=1;case 1:return 0<n?(r=this.createBlockId(s,n),[4,t.find(this._store,r)]):[3,4];case 2:if((r=e.sent())&&(i=HA.createFromCacheItem(r)).getItemByKey(s))return[2,i];e.label=3;case 3:return n--,[3,1];case 4:return[2,null]}})})},KA.prototype.getFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return[2,(t=e.sent())?t.getItemByKey(n):null]}})})},KA.prototype.putToBlock=function(i,s){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return n=Q1.get(this.dbname),t=this.createBlockId(i),n=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,FA.get(this.dbname).find(this._store,t)];case 1:return r=e.sent(),(r=r?HA.createFromCacheItem(r):new HA({blockId:t,keyName:this.keyName,items:[],limit:n})).add(s)?(this._transaction.requestWrite({key:r.blockId,value:r.serialize()}),[2,!0]):[2,!1]}})})},KA.prototype.removeFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return(t=e.sent())&&t.remove(n)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}})})},KA.prototype.clearAllBlocks=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=bA(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return n=e.sent(),n=n.filter(function(e){return e.startsWith(t)}),[4,this._store.removeMany(n)];case 2:e.sent(),r=FA.get(this.dbname);try{for(i=se(n),s=i.next();!s.done;s=i.next())a=s.value,r.remove(a)}catch(e){o={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(o)throw o.error}}return[2]}})})},KA),VA=(QA.createKey=function(e){return e.join(">")},QA.parseKey=function(e){return e.split(">")},QA.prototype._addItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),n=H_(this.indexOf(e),2),r=n[0];return n[1]?!this._table[r].keys.includes(t)&&(this._table[r].keys.push(t),!0):(this._table.splice(r,0,{columnValues:e,keys:[t]}),!0)},QA.prototype._removeItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),e=H_(this.indexOf(e),2),n=e[0];if(e[1]){e=this._table[n].keys.indexOf(t);if(-1<e)return this._table[n].keys.splice(e,1),0===this._table[n].keys.length&&this._table.splice(n,1),!0}return!1},Object.defineProperty(QA.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(QA.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),QA.prototype.getColumnValues=function(e){var t,n,r=[];try{for(var i=se(this.fields),s=i.next();!s.done;s=i.next()){var a,o=s.value,u=e[o="-"===o[0]?o.slice(1):o];if(a=typeof u,null!==u&&"undefined"!=a&&"boolean"!=a&&"number"!=a&&"string"!=a)throw lA.indexTypesNotMatch;r.push(e[o])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},QA.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,n=dA(e[n],t[n]);if(0!==n)return r*n}return 0},QA.prototype.indexOf=function(e){if(0<this._table.length){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(0<i)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},QA.prototype.ensure=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d,f,p,v;return ie(this,function(e){switch(e.label){case 0:return[4,(t=FA.get(this.dbname)).find(this._store,this.indexerKey,CA.PERSISTENT)];case 1:return(n=e.sent())?[3,11]:(r=bA(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:i=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),s=se(i),a=s.next(),e.label=4;case 4:return a.done?[3,7]:(o=a.value).startsWith(r)?[4,t.find(this._store,o,CA.NO_CACHE)]:[3,6];case 5:o=e.sent(),h=HA.createFromCacheItem(o);try{for(p=void 0,u=se(h.items),c=u.next();!c.done;c=u.next())l=c.value,this._addItem(l)}catch(e){p={error:e}}finally{try{c&&!c.done&&(v=u.return)&&v.call(u)}finally{if(p)throw p.error}}e.label=6;case 6:return a=s.next(),[3,4];case 7:return[3,10];case 8:return h=e.sent(),d={error:h},[3,10];case 9:try{a&&!a.done&&(f=s.return)&&f.call(s)}finally{if(d)throw d.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=n.value,this._table=hA(this._origin),e.label=12;case 12:return[2]}})})},QA.prototype.drop=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return FA.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}})})},QA.prototype.addItem=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._addItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},QA.prototype.removeItem=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._removeItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},QA.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},QA.prototype.commit=function(){this._origin=this._table,this._table=hA(this._origin)},QA.prototype.abort=function(){this._table=hA(this._origin)},QA),BA="undefined"!=typeof document&&"undefined"!=typeof navigator;function QA(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,e=e.store,a=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=(t=this.dbname,n=this.collectionName,r=this.fields.join(">"),"".concat(RA(t,n),"/index.").concat(r)),this._transaction=s,this._store=e,this._transaction.on(TA.COMMIT,this.indexerKey,function(){return a.commit()}),this._transaction.on(TA.ERROR,this.indexerKey,function(){return a.abort()})}function KA(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,i=void 0===i?gA:i,s=e.transaction,e=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=i,this.metadata=r,this._transaction=s,this._store=e}function zA(e){var t=e.blockId,n=e.keyName,r=e.items,r=void 0===r?[]:r,e=e.limit;this.blockId=t,this.keyName=n,this.limit=e,this._items=G_([],H_(r),!1)}function WA(e){var t=e.dbname,n=e.collectionName,e=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey="".concat(RA(t,n),"/trans.metadata"),this.recordsetKey="".concat(RA(t,n),"/trans.recordset"),this._store=e}function YA(e){var t=e.dbname,e=e.limit,e=void 0===e?256:e;return qA[t]||(this.dbname=t,this._items=[],this._limit=e,qA[t]=this),qA[t]}BA&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var XA=BA&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");BA&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),BA&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),BA&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");function JA(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}var ZA,$A,eO=BA&&navigator.userAgent&&navigator.userAgent.includes("Edge/");(aa=ZA=ZA||{})[aa.PROCESSING=0]="PROCESSING",aa[aa.DONE=1]="DONE",(t=$A=$A||{}).NEWNODE="newnode",t.REMOVENODE="removenode",t.CLAIM_HOST="claimhost",t.SYNC_HOST="synchost",t.REQUEST_LOCK="requestlock",t.ACQUIRE_LOCK="acquirelock",t.RELEASE_LOCK="releaselock";var tO,nO={},rO=(Object.defineProperty(_O.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(_O.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(_O.prototype,"isInSync",{get:function(){return this._state==ZA.DONE},enumerable:!1,configurable:!0}),_O.prototype._send=function(e,t){var n,e={nodeId:this.nodeId,requestId:null!=(n=null==(t=void 0===t?{}:t)?void 0:t.requestId)?n:JA(),key:this.key,op:e,data:null!=(n=t.data)?n:null,ts:Date.now()};return BA&&window.postMessage(e,"*"),e},_O.prototype._acquire=function(e){(e=void 0===e?null:e)?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null},_O.prototype._release=function(t){var e,n;this._currentItem&&this._currentItem.requestId===t&&(e=this._currentItem,this._currentItem=null,e.nodeId===this.nodeId&&this._send($A.RELEASE_LOCK,{requestId:e.requestId}),-1<(n=this._queue.findIndex(function(e){return e.requestId===t}))&&this._queue.splice(n,1),e.onReleased(t))},_O.prototype._requestLock=function(i){var s=this;return new Promise(function(t){var e,n={nodeId:i.nodeId,requestId:i.requestId,ts:i.ts,onAcquired:function(e){s.isHost&&s._send($A.ACQUIRE_LOCK,{requestId:e}),t()},onReleased:function(){s._acquire(s._queue[0])}},r=!1;for(e in s._queue)if(s._queue[e].ts>n.ts){s._queue.splice(parseInt(e),0,n),r=!0;break}r||s._queue.push(n),s._currentItem||s._acquire(s._queue[0])})},_O.prototype._sendSync=function(){var e;this.isHost&&this._send($A.SYNC_HOST,{data:{currentItemRequestId:null==(e=this._currentItem)?void 0:e.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},_O.prototype._waitUntilSyncCompleted=function(){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(e){t._activationQueue.push(e)})]:[2]})})},_O.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout(function(){e._completeSync()},8))},_O.prototype._completeSync=function(){this.isInSync||(this._state=ZA.DONE,this._activationQueue.forEach(function(e){return e()}),this._activationQueue=[])},_O.prototype.registerNode=function(){this._send($A.NEWNODE),this._waitSync()},_O.prototype.claimHost=function(){this._hostId=this.nodeId,this._send($A.CLAIM_HOST),this._waitSync()},_O.prototype.lock=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),t=this._send($A.REQUEST_LOCK),[4,this._requestLock(t)];case 2:return e.sent(),[2]}})})},_O.prototype.unlock=function(){var e;this._release(null==(e=this._currentItem)?void 0:e.requestId)},_O),iO=(vO.metadataOf=function(n,r,i){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=EA(n,r),[4,i.get(t)];case 1:return[2,e.sent()]}})})},Object.defineProperty(vO.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(vO.prototype,"isReady",{get:function(){return this._state===uA.READY},enumerable:!1,configurable:!0}),vO.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d,f,p=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._mutex.lock()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,9,,10]),t=Q1.get(this.dbname),[4,vO.metadataOf(this.dbname,this.name,this._store)];case 3:return n=e.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:e.sent(),this._blockManager=new GA({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=G_([],H_(this.indexes),!1),i=[],s=r.map(function(e){return VA.createKey(e)}),a=n?n.indexes.map(function(e){return VA.createKey(e)}):[];try{for(o=se(a),u=o.next();!u.done;u=o.next())c=u.value,s.includes(c)||i.push(VA.parseKey(c))}catch(e){d={error:e}}finally{try{u&&!u.done&&(f=o.return)&&f.call(o)}finally{if(d)throw d.error}}return(l=[]).push.apply(l,G_([],H_(r.map(function(e){e=new VA({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store});return p._indexers.push(e),e.ensure()})),!1)),l.push.apply(l,G_([],H_(i.map(function(e){return new VA({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return e.sent(),[4,this._transaction.commit()];case 6:return e.sent(),s.sort().join(",")===a.sort().join(",")?[3,8]:(l=EA(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:l,value:this._metadata,generation:1})]);case 7:e.sent(),e.label=8;case 8:return this._state=uA.READY,this._mutex.unlock(),[3,10];case 9:throw h=e.sent(),this._mutex.unlock(),h;case 10:return[2]}})})},vO.prototype.close=function(){this._state=uA.CLOSED},vO.prototype._hasPropertyOfKeyName=function(e){e=e[this.keyName];return"string"==typeof e&&!!e},vO.prototype._getIndexerBy=function(e){e=(e=void 0===e?null:e)||[this.keyName];var t,n,r=VA.createKey(e);try{for(var i=se(this._indexers),s=i.next();!s.done;s=i.next()){var a=s.value;if(r===VA.createKey(a.fields))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},vO.prototype._upgradeBlockLevel=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=EA(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:t,value:this._metadata,generation:1})];case 1:return e.sent(),[2]}})})},vO.prototype._requestInsert=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return t=a[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return e.sent()?[3,13]:[4,this._blockManager.putToBlock(t,a)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,a)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),n=se(this._indexers),r=n.next(),e.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(a)];case 7:e.sent(),e.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=e.sent(),i={error:i},[3,12];case 11:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 12:return[3,14];case 13:throw lA.collectionInsertDuplicate;case 14:return[2]}})})},vO.prototype._requestUpsert=function(d){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h;return ie(this,function(e){switch(e.label){case 0:return t=d[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[3,13]:[4,this._blockManager.putToBlock(t,d)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,d)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),r=se(this._indexers),i=r.next(),e.label=6;case 6:return i.done?[3,9]:[4,(o=i.value).addItem(d)];case 7:e.sent(),e.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return u=e.sent(),u={error:u},[3,12];case 11:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,d)];case 14:e.sent(),e.label=15;case 15:e.trys.push([15,21,22,23]),s=se(this._indexers),a=s.next(),e.label=16;case 16:return a.done?[3,20]:0===(o=a.value).diff(o.getColumnValues(n),o.getColumnValues(d))?[3,19]:[4,o.removeItem(n)];case 17:return e.sent(),[4,o.addItem(d)];case 18:e.sent(),e.label=19;case 19:return a=s.next(),[3,16];case 20:return[3,23];case 21:return l=e.sent(),l={error:l},[3,23];case 22:try{a&&!a.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}return[7];case 23:return[2]}})})},vO.prototype._requestUpdate=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return t=u[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[4,this._blockManager.putToBlock(t,u)]:[3,11];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,9,10,11]),r=se(this._indexers),i=r.next(),e.label=4;case 4:return i.done?[3,8]:0===(s=i.value).diff(s.getColumnValues(n),s.getColumnValues(u))?[3,7]:[4,s.removeItem(n)];case 5:return e.sent(),[4,s.addItem(u)];case 6:e.sent(),e.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return a=e.sent(),a={error:a},[3,11];case 10:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 11:return[2]}})})},vO.prototype._requestRemove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return[4,this._blockManager.getFromBlock(a)];case 1:return(t=e.sent())?[4,this._blockManager.removeFromBlock(a)]:[3,10];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),n=se(this._indexers),r=n.next(),e.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:e.sent(),e.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=e.sent(),i={error:i},[3,10];case 9:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 10:return[2]}})})},vO.prototype._requestClear=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:e.sent(),e.label=2;case 2:e.trys.push([2,7,8,9]),t=se(this._indexers),n=t.next(),e.label=3;case 3:return n.done?[3,6]:[4,n.value.clear()];case 4:e.sent(),e.label=5;case 5:return n=t.next(),[3,3];case 6:return[3,9];case 7:return r=e.sent(),r={error:r},[3,9];case 8:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}return[7];case 9:return[2]}})})},vO.prototype.getByKey=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(n)];case 3:return t=e.sent(),this._mutex.unlock(),[2,hA(t)];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[3,7];case 6:throw lA.collectionNotReady;case 7:return[2]}})})},vO.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new AA({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},vO.prototype.insertOne=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestInsert(hA(n))];throw lA.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw lA.collectionNotReady;case 9:return[2]}})})},vO.prototype.insertMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),u.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw lA.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=se(u),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(hA(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),s={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,u];case 12:return i=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),i;case 14:return[3,16];case 15:throw lA.collectionNotReady;case 16:return[2]}})})},vO.prototype.upsertOne=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpsert(hA(n))];throw lA.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw lA.collectionNotReady;case 9:return[2]}})})},vO.prototype.upsertMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),u.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw lA.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=se(u),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(hA(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),s={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,u];case 12:return i=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),i;case 14:return[3,16];case 15:throw lA.collectionNotReady;case 16:return[2]}})})},vO.prototype.update=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpdate(hA(n))];throw lA.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw lA.collectionNotReady;case 9:return[2]}})})},vO.prototype.updateIf=function(h,d){return re(this,void 0,void 0,function(){var i,s,t,n,r,a,o,u,c,l=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,15]),a=h.where,i=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,r=h.backward,r=void 0!==r&&r,s=[],[4,new NA({condition:i,blockManager:this._blockManager,backward:r,indexer:this._getIndexerBy(a)}).each(function(r){return re(l,void 0,void 0,function(){var t,n;return ie(this,function(e){if(r.error)throw r.stop(),r.error;if(r.hasNext){if(t=r.nextValue,pA(i,t)&&d.set){if("function"!=typeof d.set)for(n in d.set)t[n]=d.set[n];else d.set(t);s.push(t)}r.next()}else r.stop();return[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=se(s),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(r=n.value,[4,this._requestUpdate(hA(r))]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),u={error:a},[3,11];case 10:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,s];case 13:return o=e.sent(),[4,this._transaction.clear()];case 14:throw e.sent(),this._mutex.unlock(),o;case 15:return[3,17];case 16:throw this._transaction.clear(),lA.collectionNotReady;case 17:return[2]}})})},vO.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestRemove(n)];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw lA.collectionNotReady;case 9:return[2]}})})},vO.prototype.removeIf=function(h){return re(this,void 0,void 0,function(){var r,i,t,n,s,a,o,u,c,l=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,14]),a=h.where,r=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,s=h.backward,s=void 0!==s&&s,i=[],[4,new NA({condition:r,blockManager:this._blockManager,backward:s,indexer:this._getIndexerBy(a)}).each(function(n){return re(l,void 0,void 0,function(){var t;return ie(this,function(e){if(n.error)throw n.stop(),n.error;return n.hasNext?(t=n.nextValue,pA(r,t)&&(t=t[this.keyName],i.push(t)),n.next()):n.stop(),[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=se(i),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(s=n.value,[4,this._requestRemove(s)]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),u={error:a},[3,11];case 10:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,i];case 13:throw o=e.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw this._transaction.clear(),lA.collectionNotReady;case 16:return[2]}})})},vO.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw lA.collectionNotReady;case 9:return[2]}})})},vO.prototype.getBlob=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(t)];case 1:return[2,e.sent()]}})})},vO.prototype.saveBlob=function(t,n){return void 0===n&&(n=null),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.save(t,n)];case 1:return[2,e.sent()]}})})},vO.prototype.removeBlob=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(t)];case 1:return e.sent(),[2]}})})},vO.prototype.removeAllBlobs=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}})})},vO),sO={},aO=(Object.defineProperty(pO.prototype,"rawData",{get:function(){return sO[this.dbname]},set:function(e){sO[this.dbname]=e},enumerable:!1,configurable:!0}),pO.prototype.observe=function(t,e,n){var r=this;this.observer[t]={},e.forEach(function(e){return r.observer[t][e]=n})},pO.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this.dbname=n,sO[this.dbname]={},e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get(iy.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify(iy.value))throw lA.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(iy)];case 4:return e.sent(),[7];case 5:return[2]}})})},pO.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,Object.keys(sO[this.dbname]).filter(function(e){return e!==iy.key})]})})},pO.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,fA(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.get?t.get(n):null)throw t;return[2,sO[this.dbname][n]?this._encryption.decrypt(sO[this.dbname][n]):null]}})})},pO.prototype.set=function(i){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return[4,fA(this.delay)];case 1:if(e.sent(),t=i.key,r=i.value,n=this.observer[t],n=n&&n.set?n.set(t):null)throw n;if(n=this._encryption.encrypt(r),r=JSON.stringify(n),t===iy.key||r.length<this.itemSizeLimit)return sO[this.dbname][t]=n,[2,sO[this.dbname][t]];throw lA.storeItemSizeExceeded}})})},pO.prototype.setMany=function(t){return re(this,void 0,void 0,function(){var i,s=this;return ie(this,function(e){switch(e.label){case 0:return[4,fA(this.delay)];case 1:return e.sent(),i=[],t.forEach(function(e){var t,n=e.key,e=e.value,r=s.observer[n];r&&r.set&&r.set(n)?i.push(lA.collectionWriteFailed):(r=s._encryption.encrypt(e),t=JSON.stringify(r),n===iy.key||t.length<s.itemSizeLimit?(sO[s.dbname][n]=r,i.push(e)):i.push(lA.storeItemSizeExceeded))}),[2,i]}})})},pO.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,fA(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.remove?t.remove(n):null)throw t;return sO[this.dbname][n]&&delete sO[this.dbname][n],[2,n]}})})},pO.prototype.removeMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return[4,fA(this.delay)];case 1:e.sent();try{for(t=se(u),n=t.next();!n.done;n=t.next()){if(r=n.value,i=this.observer[r],s=i&&i.remove?i.remove(r):null)throw s;sO[this.dbname][r]&&delete sO[this.dbname][r]}}catch(e){a={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}}return[2,u]}})})},pO.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,fA(this.delay)];case 1:return e.sent(),sO[this.dbname]={},[2]}})})},pO),oO=(fO.prototype.init=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return this.dbname=i,[4,new Promise(function(e,t){var n;r._window&&BA?XA?((n=r._indexedDB.open("_testMozilla")).onerror=function(){return t(lA.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}):eO?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(lA.storeNotAvailableInPrivateBrowsing):e():t(lA.storeNotAvailable)})];case 1:return e.sent(),t=this,[4,new Promise(function(t,n){var e=r._indexedDB.open(i);e.addEventListener("upgradeneeded",function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"})}),e.addEventListener("success",function(e){return t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 2:t._database=e.sent(),e.label=3;case 3:return e.trys.push([3,,5,7]),[4,this.get(iy.key)];case 4:if((n=e.sent())&&JSON.stringify(n)!==JSON.stringify(iy.value))throw lA.storeEncryptionInvalid;return[3,7];case 5:return[4,this.set(iy)];case 6:return e.sent(),[7];case 7:return[2]}})})},fO.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").getAllKeys();e.addEventListener("success",function(e){t(e.target.result.filter(function(e){return e!==iy.key}))}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},fO.prototype.get=function(i){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").get(i);e.addEventListener("success",function(e){return t(e.target.result?r._encryption.decrypt(e.target.result.value):null)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},fO.prototype.set=function(t){return re(this,void 0,void 0,function(){var r,i,s=this;return ie(this,function(e){switch(e.label){case 0:return r=t.key,i=t.value,[4,new Promise(function(t,n){var e=s._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").put({key:r,value:s._encryption.encrypt(i)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return e.sent(),[2,i]}})})},fO.prototype.setMany=function(n){return re(this,void 0,void 0,function(){var t,i,s=this;return ie(this,function(e){switch(e.label){case 0:return t=[],i=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),n.forEach(function(e){var n=e.key,r=e.value;t.push(new Promise(function(t){var e=i.put({key:n,value:s._encryption.encrypt(r)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(){t(lA.collectionWriteFailed)})}))}),[4,Promise.all(t)];case 1:return e.sent(),[2,n.map(function(e){return e.value})]}})})},fO.prototype.remove=function(i){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").delete(i);n.addEventListener("success",function(){return e(i)}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},fO.prototype.removeMany=function(t){return re(this,void 0,void 0,function(){var i;return ie(this,function(e){switch(e.label){case 0:return i=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),[4,Promise.all(t.map(function(r){return new Promise(function(e,t){var n=i.delete(r);n.addEventListener("success",function(){return e(r)}),n.addEventListener("error",function(e){return t(e.target.error)})})}))];case 1:return[2,e.sent()]}})})},fO.prototype.clear=function(){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").clear();n.addEventListener("success",function(){return e()}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},fO),uO=(dO.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},dO.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},dO.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this.dbname=n,e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get(iy.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify(iy.value))throw lA.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(iy)];case 4:return e.sent(),[7];case 5:return[2]}})})},dO.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return t=this._getActualKey(iy.key),[4,this._asyncStorage.getAllKeys()];case 1:return[2,e.sent().filter(function(e){return n._isBelonging(e)&&e!==t}).map(function(e){return e.substring("".concat(n.dbname,"/").length)})]}})})},dO.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(n))];case 1:return[2,(t=e.sent())?this._encryption.decrypt(JSON.parse(t)):null]}})})},dO.prototype.set=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=r.key,n=r.value,n=JSON.stringify(this._encryption.encrypt(n)),t===iy.key||n.length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),n)]:[3,2];case 1:return e.sent(),[2,JSON.parse(n)];case 2:throw lA.storeItemSizeExceeded}})})},dO.prototype.setMany=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:t=[],n=[];try{for(r=se(h),i=r.next();!i.done;i=r.next()){s=i.value;try{a=s.key,o=s.value,u=JSON.stringify(this._encryption.encrypt(o)),a===iy.key||u.length<this.itemSizeLimit?(n.push([this._getActualKey(a),u]),t.push(o)):t.push(lA.storeItemSizeExceeded)}catch(e){t.push(lA.collectionWriteFailed)}}}catch(e){c={error:e}}finally{try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._asyncStorage.multiSet(n)];case 2:return e.sent(),[3,4];case 3:return e.sent(),[2,new Array(t.length).fill(lA.collectionWriteFailed)];case 4:return[2,t]}})})},dO.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.removeItem(this._getActualKey(t))];case 1:return e.sent(),[2,t]}})})},dO.prototype.removeMany=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.multiRemove(n.map(function(e){return t._getActualKey(e)}))];case 1:return e.sent(),[2,n]}})})},dO.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this.getAllKeys()];case 1:return t=e.sent(),[4,this.removeMany(t)];case 2:return e.sent(),[4,this.remove(iy.key)];case 3:return e.sent(),[2]}})})},dO),cO=!0,lO=(hO.off=function(){cO=!1},hO.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];cO&&console.log.apply(console,G_(["".concat("[NESTDB]","[LOG]")],H_(e),!1))},hO.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];cO&&console.warn.apply(console,G_(["".concat("[NESTDB]","[WARNING]")],H_(e),!1))},hO.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];cO&&console.error.apply(console,G_(["".concat("[NESTDB]","[ERROR]")],H_(e),!1))},hO);function hO(){}function dO(e){var t=e.AsyncStorage,e=e.encryption,e=void 0===e?sy:e;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=e}function fO(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;e=e.encryption,e=void 0===e?sy:e;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=e}function pO(e){var t=(e=void 0===e?{}:e).itemSizeLimit,t=void 0===t?4194304:t,n=e.delay,n=void 0===n?1:n,e=e.encryption,e=void 0===e?sy:e;this._encryption=e,this.itemSizeLimit=t,this.delay=n,this.observer={}}function vO(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,e=e.store,a=this;this._state=uA.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=G_([[r]],H_(s.filter(function(e){return VA.createKey(e)!==a.keyName})),!1),this._keyHash=i,this._store=e,this._mutex=new rO("".concat(RA(t,n),".lock")),this._blobContainer=new DA({dbname:t,collectionName:n,store:e}),this._transaction=new jA({dbname:t,collectionName:n,store:e})}function _O(e,t){void 0===t&&(t={});var f=this;return this._state=ZA.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],nO[e]&&!t.forceCreate||(this.nodeId=JA(),this.key=e,BA&&(!t.startAsInvisible&&"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&f.claimHost()}),window.addEventListener("message",function(e){var t,n,r=e.data,i=r.nodeId,s=r.requestId,a=r.key,o=r.op,u=r.data;if(i!==f.nodeId&&a===f.key)switch(o){case $A.NEWNODE:f._sendSync();break;case $A.CLAIM_HOST:f._sendSync(),f._hostId=i;break;case $A.SYNC_HOST:if(!f.isInSync){f._activationTimeout&&clearTimeout(f._activationTimeout);var c=u.currentItemRequestId,l=u.queue;try{for(var h=se(l),d=h.next();!d.done;d=h.next())!function(t){f._queue.findIndex(function(e){return e.requestId===t.requestId})<0&&f._requestLock({nodeId:t.nodeId,requestId:t.requestId,key:f.key,op:$A.REQUEST_LOCK,ts:t.ts})}(d.value)}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}f._currentItem=f._queue.find(function(e){return e.requestId===c}),f._completeSync()}break;case $A.REMOVENODE:f._queue=f._queue.filter(function(e){return e.nodeId!==r.nodeId}),f._currentItem&&f._currentItem.nodeId===r.nodeId&&(f._currentItem=null,f._acquire(f._queue[0]));break;case $A.REQUEST_LOCK:f._requestLock(r);break;case $A.ACQUIRE_LOCK:l=f._queue.find(function(e){return e.requestId===s});f._acquire(l);break;case $A.RELEASE_LOCK:f._release(s)}}),window.addEventListener("beforeunload",function(){f._send($A.REMOVENODE)})),nO[e]=this),nO[e]}(ra=tO=tO||{}).INIT="INIT",ra.OPENING="OPENING",ra.OPENED="OPENED",ra.CLOSED="CLOSED";Object.defineProperty(bO.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(bO.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),bO.prototype.commitSchema=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this._state!==tO.OPENING?[3,2]:[4,Promise.all(n.map(function(i){return re(t,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=i.collectionName,n=i.keyName,r=i.index,r=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new iO({dbname:this.name,collectionName:t,keyName:n,keyHash:i.keyHash||null,indexes:r,store:this._store})),[4,this._collections.get(t).init()];case 1:return e.sent(),[2]}})})}))];case 1:return e.sent(),[3,3];case 2:throw lA.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},bO.prototype.open=function(){var i;return re(this,void 0,void 0,function(){var o,n,u,r,c=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._globalMutex.lock()];case 1:if(e.sent(),this._state===tO.OPENED)return[3,15];this._state=tO.OPENING,e.label=2;case 2:return e.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return e.sent(),t=this.name,o="".concat(OA(t),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(o)];case 4:return u=null!=(i=e.sent())?i:n,[2,new Promise(function(r,i){function s(r){u.version<c._version?c._event.upgrade(u.version,function(n){return re(c,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:if(n)return[3,5];u.version++,u.collectionNames=Array.from(this._collections.keys()),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.set({key:o,value:u,generation:this._version})];case 2:return e.sent(),r({continued:!0}),[3,4];case 3:return t=e.sent(),r({continued:!1,err:t}),[3,4];case 4:return[3,6];case 5:r({continued:!1,err:n}),e.label=6;case 6:return[2]}})})}):r({continued:!1})}function a(e){var t,n=e.continued,e=void 0===(e=e.err)?null:e;void 0!==n&&n?setTimeout(function(){return s(a)},10):e?(lO.error(e.message),c._globalMutex.unlock(),c._event.error(e),i(e)):(t=[],u.collectionNames.forEach(function(n){c._collections.has(n)||t.push(re(c,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,iO.metadataOf(this.name,n,this._store)];case 1:return(t=e.sent())?(t=new iO({dbname:this.name,collectionName:n,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(n,t),[4,t.init()]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})}))}),Promise.all(t).then(function(){c._state=tO.OPENED,c._globalMutex.unlock(),c._event.success(),r()}).catch(function(e){lO.error(e.message),c._globalMutex.unlock(),c._event.error(e),i(e)}))}s(a)})];case 5:switch((r=e.sent()).code){case h1.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case h1.STORE_NOT_AVAILABLE:return[3,8];case h1.STORE_ENCRYPTION_INVALID:return[3,10]}return[3,13];case 6:return lO.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new aO({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 7:return e.sent(),[3,14];case 8:return lO.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new aO({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 9:return e.sent(),[3,14];case 10:return lO.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return e.sent(),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 12:return e.sent(),[3,14];case 13:throw lO.error(r.message),this._globalMutex.unlock(),this._event.error(r),r;case 14:return[3,15];case 15:return[2]}var t})})},bO.prototype.close=function(){this._collections.forEach(function(e){return e.close()}),this._state=tO.CLOSED},bO.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return e.sent(),[2]}})})},bO.prototype.reset=function(){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.close(),(t=FA.get(this.name))&&t.clearByCondition(function(e){return e.key.startsWith(OA(n.name))}),[4,this._store.clear()];case 1:return e.sent(),[2]}})})},bO.prototype.on=function(e,t){this._event[e]=t},bO.prototype.off=function(e){"function"==typeof this._event[e]&&(this._event[e]="upgrade"===e?mA:vA)},bO.prototype.collection=function(e){return this._collections.get(e)||null};var yO,mO=bO,gO=null,EO=(R.init=function(e){var t,n=e.appId,r=e.appVersion,r=void 0===r?null:r,i=e.modules,i=void 0===i?[]:i,s=e.options,s=void 0===s?new ry:s,a=e.debugMode,a=void 0!==a&&a,o=e.customApiHost,u=e.customWebSocketHost,c=e.newInstance,l=e.logLevel,h=e.localCacheEnabled,h=void 0!==h&&h,d=e.localCacheEncryption,e=e.useAsyncStorageStore,e=void 0===e?null:e;return!gO||void 0!==c&&c?(c="su-".concat(X_()),t=new aO({encryption:d=null!=d?d:{encrypt:function(e){return e},decrypt:function(e){return e}}}),a||(t=e?new uO({AsyncStorage:e,encryption:d}):new oO({encryption:d})),new N(c,{appId:n,appVersion:r,options:s,apiHost:null!=o?o:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=u?u:"wss://ws-".concat(n,".sendbird.com"),store:t,encryption:d,logLevel:l,localCacheEnabled:h,debugMode:a}),e=new R(c,s,G_(G_([],H_(i),!1),[new jb],!1)),gO=gO||e,e):gO},Object.defineProperty(R,"instance",{get:function(){return gO},enumerable:!1,configurable:!0}),Object.defineProperty(R,"version",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appId",{get:function(){return N.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appInfo",{get:function(){return N.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appVersion",{get:function(){var e;return null!=(e=N.of(this._iid).sdkState.appVersion)?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"debugMode",{get:function(){return N.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"logLevel",{get:function(){return N.of(this._iid).logger.level},set:function(e){N.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isCacheEnabled",{get:function(){return N.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"ekey",{get:function(){return am(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"currentUser",{get:function(){var e;return null!=(e=N.of(this._iid).sessionManager.currentUser)?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"connectionState",{get:function(){var e=N.of(this._iid).connectionManager;return e.isConnected?Dy.OPEN:e.isConnecting?Dy.CONNECTING:Dy.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"lastConnectedAt",{get:function(){var e=N.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),R.prototype._getPreferenceCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")},R.prototype._getUserProfileCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")},R.prototype.getMemoryStoreForDebugging=function(){var e=N.of(this._iid),t=e.debugMode,e=e.cacheContext;if(t)return e.store instanceof aO?e.store:null;throw g.debugModeRequired},R.prototype.addExtension=function(e,t){var n=N.of(this._iid).sdkState;-1<["sb_uikit","sb_syncmanager"].indexOf(e)&&(n.extensions[e]=t)},R.prototype.initializeCache=function(o){return re(this,void 0,void 0,function(){var t,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return i=N.of(this._iid),t=i.sdkState,r=i.cacheContext,s=i.connectionManager,i=i.dispatcher,t.userId&&t.userId===o?[3,6]:[4,s.logout()];case 1:return e.sent(),t.userId=o,r.localCacheEnabled?(s="sendbird@".concat(t.appId,"/").concat(o,".db"),r.nestdb&&r.nestdb.state!==tO.CLOSED&&r.nestdb.name===s?[3,3]:((a=r.nestdb=new mO({name:"sendbird@".concat(t.appId,"/").concat(o,".db"),version:1,store:r.store})).on("upgrade",(n=a,function(e,t){0===e?n.commitSchema([{collectionName:"GroupChannel",keyName:"url",index:[JS(XS.LATEST_LAST_MESSAGE),JS(XS.CHRONOLOGICAL),JS(XS.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:"Message",keyName:"messageId",index:[tC(ZS.CHANNEL_LATEST),tC(ZS.NEWEST_CHILD_MESSAGE)]},{collectionName:"UnsentMessage",keyName:"reqId",index:[tC(ZS.CHANNEL_LATEST),tC(ZS.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]).then(function(){return t()}).catch(function(e){return t(e)}):t()})),[4,a.open()])):[3,6];case 2:e.sent(),i.dispatch(new TC(this._iid,{userId:o})),e.label=3;case 3:return[4,r.preference.init(this._getPreferenceCacheKey(o))];case 4:return e.sent(),[4,r.preference.get(this._getUserProfileCacheKey(o))];case 5:(a=e.sent())&&new rE(this._iid,a).apply(),e.label=6;case 6:return[2]}var n})})},R.prototype.clearCachedData=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return(t=N.of(this._iid).cacheContext).localCacheEnabled?(t.nestdb&&t.nestdb.clear(),[4,t.preference.clear()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.clearCachedMessages=function(t){return re(this,void 0,void 0,function(){var n,r,i=this;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",t)).throw(g.invalidParameters),n=cC.of(this._iid),r=oC.of(this._iid),n&&r?[4,Promise.all(t.map(function(t){return re(i,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,n.removeMessagesOfChannel(t)];case 1:return e.sent(),[4,r.removeMessagesOfChannel(t)];case 2:return e.sent(),[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.connect=function(a,o){return void 0===o&&(o=null),re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:i=N.of(this._iid),t=i.sdkState,n=i.cacheContext,r=i.connectionManager,i=i.statLogCollector,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.initializeCache(a)];case 2:return e.sent(),[3,4];case 3:return e.sent(),s=N.of(this._iid).logger,n.localCacheEnabled=!1,s.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return[4,i.init("sendbird@".concat(t.appId,"/").concat(a,".statlog"))];case 5:return e.sent(),[4,r.connect(o)];case 6:return e.sent(),this._appStateChangeDetector.start(),t.appState="foreground",[4,null==(s=dC.of(this._iid))?void 0:s.processNonAutoResendRegisteredPendingMessages()];case 7:return e.sent(),this._onlineDetector.start(),[2,this.currentUser]}})})},R.prototype.reconnect=function(){var e=N.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.sessionManager.auth.hasSession;return e&&t.resetAndReconnect().then(function(){n.appState="foreground"}).catch(function(){}),e},R.prototype.disconnect=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return r=N.of(this._iid),t=r.connectionManager,n=r.cacheContext,r=r.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return e.sent(),n.localCacheEnabled?[4,this.clearCachedData()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},R.prototype.setBackgroundState=function(){var e=N.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"foreground"===n.appState&&(n.appState="background",e.debug("going background state"),t.background())},R.prototype.setForegroundState=function(){var e=N.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"background"===n.appState&&(n.appState="foreground",e.debug("going foreground state"),t.resetAndReconnect())},R.prototype.setSessionHandler=function(e){C(!1).throw(g.invalidParameters),N.of(this._iid).sessionManager.handler=e},R.prototype.addUserEventHandler=function(e,t){C(I("string",e)&&!1).throw(g.invalidParameters),N.of(this._iid).userEventHandlers.set(e,t)},R.prototype.removeUserEventHandler=function(e){N.of(this._iid).userEventHandlers.delete(e)},R.prototype.removeAllUserEventHandler=function(){N.of(this._iid).userEventHandlers.clear()},R.prototype.addConnectionHandler=function(e,t){C(I("string",e)&&!1).throw(g.invalidParameters),N.of(this._iid).connectionHandlers.set(e,t)},R.prototype.removeConnectionHandler=function(e){N.of(this._iid).connectionHandlers.delete(e)},R.prototype.removeAllConnectionHandler=function(){N.of(this._iid).connectionHandlers.clear()},R.prototype.createApplicationUserListQuery=function(e){return new U1(this._iid,e=void 0===e?{}:e)},R.prototype.createBlockedUserListQuery=function(e){return new j1(this._iid,e=void 0===e?{}:e)},R.prototype.createFriendListQuery=function(e){return new V1(this._iid,e=void 0===e?{}:e)},R.prototype.createMessageSearchQuery=function(e){return new Ub(this._iid,e)},R.prototype.buildUserFromSerializedData=function(e){e=zg(e);return new k(this._iid,k.payloadify(e))},R.prototype.updateCurrentUserInfo=function(i){return void 0===i&&(i={}),re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){switch(e.label){case 0:return i=y(y({},VC),i),C(W_((t=i).profileImage,!0)&&I("string",t.profileUrl,!0)&&I("string",t.nickname,!0)).throw(g.invalidParameters),this.currentUser?(n=N.of(this._iid),r=n.sdkState,n=n.requestQueue,r=new KC(y({userId:r.userId},i)),[4,n.send(r)]):[3,2];case 1:return n=e.sent(),r=n.as(zC).user,this.currentUser&&(i.nickname&&(this.currentUser.nickname=r.nickname),(i.profileUrl||i.profileImage)&&(this.currentUser.plainProfileUrl=r.profileUrl)),[2,r];case 2:throw g.connectionRequired}var t})})},R.prototype.updateCurrentUserInfoWithPreferredLanguages=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",r)).throw(g.invalidParameters),this.currentUser?(t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new KC({userId:n.userId,preferredLanguages:r}),[4,t.send(n)]):[3,2];case 1:return t=e.sent(),n=t.as(zC).user,this.currentUser&&(this.currentUser.preferredLanguages=n.preferredLanguages),[2,n];case 2:throw g.connectionRequired}})})},R.prototype.registerFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(I("string",r)).throw(g.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new nk({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,wS.SUCCESS];case 3:return e.sent(),[2,wS.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,wS.PENDING];case 6:return[2]}})})},R.prototype.unregisterFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(I("string",r)).throw(g.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new lk({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,wS.SUCCESS];case 3:return e.sent(),[2,wS.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,wS.PENDING];case 6:return[2]}})})},R.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return this.currentUser?(t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new mk({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.registerAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(I("string",r)).throw(g.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new WC({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,wS.SUCCESS];case 3:return e.sent(),[2,wS.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,wS.PENDING];case 6:return[2]}})})},R.prototype.unregisterAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(C(I("string",r)).throw(g.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new ak({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,wS.SUCCESS];case 3:return e.sent(),[2,wS.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,wS.PENDING];case 6:return[2]}})})},R.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return this.currentUser?(t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new pk({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.getChannelInvitationPreference=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new qk({userId:n.userId}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(Fk).autoAccept}]}})})},R.prototype.setChannelInvitationPreference=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("boolean",r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new jk({userId:n.userId,willAutoAccept:r}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(Hk).autoAccept}]}})})},R.prototype.getDoNotDisturb=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Gk({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(Vk).preference]}})})},R.prototype.setDoNotDisturb=function(r,i,s,a,o,u){return void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===u&&(u=""),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("boolean",r)&&I("number",i)&&I("number",s)&&I("number",a)&&I("number",o)&&I("string",u)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Bk({userId:n.userId,doNotDisturbOn:r,startHour:i,startMin:s,endHour:a,endMin:o,timezone:u}),[4,t.send(n)];case 1:return[2,e.sent().as(Qk).preference]}})})},R.prototype.getSnoozePeriod=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Kk({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(zk).snoozePeriod]}})})},R.prototype.setSnoozePeriod=function(r,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("boolean",r)&&I("number",i)&&I("number",s)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Wk({userId:n.userId,snoozeOn:r,startTs:i,endTs:s}),[4,t.send(n)];case 1:return[2,e.sent().as(Yk).snoozePeriod]}})})},R.prototype.getMyPushTokensByToken=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)&&ty(SS,i)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Pk({userId:n.userId,type:i,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(Uk).pushTokens]}})})},R.prototype.getPushTriggerOption=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new CC({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(kC).pushTriggerOption]}})})},R.prototype.setPushTriggerOption=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ty(TS,r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new NC({userId:n.userId,pushTriggerOption:r}),[4,t.send(n)];case 1:return[2,e.sent().as(AC).pushTriggerOption]}})})},R.prototype.getPushTemplate=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new CN({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(kN).name]}})})},R.prototype.setPushTemplate=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ty(CS,r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new NN({userId:n.userId,templateName:r}),[4,t.send(n)];case 1:return[2,e.sent().as(AN).name]}})})},R.prototype.blockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof k||I("string",r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Xk({userId:n.userId,blockedUserId:r instanceof k?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.blockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.blockUser(t)]})})},R.prototype.unblockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(r instanceof k||I("string",r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new pN({userId:n.userId,unblockedUserId:r instanceof k?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.unblockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unblockUser(t)]})})},R.prototype.getFriendChangeLogsByToken=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new ON({userId:n.userId,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(RN).changelogs]}})})},R.prototype.getAllowFriendDiscovery=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new i1({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(s1).allowFriendDiscovery]}})})},R.prototype.setAllowFriendDiscovery=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("boolean",r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new a1({userId:n.userId,allowFriendDiscovery:r}),[4,t.send(n)];case 1:return e.sent(),[2,r]}})})},R.prototype.uploadFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new DN({userId:n.userId,discoveries:r}),[4,t.send(n)];case 1:return[2,e.sent().as(MN).friendDiscoveryRequestId]}})})},R.prototype.deleteFriendDiscovery=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.deleteFriendDiscoveries([t])]})})},R.prototype.deleteFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new xN({userId:n.userId,discoveryKeys:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.addFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new WN({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return[2,e.sent().as(YN).users]}})})},R.prototype.deleteFriend=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.deleteFriends([t])]})})},R.prototype.deleteFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(ny("string",r)).throw(g.invalidParameters),t=N.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new XN({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.getAllEmoji=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new A1,[4,t.send(n)];case 1:return[2,e.sent().as(O1).emojiContainer]}})})},R.prototype.getEmojiCategory=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new R1({categoryId:r}),[4,t.send(n)];case 1:return[2,e.sent().as(D1).emojiCategory]}})})},R.prototype.getEmoji=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new M1({key:r}),[4,t.send(n)];case 1:return[2,e.sent().as(x1).emoji]}})})},R);function R(a,e,t){var o=this,e=(this._fcmPushToken=null,this._apnsPushToken=null,this._iid=a,this.options=e,N.of(a)),u=e.sdkState,c=e.cacheContext,n=e.dispatcher,r=e.sessionManager,i=e.requestQueue,s=e.logger,l=e.userEventHandlers;this._onlineDetector=new QC({logger:s,connectionDelegate:{reconnect:function(){var e=N.of(a),t=e.sdkState,e=e.connectionManager;"foreground"===t.appState&&e.resetAndReconnect()},disconnect:function(){N.of(a).connectionManager.disconnect()}}}),new dC(a,{localCacheEnabled:c.localCacheEnabled,dispatcher:n,sdkState:u,logger:s}),t.forEach(function(e){e.init(a,{sdkState:u,cacheContext:c,dispatcher:n,sessionManager:r,requestQueue:i,logger:s,onlineDetector:o._onlineDetector}),o[e.name]=e}),this._appStateChangeDetector=new BC,this._appStateChangeDetector.on("resume",function(){s.debug("the page resumes from freeze"),o.setForegroundState()}).on("pause",function(){s.debug("the page freezes"),o.setBackgroundState()}),n.on(function(e){var t;if(e instanceof qy)"USEV"===e.code&&(i=e.as(SC).event).category===nC.FRIEND_DISCOVERED&&(t=wC.getDataAsFriendDiscoveredEvent(a,i).friendDiscoveries,ae(function(){return re(o,void 0,void 0,function(){return ie(this,function(e){return[2,l.forEach(function(e){e.onFriendsDiscovered(t)})]})})}));else if(e instanceof $y){var n=N.of(o._iid).subscribedUnreadMessageCount,r=!1,i=e.ts;if("number"==typeof i&&i>n.ts){if(n.all!==e.all&&(r=!0),n.all=0<=e.all?e.all:0,e.customTypes)for(var s in e.customTypes)n.customTypes[s]!==e.customTypes[s]&&(r=!0),n.customTypes[s]=e.customTypes[s];r=r&&0<n.ts,n.ts=i}r&&ae(function(){return re(o,void 0,void 0,function(){return ie(this,function(e){return[2,l.forEach(function(e){e.onTotalUnreadMessageCountUpdated(n.all,n.customTypes)})]})})})}else e instanceof nE&&c.localCacheEnabled&&c.preference.set(o._getUserProfileCacheKey(u.userId),rE.payloadify(e.userProfile))})}function bO(e){var t=e.name,n=e.version,r=e.store,e=e.config;this.name=t,this._version=n,this._state=tO.INIT,this._config=e||new Q1({dbname:t}),this._store=r,this._event={success:vA,error:vA,upgrade:mA},this._collections=new Map,this._globalMutex=new rO("".concat(this.name,".lock")),this._config.disableLogger&&lO.off(),new FA({dbname:t,limit:this._config.cacheLimit})}(n=yO=yO||{})[n.NONE=0]="NONE",n[n.CHANNEL_ENTER=10102]="CHANNEL_ENTER",n[n.CHANNEL_EXIT=10103]="CHANNEL_EXIT",n[n.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",n[n.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",n[n.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",n[n.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",n[n.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",n[n.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",n[n.TYPING_START=10900]="TYPING_START",n[n.TYPING_END=10901]="TYPING_END",n[n.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",n[n.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",n[n.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",n[n.CHANNEL_INVITE=10020]="CHANNEL_INVITE",n[n.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",n[n.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",n[n.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",n[n.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",n[n.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",n[n.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",n[n.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",n[n.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE";Object.defineProperty(BO.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===um.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(BO.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===um.OPEN},enumerable:!1,configurable:!0});var IO,wO,TO,SO,CO,kO,NO,AO=BO,OO=(l(VO,NO=qy),VO),RO=(l(GO,kO=OO),GO),DO=(l(HO,CO=qy),HO),MO=(l(jO,SO=qy),jO),xO=(l(FO,TO=qy),FO),LO=(l(qO,wO=qy),qO),PO=(l(UO,IO=qy),UO);function UO(e,t,n){var r=IO.call(this,e,"MTHD",n)||this;return r.event=new vb(e,n),r}function qO(e,t,n){e=wO.call(this,e,"MRCT",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.event=new LE(n),e}function FO(e,t,n){var r,i=this,e=((i=TO.call(this,e,"AEDI",n)||this).message=new l0(e,n),N.of(e).sdkState);return i.mentionCountChange=Tg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function jO(e,t,n){var r,i=this,e=((i=SO.call(this,e,"ADMM",n)||this).message=new l0(e,n),N.of(e).sdkState);return i.isMentioned=Rg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function HO(e,t,n){e=CO.call(this,e,"MCNT",n)||this;return e.groupChannelMemberCounts=n.group_channels.map(function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}}),e.openChannelMemberCounts=n.open_channels.map(function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}}),e}function GO(e,t,n){var r=kO.call(this,e,t,n)||this,e=n.data.operators,t=void 0===e?[]:e;return r.operators=t.map(function(e){return new k(r._iid,e)}),r}function VO(e,t,n){e=NO.call(this,e,"SYEV",n)||this;return e.event=new AO(n),e}function BO(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}l(iR,WO=qn),Object.defineProperty(iR.prototype,"enteredChannels",{get:function(){var t=this;return this._enteredChannelUrls.map(function(e){return t._channels.get(e)}).filter(function(e){return null!==e})},enumerable:!1,configurable:!0}),iR.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},iR.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},iR.prototype.exit=function(e){e=this._enteredChannelUrls.indexOf(e);0<=e&&this._enteredChannelUrls.splice(e,1)},iR.prototype.exitAll=function(){this._enteredChannelUrls=[]},iR.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,null!=(n=this._channels.get(t))?n:null]})})},iR.prototype.upsert=function(t){return re(this,void 0,void 0,function(){var n=this;return ie(this,function(e){return t.forEach(function(e){var t;n._channels.has(e.url)?(t=n._channels.get(e.url),Object.assign(t,e)):n._channels.set(e.url,e)}),[2]})})},iR.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._channels.delete(t),this.exit(t),[2]})})},iR.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]})})};var QO,KO,zO,WO,YO,XO=iR,JO={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},ZO=(l(rR,zO=T),rR),$O=(l(nR,KO=S),nR),eR=(l(tR,QO=T),tR);function tR(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,i=e.name,s=e.data,a=e.customType,e=e.operatorUserIds;return(t=QO.call(this)||this).method=b.POST,t.path=Xm,t.params=E({channel_url:n,cover_url:I("string",r)?r:null,cover_file:W_(r)?r:null,name:i,data:s,custom_type:a,operators:e}),t}function nR(e,t){var n=KO.call(this,e,t)||this;return n.channel=null,n.channel=new VR(e,t),n}function rR(e){var t=e.channelUrl,e=e.isInternalCall,n=zO.call(this)||this;return n.method=b.GET,n.path="".concat(e?Jm:Xm,"/").concat(encodeURIComponent(t)),n}function iR(){var e=null!==WO&&WO.apply(this,arguments)||this;return e._channels=new Map,e._enteredChannelUrls=[],e}l(function(e,t){var n=YO.call(this,e,t)||this;return n.channel=new VR(e,t),n},YO=S);l(FR,pR=Fy);var sR,aR,oR,uR,cR,lR,hR,dR,fR,pR,vR,_R=FR,yR=(l(qR,fR=qy),qR),mR=(l(UR,dR=Fy),UR),gR=(l(PR,hR=qy),PR),ER={},bR=(LR.of=function(e){return ER[e]},LR.prototype.buildOpenChannelFromSerializedData=function(e){e=zg(e);return new VR(e._iid,VR.payloadify(e))},LR.prototype.getChannelFromCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.get(t)];case 1:return[2,e.sent()]}})})},LR.prototype.upsertChannelsToCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.upsert(t)];case 1:return e.sent(),[2]}})})},LR.prototype.removeChannelsFromCache=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,7]),t=se(a),n=t.next(),e.label=1;case 1:return n.done?[3,4]:(r=n.value,[4,this._openChannelCache.remove(r)]);case 2:e.sent(),e.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=e.sent(),i={error:r},[3,7];case 6:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}})})},LR.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},LR.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},LR.prototype._handleEvent=function(ne){return re(this,void 0,void 0,function(){var a,U,o,t,u,c,q,l,n,r,F,j,s,H,G,h,i,d,f,p,v,_,y,V,B,m,g,E,Q,K,b,I,w,T,S,C,k,z,N,W,A,Y,O,R,D,M,x,L,X,J,Z,$,ee,te,P=this;return ie(this,function(e){switch(e.label){case 0:switch(e.trys.push([0,51,,52]),ne.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"SYEV":return[3,27]}return[3,50];case 1:return t=null,"MESG"===ne.code?t=ne.as(WT):"FILE"===ne.code?t=ne.as(m0):"ADMM"!==ne.code&&"BRDM"!=ne.code||(t=ne.as(MO)),t?(a=t.message,U=t.isMentioned,a.channelType!==um.OPEN?[3,3]:[4,this.getChannel(a.channelUrl,!0)]):[3,3];case 2:o=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(o.url)&&r.onMessageReceived(o,a),U&&r.onMentionReceived(o,a)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=3;case 3:return[3,50];case 4:return t=null,"MEDI"===ne.code?t=ne.as(XT):"FEDI"===ne.code?t=ne.as(ZT):"AEDI"===ne.code&&(t=ne.as(xO)),!t||(u=t.message).channelType!==um.OPEN?[3,6]:[4,this.getChannel(u.channelUrl,!0)];case 5:c=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(c.url)&&r.onMessageUpdated(c,u)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=6;case 6:return[3,50];case 7:return n=ne.as(kS),f=n.channelUrl,r=n.channelType,q=n.messageId,r!==um.OPEN?[3,9]:[4,this.getChannel(f,!0)];case 8:l=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(l.url)&&r.onMessageDeleted(l,q)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=9;case 9:return[3,50];case 10:return n=ne.as(LO),f=n.channelUrl,r=n.channelType,F=n.event,r!==um.OPEN?[3,12]:[4,this.getChannel(f,!0)];case 11:j=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onReactionUpdated(j,F)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=12;case 12:return[3,50];case 13:return(s=ne.as(PO).event).channelType!==um.OPEN?[3,15]:[4,this.getChannel(s.channelUrl,!0)];case 14:H=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onThreadInfoUpdated(H,s)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=15;case 15:return[3,50];case 16:G=ne.as(DO).openChannelMemberCounts,h=[],e.label=17;case 17:e.trys.push([17,22,23,24]),i=se(G),d=i.next(),e.label=18;case 18:return d.done?[3,21]:(p=d.value,f=p.channelUrl,E=p.participantCount,p=p.updatedAt,[4,this.getChannelFromCache(f)]);case 19:(v=e.sent())&&v._updateParticipantCount(E,p)&&h.push(v),e.label=20;case 20:return d=i.next(),[3,18];case 21:return[3,24];case 22:return v=e.sent(),ee={error:v},[3,24];case 23:try{d&&!d.done&&(te=i.return)&&te.call(i)}finally{if(ee)throw ee.error}return[7];case 24:return 0<h.length?[4,this.upsertChannelsToCache(h)]:[3,26];case 25:e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onChannelMemberCountChanged(h)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=26;case 26:return[3,50];case 27:if((_=ne.as(OO).event).isOpenChannelEvent)switch(_.category){case yO.CHANNEL_ENTER:return[3,28];case yO.CHANNEL_EXIT:return[3,30];case yO.CHANNEL_OPERATOR_UPDATE:return[3,32];case yO.USER_CHANNEL_MUTE:case yO.USER_CHANNEL_UNMUTE:return[3,34];case yO.USER_CHANNEL_BAN:case yO.USER_CHANNEL_UNBAN:return[3,36];case yO.CHANNEL_FREEZE:case yO.CHANNEL_UNFREEZE:return[3,38];case yO.CHANNEL_DELETED:return[3,40];case yO.CHANNEL_PROP_CHANGED:return[3,43];case yO.CHANNEL_META_DATA_CHANGED:return[3,45];case yO.CHANNEL_META_COUNTERS_CHANGED:return[3,47]}return[3,49];case 28:return[4,this.getChannel(_.channelUrl,!0)];case 29:return y=e.sent(),g=ne.as(yR),E=g.participantCount,V=g.user,B=y._updateParticipantCount(E,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserEntered(y,V),B&&e.onChannelParticipantCountChanged(y)}),[2]})})}),[3,49];case 30:return[4,this.getChannel(_.channelUrl,!0)];case 31:return m=e.sent(),g=ne.as(gR),E=g.participantCount,Q=g.user,K=m._updateParticipantCount(E,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserExited(m,Q),K&&e.onChannelParticipantCountChanged(m)}),[2]})})}),[3,49];case 32:return[4,this.getChannel(_.channelUrl,!0)];case 33:return b=e.sent(),I=ne.as(RO).operators,b.operators=I,this.upsertChannelsToCache([b]),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onOperatorUpdated(b,I)}),[2]})})}),[3,49];case 34:return[4,this.getChannel(_.channelUrl,!0)];case 35:return w=e.sent(),T=_.category===yO.USER_CHANNEL_MUTE,S=ne.as(T?aT:fT).user,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){T?e.onUserMuted(w,S):e.onUserUnmuted(w,S)}),[2]})})}),[3,49];case 36:return[4,this.getChannel(_.channelUrl,!0)];case 37:return C=e.sent(),k=_.category===yO.USER_CHANNEL_BAN,z=ne.as(k?ET:kT).user,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){k?e.onUserBanned(C,z):e.onUserUnbanned(C,z)}),[2]})})}),[3,49];case 38:return[4,this.getChannel(_.channelUrl,!0)];case 39:return N=e.sent(),W=ne.as(VT).freeze,N.isFrozen=W,this.upsertChannelsToCache([N]),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){W?e.onChannelFrozen(N):e.onChannelUnfrozen(N)}),[2]})})}),[3,49];case 40:return[4,this.getChannel(_.channelUrl,!0)];case 41:return A=e.sent(),[4,this.removeChannelsFromCache([A.url])];case 42:return e.sent(),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelDeleted(A.url,A.channelType)}),[2]})})}),[3,49];case 43:return[4,this.getChannelWithoutCache(_.channelUrl,!0)];case 44:return Y=e.sent(),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelChanged(Y)}),[2]})})}),[3,49];case 45:return[4,this.getChannel(_.channelUrl,!0)];case 46:return O=e.sent(),L=ne.as(yw),R=L.created,D=L.updated,M=L.deleted,R&&O._upsertCachedMetaData(R,_.ts),D&&O._upsertCachedMetaData(D,_.ts),M&&O._removeFromCachedMetaData(M,_.ts),ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){R&&e.onMetaDataCreated(O,R),D&&e.onMetaDataUpdated(O,D),M&&e.onMetaDataDeleted(O,M)}),[2]})})}),[3,49];case 47:return[4,this.getChannel(_.channelUrl,!0)];case 48:return x=e.sent(),L=ne.as(Nw),X=L.created,J=L.updated,Z=L.deleted,ae(function(){return re(P,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){X&&e.onMetaCounterCreated(x,X),J&&e.onMetaCounterUpdated(x,J),Z&&e.onMetaCounterDeleted(x,Z)}),[2]})})}),[3,49];case 49:return[3,50];case 50:return[3,52];case 51:if($=e.sent(),Q_($))throw $;return[3,52];case 52:return[2]}})})},LR.prototype.addHandler=function(e,t){this._openChannelHandlers.set(e,t)},LR.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},LR.prototype.clearHandler=function(){this._openChannelHandlers.clear()},LR.prototype.getChannel=function(n,e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:C(I("string",n)).throw(g.invalidParameters),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.getChannelFromCache(n)];case 2:return(t=e.sent())?[2,t]:[3,4];case 3:return e.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(n)];case 5:return[2,e.sent()]}})})},LR.prototype.getChannelWithoutCache=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return C(I("string",r)).throw(g.invalidParameters),t=new ZO({channelUrl:r,isInternalCall:i}),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as($O).channel,[4,this.upsertChannelsToCache([n])];case 2:return e.sent(),[2,n]}})})},LR.prototype.createChannel=function(i){return re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){switch(e.label){case 0:return i=y(y({},JO),i),C(ny("string",(t=i).operatorUserIds,!0)&&(I("string",t.coverUrlOrImage)||W_(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&I("string",t.name,!0)&&I("string",t.data,!0)&&I("string",t.customType,!0)&&(I("string",t.channelUrl)&&/^\w+$/.test(t.channelUrl)||null===t.channelUrl)).throw(g.invalidParameters),n=new eR(i),[4,this._requestQueue.send(n)];case 1:return n=e.sent(),r=n.as($O).channel,this.upsertChannelsToCache([r]),[2,r]}var t})})},LR),IR={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},wR=(l(xR,lR=T),xR),TR=(l(MR,cR=S),MR),SR=(l(DR,uR=cs),DR.prototype._validate=function(){return uR.prototype._validate.call(this)},DR.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new wR(y(y({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(TR),r=n.participants,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw g.queryInProgress;case 4:return[3,6];case 5:throw g.invalidParameters;case 6:return[2]}})})},DR),CR=(l(RR,oR=T),RR),kR=(l(OR,aR=S),OR),NR=(l(AR,sR=T),AR);function AR(e){var t=this,e=e.channelUrl;return(t=sR.call(this)||this).method=b.DELETE,t.path="".concat(Xm,"/").concat(encodeURIComponent(e)),t}function OR(e,t){var n=aR.call(this,e,t)||this;return n.channel=new VR(e,t),n}function RR(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,i=e.name,s=e.data,a=e.customType,e=e.operatorUserIds;return(t=oR.call(this)||this).method=b.PUT,t.path="".concat(Xm,"/").concat(encodeURIComponent(n)),t.params=E({cover_url:I("string",r)?r:null,cover_file:W_(r)?r:null,name:i,data:s,custom_type:a,operators:e}),t}function DR(e,t,n){return uR.call(this,e,t,um.OPEN,n)||this}function MR(t,e){var n=cR.call(this,t,e)||this,r=(n.token=null,n.participants=[],e.next),e=e.participants;return n.token=r,n.participants=e.map(function(e){return new k(t,e)}),n}function xR(e){var t=this,n=e.channelUrl,r=e.token,e=e.limit;return(t=lR.call(this)||this).method=b.GET,t.path="".concat(Xm,"/").concat(encodeURIComponent(n),"/participants"),t.params={token:r,limit:e},t}function LR(e,t){var n=t.sdkState,r=t.dispatcher,t=t.requestQueue,a=this;this._sdkState=n,this._requestQueue=t,this._dispatcher=r,this._openChannelCache=new XO(e),this._openChannelHandlers=new Map,this._dispatcher.on(function(e){var t,n;if(e instanceof qy)a._handleEvent(e);else if(e instanceof Rm&&e.stateType===Yy.CONNECTED){var r=a._openChannelCache.enteredChannels;try{for(var i=se(r),s=i.next();!s.done;s=i.next())s.value.enter()}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}),ER[e]=this}function PR(e,t,n){var r,i=this,i=hR.call(this,e,"EXIT",n)||this;return n.data&&(i.participantCount=null!=(r=n.data.participant_count)?r:0,i.user=new k(e,n.data),i.ts=null!=(r=n.data.edge_ts)?r:0),i}function UR(e){e=e.channelUrl;return dR.call(this,{code:"EXIT",payload:{channel_url:e},ackRequired:!0})||this}function qR(e,t,n){var r,i=this,i=fR.call(this,e,"ENTR",n)||this;return n.data&&(i.participantCount=null!=(r=n.data.participant_count)?r:0,i.user=new k(e,n.data),i.ts=null!=(r=n.data.edge_ts)?r:0),i}function FR(e){e=e.channelUrl;return pR.call(this,{code:"ENTR",payload:{channel_url:e},ackRequired:!0})||this}l(function(e,t){return vR.call(this,e,t)||this},vR=S);l(BR,jR=qS),BR.payloadify=function(e){return e?E(y(y({},qS.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map(function(e){return k.payloadify(e)})})):null},BR.prototype.serialize=function(){return Kg(this)},BR.prototype.isOperator=function(t){return t instanceof k?this.isOperator(t.userId):this.operators.some(function(e){return e.userId===t})},BR.prototype._updateParticipantCount=function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)},BR.prototype.createParticipantListQuery=function(e){return new SR(this._iid,this.url,e)},BR.prototype.refresh=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,bR.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}})})},BR.prototype.enter=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new _R({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(yR),r=n.participantCount,i=n.ts,this._updateParticipantCount(r,i),bR.of(this._iid).setEnteredToCache(this),[2]}})})},BR.prototype.exit=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new mR({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(gR),r=n.participantCount,i=n.ts,this._updateParticipantCount(r,i),bR.of(this._iid).setExitedToCache(this),fb.of(this._iid).fileMessageQueue.cancel(this),[2]}})})},BR.prototype.updateChannel=function(s){return re(this,void 0,void 0,function(){var n,r,i;return ie(this,function(e){switch(e.label){case 0:return s=y(y({},IR),s),C(ny("string",(t=s).operatorUserIds,!0)&&(I("string",t.coverUrlOrImage)||W_(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&I("string",t.name,!0)&&I("string",t.data,!0)&&I("string",t.customType,!0)).throw(g.invalidParameters),r=N.of(this._iid).requestQueue,n=new CR(y({channelUrl:this.url},s)),[4,r.send(n)];case 1:return r=e.sent(),i=r.as(kR).channel,[4,bR.of(this._iid).upsertChannelsToCache([i])];case 2:return e.sent(),[2,i]}var t})})},BR.prototype.updateChannelWithOperatorUserIds=function(n,r,i,s,a){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=y(y({},IR),{name:n,coverUrlOrImage:r,data:i,operatorUserIds:s,customType:a}),[2,this.updateChannel(t)]})})},BR.prototype.delete=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=N.of(this._iid).requestQueue,n=new NR({channelUrl:this.url}),[4,t.send(n)];case 1:return e.sent(),[4,bR.of(this._iid).removeChannelsFromCache([this.url])];case 2:return e.sent(),[2]}})})};var jR,HR,GR,VR=BR;function BR(t,e){var n,r=this;return(r=jR.call(this,t,e)||this)._lastParticipantCountUpdated=0,r.participantCount=0,r.operators=[],r.channelType=um.OPEN,r.participantCount=null!=(n=e.participant_count)?n:0,r.operators=Array.isArray(e.operators)?e.operators.map(function(e){return new k(t,e)}):[],r}function QR(t){void 0===t&&(t={});var n=HR.call(this)||this;return Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&(n[e]=t[e])}),n}function KR(){var e=null!==GR&&GR.apply(this,arguments)||this;return e.onUserEntered=Ry,e.onUserExited=Ry,e.onChannelParticipantCountChanged=Ry,e}l(KR,GR=function(){this.onUserMuted=Ry,this.onUserUnmuted=Ry,this.onUserBanned=Ry,this.onUserUnbanned=Ry,this.onChannelChanged=Ry,this.onChannelDeleted=Ry,this.onChannelFrozen=Ry,this.onChannelUnfrozen=Ry,this.onOperatorUpdated=Ry,this.onChannelMemberCountChanged=Ry,this.onMetaDataCreated=Ry,this.onMetaDataUpdated=Ry,this.onMetaDataDeleted=Ry,this.onMetaCounterCreated=Ry,this.onMetaCounterUpdated=Ry,this.onMetaCounterDeleted=Ry,this.onMessageReceived=Ry,this.onMessageUpdated=Ry,this.onMessageDeleted=Ry,this.onMentionReceived=Ry,this.onReactionUpdated=Ry,this.onThreadInfoUpdated=Ry}),l(QR,HR=KR);l(iD,XR=T);var zR,WR,YR,XR,JR=iD,ZR=(l(rD,YR=S),rD),$R=(l(nD,WR=s),nD.prototype._validate=function(){return WR.prototype._validate.call(this)&&I("boolean",this.includeFrozen)&&I("boolean",this.includeMetaData)&&I("string",this.nameKeyword,!0)&&I("string",this.urlKeyword,!0)&&ny("string",this.customTypes,!0)},nD.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,t=N.of(this._iid).requestQueue,n=new JR(y(y({},this),{token:this._token})),[4,t.send(n)]):[3,3]:[3,6];case 1:return t=e.sent(),n=t.as(ZR),r=n.channels,i=n.token,this._token=i,this._hasNext=!!i,[4,bR.of(this._iid).upsertChannelsToCache(r)];case 2:return e.sent(),this._isLoading=!1,[2,r];case 3:return[2,[]];case 4:throw g.queryInProgress;case 5:return[3,7];case 6:throw g.invalidParameters;case 7:return[2]}})})},nD),eD=(l(tD,zR=oi),tD.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;zR.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new bR(e,{sdkState:n,dispatcher:r,requestQueue:s})},tD.prototype.createOpenChannelListQuery=function(e){return new $R(this._iid,e=void 0===e?{}:e)},tD.prototype.addOpenChannelHandler=function(e,t){this._manager.addHandler(e,t)},tD.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},tD.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},tD.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},tD.prototype.getChannel=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.getChannel(t)]})})},tD.prototype.getChannelWithoutCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.getChannelWithoutCache(t)]})})},tD.prototype.createChannel=function(t){return void 0===t&&(t={}),re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.createChannel(t)]})})},tD.prototype.createChannelWithOperatorUserIds=function(n,r,i,s,a){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return(t=y({},JO)).name=n,t.coverUrlOrImage=r,t.data=i,t.operatorUserIds=s,t.customType=a,[2,this._manager.createChannel(t)]})})},tD);function tD(){var e=null!==zR&&zR.apply(this,arguments)||this;return e.name="openChannel",e}function nD(e,t){var n=this;return(n=WR.call(this,e,t)||this).includeFrozen=!0,n.includeMetaData=!0,n.nameKeyword=null,n.urlKeyword=null,n.customTypes=null,n.includeFrozen=null==(e=t.includeFrozen)||e,n.includeMetaData=null==(e=t.includeMetaData)||e,n.nameKeyword=null!=(e=t.nameKeyword)?e:null,n.urlKeyword=null!=(e=t.urlKeyword)?e:null,n.customTypes=null!=(e=t.customTypes)?e:null,n}function rD(t,e){var n=YR.call(this,t,e)||this,r=(n.token=null,n.channels=[],n.ts=null,e.next),i=e.channels,e=e.ts;return n.token=r,i&&0<i.length&&(n.channels=i.map(function(e){return new VR(t,e)})),n.ts="number"==typeof e?e:null,n}function iD(e){var t=this,n=e.token,r=e.limit,i=e.nameKeyword,s=e.urlKeyword,a=e.customTypes,o=e.includeFrozen,e=e.includeMetaData;return(t=XR.call(this)||this).method=b.GET,t.path=Xm,t.params=E({token:n,limit:r,name_contains:i,url_contains:s,custom_types:a,show_frozen:o,show_metadata:e}),t}function sD(i){return function(e,t,n){var e=dD(fD(e)),t=hD(t),r=e.length,n=void 0===n?" ":dD(n);return t<=r||""==n?e:((r=pD(n,_D((t=t-r)/n.length))).length>t&&(r=vD(r,0,t)),i?e+r:r+e)}}var aD=function(){p(s,hh);var t,n,r,i=_(s);function s(e){var t;return d(this,s),(t=i.call(this))._ctx=e,t.wsClient=new q_(x(x({},e),{},{parse:function(e){return xl.parse(e)}})),t.apiClient=new F_(x(x({},e),{},{parseResponse:function(e,t){return xl.parseResponse(e,t)}})),t._unsubscriber=t.wsClient.on("command",function(e){t._dispatchEvent("command",e)}),t}return f(s,[{key:"connectWs",value:function(){return this.wsClient.connect()}},{key:"sendAPI",value:function(e){return this.apiClient.send(e)}},{key:"send",value:(r=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sendAPI(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"sendWithRetry",value:(n=h(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o=this,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<u.length&&void 0!==u[1]?u[1]:new kv,s=2<u.length&&void 0!==u[2]?u[2]:{count:0,deferred:new Sv},r=s.deferred,i=s.count,e.prev=3,e.next=6,this.send(t);case 6:s=e.sent,r.resolve(s),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),0<(a=n.calcTimeout(i))?setTimeout(function(){o.sendWithRetry(t,n,{count:i+1,deferred:r})},a):r.reject(e.t0);case 14:return e.abrupt("return",r.promise);case 15:case"end":return e.stop()}},e,this,[[3,10]])})),function(e){return n.apply(this,arguments)})},{key:"_setSessionKey",value:function(e){this.apiClient.setSessionKey(e),this.wsClient.setSessionKey(e)}},{key:"authenticate",value:(t=h(regeneratorRuntime.mark(function e(t){var n,r,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userId,r=t.accessToken,i=EO.init({appId:this._ctx.appId,modules:[new eD]}),this._ctx.sb=i,e.prev=3,e.next=6,i.connect(n,r);case 6:return i=xl.createAuth(this._ctx.appId,n,r),e.next=9,this.send(i);case 9:s=e.sent,this._setSessionKey(s.sbcall_session_token),this._ctx.liveEventManager.userId=s.user.user_id,e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(3),o.error("failed to authenticate user ".concat(n)),e.t0;case 18:case"end":return e.stop()}},e,this,[[3,14]])})),function(e){return t.apply(this,arguments)})},{key:"deauthenticate",value:function(){this.apiClient.clearSessionKey(),this.wsClient.clearSessionKey()}}]),s}(),oD=Te,uD=Qi,cD=ne,lD=RangeError,Yn=Ze,hD=Ce,dD=Qi,fD=ne,pD=Yn(function(e){var t=uD(cD(this)),n="",r=oD(e);if(r<0||r==1/0)throw lD("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}),vD=Yn("".slice),_D=Math.ceil,Yt={start:sD(!1),end:sD(!0)},tt=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(vt),yt=Re,yD=Yt.start,mD=(yt({target:"String",proto:!0,forced:tt},{padStart:function(e){return yD(this,e,1<arguments.length?arguments[1]:void 0)}}),{VERBOSE:{level:-1,name:$l.VERBOSE,public:!1},DEBUG:{level:1,name:$l.DEBUG,public:!1},INFO:{level:2,name:$l.INFO,public:!0},WARNING:{level:3,name:$l.WARNING,public:!0},ERROR:{level:4,name:$l.ERROR,public:!0},NONE:{level:100,name:$l.NONE,public:!0}}),gD=function(){function t(e){d(this,t),this.level=e||$l.NONE}return f(t,[{key:"setLoggerLevel",value:function(e){var t;return null!=(t=mD[e])&&t.public&&(this.level=e),this.level}},{key:"_enabledFor",value:function(e){try{return mD[this.level].level<=mD[e].level}catch(e){return!1}}}]),t}(),ED=function(){p(n,gD);var t=_(n);function n(e){return d(this,n),t.call(this,e)}return f(n,[{key:"_getLogType",value:function(e){switch(e){case $l.ERROR:return"error";case $l.WARNING:return"warn";default:return"log"}}},{key:"_getTimeString",value:function(e){var t=e.getFullYear().toString().padStart(2,"0"),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),a=e.getSeconds().toString().padStart(2,"0"),e=e.getMilliseconds().toString().padStart(2,"0");return"[".concat(t,".").concat(n,".").concat(r," ").concat(i,":").concat(s,":").concat(a,":").concat(e,"]")}},{key:"_permit",value:function(e){var t=this._getLogType(e),n=new Date;if(this._enabledFor(e)&&console&&console[t]){for(var n="".concat(this._getTimeString(n)," [").concat(e,"]"),r=arguments.length,i=new Array(1<r?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];(e=console)[t].apply(e,[n].concat(i))}}}]),n}(),ls=function(){function e(){d(this,e),u(this,"_ctx",{})}var t,n,r,i;return f(e,[{key:"init",value:function(e){this._consoleLogListener=new ED($l.NONE),o.addListener(this._consoleLogListener),this._ctx.appId=e,this._ctx.clientId=J(),this._ctx.commandRouter=new aD(this._ctx),this._ctx.deviceManager=new L_,this._ctx.liveEventManager=new Jv(this._ctx)}},{key:"setLoggerLevel",value:function(e){return this._consoleLogListener.setLoggerLevel(e)}},{key:"authenticate",value:(i=h(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.commandRouter.authenticate({userId:t,accessToken:n});case 2:return e.next=4,this._ctx.commandRouter.connectWs();case 4:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"deauthenticate",value:(r=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.sb.disconnect();case 2:this._ctx.commandRouter.deauthenticate(),this._ctx.liveEventManager.clear(),o.removeAllListener();case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"createLiveEvent",value:(n=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.liveEventManager.createLiveEvent(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getLiveEvent",value:(t=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.liveEventManager.getLiveEvent(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"createLiveEventListQuery",value:function(e){return new ks(e,this._ctx.commandRouter)}},{key:"getAvailableAudioInputDevices",value:function(){return this._ctx.deviceManager.getAvailableAudioInputDevices()}},{key:"getAvailableVideoInputDevices",value:function(){return this._ctx.deviceManager.getAvailableVideoInputDevices()}}]),e}(),i=(D.ErrorCode=void 0,(ti=D.ErrorCode||(D.ErrorCode={}))[ti.LIVE_EVENT_ID_NOT_FOUND=2800100]="LIVE_EVENT_ID_NOT_FOUND",ti[ti.ACTION_NOT_ALLOWED_IN_CURRENT_STATE=2800101]="ACTION_NOT_ALLOWED_IN_CURRENT_STATE",ti[ti.ACTION_NOT_ALLOWED_FOR_PARTICIPANT=2800102]="ACTION_NOT_ALLOWED_FOR_PARTICIPANT",ti[ti.USER_NOT_ENTERED_LIVE_EVENT=2800103]="USER_NOT_ENTERED_LIVE_EVENT",ti[ti.STREAM_NOT_STARTED=2800104]="STREAM_NOT_STARTED",ti[ti.CONNECTION_TO_MEDIA_STREAM_FAILED=2800105]="CONNECTION_TO_MEDIA_STREAM_FAILED",ti[ti.UNKNOWN_NETWORK_ERROR=2800400]="UNKNOWN_NETWORK_ERROR",ti[ti.QUERY_IN_PROGRESS=2800900]="QUERY_IN_PROGRESS",ti[ti.OPEN_CHANNEL_NOT_FETCHED=2800901]="OPEN_CHANNEL_NOT_FETCHED",new ls);D.LiveEvent=Xv,D.SendbirdLive=i,Object.defineProperty(D,"__esModule",{value:!0})});