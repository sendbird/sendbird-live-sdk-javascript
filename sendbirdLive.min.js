!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-js/modules/es.array.includes.js")):"function"==typeof define&&define.amd?define(["exports","core-js/modules/es.array.includes.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sendbirdLive={})}(this,function(M){"use strict";function c(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var k,L=new Uint8Array(16);function U(){if(k=k||"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto))return k(L);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}var P=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function x(e){return"string"==typeof e&&P.test(e)}for(var q=[],F=0;F<256;++F)q.push((F+256).toString(16).substr(1));function H(e,t){t=1<arguments.length&&void 0!==t?t:0,e=(q[e[t+0]]+q[e[t+1]]+q[e[t+2]]+q[e[t+3]]+"-"+q[e[t+4]]+q[e[t+5]]+"-"+q[e[t+6]]+q[e[t+7]]+"-"+q[e[t+8]]+q[e[t+9]]+"-"+q[e[t+10]]+q[e[t+11]]+q[e[t+12]]+q[e[t+13]]+q[e[t+14]]+q[e[t+15]]).toLowerCase();if(x(e))return e;throw TypeError("Stringified UUID is invalid")}function G(){try{0}catch(e){}}function V(e,t,n){var r=(e=e||{}).random||(e.rng||U)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var s=0;s<16;++s)t[n+s]=r[s];return t}return H(r)}G(),G();class B{}class Q extends B{constructor(){super(),c(this,"type",void 0)}getApiOption(){return{auth:this.getAuth(),path:this.getPath(),method:this.getMethod(),body:this.getData(),headers:this.getHeaders()}}getAuth(){return!0}getHeaders(){return{}}}class j extends Q{constructor(){super(),c(this,"type",void 0)}getPath(){return"/v1"+this.getSubPath()}}let i;(s=i=i||{}).CREATE="create",s.GET="get",s.DELETE="delete",s.QUERY="query",s.READY="ready",s.START="start",s.ENTER_HOST="enter_host",s.GET_HOSTS="get_hosts",s.EXIT_HOST="exit_host",s.HOST_ALIVE="host_alive",s.AUDIO="audio",s.VIDEO="video",s.HOST_CREATE_STREAM="host_create_stream",s.HOST_DELETE_STREAM="host_delete_stream",s.HOST_CONNECTED="host_connected",s.ENTER="enter",s.EXIT="exit",s.ALIVE="alive",s.GET_PARTICIPANTS="get_participants",s.CREATE_STREAM="create_stream",s.DELETE_STREAM="delete_stream",s.CONNECTED="connected",s.ATTACH="attach",s.LIVE_EVENT_READY="live_event_ready",s.LIVE_EVENT_STARTED="live_event_started",s.LIVE_EVENT_ENDED="live_event_ended",s.HOST_ENTERED="host_entered",s.HOST_EXITED="host_exited",s.HOST_DISCONNECTED="host_disconnected",s.HOST_AUDIO_STATUS_CHANGED="host_audio_status_changed",s.HOST_VIDEO_STATUS_CHANGED="host_video_status_changed",s.PARTICIPANT_ENTERED="participant_entered",s.PARTICIPANT_EXITED="participant_exited";let K;(s=K=K||{}).SINGLE_HOST="single_host",s.MULTIPLE_HOST="multiple_host";class z extends B{constructor(e){super(),c(this,"payload",void 0),this.payload=this.parseData(e)}}class W extends z{}function Y(e){return{liveEventId:e.live_event_id,createdAt:e.created_at,setReadyAt:e.set_ready_at,startedAt:e.started_at,endedAt:e.ended_at,state:e.state,isHostStreaming:e.is_host_streaming,createdBy:e.created_by,setReadyBy:e.set_ready_by,startedBy:e.started_by,endedBy:e.ended_by,duration:e.duration,host:e.host?$(e.host):void 0,participantCount:e.participantCount,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count,userIdsForHost:e.user_ids_for_host,customItems:e.custom_items}}function $(e){return{hostId:e.host_id,userId:e.user.user_id,nickname:e.uesr.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,connectedAt:e.connected_at,disconnectedAt:e.disconnected_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,isAudioOn:e.is_audio_on,isVideoOn:e.is_video_on,liveEventId:e.live_event_id}}function X(e){return{id:e.rtcstream_id}}function J(e){return{participantId:e.participant_id,userId:e.user.user_id,nickname:e.uesr.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,liveEventId:e.live_event_id}}function Z(t){return Object.keys(t).filter(e=>null!=t[e]).map(e=>encodeURIComponent(e)+"="+function(e){if(Array.isArray(e))return e.map(e=>encodeURIComponent(e.toString())).join(",");return encodeURIComponent(e.toString())}(t[e])).join("&")}class ee extends j{constructor(e,t,n){super(),c(this,"type",i.QUERY),c(this,"params",void 0),c(this,"prevToken",void 0),c(this,"nextToken",void 0),this.params=this._normalizeParams(e),this.prevToken=t,this.nextToken=n}getData(){}getSubPath(){return"/live-events?"+this._createQuery()}getMethod(){return"GET"}_normalizeParams(e){var{hostType:e,liveEventState:t,createdAtRange:n,participantCountRange:r,durationRange:s,liveEventIds:i,createdByUserIds:a,limit:o}=e;return{hostType:e,liveEventState:t,createdAtRange:n,participantCountRange:r,durationRange:s,liveEventIds:i,createdByUserIds:a,limit:null!=o?Math.min(Math.max(1,o),100):void 0}}_createQuery(){return Z({hostType:this.params.hostType,liveEventState:this.params.liveEventState,created_at_start_date:this.params.createdAtRange?.[0],created_at_end_date:this.params.createdAtRange?.[0],participant_count_gte:this.params.participantCountRange?.[0],participant_count_lte:this.params.participantCountRange?.[1],duration_range_gte:this.params.durationRange?.[0],duration_range_lte:this.params.durationRange?.[1],liveEventIds:this.params.liveEventIds,createdByUserIds:this.params.createdByUserIds,limit:this.params.limit,prev:this.prevToken,next:this.nextToken})}}class te extends W{parseData(e){return{liveEvents:e.live_events?.map(Y),prev:e.prev,next:e.next}}}class ne{constructor(e,t){c(this,"isLoading",void 0),c(this,"params",void 0),c(this,"sender",void 0),c(this,"prevToken",void 0),c(this,"nextToken",void 0),this.isLoading=!1,this.params=e,this.sender=t,this.prevToken=null,this.nextToken=null}get hasPrev(){return!!this.prevToken}get hasNext(){return!this.prevToken&&!this.nextToken||!!this.nextToken}async next(){if(this.isLoading)throw new Error("query is in progress");return this.hasNext?this._sendQueryCommand(null,this.nextToken):[]}async prev(){if(this.isLoading)throw new Error("query is in progress");return this.hasPrev?this._sendQueryCommand(this.prevToken,null):[]}async _sendQueryCommand(e,t){if(e&&t)throw new Error("internal error while creating LiveEventListQueryCommand");e=new ee(this.params,e,t),t=(await this.sender.send(e)).payload;return this.isLoading=!0,this.prevToken=t.prev,this.nextToken=t.next,this.isLoading=!1,t.liveEvents}}M.LiveEventRole=void 0,(s=M.LiveEventRole||(M.LiveEventRole={})).HOST="host",s.PARTICIPANT="participant",M.LiveEventState=void 0,(s=M.LiveEventState||(M.LiveEventState={})).CREATED="created",s.READY="ready",s.ONGOING="ongoing",s.PAUSED="paused",s.ENDED="ended",M.HostState=void 0,(s=M.HostState||(M.HostState={})).ENTERED="entered",s.CONNECTED="connected",s.DISCONNECTED="disconnected",s.EXITED="exited",M.ParticipantState=void 0,(s=M.ParticipantState||(M.ParticipantState={})).ENTERED="entered",s.EXITED="exited";class oe extends Q{constructor(e,t,n){super(),c(this,"appId",void 0),c(this,"userId",void 0),c(this,"accessToken",void 0),this.appId=e,this.userId=t,this.accessToken=n}getAuth(){return!1}getData(){return{app_id:this.appId,user_id:this.userId,access_token:this.accessToken}}getPath(){return`/v1/users/${encodeURIComponent(this.userId)}/login`}getMethod(){return"POST"}}let ce;(s=ce=ce||{}).POST="POST",s.GET="GET",s.DELETE="DELETE",s.OPTION="OPTION";class ue extends j{constructor(e,t){super(),c(this,"type",i.CREATE),c(this,"hostType",void 0),c(this,"hostIds",void 0),this.hostType=e,this.hostIds=Array.isArray(t)?t:[t]}getData(){return{host_type:this.hostType,user_ids_for_host:this.hostIds}}getSubPath(){return"/live-events"}getMethod(){return ce.POST}}class le extends W{parseData(e){return{liveEvent:Y(e.live_event)}}}class he extends j{constructor(e){super(),c(this,"type",i.GET),c(this,"liveEventId",void 0),this.liveEventId=e}getData(){}getSubPath(){return"/live-events/"+this.liveEventId}getMethod(){return ce.GET}}class de extends W{parseData(e){return{liveEvent:Y(e.live_event)}}}class pe extends j{constructor(e,t){super(),c(this,"type",i.ENTER_HOST),c(this,"liveEventId",void 0),c(this,"mediaOption",{turnAudioOn:!0,turnVideoOn:!0}),this.liveEventId=e,this.mediaOption=t}getData(){return{is_audio_on:this.mediaOption.turnAudioOn,is_video_on:this.mediaOption.turnVideoOn}}getSubPath(){return`/live-events/${this.liveEventId}/hosts`}getMethod(){return ce.POST}}class fe extends W{parseData(e){return{host:$(e.host)}}}class _e extends j{constructor(e){super(),c(this,"type",i.READY),c(this,"liveEventId",void 0),this.liveEventId=e}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/ready`}getMethod(){return ce.POST}}class ve extends W{parseData(e){return{liveEvent:Y(e.live_event)}}}class me extends j{constructor(e){super(),c(this,"type",i.START),c(this,"liveEventId",void 0),this.liveEventId=e}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/start`}getMethod(){return ce.POST}}class ge extends W{parseData(e){return{liveEvent:Y(e.live_event)}}}class ye extends j{constructor(e,t){super(),c(this,"type",i.EXIT_HOST),c(this,"liveEventId",void 0),c(this,"hostId",void 0),this.liveEventId=e,this.hostId=t}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/hosts/`+this.hostId}getMethod(){return ce.DELETE}}class Ee extends W{parseData(e){return{host:$(e.host)}}}class Ie extends j{constructor(e){super(),c(this,"type",i.DELETE),c(this,"liveEventId",void 0),this.liveEventId=e}getData(){return{}}getSubPath(){return"/live-events/"+this.liveEventId}getMethod(){return ce.DELETE}}class be extends W{parseData(e){return{liveEvent:Y(e.live_event)}}}class Te extends j{constructor(e){super(),c(this,"type",i.ENTER),c(this,"liveEventId",void 0),this.liveEventId=e}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/participants`}getMethod(){return ce.POST}}class Ce extends W{parseData(e){return{participant:J(e.participant)}}}class we extends j{constructor(e,t){super(),c(this,"type",i.EXIT),c(this,"liveEventId",void 0),c(this,"participantId",void 0),this.liveEventId=e,this.participantId=t}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/participants/`+this.participantId}getMethod(){return ce.DELETE}}class Se extends W{parseData(e){return{participant:J(e.participant)}}}class Ne extends j{constructor(e,t,n){super(),c(this,"type",i.CONNECTED),c(this,"liveEventId",void 0),c(this,"participantId",void 0),c(this,"endpointId",void 0),this.liveEventId=e,this.participantId=t,this.endpointId=n}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/participants/${this.participantId}/rtcstreams/${this.endpointId}/connected`}getMethod(){return ce.POST}}class Ae extends W{parseData(e){return{endpoint:X(e.rtcstream)}}}class Oe extends j{constructor(e,t,n){super(),c(this,"type",i.HOST_CONNECTED),c(this,"liveEventId",void 0),c(this,"hostId",void 0),c(this,"endpointId",void 0),this.liveEventId=e,this.hostId=t,this.endpointId=n}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/hosts/${this.hostId}/rtcstreams/${this.endpointId}/connected`}getMethod(){return ce.POST}}class Re extends W{parseData(e){return{endpoint:X(e.rtcstream)}}}class De extends j{constructor(e,t,n){super(),c(this,"type",i.DELETE_STREAM),c(this,"liveEventId",void 0),c(this,"participantId",void 0),c(this,"endpointId",void 0),this.liveEventId=e,this.participantId=t,this.endpointId=n}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/participants/${this.participantId}/rtcstreams/`+this.endpointId}getMethod(){return ce.DELETE}}class Me extends W{parseData(e){return{}}}class ke extends j{constructor(e,t,n){super(),c(this,"type",i.HOST_DELETE_STREAM),c(this,"liveEventId",void 0),c(this,"hostId",void 0),c(this,"endpointId",void 0),this.liveEventId=e,this.hostId=t,this.endpointId=n}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/hosts/${this.hostId}/rtcstreams/`+this.endpointId}getMethod(){return ce.DELETE}}class Le extends W{parseData(e){return{}}}class Ue extends j{constructor(e,t,n,r){super(),c(this,"type",i.ATTACH),c(this,"liveEventId",void 0),c(this,"participantId",void 0),c(this,"endpointId",void 0),c(this,"attachTo",void 0),this.liveEventId=e,this.participantId=t,this.endpointId=n,this.attachTo=r}getData(){return{attach_to:this.attachTo}}getSubPath(){return`/live-events/${this.liveEventId}/participants/${this.participantId}/rtcstreams/${this.endpointId}/attach`}getMethod(){return ce.POST}}class Pe extends W{parseData(e){return{endpoint:X(e.rtcstream)}}}class xe extends B{constructor(e){super(),c(this,"type",void 0),c(this,"version",void 0),c(this,"messageId",void 0),c(this,"payload",void 0),this.type=e.type,this.version=e.version,this.messageId=e.message_id,this.payload=this.parseData(e.payload)}}class qe extends xe{parseData(e){return{liveEventId:e.live_event_id,liveEvent:Y(e.live_event)}}}class Fe extends xe{parseData(e){return{liveEventId:e.live_event_id,liveEvent:Y(e.live_event)}}}class He extends xe{parseData(e){return{liveEventId:e.live_event_id,liveEvent:Y(e.live_event)}}}class Ge extends xe{parseData(e){return{liveEventId:e.live_event_id,host:$(e.host)}}}class Ve extends xe{parseData(e){return{liveEventId:e.live_event_id,host:$(e.host)}}}class Be extends xe{parseData(e){return{liveEventId:e.live_event_id,host:$(e.host)}}}class Qe extends xe{parseData(e){return{liveEventId:e.live_event_id,host:$(e.host)}}}class je extends xe{parseData(e){return{liveEventId:e.live_event_id,host:$(e.host)}}}class Ke extends xe{parseData(e){return{liveEventId:e.live_event_id,participant:J(e.participant),participantCount:e.particpant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}class ze extends xe{parseData(e){return{liveEventId:e.live_event_id,participant:J(e.participant),participantCount:e.particpant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}class We extends j{constructor(e,t,n,r,s){super(),c(this,"type",i.CREATE_STREAM),c(this,"liveEventId",void 0),c(this,"participantId",void 0),c(this,"sdp",void 0),c(this,"audioAttr",void 0),c(this,"videoAttr",void 0),this.liveEventId=e,this.participantId=t,this.sdp=n,this.audioAttr=r,this.videoAttr=s}getData(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}getSubPath(){return`/live-events/${this.liveEventId}/participants/${this.participantId}/rtcstreams`}getMethod(){return ce.POST}}class Ye extends W{parseData(e){return{sdp:e.sdp,endpoint:X(e.rtcstream)}}}class $e extends W{parseData(e){return{hosts:e.hosts.map($)}}}class Xe extends j{constructor(e,t){super(),c(this,"type",i.HOST_ALIVE),c(this,"liveEventId",void 0),c(this,"hostId",void 0),this.liveEventId=e,this.hostId=t}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/hosts/${this.hostId}/alive`}getMethod(){return ce.POST}}class Je extends W{parseData(e){return{}}}class Ze extends j{constructor(e,t,n,r,s){super(),c(this,"type",i.HOST_CREATE_STREAM),c(this,"liveEventId",void 0),c(this,"hostId",void 0),c(this,"sdp",void 0),c(this,"audioAttr",void 0),c(this,"videoAttr",void 0),this.liveEventId=e,this.hostId=t,this.sdp=n,this.audioAttr=r,this.videoAttr=s}getData(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}getSubPath(){return`/live-events/${this.liveEventId}/hosts/${this.hostId}/rtcstreams`}getMethod(){return ce.POST}}class et extends W{parseData(e){return{sdp:e.sdp,endpoint:X(e.rtcstream)}}}class tt extends j{constructor(e,t){super(),c(this,"type",i.ALIVE),c(this,"liveEventId",void 0),c(this,"participantId",void 0),this.liveEventId=e,this.participantId=t}getData(){return{}}getSubPath(){return`/live-events/${this.liveEventId}/participants/${this.participantId}/alive`}getMethod(){return ce.POST}}class nt extends W{parseData(e){return{}}}class rt extends W{parseData(e){return{participant:J(e.participant)}}}class st extends j{constructor(e,t,n){super(),c(this,"type",i.AUDIO),c(this,"liveEventId",void 0),c(this,"hostId",void 0),c(this,"on",void 0),this.liveEventId=e,this.hostId=t,this.on=n}getData(){return{on:this.on}}getSubPath(){return`/live-events/${this.liveEventId}/hosts/${this.hostId}/audio`}getMethod(){return ce.POST}}class it extends j{constructor(e,t,n){super(),c(this,"type",i.VIDEO),c(this,"liveEventId",void 0),c(this,"hostId",void 0),c(this,"on",void 0),this.liveEventId=e,this.hostId=t,this.on=n}getData(){return{on:this.on}}getSubPath(){return`/live-events/${this.liveEventId}/hosts/${this.hostId}/video`}getMethod(){return ce.POST}}class at extends xe{parseData(e){return{liveEventId:e.live_event_id,host:$(e.host)}}}class ot{static createAuth(e,t,n){return new oe(e,t,n)}static createLiveEvent(e,t){return new ue(e,t)}static createGetLiveEvent(e){return new he(e)}static createEnterHost(e,t){return new pe(e,t)}static createReady(e){return new _e(e)}static createStart(e){return new me(e)}static createExitHost(e,t){return new ye(e,t)}static createEndLiveEvent(e){return new Ie(e)}static createEnter(e){return new Te(e)}static createExit(e,t){return new we(e,t)}static createConnected(e,t,n){return new Ne(e,t,n)}static createHostConnected(e,t,n){return new Oe(e,t,n)}static createStream(e,t,n,r,s){return new We(e,t,n,r,s)}static createHostCreateStream(e,t,n,r,s){return new Ze(e,t,n,r,s)}static createDeleteStream(e,t,n){return new De(e,t,n)}static createHostDeleteStream(e,t,n){return new ke(e,t,n)}static createAttach(e,t,n,r){return new Ue(e,t,n,r)}static createAudio(e,t,n){return new st(e,t,n)}static createVideo(e,t,n){return new it(e,t,n)}static createAlive(e,t){return new tt(e,t)}static createHostAlive(e,t){return new Xe(e,t)}static parseResponse(e,t){try{switch(e.type){case i.CREATE:return new le(t);case i.GET:return new de(t);case i.DELETE:return new be(t);case i.QUERY:return new te(t);case i.READY:return new ve(t);case i.START:return new ge(t);case i.ENTER_HOST:return new fe(t);case i.GET_HOSTS:return new $e(t);case i.EXIT_HOST:return new Ee(t);case i.HOST_ALIVE:return new Je(t);case i.AUDIO:return new Qe(t);case i.VIDEO:return new je(t);case i.HOST_CREATE_STREAM:return new et(t);case i.HOST_DELETE_STREAM:return new Le(t);case i.HOST_CONNECTED:return new Re(t);case i.ENTER:return new Ce(t);case i.EXIT:return new Se(t);case i.ALIVE:return new nt(t);case i.GET_PARTICIPANTS:return new rt(t);case i.CREATE_STREAM:return new Ye(t);case i.DELETE_STREAM:return new Me(t);case i.CONNECTED:return new Ae(t);case i.ATTACH:return new Pe(t)}}catch(e){return}}static parse(e){if("live"===e.call_type)try{switch(e.type){case i.LIVE_EVENT_READY:return new qe(e);case i.LIVE_EVENT_STARTED:return new Fe(e);case i.LIVE_EVENT_ENDED:return new He(e);case i.HOST_ENTERED:return new Ge(e);case i.HOST_EXITED:return new Ve(e);case i.HOST_CONNECTED:return new Be(e);case i.HOST_DISCONNECTED:return new at(e);case i.HOST_AUDIO_STATUS_CHANGED:return new Qe(e);case i.HOST_VIDEO_STATUS_CHANGED:return new je(e);case i.PARTICIPANT_ENTERED:return new Ke(e);case i.PARTICIPANT_EXITED:return new ze(e)}}catch(e){return}}}class ct{constructor(){c(this,"_listeners",{}),c(this,"on",this.addEventListener),c(this,"off",this.removeEventListener)}addEventListener(e,t){return e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t),()=>this.removeEventListener(e,t)}once(e,t){function n(){t(...arguments),r.removeEventListener(e,n)}const r=this;return this.on(e,n)}removeEventListener(e,n){if(e in this._listeners){const r=this._listeners[e];for(let e=0,t=r.length;e<t;e++)if(r[e]===n)return void r.splice(e,1)}}removeAllEventListeners(){this._listeners={}}_dispatchEvent(e){if(e in this._listeners){const s=this._listeners[e].slice();for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(let e=0,t=s.length;e<t;e++)s[e].call(this,...n)}}}let ut;(s=ut=ut||{}).VERBOSE="VERBOSE",s.DEBUG="DEBUG",s.INFO="INFO",s.WARNING="WARNING",s.ERROR="ERROR",s.NONE="NONE";const a=new class{constructor(){c(this,"_listeners",void 0),this._listeners=[]}verbose(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log(ut.VERBOSE,...t)}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log(ut.DEBUG,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log(ut.INFO,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log(ut.WARNING,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log(ut.ERROR,...t)}_log(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];for(t of this._listeners)t._permit(e,...r)}addListener(e){this._listeners.push(e)}removeListener(e){e=this._listeners.indexOf(e);-1!==e&&this._listeners.splice(e,1)}removeAllListener(){this._listeners=[]}},lt=n=>{Object.keys(n).forEach(e=>{var t;void 0!==(t=n[e])&&!Number.isNaN(t)&&""!==t&&t!==[]||delete n[e]})},ht=async e=>{if(e)return(async e=>{const t={},n={},r={},s={},i=new Map,a=new Map;let o;return e.forEach(e=>{"codec"===e.type&&i.set(e.id,e),"candidate-pair"===e.type&&"succeeded"===e.state&&(o=e.localCandidateId,t.webrtc_timestamp=e.time),"media-source"===e.type&&a.set(e.kind,e)}),e.forEach(e=>{var t;"local-candidate"===e.type&&e.id===o&&(n.network_type=e.networkType,n.protocol=e.protocol,n.candidate_type=e.candidateType),"audio"!==e.kind&&"audio"!==e.mediaType||("outbound-rtp"===e.type&&(r.codec=i.get(e.codecId)?.mimeType,r.total_packets_sent=e.packetsSent,r.retransmitted_packets_sent=e.retransmittedPacketsSent),"remote-inbound-rtp"===e.type&&(r.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,r.total_packets_received=e.packetsReceived,r.total_packets_lost_rate=t,r.total_packets_lost=e.packetsLost,r.jitter=1e3*e.jitter),"track"===e.type&&e.remoteSource&&(r.jitter_buffer_delay=e.jitterBufferDelay,r.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount)),"video"!==e.kind&&"video"!==e.mediaType||(s.video_source_width=a.get("video")?.width,s.video_source_height=a.get("video")?.height,s.video_source_frames_per_second=a.get("video")?.framesPerSecond,"outbound-rtp"===e.type&&(s.codec=i.get(e.codecId)?.mimeType,s.fir_count=e.firCount,s.pli_count=e.pliCount,s.nack_count=e.nackCount,s.qp_sum=e.qpSum,s.retransmitted_packets_sent=e.retransmittedBytesSent,s.quality_limitation_reason=e.qualityLimitationReason,s.quality_limitation_resolution_changes=e.qualityLimitationResolutionChanges),"remote-inbound-rtp"===e.type&&(s.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(s.header_bytes_received=e.headerBytesReceived,s.key_frames_decoded=e.keyFramesDecoded,s.total_decode_time=e.totalDecodeTime,s.total_inter_frame_delay=e.totalInterFrameDelay,s.total_squared_inter_frame_delay=e.totalSquaredInterFrameDelay,t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,s.total_packets_lost=e.packetsLost,s.total_packets_received=e.packetsReceived,s.total_packets_lost_rate=t),"track"===e.type&&(e.remoteSource?(s.jitter_buffer_delay=e.jitterBufferDelay,s.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount,s.received_frame_width=e.frameWidth,s.received_frame_height=e.frameHeight,s.frames_received=e.framesReceived,s.frames_decoded=e.framesDecoded,s.frames_dropped=e.framesDropped,s.freeze_count=e.freezeCount,s.pause_count=e.pauseCount,s.total_freezes_duration=e.totalFreezesDuration,s.total_pauses_duration=e.totalPausesDuration,s.total_frames_duration=e.totalFramesDuration,s.sum_of_squared_frames_duration=e.sumOfSquaredFramesDuration):(s.sent_frame_width=e.frameWidth,s.sent_frame_height=e.frameHeight)))}),lt(n),lt(r),lt(s),t.transport_info=n,t.audio=r,t.video=s,t})(await e.getStats());throw new Error("'getStats()' is called without rtcConnection")};class dt{constructor(e){this._context=e,c(this,"_state",void 0)}get state(){return this._state}_changeState(e){this._state&&this._state.type===e.type||(this._state&&this._state.destroy(),this._state=e,this._state.context=this._context,this._state.start())}}class pt{constructor(e){this._stateMutator=e,c(this,"_context",void 0)}set context(e){this._context=e}start(){this._onStart()}destroy(){this._onDestroy()}}class ft{constructor(e,t){this._context=e,this._stateMutator=t,this._context=e,this._stateMutator=t}get state(){return this._stateMutator.state}}class _t extends pt{constructor(e){super(e)}}let n;(s=n=n||{}).IDLE="idle",s.OFFERING="offering",s.ANSWERING="answering",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.ICE_RESTART_OFFERING="iceRestartOffering",s.ICE_RESTART_ANSWERING="iceRestartAnswering",s.CLOSED="closed";class vt extends _t{constructor(e,t){super(e),c(this,"type",n.ANSWERING),c(this,"_offerCommand",void 0),this._offerCommand=t}_onStart(){this._context.dispatchEvent("answering"),this._context.createRTCConnection(),this._offerCommand&&this.onOfferReceived(this._offerCommand)}_onDestroy(){}async onOfferReceived(e){await this._context.setRemoteDescription("offer",e.payload.sdp),this._context.prepareSessionDescription(),this._context.sendAnswer().catch(e=>{})}onIceConnected(){this._stateMutator.toConnected(!1)}onClose(){this._stateMutator.toClosed()}}class mt extends _t{constructor(){super(...arguments),c(this,"type",n.CLOSED)}_onStart(){this._context.dispatchEvent("closed")}_onDestroy(){}}class gt extends _t{constructor(e,t){super(e),c(this,"type",n.CONNECTED),c(this,"_isReconnected",void 0),this._isReconnected=t}_onStart(){this._context.dispatchEvent("connected")}_onDestroy(){}async onOfferReceived(e){this._stateMutator.toReconnecting(e)}onIceDisconnected(){this._stateMutator.toReconnecting()}onIceFailed(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}onClose(){this._stateMutator.toClosed()}}class yt extends _t{constructor(e,t){super(e),c(this,"type",n.ICE_RESTART_ANSWERING),c(this,"_offerCommand",void 0),this._offerCommand=t}_onStart(){this._context.dispatchEvent("iceRestartAnswering"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}_onDestroy(){}async onOfferReceived(e){await this._context.setRemoteDescription("offer",e.payload.sdp),this._context.sendAnswer().catch(e=>{})}onIceConnected(){this._stateMutator.toConnected(!0)}onClose(){this._stateMutator.toClosed()}}class Et extends _t{constructor(){super(...arguments),c(this,"type",n.ICE_RESTART_OFFERING)}_onStart(){this._context.dispatchEvent("iceRestartOffering"),this._context.sendOffer(!0)}_onDestroy(){}onAnswerReceived(e){this._context.setRemoteDescription("answer",e.payload.sdp)}onIceConnected(){this._stateMutator.toConnected(!0)}onClose(){this._stateMutator.toClosed()}}class It extends _t{constructor(){super(...arguments),c(this,"type",n.IDLE)}_onStart(){}_onDestroy(){}createOffer(){this._stateMutator.toOffering()}async onOfferReceived(e){this._stateMutator.toAnswering(e)}onClose(){this._stateMutator.toClosed()}}class bt extends _t{constructor(){super(...arguments),c(this,"type",n.OFFERING)}_onStart(){this._context.dispatchEvent("offering"),this._context.createRTCConnection(),this._context.prepareSessionDescription()}_onDestroy(){}onAnswerReceived(e){this._context.setRemoteDescription("answer",e.payload.sdp)}onIceConnected(){this._stateMutator.toConnected(!1)}onClose(){this._stateMutator.toClosed()}}class Tt extends _t{constructor(e,t){super(e),c(this,"type",n.RECONNECTING),c(this,"_offerCommand",void 0),this._offerCommand=t}_onStart(){this._context.dispatchEvent("reconnecting"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}_onDestroy(){}onOfferReceived(e){this._stateMutator.toIceRestartAnswering(e)}onIceConnected(){this._stateMutator.toConnected(!0)}onIceFailed(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}onClose(){this._stateMutator.toClosed()}}class Ct extends dt{constructor(){super(...arguments),c(this,"_state",void 0)}get state(){return this._state}get name(){return"PeerConnection"}toIdle(){this._changeState(new It(this))}toOffering(){this._changeState(new bt(this))}toAnswering(e){this._changeState(new vt(this,e))}toConnected(e){this._changeState(new gt(this,e))}toReconnecting(e){this._changeState(new Tt(this,e))}toIceRestartOffering(){this._changeState(new Et(this))}toIceRestartAnswering(e){this._changeState(new yt(this,e))}toClosed(){this._changeState(new mt(this))}}class wt extends ft{constructor(e){super(e,new Ct(e)),this._stateMutator.toIdle()}get state(){return this._stateMutator.state}onOfferReceived(e){a.verbose(`[${this.state.type}] onOfferReceived`);const t=this["state"];switch(t.type){case n.IDLE:case n.ANSWERING:case n.CONNECTED:case n.RECONNECTING:case n.ICE_RESTART_ANSWERING:t.onOfferReceived(e);break;default:a.error(`[${this.state.type}] onOfferReceived`)}}onAnswerReceived(e){a.verbose(`[${this.state.type}] onAnswerReceived`);const t=this["state"];switch(t.type){case n.OFFERING:case n.ICE_RESTART_OFFERING:t.onAnswerReceived(e);break;default:a.error(`[${this.state.type}] onAnswerReceived`)}}onClose(){a.verbose(`[${this.state.type}] onClose`);const e=this["state"];switch(e.type){case n.IDLE:case n.OFFERING:case n.ANSWERING:case n.CONNECTED:case n.RECONNECTING:case n.ICE_RESTART_OFFERING:case n.ICE_RESTART_ANSWERING:e.onClose();break;default:a.error(`[${this.state.type}] onClose`)}}createOffer(){a.verbose(`[${this.state.type}] createOffer`);const e=this["state"];e.type===n.IDLE?e.createOffer():a.error(`[${this.state.type}] createOffer`)}onIceConnected(){a.verbose(`[${this.state.type}] onIceConnected`);const e=this["state"];switch(e.type){case n.OFFERING:case n.ANSWERING:case n.RECONNECTING:case n.ICE_RESTART_OFFERING:case n.ICE_RESTART_ANSWERING:e.onIceConnected();break;default:a.error(`[${this.state.type}] onIceConnected`)}}onIceDisconnected(){a.verbose(`[${this.state.type}] onIceDisconnected`);const e=this["state"];e.type===n.CONNECTED?e.onIceDisconnected():a.error(`[${this.state.type}] onIceDisconnected`)}onIceFailed(){a.verbose(`[${this.state.type}] onIceFailed`);const e=this["state"];switch(e.type){case n.CONNECTED:case n.RECONNECTING:e.onIceFailed();break;default:a.error(`[${this.state.type}] onIceFailed`)}}}let St;(s=St=St||{}).RELAY="relay",s.ALL="all";class Nt extends ct{constructor(e,t,n,r,s,i,a,o){super(),this._ctx=e,this.id=t,this._signalingClient=n,this._localStream=r,this._isInitiator=s,this._turnCredential=i,this._mediaDirections=a,this._isDisposable=o,c(this,"_stateMachine",void 0),c(this,"_rtcConnection",void 0),c(this,"_remoteStream",void 0),this._stateMachine=new wt({dispatchEvent:this._dispatchEvent.bind(this),isInitiator:this._isInitiator,setRemoteDescription:this._setRemoteDescription.bind(this),sendAnswer:this._sendAnswer.bind(this),sendOffer:this._sendOffer.bind(this),createRTCConnection:this._createRTCConnection.bind(this),prepareSessionDescription:this._prepareSessionDescription.bind(this),isDisposable:this._isDisposable}),r&&r.on("streamChanged",e=>this.onLocalStream(e))}get _state(){return this._stateMachine.state}get rtcConnection(){return this._rtcConnection}get remoteStream(){return this._remoteStream}get signalingClient(){return this._signalingClient}onEvent(e){switch(e.type){case At.CANDIDATE:return void this._receiveCandidate(e);case At.OFFER:this._stateMachine.onOfferReceived(e);break;case At.ANSWER:this._stateMachine.onAnswerReceived(e);break;default:a.error(new Error("unhandled call event "+e))}}createOffer(){this._stateMachine.createOffer()}close(){this._closeRTCConnection(),this._stateMachine.onClose()}onLocalStream(e){if(this._rtcConnection)for(const t of e.getTracks())this._replaceTrack(t)}async getCandidateInfo(){return(async e=>{if(!e)throw new Error("'getCandidateInfo()' is called without rtcConnection");const t=await e.getStats();let n;const r=t.entries();let s=0;for(;s<t.size;s++){var i=r.next()["value"];if(i){i=i[1];if("candidate-pair"===i.type&&"succeeded"===i.state){n=i.localCandidateId;break}}}for(;s<t.size;s++){var a=r.next()["value"];if(a){a=a[1];if("local-candidate"===a.type&&a.id===n)return{connectionType:a.candidateType??"",protocol:a.protocol??"",relayProtocol:a.relayProtocol??""}}}return null})(this.rtcConnection)}async getStatsLog(){return ht(this.rtcConnection)}_replaceTrack(e){for(const t of this._rtcConnection.getSenders())t.track&&t.track.kind===e.kind&&t.replaceTrack(e)}_createRTCConnection(){let e;this._turnCredential&&(e={iceServers:[{username:this._turnCredential.username,credential:this._turnCredential.password,urls:this._turnCredential.turnUrls}],iceTransportPolicy:this._turnCredential.transportPolicy||St.ALL});const t=new RTCPeerConnection(e);t.onnegotiationneeded=()=>{this._sendOffer(!1)},t.onicecandidate=e=>{e.candidate&&this._signalingClient.sendCandidate?.(e.candidate)},t.onconnectionstatechange=()=>this._handleConnectionStateChange(t),t.oniceconnectionstatechange=()=>this._handleIceConnectionStateChange(t),t.ontrack=e=>this._onRemoteTrack(e),this._rtcConnection=t}_closeRTCConnection(){this._rtcConnection&&(this._rtcConnection.onnegotiationneeded=null,this._rtcConnection.onicecandidate=null,this._rtcConnection.oniceconnectionstatechange=null,this._rtcConnection.onconnectionstatechange=null,this._rtcConnection.close(),this._rtcConnection=null,delete this._remoteStream)}_prepareSessionDescription(){var{audio:e,video:t}=this._mediaDirections;const n={sendrecv:[],sendonly:[],recvonly:[],none:[]};n[e].push("audio"),n[t].push("video"),n.sendrecv.length&&this._addTracks(n.sendrecv),n.sendonly.length&&this._addSendOnlyTransceivers(n.sendonly),n.recvonly.length&&this._addReceiveOnlyTransceivers(n.recvonly)}_addTracks(t){a.debug("_addTracks()");const n=this._localStream["localStream"];n.getTracks().forEach(e=>{t.includes(e.kind)&&this._rtcConnection.addTrack(e,n)})}_addReceiveOnlyTransceivers(e){e.forEach(e=>{this._rtcConnection.addTransceiver(e,{direction:"recvonly"})})}_addSendOnlyTransceivers(e){const n=this._localStream["localStream"];e.forEach(t=>{n.getTracks().forEach(e=>{e.kind===t&&this._rtcConnection.addTransceiver(e,{direction:"sendonly",streams:[n]})})})}_setRemoteDescription(e,t){t=t.replace(/a=extmap:0 ulpfec\r\n/,""),e=new RTCSessionDescription({type:e,sdp:t});return this._rtcConnection.setRemoteDescription(e)}async _sendOffer(e){e=await this._rtcConnection.createOffer({iceRestart:e||!1});return await this._rtcConnection.setLocalDescription(e),this._signalingClient.sendOfferSdp(this._rtcConnection.localDescription)}async _sendAnswer(){const e=await this._rtcConnection.createAnswer();return e.sdp=e.sdp.replace("actpass","active"),await this._rtcConnection.setLocalDescription(e),this._signalingClient.sendAnswerSdp(this._rtcConnection.localDescription)}_handleIceConnectionStateChange(e){switch(a.verbose(`[${this._state.type}] iceConnectionState `+e.iceConnectionState),e.iceConnectionState){case"connected":this._stateMachine.onIceConnected();break;case"disconnected":this._stateMachine.onIceDisconnected();break;case"failed":this._dispatchEvent("iceFailed")}}_handleConnectionStateChange(e){a.verbose(`[${this._state.type}] connectionState `+e.connectionState)}_receiveCandidate(e){e=e.payload.candidate;this._rtcConnection.addIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.sdp}).catch(e=>{a.error(e)})}_onRemoteTrack(e){this._remoteStream=e.streams[0],this._dispatchEvent("remoteStream",this._remoteStream)}}let At;(s=At=At||{}).OFFER="offer",s.ANSWER="answer",s.CANDIDATE="candidate";class Ot{constructor(){c(this,"promise",void 0),c(this,"resolve",void 0),c(this,"reject",void 0),this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}async function Rt(t,n,r){const{deferred:s,count:i}=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{count:0,deferred:new Ot};try{var a=await n();0<i&&r.onRecover?.(),s.resolve(a)}catch(e){r.onError?.(e);a=t.calcTimeout(i+1);if(0<=a)return r.onRetrial?.(i+1,e),setTimeout(()=>{Rt(t,n,r,{count:i+1,deferred:s})},a),s.promise;s.reject(e)}return s.promise}class Dt{calcTimeout(e){switch(e){case 1:return 1e3;case 2:return 2e3;case 3:return 3e3;default:return-1}}}class Mt{constructor(e,t,n){this.interval=e,this.noise=t,this.maxRetrial=n}calcTimeout(e){return e>this.maxRetrial?-1:e*this.interval+(Math.random()-.5)*this.noise*2}}class kt{constructor(e){c(this,"_requests",void 0),c(this,"timeoutTime",void 0),this._requests=new Map,this.timeoutTime=e}has(e){return this._requests.has(e)}get(e){return this._requests.get(e)}register(e){if(!e)throw new Error("invalid request id");if(this._requests.has(e))throw new Error("duplicate requests");var t=new Ot;return this._requests.set(e,{deferred:t,timer:this._createTimeoutTimer(e)}),t}unregister(e){if(!this._requests.has(e))return null;var{timer:t,deferred:n}=this._requests.get(e);return clearTimeout(t),this._requests.delete(e),n}_createTimeoutTimer(t){return setTimeout(()=>{const e=this.unregister(t);e.reject(new Error("no response due to timeout"))},this._getTimeoutTime())}rejectAll(e){for(const t of this._requests.keys()){const n=this._requests.get(t);clearTimeout(n.timer),n.deferred.reject(e)}this._requests.clear()}_getTimeoutTime(){return this.timeoutTime}}class Lt{constructor(e,t,n,r){this._ctx=e,this._participantId=t,this._mediaDirections=n,this._endpointId=r,c(this,"_timeoutTime",6e4),c(this,"_requestMap",void 0),this._requestMap=new kt(this._timeoutTime)}async sendOfferSdp(e){this._endpointId?await this._sendOfferAndUnregisterPutEndpointRequest(e):await this._sendOfferAndUnregisterCreateEndpointRequest(e)}async _sendOfferAndUnregisterCreateEndpointRequest(e){const t=this._requestMap.unregister(this._participantId+":create-endpoint-request");try{var n=await this._sendCreateEndpoint(e);return t&&t.resolve(n),n}catch(e){throw t&&t.reject(e),e}}async _sendOfferAndUnregisterPutEndpointRequest(e){const t=this._requestMap.unregister(this._participantId+":put-endpoint-request");try{var n=await this._sendCreateEndpoint(e);return t&&t.resolve(n),n}catch(e){throw t&&t.reject(e),e}}registerCreateEndpointRequest(){if(this._endpointId)throw new Error("Cannot register create endpoint request on endpoint recycle");return this._requestMap.register(this._participantId+":create-endpoint-request")}registerPutEndpointRequest(){if(this._endpointId)return this._requestMap.register(this._participantId+":put-endpoint-request");throw new Error("Cannot register put endpoint request without endpoint id")}_sendCreateEndpoint(e){return this._ctx.sendCreateEndpoint(e)}_sendPutEndpoint(e){return this._ctx.sendPutEndpoint(e)}}class Ut extends pt{constructor(e){super(e)}}let Pt;(s=Pt=Pt||{}).PENDING="pending",s.ESTABLISHED="established",s.CONNECTED="connected",s.FAILED="failed",s.RELEASING="releasing",s.CLOSED="closed";class xt extends Ut{constructor(){super(...arguments),c(this,"type",Pt.CLOSED)}_onStart(){this._context.dispatchEvent("closed")}_onDestroy(){}}class qt extends Ut{constructor(e){super(e),c(this,"type",Pt.CONNECTED)}_onStart(){this._context.dispatchEvent("connected")}_onDestroy(){}onICEFailed(){this._stateMutator.toPending()}onAttach(){this._context.requestAttach()}onRelease(){this._stateMutator.toReleasing()}onExit(){this._stateMutator.toClosed()}}class Ft extends Ut{constructor(e,t,n){super(e),c(this,"type",Pt.ESTABLISHED),c(this,"_sdp",void 0),c(this,"_hasPendingAttach",void 0),this._sdp=t,this._hasPendingAttach=n}_onStart(){this._context.dispatchEvent("established"),this._context.setRemoteDescription(this._sdp),this._hasPendingAttach&&this.onAttach()}_onDestroy(){}onPCConnected(){this._stateMutator.toConnected()}onICEFailed(){this._stateMutator.toPending()}onAttach(){this._context.requestAttach()}onRelease(){this._stateMutator.toReleasing()}onExit(){this._stateMutator.toClosed()}}class Ht extends Ut{constructor(){super(...arguments),c(this,"type",Pt.FAILED)}_onStart(){this._context.dispatchEvent("failed"),this._context.endpoint.id?this._stateMutator.toReleasing():this._stateMutator.toClosed()}_onDestroy(){}onExit(){this._stateMutator.toClosed()}}class Gt extends Ut{constructor(){super(...arguments),c(this,"type",Pt.PENDING),c(this,"_hasPendingAttach",void 0),c(this,"_requestTimeout",void 0)}_onStart(){this._context.dispatchEvent("pending"),this._request()}_onDestroy(){this._requestTimeout&&clearTimeout(this._requestTimeout),delete this._requestTimeout}_request(){this._context.trialCount+=1;var e=this._context["trialCount"];9<=e?this._stateMutator.toFailed():1<e?this._requestTimeout=setTimeout(()=>{this._context.createSession()},5e3*e+2e3*(Math.random()-.5)):this._context.createSession()}onEndpointRequestSucceeded(e){this._stateMutator.toEstablished(e,this._hasPendingAttach)}onEndpointRequestFailed(){this._request()}onAttach(){this._hasPendingAttach=!0}onRelease(){this._stateMutator.toReleasing()}onExit(){this._stateMutator.toClosed()}}class Vt extends Ut{constructor(){super(...arguments),c(this,"type",Pt.RELEASING)}_onStart(){this._context.dispatchEvent("releasing"),this._context.closePeerConnection(),this._context.endpoint.id&&this._context.requestRelease()}_onDestroy(){}onEndpointRequestSucceeded(){this._context.requestRelease()}onEndpointRequestFailed(){this._stateMutator.toClosed()}onReleased(){this._stateMutator.toClosed()}onExit(){this._stateMutator.toClosed()}}class Bt extends dt{constructor(){super(...arguments),c(this,"_state",void 0)}get state(){return this._state}get name(){return"PeerConnection"}toPending(){this._changeState(new Gt(this))}toEstablished(e,t){this._changeState(new Ft(this,e,t))}toConnected(){this._changeState(new qt(this))}toFailed(){this._changeState(new Ht(this))}toReleasing(){this._changeState(new Vt(this))}toClosed(){this._changeState(new xt(this))}}class Qt extends ft{constructor(e){super(e,new Bt(e)),this._stateMutator.toPending()}get state(){return this._stateMutator.state}onEndpointRequestSucceeded(e){a.verbose(`[${this.state.type}] onEndpointRequestSucceeded`);const t=this["state"];switch(t.type){case Pt.PENDING:t.onEndpointRequestSucceeded(e);break;case Pt.RELEASING:t.onEndpointRequestSucceeded();break;default:a.error(`[${this.state.type}] onEndpointRequestSucceeded`)}}onEndpointRequestFailed(){a.verbose(`[${this.state.type}] onEndpointCreateFailed`);const e=this["state"];switch(e.type){case Pt.PENDING:case Pt.RELEASING:e.onEndpointRequestFailed();break;default:a.error(`[${this.state.type}] onEndpointCreateFailed`)}}onICEFailed(){a.verbose(`[${this.state.type}] onICEFailed`);const e=this["state"];switch(e.type){case Pt.ESTABLISHED:case Pt.CONNECTED:e.onICEFailed();break;default:a.error(`[${this.state.type}] onICEFailed`)}}onPCConnected(){a.verbose(`[${this.state.type}] onPCConnected`);const e=this["state"];e.type===Pt.ESTABLISHED?e.onPCConnected():a.error(`[${this.state.type}] onPCConnected`)}onAttach(){a.verbose(`[${this.state.type}] onAttach`);const e=this["state"];switch(e.type){case Pt.PENDING:case Pt.ESTABLISHED:case Pt.CONNECTED:e.onAttach();break;default:a.error(`[${this.state.type}] onAttach`)}}onRelease(){a.verbose(`[${this.state.type}] onRelease`);const e=this["state"];switch(e.type){case Pt.PENDING:case Pt.ESTABLISHED:case Pt.CONNECTED:e.onRelease();break;default:a.error(`[${this.state.type}] onRelease`)}}onReleased(){a.verbose(`[${this.state.type}] onReleased`);const e=this["state"];e.type===Pt.RELEASING?e.onReleased():a.error(`[${this.state.type}] onReleased`)}onExit(){a.verbose(`[${this.state.type}] onExit`);const e=this["state"];switch(e.type){case Pt.RELEASING:case Pt.PENDING:case Pt.CONNECTED:case Pt.ESTABLISHED:case Pt.FAILED:e.onExit();break;default:a.error(`[${this.state.type}] onExit`)}}}class jt extends B{constructor(e){super(),c(this,"type",void 0),c(this,"payload",void 0),this.payload=e.payload||{}}}class Kt extends jt{constructor(){super(...arguments),c(this,"type",void 0)}}let zt;(s=zt=zt||{}).OFFER="offer",s.ANSWER="answer",s.CANDIDATE="candidate";class Wt extends Kt{constructor(e){super({payload:e}),c(this,"type",zt.ANSWER)}}class Yt extends Kt{constructor(e){super({payload:e}),c(this,"type",zt.CANDIDATE)}}class $t extends Kt{constructor(e){super({payload:e}),c(this,"type",zt.OFFER)}}class Xt extends ct{constructor(e,t,n,r){super(),this._ctx=e,this._localStream=t,this._type=n,this._participantId=r,c(this,"id",void 0),c(this,"tmpId",V()),c(this,"_stateMachine",void 0),c(this,"_pc",void 0),c(this,"_attachedTo",void 0),c(this,"_createSession",()=>{switch(a.debug("_createSession()"),this._type){case"master":this._createMasterSession();break;case"viewer":this._createViewerSession();break;default:a.error("Not supported endpoint type : ",this._type)}}),c(this,"_closePeerConnection",()=>{a.debug("_closePeerConnection()"),this._pc.removeAllEventListeners(),this._pc.close()}),c(this,"_requestAttach",()=>{Rt(new Mt(5e3,1e3,8),()=>this._sendAttach(this._attachedTo),{onError:e=>{a.error(`Fail attach endpoint endpointId = ${this.id}, to = ${this._attachedTo} ErrorCode = `+e.code)}}).then(()=>{this._dispatchEvent("attached",this._attachedTo)})}),c(this,"_requestRelease",()=>{a.debug("_requestRelease()"),this._sendReleaseEndpoint().then(()=>{this._stateMachine.onReleased()}).catch(e=>{a.error("Release request failed",e),this._stateMachine.onReleased()})}),c(this,"_setRemoteDescription",e=>{a.debug("_setRemoteDescription()");const t=this._pc;e=class{static createOffer(e,t){return new $t({peerConnectionId:e,sdp:t})}static createAnswer(e,t){return new Wt({peerConnectionId:e,sdp:t})}static createCandidate(e,t){return new Yt({peerConnectionId:e,candidate:t})}}.createAnswer(void 0,e);t.onEvent(e),t.once("connected",()=>{this._stateMachine.onPCConnected(),this._sendConnected()}),t.once("iceFailed",()=>{this._stateMachine.onICEFailed()})}),this._stateMachine=new Qt({endpoint:this,dispatchEvent:this._dispatchEvent.bind(this),createSession:this._createSession,setRemoteDescription:this._setRemoteDescription,closePeerConnection:this._closePeerConnection,requestAttach:this._requestAttach,requestRelease:this._requestRelease,trialCount:0})}get pc(){return this._pc}get _state(){return this._stateMachine.state}get _masterSessionDirection(){return this._ctx.masterSessionDirection}get _viewerSessionDirection(){return this._ctx.viewerSessionDirection}attach(e){a.debug("attach()"),this._attachedTo=e,this._stateMachine.onAttach()}release(){a.debug("release()"),this._stateMachine.onRelease()}exit(){a.debug("exit()"),this._closePeerConnection(),this._stateMachine.onExit()}_createMasterSession(){a.debug("_createMasterSession()"),this._createPeerConnection(this._masterSessionDirection,this._localStream),this._requestCreateEndpoint()}_createViewerSession(){a.debug("_createViewerSession()"),this._createPeerConnection(this._viewerSessionDirection,void 0),this._requestCreateEndpoint()}_createPeerConnection(e,t){a.debug("_createPeerConnection()");var n=new Lt(this._ctx,this._participantId,e,this.id);this._pc=new Nt(this._ctx,void 0,n,t,!0,void 0,e,!0),this._dispatchEvent("pcChanged",this._pc)}_requestCreateEndpoint(){a.debug("_requestCreateEndpoint()");const e=this._pc;let t;t=this.id?e.signalingClient.registerPutEndpointRequest():e.signalingClient.registerCreateEndpointRequest(),e.createOffer(),t.promise.then(e=>{this.id=e.payload.endpoint.id,this._stateMachine.onEndpointRequestSucceeded(e.payload.sdp)}).catch(e=>{a.error("Endpoint request failed",e),this._stateMachine.onEndpointRequestFailed()})}_sendConnected(){return this._ctx.sendConnected(this)}_sendReleaseEndpoint(){return this._ctx.sendReleaseEndpoint(this)}_sendAttach(e){return this._ctx.sendAttach(this,e)}}class Jt extends ct{constructor(){super(),c(this,"_stream",void 0)}get stream(){return this._stream}get isSharing(){return!!this._stream}async startStream(){try{var e=await navigator.mediaDevices.getDisplayMedia({video:!0});this._stream=e,this._stream.getVideoTracks()[0].onended=()=>{this._releaseStream(),this._dispatchEvent("streamStopped")}}catch(e){switch(e.name){case"InvalidStateError":case"NotAllowedError":case"NotFoundError":case"NotReadableError":break;default:throw new Error("")}throw new Error("failed to start screen share")}}stopStream(){this._releaseStream(),this._dispatchEvent("streamStopped")}_releaseStream(){if(this._stream){for(const e of this._stream.getTracks())e.stop();delete this._stream}}}class Zt extends ct{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};super(),this._deviceManager=e,this._mediaConstraints=t,c(this,"_screenShare",void 0),c(this,"_mediaAccess",void 0),c(this,"_mergedStream",void 0),c(this,"_checkScreenSharePrerequisites",()=>{if(!navigator.mediaDevices.getDisplayMedia)throw new Error("screen share is not supported in this browser")}),this._screenShare=new Jt,this._screenShare.on("streamStopped",()=>{this._releaseMergedStream(),this._dispatchEvent("screenShareStreamStopped")})}set mediaConstraints(e){this._mediaConstraints=e}get hasPermission(){return this._mediaAccess?.hasPermission}get localStream(){return this.isScreenSharing?this._mergedStream:this.getLocalMediaStream()}get mergedStream(){return this._mergedStream}get screenStream(){return this._screenShare.stream}get isScreenSharing(){return this._screenShare.isSharing}async useScreenStream(){this._checkScreenSharePrerequisites(),await this._screenShare.startStream(),this._mergeScreenShareStream(),this._dispatchEvent("streamChanged",this.localStream)}getLocalMediaStream(){return this._mediaAccess||this._grantMediaAccess(this._mediaConstraints),this._mediaAccess.stream}stopScreenShare(){this._screenShare.isSharing&&this._screenShare.stopStream()}revokeMediaAccess(){this._mediaAccess&&(this._mediaAccess.dispose(),this._mediaAccess=null)}release(){this.stopScreenShare(),this.revokeMediaAccess()}_grantMediaAccess(e){this._mediaAccess=this._deviceManager.useMedia(e),this._mediaAccess.on("streamChanged",()=>{this._screenShare.isSharing&&this._mergeScreenShareStream(),this._dispatchEvent("streamChanged",this.localStream)}),this._mediaAccess.on("audioOutputChanged",()=>this._dispatchEvent("audioOutputChanged"))}_mergeScreenShareStream(){if(this._screenShare.isSharing){const e=new MediaStream;this._mediaAccess.stream&&0<this._mediaAccess.stream.getAudioTracks().length&&e.addTrack(this._mediaAccess.stream.getAudioTracks()[0]),e.addTrack(this.screenStream.getVideoTracks()[0]),this._mergedStream=e}}_releaseMergedStream(){this._mergedStream&&(this._mergedStream.removeTrack(this._mergedStream.getAudioTracks()[0]),delete this._mergedStream,this._dispatchEvent("streamChanged",this.localStream))}}class en{constructor(e,t,n,r){c(this,"_liveEvent",void 0),c(this,"_sender",void 0),c(this,"_deviceManager",void 0),c(this,"_mediaView",void 0),c(this,"_endpoint",void 0),c(this,"_mediaOption",void 0),c(this,"_localStream",void 0),c(this,"_unsubscriber",void 0),c(this,"rtcStreamData",void 0),this._liveEvent=e,this._sender=n,this._deviceManager=t,this._mediaOption=r}get mediaView(){return this._mediaView}set mediaView(e){this._mediaView!==e&&(this._mediaView&&(this._mediaView=null),e?this._mediaView=this._updateMediaViewStream(e,this.stream):delete this._mediaView)}get localStream(){return this._localStream.localStream}get stream(){return this._endpoint.pc?.remoteStream}_createLocalStream(){this._localStream=new Zt(this._deviceManager,{audio:!0,video:!0}),this._localStream.on("streamChanged",()=>{this._onLocalStream()})}_createEndpoint(){if(this._liveEvent.isHost)return this._localStream||this._createLocalStream(),new Xt({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},this._localStream,"master",this._liveEvent.host.hostId);{const e=new Xt({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},void 0,"viewer",this._liveEvent.currentLiveUser.participantId);return this._unsubscriber=e.pc.on("remoteStream",e=>{this._onStream()}),e}}openStream(){this._endpoint&&this._teardown(),this._endpoint=this._createEndpoint()}closeStream(e){e&&this._endpoint.release(),this._teardown()}attach(e){this._endpoint.attach(e)}toggleAudio(t){this.localStream.getAudioTracks()?.forEach(e=>{e.enabled=t}),this._mediaOption.turnAudioOn=t}toggleVideo(t){this.localStream.getVideoTracks()?.forEach(e=>{e.enabled=t}),this._mediaOption.turnVideoOn=t}chooseMediaDevice(e,t){this._deviceManager.selectDevice(e,t)}_onLocalStream(){this.toggleAudio(this._mediaOption.turnAudioOn),this.toggleVideo(this._mediaOption.turnVideoOn)}_onStream(){var e=this["stream"];this._mediaView&&this._updateMediaViewStream(this._mediaView,e)}_updateMediaViewStream(e,t){return t&&(e.srcObject=t),e}async _sendConnected(e){let t;return t=this._liveEvent.isHost?ot.createHostConnected(this._liveEvent.liveEventId,this._liveEvent.host.hostId,e.id):ot.createConnected(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id),this._sender.send(t)}_sendReleaseEndpoint(e){let t;return t=this._liveEvent.isHost?ot.createHostDeleteStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,e.id):ot.createDeleteStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id),this._sender.sendWithRetry(t)}_sendAttach(e,t){e=ot.createAttach(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id,t);return this._sender.sendWithRetry(e)}async _sendCreateEndpoint(e){var t;return this._liveEvent.isActiveHost?(t=ot.createHostCreateStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,e.sdp,"sendonly","sendonly"),this._sender.send(t)):(t=ot.createStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.sdp,"recvonly","recvonly"),this._sender.send(t))}async _sendPutEndpoint(e){return this._sendCreateEndpoint(e)}_teardown(){this._endpoint?.exit(),this._endpoint=null,this._unsubscriber?.(),this._unsubscriber=null}}class tn extends ct{constructor(e){var{deviceManager:e,sender:t,sb:n,userId:r,info:s}=e;super(),c(this,"openChannel",void 0),c(this,"liveEventId",void 0),c(this,"host",void 0),c(this,"userIdsForHost",void 0),c(this,"state",void 0),c(this,"isHostStreaming",void 0),c(this,"createdAt",void 0),c(this,"setReadyAt",void 0),c(this,"startedAt",void 0),c(this,"endedAt",void 0),c(this,"createdBy",void 0),c(this,"setReadyBy",void 0),c(this,"startedBy",void 0),c(this,"endedBy",void 0),c(this,"duration",void 0),c(this,"participantCount",void 0),c(this,"peakParticipantCount",void 0),c(this,"cumulativeParticipantCount",void 0),c(this,"customItems",void 0),c(this,"currentLiveUser",void 0),c(this,"_deviceManager",void 0),c(this,"_sender",void 0),c(this,"_sb",void 0),c(this,"_userId",void 0),c(this,"_unsubscriber",void 0),c(this,"_streams",void 0),c(this,"_aliveIntervalId",void 0),this._deviceManager=e,this._sender=t,this._sb=n,this._userId=r,this._streams=new Map,s&&Object.assign(this,s),this._unsubscriber=this._sender.on("command",e=>{this._onEvent(e)})}get myRole(){return this.userIdsForHost.includes(this._userId)?M.LiveEventRole.HOST:M.LiveEventRole.PARTICIPANT}get isHost(){return this.myRole===M.LiveEventRole.HOST}get isActiveHost(){return this.isHost&&!!this.host}async fetchOpenChannel(){var e=await this._sb.openChannel.getChannelWithoutCache(this.liveEventId),e=this._sb.openChannel.buildOpenChannelFromSerializedData(e);return this.openChannel=e}async _getOpenChannel(){return this.openChannel||this.fetchOpenChannel()}async enterAsHost(e){const t=await this._getOpenChannel();await t.enter();try{var n=(await this._sender.send(ot.createEnterHost(this.liveEventId,e))).payload["host"];this._streams.set(n.hostId,new en(this,this._deviceManager,this._sender,e)),this.upsert({host:n})}catch(e){throw await t.exit(),e}this._startToSendAlive()}async setEventReady(){if(!this.isHost)throw new Error("host only action");var e=(await this._sender.send(ot.createReady(this.liveEventId))).payload["liveEvent"];this.upsert(e)}async startEvent(e){if(!this.isHost)throw new Error("host only action");var t=(await this._sender.send(ot.createStart(this.liveEventId))).payload["liveEvent"];this.upsert(t),this.isHostStreaming||this.startStreaming(e),this._toggleAudio(e.turnAudioOn),this._toggleVideo(e.turnVideoOn)}startStreaming(e){if(!this.isActiveHost)throw new Error("current host only action");const t=new en(this,this._deviceManager,this._sender,e);this._streams.set(this.host.hostId,t),t.openStream()}endStreaming(){if(!this.isActiveHost)throw new Error("current host only action");const e=this._streams.get(this.host.hostId);e&&(this._streams.delete(this.host.hostId),e.closeStream(!0))}async exitAsHost(){var e=this.host["hostId"],e=(await this._sender.send(ot.createExitHost(this.liveEventId,e))).payload["host"];this.upsert({host:e}),this.teardown()}async endEvent(){var e=(await this._sender.send(ot.createEndLiveEvent(this.liveEventId))).payload["liveEvent"];this.upsert(e),this.teardown()}muteAudioInput(){this._toggleAudio(!1)}unmuteAudioInput(){this._toggleAudio(!0)}_toggleAudio(e){if(!this.isActiveHost)throw new Error("current host only action");const t=this._streams.get(this.host.hostId);t.toggleAudio(e),this._sender.send(ot.createAudio(this.liveEventId,this.host.hostId,e))}stopVideo(){this._toggleVideo(!1)}startVideo(){this._toggleVideo(!0)}_toggleVideo(e){if(!this.isActiveHost)throw new Error("current host only action");const t=this._streams.get(this.host.hostId);t.toggleVideo(e),this._sender.send(ot.createVideo(this.liveEventId,this.host.hostId,e))}selectAudioInput(e){return this._deviceManager.selectDevice("audioinput",e)}selectVideoInput(e){return this._deviceManager.selectDevice("videoinput",e)}async enter(){const t=await this._getOpenChannel();await t.enter();try{var e=(await this._sender.send(ot.createEnter(this.liveEventId))).payload["participant"];this.upsert({currentLiveUser:e}),this._tryOpen()}catch(e){throw await t.exit(),e}this._startToSendAlive()}async exit(){(await this._sender.send(ot.createExit(this.liveEventId,this.currentLiveUser.participantId))).payload,this.upsert({currentLiveUser:void 0}),this.teardown()}setVideoViewForLiveEvent(e,t){const n=this._streams.get(t);n&&(n.mediaView=e)}upsert(e){Object.assign(this,{...e})}teardown(){this.openChannel?.exit();for(const e of this._streams.values())e.closeStream();this._streams.clear(),this._stopToSendAlive()}_onEvent(e){if(this.liveEventId===e.payload.liveEventId)if(e instanceof qe)this._onReady(e);else if(e instanceof Fe)this._onStarted(e);else if(e instanceof He)this._onEnded(e);else if(e instanceof Ge)this._onHostEntered(e);else if(e instanceof Ve)this._onHostExited(e);else if(e instanceof Be)this._onHostConnected(e);else if(e instanceof at)this._onHostDisconnected(e);else if(e instanceof Qe)this._onHostAudioStatusChanged(e);else if(e instanceof je)this._onHostVideoStatusChanged(e);else if(e instanceof Ke)this._onParticipantEntered(e);else{if(!(e instanceof ze))throw new Error("unknown event is received");this._onParticipantExited(e)}}_onReady(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventReady",this)}_onStarted(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventStarted",this),this._tryOpen()}_onEnded(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventEnded",this),this.teardown()}_onHostEntered(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostEntered",this,this.host)}_onHostExited(e){e=e.payload.host;this.upsert({host:void 0}),this._dispatchEvent("hostExited",this,e)}_onHostConnected(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostConnected",this,this.host),this._tryOpen()}_onHostDisconnected(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostDisconnected",this,this.host)}_onHostAudioStatusChanged(e){e=e.payload.host;this.upsert({host:e}),e.isAudioOn&&this._dispatchEvent("hostUnmutedAudio",this,this.host),e.isAudioOn||this._dispatchEvent("hostMutedAudio",this,this.host)}_onHostVideoStatusChanged(e){e=e.payload.host;this.upsert({host:e}),e.isVideoOn&&this._dispatchEvent("hostStartedVideo",this,this.host),e.isVideoOn||this._dispatchEvent("hostStoppedVideo",this,this.host)}_onParticipantEntered(e){e=e.payload.participant;this._dispatchEvent("participantEntered",this,e)}_onParticipantExited(e){e=e.payload.participant;this._dispatchEvent("participantExited",this,e)}_tryOpen(){if(this.host&&this.host.state===M.HostState.CONNECTED&&this.state===M.LiveEventState.ONGOING){var t=this.host["hostId"];let e;this._streams.has(t)?e=this._streams.get(t):(e=new en(this,this._deviceManager,this._sender),this._streams.set(t,e)),e.openStream(),e.attach(t)}}_tryClose(){}_startToSendAlive(){this.isActiveHost?this._aliveIntervalId=setInterval(()=>{var e=ot.createHostAlive(this.liveEventId,this.host.hostId);this._sender.send(e)},3e3):this._aliveIntervalId=setInterval(()=>{var e=ot.createAlive(this.liveEventId,this.currentLiveUser.participantId);this._sender.send(e)},9e4)}_stopToSendAlive(){this._aliveIntervalId&&(clearInterval(this._aliveIntervalId),delete this._aliveIntervalId)}}class nn{constructor(e){c(this,"_ctx",void 0),c(this,"_liveEvents",void 0),c(this,"userId",void 0),this._liveEvents=[],this._ctx=e}async createLiveEvent(e){var t=(await this._ctx.commandRouter.send(ot.createLiveEvent(K.SINGLE_HOST,e.userIdsForHost))).payload.liveEvent;const n=new tn({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:t});try{await n.fetchOpenChannel(),e.title&&await n.openChannel.updateChannel({name:e.title}),e.coverImage&&await n.openChannel.updateChannel({coverUrlOrImage:e.coverImage})}catch(e){a.error("failed to fetch initial open channel")}return this._liveEvents.push(n),n}async getLiveEvent(t){var e=(await this._ctx.commandRouter.send(ot.createGetLiveEvent(t))).payload.liveEvent,n=this._liveEvents.findIndex(e=>e.liveEventId===t);if(-1<n){const r=this._liveEvents[n];r.upsert(e);try{await r.fetchOpenChannel()}catch(e){a.error("failed to fetch initial open channel")}return r}{const s=new tn({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:e});try{await s.fetchOpenChannel()}catch(e){a.error("failed to fetch initial open channel")}return this._liveEvents.push(s),s}}clear(){this._liveEvents=[];for(const e of this._liveEvents)e.teardown()}}class rn{constructor(e,t){this.key=e,this.value=t}toString(){return this.key}equals(e){return this.value.width===e.value.width&&this.value.height===e.value.height}}c(rn,"_720P",new rn("_720P",{width:1280,height:720})),c(rn,"_540P",new rn("_540P",{width:960,height:540})),c(rn,"_480P",new rn("_480P",{width:848,height:480})),c(rn,"_360P",new rn("_360P",{width:640,height:360}));const sn=rn._720P;class an extends ct{constructor(e,t){super(),this._streamManger=e,this.constraints=t,c(this,"onDisposed",void 0),c(this,"hasPermission",!1)}get stream(){return this._streamManger.stream}dispose(){this.removeAllEventListeners(),this.onDisposed?.()}streamChanged(e){this._dispatchEvent("streamChanged",e)}audioOutputChanged(){this._dispatchEvent("audioOutputChanged")}}let on,cn,un,ln,hn,dn;const pn=(e,t)=>{t.audio&&0===e.getAudioTracks().length&&e.addTrack((()=>{const e=on=on||new(window.AudioContext||window.webkitAudioContext),t=(cn=e.createOscillator(),e.createMediaStreamDestination()),n=e.createGain();return n.gain.setValueAtTime(0,e.currentTime),cn.connect(n).connect(t),cn.start(),hn=t.stream.getAudioTracks()[0],t.stream.getAudioTracks()[0]})()),t.video&&0===e.getVideoTracks().length&&e.addTrack((e=>{let{width:t,height:n,frameRate:r}=e;(un=un||document.createElement("canvas")).width=t,un.height=n,un.getContext("2d").fillRect(0,0,t,n),ln=ln||setInterval(()=>{un.getContext("2d").fillRect(0,0,t,n)},1e3);const s=un.captureStream(r);return dn=s.getVideoTracks()[0],s.getVideoTracks()[0]})({...sn.value,frameRate:24}))};function fn(){hn&&hn.stop(),dn&&dn.stop(),hn=null,dn=null,ln&&(clearInterval(ln),ln=null),cn&&(cn.onended=()=>{cn.disconnect(),cn=null},cn.stop())}function _n(e){if(e)for(const t of e.getTracks())t.stop()}const vn=(e,t,n)=>{e=e.match(t);return e&&e.length>=n&&parseInt(e[n],10)};const mn="safari"===(()=>{const e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;const t=window["navigator"];if(t.mozGetUserMedia)e.browser="firefox",e.version=vn(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)e.browser="chrome",e.version=vn(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=vn(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=vn(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return e})().browser;class gn{constructor(e){c(this,"_deviceManager",void 0),c(this,"_hasPermission",!1),c(this,"stream",void 0),c(this,"_updateAt",void 0),c(this,"_updateQueued",void 0),this._deviceManager=e,this._updateQueued=!1}async updateStream(){if(this._updateAt)this._updateQueued=!0;else{var n=this._deviceManager.mediaAccesses.some(e=>e.constraints.audio),r=this._deviceManager.mediaAccesses.some(e=>e.constraints.video);if(!n&&!r)return _n(this.stream),void fn();this._updateAt=Date.now();var e=this.stream;if(!e){const e=new MediaStream;pn(e,{audio:n,video:r}),this.stream=e}mn&&_n(e);let t;try{var s=await this._deviceManager.getMediaConstraints({usingAudio:n,usingVideo:r});t=await navigator.mediaDevices.getUserMedia(s),this._hasPermission=!0;for(const i of this._deviceManager.mediaAccesses)i.hasPermission=!0;fn()}catch(e){t=new MediaStream}pn(t,{audio:n,video:r}),mn||_n(e),this.stream=t;for(const a of this._deviceManager.mediaAccesses)a.streamChanged(this.stream);delete this._updateAt,this._updateQueued?(this._updateQueued=!1,this.updateStream()):this._deviceManager.refreshMediaDevices({audio:n,video:r},!0)}}}function yn(e,t){return e?.deviceId===t?.deviceId&&e?.label===t?.label&&e?.groupId===t?.groupId}class En{constructor(){c(this,"mediaAccesses",void 0),c(this,"_availableMediaDevices",void 0),c(this,"_currentMediaDevices",void 0),c(this,"_sendbirdCallListeners",void 0),c(this,"_streamManager",void 0),this.mediaAccesses=[],this._availableMediaDevices={audioinput:[],audiooutput:[],videoinput:[]},this._currentMediaDevices={audioinput:void 0,audiooutput:void 0,videoinput:void 0},this._sendbirdCallListeners=new Map,this._streamManager=new gn(this),navigator.mediaDevices.ondevicechange=()=>this._onDeviceChanged()}_onDeviceChanged(){0!==this.mediaAccesses.length&&this.refreshMediaDevices({audio:this.mediaAccesses.some(e=>e.constraints.audio),video:this.mediaAccesses.some(e=>e.constraints.video)})}addSendBirdCallListener(e,t){this._sendbirdCallListeners.set(e,t)}removeSendBirdCallListener(e){this._sendbirdCallListeners.delete(e)}removeAllSendBirdCallListener(){this._sendbirdCallListeners.clear()}getCurrentAudioInputDevice(){return this._currentMediaDevices.audioinput}getCurrentAudioOutputDevice(){return this._currentMediaDevices.audiooutput}getCurrentVideoInputDevice(){return this._currentMediaDevices.videoinput}getAvailableAudioInputDevices(){return this._availableMediaDevices.audioinput}getAvailableAudioOutputDevices(){return this._availableMediaDevices.audiooutput}getAvailableVideoInputDevices(){return this._availableMediaDevices.videoinput}async _updateStream(){return this._streamManager.updateStream()}_registerMediaAccess(e){this.mediaAccesses.push(e),e.onDisposed=()=>this.stopMedia(e)}useMedia(e){{if(e.audio||e.video)return e=new an(this._streamManager,e),this._registerMediaAccess(e),this._updateStream(),e;a.error(new Error("you should set true for at least 1 media type."))}}stopMedia(e){this.mediaAccesses.splice(this.mediaAccesses.indexOf(e),1),this._updateStream()}async fetchMediaDevices(){const e=await navigator.mediaDevices.enumerateDevices();return e.reduce((e,t)=>(e[t.kind].push(t),e),{audioinput:[],audiooutput:[],videoinput:[]})}async getMediaConstraints(e){var{usingAudio:e,usingVideo:t}=e;const n={audio:!1,video:!1};var{audioinput:r,videoinput:s}=await this.fetchMediaDevices();return e&&r.length&&(e=this.getCurrentAudioInputDevice(),n.audio={deviceId:e?.deviceId}),t&&s.length&&(r=this.getCurrentVideoInputDevice(),n.video={deviceId:r?.deviceId,...sn.value,frameRate:24}),n}_updateCurrentMediaDevice(e,t){const n=this._availableMediaDevices[e];var r=this._currentMediaDevices[e];let s=n.find(e=>e.deviceId===t?.deviceId);return s||(a.warning("Selected device is unavailable. fallback to default device."),s=s??0<n.length?n[0]:null),!yn(r,this._currentMediaDevices[e]=s)}_onAudioOutputChanged(){for(const e of this.mediaAccesses)e.constraints.audio&&e.audioOutputChanged()}selectDevice(e,t){t.kind!==e?a.error(new Error("Tried to select invalid device of type")):this._updateCurrentMediaDevice(e,t)&&("audioinput"!==e&&"videoinput"!==e||this._updateStream(),"audiooutput"===e&&this._onAudioOutputChanged())}_updateAvailableDevices(e,t){var n=this._currentMediaDevices[e];if(!!function(t,n){if(t.length===n.length){for(let e=0;e<n.length;e++)if(!yn(t[e],n[e]))return;return 1}}(this._availableMediaDevices[e],t))return!1;this._availableMediaDevices[e]=t,n=this._updateCurrentMediaDevice(e,n);for(const s of this._sendbirdCallListeners.values()){var r=this._currentMediaDevices[e];switch(e){case"audioinput":s.onAudioInputDeviceChanged?.(r,t);break;case"audiooutput":s.onAudioOutputDeviceChanged?.(r,t);break;case"videoinput":s.onVideoInputDeviceChanged?.(r,t)}}return n}async refreshMediaDevices(e){var{audio:e,video:t}=e,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!e&&!t)throw new Error("at least one of the audio or video must be true");var{audioinput:r,audiooutput:s,videoinput:i}=await this.fetchMediaDevices();let a=!1,o=!1;e&&(a=this._updateAvailableDevices("audioinput",r),o=this._updateAvailableDevices("audiooutput",s)),t&&(a=this._updateAvailableDevices("videoinput",i)||a),!n&&a&&this._updateStream(),o&&this._onAudioOutputChanged()}}var In="v1.0.0-beta";class bn{constructor(e){c(this,"_parse",void 0),this._parse=e}parseToJson(e){try{return JSON.parse(e)}catch(e){return{}}}validate(e){var t=e["cmd"],n=e.request_id,e=e.call_type;return!!(n||t||e)}parseCommand(e){return e.error?{isValid:!0,error:{requestId:e.request_id,message:e.message,code:e.code}}:{isValid:!0,command:this._parse(e)}}parse(e){e=this.parseToJson(e);return this.validate(e)?this.parseCommand(e):{isValid:!1}}}class Tn extends ct{constructor(e){super(),this._ctx=e,c(this,"_ws",void 0),c(this,"_messageParser",void 0),c(this,"_sessionKey",void 0),c(this,"_requestMap",void 0),c(this,"_hostUrl",void 0),c(this,"_retryTimer",void 0),c(this,"_closed",void 0),this._ws=null,this._retryTimer=null,this._closed=!0,this._sessionKey=null,this._requestMap=new kt(this._getTimeoutTime()),this._messageParser=new bn(this._ctx.parse),this._hostUrl=this._ctx.websocketHost??"wss://ws-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",this._ctx.appId)}connect(){return new Promise((e,t)=>{this._sessionKey||t(new Error("tried to connect to websocket server without auth")),this._ws=this._createWebSocket(),this._closed=!1,this._ws.onopen=()=>{this._onOpen(),e(null)},this._ws.onmessage=e=>{var{isValid:e,error:t,command:n}=this._messageParser.parse(e.data);e&&(t?this._processError(t):this.processCommand(n))},this._ws.onerror=e=>this._onError(e),this._ws.onclose=()=>{this._onClose(),t(new Error("websocket connection failed"))}})}_processError(e){var{requestId:e,message:t}=e;const n=this._requestMap.unregister(e);n&&n.reject(new Error(t))}processCommand(e){this._dispatchEvent("command",e)}setSessionKey(e){this._sessionKey=e}clearSessionKey(){this._disconnect(),this._sessionKey=null}_disconnect(){this._ws&&(this._closed=!0,this._removeRetryTimer(),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onerror=null,this._ws.onclose=null,this._ws.close(),this._requestMap.rejectAll(new Error("request failed due to websocket connection lost")),this._ws=null)}get isConnected(){return!!this._ws&&1===this._ws.readyState}_onOpen(){}_onError(e){}_onClose(){this._startToReconnect()}_createWebSocket(){var e=`/?sbcall_session_token=${encodeURIComponent(this._sessionKey)}&sbcall_client_id=${encodeURIComponent(this._ctx.clientId)}&sendbird=`+encodeURIComponent(this._getVersion());return new WebSocket(this._getHost()+e)}_getVersion(){return`JS,${this._getOsVersion()},`+In}_getHost(){return this._hostUrl}_startToReconnect(){this._closed||this._retryTimer||(this._retryTimer=setTimeout(this._reconnect.bind(this),this._getRetryTime()))}_reconnect(){this._removeRetryTimer(),this.connect().catch(()=>{})}_removeRetryTimer(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)}_getTimeoutTime(){return 6e4}_getRetryTime(){return 2e3}_getOsVersion(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}class Cn{constructor(e){this._ctx=e,c(this,"_fetch",void 0),c(this,"_sessionKey",void 0),c(this,"_hostUrl",void 0),this._fetch=function(){return window.fetch(...arguments)},this._sessionKey=null,this._hostUrl=this._ctx.apiHost??"https://api-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",this._ctx.appId)}setSessionKey(e){this._sessionKey=e}clearSessionKey(){this._sessionKey=null}async send(e){if(!e.getApiOption)throw new Error("invalid api request "+JSON.stringify(e));var t=e.getApiOption();if(t.auth&&!this._sessionKey)throw new Error("tried to call private api without auth");const n={"Content-Type":"application/json",...t.headers},r=(n.SendBird=`JS,${this._getOsVersion()},`+In,n["SBCall-Client-Id"]=this._ctx.clientId,this._sessionKey&&(n["SBCall-Session-Token"]=this._sessionKey),await this._fetch(""+this._getHost()+t.path,{method:t.method,body:JSON.stringify(t.body),headers:n}));t=await r.text();let s=null;try{s=JSON.parse(t)}catch(e){throw new Error("malformed data")}if(!r.ok){if(s.error)throw new Error("server error");if(500===r.status)throw new Error("internal server error");if(300<=r.status&&r.status<400)throw new Error("malformed data");throw new Error("request failed")}try{var i=this._ctx.parseResponse(e,s);if(i)return i}catch(e){return s}return s}_getHost(){return this._hostUrl}_getOsVersion(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}var wn=function(e,t){return(wn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}wn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function re(e,a,o,c){return new(o=o||Promise)(function(n,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function s(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,s)}i((c=c.apply(e,a||[])).next())})}function se(r,s){var i,a,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(o=2&t[0]?a.return:t[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,t[1])).done)return o;switch(a=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,a=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!((o=0<(o=c.trys).length&&o[o.length-1])||6!==t[0]&&2!==t[0])){c=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){c.label=t[1];break}if(6===t[0]&&c.label<o[1]){c.label=o[1],o=t;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(t);break}o[2]&&c.ops.pop(),c.trys.pop();continue}t=s.call(r,c)}catch(e){t=[6,e],a=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function ie(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sn(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return a}function Nn(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||((r=r||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))}Object.defineProperty(On,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(On,"SDK_VERSION",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(On,"SDK_MAJOR_VERSION",{get:function(){return On.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(On,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(On,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0});var d,An=On;function On(){}(s=d=d||{})[s.INVALID_TOKEN=400111]="INVALID_TOKEN",s[s.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",s[s.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",s[s.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",s[s.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",s[s.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",s[s.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",s[s.LOST_INSTANCE=700100]="LOST_INSTANCE",s[s.CONNECTION_RENEW=700102]="CONNECTION_RENEW",s[s.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",s[s.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",s[s.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",s[s.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",s[s.INVALID_PARAMETER=800110]="INVALID_PARAMETER",s[s.NETWORK_ERROR=800120]="NETWORK_ERROR",s[s.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",s[s.MALFORMED_DATA=800130]="MALFORMED_DATA",s[s.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",s[s.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",s[s.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",s[s.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",s[s.ACK_TIMEOUT=800180]="ACK_TIMEOUT",s[s.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",s[s.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",s[s.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",s[s.REQUEST_FAILED=800220]="REQUEST_FAILED",s[s.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",s[s.REQUEST_CANCELED=800240]="REQUEST_CANCELED",s[s.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",s[s.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",s[s.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",s[s.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",s[s.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED";function Rn(e){return!(e instanceof f&&!e.shouldThrowOutside)}function Dn(e,t){return e===t||(e=p({},e),t=p({},t),!(e.hasOwnProperty("messageId")&&t.hasOwnProperty("messageId")&&e.messageId!==t.messageId||e.hasOwnProperty("reqId")&&t.hasOwnProperty("reqId")&&e.reqId!==t.reqId||(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,t.hasOwnProperty("messageId")&&delete t.messageId,t.hasOwnProperty("reqId")&&delete t.reqId,JSON.stringify(e)!==JSON.stringify(t))))}function Mn(e){return 0<e&&0<=Fn.indexOf(e)}function kn(e,t){if((t=void 0===t?!1:t)&&null===e)return!0;if(!(t=u("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type)){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return t}function Ln(e){var t=void 0===(t=e.encryption)?null:t,n=void 0===(n=e.store)?null:n,e=void 0===(e=e.localCacheEnabled)||e;this.nestdb=null,this.store=n,this.preference=new Qn({store:n}),this.encryption=null!=t?t:Bn,this.localCacheEnabled=e}function Un(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}function Pn(){}function E(t){var n={};return t&&Object.keys(t).forEach(function(e){void 0!==t[e]&&NaN!==t[e]&&null!==t[e]&&(n[e]=t[e])}),n}e(r,xn=Error),Object.defineProperty(r.prototype,"isInvalidTokenError",{get:function(){return this.code===d.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===d.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===d.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(r,"debugModeRequired",{get:function(){return new r({code:d.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"lostInstance",{get:function(){return new r({code:d.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"connectionRenew",{get:function(){return new r({code:d.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"invalidConnectionStateTransition",{get:function(){return new r({code:d.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"connectionRequired",{get:function(){return new r({code:d.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"connectionCanceled",{get:function(){return new r({code:d.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"invalidParameters",{get:function(){return new r({code:d.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"networkError",{get:function(){return new r({code:d.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"markAsReadAllRateLimitExceeded",{get:function(){return new r({code:d.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"queryInProgress",{get:function(){return new r({code:d.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"noAckTimeout",{get:function(){return new r({code:d.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"loginTimeout",{get:function(){return new r({code:d.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"connectionClosed",{get:function(){return new r({code:d.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"requestFailed",{get:function(){return new r({code:d.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"fileUploadCanceled",{get:function(){return new r({code:d.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"requestCanceled",{get:function(){return new r({code:d.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"sessionTokenRefreshFailed",{get:function(){return new r({code:d.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(r,"sessionTokenRequestFailed",{get:function(){return new r({code:d.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),r.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this};var I,xn,f=r,qn=[d.CONNECTION_REQUIRED,d.NETWORK_ERROR,d.ACK_TIMEOUT,d.WEBSOCKET_CONNECTION_CLOSED,d.WEBSOCKET_CONNECTION_FAILED,d.FILE_UPLOAD_CANCEL_FAILED,d.REQUEST_CANCELED,d.INTERNAL_SERVER_ERROR,d.RATE_LIMIT_EXCEEDED,d.UNKNOWN_SERVER_ERROR],Fn=[d.WEBSOCKET_CONNECTION_CLOSED,d.WEBSOCKET_CONNECTION_FAILED,d.CONNECTION_REQUIRED],u=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||("string"!=typeof e?"object"==typeof e?Hn(e,t):t instanceof e:typeof t===e)},Hn=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||Object.values(e).includes(t)},l=function(t,e,n){return!(!(n=void 0===n?!1:n)||null!=e)||Array.isArray(e)&&e.every(function(e){return u(t,e)})},Gn=(Object.defineProperty(er.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){u("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(er.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){u("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(er.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){u("number",e)&&1e3<=e&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(er.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){u("number",e)&&5e3<=e&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),er),Vn={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},Bn={encrypt:function(e){return e},decrypt:function(e){return e}},Qn=(Zn.prototype._savePreferenceKeys=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:Nn([],Sn(this._preference.keys()),!1),generation:1})];case 1:return e.sent(),[2]}})})},Zn.prototype.init=function(c){var u;return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o;return se(this,function(e){switch(e.label){case 0:return this._keysAddress=c,[4,this._store.get(c)];case 1:t=null!=(u=e.sent())?u:[],e.label=2;case 2:e.trys.push([2,7,8,9]),n=ie(t),r=n.next(),e.label=3;case 3:return r.done?[3,6]:(s=r.value,[4,this._store.get(s)]);case 4:(i=e.sent())&&this._preference.set(s,i),e.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return i=e.sent(),a={error:i},[3,9];case 8:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 9:return[2]}})})},Zn.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return se(this,function(e){return[2,null!=(n=this._preference.get(t))?n:null]})})},Zn.prototype.set=function(n,r){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return t=!this._preference.has(n),[4,this._store.set({key:n,value:r,generation:1})];case 1:return e.sent(),this._preference.set(n,r),t?[4,this._savePreferenceKeys()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},Zn.prototype.remove=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._store.remove(t)];case 1:return e.sent(),this._preference.delete(t),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},Zn.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._store.removeMany(Nn([],Sn(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},Zn),jn=(Object.defineProperty(Jn.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),Jn.prototype.clear=function(){this.authToken=null,this.sessionKey=null},Jn),Kn=(Xn.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},Xn.prototype.on=function(e,t){return this._register(e,-1,t)},Xn.prototype.once=function(e,t){return this._register(e,1,t)},Xn.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},Xn),zn=($n.prototype.on=function(e,t){return new Kn({container:this._container}).on(e,t)},$n.prototype.once=function(e,t){return new Kn({container:this._container}).once(e,t)},$n.prototype.dispatch=function(e,t){var n,r,s=this._container[e];if(s){var i=[];try{for(var a=ie(s.keys()),o=a.next();!o.done;o=a.next()){var c=o.value,u=s.get(c);u.handler(t),0<u.occurence&&(u.occurence--,0===u.occurence&&i.push(c))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}i.forEach(function(e){return s.delete(e)})}},$n),Wn=(Yn.prototype.on=function(e){return this._dispatcher.on("event",e)},Yn.prototype.once=function(e){return this._dispatcher.once("event",e)},Yn.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},Yn);function Yn(){this._dispatcher=new zn}function $n(){this._container={}}function Xn(e){e=e.container;this._container={},this._container=e,this.key=Un()}function Jn(){this.sessionKey=null,this.authToken=null}function Zn(e){e=e.store;this._preference=new Map,this._store=e}function er(e){var e=void 0===e?{}:e,t=e.useMemberInfoInMessage,t=void 0!==t&&t,n=e.typingIndicatorInvalidateTime,n=void 0===n?1e4:n,r=e.typingIndicatorThrottle,r=void 0===r?1e3:r,e=e.websocketResponseTimeout,e=void 0===e?1e4:e;this._useMemberInfoInMessage=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=t,this._typingIndicatorInvalidateTime=n,this._typingIndicatorThrottle=r,this._websocketResponseTimeout=e}function r(e){var t=e.code,t=void 0===t?0:t,e=e.message,e=xn.call(this,e)||this;return e.shouldThrowOutside=!1,e.name="SendbirdError",e.code=t,Object.setPrototypeOf(e,r.prototype),e}(s=I=I||{}).GET="GET",s.POST="POST",s.PUT="PUT",s.DELETE="DELETE";e(fr,ar=Pn),fr.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},Object.defineProperty(fr.prototype,"query",{get:function(){var t=this,n=E(this.params);return"?".concat(Object.keys(n).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t.stringifyParams(n[e])))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(fr.prototype,"payload",{get:function(){var r,s=this,i=E(this.params);return Object.keys(i).some(function(e){return kn(i[e])})?(r=new FormData,Object.keys(i).forEach(function(e){var t,n=i[e];kn(n)?r.append(e,n,null!=(t=n.name)?t:"filename"):r.append(e,s.stringifyParams(n))}),r):JSON.stringify(i)},enumerable:!1,configurable:!0});var tr,nr,rr,sr,ir,ar,o=fr,_=(e(pr,ir=Pn),Object.defineProperty(pr.prototype,"payload",{get:function(){return p({},this._payload)},enumerable:!1,configurable:!0}),pr.prototype.as=function(e){return new e(this._iid,this.payload)},pr),or=(e(dr,sr=Pn),dr),cr=(e(hr,rr=Pn),hr),ur=(e(lr,nr=Pn),lr);function lr(e){var t=nr.call(this)||this;return t.statLog=e,t}function hr(){return null!==rr&&rr.apply(this,arguments)||this}function dr(e){var t=sr.call(this)||this;return t.requestId=e,t}function pr(e,t){var n=ir.call(this)||this;return n._iid=e,n._payload=t,n}function fr(){var e=null!==ar&&ar.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=Un(),e}(s=tr=tr||{}).WEBSOCKET_CONNECT="ws:connect",s.API_RESULT="api:result";function t(){}Rr.payloadify=function(e){return E({stat_type:e.type,ts:e.createdAt,data:E(e.data)})};var _r,vr,mr,gr,yr=Rr,Er=(Object.defineProperty(Or.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",e=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(An.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(e)},enumerable:!1,configurable:!0}),Or.prototype._createHeader=function(e,t){void 0===t&&(t=null);var n=this._sdkState,r=n.appId,n=n.appVersion,n=p(p({},e.headers),{SendBird:"JS,".concat(An.OS_VERSION,",").concat(An.SDK_VERSION,",").concat(r).concat(n?",".concat(n):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(n["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(n["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(n["App-Id"]=r,n["Access-Token"]=this._auth.authToken),n},Or.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new ur(new yr({type:tr.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},Or.prototype.send=function(h){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c,u,l;return se(this,function(e){switch(e.label){case 0:r=h.path,t=h.method,s=![I.GET,I.DELETE].includes(t),n=this._sdkState.api,n="".concat(n.host).concat(r).concat(s?"":h.query),r=s?h.payload:null,s=this._createHeader(h,r instanceof FormData?r:null),a=new AbortController,i=a.signal,this._abortControl.set(h.requestId,a),a=Date.now(),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(n,{method:t,body:r,headers:s,signal:i})];case 2:return[4,(o=e.sent()).json()];case 3:if(u=e.sent(),o.ok||o.redirected)return this._logger.debug("receive api response",h.requestId),this._statLogApiResult(h,a,null),[2,new _(this._iid,u)];throw u?(c=new f(u)).isSessionKeyExpiredError&&this._dispatcher.dispatch(new cr):c=f.requestFailed,this._statLogApiResult(h,a,c),c;case 4:throw u=e.sent(),this._statLogApiResult(h,a,u),u instanceof f?(this._logger.debug("fail api request",u),u):"AbortError"===u.name?f.requestCanceled:(l=f.networkError,this._logger.debug("fail api request",l),l);case 5:return[2]}})})},Or.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},Or.prototype.cancelAll=function(){var e,t;try{for(var n=ie(this._abortControl.values()),r=n.next();!r.done;r=n.next())r.value.abort()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},Or),Ir=(e(Ar,gr=Pn),Ar.createFromRawMessage=function(e,t){var n=t.substring(0,4),r=null;try{r=JSON.parse(t.substring(4))}catch(e){n="NOOP"}finally{return new Ar(e,n,r)}},Ar.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},Ar.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},Ar),br=(e(Nr,mr=Pn),Nr.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},Nr),Tr=(e(Sr,vr=br),Sr),Cr=(Object.defineProperty(wr.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),wr.prototype.ping=function(){var e,t=this,n=new Tr;try{var r=null!=(e=this.sdkState.websocket.pongTimeout)?e:5e3;this._pingTimeoutTimer=setTimeout(function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)},r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n},wr.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},wr.prototype.refreshTimer=function(){var e=this,t=(this._logger.debug("pinger.refreshTimer()"),null!=(t=this.sdkState.websocket.pingInterval)?t:15e3);this.stop(),this._pingTimer=setInterval(function(){e.ping()},t)},wr.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},wr.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},wr);function wr(e){var t=e.pingDelegate,n=e.sdkState,e=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=e}function Sr(){return vr.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}function Nr(e){var t=e.code,n=e.ackRequired,e=e.payload,e=void 0===e?null:e,r=this;return(r=mr.call(this)||this).code=t,r.payload=e,r.requestId=null!=(t=r.payload.req_id)?t:Un(),r.ackRequired=n,r.payload.req_id=r.requestId,r}function Ar(e,t,n,r){void 0===r&&(r="");var s=this;return(s=gr.call(this)||this)._iid=e,s.code=t,s.payload=n,s.requestId=n?null!=(e=n.req_id)?e:r:"",s}function Or(e,t){var n=t.auth,r=t.sdkState,s=t.dispatcher,t=t.logger,i=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=s,this._dispatcher.on(function(e){e instanceof or&&i.cancel(e.requestId)}),this._logger=t}function Rr(e){var t=e.type,n=e.data,e=e.ts,e=void 0===e?Date.now():e;this.type=t,this.createdAt=e,this.data=n}(s=_r=_r||{}).CONNECTING="CONNECTING",s.OPEN="OPEN",s.CLOSED="CLOSED";function Dr(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}e(Hr,Lr=zn),Object.defineProperty(Hr.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return _r.CONNECTING;case 1:return _r.OPEN}return _r.CLOSED},enumerable:!1,configurable:!0}),Hr.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach(function(e){e&&u("string",e)&&(e=Ir.createFromRawMessage(t._iid,e),t._logger.debug("receive websocket event",e),"LOGI"===e.code?(e.payload&&!e.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",e)):"PONG"===e.code?t._pinger&&t._pinger.pong():"EXPR"===e.code?e.payload&&0<e.payload.expires_in&&t._dispatcher.dispatch(new cr):"NOOP"!==e.code&&t.dispatch("message",e))})},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",f.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close")},this.lastActive=Date.now()},Hr.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=t,this._ws.onmessage=t,this._ws.onerror=t,this._ws.onclose=function(){e.dispatch("close")},this._ws.close(),this._ws=null)},Hr.prototype.send=function(e){if(!this._ws)throw f.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},Hr.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e)};var Mr,kr,Lr,Ur=Hr,Pr=(e(Fr,kr=Pn),Fr),xr=(qr.prototype._sendApiRequest=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(t)];case 1:return[2,e.sent()]}})})},qr.prototype._sendWebsocketRequest=function(i){return re(this,void 0,void 0,function(){var n,r,t,s=this;return se(this,function(e){if(n=new Dr,i.ackRequired){r=null,t=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),s._ackStateMap.has(i.requestId)&&(s._ackStateMap.delete(i.requestId),r&&(clearTimeout(r),r=null),e?(s._logger.debug("fail websocket request",e),n.reject(e)):(s._logger.debug("receive websocket ack",i.requestId),n.resolve(t)))};try{r=setTimeout(function(){return t(f.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(i.requestId,{resolve:function(e){return t(null,e)},reject:function(e){return t(e)}}),this.websocketClient.send(i)}catch(e){t(e)}}else try{this.websocketClient.send(i),n.resolve(null)}catch(e){n.reject(e)}return[2,n.promise]})})},qr.prototype.send=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return t instanceof o?[4,this._sendApiRequest(t)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return t instanceof br?[4,this._sendWebsocketRequest(t)]:[3,4];case 4:throw f.invalidParameters}})})},qr.prototype.cancel=function(e){this.apiClient.cancel(e)},qr.prototype.cancelAll=function(){this.apiClient.cancelAll()},qr);function qr(e,t){var n=t.auth,r=t.sdkState,s=t.dispatcher,t=t.logger,i=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=s,this._logger=t,this.apiClient=new Er(e,{auth:n,sdkState:r,dispatcher:s,logger:t}),this.websocketClient=new Ur(e,{sdkState:r,dispatcher:s,logger:t}),this.websocketClient.on("message",function(e){var t;e.payload.unread_cnt&&i._dispatcher.dispatch(new Pr(e.payload.unread_cnt)),e.requestId?i._ackStateMap.has(e.requestId)&&(t=i._ackStateMap.get(e.requestId),"EROR"!==e.code?t.resolve(e):t.reject(new f({code:e.payload.code,message:e.payload.message}))):i._dispatcher.dispatch(e)}).on("close",function(){i._ackStateMap.forEach(function(e){e.reject(f.connectionClosed)}),i._ackStateMap.clear()})}function Fr(e){var t=e.all,n=e.custom_types,e=e.ts,r=kr.call(this)||this;return r.all=t,r.customTypes=n,r.ts=e,r}function Hr(e,t){var n=t.sdkState,r=t.dispatcher,t=t.logger,s=Lr.call(this)||this;return s._pinger=null,s.lastActive=0,s._iid=e,s._sdkState=n,s._dispatcher=r,s._logger=t,s._sdkState.websocket.pingerDisabled||(s._pinger=new Cr({pingDelegate:{send:function(e){return s.send(e)},error:function(e){return s.error(e)}},sdkState:s._sdkState,logger:t})),s}(s=Mr=Mr||{})[s.NONE=0]="NONE",s[s.INITIALIZED=1]="INITIALIZED",s[s.CONNECTING=2]="CONNECTING",s[s.CONNECTED=3]="CONNECTED",s[s.RECONNECTING=4]="RECONNECTING",s[s.DISCONNECTED=5]="DISCONNECTED",s[s.LOGOUT=6]="LOGOUT";function Gr(t){return re(void 0,void 0,void 0,function(){return se(this,function(e){return[2,new Promise(function(e){return setTimeout(e,t)})]})})}function Vr(a,o,c){return void 0===c&&(c=new Is),re(void 0,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:t=0,n=null,r=function(e){return n=null!=(e=void 0===e?null:e)?e:new Error("Halted")},s=function(){t=0},e.label=1;case 1:if(!(-1===o||t<o))return[3,9];e.label=2;case 2:return e.trys.push([2,4,,8]),[4,a(r,s)];case 3:if(i=e.sent(),n)throw n;return[2,i];case 4:if(i=e.sent(),n)return[3,6];if(++t===o)throw i;return[4,Gr(c.calcTimeout(t))];case 5:return e.sent(),[3,7];case 6:throw n;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})}function ae(n){re(void 0,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:if((t=e.sent())instanceof f)return t.throwOutside(),[3,3];throw t;case 3:return[2]}})})}function Br(e,t){return null!==(t=void 0===t?null:t)&&Os.set(e,t),null!=(t=Os.get(e))?t:""}function Qr(e){this.emojiHash=(e=void 0===e?{}:e).emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[]}e(ri,ds=Pn);var jr,Kr,zr,Wr,Yr,$r,Xr,Jr,Zr,es,ts,ns,rs,ss,is,as,os,cs,us,ls,hs,ds,ps,fs=ri,_s=(Object.defineProperty(ni.prototype,"isReady",{get:function(){return this._currentConnectionStateType===Mr.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(ni.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===Mr.CONNECTING||this._currentConnectionStateType===Mr.RECONNECTING},enumerable:!1,configurable:!0}),ni.prototype.send=function(s){return re(this,void 0,void 0,function(){var t,n,r=this;return se(this,function(e){switch(e.label){case 0:return s instanceof br?this.isReady?(this._logger.debug("send websocket request",s),[4,this.commandRouter.send(s)]):[3,2]:[3,4];case 1:case 5:return[2,e.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",s),t=new Dr,this._lazyCallQueue.push({command:s,deferred:t,timeout:setTimeout(function(){return r.timeout(s.requestId)},1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),f.connectionRequired;case 3:return[3,7];case 4:return s instanceof o?this._auth.hasSession?(this._logger.debug("send api request",s),[4,this.commandRouter.send(s)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",s),t=new Dr,this._lazyCallQueue.push({command:s,deferred:t,timeout:setTimeout(function(){return r.timeout(s.requestId)},1e4)}),[2,t.promise];throw n=f.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}})})},ni.prototype.forceSend=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this._logger.debug("send websocket request (forced)",t),[4,this.commandRouter.send(t)];case 1:return[2,e.sent()]}})})},ni.prototype.timeout=function(t){this._logger.debug("timeout request",t);var e=this._lazyCallQueue.findIndex(function(e){return e.command.requestId===t});-1<e&&(this._lazyCallQueue[e].deferred.reject(f.connectionRequired),this._lazyCallQueue.splice(e,1))},ni.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},ni.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},ni),vs=(e(ti,hs=o),ti),ms=(e(ei,ls=br),ei),gs=(e(Zs,us=_),Zs),ys=(e(Js,cs=Ir),Js),Es=(e(Xs,os=Pn),Xs),Is=($s.prototype.calcTimeout=function(){return 0},$s),bs=(Ys.prototype.createRefreshWebsocketCommand=function(e){return new ms({authToken:e,expiringSession:!0})},Ys.prototype._refreshSessionKey=function(a,o){return re(this,void 0,void 0,function(){var t,n,r,s,i=this;return se(this,function(e){switch(e.label){case 0:if(this._currentConnectionStateType!==Mr.CONNECTED)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this.createRefreshWebsocketCommand(a),[4,this._requestQueue.forceSend(t)];case 2:if(t=e.sent(),r=t.as(ys),n=r.newKey,r=r.error)throw r;return this.auth.sessionKey=null!=n?n:this.auth.sessionKey,this._logger.debug("session refreshed"),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2];case 3:if(r=e.sent(),Rn(r))throw r;return r.isSessionTokenExpiredError?(this._handleError(o),[2]):[3,4];case 4:return e.trys.push([4,6,,7]),s=new vs({userId:this._sdkState.userId,authToken:a,expiringSession:!0}),[4,Vr(function(n){return re(i,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(s)];case 1:return t=e.sent(),t=t.as(gs).key,this.auth.sessionKey=t,[3,3];case 2:throw(t=e.sent()).isSessionTokenExpiredError&&n(f.sessionTokenRefreshFailed),t;case 3:return[2]}})})},3)];case 5:return e.sent(),this._logger.debug("session refreshed"),[3,7];case 6:return e.sent(),this._handleError(o),[2];case 7:return ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2]}})})},Ys.prototype._handleError=function(e){var t=this,n=f.sessionTokenRefreshFailed;ae(function(){return re(t,void 0,void 0,function(){return se(this,function(e){return this.handler.onSessionError(n),[2]})})}),e&&e.reject(n)},Ys.prototype.refresh=function(){return re(this,void 0,void 0,function(){var n,t,r,s=this;return se(this,function(e){return this.handler?(n=new Dr,t=function(e){e?(s._logger.debug("session refreshing.."),s.auth.authToken=e,s._refreshSessionKey(e,n)):(s._logger.debug("session closed"),ae(function(){return re(s,void 0,void 0,function(){return se(this,function(e){return this.handler.onSessionClosed(),[2]})})}),n.resolve())},r=function(){s._dispatcher.dispatch(new Es);var t=f.sessionTokenRequestFailed;s.handler&&(ae(function(){return re(s,void 0,void 0,function(){return se(this,function(e){return this.handler.onSessionError(t),[2]})})}),n.reject(t))},this._logger.debug("session expired"),this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,n):ae(function(){return re(s,void 0,void 0,function(){return se(this,function(e){return this.handler.onSessionTokenRequired(t,r),[2]})})}),[2,n.promise]):[2]})})},Ys),s=(Ws.prototype.run=function(e){return re(this,void 0,void 0,function(){return se(this,function(e){return[2]})})},Ws.prototype.onConnect=function(e,t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2]})})},Ws.prototype.onReconnect=function(e,t){return t.resetReconnectCount,re(this,void 0,void 0,function(){return se(this,function(e){return[2]})})},Ws.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,re(this,void 0,void 0,function(){return se(this,function(e){return[2]})})},Ws.prototype.onLogout=function(e){return re(this,void 0,void 0,function(){return se(this,function(e){return[2]})})},Ws),Ts=(e(zs,as=s),zs.prototype.run=function(r){return re(this,void 0,void 0,function(){var t,n=this;return se(this,function(e){switch(e.label){case 0:return t=r.sdkState.userId,r.logout(),ae(function(){return re(n,void 0,void 0,function(){return se(this,function(e){return r.connectionHandlers.forEach(function(e){e.onDisconnected(t)}),[2]})})}),[4,r.changeState(new As)];case 1:return e.sent(),[2]}})})},zs),Cs=(e(Ks,is=s),Ks.prototype.run=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return t.disconnect(),this._autoReconnect?[4,t.changeState(new ws)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Ks.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new Ns({authToken:n}))];case 1:return e.sent(),[2]}})})},Ks.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,t.changeState(new ws)];case 1:return e.sent(),[2]}})})},Ks.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Ts)];case 1:return e.sent(),[2]}})})},Ks),ws=(e(js,ss=s),js.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},js.prototype.run=function(a){return re(this,void 0,void 0,function(){var t,n,r,s,i=this;return se(this,function(e){switch(e.label){case 0:t=new Dr,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectStarted()}),[2]})})}),e.label=1;case 1:return e.trys.push([1,4,,9]),r=a.sdkState.websocket,n=r.reconnectMaxRetry,r=r.reconnectRetryStrategy,[4,Vr(function(n,r){return re(i,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:this._haltConnect=n,this._resetConnect=r,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.connect()];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof f&&t.code===d.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},n,r)];case 2:return e.sent(),[4,a.changeState(new Ss)];case 3:return e.sent(),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectSucceeded()}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return s=e.sent(),Rn(s)?[3,7]:!(s instanceof f)||s.code===d.CONNECTION_CANCELED?[3,6]:[4,a.changeState(new Cs({autoReconnect:!1}))];case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectFailed()}),this.flushCallbacks(s),[2]})})}),[3,8];case 7:throw s;case 8:return[3,9];case 9:return[2,t.promise]}})})},js.prototype.onConnect=function(n,e){return re(this,void 0,void 0,function(){var t;return se(this,function(e){return t=new Dr,this._resetConnect&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},js.prototype.onReconnect=function(n,e){var e=e.resetReconnectCount,r=void 0!==e&&e;return re(this,void 0,void 0,function(){var t;return se(this,function(e){return t=new Dr,this._resetConnect&&r&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},js.prototype.onDisconnect=function(t,e){var n=e.error,r=void 0===n?null:n,n=e.autoReconnect,s=void 0===n||n;return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=r?r:f.connectionCanceled),[4,t.changeState(new Cs({autoReconnect:s}))];case 1:return e.sent(),[2]}})})},js.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(f.connectionCanceled),[4,t.changeState(new Ts)];case 1:return e.sent(),[2]}})})},js),Ss=(e(Qs,rs=s),Qs.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new ws)];case 1:return e.sent(),[2]}})})},Qs.prototype.onDisconnect=function(t,e){var n=e.autoReconnect;return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Cs({autoReconnect:n}))];case 1:return e.sent(),[2]}})})},Qs.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Ts)];case 1:return e.sent(),[2]}})})},Qs),Ns=(e(Bs,ns=s),Bs.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},Bs.prototype.run=function(s){return re(this,void 0,void 0,function(){var t,n,r=this;return se(this,function(e){switch(e.label){case 0:t=new Dr,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),e.label=1;case 1:return e.trys.push([1,4,,9]),[4,Vr(function(n){return re(r,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:this._haltConnect=n,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,s.connect(this._authToken)];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof f&&t.code===d.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},s.sdkState.websocket.connectMaxRetry)];case 2:return e.sent(),[4,s.changeState(new Ss)];case 3:return e.sent(),ae(function(){return re(r,void 0,void 0,function(){return se(this,function(e){return s.connectionHandlers.forEach(function(e){e.onConnected(s.sdkState.userId)}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return n=e.sent(),Rn(n)?[3,7]:(s.disconnect(),!(n instanceof f)||n.code===d.CONNECTION_CANCELED?[3,6]:[4,s.changeState(new As)]);case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(r,void 0,void 0,function(){return se(this,function(e){return this.flushCallbacks(n),[2]})})}),[3,8];case 7:throw n;case 8:return[3,9];case 9:return[2,t.promise]}})})},Bs.prototype.onConnect=function(e){return re(this,void 0,void 0,function(){var t;return se(this,function(e){return t=new Dr,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},Bs.prototype.onDisconnect=function(t,e){var e=e.error,n=void 0===e?null:e;return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=n?n:f.connectionCanceled),[4,t.changeState(new Ts)];case 1:return e.sent(),[2]}})})},Bs.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(f.connectionCanceled),[4,t.changeState(new Ts)];case 1:return e.sent(),[2]}})})},Bs),As=(e(Vs,ts=s),Vs.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Ns({authToken:n}))];case 1:return e.sent(),[2]}})})},Vs),Os=new Map,s=(Gs.payloadify=function(e){return e?{}:null},Gs),h="/".concat("v3","/users"),Rs="/".concat("v3","/storage/file"),Ds="/".concat("v3","/group_channels"),Ms="/".concat("v3","/open_channels"),ks="/".concat("v3","/sdk/open_channels"),Ls="/".concat("v3","/search"),Us="/".concat("v3","/report"),Ps="/".concat("v3","/emojis"),xs="/".concat("v3","/emoji_categories"),qs="/".concat("v3","/sdk/statistics"),Fs=(e(Hs,es=o),Hs);function Hs(e){var t=e.userId,e=e.metadata,n=es.call(this)||this;return n.method=I.POST,n.path="".concat(h,"/").concat(t,"/metadata"),n.params={metadata:e},n}function Gs(e){this._iid="",this._iid=e}function Vs(){var e=null!==ts&&ts.apply(this,arguments)||this;return e.type=Mr.INITIALIZED,e.name="initialized",e}function Bs(e){var e=e.authToken,t=ns.call(this)||this;return t.type=Mr.CONNECTING,t.name="connecting",t._authToken="",t._haltConnect=null,t._callbacks=[],t._authToken=e,t}function Qs(){var e=null!==rs&&rs.apply(this,arguments)||this;return e.type=Mr.CONNECTED,e.name="connected",e}function js(){var e=null!==ss&&ss.apply(this,arguments)||this;return e.type=Mr.RECONNECTING,e.name="reconnecting",e._haltConnect=null,e._resetConnect=null,e._callbacks=[],e}function Ks(e){var e=e.autoReconnect,t=is.call(this)||this;return t.type=Mr.DISCONNECTED,t.name="disconnected",t._autoReconnect=!1,t._autoReconnect=e,t}function zs(){var e=null!==as&&as.apply(this,arguments)||this;return e.type=Mr.LOGOUT,e.name="logout",e}function Ws(){this.type=Mr.NONE,this.name="none"}function Ys(e){var t=e.auth,n=e.sdkState,r=e.dispatcher,s=e.requestQueue,e=e.logger,i=this;this._currentConnectionStateType=Mr.INITIALIZED,this.auth=t,this._sdkState=n,this._dispatcher=r,this._requestQueue=s,this._logger=e,this._dispatcher.on(function(e){var t;e instanceof fs?(t=e.stateType,i._currentConnectionStateType=t):e instanceof cr&&i.refresh()})}function $s(){}function Xs(){return null!==os&&os.apply(this,arguments)||this}function Js(e,t,n){e=cs.call(this,e,"LOGI",n)||this;return e.error=null,e.newKey=n.new_key,e.error=n.error?new f(n.error):null,e}function Zs(e,t){e=us.call(this,e,t)||this,t=t.key;return e.key=t,e}function ei(e){var t=e.authToken,e=e.expiringSession;return ls.call(this,{code:"LOGI",payload:{token:t,expiring_session:void 0===e||e?1:0},ackRequired:!0})||this}function ti(e){var t=e.userId,n=e.authToken,e=e.expiringSession,e=void 0===e||e,r=hs.call(this)||this;return r.path="/users/".concat(t,"/session_key"),r.method=I.POST,r.params={token:n,expiring_session:!!e},r.requireAuth=!1,r}function ni(e,t){var n=t.auth,r=t.sdkState,s=t.dispatcher,t=t.logger,a=this;this._currentConnectionStateType=Mr.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new xr(e,{auth:n,sdkState:r,dispatcher:s,logger:t}),this._auth=n,this._logger=t,this._dispatcher=s,this._dispatcher.on(function(e){if(e instanceof fs){e=e.stateType;switch(a._currentConnectionStateType=e){case Mr.CONNECTED:var t=a._lazyCallQueue;a._lazyCallQueue=[],t.forEach(function(i){return re(a,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:t=i.command,n=i.deferred,r=i.timeout,clearTimeout(r),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.send(t)];case 2:return r=e.sent(),n.resolve(r),[3,4];case 3:return s=e.sent(),n.reject(s),[3,4];case 4:return[2]}})})});break;case Mr.INITIALIZED:case Mr.DISCONNECTED:case Mr.LOGOUT:t=a._lazyCallQueue,a._lazyCallQueue=[],t.forEach(function(r){return re(a,void 0,void 0,function(){var t,n;return se(this,function(e){return t=r.deferred,n=r.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(f.connectionClosed):t.reject(f.connectionRequired),[2]})})})}}})}function ri(e){var e=e.stateType,t=ds.call(this)||this;return t.stateType=e,t}e(function(e,t){return(e=ps.call(this,e,t)||this).metadata=t,e},ps=_),(y=jr=jr||{}).BASE="base",y.GROUP="group",y.OPEN="open",(y=Kr=Kr||{}).OPERATOR="operator",y.NONE="none",(y=zr=zr||{}).BASE="base",y.USER="user",y.FILE="file",y.ADMIN="admin",(y=Wr=Wr||{}).ALL="",y.USER="MESG",y.FILE="FILE",y.ADMIN="ADMM",(y=Yr=Yr||{}).USER="MESG",y.FILE="FILE",y.ADMIN="ADMM",(y=$r=$r||{}).USERS="users",y.CHANNEL="channel",(y=Xr=Xr||{}).ALL="all",y.NONE="none",y.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",(y=Jr=Jr||{}).DEFAULT="default",y.SUPPRESS="suppress",(y=Zr=Zr||{}).PENDING="pending",y.SCHEDULED="scheduled",y.SUCCEEDED="succeeded",y.FAILED="failed",y.CANCELED="canceled";function b(e){switch(e){case jr.GROUP:return Ds;case jr.OPEN:return Ms;default:return null}}function si(e){switch(e){case jr.GROUP:return"".concat(Us,"/group_channels");case jr.OPEN:return"".concat(Us,"/open_channels");default:return null}}function ii(e,t,n){return e=di(e.mentionType,e.mentionedUserIds,n),t=di(t.mentionType,t.mentionedUserIds,n),!e&&t?1:e&&!t?-1:0}var ai,oi,ci,ui,li,hi,di=function(e,t,n){var r,s;switch(e){case $r.CHANNEL:return!0;case $r.USERS:if(t)try{for(var i=ie(t),a=i.next();!a.done;a=i.next())if(a.value===n)return!0}catch(e){r={error:e}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(r)throw r.error}}}return!1},pi=(e(bi,li=o),bi),fi=(e(Ii,ui=_),Ii),_i=(e(Ei,ci=o),Ei),vi=(e(yi,oi=_),yi),mi=(e(gi,ai=o),gi);function gi(e){var t=e.userId,e=e.metadataKey,n=ai.call(this)||this;return n.method=I.DELETE,n.path="".concat(h,"/").concat(t,"/metadata/").concat(e),n}function yi(e,t){e=oi.call(this,e,t)||this;return e.metadata=t,e}function Ei(e){var t=e.userId,n=e.metadata,e=e.upsert,r=ci.call(this)||this;return r.method=I.PUT,r.path="".concat(h,"/").concat(t,"/metadata"),r.params={metadata:n,upsert:e},r}function Ii(e,t){e=ui.call(this,e,t)||this;return e.metaData=null!=t?t:{},e}function bi(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metadata;return(t=li.call(this)||this).method=I.POST,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:e,include_ts:!0},t}e(function(){return null!==hi&&hi.apply(this,arguments)||this},hi=_);e(Si,Ti=o);var Ti,Ci,wi=Si;function Si(e){var e=e.userId,t=Ti.call(this)||this;return t.method=I.DELETE,t.path="".concat(h,"/").concat(e,"/metadata"),t}e(function(){return null!==Ci&&Ci.apply(this,arguments)||this},Ci=_);function Ni(e,t){return void 0===t&&(t=null),(e=JSON.parse(JSON.stringify(e)))._iid&&delete e._iid,t&&t(e),e}function Ai(e,t){return void 0===t&&(t=null),e=JSON.parse(JSON.stringify(e)),t&&t(e),e}function v(t){return{do:function(e){t||e()},throw:function(e){if(!t)throw e}}}var Oi;(y=Oi=Oi||{}).ONLINE="online",y.OFFLINE="offline",y.NON_AVAILABLE="nonavailable";e(Xi,Pi=s),Xi.payloadify=function(e){return e?E(p(p({},Pi.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null},Object.defineProperty(Xi.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(Br(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),Xi.prototype.serialize=function(){return Ni(this)},Xi.prototype._isValidMetaData=function(t){return!Array.isArray(t)&&0<Object.keys(t).length&&Object.keys(t).map(function(e){return t[e]}).every(function(e){return u("string",e)})},Xi.prototype._applyMetaData=function(t,n){var r=this;void 0===n&&(n=!1),Object.keys(t).forEach(function(e){n?delete r.metaData[e]:r.metaData[e]=t[e]})},Xi.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(this._isValidMetaData(r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Fs({userId:n.userId,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(fi).metaData,this._applyMetaData(n),[2,this.metaData]}})})},Xi.prototype.updateMetaData=function(r,s){return void 0===s&&(s=!1),re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(this._isValidMetaData(r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new _i({userId:n.userId,metadata:r,upsert:s}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(vi).metadata,this._applyMetaData(n),[2,this.metaData]}})})},Xi.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)).throw(f.invalidParameters),n=g.of(this._iid),t=n.sdkState,n=n.requestQueue,t=new mi({userId:t.userId,metadataKey:r}),[4,n.send(t)];case 1:return e.sent(),this._applyMetaData(((n={})[r]=!0,n),!0),[2,this.metaData]}})})},Xi.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new wi({userId:n.userId}),[4,t.send(n)];case 1:return e.sent(),this.metaData={},[2]}})})};var Ri,Di,Mi,ki,Li,Ui,Pi,m=Xi,xi=(e($i,Ui=Pn),$i),qi=(Yi.payloadify=function(e){return p(p({},m.payloadify(e.user)),{emoji_hash:e.appInfo.emojiHash,file_upload_size_limit:e.appInfo.uploadSizeLimit,application_attributes:e.appInfo.applicationAttributes,premium_feature_list:e.appInfo.premiumFeatureList,login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},Yi.prototype.apply=function(){var t=this.reconnectInterval,n=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,e=g.of(this._iid);e.sdkState.websocket.pingInterval=1e3*this.pingInterval,e.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,e.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,e.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(e){return 0<e?1e3*Math.min(t*Math.pow(r,e-1),n):10}},e.appInfo=this.appInfo,e.sessionManager.currentUser=this.user,e.connectedAt=this.connectedAt,this.firstConnectedAt||(e.firstConnectedAt=this.connectedAt),e.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,e.concurrentCallLimit=this.concurrentCallLimit,e.backOffDelay=this.backOffDelay,e.dispatcher.dispatch(new xi({userProfile:this}))},Yi),Fi=(e(Wi,Li=Ir),Wi.asError=function(e){return new Wi(null,"LOGI",p({user_id:null,error:!0},e))},Wi.prototype.applyTo=function(e){if(this.error)throw this.error;var t=g.of(e);if(!t)throw f.lostInstance;t.sessionManager.auth.sessionKey=this.key,Br(e,this.ekey),this.userProfile.apply()},Wi),Hi=(e(zi,ki=Pn),zi),Gi=(e(Ki,Mi=zn),Object.defineProperty(Ki.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Ki.prototype.changeState=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this._currentState=t,this._dispatcher.dispatch(new fs({stateType:t.type})),this._logger.debug("connection state changes to ".concat(t.name)),[4,this._currentState.run(this)];case 1:return e.sent(),[2]}})})},Ki.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,s=t.userId,t=t.extensions,i=this._sessionManager.auth,a=t.sb_syncmanager?"s".concat(t.sb_syncmanager):"",t=t.sb_uikit?"u".concat(t.sb_uikit):"",a="JS/c".concat(An.SDK_VERSION,"/").concat(a,"/").concat(t);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(An.OS_VERSION),"&sv=").concat(encodeURIComponent(An.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(i.hasSession?"&key=".concat(encodeURIComponent(i.sessionKey)):"&user_id=".concat(encodeURIComponent(s),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(a,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=1")},Ki.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new Hi(e))},Ki.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new ur(new yr({type:tr.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},Ki.prototype.connect=function(s){return void 0===s&&(s=""),re(this,void 0,void 0,function(){var t,n,r=this;return se(this,function(e){return t=this._url(s),n=new Dr,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){r._loginTimer=null,r._dispatcher.dispatch(Fi.asError(f.loginTimeout))},this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]})})},Ki.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(Fi.asError(f.connectionRenew))},Ki.prototype.disconnect=function(){this._websocketClient.disconnect()},Ki.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()},Ki),Vi=(Object.defineProperty(ji.prototype,"isConnected",{get:function(){return this._context.currentState.type===Mr.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(ji.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===Mr.CONNECTING||e.type===Mr.RECONNECTING},enumerable:!1,configurable:!0}),ji.prototype.connect=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onConnect(this._context,t)];case 1:return e.sent(),[2]}})})},ji.prototype.reconnect=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},ji.prototype.resetAndReconnect=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},ji.prototype.background=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}})})},ji.prototype.disconnect=function(t){return void 0===t&&(t=null),re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:t,autoReconnect:!0})];case 1:return e.sent(),[2]}})})},ji.prototype.logout=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}})})},ji),Bi=(e(Qi,Di=o),Qi);function Qi(e){var t=e.deviceId,e=e.statLogs,n=Di.call(this)||this;return n.method=I.POST,n.path="".concat(qs),n.params={device_id:t,log_entries:e.map(function(e){return yr.payloadify(e)})},n}function ji(e,t){var n=t.sdkState,r=t.connectionHandlers,s=t.sessionManager,i=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.disableAutoReconnect,t=void 0!==t&&t,c=this;this._context=null,this._logger=o,this._context=new Gi(e,{sdkState:n,connectionHandlers:r,sessionManager:s,websocketClient:i,dispatcher:a,logger:o}),t||i.on("close",function(){"foreground"===n.appState&&setTimeout(function(){c._logger.debug("try reconnect by websocket connection closed"),c.reconnect()},100)})}function Ki(e,t){var n=t.sdkState,r=t.connectionHandlers,s=t.sessionManager,i=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.entryState,t=void 0===t?new As:t,c=Mi.call(this)||this;return c._currentState=null,c._loginTimer=null,c._connectingAt=0,c._connectionRequestQueue=[],c._iid=e,c.sdkState=n,c.connectionHandlers=r,c._sessionManager=s,c._websocketClient=i,c._dispatcher=a,c._logger=o,c._currentState=t,c._websocketClient.on("message",function(e){var t;"LOGI"===e.code&&(c._loginTimer&&(clearTimeout(c._loginTimer),c._loginTimer=null),(t=e.as(Fi)).error?(t.error.isSessionKeyExpiredError&&c._dispatcher.dispatch(new cr),c._connectionRequestQueue.forEach(function(e){return e.reject(t.error)}),c._statLogConnection(t.error)):(t.applyTo(c._iid),c._connectionRequestQueue.forEach(function(e){return e.resolve()}),e=t.userProfile,c._enableStatLog(e.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),c._statLogConnection(null)),c._connectionRequestQueue=[])}).on("close",function(){0<c._connectionRequestQueue.length&&(c._connectionRequestQueue.forEach(function(e){return e.reject(f.networkError)}),c._connectionRequestQueue=[],c._statLogConnection(f.networkError))}),c}function zi(e){var t=ki.call(this)||this;return t.enabled=e,t}function Wi(e,t,n){var r=this;return(r=Li.call(this,e,t,n)||this).error=null,r.userProfile=new qi(e,n),r.key=n.key,r.ekey=null!=(t=n.ekey)?t:"",r.error=n.error?new f(n):null,r}function Yi(e,t){this._iid=e,this.appInfo=new Qr(t),this.user=new m(e,t),this.connectedAt=1e3*(null!=(e=t.login_ts)?e:0),this.firstConnectedAt=0,this.pingInterval=null!=(e=t.ping_interval)?e:15e3,this.pongTimeout=null!=(e=t.pong_timeout)?e:5e3,this.reconnectInterval=null!=(e=null==(e=t.reconnect)?void 0:e.interval)?e:3e3,this.reconnectMaxInterval=null!=(e=null==(e=t.reconnect)?void 0:e.max_interval)?e:6e4,this.reconnectRetryCount=null!=(e=null==(e=t.reconnect)?void 0:e.retry_cnt)?e:5,this.reconnectIntervalMultiple=null!=(e=null==(e=t.reconnect)?void 0:e.mul)?e:2,this.maxUnreadCountOnSuperGroup=null!=(e=t.max_unread_cnt_on_super_group)?e:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!=(e=t.concurrent_call_limit)?e:5,this.backOffDelay=null!=(e=t.back_off_delay)?e:100}function $i(e){var e=e.userProfile,t=Ui.call(this)||this;return t.userProfile=e,t}function Xi(e,t){var n=this;return(n=Pi.call(this,e)||this).userId=null!=(e=null!=(e=t.guest_id)?e:t.user_id)?e:"",n.nickname=null!=(e=null!=(e=t.nickname)?e:t.name)?e:"",n.plainProfileUrl=null!=(e=null!=(e=t.profile_url)?e:t.image)?e:"",n.requireAuth=null!=(e=t.require_auth_for_profile_image)&&e,n.metaData=null!=(e=t.metadata)?e:{},n.connectionStatus=Oi.NON_AVAILABLE,Hn(Oi,t.is_online)?n.connectionStatus=t.is_online:u("boolean",t.is_online)&&(n.connectionStatus=t.is_online?Oi.ONLINE:Oi.OFFLINE),n.isActive=null==(e=t.is_active)||e,n.lastSeenAt=null!=(e=t.last_seen_at)?e:null,n.preferredLanguages=t.preferred_languages?Nn([],Sn(t.preferred_languages),!1):null,n.friendDiscoveryKey=null!=(e=t.friend_discovery_key)?e:null,n.friendName=null!=(e=t.friend_name)?e:null,n}(y=Ri=Ri||{})[y.PENDING=0]="PENDING",y[y.ENABLED=1]="ENABLED",y[y.DISABLED=2]="DISABLED";Object.defineProperty(ea.prototype,"isEnabled",{get:function(){return this.enabledstate===Ri.ENABLED},enumerable:!1,configurable:!0}),ea.prototype._save=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map(function(e){return yr.payloadify(e)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},ea.prototype._flush=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:if(!this.isEnabled)return[3,7];if(this.isFlushing)return[3,7];this.isFlushing=!0,e.label=1;case 1:return e.trys.push([1,5,6,7]),0<(t=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length?(n=new Bi({deviceId:this.deviceId,statLogs:t}),[4,this.requestQueue.send(n)]):[3,4];case 2:return e.sent(),this.queue=this.queue.slice(t.length),[4,this._save()];case 3:e.sent(),e.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return e.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return[2]}})})},ea.prototype.init=function(r){return re(this,void 0,void 0,function(){var t,n=this;return se(this,function(e){switch(e.label){case 0:return this.key=r,this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.get(this.key)]:[3,4];case 1:return(t=e.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map(function(e){return new yr({type:e.stat_type,ts:e.ts,data:e.data})}),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,108e5<=Date.now()-this.lastFlushedAt&&this.queue.length>=this.minLimit?(t=Math.min(Math.floor(18e4*Math.random()),100),[4,Gr(t)]):[3,4]):[3,4];case 2:return e.sent(),[4,this._flush()];case 3:e.sent(),e.label=4;case 4:return this.dispatcher.on(function(e){var t;e instanceof ur?(t=e.statLog,n.put(t)):e instanceof Hi&&(n.enabledstate=e.enabled?Ri.ENABLED:Ri.DISABLED,n.isEnabled?n.queue.length>=n.limit&&n._flush():n.clear())}),[2]}})})},ea.prototype.put=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this.enabledstate===Ri.DISABLED?[3,3]:(this.queue.push(t),[4,this._save()]);case 1:return e.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},ea.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})};var Ji,Zi=ea;function ea(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,s=e.baseLimit,s=void 0===s?100:s,i=e.maxLimit,i=void 0===i?1e3:i,e=e.minLimit,e=void 0===e?10:e;this.queue=[],this.enabledstate=Ri.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=Un(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=s,this.limit=s,this.maxLimit=i,this.minLimit=e}(y=Ji=Ji||{})[y.NONE=0]="NONE",y[y.VERBOSE=1]="VERBOSE",y[y.DEBUG=2]="DEBUG",y[y.INFO=3]="INFO",y[y.WARN=4]="WARN",y[y.ERROR=5]="ERROR";_a.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Ji.VERBOSE&&console.log.apply(console,Nn(["[verbose]"],Sn(e),!1))},_a.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Ji.DEBUG&&console.log.apply(console,Nn(["[debug]"],Sn(e),!1))},_a.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Ji.INFO&&console.log.apply(console,Nn(["[info]"],Sn(e),!1))},_a.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Ji.WARN&&console.warn.apply(console,Nn(["[warn]"],Sn(e),!1))},_a.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=Ji.ERROR&&console.error.apply(console,Nn(["[error]"],Sn(e),!1))};var ta,na,ra,sa,ia=_a,aa={},g=(fa.of=function(e){if(aa[e])return aa[e];throw f.lostInstance},fa),y=(pa.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,s=t.sessionManager,i=t.requestQueue,a=t.logger,t=(t.onlineDetector,t.cacheContext),t=void 0===t?null:t;this._iid=e,this._cacheContext=t,this._sdkState=n,this._dispatcher=r,this._sessionManager=s,this._requestQueue=i,this._logger=a},pa),oa=(e(da,sa=o),da),ca=(e(ha,ra=_),ha),ua=(e(la,na=s),la.payloadify=function(e){return e?E(p(p({},na.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(e){return m.payloadify(e)}):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null},la);function la(e,t){var n=this;return(n=na.call(this,e)||this).replyCount=0,n.mostRepliedUsers=null,n.lastRepliedAt=0,n.updatedAt=0,n.replyCount=null!=(e=t.reply_count)?e:0,n.mostRepliedUsers=t.hasOwnProperty("most_replies")&&l("object",t.most_replies)?t.most_replies.map(function(e){return new m(n._iid,e)}):[],n.lastRepliedAt=null!=(e=t.last_replied_at)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,n}function ha(e,t){var n=this;return(n=ra.call(this,e,t)||this).url=t.url,n.fileSize=null!=(e=t.file_size)?e:0,n.thumbnailSizes=null!=(e=t.thumbnails)?e:[],n.requireAuth=null!=(e=t.require_auth)&&e,n}function da(e){var t=sa.call(this)||this;if(t.method=I.POST,t.path="".concat(Rs),t.params=E({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var n=0;n<e.thumbnailSizes.length;n++){var r=e.thumbnailSizes[n],s=r.maxWidth,r=r.maxHeight;t.params["thumbnail".concat(n+1)]="".concat(s,",").concat(r)}return t.requestId=e.requestId,t}function pa(){}function fa(e,t){var n,r,s,i;return this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,aa[e]||(aa[e]=this,n=null!=(n=t.options)?n:new Gn,r=this.sdkState={appId:t.appId,appVersion:null!=(r=t.appVersion)?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!=(r=t.apiHost)?r:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!=(r=t.websocketHost)?r:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new Is,responseTimeout:n.websocketResponseTimeout}},this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0},s=this.logger=new ia,this.logger.level=null!=(i=t.logLevel)?i:Ji.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new Ln({encryption:t.encryption,store:t.store,localCacheEnabled:null!=(i=t.localCacheEnabled)&&i}),this.debugMode=null!=(i=t.debugMode)&&i,this.maxSuperGroupChannelUnreadCount=An.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=n.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=n.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=n.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null,t=this.dispatcher=new Wn,i=new jn,this.requestQueue=new _s(e,{auth:i,sdkState:r,dispatcher:t,logger:s}),this.sessionManager=new bs({auth:i,sdkState:r,dispatcher:t,requestQueue:this.requestQueue,logger:s}),this.connectionManager=new Vi(e,{sdkState:r,connectionHandlers:this.connectionHandlers,dispatcher:t,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,logger:s}),this.statLogCollector=new Zi({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:t})),aa[e]}function _a(){this.level=Ji.WARN}(T=ta=ta||{}).ADD="add",T.DELETE="delete";function va(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=u("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,s=e.reaction,e=e.updated_at;t&&u("string",n)&&u("string",r)&&Hn(ta,r)&&u("string",s)&&s&&u("number",e)&&(this.messageId=t,this.userId=n,this.key=s,this.operation=r,this.updatedAt=e)}Object.defineProperty(Na.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),Na.payloadify=function(e){return e?E({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},Na.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case ta.ADD:t<0&&this.userIds.push(e.userId);break;case ta.DELETE:0<=t&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}};var ma,ga=Na,ya=(Sa.payloadify=function(e){return e?E({key:e.key,value:null!=(e=e.value)?e:[]}):null},Sa),Ea=(wa.payloadify=function(e){var t;return e?E({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!=(t=e.width)?t:0,height:null!=(t=e.height)?t:0,alt:e.alt}):null},wa),Ia=(Ca.payloadify=function(e){return e?E({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Ea.payloadify(e.defaultImage):null}):null},Ca),ba=(Ta.payloadify=function(e){return e?E({name:e.name,volume:e.volume}):null},Ta);function Ta(e){var t;this.name=null,this.volume=0,this.name=null!=(t=e.name)?t:"default",this.volume=null!=(t=e.volume)?t:1}function Ca(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new Ea(e["og:image"]))}function wa(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}function Sa(e){this.key=e.key,this.value=l("string",e.value)?Nn([],Sn(e.value),!1):[]}function Na(e){var t,n,r=e.key,s=null!=(s=Nn([],Sn(e.user_ids),!1))?s:[],i=e.updated_at,a=(u("string",r)&&r&&l("string",s)&&0<s.length&&u("number",i)&&(this.key=r,this.userIds=s,this.updatedAt=i),{});try{for(var o=ie(this.userIds),c=o.next();!c.done;c=o.next())a[c.value]=this.updatedAt}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._version=a}(T=ma=ma||{}).PENDING="pending",T.IN_QUEUE="in_queue",T.SENT="sent",T.FAILED="failed",T.CANCELED="canceled",T.REMOVED="removed";function Aa(e){return u("number",e.prevResultSize)&&u("number",e.nextResultSize)&&u("boolean",e.isInclusive)&&u("boolean",e.reverse)&&u("string",e.messageTypeFilter)&&Hn(Wr,e.messageTypeFilter)&&l("string",e.customTypesFilter,!0)&&l("string",e.senderUserIdsFilter,!0)&&u("boolean",e.includeMetaArray)&&u("boolean",e.includeReactions)&&u("boolean",e.includeParentMessageInfo)}e(po,Fa=s),po.payloadify=function(e){var t;return e?E(p(p({},Fa.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:function(e){switch(e){case zr.BASE:return"";case zr.USER:return"MESG";case zr.FILE:return"FILE";case zr.ADMIN:return"ADMM"}}(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null==(t=e.mentionedUsers)?void 0:t.map(function(e){return m.payloadify(e)}),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?ua.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(e){return ga.payloadify(e)}),sorted_metaarray:null==(t=e.metaArrays)?void 0:t.map(function(e){return ya.payloadify(e)}),og_tag:Ia.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:ba.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null==(t=e.scheduledInfo)?void 0:t.scheduledMessageId,scheduled_at:null==(t=e.scheduledInfo)?void 0:t.scheduledAt,scheduled_status:e._scheduledStatus})):null},po.prototype.isIdentical=function(e){return this.messageId===e.messageId},po.prototype.isEqual=function(e){return Dn(this,e)},po.prototype.isUserMessage=function(){return this.messageType===zr.USER},po.prototype.isFileMessage=function(){return this.messageType===zr.FILE},po.prototype.isAdminMessage=function(){return this.messageType===zr.ADMIN},po.prototype.serialize=function(){return Ni(this)},po.prototype.getMetaArraysByKeys=function(t){return this.metaArrays.filter(function(e){return t.includes(e.key)})},po.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},po.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new ga(ga.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},po.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1};var Oa,Ra,Da,Ma,ka,La,Ua,Pa,xa,qa,Fa,Ha=po,Ga=(e(ho,qa=m),ho.payloadify=function(e){return e?E(p(p({},qa.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null},ho),Va=(e(lo,xa=Ha),lo.payloadify=function(e){return e?E(p(p({},xa.payloadify.call(this,e)),{user:Ga.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null},Object.defineProperty(lo.prototype,"isResendable",{get:function(){return this.sendingStatus===Zr.FAILED&&0<(e=this.errorCode)&&0<=qn.indexOf(e);var e},enumerable:!1,configurable:!0}),lo.prototype.isIdentical=function(e){return 0<this.messageId&&0<e.messageId?this.messageId===e.messageId:this.reqId===e.reqId},lo),Ba=(uo.payloadify=function(e){return e?E({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(uo.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),uo),Qa={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Wr.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},ja=(e(co,Pa=Ha),co.payloadify=function(e){return e?E(p(p({},Pa.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:Wa(e.parentMessage)})):null},co.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return n=p(p({},Qa),n),v(0<this.messageId&&u("number",t)&&Aa(n)).throw(f.invalidParameters),[4,Yo.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},co),Ka=(oo.payloadify=function(e){return e?E({type:e.type,vendor:e.vendor,detail:e.detail}):null},oo),za=(e(ao,Ua=Va),ao.payloadify=function(e){return e?E(p(p({},Ua.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(e){return Ka.payloadify(e)}),parent_message_info:Wa(e.parentMessage)})):null},ao.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return n=p(p({},Qa),n),v(0<this.messageId&&u("number",t)&&Aa(n)).throw(f.invalidParameters),[4,Yo.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},ao),Wa=function(e){if(e)switch(e.messageType){case zr.USER:return za.payloadify(e);case zr.FILE:return $a.payloadify(e);case zr.ADMIN:return ja.payloadify(e)}return null},Ya=function(e,t){switch(t.type){case"MESG":return new za(e,t);case"FILE":return new $a(e,t);case"ADMM":case"BRDM":return new ja(e,t)}return null},$a=(e(io,La=Va),io.payloadify=function(e){return e?E(p(p({},La.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map(function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:Wa(e.parentMessage)})):null},Object.defineProperty(io.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(Br(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),io.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return n=p(p({},Qa),n),v(0<this.messageId&&u("number",t)&&Aa(n)).throw(f.invalidParameters),[4,Yo.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},io),Xa=(e(so,ka=br),so),Ja=(e(ro,Ma=o),ro),Za=(e(no,Da=Ir),no),eo=(e(to,Ra=_),to);function to(e,t){var n,r=this,e=((r=Ra.call(this,e,t)||this).message=new $a(e,t),g.of(e).sdkState);return r.isMentioned=di(r.message.mentionType,null!=(n=r.message.mentionedUserIds)?n:r.message.mentionedUsers.map(function(e){return e.userId}),e.userId),r.forceUpdateLastMessage=null!=(n=t.force_update_last_message)&&n,r}function no(e,t,n){var r,s=this,e=((s=Da.call(this,e,"FILE",n)||this).message=new $a(e,n),g.of(e).sdkState);return s.isMentioned=di(s.message.mentionType,null!=(r=s.message.mentionedUserIds)?r:null==(r=s.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),s.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,s}function ro(e){var t=this,t=Ma.call(this)||this,n=[];return e.mentionType===$r.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),t.method=I.POST,t.path="".concat(b(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),t.params=E({message_type:zr.FILE,user_id:e.userId,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:n,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes.map(function(e){return Ba.payloadify(e)}),require_auth:e.requireAuth,sorted_metaarray:null==(n=e.metaArrays)?void 0:n.map(function(e){return ya.payloadify(e)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:ba.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,req_id:e.reqId}),t}function so(e){var t,n=[];return e.mentionType===$r.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),ka.call(this,{code:"FILE",ackRequired:!0,payload:E({channel_url:e.channelUrl,url:e.url,name:null!=(t=e.fileName)?t:"",type:null!=(t=e.mimeType)?t:"",size:null!=(t=e.fileSize)?t:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==Jr.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function io(e,t){var n,r=this,s=((r=La.call(this,e,t)||this).messageParams=null,r.plainUrl="",r.requireAuth=!1,r.name=null,r.size=0,r.type=null,r.thumbnails=[],r.messageSurvivalSeconds=-1,r.messageType=zr.FILE,null!=(s=t.file)?s:null);return r.plainUrl=(null!=(n=null!=(n=null==s?void 0:s.url)?n:t.url)?n:"").split("?auth=")[0],r.name=null!=(n=null!=(n=null==s?void 0:s.name)?n:t.name)?n:"File",r.size=null!=(n=null!=(n=null==s?void 0:s.size)?n:t.size)?n:0,r.data=null!=(n=null!=(n=null==s?void 0:s.data)?n:t.custom)?n:"",r.type=s?null!=(n=s.type)?n:"":null!=(s=t.type)?s:"",r.requireAuth=null!=(n=t.require_auth)&&n,r.thumbnails=t.thumbnails?t.thumbnails.map(function(e){return new Ba(p(p({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(r.requireAuth?"?auth=".concat(Br(r._iid)):"")}))}):[],r.messageSurvivalSeconds=null!=(s=t.message_survival_seconds)?s:-1,t.parent_message_info&&(n=t.parent_message_info,s=p(p({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(s=n.file)?void 0:s.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=Ya(e,s)),r}function ao(e,t){var n,r,s,i=this;if((i=Ua.call(this,e,t)||this).message="",i.messageParams=null,i.translations={},i.translationTargetLanguages=[],i.messageSurvivalSeconds=-1,i.plugins=[],i.message=t.message,i.messageType=zr.USER,i.translations=null!=(r=t.translations)?r:{},i.translationTargetLanguages=null!=(r=t.target_langs)?r:[],i.translations==={}&&0<i.translationTargetLanguages.length)try{for(var a=ie(i.translationTargetLanguages),o=a.next();!o.done;o=a.next()){var c=o.value;i.translations[c]=""}}catch(e){n={error:e}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return i.messageSurvivalSeconds=null!=(r=t.message_survival_seconds)?r:-1,i.plugins=t.plugins?t.plugins.map(function(e){return new Ka(e)}):[],t.parent_message_info&&(s=t.parent_message_info,t=p(p({},s),{created_at:s.ts,message_id:i.parentMessageId,channel_url:i.channelUrl,channel_type:i.channelType,file:s.file,url:null==(n=s.file)?void 0:n.url,require_auth:null==(r=s.file)?void 0:r.require_auth}),i.parentMessage=Ya(e,E(t))),i}function oo(e){var t;this.type=null,this.vendor=null,this.detail={},this.type=null!=(t=e.type)?t:"",this.vendor=null!=(t=e.vendor)?t:"",e.hasOwnProperty("detail")&&u("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}function co(e,t){var n,r=this;return(r=Pa.call(this,e,t)||this).message=null,r.translations={},r.message=null!=(n=t.message)?n:"",r.messageType=zr.ADMIN,r.translations=null!=(n=t.translations)?n:{},t.parent_message_info&&(n=t.parent_message_info,n=p(p({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(t=n.file)?void 0:t.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=Ya(e,n)),r}function uo(e){var t;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!=(t=e.real_width)?t:e.width,this.realHeight=null!=(t=e.real_height)?t:e.height}function lo(e,t){var n=this;if((n=xa.call(this,e,t)||this).sender=null,n.reqId="",n.replyToChannel=!1,n.sendingStatus=null,n.errorCode=0,n.sender=t.user?new Ga(n._iid,t.user):t.sender_id,n.reqId=null!=(e=null!=(e=t.req_id)?e:t.request_id)?e:"",n.replyToChannel=null!=(e=t.is_reply_to_channel)&&e,t.request_state&&Hn(Zr,t.request_state)&&(n.sendingStatus=t.request_state),!n.sendingStatus)if(0<n.messageId)n.sendingStatus=Zr.SUCCEEDED;else if(n.scheduledInfo)switch(n._scheduledStatus=t.scheduled_status,t.scheduled_status){case ma.SENT:case ma.IN_QUEUE:n.sendingStatus=Zr.SUCCEEDED;break;case ma.PENDING:n.sendingStatus=Zr.SCHEDULED;break;case ma.FAILED:case ma.REMOVED:n.sendingStatus=Zr.FAILED;break;case ma.CANCELED:n.sendingStatus=Zr.CANCELED}else n.sendingStatus=Zr.PENDING;return n.errorCode=null!=(e=t.error_code)?e:0,n}function ho(e,t){e=qa.call(this,e,t)||this;return e.role=null,e.isBlockedByMe=!1,e.role=Hn(Kr,t.role)?t.role:Kr.NONE,t.hasOwnProperty("is_blocked_by_me")&&(e.isBlockedByMe=t.is_blocked_by_me),e}function po(e,t){var n=this,e=((n=Fa.call(this,e)||this).channelUrl=null,n.channelType=jr.BASE,n.messageId=0,n.parentMessageId=null,n.parentMessage=null,n.silent=!1,n.isOperatorMessage=!1,n.messageType=zr.BASE,n.data=null,n.customType=null,n.mentionType=null,n.mentionedUsers=[],n.mentionedUserIds=[],n.mentionedMessageTemplate=null,n.threadInfo=null,n.reactions=[],n.metaArrays=[],n.ogMetaData=null,n.appleCriticalAlertOptions=null,n.createdAt=0,n.updatedAt=0,n.scheduledInfo=null,n._scheduledStatus=null,n.messageId=null!=(e=null!=(e=t.msg_id)?e:t.message_id)?e:0,n.channelUrl=t.channel_url,n.channelType=Hn(jr,t.channel_type)?t.channel_type:jr.GROUP,t.channel&&(t.channel.channel_url&&(n.channelUrl=t.channel.channel_url),t.channel.channel_type&&(n.channelType=t.channel.channel_type)),n.parentMessageId=null!=(e="string"==typeof t.parent_message_id?parseInt(t.parent_message_id):t.parent_message_id)?e:0,n.data=null!=(e=t.data)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.mentionType=Hn($r,t.mention_type)?t.mention_type:null,t.mentioned_users),e=(n.mentionedUsers=e?e.map(function(e){return new m(n._iid,e)}):null,t.mentioned_user_ids);n.mentionedUserIds=null!=e?e:null,n.mentionedMessageTemplate=null!=(e=t.mentioned_message_template)?e:"",n.threadInfo=t.thread_info?new ua(n._iid,t.thread_info):null,n.reactions=t.reactions?t.reactions.map(function(e){return new ga(e)}):[];for(var r=null!=(e=t.metaarray)?e:{},s=null!=(e=t.metaarray_key_order)?e:Object.keys(r).sort(function(e,t){return e.localeCompare(t)}),i=0;i<s.length;i++){var a=s[i];n.metaArrays.push(new ya({key:a,value:r[a]||[]}))}return t.sorted_metaarray&&(n.metaArrays=t.sorted_metaarray.map(function(e){return new ya(e)})),n.ogMetaData=t.og_tag?new Ia(t.og_tag):null,n.silent=null!=(e=t.silent)&&e,n.isOperatorMessage=null!=(e=t.is_op_msg)&&e,n.appleCriticalAlertOptions=t.apple_critical_alert_options?new ba(t.apple_critical_alert_options):null,n.createdAt=null!=(e=null!=(e=t.created_at)?e:t.ts)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,"number"==typeof t.scheduled_message_id&&"number"==typeof t.scheduled_at&&t.scheduled_status&&(n.scheduledInfo={scheduledMessageId:t.scheduled_message_id,scheduledAt:t.scheduled_at},n._scheduledStatus=t.scheduled_status),n}(T=Oa=Oa||{})[T.PENDING=0]="PENDING",T[T.UPLOADING=1]="UPLOADING",T[T.UPLOADED=2]="UPLOADED",T[T.SENDING=3]="SENDING",T[T.FAILED=4]="FAILED";function fo(e){return Hn(Xr,e.replyType)&&u("boolean",e.includeReactions)&&u("boolean",e.includeMetaArray)&&u("boolean",e.includeParentMessageInfo)&&u("boolean",e.includeThreadInfo)&&u("boolean",e.includePollDetails)}Object.defineProperty(yo.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===Mr.CONNECTED||this._connectionState===Mr.CONNECTING||this._connectionState===Mr.RECONNECTING},enumerable:!1,configurable:!0}),yo.prototype._sendFileMessage=function(n,r){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this._shouldSendThroughWebSocket?(t=new Xa(p(p({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)]):[3,2];case 1:return[2,e.sent().as(Za).message];case 2:return t=new Ja(p(p({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,userId:this._sdkState.userId,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)];case 3:return[2,e.sent().as(eo).message]}})})},yo.prototype._resolveMessageQueue=function(h){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c,u,l;return se(this,function(e){switch(e.label){case 0:if(!(t=this._queueMap.get(h.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,e.label=1;case 1:e.trys.push([1,15,16,17]),s=ie(t.messageQueue),i=s.next(),e.label=2;case 2:if(i.done)return[3,14];switch((a=i.value).state){case Oa.PENDING:case Oa.UPLOADING:return[3,3];case Oa.UPLOADED:return[3,4];case Oa.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(a),[3,13];case 4:if(!r)return[3,10];e.label=5;case 5:return e.trys.push([5,8,,9]),a.state=Oa.SENDING,[4,this._sendFileMessage(h,a)];case 6:return o=e.sent(),a.deferred.resolve(o),[4,Gr(100)];case 7:return e.sent(),[3,9];case 8:return o=e.sent(),a.deferred.reject(o),[3,9];case 9:return[3,11];case 10:n.push(a),e.label=11;case 11:return[3,13];case 12:return a.deferred.reject(a.error.code===d.REQUEST_CANCELED?f.fileUploadCanceled:a.error),[3,13];case 13:return i=s.next(),[3,2];case 14:return[3,17];case 15:return u=e.sent(),u={error:u},[3,17];case 16:try{i&&!i.done&&(l=s.return)&&l.call(s)}finally{if(u)throw u.error}return[7];case 17:return c=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,c?[4,this._resolveMessageQueue(h)]:[3,19];case 18:e.sent(),e.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,e.label=21;case 21:return[2]}})})},yo.prototype._uploadNextPendingItem=function(u){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c;return se(this,function(e){switch(e.label){case 0:return t=this._queueMap.get(u.url),(n=t.messageQueue.find(function(e){return e.state===Oa.PENDING}))?kn(n.params.file)?t.uploadQueue.length<6?(n.state=Oa.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!e.sent())return[3,8];e.label=2;case 2:return e.trys.push([2,4,5,7]),r=new oa({file:n.params.file,channelUrl:u.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return r=e.sent(),a=r.as(ca),o=a.url,s=a.fileSize,s=void 0===s?n.params.fileSize:s,i=a.thumbnailSizes,i=void 0===i?n.params.thumbnailSizes:i,a=a.requireAuth,a=void 0!==a&&a,n.params.fileUrl=o,n.params.fileSize=s,n.params.thumbnailSizes=i,n.params.requireAuth=a,n.requireAuth=a,n.state=Oa.UPLOADED,[3,7];case 4:return o=e.sent(),n.state=Oa.FAILED,n.error=o,[3,7];case 5:return 0<=(c=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(c,1),this._uploadNextPendingItem(u)),[4,this._resolveMessageQueue(u)];case 6:return e.sent(),[7];case 7:return[3,10];case 8:return n.state=Oa.FAILED,n.error=f.connectionRequired,0<=(c=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(c,1),this._uploadNextPendingItem(u)),[4,this._resolveMessageQueue(u)];case 9:e.sent(),e.label=10;case 10:return[3,13];case 11:return n.params.thumbnailSizes=[],n.state=Oa.UPLOADED,[4,this._resolveMessageQueue(u)];case 12:e.sent(),e.label=13;case 13:return[2]}})})},yo.prototype.request=function(n,r,s){var i;return re(this,void 0,void 0,function(){var t;return se(this,function(e){return t=new Dr,kn(s.file)&&(s.fileName=null!=(i=s.fileName)?i:s.file.name,s.mimeType=null!=(i=s.mimeType)?i:s.file.type,s.fileSize=null!=(i=s.fileSize)?i:s.file.size),this._queueMap.has(n.url)||this._queueMap.set(n.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(n.url).messageQueue.push({requestId:r,params:s,state:Oa.PENDING,deferred:t,requireAuth:s.requireAuth}),this._uploadNextPendingItem(n),[2,t.promise]})})},yo.prototype.cancel=function(e,t){void 0===t&&(t=null);var n,r,s=this._queueMap.get(e.url);if(s){s=t?[s.messageQueue.find(function(e){return e.requestId===t})]:Nn([],Sn(s.messageQueue),!1);try{for(var i=ie(s),a=i.next();!a.done;a=i.next()){var o=a.value;if(o)switch(o.state){case Oa.PENDING:o.state=Oa.FAILED,o.error=f.requestCanceled,this._resolveMessageQueue(e);break;case Oa.UPLOADING:this._requestQueue.cancel(o.requestId)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}};var _o,vo=yo,mo={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Wr.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:Xr.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},go={replyType:Xr.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includePollDetails:!1};function yo(e,t){var n=t.sdkState,r=t.dispatcher,s=t.requestQueue,i=t.onlineDetector,t=t.cacheContext,a=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=s,this._cacheContext=t,this._dispatcher=r,this._dispatcher.on(function(e){e instanceof fs&&(a._connectionState=e.stateType)}),this._onlineDetector=i}(T=_o=_o||{}).UNKNOWN="UNKNOWN",T.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",T.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",T.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",T.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",T.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",T.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",T.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",T.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",T.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",T.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",T.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",T.REQUEST_MESSAGE="REQUEST_MESSAGE",T.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",T.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",T.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",T.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",T.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",T.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",T.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",T.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",T.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",T.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";e(No,bo=Pn);var Eo,Io,bo,To,Co=No,wo=(e(So,Io=Pn),So);function So(e){var t=e.messageIds,e=e.source,n=Io.call(this)||this;return n.messageIds=t,n.source=e,n}function No(e){var t=e.messages,e=e.source,n=bo.call(this)||this;return n.messages=t,n.source=e,n}function Ao(e){var t=e.reqId,e=e.source,n=To.call(this)||this;return n.reqId=t,n.source=e,n}e(Ao,To=Pn);e(fc,Fo=o);var Oo,Ro,Do,Mo,ko,Lo,Uo,Po,xo,qo,Fo,Ho=fc,Go=(e(pc,qo=_),pc),Vo=(e(dc,xo=o),dc),Bo=(e(hc,Po=_),hc),Qo=(e(lc,Uo=o),lc),jo=(e(uc,Lo=_),uc),Ko=(e(cc,ko=o),cc),zo=(e(oc,Mo=_),oc),Wo={},Yo=(ac.of=function(e){return Wo[e]},ac.prototype.buildMessageFromSerializedData=function(e){var t=Ai(e);switch(t.messageType){case zr.USER:return new za(this._iid,za.payloadify(t));case zr.FILE:return new $a(this._iid,$a.payloadify(t));case zr.ADMIN:return new ja(this._iid,ja.payloadify(t))}return null},ac.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return E({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations)})},ac.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return E({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),fileType:e.fileType,requireAuth:t.requireAuth})},ac.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return p(p({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},ac.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return p(p({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},ac.prototype.buildSenderFromSerializedData=function(e){e=Ai(e);return new Ga(this._iid,Ga.payloadify(e))},ac.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return t=new Ho(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(Go).message]}})})},ac.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return t=new Ko(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(zo).message]}})})},ac.prototype.getMessagesByTimestamp=function(r,s,i,a,o){return void 0===o&&(o=_o.REQUEST_MESSAGE),re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=new Vo(p(p({channelType:s,channelUrl:r,timestamp:i},mo),a)),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(Bo).messages,this._dispatcher.dispatch(new Co({messages:n,source:o})),[2,n]}})})},ac.prototype.getThreadedMessagesByTimestamp=function(s,i,a,o){return void 0===o&&(o=_o.REQUEST_THREADED_MESSAGE),re(this,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return t=new Vo(p(p(p({channelUrl:s.channelUrl,channelType:s.channelType,timestamp:i},Qa),a),{replyType:Xr.ALL,parentMessageId:s.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(Bo).messages,(r=n.slice(1)).forEach(function(e){e.parentMessage=s}),this._dispatcher.dispatch(new Co({messages:r,source:o})),[2,{parentMessage:n[0],threadedMessages:r}]}})})},ac.prototype.getMessageChangelogs=function(a,o,c,u,l){return void 0===l&&(l=_o.REQUEST_MESSAGE_CHANGELOGS),re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:return t=new Qo(E(p(p({channelType:o,channelUrl:a,timestamp:"number"==typeof c?c:null,token:"string"==typeof c?c:null},go),u))),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),s=t.as(jo),n=s.updatedMessages,i=s.deletedMessagesInfo,r=s.hasMore,s=s.nextToken,i=i.map(function(e){return e.messageId}),0<n.length&&this._dispatcher.dispatch(new Co({messages:n,source:l})),0<i.length&&this._dispatcher.dispatch(new wo({messageIds:i,source:l})),[2,{updatedMessages:n,deletedMessageIds:i,hasMore:r,token:s}]}})})},ac),$o=(ic.prototype._trigger=function(e,t){switch(t.sendingStatus){case Zr.PENDING:this._onPending(t);break;case Zr.FAILED:case Zr.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);break;case Zr.SCHEDULED:case Zr.SUCCEEDED:this._onSucceeded(t)}},ic.prototype.onPending=function(e){return this._onPending=e,this},ic.prototype.onFailed=function(e){return this._onFailed=e,this},ic.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},ic),Xo=(e(sc,Do=s),sc),Jo={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,includePollDetails:!1},T=(Object.defineProperty(rc.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(rc.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),rc.prototype._validate=function(){return u("number",this.limit)&&0<this.limit},rc),Zo=(e(nc,Ro=o),nc),ec=(e(tc,Oo=_),tc);function tc(t,e){var n=Oo.call(this,t,e)||this;return n.messages=e.results.map(function(e){return Ya(t,e)}),n.hasNext=e.has_next,n.nextToken=e.end_cursor,n}function nc(e){var t=e.channelCustomType,n=e.keyword,r=e.limit,s=e.reverse,i=e.exactMatch,a=e.channelUrl,o=e.order,c=e.messageTimestampFrom,u=e.messageTimestampTo,l=e.advancedQuery,h=e.targetFields,e=e.nextToken,d=Ro.call(this)||this;return d.method=I.GET,d.path="".concat(Ls,"/messages"),d.params={custom_type:t,query:n,limit:r,reverse:s,exact_match:i,channel_url:a,message_ts_from:c,message_ts_to:u,sort_field:o,advanced_query:l,target_fields:h,after:e},d}function rc(e,t){this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!=(e=t.limit)?e:20}function sc(e,t){var n=Do.call(this,e)||this,r=(n.threadInfo=null,n.targetMessageId=0,n.channelUrl=null,n.channelType=null,t.thread_info),s=t.root_message_id,i=t.channel_url,t=t.channel_type;return r&&u("object",r)&&u("number",s)&&u("string",i)&&u("string",t)&&(n.threadInfo=new ua(e,r),n.targetMessageId=s,n.channelUrl=i,n.channelType=t),n}function ic(){this._onPending=t,this._onFailed=t,this._onSucceeded=t}function ac(e,t){var n=t.sdkState,r=t.dispatcher,s=t.requestQueue,i=t.onlineDetector,t=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=s,this._dispatcher=r,this._onlineDetector=i,this._cacheContext=t,this.fileMessageQueue=new vo(e,{sdkState:n,dispatcher:r,requestQueue:s,onlineDetector:i,cacheContext:t}),Wo[e]=this}function oc(e,t){var n=Mo.call(this,e,t)||this;return n.message=t?Ya(e,p({},t)):null,n}function cc(e){var t=e.channelUrl,e=e.scheduledMessageId,n=ko.call(this)||this;return n.method=I.GET,n.path="".concat(Ds,"/").concat(encodeURIComponent(t),"/scheduled_messages/").concat(encodeURIComponent(e)),n.params={},n}function uc(t,e){var n=Lo.call(this,t,e)||this;return n.updatedMessages=e.updated.map(function(e){return Ya(t,e)}),n.deletedMessagesInfo=e.deleted.map(function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}}),n.hasMore=e.has_more,n.nextToken=e.next,n}function lc(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,s=e.token,i=e.replyType,a=e.includeMetaArray,o=e.includeReactions,c=e.includeThreadInfo,u=e.includeParentMessageInfo,e=e.includePollDetails,l=Uo.call(this)||this;return l.method=I.GET,l.path="".concat(b(t),"/").concat(encodeURIComponent(n),"/messages/changelogs"),l.params={change_ts:r,token:s,with_sorted_meta_array:a,include_reactions:o,include_thread_info:c,include_reply_type:i,include_parent_message_info:u,include_poll_details:e},l}function hc(t,e){var n=Po.call(this,t,e)||this;return n.messages=e.messages.map(function(e){return Ya(t,e)}),n}function dc(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,r=void 0===r?null:r,s=e.token,s=void 0===s?null:s,i=e.prevResultSize,a=e.nextResultSize,o=e.isInclusive,c=e.reverse,u=e.messageTypeFilter,l=e.customTypesFilter,h=e.senderUserIdsFilter,d=e.replyType,p=e.includeMetaArray,f=e.includeReactions,_=e.parentMessageId,v=e.includeThreadInfo,m=e.includeParentMessageInfo,g=e.showSubchannelMessagesOnly,e=e.includePollDetails,y=xo.call(this)||this;return y.method=I.GET,y.path="".concat(b(t),"/").concat(encodeURIComponent(n),"/messages"),y.params=E({is_sdk:!0,prev_limit:i,next_limit:a,include:o,reverse:c,message_ts:r,message_id:s,message_type:null!=u?u:null,custom_types:l,sender_ids:h,include_reply_type:d,with_sorted_meta_array:p,include_reactions:f,parent_message_id:_,include_thread_info:v,include_parent_message_info:m,show_subchannel_message_only:g,include_poll_details:e}),y}function pc(e,t){var n=qo.call(this,e,t)||this;return n.message=t?Ya(e,p({},t)):null,n}function fc(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,s=e.includeMetaArray,i=e.includeReactions,a=e.includeThreadInfo,o=e.includeParentMessageInfo,e=e.includePollDetails,c=Fo.call(this)||this;return c.method=I.GET,c.path="".concat(b(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r)),c.params={is_sdk:!0,with_sorted_meta_array:s,include_reactions:i,include_thread_info:a,include_parent_message_info:o,include_poll_details:e},c}(Ec=Eo=Eo||{}).SCORE="score",Ec.TIMESTAMP="ts";e(Nc,gc=T),Nc.prototype._validate=function(){return gc.prototype._validate.call(this)&&u("string",this.keyword)&&0<this.keyword.length&&u("boolean",this.reverse)&&u("boolean",this.exactMatch)&&u("string",this.channelUrl)&&u("string",this.channelCustomType)&&(u("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(u("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&Hn(Eo,this.order)&&u("boolean",this.advancedQuery)&&l("string",this.targetFields,!0)},Nc.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=g.of(this._iid).requestQueue,n=new Zo(p(p({},this),{nextToken:this._nextToken||null})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(ec),r=n.messages,s=n.hasNext,i=n.nextToken,this._nextToken=i,this._hasNext=s,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})};var _c,vc,mc,gc,yc=Nc,Ec=(e(Sc,mc=T),Sc.prototype._validate=function(){return mc.prototype._validate.call(this)&&u("string",this.channelUrl)&&Hn(jr,this.channelType)},Sc),Ic=(e(wc,vc=Ec),wc.prototype._validate=function(){return vc.prototype._validate.call(this)&&u("boolean",this.reverse)&&Hn(Wr,this.messageTypeFilter)&&Hn(Xr,this.replyType)&&l("string",this.customTypesFilter,!0)&&l("string",this.senderUserIdsFilter,!0)&&u("boolean",this.includeMetaArray)&&u("boolean",this.includeReactions)&&u("boolean",this.includeParentMessageInfo)&&u("boolean",this.includeThreadInfo)&&u("boolean",this.showSubchannelMessagesOnly)},wc.prototype.load=function(){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Yo.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return t=e.sent(),this._edge=Math.min.apply(Math,Nn([Number.MAX_SAFE_INTEGER],Sn(t.map(function(e){return e.createdAt})),!1)),this._hasNext=t.length>=this.limit,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})},wc),bc={channelUrl:null,scheduledMessageId:0},Tc=(e(Cc,_c=y),Cc.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,s=t.sessionManager,i=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;_c.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:s,requestQueue:i,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new Yo(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:o,cacheContext:t})},Cc.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},Cc.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},Cc.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){return se(this,function(e){return n=p(p({},Jo),n),v(u("string",(t=n).channelUrl)&&u("string",t.channelType)&&Hn(jr,t.channelType)&&u("number",t.messageId)&&u("boolean",t.includeMetaArray)&&u("boolean",t.includeParentMessageInfo)&&u("boolean",t.includeThreadInfo)&&u("boolean",t.includePollDetails)).throw(f.invalidParameters),[2,this._manager.getMessage(n)];var t})})},Cc.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){return se(this,function(e){return n=p(p({},bc),n),v(u("string",(t=n).channelUrl)&&u("number",t.scheduledMessageId)).throw(f.invalidParameters),[2,this._manager.getScheduledMessage(n)];var t})})},Cc);function Cc(){var e=null!==_c&&_c.apply(this,arguments)||this;return e.name="message",e}function wc(e,t,n,r){var s=this;return(s=vc.call(this,e,t,n,r)||this).reverse=!1,s.messageTypeFilter=Wr.ALL,s.customTypesFilter=null,s.senderUserIdsFilter=null,s.replyType=Xr.NONE,s.includeMetaArray=!1,s.includeReactions=!1,s.includeParentMessageInfo=!1,s.includeThreadInfo=!1,s.showSubchannelMessagesOnly=!1,s._edge=Number.MAX_SAFE_INTEGER,s.reverse=null!=(e=r.reverse)&&e,s.messageTypeFilter=null!=(t=r.messageTypeFilter)?t:Wr.ALL,s.customTypesFilter=null!=(n=r.customTypesFilter)?n:null,s.senderUserIdsFilter=null!=(e=r.senderUserIdsFilter)?e:null,s.replyType=null!=(t=r.replyType)?t:Xr.NONE,s.includeMetaArray=null!=(n=r.includeMetaArray)&&n,s.includeReactions=null!=(e=r.includeReactions)&&e,s.includeParentMessageInfo=null!=(t=r.includeParentMessageInfo)&&t,s.includeThreadInfo=null!=(n=r.includeThreadInfo)&&n,s.showSubchannelMessagesOnly=null!=(e=r.showSubchannelMessagesOnly)&&e,s}function Sc(e,t,n,r){e=mc.call(this,e,r)||this;return e.channelUrl=t,e.channelType=n,e}function Nc(e,t){var n=this;return(n=gc.call(this,e,t)||this).keyword="",n.reverse=!1,n.exactMatch=!1,n.channelUrl="",n.channelCustomType="",n.messageTimestampFrom=null,n.messageTimestampTo=null,n.order=Eo.SCORE,n.advancedQuery=!1,n.targetFields=null,n._nextToken="",n.keyword=t.keyword,n.reverse=null!=(e=t.reverse)&&e,n.exactMatch=null!=(e=t.exactMatch)&&e,n.channelUrl=null!=(e=t.channelUrl)?e:"",n.channelCustomType=null!=(e=t.channelCustomType)?e:"",n.messageTimestampFrom=null!=(e=t.messageTimestampFrom)?e:null,n.messageTimestampTo=null!=(e=t.messageTimestampTo)?e:null,n.order=null!=(e=t.order)?e:Eo.SCORE,n.advancedQuery=null!=(e=t.advancedQuery)&&e,n.targetFields=null!=(e=t.targetFields)?e:null,n}function Ac(e){return u("string",e.data,!0)&&u("string",e.customType,!0)&&Hn($r,e.mentionType)&&l("string",e.mentionedUserIds,!0)&&l(m,e.mentionedUsers,!0)&&u("string",e.mentionedMessageTemplate,!0)&&l(ya,e.metaArrays,!0)&&u("number",e.parentMessageId,!0)&&u("boolean",e.isReplyToChannel)&&Hn(Jr,e.pushNotificationDeliveryOption,!0)&&u(ba,e.appleCriticalAlertOptions,!0)}function Oc(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}var Rc,C={data:null,customType:null,mentionType:$r.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},Dc=p(p({},C),{message:null,translationTargetLanguages:null});(w=Rc=Rc||{}).FILE="file",w.BLOB="blob",w.BLOB_LIKE_OBJECT="blobLikeObject",w.URL="url";function Mc(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob}function kc(e){return e===Rc.BLOB||e===Rc.FILE}function Lc(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}function Uc(e){return Ac(e)&&(kn(e.file)||u("string",e.fileUrl))&&u("string",e.fileName,!0)&&u("string",e.mimeType,!0)&&u("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every(function(e){return u("object",e)&&0<e.maxWidth&&0<e.maxHeight}))}var Pc,xc=p(p({},C),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1});(w=Pc=Pc||{}).MUTED="muted",w.BANNED="banned";function qc(e){return u("string",e.data,!0)&&u("string",e.customType,!0)&&Hn($r,e.mentionType)&&l("string",e.mentionedUserIds,!0)&&l(m,e.mentionedUsers,!0)&&u("string",e.mentionedMessageTemplate,!0)&&l(ya,e.metaArrays,!0)&&Hn(Jr,e.pushNotificationDeliveryOption,!0)&&u(ba,e.appleCriticalAlertOptions,!0)}yu.payloadify=function(e){return e?E({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null};var Fc,Hc,Gc,Vc,Bc,Qc,jc,Kc,zc,Wc,Yc,$c=yu,Xc=(e(gu,Yc=m),gu.payloadify=function(e){return e?E(p(p({},Yc.payloadify.call(this,e)),$c.payloadify(e.restrictionInfo))):null},gu),w={data:null,customType:null,mentionType:$r.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},Jc=p(p({},w),{message:null,translationTargetLanguages:null}),Zc=p({},w),eu=(e(mu,Wc=o),mu),tu=(e(vu,zc=_),vu),nu=(e(_u,Kc=Ec),_u.prototype._validate=function(){return Kc.prototype._validate.call(this)},_u.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:(t=[],this._hasNext?(this._isLoading=!0,n=g.of(this._iid).requestQueue,r=new eu(p(p({},this),{channelUrl:this.channelUrl,token:this._token})),[4,n.send(r)]):[3,2]):[3,5];case 1:return n=e.sent(),r=n.as(tu),s=r.operators,i=r.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,s];case 2:return[2,t];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})},_u),ru=(e(fu,jc=o),fu),su=(e(pu,Qc=_),pu),iu=(e(du,Bc=Ec),du.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=g.of(this._iid).requestQueue,n=new ru(p(p({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(su),r=n.mutedUsers,s=n.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})},du),au=(e(hu,Vc=o),hu),ou=(e(lu,Gc=_),lu),cu=(e(uu,Hc=Ec),uu.prototype._validate=function(){return Hc.prototype._validate.call(this)},uu.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=g.of(this._iid).requestQueue,n=new au(p(p({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(ou),r=n.bannedUsers,s=n.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})},uu);function uu(e,t,n,r){return Hc.call(this,e,t,n,r)||this}function lu(t,e){var n=Gc.call(this,t,e)||this,r=(n.token=null,n.bannedUsers=[],e.next),e=e.banned_list;return n.token=r,e&&0<e.length&&(n.bannedUsers=e.map(function(e){return new Xc(t,e.user)})),n}function hu(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.limit,e=e.token;return(t=Vc.call(this)||this).method=I.GET,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=E({limit:s,token:e}),t}function du(e,t,n,r){return Bc.call(this,e,t,n,r)||this}function pu(t,e){var n=Qc.call(this,t,e)||this,r=(n.token=null,n.mutedUsers=[],e.next),e=e.muted_list;return n.token=r,e&&0<e.length&&(n.mutedUsers=e.map(function(e){return new Xc(t,e)})),n}function fu(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.limit,e=e.token;return(t=jc.call(this)||this).method=I.GET,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={limit:s,token:e},t}function _u(e,t,n,r){return Kc.call(this,e,t,n,r)||this}function vu(t,e){var n=zc.call(this,t,e)||this;return n.operators=e.operators.map(function(e){return new m(t,e)}),n.token=e.next,n}function mu(e){var t=e.channelUrl,n=e.channelType,r=e.token,e=e.limit,s=Wc.call(this)||this;return s.method=I.GET,s.path="".concat(b(n),"/").concat(encodeURIComponent(t),"/operators"),s.params={token:r,limit:e},s}function gu(e,t){e=Yc.call(this,e,t)||this;return e.restrictionInfo=null,e.restrictionInfo=new $c(t),e}function yu(e){var t;this.restrictionType=null,this.description=null,this.endAt=-1,Hn(Pc,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!=(t=e.description)?t:null,this.endAt=null!=(t=null!=(t=e.end_at)?t:e.muted_end_at)?t:-1}(w=Fc=Fc||{}).SPAM="spam",w.HARASSING="harassing",w.SUSPICIOUS="suspicious",w.INAPPROPRIATE="inappropriate";e(Tu,Eu=o);var Eu,Iu,bu=Tu;function Tu(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=Eu.call(this)||this).method=I.POST,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}e(function(){return null!==Iu&&Iu.apply(this,arguments)||this},Iu=_);e(Nu,Cu=o);var Cu,wu,Su=Nu;function Nu(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=Cu.call(this)||this).method=I.DELETE,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}e(function(e,t){return wu.call(this,e,t)||this},wu=_);e(Dl,Ku=o);var Au,Ou,Ru,Du,Mu,ku,Lu,Uu,Pu,xu,qu,Fu,Hu,Gu,Vu,Bu,Qu,ju,Ku,zu,Wu=Dl,Yu=(e(Rl,ju=_),Rl),$u=(e(Ol,Qu=o),Ol),Xu=(e(Al,Bu=_),Al),Ju=(e(Nl,Vu=o),Nl),Zu=(e(Sl,Gu=_),Sl),el=(e(wl,Hu=Ir),wl),tl=(e(Cl,Fu=o),Cl),nl=(e(Tl,qu=_),Tl),rl=(e(bl,xu=o),bl),sl=(e(Il,Pu=_),Il),il=(e(El,Uu=o),El),al=(e(yl,Lu=_),yl),ol=(e(gl,ku=o),gl),cl=(e(ml,Mu=_),ml),ul=(e(vl,Du=o),vl),ll=(e(_l,Ru=_),_l),hl=(e(fl,Ou=Ir),fl),dl=(e(pl,Au=o),pl);function pl(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=Au.call(this)||this).method=I.DELETE,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/metacounter/").concat(e),t.params=null,t}function fl(e,t,n){e=Ou.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function _l(e,t){e=Ru.call(this,e,t)||this;return e.metaCounter=t,e}function vl(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.metaCounter,i=e.upsert,i=void 0!==i&&i,e=e.mode,e=void 0===e?"set":e;return(t=Du.call(this)||this).method=I.PUT,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:s,upsert:i,mode:e},t}function ml(e,t){e=Mu.call(this,e,t)||this;return e.metaCounter=t,e}function gl(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metaCounter;return(t=ku.call(this)||this).method=I.POST,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:e},t}function yl(e,t){e=Lu.call(this,e,t)||this;return e.metaCounter=t,e}function El(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=Uu.call(this)||this).method=I.GET,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={keys:e},t}function Il(e,t){e=Pu.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function bl(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=xu.call(this)||this).method=I.PUT,t.path="".concat(b(e),"/").concat(encodeURIComponent(n),"/metadata"),t.params={include_ts:!0},t}function Tl(e,t){e=qu.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function Cl(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=Fu.call(this)||this).method=I.DELETE,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/metadata/").concat(e),t.params={include_ts:!0},t}function wl(e,t,n){e=Hu.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function Sl(e,t){var e=Gu.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function Nl(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.metadata,e=e.upsert;return(t=Vu.call(this)||this).method=I.PUT,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:s,include_ts:!0,upsert:null!=e&&e},t}function Al(e,t){var e=Bu.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function Ol(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=Qu.call(this)||this).method=I.GET,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={keys:e,include_ts:!0},t}function Rl(e,t){var e=ju.call(this,e,t)||this,n=(e.isMuted=!1,e.startAt=null,e.endAt=null,e.remainingDuration=null,e.description=null,t.is_muted),r=t.start_at,s=t.end_at,i=t.remaining_duration,t=t.description;return e.isMuted=n,e.startAt=r,e.endAt=s,e.remainingDuration=i,e.description=t,e}function Dl(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=Ku.call(this)||this).method=I.GET,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/mute/").concat(e),t}e(function(e,t){return zu.call(this,e,t)||this},zu=_);e(Ul,Ml=o);var Ml,kl,Ll=Ul;function Ul(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=Ml.call(this)||this).method=I.DELETE,t.path="".concat(b(e),"/").concat(encodeURIComponent(n),"/metacounter"),t.params=null,t}e(function(){return null!==kl&&kl.apply(this,arguments)||this},kl=_);e(Fl,Pl=o);var Pl,xl,ql=Fl;function Fl(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.userId,i=e.seconds,e=e.description;return(t=Pl.call(this)||this).method=I.POST,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={user_id:s,seconds:i,description:e},t}e(function(e,t){return xl.call(this,e,t)||this},xl=_);e(Kl,Gl=Ir);var Hl,Gl,Vl,Bl=Kl,Ql=(e(jl,Hl=o),jl);function jl(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=Hl.call(this)||this).method=I.DELETE,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/mute/").concat(encodeURIComponent(e)),t}function Kl(e,t,n){var r=Gl.call(this,e,"SYEV",n)||this;return r.user=new Xc(e,n.data),r}e(function(){return null!==Vl&&Vl.apply(this,arguments)||this},Vl=_);e(Zl,Wl=Ir);var zl,Wl,Yl,$l=Zl,Xl=(e(Jl,zl=o),Jl);function Jl(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.userId,i=e.seconds,e=e.description;return(t=zl.call(this)||this).method=I.POST,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=E({user_id:s,seconds:i,description:e}),t}function Zl(e,t,n){var r=Wl.call(this,e,"SYEV",n)||this;return r.user=new Xc(e,n.data),r}e(function(){return null!==Yl&&Yl.apply(this,arguments)||this},Yl=_);e(ah,th=Ir);var eh,th,nh,rh=ah,sh=(e(ih,eh=o),ih);function ih(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=eh.call(this)||this).method=I.DELETE,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/ban/").concat(encodeURIComponent(e)),t}function ah(e,t,n){var r=th.call(this,e,"SYEV",n)||this;return r.memberCount=null,r.joinedMemberCount=null,r.user=new Xc(e,n.data),n.data.member_count&&(r.memberCount=n.data.member_count),n.data.joined_member_count&&(r.joinedMemberCount=n.data.joined_member_count),r}e(function(){return null!==nh&&nh.apply(this,arguments)||this},nh=_);e(ph,ch=Ir);var oh,ch,uh,lh=ph,hh=(e(dh,oh=o),dh);function dh(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.freezing;return(t=oh.call(this)||this).method=I.PUT,t.path="".concat(b(r),"/").concat(encodeURIComponent(n),"/freeze"),t.params={freeze:e},t}function ph(e,t,n){var r=ch.call(this,e,"SYEV",n)||this;return r.user=new Xc(e,n.data),r}e(function(){return null!==uh&&uh.apply(this,arguments)||this},uh=_);e(zh,Ch=Ir);var fh,_h,vh,mh,gh,yh,Eh,Ih,bh,Th,Ch,wh,Sh=zh,Nh=(e(Kh,Th=o),Kh),Ah=(e(jh,bh=o),jh),Oh=(e(Qh,Ih=o),Qh),Rh=(e(Bh,Eh=br),Bh),Dh=(e(Vh,yh=Ir),Vh),Mh=(e(Gh,gh=br),Gh),kh=(e(Hh,mh=Ir),Hh),Lh=(e(Fh,vh=br),Fh),Uh=(e(qh,_h=Ir),qh),Ph=(e(xh,fh=o),xh);function xh(e){var t=fh.call(this)||this;return t.method=I.DELETE,t.path="".concat(b(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),t}function qh(e,t,n){var r,s=this,e=((s=_h.call(this,e,"FEDI",n)||this).message=new $a(e,n),g.of(e).sdkState);return s.mentionCountChange=ii({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:s.message.mentionType,mentionedUserIds:null!=(r=s.message.mentionedUserIds)?r:null==(n=s.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),s}function Fh(e){var t=[];return e.mentionType===$r.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),vh.call(this,{code:"FEDI",ackRequired:!0,payload:E({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function Hh(e,t,n){var r,s=this,e=((s=mh.call(this,e,"MEDI",n)||this).message=new za(e,n),g.of(e).sdkState);return s.mentionCountChange=ii({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:s.message.mentionType,mentionedUserIds:null!=(r=s.message.mentionedUserIds)?r:null==(n=s.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),s}function Gh(e){var t=[];return e.mentionType===$r.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),gh.call(this,{code:"MEDI",ackRequired:!0,payload:E({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function Vh(e,t,n){var r,s=this,e=((s=yh.call(this,e,"MESG",n)||this).message=new za(e,n),g.of(e).sdkState);return s.isMentioned=di(s.message.mentionType,null!=(r=s.message.mentionedUserIds)?r:null==(r=s.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),s.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,s}function Bh(e){var t=[];return e.mentionType===$r.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),Eh.call(this,{code:"MESG",ackRequired:!0,payload:E({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==Jr.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function Qh(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.category,i=e.userId,a=e.offendingUserId,o=e.messageId,e=e.description;return(t=Ih.call(this)||this).method=I.POST,t.path="".concat(si(r),"/").concat(encodeURIComponent(n),"/messages/").concat(o),t.params={report_category:s,reporting_user_id:i,report_description:e,offending_user_id:a},t}function jh(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.category,i=e.userId,a=e.offendingUserId,e=e.description;return(t=bh.call(this)||this).method=I.POST,t.path="/report/users/".concat(a),t.params={channel_url:n,channel_type:r===jr.OPEN?"open_channels":"group_channels",report_category:s,reporting_user_id:i,report_description:e},t}function Kh(e){var t=this,n=e.channelUrl,r=e.channelType,s=e.category,i=e.userId,e=e.description;return(t=Th.call(this)||this).method=I.POST,t.path="".concat(si(r),"/").concat(encodeURIComponent(n)),t.params={report_category:s,reporting_user_id:i,report_description:e},t}function zh(e,t,n){e=Ch.call(this,e,"SYEV",n)||this;return e.freeze=n.data.freeze,e}e(function(){return null!==wh&&wh.apply(this,arguments)||this},wh=_);e(Md,id=Ir);var Wh,Yh,$h,Xh,Jh,Zh,ed,td,nd,rd,sd,id,ad,od,cd,ud,ld=Md,hd=(e(Dd,sd=o),Dd),dd=(e(Rd,rd=_),Rd),pd=(e(Od,nd=o),Od),fd=(e(Ad,td=_),Ad),_d=(e(Nd,ed=o),Nd),vd=(e(Sd,Zh=_),Sd),md=(e(wd,Jh=o),wd),gd=(e(Cd,Xh=_),Cd),yd=(e(Td,$h=o),Td),Ed=(e(bd,Yh=_),bd),Id=(e(S,Wh=s),S.payloadify=function(e){return E(p(p({},Wh.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:m.payloadify(e.creator),created_at:e.createdAt/1e3}))},S.prototype.isGroupChannel=function(){return this.channelType===jr.GROUP},S.prototype.isOpenChannel=function(){return this.channelType===jr.OPEN},Object.defineProperty(S.prototype,"cachedMetaData",{get:function(){var n={};return this._cachedMetaData.forEach(function(e,t){e.isRemoved||(n[t]=e.value)}),n},enumerable:!1,configurable:!0}),S.prototype._upsertCachedMetaData=function(n,r){var s=this;Object.keys(n).forEach(function(e){var t=s._cachedMetaData.get(e);(!t||t.updatedAt<=r)&&s._cachedMetaData.set(e,{value:n[e],isRemoved:!1,updatedAt:r})})},S.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach(function(e){e=n._cachedMetaData.get(e);e&&e.updatedAt<t&&(e.isRemoved=!1,e.updatedAt=t)})},S.prototype._generateRequestId=function(){return"rq-".concat(Un())},S.prototype.isIdentical=function(e){return e&&this.url===e.url},S.prototype.isEqual=function(e){return Dn(this,e)},S.prototype.createOperatorListQuery=function(e){return new nu(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},S.prototype.createMutedUserListQuery=function(e){return new iu(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},S.prototype.createBannedUserListQuery=function(e){return new cu(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},S.prototype.createPreviousMessageListQuery=function(e){return new Ic(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},S.prototype.addOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(l("string",r)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new bu({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.removeOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(l("string",r)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new Su({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.getMyMutedInfo=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Wu({channelUrl:this.url,channelType:this.channelType,userId:n.userId}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Yu),r=n.isMuted,s=n.startAt,i=n.endAt,a=n.remainingDuration,o=n.description,[2,{isMuted:r,startAt:s,endAt:i,remainingDuration:a,description:o}]}})})},S.prototype.getMetaData=function(i){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return v(l("string",i)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new $u({channelUrl:this.url,channelType:this.channelType,keys:i}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Xu),r=n.metadata,s=n.ts,this._upsertCachedMetaData(r,s),[2,r]}})})},S.prototype.getAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new $u({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Xu),r=n.metadata,s=n.ts,this._upsertCachedMetaData(r,s),[2,r]}})})},S.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new pi({channelUrl:this.url,channelType:this.channelType,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(fi).metaData,this._upsertCachedMetaData(n,0),[2,n]}})})},S.prototype.updateMetaData=function(i,a){return void 0===a&&(a=!1),re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new Ju({channelUrl:this.url,channelType:this.channelType,metadata:i,upsert:a}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Zu),r=n.metadata,s=n.ts,this._upsertCachedMetaData(r,s),[2,r]}})})},S.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new tl({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(nl).ts,this._removeFromCachedMetaData([r],n),[2]}})})},S.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new rl({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(sl).ts,this._removeFromCachedMetaData(Nn([],Sn(this._cachedMetaData.keys()),!1),n),[2]}})})},S.prototype.getMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(l("string",r)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new il({channelUrl:this.url,channelType:this.channelType,keys:r}),[4,t.send(n)];case 1:return[2,e.sent().as(al).metaCounter]}})})},S.prototype.getAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new il({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return[2,e.sent().as(al).metaCounter]}})})},S.prototype.createMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new ol({channelUrl:this.url,channelType:this.channelType,metaCounter:r}),[4,t.send(n)];case 1:return[2,e.sent().as(cl).metaCounter]}})})},S.prototype.updateMetaCounters=function(r,s){return void 0===s&&(s=!1),re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new ul({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:s}),[4,t.send(n)];case 1:return[2,e.sent().as(ll).metaCounter]}})})},S.prototype.increaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new ul({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return[2,e.sent().as(ll).metaCounter]}})})},S.prototype.decreaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new ul({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return[2,e.sent().as(ll).metaCounter]}})})},S.prototype.deleteMetaCounter=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new dl({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.deleteAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new Ll({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.muteUser=function(t,n,r){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this.muteUserWithUserId(t.userId,n,r)]})})},S.prototype.muteUserWithUserId=function(r,s,i){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)&&u("number",s,!0)&&u("string",i,!0)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new ql({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:s,description:i}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.unmuteUser=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this.unmuteUserWithUserId(t.userId)]})})},S.prototype.unmuteUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new Ql({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.banUser=function(t,n,r){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this.banUserWithUserId(t.userId,n,r)]})})},S.prototype.banUserWithUserId=function(r,s,i){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)&&u("number",s,!0)&&u("string",i,!0)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new Xl({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:s,description:i}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.unbanUser=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this.unbanUserWithUserId(t.userId)]})})},S.prototype.unbanUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new sh({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.freeze=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new hh({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!0,[2]}})})},S.prototype.unfreeze=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new hh({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!1,[2]}})})},S.prototype.getMessagesByTimestamp=function(n,r){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return r=p(p({},mo),r),v(u("number",n)&&(u("number",(t=r).prevResultSize)&&u("number",t.nextResultSize)&&u("boolean",t.isInclusive)&&u("boolean",t.reverse)&&u("string",t.messageTypeFilter)&&Hn(Wr,t.messageTypeFilter)&&l("string",t.customTypesFilter,!0)&&l("string",t.senderUserIdsFilter,!0)&&Hn(Xr,t.replyType)&&u("boolean",t.includeMetaArray)&&u("boolean",t.includeReactions)&&u("boolean",t.includeParentMessageInfo)&&u("boolean",t.includeThreadInfo)&&u("boolean",t.showSubchannelMessagesOnly))).throw(f.invalidParameters),[4,Yo.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,n,r)];case 1:return[2,e.sent()]}var t})})},S.prototype.getMessageChangeLogsSinceTimestamp=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return n=p(p({},go),n),v(u("number",t)&&fo(n)).throw(f.invalidParameters),[4,Yo.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},S.prototype.getMessageChangeLogsSinceToken=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return n=p(p({},go),n),v(u("string",t)&&fo(n)).throw(f.invalidParameters),[4,Yo.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},S.prototype._createPendingSendableMessagePayload=function(e,t,n){var r=g.of(this._iid).sessionManager;return E({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(e){return ya.payloadify(e)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?ba.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:Ga.payloadify(r.currentUser),req_id:t,request_state:Zr.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:e.mentionedUsers})},S.prototype._createPendingUserMessage=function(e,t,n){var r={};if(e.translationTargetLanguages)try{for(var s=ie(e.translationTargetLanguages),i=s.next();!i.done;i=s.next())r[i.value]=""}catch(e){o={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(o)throw o.error}}var a=E(p(p({},this._createPendingSendableMessagePayload(e,t,n)),{type:zr.USER,message:e.message,translations:r})),o=new za(this._iid,a);return o.messageParams=e,o},S.prototype._createPendingScheduledUserMessage=function(e,t,n){t=this._createPendingUserMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},S.prototype._createPendingFileMessage=function(e,t,n){t=E(p(p({},this._createPendingSendableMessagePayload(e,t,n)),{type:zr.FILE,url:e.fileUrl,file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}}):[]})),n=new $a(this._iid,t);return n.messageParams=e,n},S.prototype._createPendingScheduledFileMessage=function(e,t,n){t=this._createPendingFileMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},S.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===d.REQUEST_CANCELED?e.sendingStatus=Zr.CANCELED:n||(e.sendingStatus=Zr.FAILED)},S.prototype.sendUserMessage=function(e){return e=p(p({},Dc),e),v(Ac(t=e)&&u("string",t.message)&&l("string",t.translationTargetLanguages,!0)).throw(f.invalidParameters),this._sendUserMessage(e);var t},S.prototype._sendUserMessage=function(r,s,e){var n,i=this,t=(void 0===s&&(s=Date.now()),void 0===e&&(e=null),g.of(this._iid)),a=t.dispatcher,t=t.requestQueue,o=e,c=new $o,e=(o||(o=this._generateRequestId(),n=g.of(this._iid).dispatcher,Gr(2).then(function(){var t=i._createPendingUserMessage(r,o,s);n.dispatch(new Co({messages:[t],source:_o.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return[2,c._trigger(null,t)]})})})})),new Rh(p({channelUrl:this.url,channelType:this.channelType,reqId:o},r)));return t.send(e).then(function(e){var t=e.as(Dh).message;a.dispatch(new Co({messages:[t],source:_o.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return[2,c._trigger(null,t)]})})})}).catch(function(n){if(Rn(n))throw n;Gr(2).then(function(){var t=i._createPendingUserMessage(r,o,s),e=g.of(i._iid).cacheContext.localCacheEnabled&&Mn(n.code);i._markMessageAsFailed(t,n,e),a.dispatch(new Co({messages:[t],source:t.sendingStatus===Zr.PENDING?_o.REQUEST_RESEND_MESSAGE:_o.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return[2,c._trigger(n,t)]})})})})}),c},S.prototype._autoResendUserMessage=function(e){return v(e instanceof za).throw(f.invalidParameters),this._sendUserMessage(e.messageParams,e.createdAt,e.reqId)},S.prototype.resendUserMessage=function(r){var s;return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){return v(r instanceof za&&!r.scheduledInfo).throw(f.invalidParameters),t=new Dr,n=null!=(s=r.messageParams)?s:E({data:r.data,customType:r.customType,mentionType:r.mentionType,mentionedUsers:r.mentionedUsers,mentionedUserIds:r.mentionedUserIds,mentionedMessageTemplate:r.mentionedMessageTemplate,metaArrays:r.metaArrays,parentMessageId:r.parentMessageId,appleCriticalAlertOptions:r.appleCriticalAlertOptions,message:r.message,translationTargetLanguages:Object.keys(r.translations)}),this._sendUserMessage(n).onFailed(function(e){return t.reject(e)}).onSucceeded(function(e){return t.resolve(e)}),[2,t.promise]})})},S.prototype.updateUserMessage=function(i,a){return re(this,void 0,void 0,function(){var n,r,s;return se(this,function(e){switch(e.label){case 0:return a=p(p({},Jc),a),v(u("number",i)&&(qc(t=a)&&u("string",t.message,!0)&&l("string",t.translationTargetLanguages,!0))).throw(f.invalidParameters),r=g.of(this._iid),n=r.dispatcher,r=r.requestQueue,s=new Mh(p({channelType:this.channelType,channelUrl:this.url,messageId:i},a)),[4,r.send(s)];case 1:return r=e.sent(),s=r.as(kh).message,n.dispatch(new Co({messages:[s],source:_o.EVENT_MESSAGE_UPDATED})),[2,s]}var t})})},S.prototype.copyUserMessage=function(r,s){var i;return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){return v(r instanceof S&&s instanceof za&&s.sendingStatus===Zr.SUCCEEDED&&r.url===s.channelUrl&&!s.scheduledInfo).throw(f.invalidParameters),t=new Dr,n=null!=(i=s.messageParams)?i:p(p({},s),{mentionType:s.mentionType,mentionedUserIds:null!=(i=s.mentionedUserIds)?i:null==(i=s.mentionedUsers)?void 0:i.map(function(e){return e.userId}),translationTargetLanguages:Object.keys(s.translations),pushNotificationDeliveryOption:Jr.DEFAULT,parentMessageId:null,isReplyToChannel:!1}),r._sendUserMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},S.prototype.translateUserMessage=function(r,s){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(r instanceof za&&0<r.messageId&&l("string",s)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new _d({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,translationTargetLanguages:s}),[4,t.send(n)];case 1:return[2,e.sent().as(vd).message]}})})},S.prototype._createScheduledUserMessage=function(e,r){var s=this,t=g.of(this._iid).requestQueue,i=Date.now(),a=this._generateRequestId(),n=(Gr(2).then(function(){var t=s._createPendingScheduledUserMessage(e,a,i);ae(function(){return re(s,void 0,void 0,function(){return se(this,function(e){return[2,r._trigger(null,t)]})})})}),new md(p({reqId:a,channelType:this.channelType,channelUrl:this.url},e)));t.send(n).then(function(e){var t=e.as(gd).message;ae(function(){return re(s,void 0,void 0,function(){return se(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(Rn(n))throw n;Gr(2).then(function(){var t=s._createPendingScheduledUserMessage(e,a,i);s._markMessageAsFailed(t,n),ae(function(){return re(s,void 0,void 0,function(){return se(this,function(e){return[2,r._trigger(n,t)]})})})})})},S.prototype.sendFileMessage=function(e){return e=p(p({},xc),e),v(Uc(e)).throw(f.invalidParameters),this._sendFileMessage(e)},S.prototype._sendFileMessage=function(r,s,e){var i=this,a=(void 0===s&&(s=Date.now()),void 0===e&&(e=null),g.of(this._iid).dispatcher),t=Yo.of(this._iid).fileMessageQueue,o=e,c=new $o;return o||(o=this._generateRequestId(),Gr(2).then(function(){var t=i._createPendingFileMessage(r,o,s);a.dispatch(new Co({messages:[t],source:_o.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return[2,c._trigger(null,t)]})})})})),t.request(this,o,r).then(function(t){a.dispatch(new Co({messages:[t],source:_o.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return[2,c._trigger(null,t)]})})})}).catch(function(n){if(Rn(n))throw n;Gr(2).then(function(){var t=i._createPendingFileMessage(r,o,s),e=g.of(i._iid).cacheContext.localCacheEnabled&&Mn(n.code);i._markMessageAsFailed(t,n,e),a.dispatch(new Co({messages:[t],source:t.sendingStatus===Zr.PENDING?_o.REQUEST_RESEND_MESSAGE:_o.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(i,void 0,void 0,function(){return se(this,function(e){return[2,c._trigger(n,t)]})})})})}),c},S.prototype._autoResendFileMessage=function(e){v(e instanceof $a).throw(f.invalidParameters);var t=g.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.createdAt,e.reqId).onFailed(function(e){t.debug("autoResendFileMessage failed",e)}).onSucceeded(function(e){t.debug("autoResendFileMessage success",e)})},S.prototype._createScheduledFileMessage=function(e,r,s,i){var a=this,t=g.of(this._iid).requestQueue,n=new yd(p(p({reqId:s,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));t.send(n).then(function(e){var t=e.as(Ed).message;ae(function(){return re(a,void 0,void 0,function(){return se(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(Rn(n))throw n;Gr(2).then(function(){var t=a._createPendingScheduledFileMessage(e,s,i);a._markMessageAsFailed(t,n),ae(function(){return re(a,void 0,void 0,function(){return se(this,function(e){return[2,r._trigger(n,t)]})})})})})},S.prototype.sendFileMessages=function(e){v(e.every(function(e){return Uc(p(p({},xc),e))})).throw(f.invalidParameters);var t,n,r=new $o;try{for(var s=ie(e),i=s.next();!i.done;i=s.next()){var a=i.value;this.sendFileMessage(a).onPending(function(e){return r._trigger(null,e)}).onFailed(function(e,t){return r._trigger(e,t)}).onSucceeded(function(e){return r._trigger(null,e)})}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return r},S.prototype.resendFileMessage=function(s,i){var a;return re(this,void 0,void 0,function(){var n,r;return se(this,function(e){return v(s instanceof $a&&i instanceof Blob&&!s.scheduledInfo).throw(f.invalidParameters),n=new Dr,r=null!=(a=s.messageParams)?a:(t=i,E({data:s.data,customType:s.customType,mentionType:s.mentionType,mentionedUsers:s.mentionedUsers,mentionedUserIds:s.mentionedUserIds,metaArrays:s.metaArrays,parentMessageId:s.parentMessageId,appleCriticalAlertOptions:s.appleCriticalAlertOptions,file:t=void 0===i?null:t,fileUrl:s.url,fileName:s.name,fileSize:s.size,mimeType:s.type,thumbnailSizes:s.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}})})),this._sendFileMessage(r).onFailed(function(e){return n.reject(e)}).onSucceeded(function(e){return n.resolve(e)}),[2,n.promise];var t})})},S.prototype.updateFileMessage=function(s,i){return re(this,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return i=p(p({},Zc),i),v(u("number",s)&&qc(i)).throw(f.invalidParameters),n=g.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new Lh(p({channelType:this.channelType,channelUrl:this.url,messageId:s},i)),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(Uh).message,t.dispatch(new Co({messages:[r],source:_o.EVENT_MESSAGE_UPDATED})),[2,r]}})})},S.prototype.cancelUploadingFileMessage=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return v(u("string",t)).throw(f.invalidParameters),Yo.of(this._iid).fileMessageQueue.cancel(this,t),[2,!0]})})},S.prototype.copyFileMessage=function(r,s){var i;return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){return v(r instanceof S&&s instanceof $a&&s.sendingStatus===Zr.SUCCEEDED&&r.url===s.channelUrl&&!s.scheduledInfo).throw(f.invalidParameters),t=new Dr,n=p(p({},s),{fileUrl:s.url,fileName:s.name,fileSize:s.size,mimeType:s.type,mentionType:s.mentionType,mentionedUserIds:null!=(i=s.mentionedUserIds)?i:null==(i=s.mentionedUsers)?void 0:i.map(function(e){return e.userId}),pushNotificationDeliveryOption:Jr.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:s.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),requireAuth:s.requireAuth}),r._sendFileMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},S.prototype.deleteMessage=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(r instanceof Va).throw(f.invalidParameters),0<r.messageId?(t=g.of(this._iid).requestQueue,n=new Ph({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},S.prototype.addReaction=function(r,s){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(r instanceof Ha&&0<r.messageId&&u("string",s)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new hd({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:s}),[4,t.send(n)];case 1:return[2,e.sent().as(dd).reactionEvent]}})})},S.prototype.deleteReaction=function(r,s){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(r instanceof Ha&&0<r.messageId&&u("string",s)).throw(f.invalidParameters),t=g.of(this._iid).requestQueue,n=new pd({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:s}),[4,t.send(n)];case 1:return[2,e.sent().as(fd).reactionEvent]}})})},S.prototype._updateMessageMetaArray=function(s,i,a,o){return re(this,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return n=g.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new Mh({channelType:this.channelType,channelUrl:this.url,messageId:s,metaArrayParams:{array:i,mode:a,upsert:o}}),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(kh).message,t.dispatch(new Co({messages:[r],source:_o.EVENT_MESSAGE_UPDATED})),[2,r]}})})},S.prototype.createMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return se(this,function(e){return v(n instanceof Va&&0<n.messageId&&l("string",r)).throw(f.invalidParameters),t=r.map(function(e){return new ya({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"add",!0)]})})},S.prototype.deleteMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return se(this,function(e){return v(n instanceof Va&&0<n.messageId&&l("string",r)).throw(f.invalidParameters),t=r.map(function(e){return new ya({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"remove",!0)]})})},S.prototype.addMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){return v(t instanceof Va&&0<t.messageId&&n.every(function(e){return e instanceof ya})).throw(f.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"add",!0)]})})},S.prototype.removeMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){return v(t instanceof Va&&0<t.messageId&&n.every(function(e){return e instanceof ya})).throw(f.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"remove",!0)]})})},S.prototype.report=function(r,s){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(Hn(Fc,r)&&u("string",s)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Nh({channelUrl:this.url,channelType:this.channelType,userId:n.userId,category:r,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.reportUser=function(r,s,i){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(r instanceof m&&Hn(Fc,s)&&u("string",i)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Ah({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.userId,category:s,description:i}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S.prototype.reportMessage=function(r,s,i){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(r instanceof Va&&Hn(Fc,s)&&u("string",i)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Oh({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.sender.userId,messageId:r.messageId,category:s,description:i}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},S);function S(e,t){var n=this;return(n=Wh.call(this,e)||this).url="",n.channelType=jr.BASE,n.name="",n.coverUrl="",n.customType="",n.data="",n.isFrozen=!1,n.isEphemeral=!1,n.creator=null,n.createdAt=0,n.url=t.channel_url,n.name=null!=(e=t.name)?e:"",n.coverUrl=null!=(e=t.cover_url)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.data=null!=(e=t.data)?e:"",n.isFrozen=!!u("boolean",t.freeze)&&t.freeze,n.isEphemeral=!!u("boolean",t.is_ephemeral)&&t.is_ephemeral,n.creator=t.created_by?new m(n._iid,t.created_by):null,n.createdAt=1e3*t.created_at,n._cachedMetaData=new Map,t.metadata&&t.ts&&Object.keys(t.metadata).forEach(function(e){n._cachedMetaData.set(e,{value:t.metadata[e],isRemoved:!1,updatedAt:t.ts})}),n}function bd(e,t){var n=Yh.call(this,e,t)||this;return n.message=new $a(e,t),n}function Td(e){var t=this,t=$h.call(this)||this,n=[],r=(e.mentionType===$r.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),s=e.channelUrl;return t.method=I.POST,t.path="".concat(b(r),"/").concat(encodeURIComponent(s),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:Yr.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return Ba.payloadify(e)}):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return ya.payloadify(e)}),apple_critical_alert_options:ba.payloadify(e.appleCriticalAlertOptions),push_option:e.pushNotificationDeliveryOption},t}function Cd(e,t){var n=Xh.call(this,e,t)||this;return n.message=new za(e,t),n}function wd(e){var t=this,t=Jh.call(this)||this,n=[],r=(e.mentionType===$r.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),s=e.channelUrl;return t.method=I.POST,t.path="".concat(b(r),"/").concat(encodeURIComponent(s),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:Yr.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return ya.payloadify(e)}),apple_critical_alert_options:ba.payloadify(e.appleCriticalAlertOptions),target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption},t}function Sd(e,t){var n=Zh.call(this,e,t)||this;return n.message=new za(e,t),n}function Nd(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.translationTargetLanguages,s=ed.call(this)||this;return s.method=I.POST,s.path="".concat(b(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r),"/translation"),s.params={target_langs:e},s}function Ad(e,t){e=td.call(this,e,t)||this;return e.reactionEvent=new va(p({},t)),e}function Od(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,s=nd.call(this)||this;return s.method=I.DELETE,s.path="".concat(b(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),s.params={reaction:e},s}function Rd(e,t){e=rd.call(this,e,t)||this;return e.reactionEvent=new va(t),e}function Dd(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,s=sd.call(this)||this;return s.method=I.POST,s.path="".concat(b(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),s.params={reaction:e},s}function Md(e,t,n){e=id.call(this,e,"DELM",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.messageId=Number(n.msg_id),e}(w=ad=ad||{}).SUCCESS="success",w.PENDING="pending",w.ERROR="error",(w=od=od||{}).DEFAULT="default",w.ALL="all",w.MENTION_ONLY="mention_only",w.OFF="off",(w=cd=cd||{}).FCM="gcm",w.APNS="apns",w.UNKNOWN="unknown",(w=ud=ud||{}).ALTERNATIVE="alternative",w.DEFAULT="default";var kd;(w=kd=kd||{}).LATEST_LAST_MESSAGE="latest_last_message",w.CHRONOLOGICAL="chronological",w.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",w.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";function Ld(e){switch(e){case kd.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case kd.CHRONOLOGICAL:return["-createdAt","syncIndex"];case kd.CHANNEL_NAME_ALPHABETICAL:return["name"]}}xd.prototype.clone=function(){var t=new xd,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach(function(e){t[e]=n[e]}),t},xd.prototype.match=function(e){switch(this.messageTypeFilter){case Wr.USER:if(e.messageType!==zr.USER)return!1;break;case Wr.FILE:if(e.messageType!==zr.FILE)return!1;break;case Wr.ADMIN:if(e.messageType!==zr.ADMIN)return!1}if(this.customTypesFilter&&0<this.customTypesFilter.length&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&0<this.senderUserIdsFilter.length){if(!(e instanceof Va))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case Xr.NONE:if(0<e.parentMessageId)return!1;break;case Xr.ONLY_REPLY_TO_CHANNEL:if(e instanceof Va&&0<e.parentMessageId&&!e.replyToChannel)return!1}return!0};var Ud,Pd=xd;function xd(){this.messageTypeFilter=Wr.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=Xr.NONE}(w=Ud=Ud||{}).CHANNEL_LATEST="channel_latest",w.NEWEST_CHILD_MESSAGE="newest_child_message";function qd(e){switch(e){case Ud.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case Ud.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}}p(p({},Dc),{scheduledAt:null}),p(p({},C),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1});var Fd,Hd,Gd,Vd,Bd={},Qd=(e(Zd,Vd=s),Zd.of=function(e){return Bd[e]},Object.defineProperty(Zd.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(Zd.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),Zd.prototype._serialize=function(e){if(0<e.messageId)throw f.invalidParameters;var t,n=p({},e.serialize());return e instanceof za?(e.messageParams&&(n.messageParams=Oc(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,p(p({},Oc(t)),{scheduledAt:t.scheduledAt})))):e instanceof $a&&(e.messageParams&&(n.messageParams=Lc(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,p(p({},Lc(t)),{scheduledAt:t.scheduledAt})))),n},Zd.prototype._deserialize=function(e){return e?(e=p(p({},e),{messageId:parseInt(e.messageId)}),Yo.of(this._iid).buildMessageFromSerializedData(e)):null},Zd.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},Zd.prototype.fetch=function(e){var t=e.channelUrl,s=void 0===t?null:t,t=e.filter,i=void 0===t?new Pd:t,t=e.order,a=void 0===t?Ud.CHANNEL_LATEST:t,t=e.sendingStatus,o=void 0===t?null:t,t=e.backward,c=void 0!==t&&t,t=e.parentMessageId,u=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n,r=this;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(n=qd(a),t={"/where":function(e){return!!(a!==Ud.NEWEST_CHILD_MESSAGE||u&&0!==e.parentMessageId&&e.parentMessageId===u)&&i.match(r._deserialize(e))}},s&&(t.channelUrl=s),o&&(t.sendingStatus=o),t={where:t,index:n,backward:c},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({})];case 2:return n=e.sent(),[2,Promise.all(n.map(function(o){return re(r,void 0,void 0,function(){var t,n,r,s,i,a;return se(this,function(e){switch(e.label){case 0:return t=Yo.of(this._iid),n=this._deserialize(o),(r=o.messageParams)?n instanceof za?(n.messageParams=t.buildUserMessageCreateParamsFromSerializedData(r,n),[3,4]):[3,1]:[3,4];case 1:return n instanceof $a?r.fileKey&&"string"==typeof r.fileKey&&kc(r.fileType)?(s=r,[4,this.collection.getBlob(r.fileKey)]):[3,3]:[3,4];case 2:s.file=e.sent(),e.label=3;case 3:n.messageParams=t.buildFileMessageCreateParamsFromSerializedData(r,n),e.label=4;case 4:return n.scheduledInfo&&o.scheduledInfo&&o.scheduledInfo.scheduledMessageParams?n instanceof za?(i=o.scheduledInfo.scheduledMessageParams,n.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(i,n),[3,8]):[3,5]:[3,8];case 5:return n instanceof $a?(i=o.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof i.fileKey&&kc(i.fileType)?(a=i,[4,this.collection.getBlob(i.fileKey)]):[3,7]:[3,8];case 6:a.file=e.sent(),e.label=7;case 7:n.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(i,n),e.label=8;case 8:return[2,n]}})})}))];case 3:return[2,[]]}})})},Zd.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new Pd),re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this.fetch({filter:n,order:Ud.NEWEST_CHILD_MESSAGE,channelUrl:t.channelUrl,backward:!1,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},Zd.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,3];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},Zd.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Zd.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=ie(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),s={error:r},[3,8];case 7:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},Zd.prototype.removeMessagesOfChannel=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t}})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Zd.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Zd.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return se(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(s){return re(t,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return s instanceof $a?s.messageParams&&(t=s.messageParams).file&&Mc(t.file)?[4,this.collection.saveBlob(t.file,s.reqId)]:[3,2]:[3,4];case 1:r=e.sent(),t.fileKey=r,t.fileType=Rc.BLOB,e.label=2;case 2:return s.scheduledInfo&&s.scheduledInfo.scheduledMessageParams&&(n=s.scheduledInfo.scheduledMessageParams).file&&Mc(n.file)?[4,this.collection.saveBlob(n.file,s.reqId)]:[3,4];case 3:r=e.sent(),n.fileKey=r,n.fileType=Rc.BLOB,e.label=4;case 4:return[2]}})})}))];case 1:return e.sent(),[2]}})})},Zd),jd={},Kd=(e(Jd,Gd=s),Jd.of=function(e){return jd[e]},Object.defineProperty(Jd.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(Jd.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),Jd.prototype._serialize=function(e){return p(p({},e.serialize()),{messageId:"".concat(e.messageId)})},Jd.prototype._deserialize=function(e){return e=p(p({},e),{messageId:parseInt(e.messageId)}),Yo.of(this._iid).buildMessageFromSerializedData(e)},Jd.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},Jd.prototype.fetch=function(e){var r=e.channelUrl,s=e.token,t=e.limit,i=void 0===t?100:t,t=e.filter,a=void 0===t?new Pd:t,t=e.order,o=void 0===t?Ud.CHANNEL_LATEST:t,t=e.backward,c=void 0!==t&&t,t=e.parentMessageId,u=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n=this;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=qd(o),t={where:{channelUrl:r,"/where":function(e){if(s)switch(o){case Ud.CHANNEL_LATEST:if(!c&&e.createdAt>s||c&&e.createdAt<s)return!1;break;case Ud.NEWEST_CHILD_MESSAGE:if(!u||0===e.parentMessageId||e.parentMessageId!==u)return!1}return a.match(n._deserialize(e))}},index:t,backward:c},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({limit:i})];case 2:return t=e.sent(),[2,Promise.all(t.map(function(s){return re(n,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return t=this._deserialize(s),(n=s.messageParams)?t instanceof za?(t.messageParams=n,[3,4]):[3,1]:[3,4];case 1:return t instanceof $a?n.fileKey&&"string"==typeof n.fileKey&&kc(n.fileType)?(r=n,[4,this.collection.getBlob(n.fileKey)]):[3,3]:[3,4];case 2:r.file=e.sent(),e.label=3;case 3:t.messageParams=n,e.label=4;case 4:return[2,t]}})})}))];case 3:return[2,[]]}})})},Jd.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new Pd),re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this.fetch({channelUrl:t.channelUrl,token:Date.now(),limit:null,backward:!1,filter:n,order:Ud.NEWEST_CHILD_MESSAGE,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},Jd.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,5];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:return e.sent(),[4,this.upsertChildMessages(r)];case 3:return e.sent(),[4,this._unsentMessageCache.upsertChildMessages(r)];case 4:e.sent(),e.label=5;case 5:return[2]}})})},Jd.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Jd.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=ie(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),s={error:r},[3,8];case 7:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},Jd.prototype.removeMessagesOfChannel=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:n},index:qd(Ud.CHANNEL_LATEST)})]:[3,6];case 1:return e.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync"))];case 2:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync.meta"))];case 3:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs"))];case 4:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs.meta"))];case 5:e.sent(),e.label=6;case 6:return[2]}})})},Jd.prototype.removeUnderOffset=function(t,n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t,createdAt:{"<":n}},index:qd(Ud.CHANNEL_LATEST)})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Jd.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},Jd.prototype.countBetween=function(r,s,i){return re(this,void 0,void 0,function(){var t,n=this;return se(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=qd(Ud.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:r,"/where":function(e){e=n._deserialize(e);return i.includes(e.createdAt)&&s.match(e)}},index:t}).count()]):[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},Jd.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return se(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return r instanceof $a&&r.messageParams&&(t=r.messageParams).file&&Mc(t.file)?[4,this.collection.saveBlob(t.file,r.reqId)]:[3,2];case 1:n=e.sent(),t.fileKey=n,e.label=2;case 2:return[2]}})})}))];case 1:return e.sent(),[2]}})})},Jd),zd=(e(Xd,Hd=Pn),Xd),Wd={},Yd=($d.of=function(e){return Wd[e]},$d.prototype.processNonAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a;return se(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=ie(t),r=n.next();!r.done;r=n.next())0===(s=r.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",s.reqId),s.sendingStatus=Zr.FAILED,s.errorCode=d.ACK_TIMEOUT,this._dispatcher.dispatch(new Co({messages:[s],source:_o.LOCAL_MESSAGE_FAILED})))}catch(e){i={error:e}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return[2]}})})},$d.prototype.processAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c;return se(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=ie(t),r=n.next();!r.done;r=n.next())(s=r.value).errorCode&&Mn(s.errorCode)&&(i=(new Date).getTime(),a=s.createdAt+2592e5,i<=a?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(s.reqId)<0&&this._autoResendQueue.push(s):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),s.sendingStatus=Zr.FAILED,this._dispatcher.dispatch(new Co({messages:[s],source:_o.LOCAL_MESSAGE_FAILED}))))}catch(e){o={error:e}}finally{try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(o)throw o.error}}return[2]}})})},$d.prototype.completeCurrentAndProcessNextAutoResend=function(e){this._localCacheEnabled&&(e.sendingStatus===Zr.SUCCEEDED||e.sendingStatus===Zr.FAILED&&!Mn(e.errorCode))&&(0<=(e=this.indexOf(e))&&this._autoResendQueue.splice(e,1),0===e&&this._processNextAutoResend())},$d.prototype._fetchAllCachedPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return(t=Qd.of(this._iid))?[4,t.fetch({sendingStatus:Zr.PENDING,backward:!0})]:[3,2];case 1:return n=e.sent(),[3,3];case 2:n=[],e.label=3;case 3:return[2,n]}})})},$d.prototype.indexOf=function(e){return 0<this._autoResendQueue.length?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId):-1},$d.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId)},$d.prototype._processNextAutoResend=function(){return re(this,void 0,void 0,function(){var t;return se(this,function(e){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{0<this._autoResendQueue.length?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new zd({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}return[2]})})},$d);function $d(e,t){var n=t.localCacheEnabled,r=t.dispatcher,s=t.sdkState,t=t.logger,i=this;(Wd[e]=this)._iid=e,(Wd[e]=this)._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=t,this._sdkState=s,this._localCacheEnabled&&r.on(function(e){if(e instanceof fs)switch(e.stateType){case Mr.CONNECTED:i._isProcessingAutoResend||i.processAutoResendRegisteredPendingMessages().then(function(){return i._processNextAutoResend()});break;case Mr.DISCONNECTED:i._isProcessingAutoResend=!1}})}function Xd(e){var e=e.message,t=Hd.call(this)||this;return t.message=e,t}function Jd(e,t){var n=t.sdkState,r=t.cacheContext,t=t.unsentMessageCache,s=Gd.call(this,e)||this;return s._sdkState=n,s._cacheContext=r,s._unsentMessageCache=t,jd[e]=s}function Zd(e,t){var n=t.sdkState,t=t.cacheContext,r=Vd.call(this,e)||this;return r._sdkState=n,r._cacheContext=t,Bd[e]=r}(w=Fd=Fd||{})[w.USER_BLOCK=20001]="USER_BLOCK",w[w.USER_UNBLOCK=2e4]="USER_UNBLOCK",w[w.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED";yp.getDataAsUserBlockEvent=function(e,t){var t=t.data,n=t.blocker,t=t.blockee;return{blocker:new m(e,n),blockee:new m(e,t)}},yp.getDataAsFriendDiscoveredEvent=function(t,e){e=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(e)?e.map(function(e){return new m(t,e)}):[]}};var ep,tp,np,rp,sp,ip,ap=yp,op=(e(gp,ip=Pn),gp),cp=(e(mp,sp=Ir),mp),up=(e(vp,rp=o),vp),lp=(e(_p,np=_),_p),hp=(e(fp,tp=o),fp),dp=(e(pp,ep=_),pp);function pp(e,t){e=ep.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function fp(e){var t=e.userId,e=e.pushTriggerOption,n=tp.call(this)||this;return n.method=I.PUT,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/push_preference"),n.params={push_trigger_option:e},n}function _p(e,t){e=np.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function vp(e){var e=e.userId,t=rp.call(this)||this;return t.method=I.GET,t.path="".concat(h,"/").concat(encodeURIComponent(e),"/push_preference"),t}function mp(e,t,n){e=sp.call(this,e,"USEV",n)||this;return e.event=new ap(n),e}function gp(e,t){var t=t.userId,n=ip.call(this)||this;return n._iid=e,n.userId=t,n}function yp(e){this.category=e.cat,this.data=e.data}var Ep,Ip,bp,Tp,Cp,wp,Sp={profileImage:null,profileUrl:null,nickname:null},Np=(e(function(){return null!==Ep&&Ep.apply(this,arguments)||this},Ep=s),e(Pp,Cp=zn),Object.defineProperty(Pp.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),Pp.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=null,e.dispatch("pause")},3e4)),this._currentState=document.visibilityState},Pp.prototype.start=function(){this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})},Pp.prototype.stop=function(){this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})},Pp),Ap=(Object.defineProperty(Up.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),Up.prototype._onlineWorker=function(){this.connectionDelegate.reconnect()},Up.prototype._offlineWorker=function(){this.connectionDelegate.disconnect()},Up.prototype.start=function(){this.isAvailable&&(window.addEventListener("online",this._onlineWorker),window.addEventListener("offline",this._offlineWorker))},Up.prototype.stop=function(){this.isAvailable&&(window.removeEventListener("online",this._onlineWorker,!1),window.removeEventListener("offline",this._offlineWorker,!1))},Up.prototype.isOnline=function(){return re(this,void 0,void 0,function(){return se(this,function(e){return this.isAvailable?[2,navigator.onLine]:[2,new Promise(function(e,t){fetch("https://www.google.com",{method:I.GET}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},Up),Op=(e(Lp,Tp=o),Lp),Rp=(e(kp,bp=_),kp),Dp=(e(Mp,Ip=o),Mp);function Mp(e){var t=e.userId,e=e.token,n=Ip.call(this)||this;return n.method=I.POST,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/push/apns"),n.params={apns_device_token:e,always_push:!0},n}function kp(e,t){var n=bp.call(this,e,t)||this;return n.user=null,n.user=new m(e,p({},t)),n}function Lp(e){var t=e.userId,n=e.nickname,n=void 0===n?null:n,r=e.profileUrl,r=void 0===r?null:r,s=e.profileImage,s=void 0===s?null:s,e=e.preferredLanguages,e=void 0===e?null:e,i=Tp.call(this)||this;return i.method=I.PUT,i.path="".concat(h,"/").concat(encodeURIComponent(t)),i.params=E({nickname:n,profile_url:r,profile_file:s,preferred_languages:e}),i}function Up(e){var t=e.logger,e=e.connectionDelegate,e=void 0===e?null:e;this.logger=t,e&&(this.connectionDelegate=e),this._onlineWorker=this._onlineWorker.bind(this),this._offlineWorker=this._offlineWorker.bind(this)}function Pp(){var e=Cp.call(this)||this;return e._pauseDelayTimer=null,e._currentState="visible",e._toggleState=e._toggleState.bind(e),e}e(function(e,t){var n=wp.call(this,e,t)||this;return n.token=t.token,n.type=t.type?cd[t.type.toLowerCase()]:cd.UNKNOWN,n.user=new m(e,t.user),n},wp=_);e(Hp,xp=o);var xp,qp,Fp=Hp;function Hp(e){var t=e.userId,e=e.token,n=xp.call(this)||this;return n.method=I.POST,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/push/gcm"),n.params={gcm_reg_token:e,always_push:!0},n}e(function(e,t){var n=qp.call(this,e,t)||this;return n.token=t.token,n.type=t.type?cd[t.type.toLowerCase()]:cd.UNKNOWN,n.user=new m(e,t.user),n},qp=_);e(Qp,Gp=o);var Gp,Vp,Bp=Qp;function Qp(e){var t=e.userId,e=e.token,n=Gp.call(this)||this;return n.method=I.DELETE,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/push/apns/").concat(encodeURIComponent(e)),n}e(function(e,t){var n=Vp.call(this,e,t)||this;return n.token=t.token,n.user=new m(e,t.user),n},Vp=_);e(Wp,jp=o);var jp,Kp,zp=Wp;function Wp(e){var t=e.userId,e=e.token,n=jp.call(this)||this;return n.method=I.DELETE,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/push/gcm/").concat(encodeURIComponent(e)),n}e(function(e,t){var n=Kp.call(this,e,t)||this;return n.token=t.token,n.user=new m(e,t.user),n},Kp=_);e(Jp,Yp=o);var Yp,$p,Xp=Jp;function Jp(e){var e=e.userId,t=Yp.call(this)||this;return t.method=I.DELETE,t.path="".concat(h,"/").concat(encodeURIComponent(e),"/push/apns"),t}e(function(e,t){var n=$p.call(this,e,t)||this;return n.type=t.type?cd[t.type.toLowerCase()]:cd.UNKNOWN,n.user=new m(e,t.user),n},$p=_);e(nf,Zp=o);var Zp,ef,tf=nf;function nf(e){var e=e.userId,t=Zp.call(this)||this;return t.method=I.DELETE,t.path="".concat(h,"/").concat(encodeURIComponent(e),"/push/gcm"),t}e(function(e,t){var n=ef.call(this,e,t)||this;return n.type=t.type?cd[t.type.toLowerCase()]:cd.UNKNOWN,n.user=new m(e,t.user),n},ef=_);e(Yf,gf=o);var rf,sf,af,of,cf,uf,lf,hf,df,pf,ff,_f,vf,mf,gf,yf,Ef=Yf,If=(e(Wf,mf=_),Wf),bf=(e(zf,vf=o),zf),Tf=(e(Kf,_f=_),Kf),Cf=(e(jf,ff=o),jf),wf=(e(Qf,pf=_),Qf),Sf=(e(Bf,df=o),Bf),Nf=(e(Vf,hf=_),Vf),Af=(e(Gf,lf=o),Gf),Of=(e(Hf,uf=_),Hf),Rf=(e(Ff,cf=o),Ff),Df=(e(qf,of=_),qf),Mf=(e(xf,af=o),xf),kf=(e(Pf,sf=_),Pf),Lf=(e(Uf,rf=o),Uf);function Uf(e){var t=e.userId,e=e.blockedUserId,n=rf.call(this)||this;return n.method=I.POST,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/block"),n.params={target_id:e},n}function Pf(e,t){e=sf.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function xf(e){var t=e.userId,n=e.snoozeOn,r=e.startTs,e=e.endTs,s=af.call(this)||this;return s.method=I.PUT,s.path="".concat(h,"/").concat(encodeURIComponent(t),"/push_preference"),s.params={snooze_enabled:n,snooze_start_ts:r,snooze_end_ts:e},s}function qf(e,t){e=of.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function Ff(e){var e=e.userId,t=cf.call(this)||this;return t.method=I.GET,t.path="".concat(h,"/").concat(encodeURIComponent(e),"/push_preference"),t}function Hf(e,t){e=uf.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function Gf(e){var t=e.userId,n=e.doNotDisturbOn,r=e.startHour,s=e.startMin,i=e.endHour,a=e.endMin,e=e.timezone,o=lf.call(this)||this;return o.method=I.PUT,o.path="".concat(h,"/").concat(encodeURIComponent(t),"/push_preference"),o.params={do_not_disturb:n,start_hour:r,start_min:s,end_hour:i,end_min:a,timezone:e},o}function Vf(e,t){e=hf.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function Bf(e){var e=e.userId,t=df.call(this)||this;return t.method=I.GET,t.path="".concat(h,"/").concat(encodeURIComponent(e),"/push_preference"),t}function Qf(e,t){e=pf.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function jf(e){var t=e.userId,e=e.willAutoAccept,n=ff.call(this)||this;return n.method=I.PUT,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/channel_invitation_preference"),n.params={auto_accept:e},n}function Kf(e,t){e=_f.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function zf(e){var e=e.userId,t=vf.call(this)||this;return t.method=I.GET,t.path="".concat(h,"/").concat(encodeURIComponent(e),"/channel_invitation_preference"),t}function Wf(e,t){e=mf.call(this,e,t)||this;return e.pushTokens={type:t.type?cd[t.type.toLowerCase()]:cd.UNKNOWN,deviceTokens:t.device_tokens,hasMore:t.has_more,token:t.token},e}function Yf(e){var t=e.userId,n=e.type,r=e.token,e=e.ts,s=gf.call(this)||this;return s.method=I.GET,s.path="".concat(h,"/").concat(encodeURIComponent(t),"/push/").concat(encodeURIComponent(n),"/device_tokens"),s.params={created_ts:e,token:r},s}e(function(e,t){var n=yf.call(this,e,t)||this;return n.user=new m(e,t),n},yf=_);e(Zf,$f=o);var $f,Xf,Jf=Zf;function Zf(e){var t=e.userId,e=e.unblockedUserId,n=$f.call(this)||this;return n.method=I.DELETE,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/block/").concat(encodeURIComponent(e)),n}e(function(){return null!==Xf&&Xf.apply(this,arguments)||this},Xf=_);e(N_,c_=o);var e_,t_,n_,r_,s_,i_,a_,o_,c_,u_,l_=N_,h_=(e(S_,o_=_),S_),d_=(e(w_,a_=o),w_),p_=(e(C_,i_=_),C_),f_=(e(T_,s_=o),T_),__=(e(b_,r_=_),b_),v_=(e(I_,n_=o),I_),m_=(e(E_,t_=_),E_),g_=(e(y_,e_=o),y_);function y_(e){var t=e.userId,e=e.discoveryKeys,n=e_.call(this)||this;return n.method=I.DELETE,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discovery_keys:e},n}function E_(e,t){e=t_.call(this,e,t)||this;return e.friendDiscoveryRequestId=t.friend_discovery_request_id,e}function I_(e){var t=e.userId,e=e.discoveries,n=n_.call(this)||this;return n.method=I.PUT,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discoveries:e.map(function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}})},n}function b_(t,e){var n=r_.call(this,t,e)||this;return n.changelogs={addedUsers:e.added.map(function(e){return new m(t,e)}),updatedUsers:e.updated.map(function(e){return new m(t,e)}),deletedUserIds:e.deleted,hasMore:e.has_more,token:e.next},n}function T_(e){var t=e.userId,e=e.token,n=s_.call(this)||this;return n.method=I.GET,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/friends/changelogs"),n.params={token:e},n}function C_(e,t){e=i_.call(this,e,t)||this;return e.name=t.name,e}function w_(e){var t=e.userId,e=e.templateName,n=a_.call(this)||this;return n.method=I.PUT,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/push/template"),n.params={name:e},n}function S_(e,t){e=o_.call(this,e,t)||this;return e.name=t.name,e}function N_(e){var e=e.userId,t=c_.call(this)||this;return t.method=I.GET,t.path="".concat(h,"/").concat(encodeURIComponent(e),"/push/template"),t}e(function(){return null!==u_&&u_.apply(this,arguments)||this},u_=_);e(x_,R_=o);var A_,O_,R_,D_,M_=x_,k_=(e(P_,O_=_),P_),L_=(e(U_,A_=o),U_);function U_(e){var t=e.userId,e=e.userIds,n=A_.call(this)||this;return n.method=I.DELETE,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}function P_(t,e){var n=O_.call(this,t,e)||this;return n.users=e.users.map(function(e){return new m(t,e)}),n}function x_(e){var t=e.userId,e=e.userIds,n=R_.call(this)||this;return n.method=I.POST,n.path="".concat(h,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}e(function(){return null!==D_&&D_.apply(this,arguments)||this},D_=_);e(z_,H_=o);var q_,F_,H_,G_,V_=z_,B_=(e(K_,F_=_),K_),Q_=(e(j_,q_=o),j_);function j_(e){var t=e.userId,e=e.allowFriendDiscovery,n=q_.call(this)||this;return n.method=I.PUT,n.path="".concat(h,"/").concat(t,"/allow_friend_discovery"),n.params={allow_friend_discovery:e},n}function K_(e,t){e=F_.call(this,e,t)||this;return e.allowFriendDiscovery=t.allow_friend_discovery,e}function z_(e){var e=e.userId,t=H_.call(this)||this;return t.method=I.GET,t.path="".concat(h,"/").concat(e,"/allow_friend_discovery"),t.params={},t}e(function(){return null!==G_&&G_.apply(this,arguments)||this},G_=_);function W_(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map(function(e){return new hv(e)}):[]}var N,Y_,$_,X_,J_,Z_,ev,tv,nv,rv,sv,iv,av,ov,cv,uv,lv=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url},hv=function(e){var t;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!=(t=e.id)?t:0,this.name=null!=(t=e.name)?t:"",this.url=null!=(t=e.url)?t:"",this.emojis=e.emojis?e.emojis.map(function(e){return new lv(e)}):[]},dv=(e(Qv,uv=o),Qv),pv=(e(Bv,cv=_),Bv),fv=(e(Vv,ov=o),Vv),_v=(e(Gv,av=_),Gv),vv=(e(Hv,iv=o),Hv),mv=(e(Fv,sv=_),Fv),gv=(e(qv,rv=o),qv),yv=(e(xv,nv=_),xv),Ev=(e(Pv,tv=T),Pv.prototype._validate=function(){return tv.prototype._validate.call(this)&&l("string",this.userIdsFilter,!0)&&u("string",this.metaDataKeyFilter,!0)&&l("string",this.metaDataValuesFilter,!0)&&u("string",this.metaDataKeyFilter,!0)},Pv.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=g.of(this._iid).requestQueue,n=new gv(p(p({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(yv),r=n.users,s=n.next,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})},Pv),Iv=(e(Uv,ev=o),Uv),bv=(e(Lv,Z_=_),Lv),Tv=(e(kv,J_=T),kv.prototype._validate=function(){return J_.prototype._validate.call(this)&&l("string",this.userIdsFilter,!0)},kv.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Iv(p(p({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(bv),r=n.users,s=n.next,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})},kv),Cv=(e(Mv,X_=o),Mv),wv=(e(Dv,$_=_),Dv),Sv=(e(Rv,Y_=T),Rv.prototype._validate=function(){return Y_.prototype._validate.call(this)},Rv.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Cv(p(p({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(wv),r=n.users,s=n.hasMore,i=n.next,this._token=i,this._hasNext=s,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})},Rv),Nv={},Av=(Ov.get=function(e){return Nv[e]},Ov);function Ov(e){var t=e.dbname,n=e.itemSizeLimit,r=e.cacheLimit,r=void 0===r?256:r,s=e.blockHashBase,s=void 0===s?2:s,i=e.blockHashMultiplier,i=void 0===i?10:i,a=e.blockHashConstant,a=void 0===a?11:a,o=e.transactionApplyDelay,o=void 0===o?200:o,e=e.disableLogger,e=void 0!==e&&e;return Nv[t]||(this.itemSizeLimit=void 0===n?1048576:n,this.cacheLimit=r,this.blockHashBase=s,this.blockHashMultiplier=i,this.blockHashConstant=a,this.transactionApplyDelay=o,this.disableLogger=e,Nv[t]=this),Nv[t]}function Rv(){return null!==Y_&&Y_.apply(this,arguments)||this}function Dv(t,e){var n=$_.call(this,t,e)||this;return n.hasMore=e.has_more,n.users=e.users.map(function(e){return new m(t,e)}),n.next=e.next,n}function Mv(e){var t=e.userId,n=e.limit,e=e.token,r=X_.call(this)||this;return r.method=I.GET,r.path="".concat(h,"/").concat(encodeURIComponent(t),"/friends"),r.params={limit:n,token:e},r}function kv(e,t){var n=this;return(n=J_.call(this,e,t)||this).userIdsFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n}function Lv(t,e){var n=Z_.call(this,t,e)||this;return n.users=e.users.map(function(e){return new m(t,e)}),n.next=e.next,n}function Uv(e){var t=e.userId,n=e.limit,r=e.token,e=e.userIdsFilter,s=ev.call(this)||this;return s.method=I.GET,s.path="".concat(h,"/").concat(t,"/block"),s.params=E({limit:n,token:r,user_ids:e}),s}function Pv(e,t){var n=this;return(n=tv.call(this,e,t)||this).userIdsFilter=null,n.metaDataKeyFilter=null,n.metaDataValuesFilter=null,n.nicknameStartsWithFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n.metaDataKeyFilter=null!=(e=t.metaDataKeyFilter)?e:null,n.metaDataValuesFilter=null!=(e=t.metaDataValuesFilter)?e:null,n.nicknameStartsWithFilter=t.nicknameStartsWithFilter||null,n}function xv(t,e){var n=nv.call(this,t,e)||this;return n.users=e.users.map(function(e){return new m(t,e)}),n.next=e.next,n}function qv(e){var t=e.limit,n=e.token,r=e.userIdsFilter,s=e.metaDataKeyFilter,i=e.metaDataValuesFilter,e=e.nicknameStartsWithFilter,a=rv.call(this)||this;return a.method=I.GET,a.path=h,a.params=E({limit:t,token:n,user_ids:r,metadatakey:s,metadatavalues_in:i,nickname_startswith:e}),a}function Fv(e,t){e=sv.call(this,e,t)||this;return e.emoji=new lv(t),e}function Hv(e){var e=e.key,t=iv.call(this)||this;return t.method=I.GET,t.path="".concat(Ps,"/").concat(e),t}function Gv(e,t){e=av.call(this,e,t)||this;return e.emojiCategory=new hv(t),e}function Vv(e){var e=e.categoryId,t=ov.call(this)||this;return t.method=I.GET,t.path="".concat(xs,"/").concat(e),t}function Bv(e,t){e=cv.call(this,e,t)||this;return e.emojiContainer=new W_(t),e}function Qv(){var e=uv.call(this)||this;return e.method=I.GET,e.path=xs,e}(C=N=N||{})[C.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",C[C.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",C[C.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",C[C.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",C[C.STORE_IS_FULL=61001003]="STORE_IS_FULL",C[C.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",C[C.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",C[C.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",C[C.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",C[C.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",C[C.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",C[C.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",C[C.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",C[C.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",C[C.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",C[C.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",C[C.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",C[C.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",C[C.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",C[C.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",C[C.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",C[C.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",C[C.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",C[C.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",C[C.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND";e(O,Kv=Error),Object.defineProperty(O,"storeNotDefined",{get:function(){return new O({code:N.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailable",{get:function(){return new O({code:N.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailableInPrivateBrowsing",{get:function(){return new O({code:N.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeIsFull",{get:function(){return new O({code:N.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeKeyTypeIsInvalid",{get:function(){return new O({code:N.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenIntegrity",{get:function(){return new O({code:N.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenBlob",{get:function(){return new O({code:N.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeEncryptionInvalid",{get:function(){return new O({code:N.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeItemSizeExceeded",{get:function(){return new O({code:N.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeReadFailed",{get:function(){return new O({code:N.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeWriteFailed",{get:function(){return new O({code:N.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"databaseSchemaNotOnUpgrade",{get:function(){return new O({code:N.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionNotReady",{get:function(){return new O({code:N.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotMatch",{get:function(){return new O({code:N.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionQueryNotValid",{get:function(){return new O({code:N.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionInsertDuplicate",{get:function(){return new O({code:N.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotFound",{get:function(){return new O({code:N.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotGiven",{get:function(){return new O({code:N.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionWriteFailed",{get:function(){return new O({code:N.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionItemSizeExceeded",{get:function(){return new O({code:N.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTableIsRequired",{get:function(){return new O({code:N.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTypesNotMatch",{get:function(){return new O({code:N.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"compareTypesNotMatch",{get:function(){return new O({code:N.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"circularReferenceFound",{get:function(){return new O({code:N.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0});var jv,Kv,A=O;function O(e){var t=e.code,t=void 0===t?N.UNKNOWN_ERROR:t,e=e.message,e=Kv.call(this,void 0===e?"Unknown error occurred.":e)||this;return e.code=t,Object.setPrototypeOf(e,O.prototype),e}(w=jv=jv||{}).INIT="init",w.READY="ready",w.CLOSED="closed";function zv(e,t){if(void 0===t&&(t=new WeakMap),"object"!=typeof e||null===e)return e;if(t.has(e))throw A.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map(function(e){return zv(e,t)});else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=zv(e[r],t);return t.delete(e),n}function Wv(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw A.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n}function Yv(t){return new Promise(function(e){setTimeout(function(){return e()},t)})}function $v(e,t){if(t){if("function"==typeof e)return e(t);for(var n in e)if(["/and","&&"].includes(n)){if(e[n].some(function(e){return!$v(e,t)}))return}else if(["/or","||"].includes(n)){if(e[n].every(function(e){return!$v(e,t)}))return}else if("/where"===n){if(!(0,e[n])(t))return}else{var r=n;if("object"==typeof e[r]){var s,i=e[r];for(s in i)switch(s){case"/eq":case"=":if((a=t[r])!==(o=i[s]))return;break;case"/neq":case"!=":if((a=t[r])===(o=i[s]))return;break;case"/gt":case">":var a=t[r],o=i[s];if(0<Wv(a,o))break;return;case"/gte":case">=":if(a=t[r],o=i[s],0<=Wv(a,o))break;return;case"/lt":case"<":if(a=t[r],o=i[s],Wv(a,o)<0)break;return;case"/lte":case"<=":if(a=t[r],o=i[s],Wv(a,o)<=0)break;return;case"/in":if(a=t[r],(o=i[s]).includes(a))break;return;case"/nin":if(a=t[r],(o=i[s]).includes(a))return;break;case"/contain":if(a=t[r],o=i[s],a.includes(o))break;return;case"/regex":if(a=t[r],(o=i[s]).test(a))break;return;case"/where":if(a=t[r],!(0,i[s])(a))return}}else if("function"==typeof e[r]){if(!e[r](t[r]))return}else if(e[r]!==t[r])return}return 1}}function Xv(){}function Jv(){return Promise.resolve()}function Zv(e){return e}function em(e,t){t(null)}var tm=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t};function nm(e,t){return"".concat(pm(e,t),".metadata")}function rm(e,t){return"".concat(pm(e,t),"/block.")}function sm(e,t){return"".concat(pm(e,t),"/blob.")}function im(e,t,n,r){return void 0===r&&(r=0),"".concat(sm(e,t)).concat(n,".").concat(r)}Object.defineProperty(gm.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(gm.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(gm.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(gm.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(gm.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),gm.prototype.prev=function(){return re(this,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:if(!this.hasPrevious)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._prevValue,[4,(n=this)._backward()];case 2:return n._prevValue=e.sent()||null,this._nextValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},gm.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:if(!this.hasNext)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._nextValue,[4,(n=this)._forward()];case 2:return n._nextValue=e.sent()||null,this._prevValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},gm.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()};var am,om,cm,um=gm,lm=(mm.prototype.findOptimizedStartPosition=function(){var i=this,a=["=","/eq",">",">=","/gt","/gte"],o=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var e=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var t in this._indexer.fields){var n=this._indexer.fields[t],r=1;if("-"===n[0]&&(n=n.slice(1),r=-1),this.condition[n])if("object"==typeof this.condition[n]){var s,c=0<r?o:a;for(s in this.condition[n])if(c.includes(s))for(var u=e;0<=u;u--)if(r*Wv(this._indexer.origin[u].columnValues[t],this.condition[n][s])<=0){e=u;break}}else for(u=e;0<=u;u--)if(r*Wv(this._indexer.origin[u].columnValues[t],this.condition[n])<=0){e=u;break}}return Math.min(e+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=this,t=0;t<this._indexer.fields.length;t++)!function(n){var r=h._indexer.fields[n],s=1;if("-"===r[0]&&(r=r.slice(1),s=-1),h.condition[r])if("object"==typeof h.condition[r])Object.keys(h.condition[r]).forEach(function(e){if((0<s?a:o).includes(e))for(var t=l;t<i._indexer.origin.length;t++)if(0<=s*Wv(i._indexer.origin[t].columnValues[n],i.condition[r][e])){l=t;break}});else for(var e=l;e<h._indexer.origin.length;e++)if(0<=s*Wv(h._indexer.origin[e].columnValues[n],h.condition[r])){l=e;break}}(t);return Math.max(l-1,0)},mm.prototype.each=function(u){return re(this,void 0,void 0,function(){var r,s,i,a,t,n,o,c=this;return se(this,function(e){switch(e.label){case 0:if(r=this.findOptimizedStartPosition(),s=0,this.backward&&this._indexer.origin[r]&&(s=this._indexer.origin[r].keys.length-1),i=function(){if(c._indexer.origin[r]){if(!c._indexer.origin[r].keys[++s]){if(!c._indexer.origin[++r])return!1;s=0}return!0}return!1},a=function(){if(c._indexer.origin[r]){if(!c._indexer.origin[r].keys[--s]){if(!c._indexer.origin[--r])return!1;s=c._indexer.origin[r].keys.length-1}return!0}return!1},t=null,!this._indexer.origin[r])return[3,4];n=this.backward?a:i,e.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[s])];case 2:if(o=e.sent(),$v(this.condition,o))return t=o,[3,4];e.label=3;case 3:if(n())return[3,1];e.label=4;case 4:return[4,new Promise(function(e){e=new um({initialNextValue:zv(t),iterator:u,forward:function(){return re(c,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:t=this.backward?a:i,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[s])]:[3,3];case 2:return n=e.sent(),$v(this.condition,n)?[2,zv(n)]:[3,1];case 3:return[2,null]}})})},backward:function(){return re(c,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:t=this.backward?i:a,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[s])]:[3,3];case 2:return n=e.sent(),$v(this.condition,n)?[2,zv(n)]:[3,1];case 3:return[2,null]}})})},complete:e});u(e)})];case 5:return[2,e.sent()]}})})},mm),hm=(vm.prototype.fetch=function(a){return void 0===a&&(a={}),re(this,void 0,void 0,function(){var n,r,s,t,i=this;return se(this,function(e){switch(e.label){case 0:if(n=Math.max(a.offset||0,0),0===(r="number"==typeof a.limit?a.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(r<0)throw A.collectionQueryNotValid;e.label=1;case 1:return e.trys.push([1,4,,5]),s=[],[4,this._mutex.lock()];case 2:return e.sent(),[4,this._iterator.each(function(t){return re(i,void 0,void 0,function(){return se(this,function(e){return!t.error&&t.hasNext?0===n?(s.push(t.nextValue),0<r&&r<=s.length?t.stop():t.next()):(n--,t.next()):t.stop(),[2]})})})];case 3:return e.sent(),this._mutex.unlock(),[2,s];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[2]}})})},vm.prototype.count=function(){return re(this,void 0,void 0,function(){var n,t,r=this;return se(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),n=0,[4,this._mutex.lock()];case 1:return e.sent(),[4,this._iterator.each(function(t){return re(r,void 0,void 0,function(){return se(this,function(e){return!t.error&&t.hasNext?(n++,t.next()):t.stop(),[2]})})})];case 2:return e.sent(),this._mutex.unlock(),[2,n];case 3:throw t=e.sent(),this._mutex.unlock(),t;case 4:return[2]}})})},vm),dm=function(e){return"".concat("nest","@").concat(e)},pm=function(e,t){return"".concat(dm(e),"/").concat(t)},fm=(_m.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(0<n){for(var r=Math.ceil(e.data.length/n),r="".concat(r,".").concat(e.type,".").concat(t),s=[],i=0;i<e.data.length;i+=n){var a=e.data.slice(i,i+n);s.push(a)}return{blobId:r,shards:s}}return{blobId:null,shards:null}},_m.prototype._encode=function(n){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){var t=new FileReader;t.onload=function(){e({data:t.result,type:n.type})},t.readAsDataURL(n)})];case 1:return[2,e.sent()]}})})},_m.prototype._decode=function(o){return re(this,void 0,void 0,function(){var t,n,r,s,i,a;return se(this,function(e){switch(e.label){case 0:return"undefined"==typeof fetch?[3,3]:[4,fetch(o.data)];case 1:return[4,e.sent().blob()];case 2:return[2,e.sent()];case 3:for(t=[],n=atob(o.data.split(",")[1]),r=0;r<n.length;r+=512){for(s=n.slice(r,r+512),i=new Array(s.length),a=0;a<s.length;a++)i[a]=s.charCodeAt(a);t.push(new Uint8Array(i))}return[2,new Blob(t,{type:o.type})]}})})},_m.prototype.get=function(a){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:if(t=[],n=Sn(a.split("."),2),r=n[0],n=n[1],!(0<(r=parseInt(r))))return[3,6];s=0,e.label=1;case 1:return s<r?(i=im(this.dbname,this.collectionName,a,s),[4,this._store.get(i)]):[3,4];case 2:if(!(i=e.sent())||!i.d)throw A.storeBrokenBlob;t.push(i.d),e.label=3;case 3:return s++,[3,1];case 4:return[4,this._decode({data:t.join(""),type:n})];case 5:return[2,e.sent()];case 6:return[2,null]}})})},_m.prototype.save=function(o,c){return void 0===c&&(c="".concat(Date.now())),re(this,void 0,void 0,function(){var t,n,r,s,i,a;return se(this,function(e){switch(e.label){case 0:return t=[],[4,this._encode(o)];case 1:if(n=e.sent(),n=this._makeShards(n,c),r=n.blobId,s=n.shards,!r)return[3,3];for(i=0;i<s.length;i++)a=im(this.dbname,this.collectionName,r,i),t.push({key:a,value:{d:s[i]},generation:1});return[4,this._store.setMany(t)];case 2:if(e.sent().some(function(e){return e instanceof Error}))throw A.storeWriteFailed;return[2,r];case 3:return[2,null]}})})},_m.prototype.remove=function(i){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:if(t=[],n=Sn(i.split("."),1),n=n[0],!(0<(r=parseInt(n))))return[3,2];for(s=0;s<r;s++)t.push(im(this.dbname,this.collectionName,i,s));return[4,this._store.removeMany(t)];case 1:e.sent(),e.label=2;case 2:return[2]}})})},_m.prototype.clear=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c;return se(this,function(e){switch(e.label){case 0:return t=sm(this.dbname,this.collectionName),n=[],[4,this._store.getAllKeys()];case 1:r=e.sent();try{for(s=ie(r),i=s.next();!i.done;i=s.next())(a=i.value).startsWith(t)&&n.push(a)}catch(e){o={error:e}}finally{try{i&&!i.done&&(c=s.return)&&c.call(s)}finally{if(o)throw o.error}}return[4,this._store.removeMany(r)];case 2:return e.sent(),[2]}})})},_m);function _m(e){var t=e.dbname,n=e.collectionName,e=e.store;this.dbname=t,this.collectionName=n,this._store=e}function vm(e){var t=e.condition,t=void 0===t?{}:t,n=e.backward,n=void 0!==n&&n,r=e.mutex,s=e.blockManager,e=e.indexer;this._mutex=r,this._iterator=new lm({condition:t,backward:n,blockManager:s,indexer:e})}function mm(e){var t=e.condition,n=e.backward,n=void 0!==n&&n,r=e.blockManager,e=e.indexer;this.condition=void 0===t?{}:t,this.backward=n,this._blockManager=r,this._indexer=e}function gm(e){var t=e.initialPrevValue,n=e.initialNextValue,n=void 0===n?null:n,r=e.iterator,s=e.map,s=void 0===s?Zv:s,i=e.backward,i=void 0===i?Jv:i,a=e.forward,a=void 0===a?Jv:a,e=e.complete,e=void 0===e?Xv:e;this._prevValue=void 0===t?null:t,this._nextValue=n,this._error=null,this._map=s,this._backward=i,this._forward=a,this._iterator=r,this._complete=e}(C=am=am||{})[C.COMMIT=0]="COMMIT",C[C.WRITE=1]="WRITE",C[C.ERROR=2]="ERROR",(w=om=om||{}).PENDING="pending",w.PERSISTENT="persistent",w.VOLATILE="volatile",(C=cm=cm||{})[C.NO_CACHE=0]="NO_CACHE",C[C.DEFAULT=1]="DEFAULT",C[C.PERSISTENT=2]="PERSISTENT";var ym=[om.PENDING,om.VOLATILE],Em={},Im=(Dm.get=function(e){return Em[e]},Object.defineProperty(Dm.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),Dm.prototype.find=function(r,s,i){return void 0===i&&(i=cm.DEFAULT),re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return(t=this.get(s))?[3,2]:[4,r.get(s)];case 1:return(n=e.sent())&&(t={key:s,value:n,generation:1,state:i===cm.PERSISTENT?om.PERSISTENT:om.VOLATILE},this.put(t)),[3,3];case 2:i===cm.PERSISTENT&&(t.state=om.PERSISTENT),e.label=3;case 3:return[2,t]}})})},Dm.prototype.get=function(e,t){void 0===t&&(t=cm.DEFAULT);var e=this._items.map(function(e){return e.key}).indexOf(e);return-1<e?(e=this._items[e],t===cm.PERSISTENT&&(e.state=om.PERSISTENT),t!==cm.NO_CACHE&&this.put(e),e):null},Dm.prototype.put=function(e){var t,n;if(0<this._limit){var r=this._items.map(function(e){return e.key}).indexOf(e.key);if(-1<r)ym.includes(this._items[r].state)&&ym.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else{this._items.push(e);var s=this._items.filter(function(e){return e.state===om.VOLATILE}).length-this._limit;if(0<s){var i=[];try{for(var a=ie(this._items),o=a.next();!o.done;o=a.next()){var c=o.value;c.state===om.VOLATILE&&0<s?s--:i.push(c)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this._items=i}}}},Dm.prototype.remove=function(e){e=this._items.map(function(e){return e.key}).indexOf(e);-1<e&&this._items.splice(e,1)},Dm.prototype.clearByCondition=function(t){this._items=this._items.filter(function(e){return!t(e)})},Dm.prototype.clear=function(e){this._items=(e=void 0===e?!1:e)?[]:this._items.filter(function(e){return e.state!==om.VOLATILE})},Dm),bm=(Object.defineProperty(Rm.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(Rm.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),Rm.prototype._getReducedRecordset=function(n){return void 0===n&&(n=[]),re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=e.sent()||[]).push.apply(t,Nn([],Sn(n),!1)),[2,this._reduceRecordSet(t)]}})})},Rm.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;0<=r;r--){for(var s=e[r],i=[],a=s.requests.length-1;0<=a;a--){var o=s.requests[a],c=o.data;n[c.key]||(i.unshift(o),n[c.key]=!0)}0<i.length&&(s.requests=i,t.unshift(s))}return t},Rm.prototype._applyRecord=function(u,l){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c;return se(this,function(e){switch(e.label){case 0:t=Im.get(this.dbname),n=l.generation,r=l.requests,s=null,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.setMany(r.map(function(e){return p(p({},e.data),{generation:n})}))];case 2:for(i=e.sent(),a=0;a<r.length;a++)i[a]instanceof Error&&(s=s||i[a],o=r[a].data,t.put(p(p({},o),{generation:n,state:om.PERSISTENT})));return[3,4];case 3:return c=e.sent(),s=c,[3,4];case 4:return s?[3,6]:(c=u.filter(function(e){return e.generation!==n}),[4,this._store.set({key:this.recordsetKey,value:c,generation:n})]);case 5:return e.sent(),this._onWrite.forEach(function(e){e(r.map(function(e){return e.data}))}),[3,7];case 6:this._onError.forEach(function(e){return e(s)}),e.label=7;case 7:return[2]}})})},Rm.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o;return se(this,function(e){switch(e.label){case 0:return[4,(t=this)._store.get(this.metadataKey)];case 1:return t._metadata=e.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:n=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),r=ie(n),s=r.next(),e.label=4;case 4:return s.done?[3,7]:(i=s.value,[4,this._applyRecord(n,i)]);case 5:e.sent(),e.label=6;case 6:return s=r.next(),[3,4];case 7:return[3,10];case 8:return i=e.sent(),a={error:i},[3,10];case 9:try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},Rm.prototype.on=function(e,t,n){switch(e){case am.COMMIT:this._onCommit.set(t,n);break;case am.WRITE:this._onWrite.set(t,n);break;case am.ERROR:this._onError.set(t,n)}},Rm.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t=void 0===t?null:t}),Im.get(this.dbname).put(p({state:om.PENDING,generation:this.generation},e))},Rm.prototype.requestMultipleWrite=function(e,t){void 0===t&&(t=null);var n,r,s=Im.get(this.dbname);try{for(var i=ie(e),a=i.next();!a.done;a=i.next()){var o=a.value;this._requests.push({data:o,options:t}),s.put(p({state:om.PENDING,generation:this.generation},o))}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},Rm.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){return Im.get(this.dbname).clearByCondition(function(e){return e.state===om.PENDING}),this._requests=[],[2]})})},Rm.prototype.commit=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c,u,l,h,d=this;return se(this,function(e){switch(e.label){case 0:if(!(0<(t=this._requests).length))return[3,4];for(n=[],r={},c=t.length-1;0<=c;c--)s=t[c],u=s.data,r[u.key]||(r[u.key]=!0,n.unshift(s));return i={generation:this.generation,requests:n},[4,this._getReducedRecordset([i])];case 1:return a=e.sent(),[4,this._store.set({key:this.recordsetKey,value:a,generation:this.generation})];case 2:return e.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(e.sent(),o=Im.get(this.dbname),c=0;c<n.length;c++)l=n[c],u=l.data,l=l.options,o.put(p(p({},u),{generation:i.generation,state:l&&l.persistent?om.PERSISTENT:om.VOLATILE}));this._requests=[],this._onCommit.forEach(function(e){e(t.map(function(e){return e.data}))}),h=Av.get(this.dbname),setTimeout(function(){try{d._applyRecord(a,i)}catch(t){d._onError.forEach(function(e){return e(t)})}},h.transactionApplyDelay),e.label=4;case 4:return[2]}})})},Rm),Tm=(Om.createFromCacheItem=function(e){return e?new Om(e.value):null},Object.defineProperty(Om.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(Om.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),Om.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},Om.prototype.getItemByKey=function(t){var n=this;return this._items.find(function(e){e=e[n.keyName];return t===e})},Om.prototype.has=function(e){var t=this;return this._items.map(function(e){return e[t.keyName]}).includes(e)},Om.prototype.add=function(e){var t=this,n=this._items.map(function(e){return e[t.keyName]}).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},Om.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},Om.prototype.clear=function(){this._items=[]},Om),Cm=(Object.defineProperty(Am.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),Am.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,s=t,e="".concat(function(e,t,n){t=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||tm)(e,t)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(rm(n,r)).concat(s,".").concat(e);var n,r,s},Am.prototype._findBlock=function(i){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:t=Im.get(this.dbname),n=this.metadata.blockLevel,e.label=1;case 1:return 0<n?(r=this.createBlockId(i,n),[4,t.find(this._store,r)]):[3,4];case 2:if((r=e.sent())&&(s=Tm.createFromCacheItem(r)).getItemByKey(i))return[2,s];e.label=3;case 3:return n--,[3,1];case 4:return[2,null]}})})},Am.prototype.getFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return[2,(t=e.sent())?t.getItemByKey(n):null]}})})},Am.prototype.putToBlock=function(s,i){return re(this,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return n=Av.get(this.dbname),t=this.createBlockId(s),n=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,Im.get(this.dbname).find(this._store,t)];case 1:return r=e.sent(),(r=r?Tm.createFromCacheItem(r):new Tm({blockId:t,keyName:this.keyName,items:[],limit:n})).add(i)?(this._transaction.requestWrite({key:r.blockId,value:r.serialize()}),[2,!0]):[2,!1]}})})},Am.prototype.removeFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return(t=e.sent())&&t.remove(n)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}})})},Am.prototype.clearAllBlocks=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c;return se(this,function(e){switch(e.label){case 0:return t=rm(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return n=e.sent(),n=n.filter(function(e){return e.startsWith(t)}),[4,this._store.removeMany(n)];case 2:e.sent(),r=Im.get(this.dbname);try{for(s=ie(n),i=s.next();!i.done;i=s.next())a=i.value,r.remove(a)}catch(e){o={error:e}}finally{try{i&&!i.done&&(c=s.return)&&c.call(s)}finally{if(o)throw o.error}}return[2]}})})},Am),wm=(Nm.createKey=function(e){return e.join(">")},Nm.parseKey=function(e){return e.split(">")},Nm.prototype._addItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),n=Sn(this.indexOf(e),2),r=n[0];return n[1]?!this._table[r].keys.includes(t)&&(this._table[r].keys.push(t),!0):(this._table.splice(r,0,{columnValues:e,keys:[t]}),!0)},Nm.prototype._removeItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),e=Sn(this.indexOf(e),2),n=e[0];if(e[1]){e=this._table[n].keys.indexOf(t);if(-1<e)return this._table[n].keys.splice(e,1),0===this._table[n].keys.length&&this._table.splice(n,1),!0}return!1},Object.defineProperty(Nm.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(Nm.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),Nm.prototype.getColumnValues=function(e){var t,n,r=[];try{for(var s=ie(this.fields),i=s.next();!i.done;i=s.next()){var a,o=i.value,c=e[o="-"===o[0]?o.slice(1):o];if(a=typeof c,null!==c&&"undefined"!=a&&"boolean"!=a&&"number"!=a&&"string"!=a)throw A.indexTypesNotMatch;r.push(e[o])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return r},Nm.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,n=Wv(e[n],t[n]);if(0!==n)return r*n}return 0},Nm.prototype.indexOf=function(e){if(0<this._table.length){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),s=this.diff(e,this._table[r].columnValues);if(0<s)t=r+1;else{if(!(s<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},Nm.prototype.ensure=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c,u,l,h,d,p,f,_;return se(this,function(e){switch(e.label){case 0:return[4,(t=Im.get(this.dbname)).find(this._store,this.indexerKey,cm.PERSISTENT)];case 1:return(n=e.sent())?[3,11]:(r=rm(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:s=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),i=ie(s),a=i.next(),e.label=4;case 4:return a.done?[3,7]:(o=a.value).startsWith(r)?[4,t.find(this._store,o,cm.NO_CACHE)]:[3,6];case 5:o=e.sent(),h=Tm.createFromCacheItem(o);try{for(f=void 0,c=ie(h.items),u=c.next();!u.done;u=c.next())l=u.value,this._addItem(l)}catch(e){f={error:e}}finally{try{u&&!u.done&&(_=c.return)&&_.call(c)}finally{if(f)throw f.error}}e.label=6;case 6:return a=i.next(),[3,4];case 7:return[3,10];case 8:return h=e.sent(),d={error:h},[3,10];case 9:try{a&&!a.done&&(p=i.return)&&p.call(i)}finally{if(d)throw d.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=n.value,this._table=zv(this._origin),e.label=12;case 12:return[2]}})})},Nm.prototype.drop=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return Im.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}})})},Nm.prototype.addItem=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return this._addItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},Nm.prototype.removeItem=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return this._removeItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},Nm.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},Nm.prototype.commit=function(){this._origin=this._table,this._table=zv(this._origin)},Nm.prototype.abort=function(){this._table=zv(this._origin)},Nm),Sm="undefined"!=typeof document&&"undefined"!=typeof navigator;function Nm(e){var t=e.dbname,n=e.collectionName,r=e.keyName,s=e.fields,i=e.transaction,e=e.store,a=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=s,this.indexerKey=(t=this.dbname,n=this.collectionName,r=this.fields.join(">"),"".concat(pm(t,n),"/index.").concat(r)),this._transaction=i,this._store=e,this._transaction.on(am.COMMIT,this.indexerKey,function(){return a.commit()}),this._transaction.on(am.ERROR,this.indexerKey,function(){return a.abort()})}function Am(e){var t=e.dbname,n=e.collectionName,r=e.metadata,s=e.hashFunction,s=void 0===s?tm:s,i=e.transaction,e=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=s,this.metadata=r,this._transaction=i,this._store=e}function Om(e){var t=e.blockId,n=e.keyName,r=e.items,r=void 0===r?[]:r,e=e.limit;this.blockId=t,this.keyName=n,this.limit=e,this._items=Nn([],Sn(r),!1)}function Rm(e){var t=e.dbname,n=e.collectionName,e=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey="".concat(pm(t,n),"/trans.metadata"),this.recordsetKey="".concat(pm(t,n),"/trans.recordset"),this._store=e}function Dm(e){var t=e.dbname,e=e.limit,e=void 0===e?256:e;return Em[t]||(this.dbname=t,this._items=[],this._limit=e,Em[t]=this),Em[t]}Sm&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var Mm=Sm&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");Sm&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),Sm&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),Sm&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");function km(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}var Lm,Um,Pm=Sm&&navigator.userAgent&&navigator.userAgent.includes("Edge/");(w=Lm=Lm||{})[w.PROCESSING=0]="PROCESSING",w[w.DONE=1]="DONE",(C=Um=Um||{}).NEWNODE="newnode",C.REMOVENODE="removenode",C.CLAIM_HOST="claimhost",C.SYNC_HOST="synchost",C.REQUEST_LOCK="requestlock",C.ACQUIRE_LOCK="acquirelock",C.RELEASE_LOCK="releaselock";var xm,qm={},Fm=(Object.defineProperty(Xm.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(Xm.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(Xm.prototype,"isInSync",{get:function(){return this._state==Lm.DONE},enumerable:!1,configurable:!0}),Xm.prototype._send=function(e,t){var n,e={nodeId:this.nodeId,requestId:null!=(n=null==(t=void 0===t?{}:t)?void 0:t.requestId)?n:km(),key:this.key,op:e,data:null!=(n=t.data)?n:null,ts:Date.now()};return Sm&&window.postMessage(e,"*"),e},Xm.prototype._acquire=function(e){(e=void 0===e?null:e)?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null},Xm.prototype._release=function(t){var e,n;this._currentItem&&this._currentItem.requestId===t&&(e=this._currentItem,this._currentItem=null,e.nodeId===this.nodeId&&this._send(Um.RELEASE_LOCK,{requestId:e.requestId}),-1<(n=this._queue.findIndex(function(e){return e.requestId===t}))&&this._queue.splice(n,1),e.onReleased(t))},Xm.prototype._requestLock=function(s){var i=this;return new Promise(function(t){var e,n={nodeId:s.nodeId,requestId:s.requestId,ts:s.ts,onAcquired:function(e){i.isHost&&i._send(Um.ACQUIRE_LOCK,{requestId:e}),t()},onReleased:function(){i._acquire(i._queue[0])}},r=!1;for(e in i._queue)if(i._queue[e].ts>n.ts){i._queue.splice(parseInt(e),0,n),r=!0;break}r||i._queue.push(n),i._currentItem||i._acquire(i._queue[0])})},Xm.prototype._sendSync=function(){var e;this.isHost&&this._send(Um.SYNC_HOST,{data:{currentItemRequestId:null==(e=this._currentItem)?void 0:e.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},Xm.prototype._waitUntilSyncCompleted=function(){return re(this,void 0,void 0,function(){var t=this;return se(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(e){t._activationQueue.push(e)})]:[2]})})},Xm.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout(function(){e._completeSync()},8))},Xm.prototype._completeSync=function(){this.isInSync||(this._state=Lm.DONE,this._activationQueue.forEach(function(e){return e()}),this._activationQueue=[])},Xm.prototype.registerNode=function(){this._send(Um.NEWNODE),this._waitSync()},Xm.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Um.CLAIM_HOST),this._waitSync()},Xm.prototype.lock=function(){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),t=this._send(Um.REQUEST_LOCK),[4,this._requestLock(t)];case 2:return e.sent(),[2]}})})},Xm.prototype.unlock=function(){var e;this._release(null==(e=this._currentItem)?void 0:e.requestId)},Xm),Hm=(R.metadataOf=function(n,r,s){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return t=nm(n,r),[4,s.get(t)];case 1:return[2,e.sent()]}})})},Object.defineProperty(R.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isReady",{get:function(){return this._state===jv.READY},enumerable:!1,configurable:!0}),R.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c,u,l,h,d,p,f=this;return se(this,function(e){switch(e.label){case 0:return[4,this._mutex.lock()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,9,,10]),t=Av.get(this.dbname),[4,R.metadataOf(this.dbname,this.name,this._store)];case 3:return n=e.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:e.sent(),this._blockManager=new Cm({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=Nn([],Sn(this.indexes),!1),s=[],i=r.map(function(e){return wm.createKey(e)}),a=n?n.indexes.map(function(e){return wm.createKey(e)}):[];try{for(o=ie(a),c=o.next();!c.done;c=o.next())u=c.value,i.includes(u)||s.push(wm.parseKey(u))}catch(e){d={error:e}}finally{try{c&&!c.done&&(p=o.return)&&p.call(o)}finally{if(d)throw d.error}}return(l=[]).push.apply(l,Nn([],Sn(r.map(function(e){e=new wm({dbname:f.dbname,collectionName:f.name,keyName:f.keyName,fields:e,transaction:f._transaction,store:f._store});return f._indexers.push(e),e.ensure()})),!1)),l.push.apply(l,Nn([],Sn(s.map(function(e){return new wm({dbname:f.dbname,collectionName:f.name,keyName:f.keyName,fields:e,transaction:f._transaction,store:f._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return e.sent(),[4,this._transaction.commit()];case 6:return e.sent(),i.sort().join(",")===a.sort().join(",")?[3,8]:(l=nm(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:l,value:this._metadata,generation:1})]);case 7:e.sent(),e.label=8;case 8:return this._state=jv.READY,this._mutex.unlock(),[3,10];case 9:throw h=e.sent(),this._mutex.unlock(),h;case 10:return[2]}})})},R.prototype.close=function(){this._state=jv.CLOSED},R.prototype._hasPropertyOfKeyName=function(e){e=e[this.keyName];return"string"==typeof e&&!!e},R.prototype._getIndexerBy=function(e){e=(e=void 0===e?null:e)||[this.keyName];var t,n,r=wm.createKey(e);try{for(var s=ie(this._indexers),i=s.next();!i.done;i=s.next()){var a=i.value;if(r===wm.createKey(a.fields))return a}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return null},R.prototype._upgradeBlockLevel=function(){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return t=nm(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:t,value:this._metadata,generation:1})];case 1:return e.sent(),[2]}})})},R.prototype._requestInsert=function(a){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:return t=a[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return e.sent()?[3,13]:[4,this._blockManager.putToBlock(t,a)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,a)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),n=ie(this._indexers),r=n.next(),e.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(a)];case 7:e.sent(),e.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return s=e.sent(),s={error:s},[3,12];case 11:try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(s)throw s.error}return[7];case 12:return[3,14];case 13:throw A.collectionInsertDuplicate;case 14:return[2]}})})},R.prototype._requestUpsert=function(d){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c,u,l,h;return se(this,function(e){switch(e.label){case 0:return t=d[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[3,13]:[4,this._blockManager.putToBlock(t,d)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,d)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),r=ie(this._indexers),s=r.next(),e.label=6;case 6:return s.done?[3,9]:[4,(o=s.value).addItem(d)];case 7:e.sent(),e.label=8;case 8:return s=r.next(),[3,6];case 9:return[3,12];case 10:return c=e.sent(),c={error:c},[3,12];case 11:try{s&&!s.done&&(u=r.return)&&u.call(r)}finally{if(c)throw c.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,d)];case 14:e.sent(),e.label=15;case 15:e.trys.push([15,21,22,23]),i=ie(this._indexers),a=i.next(),e.label=16;case 16:return a.done?[3,20]:0===(o=a.value).diff(o.getColumnValues(n),o.getColumnValues(d))?[3,19]:[4,o.removeItem(n)];case 17:return e.sent(),[4,o.addItem(d)];case 18:e.sent(),e.label=19;case 19:return a=i.next(),[3,16];case 20:return[3,23];case 21:return l=e.sent(),l={error:l},[3,23];case 22:try{a&&!a.done&&(h=i.return)&&h.call(i)}finally{if(l)throw l.error}return[7];case 23:return[2]}})})},R.prototype._requestUpdate=function(c){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o;return se(this,function(e){switch(e.label){case 0:return t=c[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[4,this._blockManager.putToBlock(t,c)]:[3,11];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,9,10,11]),r=ie(this._indexers),s=r.next(),e.label=4;case 4:return s.done?[3,8]:0===(i=s.value).diff(i.getColumnValues(n),i.getColumnValues(c))?[3,7]:[4,i.removeItem(n)];case 5:return e.sent(),[4,i.addItem(c)];case 6:e.sent(),e.label=7;case 7:return s=r.next(),[3,4];case 8:return[3,11];case 9:return a=e.sent(),a={error:a},[3,11];case 10:try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 11:return[2]}})})},R.prototype._requestRemove=function(a){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:return[4,this._blockManager.getFromBlock(a)];case 1:return(t=e.sent())?[4,this._blockManager.removeFromBlock(a)]:[3,10];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),n=ie(this._indexers),r=n.next(),e.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:e.sent(),e.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return s=e.sent(),s={error:s},[3,10];case 9:try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(s)throw s.error}return[7];case 10:return[2]}})})},R.prototype._requestClear=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:e.sent(),e.label=2;case 2:e.trys.push([2,7,8,9]),t=ie(this._indexers),n=t.next(),e.label=3;case 3:return n.done?[3,6]:[4,n.value.clear()];case 4:e.sent(),e.label=5;case 5:return n=t.next(),[3,3];case 6:return[3,9];case 7:return r=e.sent(),r={error:r},[3,9];case 8:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(r)throw r.error}return[7];case 9:return[2]}})})},R.prototype.getByKey=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(n)];case 3:return t=e.sent(),this._mutex.unlock(),[2,zv(t)];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[3,7];case 6:throw A.collectionNotReady;case 7:return[2]}})})},R.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new hm({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},R.prototype.insertOne=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestInsert(zv(n))];throw A.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},R.prototype.insertMany=function(c){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o=this;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),c.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw A.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=ie(c),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(zv(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),i={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,c];case 12:return s=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw A.collectionNotReady;case 16:return[2]}})})},R.prototype.upsertOne=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpsert(zv(n))];throw A.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},R.prototype.upsertMany=function(c){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o=this;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),c.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw A.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=ie(c),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(zv(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),i={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,c];case 12:return s=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw A.collectionNotReady;case 16:return[2]}})})},R.prototype.update=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpdate(zv(n))];throw A.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},R.prototype.updateIf=function(h,d){return re(this,void 0,void 0,function(){var s,i,t,n,r,a,o,c,u,l=this;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,15]),a=h.where,s=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,r=h.backward,r=void 0!==r&&r,i=[],[4,new lm({condition:s,blockManager:this._blockManager,backward:r,indexer:this._getIndexerBy(a)}).each(function(r){return re(l,void 0,void 0,function(){var t,n;return se(this,function(e){if(r.error)throw r.stop(),r.error;if(r.hasNext){if(t=r.nextValue,$v(s,t)&&d.set){if("function"!=typeof d.set)for(n in d.set)t[n]=d.set[n];else d.set(t);i.push(t)}r.next()}else r.stop();return[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=ie(i),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(r=n.value,[4,this._requestUpdate(zv(r))]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),c={error:a},[3,11];case 10:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(c)throw c.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,i];case 13:return o=e.sent(),[4,this._transaction.clear()];case 14:throw e.sent(),this._mutex.unlock(),o;case 15:return[3,17];case 16:throw this._transaction.clear(),A.collectionNotReady;case 17:return[2]}})})},R.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestRemove(n)];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},R.prototype.removeIf=function(h){return re(this,void 0,void 0,function(){var r,s,t,n,i,a,o,c,u,l=this;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,14]),a=h.where,r=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,i=h.backward,i=void 0!==i&&i,s=[],[4,new lm({condition:r,blockManager:this._blockManager,backward:i,indexer:this._getIndexerBy(a)}).each(function(n){return re(l,void 0,void 0,function(){var t;return se(this,function(e){if(n.error)throw n.stop(),n.error;return n.hasNext?(t=n.nextValue,$v(r,t)&&(t=t[this.keyName],s.push(t)),n.next()):n.stop(),[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=ie(s),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(i=n.value,[4,this._requestRemove(i)]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),c={error:a},[3,11];case 10:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(c)throw c.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,s];case 13:throw o=e.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw this._transaction.clear(),A.collectionNotReady;case 16:return[2]}})})},R.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw A.collectionNotReady;case 9:return[2]}})})},R.prototype.getBlob=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(t)];case 1:return[2,e.sent()]}})})},R.prototype.saveBlob=function(t,n){return void 0===n&&(n=null),re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.save(t,n)];case 1:return[2,e.sent()]}})})},R.prototype.removeBlob=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(t)];case 1:return e.sent(),[2]}})})},R.prototype.removeAllBlobs=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}})})},R),Gm={},Vm=(Object.defineProperty($m.prototype,"rawData",{get:function(){return Gm[this.dbname]},set:function(e){Gm[this.dbname]=e},enumerable:!1,configurable:!0}),$m.prototype.observe=function(t,e,n){var r=this;this.observer[t]={},e.forEach(function(e){return r.observer[t][e]=n})},$m.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:this.dbname=n,Gm[this.dbname]={},e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get(Vn.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify(Vn.value))throw A.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(Vn)];case 4:return e.sent(),[7];case 5:return[2]}})})},$m.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,Object.keys(Gm[this.dbname]).filter(function(e){return e!==Vn.key})]})})},$m.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,Yv(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.get?t.get(n):null)throw t;return[2,Gm[this.dbname][n]?this._encryption.decrypt(Gm[this.dbname][n]):null]}})})},$m.prototype.set=function(s){return re(this,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return[4,Yv(this.delay)];case 1:if(e.sent(),t=s.key,r=s.value,n=this.observer[t],n=n&&n.set?n.set(t):null)throw n;if(n=this._encryption.encrypt(r),r=JSON.stringify(n),t===Vn.key||r.length<this.itemSizeLimit)return Gm[this.dbname][t]=n,[2,Gm[this.dbname][t]];throw A.storeItemSizeExceeded}})})},$m.prototype.setMany=function(t){return re(this,void 0,void 0,function(){var s,i=this;return se(this,function(e){switch(e.label){case 0:return[4,Yv(this.delay)];case 1:return e.sent(),s=[],t.forEach(function(e){var t,n=e.key,e=e.value,r=i.observer[n];r&&r.set&&r.set(n)?s.push(A.collectionWriteFailed):(r=i._encryption.encrypt(e),t=JSON.stringify(r),n===Vn.key||t.length<i.itemSizeLimit?(Gm[i.dbname][n]=r,s.push(e)):s.push(A.storeItemSizeExceeded))}),[2,s]}})})},$m.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,Yv(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.remove?t.remove(n):null)throw t;return Gm[this.dbname][n]&&delete Gm[this.dbname][n],[2,n]}})})},$m.prototype.removeMany=function(c){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o;return se(this,function(e){switch(e.label){case 0:return[4,Yv(this.delay)];case 1:e.sent();try{for(t=ie(c),n=t.next();!n.done;n=t.next()){if(r=n.value,s=this.observer[r],i=s&&s.remove?s.remove(r):null)throw i;Gm[this.dbname][r]&&delete Gm[this.dbname][r]}}catch(e){a={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}}return[2,c]}})})},$m.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,Yv(this.delay)];case 1:return e.sent(),Gm[this.dbname]={},[2]}})})},$m),Bm=(Ym.prototype.init=function(s){return re(this,void 0,void 0,function(){var t,n,r=this;return se(this,function(e){switch(e.label){case 0:return this.dbname=s,[4,new Promise(function(e,t){var n;r._window&&Sm?Mm?((n=r._indexedDB.open("_testMozilla")).onerror=function(){return t(A.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}):Pm?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(A.storeNotAvailableInPrivateBrowsing):e():t(A.storeNotAvailable)})];case 1:return e.sent(),t=this,[4,new Promise(function(t,n){var e=r._indexedDB.open(s);e.addEventListener("upgradeneeded",function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"})}),e.addEventListener("success",function(e){return t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 2:t._database=e.sent(),e.label=3;case 3:return e.trys.push([3,,5,7]),[4,this.get(Vn.key)];case 4:if((n=e.sent())&&JSON.stringify(n)!==JSON.stringify(Vn.value))throw A.storeEncryptionInvalid;return[3,7];case 5:return[4,this.set(Vn)];case 6:return e.sent(),[7];case 7:return[2]}})})},Ym.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var r=this;return se(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").getAllKeys();e.addEventListener("success",function(e){t(e.target.result.filter(function(e){return e!==Vn.key}))}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},Ym.prototype.get=function(s){return re(this,void 0,void 0,function(){var r=this;return se(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").get(s);e.addEventListener("success",function(e){return t(e.target.result?r._encryption.decrypt(e.target.result.value):null)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},Ym.prototype.set=function(t){return re(this,void 0,void 0,function(){var r,s,i=this;return se(this,function(e){switch(e.label){case 0:return r=t.key,s=t.value,[4,new Promise(function(t,n){var e=i._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").put({key:r,value:i._encryption.encrypt(s)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return e.sent(),[2,s]}})})},Ym.prototype.setMany=function(n){return re(this,void 0,void 0,function(){var t,s,i=this;return se(this,function(e){switch(e.label){case 0:return t=[],s=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),n.forEach(function(e){var n=e.key,r=e.value;t.push(new Promise(function(t){var e=s.put({key:n,value:i._encryption.encrypt(r)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(){t(A.collectionWriteFailed)})}))}),[4,Promise.all(t)];case 1:return e.sent(),[2,n.map(function(e){return e.value})]}})})},Ym.prototype.remove=function(s){return re(this,void 0,void 0,function(){var r=this;return se(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").delete(s);n.addEventListener("success",function(){return e(s)}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},Ym.prototype.removeMany=function(t){return re(this,void 0,void 0,function(){var s;return se(this,function(e){switch(e.label){case 0:return s=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),[4,Promise.all(t.map(function(r){return new Promise(function(e,t){var n=s.delete(r);n.addEventListener("success",function(){return e(r)}),n.addEventListener("error",function(e){return t(e.target.error)})})}))];case 1:return[2,e.sent()]}})})},Ym.prototype.clear=function(){return re(this,void 0,void 0,function(){var r=this;return se(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").clear();n.addEventListener("success",function(){return e()}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},Ym),Qm=(Wm.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},Wm.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},Wm.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:this.dbname=n,e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get(Vn.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify(Vn.value))throw A.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set(Vn)];case 4:return e.sent(),[7];case 5:return[2]}})})},Wm.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var t,n=this;return se(this,function(e){switch(e.label){case 0:return t=this._getActualKey(Vn.key),[4,this._asyncStorage.getAllKeys()];case 1:return[2,e.sent().filter(function(e){return n._isBelonging(e)&&e!==t}).map(function(e){return e.substring("".concat(n.dbname,"/").length)})]}})})},Wm.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(n))];case 1:return[2,(t=e.sent())?this._encryption.decrypt(JSON.parse(t)):null]}})})},Wm.prototype.set=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=r.key,n=r.value,n=JSON.stringify(this._encryption.encrypt(n)),t===Vn.key||n.length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),n)]:[3,2];case 1:return e.sent(),[2,JSON.parse(n)];case 2:throw A.storeItemSizeExceeded}})})},Wm.prototype.setMany=function(h){return re(this,void 0,void 0,function(){var t,n,r,s,i,a,o,c,u,l;return se(this,function(e){switch(e.label){case 0:t=[],n=[];try{for(r=ie(h),s=r.next();!s.done;s=r.next()){i=s.value;try{a=i.key,o=i.value,c=JSON.stringify(this._encryption.encrypt(o)),a===Vn.key||c.length<this.itemSizeLimit?(n.push([this._getActualKey(a),c]),t.push(o)):t.push(A.storeItemSizeExceeded)}catch(e){t.push(A.collectionWriteFailed)}}}catch(e){u={error:e}}finally{try{s&&!s.done&&(l=r.return)&&l.call(r)}finally{if(u)throw u.error}}e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._asyncStorage.multiSet(n)];case 2:return e.sent(),[3,4];case 3:return e.sent(),[2,new Array(t.length).fill(A.collectionWriteFailed)];case 4:return[2,t]}})})},Wm.prototype.remove=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.removeItem(this._getActualKey(t))];case 1:return e.sent(),[2,t]}})})},Wm.prototype.removeMany=function(n){return re(this,void 0,void 0,function(){var t=this;return se(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.multiRemove(n.map(function(e){return t._getActualKey(e)}))];case 1:return e.sent(),[2,n]}})})},Wm.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,this.getAllKeys()];case 1:return t=e.sent(),[4,this.removeMany(t)];case 2:return e.sent(),[4,this.remove(Vn.key)];case 3:return e.sent(),[2]}})})},Wm),jm=!0,Km=(zm.off=function(){jm=!1},zm.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];jm&&console.log.apply(console,Nn(["".concat("[NESTDB]","[LOG]")],Sn(e),!1))},zm.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];jm&&console.warn.apply(console,Nn(["".concat("[NESTDB]","[WARNING]")],Sn(e),!1))},zm.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];jm&&console.error.apply(console,Nn(["".concat("[NESTDB]","[ERROR]")],Sn(e),!1))},zm);function zm(){}function Wm(e){var t=e.AsyncStorage,e=e.encryption,e=void 0===e?Bn:e;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=e}function Ym(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;e=e.encryption,e=void 0===e?Bn:e;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=e}function $m(e){var t=(e=void 0===e?{}:e).itemSizeLimit,t=void 0===t?4194304:t,n=e.delay,n=void 0===n?1:n,e=e.encryption,e=void 0===e?Bn:e;this._encryption=e,this.itemSizeLimit=t,this.delay=n,this.observer={}}function R(e){var t=e.dbname,n=e.collectionName,r=e.keyName,s=e.keyHash,i=e.indexes,e=e.store,a=this;this._state=jv.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=Nn([[r]],Sn(i.filter(function(e){return wm.createKey(e)!==a.keyName})),!1),this._keyHash=s,this._store=e,this._mutex=new Fm("".concat(pm(t,n),".lock")),this._blobContainer=new fm({dbname:t,collectionName:n,store:e}),this._transaction=new bm({dbname:t,collectionName:n,store:e})}function Xm(e,t){void 0===t&&(t={});var p=this;return this._state=Lm.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],qm[e]&&!t.forceCreate||(this.nodeId=km(),this.key=e,Sm&&(!t.startAsInvisible&&"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&p.claimHost()}),window.addEventListener("message",function(e){var t,n,r=e.data,s=r.nodeId,i=r.requestId,a=r.key,o=r.op,c=r.data;if(s!==p.nodeId&&a===p.key)switch(o){case Um.NEWNODE:p._sendSync();break;case Um.CLAIM_HOST:p._sendSync(),p._hostId=s;break;case Um.SYNC_HOST:if(!p.isInSync){p._activationTimeout&&clearTimeout(p._activationTimeout);var u=c.currentItemRequestId,l=c.queue;try{for(var h=ie(l),d=h.next();!d.done;d=h.next())!function(t){p._queue.findIndex(function(e){return e.requestId===t.requestId})<0&&p._requestLock({nodeId:t.nodeId,requestId:t.requestId,key:p.key,op:Um.REQUEST_LOCK,ts:t.ts})}(d.value)}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}p._currentItem=p._queue.find(function(e){return e.requestId===u}),p._completeSync()}break;case Um.REMOVENODE:p._queue=p._queue.filter(function(e){return e.nodeId!==r.nodeId}),p._currentItem&&p._currentItem.nodeId===r.nodeId&&(p._currentItem=null,p._acquire(p._queue[0]));break;case Um.REQUEST_LOCK:p._requestLock(r);break;case Um.ACQUIRE_LOCK:l=p._queue.find(function(e){return e.requestId===i});p._acquire(l);break;case Um.RELEASE_LOCK:p._release(i)}}),window.addEventListener("beforeunload",function(){p._send(Um.REMOVENODE)})),qm[e]=this),qm[e]}(w=xm=xm||{}).INIT="INIT",w.OPENING="OPENING",w.OPENED="OPENED",w.CLOSED="CLOSED";Object.defineProperty(ng.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(ng.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),ng.prototype.commitSchema=function(n){return re(this,void 0,void 0,function(){var t=this;return se(this,function(e){switch(e.label){case 0:return this._state!==xm.OPENING?[3,2]:[4,Promise.all(n.map(function(s){return re(t,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return t=s.collectionName,n=s.keyName,r=s.index,r=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new Hm({dbname:this.name,collectionName:t,keyName:n,keyHash:s.keyHash||null,indexes:r,store:this._store})),[4,this._collections.get(t).init()];case 1:return e.sent(),[2]}})})}))];case 1:return e.sent(),[3,3];case 2:throw A.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},ng.prototype.open=function(){var s;return re(this,void 0,void 0,function(){var o,n,c,r,u=this;return se(this,function(e){switch(e.label){case 0:return[4,this._globalMutex.lock()];case 1:if(e.sent(),this._state===xm.OPENED)return[3,15];this._state=xm.OPENING,e.label=2;case 2:return e.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return e.sent(),t=this.name,o="".concat(dm(t),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(o)];case 4:return c=null!=(s=e.sent())?s:n,[2,new Promise(function(r,s){function i(r){c.version<u._version?u._event.upgrade(c.version,function(n){return re(u,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:if(n)return[3,5];c.version++,c.collectionNames=Array.from(this._collections.keys()),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.set({key:o,value:c,generation:this._version})];case 2:return e.sent(),r({continued:!0}),[3,4];case 3:return t=e.sent(),r({continued:!1,err:t}),[3,4];case 4:return[3,6];case 5:r({continued:!1,err:n}),e.label=6;case 6:return[2]}})})}):r({continued:!1})}function a(e){var t,n=e.continued,e=void 0===(e=e.err)?null:e;void 0!==n&&n?setTimeout(function(){return i(a)},10):e?(Km.error(e.message),u._globalMutex.unlock(),u._event.error(e),s(e)):(t=[],c.collectionNames.forEach(function(n){u._collections.has(n)||t.push(re(u,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,Hm.metadataOf(this.name,n,this._store)];case 1:return(t=e.sent())?(t=new Hm({dbname:this.name,collectionName:n,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(n,t),[4,t.init()]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})}))}),Promise.all(t).then(function(){u._state=xm.OPENED,u._globalMutex.unlock(),u._event.success(),r()}).catch(function(e){Km.error(e.message),u._globalMutex.unlock(),u._event.error(e),s(e)}))}i(a)})];case 5:switch((r=e.sent()).code){case N.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case N.STORE_NOT_AVAILABLE:return[3,8];case N.STORE_ENCRYPTION_INVALID:return[3,10]}return[3,13];case 6:return Km.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new Vm({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 7:return e.sent(),[3,14];case 8:return Km.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Vm({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 9:return e.sent(),[3,14];case 10:return Km.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return e.sent(),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 12:return e.sent(),[3,14];case 13:throw Km.error(r.message),this._globalMutex.unlock(),this._event.error(r),r;case 14:return[3,15];case 15:return[2]}var t})})},ng.prototype.close=function(){this._collections.forEach(function(e){return e.close()}),this._state=xm.CLOSED},ng.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return e.sent(),[2]}})})},ng.prototype.reset=function(){return re(this,void 0,void 0,function(){var t,n=this;return se(this,function(e){switch(e.label){case 0:return this.close(),(t=Im.get(this.name))&&t.clearByCondition(function(e){return e.key.startsWith(dm(n.name))}),[4,this._store.clear()];case 1:return e.sent(),[2]}})})},ng.prototype.on=function(e,t){this._event[e]=t},ng.prototype.off=function(e){"function"==typeof this._event[e]&&(this._event[e]="upgrade"===e?em:Xv)},ng.prototype.collection=function(e){return this._collections.get(e)||null};var Jm,Zm=ng,eg=null,tg=(D.init=function(e){var t,n=e.appId,r=e.appVersion,r=void 0===r?null:r,s=e.modules,s=void 0===s?[]:s,i=e.options,i=void 0===i?new Gn:i,a=e.debugMode,a=void 0!==a&&a,o=e.customApiHost,c=e.customWebSocketHost,u=e.newInstance,l=e.logLevel,h=e.localCacheEnabled,h=void 0!==h&&h,d=e.localCacheEncryption,e=e.useAsyncStorageStore,e=void 0===e?null:e;return!eg||void 0!==u&&u?(u="su-".concat(Un()),t=new Vm({encryption:d=null!=d?d:{encrypt:function(e){return e},decrypt:function(e){return e}}}),a||(t=e?new Qm({AsyncStorage:e,encryption:d}):new Bm({encryption:d})),new g(u,{appId:n,appVersion:r,options:i,apiHost:null!=o?o:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=c?c:"wss://ws-".concat(n,".sendbird.com"),store:t,encryption:d,logLevel:l,localCacheEnabled:h,debugMode:a}),e=new D(u,i,Nn(Nn([],Sn(s),!1),[new Tc],!1)),eg=eg||e,e):eg},Object.defineProperty(D,"instance",{get:function(){return eg},enumerable:!1,configurable:!0}),Object.defineProperty(D,"version",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"appId",{get:function(){return g.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"appInfo",{get:function(){return g.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"appVersion",{get:function(){var e;return null!=(e=g.of(this._iid).sdkState.appVersion)?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"debugMode",{get:function(){return g.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"logLevel",{get:function(){return g.of(this._iid).logger.level},set:function(e){g.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"isCacheEnabled",{get:function(){return g.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"ekey",{get:function(){return Br(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"currentUser",{get:function(){var e;return null!=(e=g.of(this._iid).sessionManager.currentUser)?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"connectionState",{get:function(){var e=g.of(this._iid).connectionManager;return e.isConnected?_r.OPEN:e.isConnecting?_r.CONNECTING:_r.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"lastConnectedAt",{get:function(){var e=g.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),D.prototype._getPreferenceCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")},D.prototype._getUserProfileCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")},D.prototype.getMemoryStoreForDebugging=function(){var e=g.of(this._iid),t=e.debugMode,e=e.cacheContext;if(t)return e.store instanceof Vm?e.store:null;throw f.debugModeRequired},D.prototype.addExtension=function(e,t){var n=g.of(this._iid).sdkState;-1<["sb_uikit","sb_syncmanager"].indexOf(e)&&(n.extensions[e]=t)},D.prototype.initializeCache=function(o){return re(this,void 0,void 0,function(){var t,r,s,i,a;return se(this,function(e){switch(e.label){case 0:return s=g.of(this._iid),t=s.sdkState,r=s.cacheContext,i=s.connectionManager,s=s.dispatcher,t.userId&&t.userId===o?[3,6]:[4,i.logout()];case 1:return e.sent(),t.userId=o,r.localCacheEnabled?(i="sendbird@".concat(t.appId,"/").concat(o,".db"),r.nestdb&&r.nestdb.state!==xm.CLOSED&&r.nestdb.name===i?[3,3]:((a=r.nestdb=new Zm({name:"sendbird@".concat(t.appId,"/").concat(o,".db"),version:1,store:r.store})).on("upgrade",(n=a,function(e,t){0===e?n.commitSchema([{collectionName:"GroupChannel",keyName:"url",index:[Ld(kd.LATEST_LAST_MESSAGE),Ld(kd.CHRONOLOGICAL),Ld(kd.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:"Message",keyName:"messageId",index:[qd(Ud.CHANNEL_LATEST),qd(Ud.NEWEST_CHILD_MESSAGE)]},{collectionName:"UnsentMessage",keyName:"reqId",index:[qd(Ud.CHANNEL_LATEST),qd(Ud.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]).then(function(){return t()}).catch(function(e){return t(e)}):t()})),[4,a.open()])):[3,6];case 2:e.sent(),s.dispatch(new op(this._iid,{userId:o})),e.label=3;case 3:return[4,r.preference.init(this._getPreferenceCacheKey(o))];case 4:return e.sent(),[4,r.preference.get(this._getUserProfileCacheKey(o))];case 5:(a=e.sent())&&new qi(this._iid,a).apply(),e.label=6;case 6:return[2]}var n})})},D.prototype.clearCachedData=function(){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return(t=g.of(this._iid).cacheContext).localCacheEnabled?(t.nestdb&&t.nestdb.clear(),[4,t.preference.clear()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},D.prototype.clearCachedMessages=function(t){return re(this,void 0,void 0,function(){var n,r,s=this;return se(this,function(e){switch(e.label){case 0:return v(l("string",t)).throw(f.invalidParameters),n=Kd.of(this._iid),r=Qd.of(this._iid),n&&r?[4,Promise.all(t.map(function(t){return re(s,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,n.removeMessagesOfChannel(t)];case 1:return e.sent(),[4,r.removeMessagesOfChannel(t)];case 2:return e.sent(),[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},D.prototype.connect=function(a,o){return void 0===o&&(o=null),re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:s=g.of(this._iid),t=s.sdkState,n=s.cacheContext,r=s.connectionManager,s=s.statLogCollector,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.initializeCache(a)];case 2:return e.sent(),[3,4];case 3:return e.sent(),i=g.of(this._iid).logger,n.localCacheEnabled=!1,i.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return[4,s.init("sendbird@".concat(t.appId,"/").concat(a,".statlog"))];case 5:return e.sent(),[4,r.connect(o)];case 6:return e.sent(),this._appStateChangeDetector.start(),t.appState="foreground",[4,null==(i=Yd.of(this._iid))?void 0:i.processNonAutoResendRegisteredPendingMessages()];case 7:return e.sent(),this._onlineDetector.start(),[2,this.currentUser]}})})},D.prototype.reconnect=function(){var e=g.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.sessionManager.auth.hasSession;return e&&t.resetAndReconnect().then(function(){n.appState="foreground"}).catch(function(){}),e},D.prototype.disconnect=function(){return re(this,void 0,void 0,function(){var t,n,r;return se(this,function(e){switch(e.label){case 0:return r=g.of(this._iid),t=r.connectionManager,n=r.cacheContext,r=r.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return e.sent(),n.localCacheEnabled?[4,this.clearCachedData()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},D.prototype.setBackgroundState=function(){var e=g.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"foreground"===n.appState&&(n.appState="background",e.debug("going background state"),t.background())},D.prototype.setForegroundState=function(){var e=g.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"background"===n.appState&&(n.appState="foreground",e.debug("going foreground state"),t.resetAndReconnect())},D.prototype.setSessionHandler=function(e){v(!1).throw(f.invalidParameters),g.of(this._iid).sessionManager.handler=e},D.prototype.addUserEventHandler=function(e,t){v(u("string",e)&&!1).throw(f.invalidParameters),g.of(this._iid).userEventHandlers.set(e,t)},D.prototype.removeUserEventHandler=function(e){g.of(this._iid).userEventHandlers.delete(e)},D.prototype.removeAllUserEventHandler=function(){g.of(this._iid).userEventHandlers.clear()},D.prototype.addConnectionHandler=function(e,t){v(u("string",e)&&!1).throw(f.invalidParameters),g.of(this._iid).connectionHandlers.set(e,t)},D.prototype.removeConnectionHandler=function(e){g.of(this._iid).connectionHandlers.delete(e)},D.prototype.removeAllConnectionHandler=function(){g.of(this._iid).connectionHandlers.clear()},D.prototype.createApplicationUserListQuery=function(e){return new Ev(this._iid,e=void 0===e?{}:e)},D.prototype.createBlockedUserListQuery=function(e){return new Tv(this._iid,e=void 0===e?{}:e)},D.prototype.createFriendListQuery=function(e){return new Sv(this._iid,e=void 0===e?{}:e)},D.prototype.createMessageSearchQuery=function(e){return new yc(this._iid,e)},D.prototype.buildUserFromSerializedData=function(e){e=Ai(e);return new m(this._iid,m.payloadify(e))},D.prototype.updateCurrentUserInfo=function(s){return void 0===s&&(s={}),re(this,void 0,void 0,function(){var n,r;return se(this,function(e){switch(e.label){case 0:return s=p(p({},Sp),s),v(kn((t=s).profileImage,!0)&&u("string",t.profileUrl,!0)&&u("string",t.nickname,!0)).throw(f.invalidParameters),this.currentUser?(n=g.of(this._iid),r=n.sdkState,n=n.requestQueue,r=new Op(p({userId:r.userId},s)),[4,n.send(r)]):[3,2];case 1:return n=e.sent(),r=n.as(Rp).user,this.currentUser&&(s.nickname&&(this.currentUser.nickname=r.nickname),(s.profileUrl||s.profileImage)&&(this.currentUser.plainProfileUrl=r.profileUrl)),[2,r];case 2:throw f.connectionRequired}var t})})},D.prototype.updateCurrentUserInfoWithPreferredLanguages=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(l("string",r)).throw(f.invalidParameters),this.currentUser?(t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Op({userId:n.userId,preferredLanguages:r}),[4,t.send(n)]):[3,2];case 1:return t=e.sent(),n=t.as(Rp).user,this.currentUser&&(this.currentUser.preferredLanguages=n.preferredLanguages),[2,n];case 2:throw f.connectionRequired}})})},D.prototype.registerFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:if(v(u("string",r)).throw(f.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Fp({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,ad.SUCCESS];case 3:return e.sent(),[2,ad.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,ad.PENDING];case 6:return[2]}})})},D.prototype.unregisterFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:if(v(u("string",r)).throw(f.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new zp({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,ad.SUCCESS];case 3:return e.sent(),[2,ad.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,ad.PENDING];case 6:return[2]}})})},D.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return this.currentUser?(t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new tf({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},D.prototype.registerAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:if(v(u("string",r)).throw(f.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Dp({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,ad.SUCCESS];case 3:return e.sent(),[2,ad.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,ad.PENDING];case 6:return[2]}})})},D.prototype.unregisterAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:if(v(u("string",r)).throw(f.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Bp({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,ad.SUCCESS];case 3:return e.sent(),[2,ad.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,ad.PENDING];case 6:return[2]}})})},D.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return this.currentUser?(t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Xp({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},D.prototype.getChannelInvitationPreference=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new bf({userId:n.userId}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(Tf).autoAccept}]}})})},D.prototype.setChannelInvitationPreference=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("boolean",r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Cf({userId:n.userId,willAutoAccept:r}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(wf).autoAccept}]}})})},D.prototype.getDoNotDisturb=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Sf({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(Nf).preference]}})})},D.prototype.setDoNotDisturb=function(r,s,i,a,o,c){return void 0===s&&(s=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===c&&(c=""),re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("boolean",r)&&u("number",s)&&u("number",i)&&u("number",a)&&u("number",o)&&u("string",c)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Af({userId:n.userId,doNotDisturbOn:r,startHour:s,startMin:i,endHour:a,endMin:o,timezone:c}),[4,t.send(n)];case 1:return[2,e.sent().as(Of).preference]}})})},D.prototype.getSnoozePeriod=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Rf({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(Df).snoozePeriod]}})})},D.prototype.setSnoozePeriod=function(r,s,i){return void 0===s&&(s=0),void 0===i&&(i=0),re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("boolean",r)&&u("number",s)&&u("number",i)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Mf({userId:n.userId,snoozeOn:r,startTs:s,endTs:i}),[4,t.send(n)];case 1:return[2,e.sent().as(kf).snoozePeriod]}})})},D.prototype.getMyPushTokensByToken=function(r,s){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)&&Hn(cd,s)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Ef({userId:n.userId,type:s,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(If).pushTokens]}})})},D.prototype.getPushTriggerOption=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new up({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(lp).pushTriggerOption]}})})},D.prototype.setPushTriggerOption=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(Hn(od,r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new hp({userId:n.userId,pushTriggerOption:r}),[4,t.send(n)];case 1:return[2,e.sent().as(dp).pushTriggerOption]}})})},D.prototype.getPushTemplate=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new l_({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(h_).name]}})})},D.prototype.setPushTemplate=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(Hn(ud,r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new d_({userId:n.userId,templateName:r}),[4,t.send(n)];case 1:return[2,e.sent().as(p_).name]}})})},D.prototype.blockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(r instanceof m||u("string",r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Lf({userId:n.userId,blockedUserId:r instanceof m?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},D.prototype.blockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this.blockUser(t)]})})},D.prototype.unblockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(r instanceof m||u("string",r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Jf({userId:n.userId,unblockedUserId:r instanceof m?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},D.prototype.unblockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this.unblockUser(t)]})})},D.prototype.getFriendChangeLogsByToken=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new f_({userId:n.userId,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(__).changelogs]}})})},D.prototype.getAllowFriendDiscovery=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new V_({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(B_).allowFriendDiscovery]}})})},D.prototype.setAllowFriendDiscovery=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("boolean",r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Q_({userId:n.userId,allowFriendDiscovery:r}),[4,t.send(n)];case 1:return e.sent(),[2,r]}})})},D.prototype.uploadFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new v_({userId:n.userId,discoveries:r}),[4,t.send(n)];case 1:return[2,e.sent().as(m_).friendDiscoveryRequestId]}})})},D.prototype.deleteFriendDiscovery=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this.deleteFriendDiscoveries([t])]})})},D.prototype.deleteFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(l("string",r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new g_({userId:n.userId,discoveryKeys:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},D.prototype.addFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(l("string",r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new M_({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return[2,e.sent().as(k_).users]}})})},D.prototype.deleteFriend=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this.deleteFriends([t])]})})},D.prototype.deleteFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(l("string",r)).throw(f.invalidParameters),t=g.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new L_({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},D.prototype.getAllEmoji=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new dv,[4,t.send(n)];case 1:return[2,e.sent().as(pv).emojiContainer]}})})},D.prototype.getEmojiCategory=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new fv({categoryId:r}),[4,t.send(n)];case 1:return[2,e.sent().as(_v).emojiCategory]}})})},D.prototype.getEmoji=function(r){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new vv({key:r}),[4,t.send(n)];case 1:return[2,e.sent().as(mv).emoji]}})})},D);function D(a,e,t){var o=this,e=(this._fcmPushToken=null,this._apnsPushToken=null,this._iid=a,this.options=e,g.of(a)),c=e.sdkState,u=e.cacheContext,n=e.dispatcher,r=e.sessionManager,s=e.requestQueue,i=e.logger,l=e.userEventHandlers;this._onlineDetector=new Ap({logger:i,connectionDelegate:{reconnect:function(){var e=g.of(a),t=e.sdkState,e=e.connectionManager;"foreground"===t.appState&&e.resetAndReconnect()},disconnect:function(){g.of(a).connectionManager.disconnect()}}}),new Yd(a,{localCacheEnabled:u.localCacheEnabled,dispatcher:n,sdkState:c,logger:i}),t.forEach(function(e){e.init(a,{sdkState:c,cacheContext:u,dispatcher:n,sessionManager:r,requestQueue:s,logger:i,onlineDetector:o._onlineDetector}),o[e.name]=e}),this._appStateChangeDetector=new Np,this._appStateChangeDetector.on("resume",function(){i.debug("the page resumes from freeze"),o.setForegroundState()}).on("pause",function(){i.debug("the page freezes"),o.setBackgroundState()}),n.on(function(e){var t;if(e instanceof Ir)"USEV"===e.code&&(s=e.as(cp).event).category===Fd.FRIEND_DISCOVERED&&(t=ap.getDataAsFriendDiscoveredEvent(a,s).friendDiscoveries,ae(function(){return re(o,void 0,void 0,function(){return se(this,function(e){return[2,l.forEach(function(e){e.onFriendsDiscovered(t)})]})})}));else if(e instanceof Pr){var n=g.of(o._iid).subscribedUnreadMessageCount,r=!1,s=e.ts;if("number"==typeof s&&s>n.ts){if(n.all!==e.all&&(r=!0),n.all=0<=e.all?e.all:0,e.customTypes)for(var i in e.customTypes)n.customTypes[i]!==e.customTypes[i]&&(r=!0),n.customTypes[i]=e.customTypes[i];r=r&&0<n.ts,n.ts=s}r&&ae(function(){return re(o,void 0,void 0,function(){return se(this,function(e){return[2,l.forEach(function(e){e.onTotalUnreadMessageCountUpdated(n.all,n.customTypes)})]})})})}else e instanceof xi&&u.localCacheEnabled&&u.preference.set(o._getUserProfileCacheKey(c.userId),qi.payloadify(e.userProfile))})}function ng(e){var t=e.name,n=e.version,r=e.store,e=e.config;this.name=t,this._version=n,this._state=xm.INIT,this._config=e||new Av({dbname:t}),this._store=r,this._event={success:Xv,error:Xv,upgrade:em},this._collections=new Map,this._globalMutex=new Fm("".concat(this.name,".lock")),this._config.disableLogger&&Km.off(),new Im({dbname:t,limit:this._config.cacheLimit})}(C=Jm=Jm||{})[C.NONE=0]="NONE",C[C.CHANNEL_ENTER=10102]="CHANNEL_ENTER",C[C.CHANNEL_EXIT=10103]="CHANNEL_EXIT",C[C.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",C[C.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",C[C.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",C[C.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",C[C.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",C[C.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",C[C.TYPING_START=10900]="TYPING_START",C[C.TYPING_END=10901]="TYPING_END",C[C.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",C[C.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",C[C.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",C[C.CHANNEL_INVITE=10020]="CHANNEL_INVITE",C[C.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",C[C.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",C[C.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",C[C.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",C[C.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",C[C.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",C[C.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",C[C.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE";Object.defineProperty(wg.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===jr.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(wg.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===jr.OPEN},enumerable:!1,configurable:!0});var rg,sg,ig,ag,og,cg,ug,lg=wg,hg=(e(Cg,ug=Ir),Cg),dg=(e(Tg,cg=hg),Tg),pg=(e(bg,og=Ir),bg),fg=(e(Ig,ag=Ir),Ig),_g=(e(Eg,ig=Ir),Eg),vg=(e(yg,sg=Ir),yg),mg=(e(gg,rg=Ir),gg);function gg(e,t,n){var r=rg.call(this,e,"MTHD",n)||this;return r.event=new Xo(e,n),r}function yg(e,t,n){e=sg.call(this,e,"MRCT",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.event=new va(n),e}function Eg(e,t,n){var r,s=this,e=((s=ig.call(this,e,"AEDI",n)||this).message=new ja(e,n),g.of(e).sdkState);return s.mentionCountChange=ii({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:s.message.mentionType,mentionedUserIds:null!=(r=s.message.mentionedUserIds)?r:null==(n=s.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),s}function Ig(e,t,n){var r,s=this,e=((s=ag.call(this,e,"ADMM",n)||this).message=new ja(e,n),g.of(e).sdkState);return s.isMentioned=di(s.message.mentionType,null!=(r=s.message.mentionedUserIds)?r:null==(r=s.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),s.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,s}function bg(e,t,n){e=og.call(this,e,"MCNT",n)||this;return e.groupChannelMemberCounts=n.group_channels.map(function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}}),e.openChannelMemberCounts=n.open_channels.map(function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}}),e}function Tg(e,t,n){var r=cg.call(this,e,t,n)||this,e=n.data.operators,t=void 0===e?[]:e;return r.operators=t.map(function(e){return new m(r._iid,e)}),r}function Cg(e,t,n){e=ug.call(this,e,"SYEV",n)||this;return e.event=new lg(n),e}function wg(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}e(Fg,Og=s),Object.defineProperty(Fg.prototype,"enteredChannels",{get:function(){var t=this;return this._enteredChannelUrls.map(function(e){return t._channels.get(e)}).filter(function(e){return null!==e})},enumerable:!1,configurable:!0}),Fg.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},Fg.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},Fg.prototype.exit=function(e){e=this._enteredChannelUrls.indexOf(e);0<=e&&this._enteredChannelUrls.splice(e,1)},Fg.prototype.exitAll=function(){this._enteredChannelUrls=[]},Fg.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return se(this,function(e){return[2,null!=(n=this._channels.get(t))?n:null]})})},Fg.prototype.upsert=function(t){return re(this,void 0,void 0,function(){var n=this;return se(this,function(e){return t.forEach(function(e){var t;n._channels.has(e.url)?(t=n._channels.get(e.url),Object.assign(t,e)):n._channels.set(e.url,e)}),[2]})})},Fg.prototype.remove=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return this._channels.delete(t),this.exit(t),[2]})})},Fg.prototype.clear=function(){return re(this,void 0,void 0,function(){return se(this,function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]})})};var Sg,Ng,Ag,Og,Rg,Dg=Fg,Mg={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},kg=(e(qg,Ag=o),qg),Lg=(e(xg,Ng=_),xg),Ug=(e(Pg,Sg=o),Pg);function Pg(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,s=e.name,i=e.data,a=e.customType,e=e.operatorUserIds;return(t=Sg.call(this)||this).method=I.POST,t.path=Ms,t.params=E({channel_url:n,cover_url:u("string",r)?r:null,cover_file:kn(r)?r:null,name:s,data:i,custom_type:a,operators:e}),t}function xg(e,t){var n=Ng.call(this,e,t)||this;return n.channel=null,n.channel=new Cy(e,t),n}function qg(e){var t=e.channelUrl,e=e.isInternalCall,n=Ag.call(this)||this;return n.method=I.GET,n.path="".concat(e?ks:Ms,"/").concat(encodeURIComponent(t)),n}function Fg(){var e=null!==Og&&Og.apply(this,arguments)||this;return e._channels=new Map,e._enteredChannelUrls=[],e}e(function(e,t){var n=Rg.call(this,e,t)||this;return n.channel=new Cy(e,t),n},Rg=_);e(Ey,Yg=br);var Hg,Gg,Vg,Bg,Qg,jg,Kg,zg,Wg,Yg,$g,Xg=Ey,Jg=(e(yy,Wg=Ir),yy),Zg=(e(gy,zg=br),gy),ey=(e(my,Kg=Ir),my),ty={},ny=(vy.of=function(e){return ty[e]},vy.prototype.buildOpenChannelFromSerializedData=function(e){e=Ai(e);return new Cy(e._iid,Cy.payloadify(e))},vy.prototype.getChannelFromCache=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.get(t)];case 1:return[2,e.sent()]}})})},vy.prototype.upsertChannelsToCache=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.upsert(t)];case 1:return e.sent(),[2]}})})},vy.prototype.removeChannelsFromCache=function(a){return re(this,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,7]),t=ie(a),n=t.next(),e.label=1;case 1:return n.done?[3,4]:(r=n.value,[4,this._openChannelCache.remove(r)]);case 2:e.sent(),e.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=e.sent(),s={error:r},[3,7];case 6:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},vy.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},vy.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},vy.prototype._handleEvent=function(ne){return re(this,void 0,void 0,function(){var a,x,o,t,c,u,q,l,n,r,F,H,i,G,V,h,s,d,p,f,_,v,m,B,Q,g,y,E,j,K,I,b,T,C,w,S,N,z,A,W,O,Y,R,D,M,k,L,U,$,X,J,Z,ee,te,P=this;return se(this,function(e){switch(e.label){case 0:switch(e.trys.push([0,51,,52]),ne.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"SYEV":return[3,27]}return[3,50];case 1:return t=null,"MESG"===ne.code?t=ne.as(Dh):"FILE"===ne.code?t=ne.as(Za):"ADMM"!==ne.code&&"BRDM"!=ne.code||(t=ne.as(fg)),t?(a=t.message,x=t.isMentioned,a.channelType!==jr.OPEN?[3,3]:[4,this.getChannel(a.channelUrl,!0)]):[3,3];case 2:o=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){try{for(t=ie(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(o.url)&&r.onMessageReceived(o,a),x&&r.onMentionReceived(o,a)}catch(e){s={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(s)throw s.error}}return[2]})})}),e.label=3;case 3:return[3,50];case 4:return t=null,"MEDI"===ne.code?t=ne.as(kh):"FEDI"===ne.code?t=ne.as(Uh):"AEDI"===ne.code&&(t=ne.as(_g)),!t||(c=t.message).channelType!==jr.OPEN?[3,6]:[4,this.getChannel(c.channelUrl,!0)];case 5:u=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){try{for(t=ie(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(u.url)&&r.onMessageUpdated(u,c)}catch(e){s={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(s)throw s.error}}return[2]})})}),e.label=6;case 6:return[3,50];case 7:return n=ne.as(ld),p=n.channelUrl,r=n.channelType,q=n.messageId,r!==jr.OPEN?[3,9]:[4,this.getChannel(p,!0)];case 8:l=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,s,i;return se(this,function(e){try{for(t=ie(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(l.url)&&r.onMessageDeleted(l,q)}catch(e){s={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(s)throw s.error}}return[2]})})}),e.label=9;case 9:return[3,50];case 10:return n=ne.as(vg),p=n.channelUrl,r=n.channelType,F=n.event,r!==jr.OPEN?[3,12]:[4,this.getChannel(p,!0)];case 11:H=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){try{for(t=ie(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onReactionUpdated(H,F)}catch(e){r={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=12;case 12:return[3,50];case 13:return(i=ne.as(mg).event).channelType!==jr.OPEN?[3,15]:[4,this.getChannel(i.channelUrl,!0)];case 14:G=e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){try{for(t=ie(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onThreadInfoUpdated(G,i)}catch(e){r={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=15;case 15:return[3,50];case 16:V=ne.as(pg).openChannelMemberCounts,h=[],e.label=17;case 17:e.trys.push([17,22,23,24]),s=ie(V),d=s.next(),e.label=18;case 18:return d.done?[3,21]:(f=d.value,p=f.channelUrl,E=f.participantCount,f=f.updatedAt,[4,this.getChannelFromCache(p)]);case 19:(_=e.sent())&&_._updateParticipantCount(E,f)&&h.push(_),e.label=20;case 20:return d=s.next(),[3,18];case 21:return[3,24];case 22:return _=e.sent(),ee={error:_},[3,24];case 23:try{d&&!d.done&&(te=s.return)&&te.call(s)}finally{if(ee)throw ee.error}return[7];case 24:return 0<h.length?[4,this.upsertChannelsToCache(h)]:[3,26];case 25:e.sent(),ae(function(){return re(P,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){try{for(t=ie(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onChannelMemberCountChanged(h)}catch(e){r={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=26;case 26:return[3,50];case 27:if((v=ne.as(hg).event).isOpenChannelEvent)switch(v.category){case Jm.CHANNEL_ENTER:return[3,28];case Jm.CHANNEL_EXIT:return[3,30];case Jm.CHANNEL_OPERATOR_UPDATE:return[3,32];case Jm.USER_CHANNEL_MUTE:case Jm.USER_CHANNEL_UNMUTE:return[3,34];case Jm.USER_CHANNEL_BAN:case Jm.USER_CHANNEL_UNBAN:return[3,36];case Jm.CHANNEL_FREEZE:case Jm.CHANNEL_UNFREEZE:return[3,38];case Jm.CHANNEL_DELETED:return[3,40];case Jm.CHANNEL_PROP_CHANGED:return[3,43];case Jm.CHANNEL_META_DATA_CHANGED:return[3,45];case Jm.CHANNEL_META_COUNTERS_CHANGED:return[3,47]}return[3,49];case 28:return[4,this.getChannel(v.channelUrl,!0)];case 29:return m=e.sent(),y=ne.as(Jg),E=y.participantCount,B=y.user,Q=m._updateParticipantCount(E,v.ts),ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserEntered(m,B),Q&&e.onChannelParticipantCountChanged(m)}),[2]})})}),[3,49];case 30:return[4,this.getChannel(v.channelUrl,!0)];case 31:return g=e.sent(),y=ne.as(ey),E=y.participantCount,j=y.user,K=g._updateParticipantCount(E,v.ts),ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserExited(g,j),K&&e.onChannelParticipantCountChanged(g)}),[2]})})}),[3,49];case 32:return[4,this.getChannel(v.channelUrl,!0)];case 33:return I=e.sent(),b=ne.as(dg).operators,I.operators=b,this.upsertChannelsToCache([I]),ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onOperatorUpdated(I,b)}),[2]})})}),[3,49];case 34:return[4,this.getChannel(v.channelUrl,!0)];case 35:return T=e.sent(),C=v.category===Jm.USER_CHANNEL_MUTE,w=ne.as(C?Bl:$l).user,ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){C?e.onUserMuted(T,w):e.onUserUnmuted(T,w)}),[2]})})}),[3,49];case 36:return[4,this.getChannel(v.channelUrl,!0)];case 37:return S=e.sent(),N=v.category===Jm.USER_CHANNEL_BAN,z=ne.as(N?rh:lh).user,ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){N?e.onUserBanned(S,z):e.onUserUnbanned(S,z)}),[2]})})}),[3,49];case 38:return[4,this.getChannel(v.channelUrl,!0)];case 39:return A=e.sent(),W=ne.as(Sh).freeze,A.isFrozen=W,this.upsertChannelsToCache([A]),ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){W?e.onChannelFrozen(A):e.onChannelUnfrozen(A)}),[2]})})}),[3,49];case 40:return[4,this.getChannel(v.channelUrl,!0)];case 41:return O=e.sent(),[4,this.removeChannelsFromCache([O.url])];case 42:return e.sent(),ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelDeleted(O.url,O.channelType)}),[2]})})}),[3,49];case 43:return[4,this.getChannelWithoutCache(v.channelUrl,!0)];case 44:return Y=e.sent(),ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelChanged(Y)}),[2]})})}),[3,49];case 45:return[4,this.getChannel(v.channelUrl,!0)];case 46:return R=e.sent(),U=ne.as(el),D=U.created,M=U.updated,k=U.deleted,D&&R._upsertCachedMetaData(D,v.ts),M&&R._upsertCachedMetaData(M,v.ts),k&&R._removeFromCachedMetaData(k,v.ts),ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){D&&e.onMetaDataCreated(R,D),M&&e.onMetaDataUpdated(R,M),k&&e.onMetaDataDeleted(R,k)}),[2]})})}),[3,49];case 47:return[4,this.getChannel(v.channelUrl,!0)];case 48:return L=e.sent(),U=ne.as(hl),$=U.created,X=U.updated,J=U.deleted,ae(function(){return re(P,void 0,void 0,function(){return se(this,function(e){return this._openChannelHandlers.forEach(function(e){$&&e.onMetaCounterCreated(L,$),X&&e.onMetaCounterUpdated(L,X),J&&e.onMetaCounterDeleted(L,J)}),[2]})})}),[3,49];case 49:return[3,50];case 50:return[3,52];case 51:if(Z=e.sent(),Rn(Z))throw Z;return[3,52];case 52:return[2]}})})},vy.prototype.addHandler=function(e,t){this._openChannelHandlers.set(e,t)},vy.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},vy.prototype.clearHandler=function(){this._openChannelHandlers.clear()},vy.prototype.getChannel=function(n,e){return re(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:v(u("string",n)).throw(f.invalidParameters),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.getChannelFromCache(n)];case 2:return(t=e.sent())?[2,t]:[3,4];case 3:return e.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(n)];case 5:return[2,e.sent()]}})})},vy.prototype.getChannelWithoutCache=function(r,s){return void 0===s&&(s=!1),re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return v(u("string",r)).throw(f.invalidParameters),t=new kg({channelUrl:r,isInternalCall:s}),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(Lg).channel,[4,this.upsertChannelsToCache([n])];case 2:return e.sent(),[2,n]}})})},vy.prototype.createChannel=function(s){return re(this,void 0,void 0,function(){var n,r;return se(this,function(e){switch(e.label){case 0:return s=p(p({},Mg),s),v(l("string",(t=s).operatorUserIds,!0)&&(u("string",t.coverUrlOrImage)||kn(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&u("string",t.name,!0)&&u("string",t.data,!0)&&u("string",t.customType,!0)&&(u("string",t.channelUrl)&&/^\w+$/.test(t.channelUrl)||null===t.channelUrl)).throw(f.invalidParameters),n=new Ug(s),[4,this._requestQueue.send(n)];case 1:return n=e.sent(),r=n.as(Lg).channel,this.upsertChannelsToCache([r]),[2,r]}var t})})},vy),ry={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},sy=(e(_y,jg=o),_y),iy=(e(fy,Qg=_),fy),ay=(e(py,Bg=Ec),py.prototype._validate=function(){return Bg.prototype._validate.call(this)},py.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=g.of(this._iid).requestQueue,n=new sy(p(p({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(iy),r=n.participants,s=n.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}})})},py),oy=(e(dy,Vg=o),dy),cy=(e(hy,Gg=_),hy),uy=(e(ly,Hg=o),ly);function ly(e){var t=this,e=e.channelUrl;return(t=Hg.call(this)||this).method=I.DELETE,t.path="".concat(Ms,"/").concat(encodeURIComponent(e)),t}function hy(e,t){var n=Gg.call(this,e,t)||this;return n.channel=new Cy(e,t),n}function dy(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,s=e.name,i=e.data,a=e.customType,e=e.operatorUserIds;return(t=Vg.call(this)||this).method=I.PUT,t.path="".concat(Ms,"/").concat(encodeURIComponent(n)),t.params=E({cover_url:u("string",r)?r:null,cover_file:kn(r)?r:null,name:s,data:i,custom_type:a,operators:e}),t}function py(e,t,n){return Bg.call(this,e,t,jr.OPEN,n)||this}function fy(t,e){var n=Qg.call(this,t,e)||this,r=(n.token=null,n.participants=[],e.next),e=e.participants;return n.token=r,n.participants=e.map(function(e){return new m(t,e)}),n}function _y(e){var t=this,n=e.channelUrl,r=e.token,e=e.limit;return(t=jg.call(this)||this).method=I.GET,t.path="".concat(Ms,"/").concat(encodeURIComponent(n),"/participants"),t.params={token:r,limit:e},t}function vy(e,t){var n=t.sdkState,r=t.dispatcher,t=t.requestQueue,a=this;this._sdkState=n,this._requestQueue=t,this._dispatcher=r,this._openChannelCache=new Dg(e),this._openChannelHandlers=new Map,this._dispatcher.on(function(e){var t,n;if(e instanceof Ir)a._handleEvent(e);else if(e instanceof fs&&e.stateType===Mr.CONNECTED){var r=a._openChannelCache.enteredChannels;try{for(var s=ie(r),i=s.next();!i.done;i=s.next())i.value.enter()}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}}}),ty[e]=this}function my(e,t,n){var r,s=this,s=Kg.call(this,e,"EXIT",n)||this;return n.data&&(s.participantCount=null!=(r=n.data.participant_count)?r:0,s.user=new m(e,n.data),s.ts=null!=(r=n.data.edge_ts)?r:0),s}function gy(e){e=e.channelUrl;return zg.call(this,{code:"EXIT",payload:{channel_url:e},ackRequired:!0})||this}function yy(e,t,n){var r,s=this,s=Wg.call(this,e,"ENTR",n)||this;return n.data&&(s.participantCount=null!=(r=n.data.participant_count)?r:0,s.user=new m(e,n.data),s.ts=null!=(r=n.data.edge_ts)?r:0),s}function Ey(e){e=e.channelUrl;return Yg.call(this,{code:"ENTR",payload:{channel_url:e},ackRequired:!0})||this}e(function(e,t){return $g.call(this,e,t)||this},$g=_);e(wy,Iy=Id),wy.payloadify=function(e){return e?E(p(p({},Id.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map(function(e){return m.payloadify(e)})})):null},wy.prototype.serialize=function(){return Ni(this)},wy.prototype.isOperator=function(t){return t instanceof m?this.isOperator(t.userId):this.operators.some(function(e){return e.userId===t})},wy.prototype._updateParticipantCount=function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)},wy.prototype.createParticipantListQuery=function(e){return new ay(this._iid,this.url,e)},wy.prototype.refresh=function(){return re(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,ny.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}})})},wy.prototype.enter=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new Xg({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Jg),r=n.participantCount,s=n.ts,this._updateParticipantCount(r,s),ny.of(this._iid).setEnteredToCache(this),[2]}})})},wy.prototype.exit=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new Zg({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(ey),r=n.participantCount,s=n.ts,this._updateParticipantCount(r,s),ny.of(this._iid).setExitedToCache(this),Yo.of(this._iid).fileMessageQueue.cancel(this),[2]}})})},wy.prototype.updateChannel=function(i){return re(this,void 0,void 0,function(){var n,r,s;return se(this,function(e){switch(e.label){case 0:return i=p(p({},ry),i),v(l("string",(t=i).operatorUserIds,!0)&&(u("string",t.coverUrlOrImage)||kn(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&u("string",t.name,!0)&&u("string",t.data,!0)&&u("string",t.customType,!0)).throw(f.invalidParameters),r=g.of(this._iid).requestQueue,n=new oy(p({channelUrl:this.url},i)),[4,r.send(n)];case 1:return r=e.sent(),s=r.as(cy).channel,[4,ny.of(this._iid).upsertChannelsToCache([s])];case 2:return e.sent(),[2,s]}var t})})},wy.prototype.updateChannelWithOperatorUserIds=function(n,r,s,i,a){return re(this,void 0,void 0,function(){var t;return se(this,function(e){return t=p(p({},ry),{name:n,coverUrlOrImage:r,data:s,operatorUserIds:i,customType:a}),[2,this.updateChannel(t)]})})},wy.prototype.delete=function(){return re(this,void 0,void 0,function(){var t,n;return se(this,function(e){switch(e.label){case 0:return t=g.of(this._iid).requestQueue,n=new uy({channelUrl:this.url}),[4,t.send(n)];case 1:return e.sent(),[4,ny.of(this._iid).removeChannelsFromCache([this.url])];case 2:return e.sent(),[2]}})})};var Iy,by,Ty,Cy=wy;function wy(t,e){var n,r=this;return(r=Iy.call(this,t,e)||this)._lastParticipantCountUpdated=0,r.participantCount=0,r.operators=[],r.channelType=jr.OPEN,r.participantCount=null!=(n=e.participant_count)?n:0,r.operators=Array.isArray(e.operators)?e.operators.map(function(e){return new m(t,e)}):[],r}function Sy(t){void 0===t&&(t={});var n=by.call(this)||this;return Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&(n[e]=t[e])}),n}function Ny(){var e=null!==Ty&&Ty.apply(this,arguments)||this;return e.onUserEntered=t,e.onUserExited=t,e.onChannelParticipantCountChanged=t,e}e(Ny,Ty=function(){this.onUserMuted=t,this.onUserUnmuted=t,this.onUserBanned=t,this.onUserUnbanned=t,this.onChannelChanged=t,this.onChannelDeleted=t,this.onChannelFrozen=t,this.onChannelUnfrozen=t,this.onOperatorUpdated=t,this.onChannelMemberCountChanged=t,this.onMetaDataCreated=t,this.onMetaDataUpdated=t,this.onMetaDataDeleted=t,this.onMetaCounterCreated=t,this.onMetaCounterUpdated=t,this.onMetaCounterDeleted=t,this.onMessageReceived=t,this.onMessageUpdated=t,this.onMessageDeleted=t,this.onMentionReceived=t,this.onReactionUpdated=t,this.onThreadInfoUpdated=t}),e(Sy,by=Ny);e(Fy,Dy=o);var Ay,Oy,Ry,Dy,My=Fy,ky=(e(qy,Ry=_),qy),Ly=(e(xy,Oy=T),xy.prototype._validate=function(){return Oy.prototype._validate.call(this)&&u("boolean",this.includeFrozen)&&u("boolean",this.includeMetaData)&&u("string",this.nameKeyword,!0)&&u("string",this.urlKeyword,!0)&&l("string",this.customTypes,!0)},xy.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,s;return se(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,t=g.of(this._iid).requestQueue,n=new My(p(p({},this),{token:this._token})),[4,t.send(n)]):[3,3]:[3,6];case 1:return t=e.sent(),n=t.as(ky),r=n.channels,s=n.token,this._token=s,this._hasNext=!!s,[4,ny.of(this._iid).upsertChannelsToCache(r)];case 2:return e.sent(),this._isLoading=!1,[2,r];case 3:return[2,[]];case 4:throw f.queryInProgress;case 5:return[3,7];case 6:throw f.invalidParameters;case 7:return[2]}})})},xy),Uy=(e(Py,Ay=y),Py.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,s=t.sessionManager,i=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;Ay.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:s,requestQueue:i,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new ny(e,{sdkState:n,dispatcher:r,requestQueue:i})},Py.prototype.createOpenChannelListQuery=function(e){return new Ly(this._iid,e=void 0===e?{}:e)},Py.prototype.addOpenChannelHandler=function(e,t){this._manager.addHandler(e,t)},Py.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},Py.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},Py.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},Py.prototype.getChannel=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this._manager.getChannel(t)]})})},Py.prototype.getChannelWithoutCache=function(t){return re(this,void 0,void 0,function(){return se(this,function(e){return[2,this._manager.getChannelWithoutCache(t)]})})},Py.prototype.createChannel=function(t){return void 0===t&&(t={}),re(this,void 0,void 0,function(){return se(this,function(e){return[2,this._manager.createChannel(t)]})})},Py.prototype.createChannelWithOperatorUserIds=function(n,r,s,i,a){return re(this,void 0,void 0,function(){var t;return se(this,function(e){return(t=p({},Mg)).name=n,t.coverUrlOrImage=r,t.data=s,t.operatorUserIds=i,t.customType=a,[2,this._manager.createChannel(t)]})})},Py);function Py(){var e=null!==Ay&&Ay.apply(this,arguments)||this;return e.name="openChannel",e}function xy(e,t){var n=this;return(n=Oy.call(this,e,t)||this).includeFrozen=!0,n.includeMetaData=!0,n.nameKeyword=null,n.urlKeyword=null,n.customTypes=null,n.includeFrozen=null==(e=t.includeFrozen)||e,n.includeMetaData=null==(e=t.includeMetaData)||e,n.nameKeyword=null!=(e=t.nameKeyword)?e:null,n.urlKeyword=null!=(e=t.urlKeyword)?e:null,n.customTypes=null!=(e=t.customTypes)?e:null,n}function qy(t,e){var n=Ry.call(this,t,e)||this,r=(n.token=null,n.channels=[],n.ts=null,e.next),s=e.channels,e=e.ts;return n.token=r,s&&0<s.length&&(n.channels=s.map(function(e){return new Cy(t,e)})),n.ts="number"==typeof e?e:null,n}function Fy(e){var t=this,n=e.token,r=e.limit,s=e.nameKeyword,i=e.urlKeyword,a=e.customTypes,o=e.includeFrozen,e=e.includeMetaData;return(t=Dy.call(this)||this).method=I.GET,t.path=Ms,t.params=E({token:n,limit:r,name_contains:s,url_contains:i,custom_types:a,show_frozen:o,show_metadata:e}),t}class Hy extends ct{constructor(e){super(),this._ctx=e,c(this,"wsClient",void 0),c(this,"apiClient",void 0),c(this,"_unsubscriber",void 0),this.wsClient=new Tn({...e,parse:e=>ot.parse(e)}),this.apiClient=new Cn({...e,parseResponse:(e,t)=>ot.parseResponse(e,t)}),this._unsubscriber=this.wsClient.on("command",e=>{this._dispatchEvent("command",e)})}connectWs(){return this.wsClient.connect()}sendAPI(e){return this.apiClient.send(e)}async send(e){return this.sendAPI(e)}async sendWithRetry(t){let n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Dt;const{deferred:r,count:s}=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{count:0,deferred:new Ot};try{var i=await this.send(t);r.resolve(i)}catch(e){i=n.calcTimeout(s);0<i?setTimeout(()=>{this.sendWithRetry(t,n,{count:s+1,deferred:r})},i):r.reject(e)}return r.promise}_setSessionKey(e){this.apiClient.setSessionKey(e),this.wsClient.setSessionKey(e)}async authenticate(t){var{userId:t,accessToken:e}=t;const n=tg.init({appId:this._ctx.appId,modules:[new Uy]});this._ctx.sb=n;try{await n.connect(t,e);var r=ot.createAuth(this._ctx.appId,t,e),s=await this.send(r);this._setSessionKey(s.sbcall_session_token),this._ctx.liveEventManager.userId=s.user.user_id}catch(e){throw a.error("failed to authenticate user "+t),e}}deauthenticate(){this.apiClient.clearSessionKey(),this.wsClient.clearSessionKey()}}const Gy={VERBOSE:{level:-1,name:ut.VERBOSE,public:!1},DEBUG:{level:1,name:ut.DEBUG,public:!1},INFO:{level:2,name:ut.INFO,public:!0},WARNING:{level:3,name:ut.WARNING,public:!0},ERROR:{level:4,name:ut.ERROR,public:!0},NONE:{level:100,name:ut.NONE,public:!0}};class Vy extends class{constructor(e){c(this,"level",void 0),this.level=e||ut.NONE}setLoggerLevel(e){return Gy[e]?.public&&(this.level=e),this.level}_enabledFor(e){try{return Gy[this.level].level<=Gy[e].level}catch(e){return!1}}}{constructor(e){super(e)}_getLogType(e){switch(e){case ut.ERROR:return"error";case ut.WARNING:return"warn";default:return"log"}}_getTimeString(e){return`[${e.getFullYear().toString().padStart(2,"0")}.${(e.getMonth()+1).toString().padStart(2,"0")}.${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}:${e.getMilliseconds().toString().padStart(2,"0")}]`}_permit(e){var t=this._getLogType(e),n=new Date;if(this._enabledFor(e)&&console&&console[t]){for(var n=this._getTimeString(n)+` [${e}]`,r=arguments.length,s=new Array(1<r?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];console[t](n,...s)}}}M.ErrorCode=void 0,(w=M.ErrorCode||(M.ErrorCode={}))[w.LIVE_EVENT_ID_NOT_FOUND=2800100]="LIVE_EVENT_ID_NOT_FOUND",w[w.ACTION_NOT_ALLOWED_IN_CURRENT_STATE=2800101]="ACTION_NOT_ALLOWED_IN_CURRENT_STATE",w[w.ACTION_NOT_ALLOWED_FOR_PARTICIPANT=2800102]="ACTION_NOT_ALLOWED_FOR_PARTICIPANT",w[w.USER_NOT_ENTERED_LIVE_EVENT=2800103]="USER_NOT_ENTERED_LIVE_EVENT",w[w.STREAM_NOT_STARTED=2800104]="STREAM_NOT_STARTED",w[w.CONNECTION_TO_MEDIA_STREAM_FAILED=2800105]="CONNECTION_TO_MEDIA_STREAM_FAILED",w[w.UNKNOWN_NETWORK_ERROR=2800400]="UNKNOWN_NETWORK_ERROR",w[w.QUERY_IN_PROGRESS=2800900]="QUERY_IN_PROGRESS",w[w.OPEN_CHANNEL_NOT_FETCHED=2800901]="OPEN_CHANNEL_NOT_FETCHED";C=new class{constructor(){c(this,"_ctx",{}),c(this,"_consoleLogListener",void 0)}init(e){this._consoleLogListener=new Vy(ut.NONE),a.addListener(this._consoleLogListener),this._ctx.appId=e,this._ctx.clientId=V(),this._ctx.commandRouter=new Hy(this._ctx),this._ctx.deviceManager=new En,this._ctx.liveEventManager=new nn(this._ctx)}setLoggerLevel(e){return this._consoleLogListener.setLoggerLevel(e)}async authenticate(e,t){await this._ctx.commandRouter.authenticate({userId:e,accessToken:t}),await this._ctx.commandRouter.connectWs()}async deauthenticate(){await this._ctx.sb.disconnect(),this._ctx.commandRouter.deauthenticate(),this._ctx.liveEventManager.clear(),a.removeAllListener()}async createLiveEvent(e){return this._ctx.liveEventManager.createLiveEvent(e)}async getLiveEvent(e){return this._ctx.liveEventManager.getLiveEvent(e)}createLiveEventListQuery(e){return new ne(e,this._ctx.commandRouter)}getAvailableAudioInputDevices(){return this._ctx.deviceManager.getAvailableAudioInputDevices()}getAvailableVideoInputDevices(){return this._ctx.deviceManager.getAvailableVideoInputDevices()}};M.LiveEvent=tn,M.SendbirdLive=C,Object.defineProperty(M,"__esModule",{value:!0})});