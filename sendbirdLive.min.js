!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sendbirdLive={})}(this,function(D){"use strict";function M(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){I(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function P(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function g(o){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=o.apply(e,a);function i(e){P(r,t,n,i,s,"next",e)}function s(e){P(r,t,n,i,s,"throw",e)}i(void 0)})}}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t&&L(e.prototype,t),n&&L(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function I(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function j(e,t,n){return(j=q()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);t=new(Function.bind.apply(e,r));return n&&F(t,n.prototype),t}).apply(null,arguments)}function H(e){var n="function"==typeof Map?new Map:void 0;return function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return j(e,arguments,U(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),F(t,e)}(e)}function G(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};for(var n,r={},i=Object.keys(e),s=0;s<i.length;s++)n=i[s],0<=t.indexOf(n)||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),s=0;s<i.length;s++)n=i[s],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(n){var r=q();return function(){var e,t=U(n),t=(e=r?(e=U(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return w(t)}}function V(e){return function(e){if(Array.isArray(e))return K(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||B(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){if(e){if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(e,t):void 0}}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Q(e,t){var n,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=B(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}var z,W="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Y={exports:{}},Y=function(a){var u,e=Object.prototype,c=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function o(e,t,n,r){var i,s,a,o,t=t&&t.prototype instanceof _?t:_,t=Object.create(t.prototype),r=new S(r||[]);return t._invoke=(i=e,s=n,a=r,o=h,function(e,t){if(o===f)throw new Error("Generator is already running");if(o===p){if("throw"===e)throw t;return k()}for(a.method=e,a.arg=t;;){var n=a.delegate;if(n){n=function e(t,n){var r=t.iterator[n.method];if(r===u){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=u,e(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}r=l(r,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;r=r.arg;if(!r)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v;{if(!r.done)return r;n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=u)}n.delegate=null;return v}(n,a);if(n){if(n===v)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===h)throw o=p,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=f;n=l(i,s,a);if("normal"===n.type){if(o=a.done?p:d,n.arg!==v)return{value:n.arg,done:a.done}}else"throw"===n.type&&(o=p,a.method="throw",a.arg=n.arg)}}),t}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}a.wrap=o;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",v={};function _(){}function y(){}function m(){}var t={},g=(s(t,r,function(){return this}),Object.getPrototypeOf),g=g&&g(g(C([]))),E=(g&&g!==e&&c.call(g,r)&&(t=g),m.prototype=_.prototype=Object.create(t));function b(e){["next","throw","return"].forEach(function(t){s(e,t,function(e){return this._invoke(t,e)})})}function I(a,o){var t;this._invoke=function(n,r){function e(){return new o(function(e,t){!function t(e,n,r,i){var s,e=l(a[e],a,n);if("throw"!==e.type)return(n=(s=e.arg).value)&&"object"==typeof n&&c.call(n,"__await")?o.resolve(n.__await).then(function(e){t("next",e,r,i)},function(e){t("throw",e,r,i)}):o.resolve(n).then(function(e){s.value=e,r(s)},function(e){return t("throw",e,r,i)});i(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function C(t){if(t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=u,e.done=!0,e}).next=e}return{next:k}}function k(){return{value:u,done:!0}}return s(E,"constructor",y.prototype=m),s(m,"constructor",y),y.displayName=s(m,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,i,"GeneratorFunction")),e.prototype=Object.create(E),e},a.awrap=function(e){return{__await:e}},b(I.prototype),s(I.prototype,n,function(){return this}),a.AsyncIterator=I,a.async=function(e,t,n,r,i){void 0===i&&(i=Promise);var s=new I(o(e,t,n,r),i);return a.isGeneratorFunction(t)?s:s.next().then(function(e){return e.done?e.value:s.next()})},b(E),s(E,i,"Generator"),s(E,r,function(){return this}),s(E,"toString",function(){return"[object Generator]"}),a.keys=function(n){var e,r=[];for(e in n)r.push(e);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return s.type="throw",s.arg=n,r.next=e,t&&(r.method="next",r.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],s=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),o=c.call(i,"finallyLoc");if(a&&o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}var s=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(n=i.completion).type&&(r=n.arg,w(i)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=u),v}},a}(Y.exports);try{regeneratorRuntime=Y}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=Y:Function("r","regeneratorRuntime = r")(Y)}var X=new Uint8Array(16);var J=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Z(e){return"string"==typeof e&&J.test(e)}for(var $=[],ee=0;ee<256;++ee)$.push((ee+256).toString(16).substr(1));function te(e,t){t=1<arguments.length&&void 0!==t?t:0,e=($[e[t+0]]+$[e[t+1]]+$[e[t+2]]+$[e[t+3]]+"-"+$[e[t+4]]+$[e[t+5]]+"-"+$[e[t+6]]+$[e[t+7]]+"-"+$[e[t+8]]+$[e[t+9]]+"-"+$[e[t+10]]+$[e[t+11]]+$[e[t+12]]+$[e[t+13]]+$[e[t+14]]+$[e[t+15]]).toLowerCase();if(Z(e))return e;throw TypeError("Stringified UUID is invalid")}function ne(){try{0}catch(e){}}function oe(e,t,n){var r=(e=e||{}).random||(e.rng||function(){if(z=z||"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto))return z(X);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return te(r)}ne(),ne();function ue(e){try{return!!e()}catch(e){return!0}}function ce(e){return qe(Fe(e),8,-1)}function le(e){if(null==e)throw Ve("Can't call method on "+e);return e}function he(e){return Be(Ke(e))}function de(e){return e&&e.Math==Math&&e}function fe(t,n){try{ze(Qe,t,{value:n,configurable:!0,writable:!0})}catch(e){Qe[t]=n}return n}function pe(e){return Ze(Je(e))}function ve(e){return"Symbol("+(void 0===e?"":e)+")_"+it(++nt+rt,36)}function _e(e){return"function"==typeof e}function ye(e,t){return arguments.length<2?(n=st[e],at(n)?n:void 0):st[e]&&st[e][t];var n}function me(e){var t;return ft(_t,e)&&(pt||"string"==typeof _t[e])||(t="Symbol."+e,pt&&ft(yt,e)?_t[e]=yt[e]:_t[e]=(vt&&mt?mt:gt)(t)),_t[e]}function ge(e){return"object"==typeof e?null!==e:Et(e)}function Ee(e){if(bt(e))return e;throw Tt(It(e)+" is not an object")}function be(e){return Ct?St.createElement(e):{}}function Ie(e){try{return Pt(e)}catch(e){return"Object"}}function Te(e){if(Lt(e))return e;throw Ft(Ut(e)+" is not a function")}function we(e,t){return null==(e=e[t])?void 0:qt(e)}function Se(e,t){if(!Kt(e)||Qt(e))return e;var n=zt(e,Xt);if(n){if(n=Bt(n,e,t=void 0===t?"default":t),!Kt(n)||Qt(n))return n;throw Yt("Can't convert object to primitive value")}return Wt(e,t=void 0===t?"number":t)}function Ce(e){return e=Jt(e,"string"),Zt(e)?e:e+""}function ke(e){return(e=+e)!=e||0==e?0:hn(e)}function Ae(e,t){return(e=dn(e))<0?fn(e+t,0):pn(e,t)}function Ne(e){return 0<e?_n(vn(e),9007199254740991):0}function Oe(e){return yn(e.length)}function Re(o){return function(e,t,n){var r,i=mn(e),s=En(i),a=gn(n,s);if(o&&t!=t){for(;a<s;)if((r=i[a++])!=r)return!0}else for(;a<s;a++)if((o||a in i)&&i[a]===t)return o||a||0;return!o&&-1}}function De(e,t){var n,r=Sn(e),i=0,s=[];for(n in r)!wn(kn,n)&&wn(r,n)&&An(s,n);for(;t.length>i;)!wn(r,n=t[i++])||~Cn(s,n)||An(s,n);return s}var Y=!ue(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),Me=Y,xe=Function.prototype,Pe=xe.bind,Le=xe.call,Ue=Me&&Pe.bind(Le,Le),xe=Me?function(e){return e&&Ue(e)}:function(e){return e&&function(){return Le.apply(e,arguments)}},Pe=xe,Fe=Pe({}.toString),qe=Pe("".slice),Me=ue,je=ce,He=Object,Ge=xe("".split),Pe=Me(function(){return!He("z").propertyIsEnumerable(0)})?function(e){return"String"==je(e)?Ge(e,""):He(e)}:He,Ve=TypeError,Be=Pe,Ke=le,Me=de("object"==typeof globalThis&&globalThis)||de("object"==typeof window&&window)||de("object"==typeof self&&self)||de("object"==typeof W&&W)||function(){return this}()||Function("return this")(),W={exports:{}},Qe=Me,ze=Object.defineProperty,We=fe,Ye="__core-js_shared__",We=Me[Ye]||We(Ye,{}),Xe=We,Je=((W.exports=function(e,t){return Xe[e]||(Xe[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.23.4",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.4/LICENSE",source:"https://github.com/zloirock/core-js"}),le),Ze=Object,$e=pe,et=xe({}.hasOwnProperty),Ye=Object.hasOwn||function(e,t){return et($e(e),t)},tt=xe,nt=0,rt=Math.random(),it=tt(1..toString),st=Me,at=_e,tt=ye("navigator","userAgent")||"",ot=tt,ut=Me.process,ct=Me.Deno,ut=ut&&ut.versions||ct&&ct.version,ct=ut&&ut.v8,ut=dt=!(dt=ct?0<(ht=ct.split("."))[0]&&ht[0]<4?1:+(ht[0]+ht[1]):dt)&&ot&&(!(ht=ot.match(/Edge\/(\d+)/))||74<=ht[1])&&(ht=ot.match(/Chrome\/(\d+)/))?+ht[1]:dt,lt=ut,ct=ue,ot=!!Object.getOwnPropertySymbols&&!ct(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&lt&&lt<41}),ht=ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,dt=Me,ct=W.exports,ft=Ye,e=ve,pt=ot,vt=ht,_t=ct("wks"),yt=dt.Symbol,mt=yt&&yt.for,gt=vt?yt:yt&&yt.withoutSetter||e,Et=_e,bt=ge,It=String,Tt=TypeError,ot={},ct=!ue(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),dt=ct&&ue(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),e={},wt=ge,St=Me.document,Ct=wt(St)&&wt(St.createElement),kt=be,wt=!ct&&!ue(function(){return 7!=Object.defineProperty(kt("div"),"a",{get:function(){return 7}}).a}),At=Function.prototype.call,Nt=Y?At.bind(At):function(){return At.apply(At,arguments)},Ot=xe({}.isPrototypeOf),Rt=ye,Dt=_e,Mt=Ot,xt=Object,ht=ht?function(e){return"symbol"==typeof e}:function(e){var t=Rt("Symbol");return Dt(t)&&Mt(t.prototype,xt(e))},Pt=String,Lt=_e,Ut=Ie,Ft=TypeError,qt=Te,jt=Nt,Ht=_e,Gt=ge,Vt=TypeError,Bt=Nt,Kt=ge,Qt=ht,zt=we,Wt=function(e,t){var n,r;if("string"===t&&Ht(n=e.toString)&&!Gt(r=jt(n,e)))return r;if(Ht(n=e.valueOf)&&!Gt(r=jt(n,e)))return r;if("string"!==t&&Ht(n=e.toString)&&!Gt(r=jt(n,e)))return r;throw Vt("Can't convert object to primitive value")},Yt=TypeError,Xt=me("toPrimitive"),Jt=Se,Zt=ht,$t=wt,en=Ee,tn=Ce,nn=TypeError,rn=Object.defineProperty,sn=Object.getOwnPropertyDescriptor,an="enumerable",on="configurable",un="writable",cn=(e.f=ct?dt?function(e,t,n){var r;return en(e),t=tn(t),en(n),"function"==typeof e&&"prototype"===t&&"value"in n&&un in n&&!n[un]&&((r=sn(e,t))&&r[un]&&(e[t]=n.value,n={configurable:(on in n?n:r)[on],enumerable:(an in n?n:r)[an],writable:!1})),rn(e,t,n)}:rn:function(e,t,n){if(en(e),t=tn(t),en(n),$t)try{return rn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw nn("Accessors not supported");return"value"in n&&(e[t]=n.value),e},Math.ceil),ln=Math.floor,hn=Math.trunc||function(e){e=+e;return(0<e?ln:cn)(e)},dn=ke,fn=Math.max,pn=Math.min,vn=ke,_n=Math.min,yn=Ne,mn=he,gn=Ae,En=Oe,bn={includes:Re(!0),indexOf:Re(!1)},In={},Tn=xe,wn=Ye,Sn=he,Cn=bn.indexOf,kn=In,An=Tn([].push),Tn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Nn=De,On=Tn,Rn=Object.keys||function(e){return Nn(e,On)},Dn=e,Mn=Ee,xn=he,Pn=Rn;ot.f=ct&&!dt?Object.defineProperties:function(e,t){Mn(e);for(var n,r=xn(t),i=Pn(t),s=i.length,a=0;a<s;)Dn.f(e,n=i[a++],r[n]);return e};function Ln(e){return tr[e]||(tr[e]=er(e))}function Un(){}function Fn(e){e.write(lr("")),e.close();var t=e.parentWindow.Object;return e=null,t}function qn(e){vr[pr][e]=!0}function jn(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function Hn(e,t,n,r){var i=(r=r||{}).enumerable,s=void 0!==r.name?r.name:t;if(Wr(n)&&Xr(n,s,r),r.global)i?e[t]=n:Jr(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=n:Yr.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e}function Gn(e,t){return(e=di[hi(e)])==pi||e!=fi&&(ci(t)?ui(t):!!t)}function Vn(e,t){var n,r,i,s=e.target,a=e.global,o=e.stat,u=a?vi:o?vi[s]||gi(s,{}):(vi[s]||{}).prototype;if(u)for(n in t){if(r=t[n],i=e.dontCallGetSet?(i=_i(u,n))&&i.value:u[n],!bi(a?n:s+(o?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;Ei(r,i)}(e.sham||i&&i.sham)&&yi(r,"sham",!0),mi(u,n,r,e)}}var Bn,Kn,Qn,zn,Wn,Yn,Xn,Jn,Zn,$n,dt=ye("document","documentElement"),t=W.exports,er=ve,tr=t("keys"),nr=Ee,rr=ot,ir=Tn,t=In,sr=dt,ar=be,or="prototype",ur="script",cr=Ln("IE_PROTO"),lr=function(e){return"<"+ur+">"+e+"</"+ur+">"},hr=function(){try{Bn=new ActiveXObject("htmlfile")}catch(e){}hr="undefined"==typeof document||document.domain&&Bn?Fn(Bn):(e=ar("iframe"),t="java"+ur+":",e.style.display="none",sr.appendChild(e),e.src=String(t),(t=e.contentWindow.document).open(),t.write(lr("document.F=Object")),t.close(),t.F);for(var e,t,n=ir.length;n--;)delete hr[or][ir[n]];return hr()},ot=(t[cr]=!0,Object.create||function(e,t){var n;return null!==e?(Un[or]=nr(e),n=new Un,Un[or]=null,n[cr]=e):n=hr(),void 0===t?n:rr.f(n,t)}),t=me,dr=ot,fr=e.f,pr=t("unscopables"),vr=Array.prototype,t=(null==vr[pr]&&fr(vr,pr,{configurable:!0,value:dr(null)}),{}),fr=_e,dr=We,_r=xe(Function.toString),fr=(fr(dr.inspectSource)||(dr.inspectSource=function(e){return _r(e)}),dr.inspectSource),dr=_e,yr=fr,mr=Me.WeakMap,dr=dr(mr)&&/native code/.test(yr(mr)),gr=e,Er=jn,yr=ct?function(e,t,n){return gr.f(e,t,Er(1,n))}:function(e,t,n){return e[t]=n,e},mr=xe,br=ge,Ir=yr,Tr=Ye,wr=Ln,Sr=In,Cr="Object already initialized",kr=Me.TypeError,Ar=Me.WeakMap,dr=(Jn=dr||We.state?(Kn=We.state||(We.state=new Ar),Qn=mr(Kn.get),zn=mr(Kn.has),Wn=mr(Kn.set),Yn=function(e,t){if(zn(Kn,e))throw new kr(Cr);return t.facade=e,Wn(Kn,e,t),t},Xn=function(e){return Qn(Kn,e)||{}},function(e){return zn(Kn,e)}):(Sr[Zn=wr("state")]=!0,Yn=function(e,t){if(Tr(e,Zn))throw new kr(Cr);return t.facade=e,Ir(e,Zn,t),t},Xn=function(e){return Tr(e,Zn)?e[Zn]:{}},function(e){return Tr(e,Zn)}),{set:Yn,get:Xn,has:Jn,enforce:function(e){return Jn(e)?Xn(e):Yn(e,{})},getterFor:function(t){return function(e){if(br(e)&&(e=Xn(e)).type===t)return e;throw kr("Incompatible receiver, "+t+" required")}}}),We={},Ar={},mr={}.propertyIsEnumerable,Nr=Object.getOwnPropertyDescriptor,Sr=Nr&&!mr.call({1:2},1),wr=(Ar.f=Sr?function(e){e=Nr(this,e);return!!e&&e.enumerable}:mr,ct),Or=Nt,Rr=Ar,Dr=jn,Mr=he,xr=Ce,Pr=Ye,Lr=wt,Ur=Object.getOwnPropertyDescriptor,Sr=(We.f=wr?Ur:function(e,t){if(e=Mr(e),t=xr(t),Lr)try{return Ur(e,t)}catch(e){}if(Pr(e,t))return Dr(!Or(Rr.f,e,t),e[t])},{exports:{}}),mr=ct,wt=Ye,wr=Function.prototype,n=mr&&Object.getOwnPropertyDescriptor,wt=wt(wr,"name"),wt={EXISTS:wt,PROPER:wt&&"something"===function(){}.name,CONFIGURABLE:wt&&(!mr||n(wr,"name").configurable)},mr=ue,Fr=_e,qr=Ye,jr=ct,Hr=wt.CONFIGURABLE,Gr=fr,Vr=dr.enforce,Br=dr.get,Kr=Object.defineProperty,Qr=jr&&!mr(function(){return 8!==Kr(function(){},"length",{value:8}).length}),zr=String(String).split("String"),n=Sr.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!qr(e,"name")||Hr&&e.name!==t)&&(jr?Kr(e,"name",{value:t,configurable:!0}):e.name=t),Qr&&n&&qr(n,"arity")&&e.length!==n.arity&&Kr(e,"length",{value:n.arity});try{n&&qr(n,"constructor")&&n.constructor?jr&&Kr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}n=Vr(e);return qr(n,"source")||(n.source=zr.join("string"==typeof t?t:"")),e},Wr=(Function.prototype.toString=n(function(){return Fr(this)&&Br(this).source||Gr(this)},"toString"),_e),Yr=e,Xr=Sr.exports,Jr=fe,wr={},Zr=De,$r=Tn.concat("length","prototype"),mr=(wr.f=Object.getOwnPropertyNames||function(e){return Zr(e,$r)},{}),n=(mr.f=Object.getOwnPropertySymbols,ye),ei=wr,ti=mr,ni=Ee,ri=xe([].concat),Sr=n("Reflect","ownKeys")||function(e){var t=ei.f(ni(e)),n=ti.f;return n?ri(t,n(e)):t},ii=Ye,si=Sr,ai=We,oi=e,ui=ue,ci=_e,li=/#|\.prototype\./,hi=Gn.normalize=function(e){return String(e).replace(li,".").toLowerCase()},di=Gn.data={},fi=Gn.NATIVE="N",pi=Gn.POLYFILL="P",Tn=Gn,vi=Me,_i=We.f,yi=yr,mi=Hn,gi=fe,Ei=function(e,t,n){for(var r=si(t),i=oi.f,s=ai.f,a=0;a<r.length;a++){var o=r[a];ii(e,o)||n&&ii(n,o)||i(e,o,s(t,o))}},bi=Tn,n=!ue(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Ii=Ye,Ti=_e,wi=pe,Sr=n,Si=Ln("IE_PROTO"),Ci=Object,ki=Ci.prototype,n=Sr?Ci.getPrototypeOf:function(e){e=wi(e);if(Ii(e,Si))return e[Si];var t=e.constructor;return Ti(t)&&e instanceof t?t.prototype:e instanceof Ci?ki:null},Sr=ue,Ai=_e,Ni=n,Oi=Hn,Ri=me("iterator"),Di=!1;[].keys&&("next"in(Ui=[].keys())?(Ni=Ni(Ni(Ui)))!==Object.prototype&&($n=Ni):Di=!0);function Mi(e,t,n){(e=e&&!n?e.prototype:e)&&!qi(e,ji)&&Fi(e,ji,{configurable:!0,value:t})}function xi(){return this}function Pi(){return this}function Li(e,t,n,r,i,s,a){function o(e){if(e===i&&f)return f;if(!hs&&e in h)return h[e];switch(e){case"keys":case fs:case ps:return function(){return new n(this,e)}}return function(){return new n(this)}}ts(n,t,r);var u,c,r=t+" Iterator",l=!1,h=e.prototype,d=h[ds]||h["@@iterator"]||i&&h[i],f=!hs&&d||o(i),p="Array"==t&&h.entries||d;if(p&&(p=ns(p.call(new e)))!==Object.prototype&&p.next&&(ns(p)!==ls&&(rs?rs(p,ls):es(p[ds])||as(p,ds,Pi)),is(p,r,!0)),us&&i==fs&&d&&d.name!==fs&&(cs?ss(h,"name",fs):(l=!0,f=function(){return $i(d,this)})),i)if(u={values:o(fs),keys:s?f:o("keys"),entries:o(ps)},a)for(c in u)!hs&&!l&&c in h||as(h,c,u[c]);else Zi({target:t,proto:!0,forced:hs||l},u);return h[ds]!==f&&as(h,ds,f,{name:i}),os[t]=f,u}Ai(($n=null==$n||Sr(function(){var e={};return $n[Ri].call(e)!==e})?{}:$n)[Ri])||Oi($n,Ri,function(){return this});var Ui={IteratorPrototype:$n,BUGGY_SAFARI_ITERATORS:Di},Fi=e.f,qi=Ye,ji=me("toStringTag"),Hi=Ui.IteratorPrototype,Gi=ot,Vi=jn,Bi=Mi,Ki=t,Qi=_e,zi=String,Wi=TypeError,Yi=xe,Xi=Ee,Ji=function(e){if("object"==typeof e||Qi(e))return e;throw Wi("Can't set "+zi(e)+" as a prototype")},Ni=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Yi(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return Xi(e),Ji(t),r?n(e,t):e.__proto__=t,e}}():void 0),Zi=Vn,$i=Nt,es=_e,ts=function(e,t,n,r){t+=" Iterator";return e.prototype=Gi(Hi,{next:Vi(+!r,n)}),Bi(e,t,!1),Ki[t]=xi,e},ns=n,rs=Ni,is=Mi,ss=yr,as=Hn,Ai=me,os=t,us=wt.PROPER,cs=wt.CONFIGURABLE,ls=Ui.IteratorPrototype,hs=Ui.BUGGY_SAFARI_ITERATORS,ds=Ai("iterator"),fs="values",ps="entries",vs=he,Sr=qn,Oi=t,Di=dr,n=e.f,Ui=Li,Ai=ct,_s="Array Iterator",ys=Di.set,ms=Di.getterFor(_s),Di=Ui(Array,"Array",function(e,t){ys(this,{type:_s,target:vs(e),index:0,kind:t})},function(){var e=ms(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),Ui=Oi.Arguments=Oi.Array;if(Sr("keys"),Sr("values"),Sr("entries"),Ai&&"values"!==Ui.name)try{n(Ui,"name",{value:"values"})}catch(e){}var Oi={},Sr=(Oi[me("toStringTag")]="z","[object z]"===String(Oi)),Ai=Sr,gs=_e,Es=ce,bs=me("toStringTag"),Is=Object,Ts="Arguments"==Es(function(){return arguments}()),n=Ai?Es:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(t=function(e,t){try{return e[t]}catch(e){}}(e=Is(e),bs))?t:Ts?Es(e):"Object"==(t=Es(e))&&gs(e.callee)?"Arguments":t},ws=n;Sr||Hn(Object.prototype,"toString",Sr?{}.toString:function(){return"[object "+ws(this)+"]"},{unsafe:!0});function Ss(e){var e=Ms(e),t=xs.f;Ps&&e&&!e[Ls]&&t(e,Ls,{configurable:!0,get:function(){return this}})}function Cs(e,t){if(Us(t,e))return e;throw Fs("Incorrect invocation")}function ks(){}function As(e){if(!qs(e))return!1;try{return Vs(ks,Gs,e),!0}catch(e){return!1}}function Ns(e){if(!qs(e))return!1;switch(js(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Qs||!!Ks(Bs,Hs(e))}catch(e){return!0}}function Os(e,t){return ta(e),void 0===t?e:na?ra(e,t):function(){return e.apply(t,arguments)}}var Rs,Ds,Ui="process"==ce(Me.process),Ms=ye,xs=e,Ps=ct,Ls=me("species"),Us=Ot,Fs=TypeError,Oi=xe,Ai=ue,qs=_e,js=n,Hs=fr,Gs=[],Vs=ye("Reflect","construct"),Bs=/^\s*(?:class|function)\b/,Ks=Oi(Bs.exec),Qs=!Bs.exec(ks),Sr=(Ns.sham=!0,!Vs||Ai(function(){var e;return As(As.call)||!As(Object)||!As(function(){e=!0})||e})?Ns:As),zs=Sr,Ws=Ie,Ys=TypeError,Xs=Ee,Js=function(e){if(zs(e))return e;throw Ys(Ws(e)+" is not a constructor")},Zs=me("species"),Oi=Function.prototype,$s=Oi.apply,ea=Oi.call,Ai="object"==typeof Reflect&&Reflect.apply||(Y?ea.bind($s):function(){return ea.apply($s,arguments)}),ta=Te,na=Y,ra=xe(xe.bind),Oi=xe([].slice),ia=TypeError,Y=/(?:ipad|iphone|ipod).*applewebkit/i.test(tt),sa=Me,aa=Ai,r=Os,oa=_e,ua=Ye,ca=ue,la=dt,ha=Oi,da=be,fa=function(e,t){if(e<t)throw ia("Not enough arguments");return e},dt=Y,pa=Ui,i=sa.setImmediate,va=sa.clearImmediate,_a=sa.process,ya=sa.Dispatch,ma=sa.Function,ga=sa.MessageChannel,Ea=sa.String,ba=0,Ia={},Ta="onreadystatechange";try{Rs=sa.location}catch(e){}function wa(e){return function(){Ha(e)}}function Sa(e){Ha(e.data)}function Ca(e){sa.postMessage(Ea(e),Rs.protocol+"//"+Rs.host)}function ka(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}function Aa(){this.head=null,this.tail=null}function Na(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=to(n),this.reject=to(r)}function Oa(e,t){var n,r,i,s,a=t.value,o=t.state==Do,u=o?e.ok:e.fail,c=e.resolve,l=e.reject,h=e.domain;try{u?(o||(t.rejection===Po&&(s=t,io(lo,ro,function(){var e=s.facade;no?Co.emit("rejectionHandled",e):Fo(Ro,e,s.value)})),t.rejection=xo),!0===u?n=a:(h&&h.enter(),n=u(a),h&&(h.exit(),i=!0)),n===e.promise?l(wo("Promise-chain cycle")):(r=Lo(n))?io(r,n,c,l):c(n)):l(a)}catch(e){h&&!i&&h.exit(),l(e)}}var Ra,Da,Ma,xa,Pa,La,Ua,Fa,qa,ja,Ha=function(e){var t;ua(Ia,e)&&(t=Ia[e],delete Ia[e],t())},ga=(i&&va||(i=function(e){fa(arguments.length,1);var t=oa(e)?e:ma(e),n=ha(arguments,1);return Ia[++ba]=function(){aa(t,void 0,n)},Ds(ba),ba},va=function(e){delete Ia[e]},pa?Ds=function(e){_a.nextTick(wa(e))}:ya&&ya.now?Ds=function(e){ya.now(wa(e))}:ga&&!dt?(dt=(pa=new ga).port2,pa.port1.onmessage=Sa,Ds=r(dt.postMessage,dt)):sa.addEventListener&&oa(sa.postMessage)&&!sa.importScripts&&Rs&&"file:"!==Rs.protocol&&!ca(Ca)?(Ds=Ca,sa.addEventListener("message",Sa,!1)):Ds=Ta in da("script")?function(e){la.appendChild(da("script"))[Ta]=function(){la.removeChild(this),Ha(e)}}:function(e){setTimeout(wa(e),0)}),{set:i,clear:va}),pa=Me,r=/ipad|iphone|ipod/i.test(tt)&&void 0!==pa.Pebble,dt=/web0s(?!.*chrome)/i.test(tt),ca=Me,i=Os,va=We.f,Ga=ga.set,pa=Y,Y=r,r=dt,Va=Ui,dt=ca.MutationObserver||ca.WebKitMutationObserver,Ba=ca.document,Ka=ca.process,Qa=ca.Promise,va=va(ca,"queueMicrotask"),va=va&&va.value,r=(va||(Ra=function(){var e,t;for(Va&&(e=Ka.domain)&&e.exit();Da;){t=Da.fn,Da=Da.next;try{t()}catch(e){throw Da?xa():Ma=void 0,e}}Ma=void 0,e&&e.enter()},xa=pa||Va||r||!dt||!Ba?!Y&&Qa&&Qa.resolve?((pa=Qa.resolve(void 0)).constructor=Qa,Ua=i(pa.then,pa),function(){Ua(Ra)}):Va?function(){Ka.nextTick(Ra)}:(Ga=i(Ga,ca),function(){Ga(Ra)}):(Pa=!0,La=Ba.createTextNode(""),new dt(Ra).observe(La,{characterData:!0}),function(){La.data=Pa=!Pa})),va||function(e){e={fn:e,next:void 0};Ma&&(Ma.next=e),Da||(Da=e,xa()),Ma=e}),za=Me,Y=(Aa.prototype={add:function(e){e={item:e,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},Aa),Qa=Me.Promise,pa="object"==typeof window&&"object"!=typeof Deno,i=Me,Wa=Qa,ca=_e,Ba=Tn,Ya=fr,dt=me,Xa=pa,Ja=ut,Za=(Wa&&Wa.prototype,dt("species")),$a=!1,eo=ca(i.PromiseRejectionEvent),va={CONSTRUCTOR:Ba("Promise",function(){var e=Ya(Wa),t=e!==String(Wa);if(!t&&66===Ja)return!0;if(51<=Ja&&/native code/.test(e))return!1;function n(e){e(function(){},function(){})}e=new Wa(function(e){e(1)});return(e.constructor={})[Za]=n,!($a=e.then(function(){})instanceof n)||!t&&Xa&&!eo}),REJECTION_EVENT:eo,SUBCLASSING:$a},fr={},to=Te,pa=(fr.f=function(e){return new Na(e)},Vn),no=Ui,ro=Me,io=Nt,dt=Hn,ca=Ni,i=Mi,Ba=Ss,so=Te,ao=_e,oo=ge,uo=Cs,co=function(e,t){var e=Xs(e).constructor;return void 0===e||null==(e=Xs(e)[Zs])?t:Js(e)},lo=ga.set,ho=r,fo=function(e,t){var n=za.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},po=ka,vo=Y,ga=dr,r=Qa,Y=fr,_o="Promise",yo=va.CONSTRUCTOR,mo=va.REJECTION_EVENT,go=va.SUBCLASSING,Eo=ga.getterFor(_o),bo=ga.set,ga=r&&r.prototype,Io=r,To=ga,wo=ro.TypeError,So=ro.document,Co=ro.process,ko=Y.f,Ao=ko,No=!!(So&&So.createEvent&&ro.dispatchEvent),Oo="unhandledrejection",Ro="rejectionhandled",Do=1,Mo=2,xo=1,Po=2,Lo=function(e){var t;return!(!oo(e)||!ao(t=e.then))&&t},Uo=function(n,i){n.notified||(n.notified=!0,ho(function(){for(var e,r,t=n.reactions;e=t.get();)Oa(e,n);n.notified=!1,i&&!n.rejection&&(r=n,io(lo,ro,function(){var e=r.facade,t=r.value,n=qo(r);if(n&&(n=po(function(){no?Co.emit("unhandledRejection",t,e):Fo(Oo,e,t)}),r.rejection=no||qo(r)?Po:xo,n.error))throw n.value}))}))},Fo=function(e,t,n){var r;No?((r=So.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),ro.dispatchEvent(r)):r={promise:t,reason:n},!mo&&(t=ro["on"+e])?t(r):e===Oo&&fo("Unhandled promise rejection",n)},qo=function(e){return e.rejection!==xo&&!e.parent},jo=function(t,n,r){return function(e){t(n,e,r)}},Ho=function(e,t,n){e.done||(e.done=!0,(e=n?n:e).value=t,e.state=Mo,Uo(e,!0))},Go=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw wo("Promise can't be resolved itself");var r=Lo(e);r?ho(function(){var t={done:!1};try{io(r,e,jo(Go,t,n),jo(Ho,t,n))}catch(e){Ho(t,e,n)}}):(n.value=e,n.state=Do,Uo(n,!1))}catch(e){Ho({done:!1},e,n)}}};if(yo&&(To=(Io=function(e){uo(this,To),so(e),io(Fa,this);var t=Eo(this);try{e(jo(Go,t),jo(Ho,t))}catch(e){Ho(t,e)}}).prototype,(Fa=function(e){bo(this,{type:_o,done:!1,notified:!1,parent:!1,reactions:new vo,rejection:!1,state:0,value:void 0})}).prototype=dt(To,"then",function(e,t){var n=Eo(this),r=ko(co(this,Io));return n.parent=!0,r.ok=!ao(e)||e,r.fail=ao(t)&&t,r.domain=no?Co.domain:void 0,0==n.state?n.reactions.add(r):ho(function(){Oa(r,n)}),r.promise}),qa=function(){var e=new Fa,t=Eo(e);this.promise=e,this.resolve=jo(Go,t),this.reject=jo(Ho,t)},Y.f=ko=function(e){return e===Io||void 0===e?new qa:Ao(e)},ao(r)&&ga!==Object.prototype)){ja=ga.then,go||dt(ga,"then",function(e,t){var n=this;return new Io(function(e,t){io(ja,n,e,t)}).then(e,t)},{unsafe:!0});try{delete ga.constructor}catch(e){}ca&&ca(ga,To)}pa({global:!0,constructor:!0,wrap:!0,forced:yo},{Promise:Io}),i(Io,_o,!1),Ba(_o);function Vo(e){if(null!=e)return Xo(e,Zo)||Xo(e,"@@iterator")||Jo[Yo(e)]}function Bo(e,t){this.stopped=e,this.result=t}function Ko(e,t,n){function r(e){return s&&yu(s,"normal",e),new Bo(!0,e)}function i(e){return d?(lu(e),v?_(e[0],e[1],r):_(e[0],e[1])):v?_(e,r):_(e)}var s,a,o,u,c,l,h=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),v=!(!n||!n.INTERRUPTED),_=uu(t,h);if(f)s=e.iterator;else if(p)s=e;else{if(!(n=_u(e)))throw mu(hu(e)+" is not iterable");if(du(n)){for(a=0,o=fu(e);a<o;a++)if((u=i(e[a]))&&pu(gu,u))return u;return new Bo(!1)}s=vu(e,n)}for(c=(f?e:s).next;!(l=cu(c,s)).done;){try{u=i(l.value)}catch(e){yu(s,"throw",e)}if("object"==typeof u&&u&&pu(gu,u))return u}return new Bo(!1)}var Qo=t,zo=me("iterator"),Wo=Array.prototype,Yo=n,Xo=we,Jo=t,Zo=me("iterator"),$o=Nt,eu=Te,tu=Ee,nu=Ie,ru=Vo,iu=TypeError,su=Nt,au=Ee,ou=we,uu=Os,cu=Nt,lu=Ee,hu=Ie,du=function(e){return void 0!==e&&(Qo.Array===e||Wo[zo]===e)},fu=Oe,pu=Ot,vu=function(e,t){t=arguments.length<2?ru(e):t;if(eu(t))return tu($o(t,e));throw iu(nu(e)+" is not iterable")},_u=Vo,yu=function(e,t,n){var r,i;au(e);try{if(!(r=ou(e,"return"))){if("throw"===t)throw n;return n}r=su(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return au(r),n},mu=TypeError,gu=Bo.prototype,Eu=me("iterator"),bu=!1;try{var Iu=0,s={next:function(){return{done:!!Iu++}},return:function(){bu=!0}};s[Eu]=function(){return this},Array.from(s,function(){throw 2})}catch(e){}function Tu(e,t){if(!t&&!bu)return!1;var n=!1;try{var r={};r[Eu]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}var wu=Qa,Y=Tu,r=va.CONSTRUCTOR||!Y(function(e){wu.all(e).then(void 0,function(){})}),Su=Nt,Cu=Te,ku=fr,Au=ka,Nu=Ko,go=(Vn({target:"Promise",stat:!0,forced:r},{all:function(e){var o=this,t=ku.f(o),u=t.resolve,c=t.reject,n=Au(function(){var r=Cu(o.resolve),i=[],s=0,a=1;Nu(e,function(e){var t=s++,n=!1;a++,Su(r,o,e).then(function(e){n||(n=!0,i[t]=e,--a||u(i))},c)}),--a||u(i)});return n.error&&c(n.value),t.promise}}),Vn),dt=Qa,ca=ye,ga=_e,pa=Hn,yo=dt&&dt.prototype;go({target:"Promise",proto:!0,forced:va.CONSTRUCTOR,real:!0},{catch:function(e){return this.then(void 0,e)}}),ga(dt)&&(i=ca("Promise").prototype.catch,yo.catch!==i&&pa(yo,"catch",i,{unsafe:!0}));var Ou=Nt,Ru=Te,Du=fr,Mu=ka,xu=Ko;Vn({target:"Promise",stat:!0,forced:r},{race:function(e){var n=this,r=Du.f(n),i=r.reject,t=Mu(function(){var t=Ru(n.resolve);xu(e,function(e){Ou(t,n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}});function Pu(e){if("Symbol"===Ku(e))throw TypeError("Cannot convert a Symbol value to a string");return Qu(e)}function Lu(i){return function(e,t){var n,e=Wu(Yu(e)),t=zu(t),r=e.length;return t<0||r<=t?i?"":void 0:(n=Ju(e,t))<55296||56319<n||t+1===r||(r=Ju(e,t+1))<56320||57343<r?i?Xu(e,t):n:i?Zu(e,t,t+2):r-56320+(n-55296<<10)+65536}}function Uu(t,e){if(t){if(t[uc]!==lc)try{oc(t,uc,lc)}catch(e){t[uc]=lc}if(t[cc]||oc(t,cc,e),sc[e])for(var n in ac)if(t[n]!==ac[n])try{oc(t,n,ac[n])}catch(e){t[n]=ac[n]}}}var Fu,qu=Nt,ju=fr,Hu=(Vn({target:"Promise",stat:!0,forced:va.CONSTRUCTOR},{reject:function(e){var t=ju.f(this);return qu(t.reject,void 0,e),t.promise}}),Ee),Gu=ge,Vu=fr,Ba=Vn,t=ye,s=va.CONSTRUCTOR,Bu=function(e,t){if(Hu(e),Gu(t)&&t.constructor===e)return t;e=Vu.f(e);return(0,e.resolve)(t),e.promise},Ku=(t("Promise"),Ba({target:"Promise",stat:!0,forced:s},{resolve:function(e){return Bu(this,e)}}),n),Qu=String,Y=xe,zu=ke,Wu=Pu,Yu=le,Xu=Y("".charAt),Ju=Y("".charCodeAt),Zu=Y("".slice),Qa={codeAt:Lu(!1),charAt:Lu(!0)},$u=Qa.charAt,ec=Pu,go=dr,ga=Li,tc="String Iterator",nc=go.set,rc=go.getterFor(tc),dt=(ga(String,"String",function(e){nc(this,{type:tc,string:ec(e),index:0})},function(){var e=rc(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=$u(t,n),e.index+=t.length,{value:t,done:!1})}),{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),ca=be("span").classList,pa=ca&&ca.constructor&&ca.constructor.prototype,yo=pa===Object.prototype?void 0:pa,ic=Me,sc=dt,i=yo,ac=Di,oc=yr,r=me,uc=r("iterator"),cc=r("toStringTag"),lc=ac.values;for(Fu in sc)Uu(ic[Fu]&&ic[Fu].prototype,Fu);Uu(i,"DOMTokenList");function hc(e,t){return new(bc(e))(0===t?0:t)}function dc(d){var f=1==d,p=2==d,v=3==d,_=4==d,y=6==d,m=7==d,g=5==d||y;return function(e,t,n,r){for(var i,s,a=wc(e),o=Tc(a),u=Ic(t,n),c=Sc(o),l=0,t=r||Cc,h=f?t(e,c):p||m?t(e,0):void 0;l<c;l++)if((g||l in o)&&(s=u(i=o[l],l,a),d))if(f)h[l]=s;else if(s)switch(d){case 3:return!0;case 5:return i;case 6:return l;case 2:kc(h,i)}else switch(d){case 4:return!1;case 7:kc(h,i)}return y?-1:v||_?_:h}}function fc(t){return 51<=Nc||!Ac(function(){var e=[];return(e.constructor={})[Oc]=function(){return{foo:1}},1!==e[t](Boolean).foo})}var c,pc,vc=ce,va=Array.isArray||function(e){return"Array"==vc(e)},_c=va,yc=Sr,mc=ge,gc=me("species"),Ec=Array,bc=function(e){var t;return _c(e)&&(t=e.constructor,(yc(t)&&(t===Ec||_c(t.prototype))||mc(t)&&null===(t=t[gc]))&&(t=void 0)),void 0===t?Ec:t},Ic=Os,Tc=Pe,wc=pe,Sc=Oe,Cc=hc,kc=xe([].push),t={forEach:dc(0),map:dc(1),filter:dc(2),some:dc(3),every:dc(4),find:dc(5),findIndex:dc(6),filterReject:dc(7)},Ac=ue,Nc=ut,Oc=me("species"),Ba=Vn,Rc=t.map,Dc=(Ba({target:"Array",proto:!0,forced:!fc("map")},{map:function(e){return Rc(this,e,1<arguments.length?arguments[1]:void 0)}}),b(function e(){E(this,e)})),Mc=function(){T(t,Dc);var e=S(t);function t(){return E(this,t),e.call(this)}return b(t,[{key:"getApiOption",value:function(){return{auth:this.getAuth(),path:this.getPath(),method:this.getMethod(),body:this.getData(),headers:this.getHeaders()}}},{key:"getAuth",value:function(){return!0}},{key:"getHeaders",value:function(){return{}}}]),t}(),xc=function(){T(t,Mc);var e=S(t);function t(){return E(this,t),e.call(this)}return b(t,[{key:"getPath",value:function(){return"/v1".concat(this.getSubPath())}}]),t}(),Pc=((s=c=c||{}).CREATE="create",s.UPDATE="update",s.GET="get",s.DELETE="delete",s.QUERY="query",s.READY="ready",s.START="start",s.ENTER_HOST="enter_host",s.GET_HOSTS="get_hosts",s.EXIT_HOST="exit_host",s.HOST_ALIVE="host_alive",s.AUDIO="audio",s.VIDEO="video",s.HOST_CREATE_STREAM="host_create_stream",s.HOST_DELETE_STREAM="host_delete_stream",s.HOST_CONNECTED="host_connected",s.ENTER="enter",s.EXIT="exit",s.ALIVE="alive",s.GET_PARTICIPANTS="get_participants",s.CREATE_STREAM="create_stream",s.DELETE_STREAM="delete_stream",s.CREATE_RTMP_STREAM="create_rtmp_stream",s.DELETE_RTMP_STREAM="delete_rtmp_stream",s.CONNECTED="connected",s.ATTACH="attach",s.CUSTOM_ITEMS_GET="custom_items_get",s.CUSTOM_ITEMS_UPDATE="custom_items_update",s.CUSTOM_ITEMS_DELETE="custom_items_delete",s.LIVE_EVENT_READY="live_event_ready",s.LIVE_EVENT_STARTED="live_event_started",s.LIVE_EVENT_ENDED="live_event_ended",s.LIVE_EVENT_UPDATED="live_event_updated",s.HOST_ENTERED="host_entered",s.HOST_EXITED="host_exited",s.HOST_DISCONNECTED="host_disconnected",s.HOST_AUDIO_STATUS_CHANGED="host_audio_status_changed",s.HOST_VIDEO_STATUS_CHANGED="host_video_status_changed",s.PARTICIPANT_ENTERED="participant_entered",s.PARTICIPANT_EXITED="participant_exited",(n=pc=pc||{}).SINGLE_HOST="single_host",n.MULTIPLE_HOST="multiple_host",function(){T(r,Dc);var n=S(r);function r(e){var t;return E(this,r),(t=n.call(this)).payload=t.parseData(e),t}return b(r)}()),Lc=function(){T(t,Pc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t)}();function Uc(e){return{liveEventId:e.live_event_id,createdAt:e.created_at,setReadyAt:e.set_ready_at,startedAt:e.started_at,endedAt:e.ended_at,state:e.state,isHostStreaming:e.is_host_streaming,createdBy:e.created_by,setReadyBy:e.set_ready_by,startedBy:e.started_by,endedBy:e.ended_by,duration:e.duration,host:e.host?Fc(e.host):void 0,participantCount:e.participant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count,userIdsForHost:e.user_ids_for_host,customItems:e.custom_items,title:e.title,coverUrl:e.cover_url}}function Fc(e){return{hostId:e.host_id,userId:e.user.user_id,nickname:e.user.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,connectedAt:e.connected_at,disconnectedAt:e.disconnected_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,isAudioOn:e.is_audio_on,isVideoOn:e.is_video_on,liveEventId:e.live_event_id,streamType:e.stream_type,rtmpStream:e.rtmp_stream?{rtmpStreamId:(e=e.rtmp_stream).rtmp_stream_id,rtmpHostUrl:e.rtmp_host_url,streamKey:e.stream_key,createdAt:e.created_at}:void 0}}function qc(e){return{id:e.rtcstream_id}}function jc(e){return{participantId:e.participant_id,userId:e.user.user_id,nickname:e.user.nickname,profileURL:e.user.profile_url,enteredAt:e.entered_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,liveEventId:e.live_event_id}}var Y=Vn,Hc=t.filter;Y({target:"Array",proto:!0,forced:!fc("filter")},{filter:function(e){return Hc(this,e,1<arguments.length?arguments[1]:void 0)}});function Gc(e){if(9007199254740991<e)throw zc("Maximum allowed index exceeded");return e}function Vc(e,t,n){(t=Wc(t))in e?Yc.f(e,t,Xc(0,n)):e[t]=n}function Bc(){var e=sl(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}var Kc=pe,Qc=Rn,zc=(Vn({target:"Object",stat:!0,forced:ue(function(){Qc(1)})},{keys:function(e){return Qc(Kc(e))}}),TypeError),Wc=Ce,Yc=e,Xc=jn,go=Vn,ga=ue,Jc=va,Zc=ge,$c=pe,el=Oe,tl=Gc,nl=Vc,rl=hc,ca=fc,pa=ut,il=me("isConcatSpreadable"),Di=51<=pa||!ga(function(){var e=[];return e[il]=!1,e.concat()[0]!==e}),r=ca("concat"),sl=(go({target:"Array",proto:!0,arity:1,forced:!Di||!r},{concat:function(e){for(var t,n,r,i=$c(this),s=rl(i,0),a=0,o=-1,u=arguments.length;o<u;o++)if(function(e){if(!Zc(e))return!1;var t=e[il];return void 0!==t?!!t:Jc(e)}(r=-1===o?i:arguments[o]))for(n=el(r),tl(a+n),t=0;t<n;t++,a++)t in r&&nl(s,a,r[t]);else tl(a+1),nl(s,a++,r);return s.length=a,s}}),Ee),al=Nt,ol=Ye,ul=Ot,cl=Bc,ll=RegExp.prototype,i=wt.PROPER,Ba=Hn,hl=Ee,dl=Pu,n=ue,fl=function(e){var t=e.flags;return void 0!==t||"flags"in ll||ol(e,"flags")||!ul(ll,e)?t:al(cl,e)},Y="toString",pl=RegExp.prototype[Y],pa=n(function(){return"/a/b"!=pl.call({source:"a",flags:"b"})}),ga=i&&pl.name!=Y;function vl(t){return Object.keys(t).filter(function(e){return null!=t[e]}).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(function(e){if(Array.isArray(e))return e.map(function(e){return encodeURIComponent(e.toString())}).join(",");return encodeURIComponent(e.toString())}(t[e]))}).join("&")}(pa||ga)&&Ba(RegExp.prototype,Y,function(){var e=hl(this);return"/"+dl(e.source)+"/"+dl(fl(e))},{unsafe:!0});function _l(e,t){var n=[][e];return!!n&&El(function(){n.call(null,t||function(){return 1},1)})}var yl,ml=function(){T(s,xc);var i=S(s);function s(e,t,n){var r;return E(this,s),I(w(r=i.call(this)),"type",c.QUERY),r.params=r._normalizeParams(e),r.prevToken=t,r.nextToken=n,r}return b(s,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"/live-events?".concat(this._createQuery())}},{key:"getMethod",value:function(){return"GET"}},{key:"_normalizeParams",value:function(e){var t=e.hostType,n=e.liveEventState,r=e.createdAtRange,i=e.participantCountRange,s=e.durationRange,a=e.liveEventIds,o=e.createdByUserIds,e=e.limit;return{hostType:t,liveEventState:n,createdAtRange:r,participantCountRange:i,durationRange:s,liveEventIds:a,createdByUserIds:o,limit:null!=e?Math.min(Math.max(1,e),100):void 0}}},{key:"_createQuery",value:function(){var e;return vl({host_type:this.params.hostType,state:this.params.liveEventState,created_at_start_date:null==(e=this.params.createdAtRange)?void 0:e[0],created_at_end_date:null==(e=this.params.createdAtRange)?void 0:e[0],participant_count_gte:null==(e=this.params.participantCountRange)?void 0:e[0],participant_count_lte:null==(e=this.params.participantCountRange)?void 0:e[1],duration_range_gte:null==(e=this.params.durationRange)?void 0:e[0],duration_range_lte:null==(e=this.params.durationRange)?void 0:e[1],live_event_ids:this.params.liveEventIds,created_by_user_ids:this.params.createdByUserIds,limit:this.params.limit,prev:this.prevToken,next:this.nextToken})}}]),s}(),gl=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){var t;return{liveEvents:null==(t=e.live_events)?void 0:t.map(Uc),prev:e.prev,next:e.next}}}]),t}(),El=ue,ca=Vn,go=xe,bl=bn.indexOf,Di=_l,Il=go([].indexOf),Tl=!!Il&&1/Il([1],1,-0)<0,r=Di("indexOf"),wl=(ca({target:"Array",proto:!0,forced:Tl||!r},{indexOf:function(e){var t=1<arguments.length?arguments[1]:void 0;return Tl?Il(this,e,t)||0:bl(this,e,t)}}),Ie),Sl=TypeError,wt=Vn,Cl=pe,kl=Ae,Al=ke,Nl=Oe,Ol=Gc,Rl=hc,Dl=Vc,Ml=function(e,t){if(!delete e[t])throw Sl("Cannot delete property "+wl(t)+" of "+wl(e))},n=fc("splice"),xl=Math.max,Pl=Math.min;wt({target:"Array",proto:!0,forced:!n},{splice:function(e,t){var n,r,i,s,a,o,u=Cl(this),c=Nl(u),l=kl(e,c),e=arguments.length;for(0===e?n=r=0:r=1===e?(n=0,c-l):(n=e-2,Pl(xl(Al(t),0),c-l)),Ol(c+n-r),i=Rl(u,r),s=0;s<r;s++)(a=l+s)in u&&Dl(i,s,u[a]);if(n<(i.length=r)){for(s=l;s<c-r;s++)o=s+n,(a=s+r)in u?u[o]=u[a]:Ml(u,o);for(s=c;c-r+n<s;s--)Ml(u,s-1)}else if(r<n)for(s=c-r;l<s;s--)o=s+n-1,(a=s+r-1)in u?u[o]=u[a]:Ml(u,o);for(s=0;s<n;s++)u[s+l]=arguments[s+2];return u.length=c-r+n,i}}),(i=yl=yl||{}).VERBOSE="VERBOSE",i.DEBUG="DEBUG",i.INFO="INFO",i.WARNING="WARNING",i.ERROR="ERROR",i.NONE="NONE";var C=new(function(){function e(){E(this,e),this._listeners=[]}return b(e,[{key:"verbose",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[yl.VERBOSE].concat(t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[yl.DEBUG].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[yl.INFO].concat(t))}},{key:"warning",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[yl.WARNING].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._log.apply(this,[yl.ERROR].concat(t))}},{key:"_log",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,s=Q(this._listeners);try{for(s.s();!(i=s.n()).done;){var a=i.value;a._permit.apply(a,[e].concat(n))}}catch(e){s.e(e)}finally{s.f()}}},{key:"addListener",value:function(e){this._listeners.push(e)}},{key:"removeListener",value:function(e){e=this._listeners.indexOf(e);-1!==e&&this._listeners.splice(e,1)}},{key:"removeAllListener",value:function(){this._listeners=[]}}]),e}()),Ll=function(){function r(e,t,n){E(this,r),this.isLoading=!1,this.params=e,this.sender=t,this.prevToken=null,this.nextToken=null,this.liveEventManager=n}var n,e,t;return b(r,[{key:"hasPrev",get:function(){return!!this.prevToken}},{key:"hasNext",get:function(){return!this.prevToken&&!this.nextToken||!!this.nextToken}},{key:"next",value:(t=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading)throw new Error("query is in progress");e.next=2;break;case 2:if(this.hasNext){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(null,this.nextToken));case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"prev",value:(e=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading)throw new Error("query is in progress");e.next=2;break;case 2:if(this.hasPrev){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(this.prevToken,null));case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_sendQueryCommand",value:(n=g(regeneratorRuntime.mark(function e(t,n){var r,i,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n)throw new Error("internal error while creating LiveEventListQueryCommand");e.next=2;break;case 2:return this.isLoading=!0,r=new ml(this.params,t,n),e.next=6,this.sender.send(r);case 6:return r=e.sent,i=r.payload,this.prevToken=i.prev,this.nextToken=i.next,this.isLoading=!1,e.prev=11,e.abrupt("return",Promise.all(i.liveEvents.map(function(e){return s.liveEventManager.deserializeLiveEvent(e)})));case 15:return e.prev=15,e.t0=e.catch(11),C.error(e.t0),e.abrupt("return",i.liveEvents);case 19:case"end":return e.stop()}},e,this,[[11,15]])})),function(e,t){return n.apply(this,arguments)})}]),r}(),pa=Vn,Ul=t.find,ga=qn,Ba="find",Fl=!0,Y=(Ba in[]&&Array(1)[Ba](function(){Fl=!1}),pa({target:"Array",proto:!0,forced:Fl},{find:function(e){return Ul(this,e,1<arguments.length?arguments[1]:void 0)}}),ga(Ba),Vn),ql=t.findIndex,go=qn,Di="findIndex",jl=!0,ca=(Di in[]&&Array(1)[Di](function(){jl=!1}),Y({target:"Array",proto:!0,forced:jl},{findIndex:function(e){return ql(this,e,1<arguments.length?arguments[1]:void 0)}}),go(Di),{exports:{}}),r={},Hl=Ae,Gl=Oe,Vl=Vc,Bl=Array,Kl=Math.max,Ql=ce,zl=he,Wl=wr.f,Yl=function(e,t,n){for(var r=Gl(e),i=Hl(t,r),s=Hl(void 0===n?r:n,r),a=Bl(Kl(s-i,0)),o=0;i<s;i++,o++)Vl(a,o,e[i]);return a.length=o,a},Xl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];r.f=function(e){if(!Xl||"Window"!=Ql(e))return Wl(zl(e));try{return Wl(e)}catch(e){return Yl(Xl)}};function Jl(e){lh(e,_h,{value:{objectID:"O"+yh++,weakData:{}}})}function Zl(e,t,n){return bh&&gh(t=t.constructor)&&t!==n&&Eh(t=t.prototype)&&t!==n.prototype&&bh(e,t),e}function $l(t){if(t&&t.forEach!==Lf)try{Uf(t,"forEach",Lf)}catch(e){t.forEach=Lf}}var eh,th,wt=ue(function(){var e;"function"==typeof ArrayBuffer&&(e=new ArrayBuffer(8),Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8}))}),n=ue,nh=ge,rh=ce,ih=wt,sh=Object.isExtensible,i=n(function(){sh(1)})||ih?function(e){return!!nh(e)&&((!ih||"ArrayBuffer"!=rh(e))&&(!sh||sh(e)))}:sh,pa=!ue(function(){return Object.isExtensible(Object.preventExtensions({}))}),ah=Vn,oh=xe,ga=In,uh=ge,ch=Ye,lh=e.f,hh=wr,dh=r,fh=i,ph=pa,vh=!1,_h=ve("meta"),yh=0,mh=ca.exports={enable:function(){mh.enable=function(){},vh=!0;var i=hh.f,s=oh([].splice),e={};e[_h]=1,i(e).length&&(hh.f=function(e){for(var t=i(e),n=0,r=t.length;n<r;n++)if(t[n]===_h){s(t,n,1);break}return t},ah({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:dh.f}))},fastKey:function(e,t){if(!uh(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!ch(e,_h)){if(!fh(e))return"F";if(!t)return"E";Jl(e)}return e[_h].objectID},getWeakData:function(e,t){if(!ch(e,_h)){if(!fh(e))return!0;if(!t)return!1;Jl(e)}return e[_h].weakData},onFreeze:function(e){return ph&&vh&&fh(e)&&!ch(e,_h)&&Jl(e),e}},gh=(ga[_h]=!0,_e),Eh=ge,bh=Ni,Ih=Vn,Th=Me,wh=xe,Sh=Tn,Ch=Hn,kh=ca.exports,Ah=Ko,Nh=Cs,Oh=_e,Rh=ge,Dh=ue,Mh=Tu,xh=Mi,Ph=Zl,Lh=Hn,Uh=e.f,Fh=ot,qh=function(e,t,n){for(var r in t)Lh(e,r,t[r],n);return e},jh=Os,Hh=Cs,Gh=Ko,Vh=Li,Bh=Ss,Kh=ct,Qh=ca.exports.fastKey,zh=dr.set,Wh=dr.getterFor,Yh=(function(e,t,n){function r(e){var n=wh(f[e]);Ch(f,e,"add"==e?function(e){return n(this,0===e?0:e),this}:"delete"==e?function(e){return!(l&&!Rh(e))&&n(this,0===e?0:e)}:"get"==e?function(e){return l&&!Rh(e)?void 0:n(this,0===e?0:e)}:"has"==e?function(e){return!(l&&!Rh(e))&&n(this,0===e?0:e)}:function(e,t){return n(this,0===e?0:e,t),this})}var i,s,a,o,u,c=-1!==e.indexOf("Map"),l=-1!==e.indexOf("Weak"),h=c?"set":"add",d=Th[e],f=d&&d.prototype,p=d,v={};return Sh(e,!Oh(d)||!(l||f.forEach&&!Dh(function(){(new d).entries().next()})))?(p=n.getConstructor(t,e,c,h),kh.enable()):Sh(e,!0)&&(s=(i=new p)[h](l?{}:-0,1)!=i,a=Dh(function(){i.has(1)}),o=Mh(function(e){new d(e)}),u=!l&&Dh(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),o||(((p=t(function(e,t){Nh(e,f);e=Ph(new d,e,p);return null!=t&&Ah(t,e[h],{that:e,AS_ENTRIES:c}),e})).prototype=f).constructor=p),(a||u)&&(r("delete"),r("has"),c&&r("get")),(u||s)&&r(h),l&&f.clear&&delete f.clear),v[e]=p,Ih({global:!0,constructor:!0,forced:p!=d},v),xh(p,e),l||n.setStrong(p,e,c),p}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,n,r,i){function s(e,t,n){var r,i=u(e),s=a(e,t);return s?s.value=n:(i.last=s={index:r=Qh(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=s),t&&(t.next=s),Kh?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e}function a(e,t){var n,e=u(e),r=Qh(t);if("F"!==r)return e.index[r];for(n=e.first;n;n=n.next)if(n.key==t)return n}var e=e(function(e,t){Hh(e,o),zh(e,{type:n,index:Fh(null),first:void 0,last:void 0,size:0}),Kh||(e.size=0),null!=t&&Gh(t,e[i],{that:e,AS_ENTRIES:r})}),o=e.prototype,u=Wh(n);return qh(o,{clear:function(){for(var e=u(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Kh?e.size=0:this.size=0},delete:function(e){var t,n,r=u(this),e=a(this,e);return e&&(t=e.next,n=e.previous,delete r.index[e.index],e.removed=!0,n&&(n.next=t),t&&(t.previous=n),r.first==e&&(r.first=t),r.last==e&&(r.last=n),Kh?r.size--:this.size--),!!e},forEach:function(e){for(var t,n=u(this),r=jh(e,1<arguments.length?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),qh(o,r?{get:function(e){e=a(this,e);return e&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Kh&&Uh(o,"size",{get:function(){return u(this).size}}),e},setStrong:function(e,t,n){var r=t+" Iterator",i=Wh(t),s=Wh(r);Vh(e,t,function(e,t){zh(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),Bh(t)}}),ct),Ba=xe,Xh=Nt,Y=ue,Jh=Rn,Zh=mr,$h=Ar,ed=pe,td=Pe,nd=Object.assign,rd=Object.defineProperty,id=Ba([].concat),go=!nd||Y(function(){if(Yh&&1!==nd({b:1},nd(rd({},"a",{enumerable:!0,get:function(){rd(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=nd({},e)[n]||Jh(nd({},t)).join("")!=r})?function(e,t){for(var n=ed(e),r=arguments.length,i=1,s=Zh.f,a=$h.f;i<r;)for(var o,u=td(arguments[i++]),c=s?id(Jh(u),s(u)):Jh(u),l=c.length,h=0;h<l;)o=c[h++],Yh&&!Xh(a,u,o)||(n[o]=u[o]);return n}:nd,Di=(Vn({target:"Object",stat:!0,arity:2,forced:Object.assign!==go},{assign:go}),Vn),sd=bn.includes,wt=qn,ad=(Di({target:"Array",proto:!0,forced:ue(function(){return!Array(1).includes()})},{includes:function(e){return sd(this,e,1<arguments.length?arguments[1]:void 0)}}),wt("includes"),ge),od=ce,ud=me("match"),cd=function(e){var t;return ad(e)&&(void 0!==(t=e[ud])?!!t:"RegExp"==od(e))},ld=TypeError,hd=me("match"),n=Vn,dd=function(e){if(cd(e))throw ld("The method doesn't accept regular expressions");return e},fd=le,pd=Pu,In=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[hd]=!1,"/./"[t](n)}catch(e){}}return!1},vd=xe("".indexOf),_d=(n({target:"String",proto:!0,forced:!In("includes")},{includes:function(e){return!!~vd(pd(fd(this)),pd(dd(e)),1<arguments.length?arguments[1]:void 0)}}),D.LiveEventRole=void 0,(r=D.LiveEventRole||(D.LiveEventRole={})).HOST="host",r.PARTICIPANT="participant",D.LiveEventState=void 0,(i=D.LiveEventState||(D.LiveEventState={})).CREATED="created",i.READY="ready",i.ONGOING="ongoing",i.PAUSED="paused",i.ENDED="ended",D.HostState=void 0,(pa=D.HostState||(D.HostState={})).ENTERED="entered",pa.CONNECTED="connected",pa.DISCONNECTED="disconnected",pa.EXITED="exited",D.ParticipantState=void 0,(ga=D.ParticipantState||(D.ParticipantState={})).ENTERED="entered",ga.EXITED="exited",function(){T(s,Mc);var i=S(s);function s(e,t,n){var r;return E(this,s),(r=i.call(this)).appId=e,r.userId=t,r.accessToken=n,r}return b(s,[{key:"getAuth",value:function(){return!1}},{key:"getData",value:function(){return{app_id:this.appId,user_id:this.userId,access_token:this.accessToken}}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/login")}},{key:"getMethod",value:function(){return"POST"}}]),s}()),yd=((Ni=eh=eh||{}).POST="POST",Ni.GET="GET",Ni.DELETE="DELETE",Ni.OPTION="OPTION",Ni.PUT="PUT",function(){T(u,xc);var o=S(u);function u(e,t,n,r,i,s){var a;return E(this,u),I(w(a=o.call(this)),"type",c.CREATE),a.hostType=e,a.hostIds=Array.isArray(t)?t:[t],a.title=null===n?"":n,a.coverUrl=null===r?"":r,a.coverFile=null===i?"":i,a.customItems=s,a}return b(u,[{key:"getData",value:function(){function e(e,t,n,r){void 0!==n&&i.set(t,n)}var i=new FormData;return e(0,"host_type",this.hostType),e(0,"user_ids_for_host",String(this.hostIds)),e(0,"title",this.title),e(0,"cover_url",this.coverUrl),e(0,"cover_file",this.coverFile),e(0,"customItems",JSON.stringify(this.customItems)),i}},{key:"getSubPath",value:function(){return"/live-events"}},{key:"getMethod",value:function(){return eh.POST}}]),u}()),md=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEvent:Uc(e.live_event)}}}]),t}(),gd=function(){T(r,xc);var n=S(r);function r(e){var t;return E(this,r),I(w(t=n.call(this)),"type",c.GET),t.liveEventId=e,t}return b(r,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return eh.GET}}]),r}(),Ed=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEvent:Uc(e.live_event)}}}]),t}(),bd=function(){T(i,xc);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"type",c.ENTER_HOST),I(w(n),"mediaOption",{turnAudioOn:!0,turnVideoOn:!0}),n.liveEventId=e,n.mediaOption=t,n}return b(i,[{key:"getData",value:function(){return{is_audio_on:this.mediaOption.turnAudioOn,is_video_on:this.mediaOption.turnVideoOn}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts")}},{key:"getMethod",value:function(){return eh.POST}}]),i}(),Id=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{host:Fc(e.host)}}}]),t}(),Td=function(){T(r,xc);var n=S(r);function r(e){var t;return E(this,r),I(w(t=n.call(this)),"type",c.READY),t.liveEventId=e,t}return b(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/ready")}},{key:"getMethod",value:function(){return eh.POST}}]),r}(),wd=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEvent:Uc(e.live_event)}}}]),t}(),Sd=function(){T(r,xc);var n=S(r);function r(e){var t;return E(this,r),I(w(t=n.call(this)),"type",c.START),t.liveEventId=e,t}return b(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/start")}},{key:"getMethod",value:function(){return eh.POST}}]),r}(),Cd=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEvent:Uc(e.live_event)}}}]),t}(),kd=function(){T(i,xc);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"type",c.EXIT_HOST),n.liveEventId=e,n.hostId=t,n}return b(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId)}},{key:"getMethod",value:function(){return eh.DELETE}}]),i}(),Ad=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{host:Fc(e.host)}}}]),t}(),Nd=function(){T(r,xc);var n=S(r);function r(e){var t;return E(this,r),I(w(t=n.call(this)),"type",c.DELETE),t.liveEventId=e,t}return b(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return eh.DELETE}}]),r}(),Od=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEvent:Uc(e.live_event)}}}]),t}(),Rd=function(){T(r,xc);var n=S(r);function r(e){var t;return E(this,r),I(w(t=n.call(this)),"type",c.ENTER),t.liveEventId=e,t}return b(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants")}},{key:"getMethod",value:function(){return eh.POST}}]),r}(),Dd=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{participant:jc(e.participant)}}}]),t}(),Md=function(){T(i,xc);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"type",c.EXIT),n.liveEventId=e,n.participantId=t,n}return b(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId)}},{key:"getMethod",value:function(){return eh.DELETE}}]),i}(),xd=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{participant:jc(e.participant)}}}]),t}(),Pd=function(){T(s,xc);var i=S(s);function s(e,t,n){var r;return E(this,s),I(w(r=i.call(this)),"type",c.CONNECTED),r.liveEventId=e,r.participantId=t,r.endpointId=n,r}return b(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId,"/connected")}},{key:"getMethod",value:function(){return eh.POST}}]),s}(),Ld=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{endpoint:qc(e.rtcstream)}}}]),t}(),Ud=function(){T(s,xc);var i=S(s);function s(e,t,n){var r;return E(this,s),I(w(r=i.call(this)),"type",c.HOST_CONNECTED),r.liveEventId=e,r.hostId=t,r.endpointId=n,r}return b(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams/").concat(this.endpointId,"/connected")}},{key:"getMethod",value:function(){return eh.POST}}]),s}(),Fd=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{endpoint:qc(e.rtcstream)}}}]),t}(),qd=function(){T(s,xc);var i=S(s);function s(e,t,n){var r;return E(this,s),I(w(r=i.call(this)),"type",c.DELETE_STREAM),r.liveEventId=e,r.participantId=t,r.endpointId=n,r}return b(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId)}},{key:"getMethod",value:function(){return eh.DELETE}}]),s}(),jd=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Hd=function(){T(s,xc);var i=S(s);function s(e,t,n){var r;return E(this,s),I(w(r=i.call(this)),"type",c.HOST_DELETE_STREAM),r.liveEventId=e,r.hostId=t,r.endpointId=n,r}return b(s,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams/").concat(this.endpointId)}},{key:"getMethod",value:function(){return eh.DELETE}}]),s}(),Gd=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Vd=function(){T(a,xc);var s=S(a);function a(e,t,n,r){var i;return E(this,a),I(w(i=s.call(this)),"type",c.ATTACH),i.liveEventId=e,i.participantId=t,i.endpointId=n,i.attachTo=r,i}return b(a,[{key:"getData",value:function(){return{attach_to:this.attachTo}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams/").concat(this.endpointId,"/attach")}},{key:"getMethod",value:function(){return eh.POST}}]),a}(),Bd=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{endpoint:qc(e.rtcstream)}}}]),t}(),Kd=function(){T(r,Dc);var n=S(r);function r(e){var t;return E(this,r),(t=n.call(this)).type=e.type,t.version=e.version,t.messageId=e.message_id,t.payload=t.parseData(e.payload),t}return b(r)}(),Qd=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:Uc(e.live_event)}}}]),t}(),zd=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:Uc(e.live_event)}}}]),t}(),Wd=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:Uc(e.live_event)}}}]),t}(),Yd=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fc(e.host)}}}]),t}(),Xd=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fc(e.host)}}}]),t}(),Jd=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fc(e.host)}}}]),t}(),Zd=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fc(e.host)}}}]),t}(),$d=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fc(e.host)}}}]),t}(),ef=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,participant:jc(e.participant),participantCount:e.participant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}]),t}(),tf=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,participant:jc(e.participant),participantCount:e.participant_count,peakParticipantCount:e.peak_participant_count,cumulativeParticipantCount:e.cumulative_participant_count}}}]),t}(),nf=function(){T(o,xc);var a=S(o);function o(e,t,n,r,i){var s;return E(this,o),I(w(s=a.call(this)),"type",c.CREATE_STREAM),s.liveEventId=e,s.participantId=t,s.sdp=n,s.audioAttr=r,s.videoAttr=i,s}return b(o,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/rtcstreams")}},{key:"getMethod",value:function(){return eh.POST}}]),o}(),rf=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{sdp:e.sdp,endpoint:qc(e.rtcstream)}}}]),t}(),sf=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{hosts:e.hosts.map(Fc)}}}]),t}(),af=function(){T(i,xc);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"type",c.HOST_ALIVE),n.liveEventId=e,n.hostId=t,n}return b(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/alive")}},{key:"getMethod",value:function(){return eh.POST}}]),i}(),of=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{}}}]),t}(),uf=function(){T(o,xc);var a=S(o);function o(e,t,n,r,i){var s;return E(this,o),I(w(s=a.call(this)),"type",c.HOST_CREATE_STREAM),s.liveEventId=e,s.hostId=t,s.sdp=n,s.audioAttr=r,s.videoAttr=i,s}return b(o,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.audioAttr,video_attr:this.videoAttr}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/rtcstreams")}},{key:"getMethod",value:function(){return eh.POST}}]),o}(),cf=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{sdp:e.sdp,endpoint:qc(e.rtcstream)}}}]),t}(),lf=function(){T(i,xc);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"type",c.ALIVE),n.liveEventId=e,n.participantId=t,n}return b(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/participants/").concat(this.participantId,"/alive")}},{key:"getMethod",value:function(){return eh.POST}}]),i}(),hf=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{}}}]),t}(),df=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{participant:jc(e.participant)}}}]),t}(),ff=function(){T(s,xc);var i=S(s);function s(e,t,n){var r;return E(this,s),I(w(r=i.call(this)),"type",c.AUDIO),r.liveEventId=e,r.hostId=t,r.on=n,r}return b(s,[{key:"getData",value:function(){return{on:this.on}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/audio")}},{key:"getMethod",value:function(){return eh.POST}}]),s}(),pf=function(){T(s,xc);var i=S(s);function s(e,t,n){var r;return E(this,s),I(w(r=i.call(this)),"type",c.VIDEO),r.liveEventId=e,r.hostId=t,r.on=n,r}return b(s,[{key:"getData",value:function(){return{on:this.on}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/hosts/").concat(this.hostId,"/video")}},{key:"getMethod",value:function(){return eh.POST}}]),s}(),vf=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,host:Fc(e.host)}}}]),t}(),_f=function(){T(o,xc);var a=S(o);function o(e,t,n,r,i){var s;return E(this,o),I(w(s=a.call(this)),"type",c.UPDATE),s.liveEventId=e,s.hostIds=null===t?"":Array.isArray(t)?t:[t],s.title=null===n?"":n,s.coverUrl=null===r?"":r,s.coverFile=null===i?"":i,s}return b(o,[{key:"getData",value:function(){function e(e,t,n,r){void 0!==n&&i.set(t,n)}var i=new FormData;return e(0,"user_ids_for_host",String(this.hostIds)),e(0,"title",this.title),e(0,"cover_url",this.coverUrl),e(0,"cover_file",this.coverFile),i}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId)}},{key:"getMethod",value:function(){return eh.PUT}}]),o}(),yf=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEvent:Uc(e.live_event)}}}]),t}(),mf=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,liveEvent:Uc(e.live_event)}}}]),t}(),gf=function(){T(r,xc);var n=S(r);function r(e){var t;return E(this,r),I(w(t=n.call(this)),"type",c.CUSTOM_ITEMS_GET),t.liveEventId=e,t}return b(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return eh.GET}}]),r}(),Ef=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{customItems:e.custom_items}}}]),t}(),bf=function(){T(i,xc);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"type",c.CUSTOM_ITEMS_UPDATE),n.liveEventId=e,n.customItems=t,n}return b(i,[{key:"getData",value:function(){return this.customItems}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return eh.PUT}}]),i}(),If=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{customItems:e.custom_items,updatedKeys:e.updated_keys,updatedAt:e.updated_at}}}]),t}(),Tf=function(){T(i,xc);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"type",c.CUSTOM_ITEMS_DELETE),n.liveEventId=e,n.keys=t,n}return b(i,[{key:"getData",value:function(){return this.keys}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return eh.DELETE}}]),i}(),wf=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{customItems:e.custom_items,deletedKeys:e.deleted_keys,deletedAt:e.deleted_at}}}]),t}(),Sf=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,updatedAt:e.updated_at,customItems:e.custom_items,updatedKeys:e.updated_keys}}}]),t}(),Cf=function(){T(t,Kd);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{liveEventId:e.live_event_id,deletedAt:e.deleted_at,customItems:e.custom_items,deletedKeys:e.deleted_keys}}}]),t}(),kf=function(){T(r,xc);var n=S(r);function r(e){var t;return E(this,r),I(w(t=n.call(this)),"type",c.CUSTOM_ITEMS_DELETE),t.liveEventId=e,t}return b(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/custom-items")}},{key:"getMethod",value:function(){return eh.DELETE}}]),r}(),Af=function(){T(r,xc);var n=S(r);function r(e){var t;return E(this,r),I(w(t=n.call(this)),"type",c.CREATE_RTMP_STREAM),t.liveEventId=e,t}return b(r,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/rtmp-streams")}},{key:"getMethod",value:function(){return eh.POST}}]),r}(),Nf=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{host:Fc(e.host)}}}]),t}(),Of=function(){T(i,xc);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"type",c.DELETE_RTMP_STREAM),n.liveEventId=e,n.rtmpStreamId=t,n}return b(i,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/live-events/".concat(this.liveEventId,"/rtmp-streams/").concat(this.rtmpStreamId)}},{key:"getMethod",value:function(){return eh.DELETE}}]),i}(),Rf=function(){T(t,Lc);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"parseData",value:function(e){return{}}}]),t}(),Df=function(){function e(){E(this,e)}return b(e,null,[{key:"createAuth",value:function(e,t,n){return new _d(e,t,n)}},{key:"createLiveEvent",value:function(e,t,n,r,i,s){return new yd(e,t,n,r,i,s)}},{key:"updateLiveEvent",value:function(e,t,n,r,i){return new _f(e,t,n,r,i)}},{key:"createGetLiveEvent",value:function(e){return new gd(e)}},{key:"createEnterHost",value:function(e,t){return new bd(e,t)}},{key:"createReady",value:function(e){return new Td(e)}},{key:"createStart",value:function(e){return new Sd(e)}},{key:"createExitHost",value:function(e,t){return new kd(e,t)}},{key:"createEndLiveEvent",value:function(e){return new Nd(e)}},{key:"createEnter",value:function(e){return new Rd(e)}},{key:"createExit",value:function(e,t){return new Md(e,t)}},{key:"createConnected",value:function(e,t,n){return new Pd(e,t,n)}},{key:"createHostConnected",value:function(e,t,n){return new Ud(e,t,n)}},{key:"createStream",value:function(e,t,n,r,i){return new nf(e,t,n,r,i)}},{key:"createHostCreateStream",value:function(e,t,n,r,i){return new uf(e,t,n,r,i)}},{key:"createDeleteStream",value:function(e,t,n){return new qd(e,t,n)}},{key:"createHostDeleteStream",value:function(e,t,n){return new Hd(e,t,n)}},{key:"createRTMPStream",value:function(e){return new Af(e)}},{key:"deleteRTMPStream",value:function(e,t){return new Of(e,t)}},{key:"createAttach",value:function(e,t,n,r){return new Vd(e,t,n,r)}},{key:"createAudio",value:function(e,t,n){return new ff(e,t,n)}},{key:"createVideo",value:function(e,t,n){return new pf(e,t,n)}},{key:"createAlive",value:function(e,t){return new lf(e,t)}},{key:"createHostAlive",value:function(e,t){return new af(e,t)}},{key:"createGetCustomItems",value:function(e){return new gf(e)}},{key:"createUpdateCustomItems",value:function(e,t){return new bf(e,t)}},{key:"createDeleteCustomItems",value:function(e,t){return new Tf(e,t)}},{key:"createDeleteAllCustomItems",value:function(e){return new kf(e)}},{key:"parseResponse",value:function(e,t){try{switch(e.type){case c.CREATE:return new md(t);case c.GET:return new Ed(t);case c.DELETE:return new Od(t);case c.QUERY:return new gl(t);case c.READY:return new wd(t);case c.START:return new Cd(t);case c.ENTER_HOST:return new Id(t);case c.GET_HOSTS:return new sf(t);case c.EXIT_HOST:return new Ad(t);case c.HOST_ALIVE:return new of(t);case c.AUDIO:return new Zd(t);case c.VIDEO:return new $d(t);case c.HOST_CREATE_STREAM:return new cf(t);case c.HOST_DELETE_STREAM:return new Gd(t);case c.HOST_CONNECTED:return new Fd(t);case c.ENTER:return new Dd(t);case c.EXIT:return new xd(t);case c.ALIVE:return new hf(t);case c.GET_PARTICIPANTS:return new df(t);case c.CREATE_STREAM:return new rf(t);case c.DELETE_STREAM:return new jd(t);case c.CONNECTED:return new Ld(t);case c.ATTACH:return new Bd(t);case c.UPDATE:return new yf(t);case c.CUSTOM_ITEMS_GET:return new Ef(t);case c.CUSTOM_ITEMS_UPDATE:return new If(t);case c.CUSTOM_ITEMS_DELETE:return new wf(t);case c.CREATE_RTMP_STREAM:return new Nf(t);case c.DELETE_RTMP_STREAM:return new Rf(t)}}catch(e){return}}},{key:"parse",value:function(e){if("live"===e.call_type)try{switch(e.type){case c.LIVE_EVENT_READY:return new Qd(e);case c.LIVE_EVENT_STARTED:return new zd(e);case c.LIVE_EVENT_ENDED:return new Wd(e);case c.LIVE_EVENT_UPDATED:return new mf(e);case c.HOST_ENTERED:return new Yd(e);case c.HOST_EXITED:return new Xd(e);case c.HOST_CONNECTED:return new Jd(e);case c.HOST_DISCONNECTED:return new vf(e);case c.HOST_AUDIO_STATUS_CHANGED:return new Zd(e);case c.HOST_VIDEO_STATUS_CHANGED:return new $d(e);case c.PARTICIPANT_ENTERED:return new ef(e);case c.PARTICIPANT_EXITED:return new tf(e);case c.CUSTOM_ITEMS_UPDATE:return new Sf(e);case c.CUSTOM_ITEMS_DELETE:return new Cf(e)}}catch(e){return}}}]),e}(),Mf=t.forEach,xf=Me,Pf=dt,ca=yo,Lf=_l("forEach")?[].forEach:function(e){return Mf(this,e,1<arguments.length?arguments[1]:void 0)},Uf=yr;for(th in Pf)Pf[th]&&$l(xf[th]&&xf[th].prototype);$l(ca);function Ff(n,e,t,r){var a,i=bp(n),o=!Ep(function(){var e={};return e[i]=function(){return 7},7!=""[n](e)}),s=o&&!Ep(function(){var e=!1,t=/a/;return"split"===n&&((t={constructor:{}}).constructor[Tp]=function(){return t},t.flags="",t[i]=/./[i]),t.exec=function(){return e=!0,null},t[i](""),!e});o&&s&&!t||(a=yp(/./[i]),s=e(i,""[n],function(e,t,n,r,i){var e=yp(e),s=t.exec;return s===gp||s===wp.exec?o&&!i?{done:!0,value:a(t,n,r)}:{done:!0,value:e(n,t,r)}:{done:!1}}),mp(String.prototype,n,s[0]),mp(wp,i,s[1])),r&&Ip(wp[i],"sham",!0)}function qf(e,t,n){return t+(n?Sp(e,t).length:1)}function jf(e,t){var n=e.exec;if(Pp(n))return null!==(n=Mp(n,e,t))&&xp(n),n;if("RegExp"===Lp(e))return Mp(Up,e,t);throw Fp("RegExp#exec called on incompatible receiver")}var Rn=Vn,Hf=va,Gf=Sr,Vf=ge,Bf=Ae,Kf=Oe,Qf=he,zf=Vc,mr=me,Wf=Oi,Ar=fc("slice"),Yf=mr("species"),Xf=Array,Jf=Math.max,Zf=(Rn({target:"Array",proto:!0,forced:!Ar},{slice:function(e,t){var n,r,i,s=Qf(this),a=Kf(s),o=Bf(e,a),u=Bf(void 0===t?a:t,a);if(Hf(s)&&(n=s.constructor,(n=Gf(n)&&(n===Xf||Hf(n.prototype))||Vf(n)&&null===(n=n[Yf])?void 0:n)===Xf||void 0===n))return Wf(s,o,u);for(r=new(void 0===n?Xf:n)(Jf(u-o,0)),i=0;o<u;o++,i++)o in s&&zf(r,i,s[o]);return r.length=i,r}}),function(){function e(){E(this,e),I(this,"_listeners",{}),I(this,"on",this.addEventListener),I(this,"off",this.removeEventListener)}return b(e,[{key:"addEventListener",value:function(e,t){var n=this;return e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t),function(){return n.removeEventListener(e,t)}}},{key:"once",value:function(t,n){var r=this;return this.on(t,function e(){n.apply(void 0,arguments),r.removeEventListener(t,e)})}},{key:"removeEventListener",value:function(e,t){if(e in this._listeners)for(var n=this._listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"removeAllEventListeners",value:function(){this._listeners={}}},{key:"_dispatchEvent",value:function(e){if(e in this._listeners){for(var t=this._listeners[e].slice(),n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var s,a=0,o=t.length;a<o;a++)(s=t[a]).call.apply(s,[this].concat(r))}}}]),e}()),Ba=ue,$f=Me.RegExp,Y=Ba(function(){var e=$f("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),go=Y||Ba(function(){return!$f("a","y").sticky}),bn={BROKEN_CARET:Y||Ba(function(){var e=$f("^r","gy");return e.lastIndex=2,null!=e.exec("str")}),MISSED_STICKY:go,UNSUPPORTED_Y:Y},Di=ue,ep=Me.RegExp,wt=Di(function(){var e=ep(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}),n=ue,tp=Me.RegExp,In=n(function(){var e=tp("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}),np=Nt,r=xe,rp=Pu,ip=Bc,i=bn,pa=W.exports,sp=ot,ap=dr.get,ga=wt,Ni=In,op=pa("native-string-replace",String.prototype.replace),up=RegExp.prototype.exec,cp=up,lp=r("".charAt),hp=r("".indexOf),dp=r("".replace),fp=r("".slice),pp=(t=/b*/g,np(up,dt=/a/,"a"),np(up,t,"a"),0!==dt.lastIndex||0!==t.lastIndex),vp=i.BROKEN_CARET,_p=void 0!==/()??/.exec("")[1],yo=cp=pp||_p||vp||ga||Ni?function(e){var t,n,r,i,s,a,o=this,u=ap(o),e=rp(e),c=u.raw;if(c)return c.lastIndex=o.lastIndex,h=np(cp,c,e),o.lastIndex=c.lastIndex,h;var l=u.groups,c=vp&&o.sticky,h=np(ip,o),u=o.source,d=0,f=e;if(c&&(h=dp(h,"y",""),-1===hp(h,"g")&&(h+="g"),f=fp(e,o.lastIndex),0<o.lastIndex&&(!o.multiline||o.multiline&&"\n"!==lp(e,o.lastIndex-1))&&(u="(?: "+u+")",f=" "+f,d++),t=new RegExp("^(?:"+u+")",h)),_p&&(t=new RegExp("^"+u+"$(?!\\s)",h)),pp&&(n=o.lastIndex),r=np(up,c?t:o,f),c?r?(r.input=fp(r.input,d),r[0]=fp(r[0],d),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:pp&&r&&(o.lastIndex=o.global?r.index+r[0].length:n),_p&&r&&1<r.length&&np(op,r[0],t,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r&&l)for(r.groups=s=sp(null),i=0;i<l.length;i++)s[(a=l[i])[0]]=r[a[1]];return r}:cp,yp=(Vn({target:"RegExp",proto:!0,forced:/./.exec!==yo},{exec:yo}),xe),mp=Hn,gp=yo,Ep=ue,bp=me,Ip=yr,Tp=bp("species"),wp=RegExp.prototype,Sp=Qa.charAt,ca=xe,Cp=pe,kp=Math.floor,Ap=ca("".charAt),Np=ca("".replace),Op=ca("".slice),Rp=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Dp=/\$([$&'`]|\d{1,2})/g,Mp=Nt,xp=Ee,Pp=_e,Lp=ce,Up=yo,Fp=TypeError,qp=Ai,jp=Nt,va=xe,Sr=Ff,Oi=ue,Hp=Ee,Gp=_e,Vp=ke,Bp=Ne,Kp=Pu,Qp=le,zp=qf,Wp=we,Yp=function(s,a,o,u,c,e){var l=o+s.length,h=u.length,t=Dp;return void 0!==c&&(c=Cp(c),t=Rp),Np(e,t,function(e,t){var n;switch(Ap(t,0)){case"$":return"$";case"&":return s;case"`":return Op(a,0,o);case"'":return Op(a,l);case"<":n=c[Op(t,1,-1)];break;default:var r,i=+t;if(0==i)return e;if(h<i)return 0!==(r=kp(i/10))&&r<=h?void 0===u[r-1]?Ap(t,1):u[r-1]+Ap(t,1):e;n=u[i-1]}return void 0===n?"":n})},Xp=jf,Jp=me("replace"),Zp=Math.max,$p=Math.min,ev=va([].concat),tv=va([].push),nv=va("".indexOf),rv=va("".slice),mr="$0"==="a".replace(/./,"$0"),iv=!!/./[Jp]&&""===/./[Jp]("a","$0");Sr("replace",function(e,g,E){var b=iv?"$":"$0";return[function(e,t){var n=Qp(this),r=null==e?void 0:Wp(e,Jp);return r?jp(r,e,n,t):jp(g,Kp(n),e,t)},function(e,t){var n=Hp(this),r=Kp(e);if("string"==typeof t&&-1===nv(t,b)&&-1===nv(t,"$<")){e=E(g,n,r,t);if(e.done)return e.value}for(var i,s=Gp(t),a=(s||(t=Kp(t)),n.global),o=(a&&(i=n.unicode,n.lastIndex=0),[]);null!==(d=Xp(n,r))&&(tv(o,d),a);)""===Kp(d[0])&&(n.lastIndex=zp(r,Bp(n.lastIndex),i));for(var u,c="",l=0,h=0;h<o.length;h++){for(var d,f=Kp((d=o[h])[0]),p=Zp($p(Vp(d.index),r.length),0),v=[],_=1;_<d.length;_++)tv(v,void 0===(u=d[_])?u:String(u));var y=d.groups,m=s?(m=ev([f],v,p,r),void 0!==y&&tv(m,y),Kp(qp(t,void 0,m))):Yp(f,r,p,v,y,t);l<=p&&(c+=rv(r,l,p)+m,l=p+f.length)}return c+rv(r,l)}]},!!Oi(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!mr||iv);function sv(t){return function(e){e=ov(av(e));return 1&t&&(e=uv(e,cv,"")),e=2&t?uv(e,lv,""):e}}var Rn=xe(1..valueOf),Ar="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",av=le,ov=Pu,uv=xe("".replace),Ba="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",cv=RegExp("^"+Ba+Ba+"*"),lv=RegExp(Ba+Ba+"*$"),go={start:sv(1),end:sv(2),trim:sv(3)},Y=ct,Di=Me,n=xe,bn=Tn,W=Hn,hv=Ye,dv=Zl,fv=Ot,pv=ht,vv=Se,_v=ue,ot=wr.f,yv=We.f,mv=e.f,gv=Rn,Ev=go.trim,dr="Number",bv=Di[dr],Iv=bv.prototype,Tv=Di.TypeError,wv=n("".slice),Sv=n("".charCodeAt),Cv=function(e){var t,n,r,i,s,a,o,u=vv(e,"number");if(pv(u))throw Tv("Cannot convert a Symbol value to a number");if("string"==typeof u&&2<u.length)if(u=Ev(u),43===(e=Sv(u,0))||45===e){if(88===(t=Sv(u,2))||120===t)return NaN}else if(48===e){switch(Sv(u,1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+u}for(s=(i=wv(u,2)).length,a=0;a<s;a++)if((o=Sv(i,a))<48||r<o)return NaN;return parseInt(i,n)}return+u};if(bn(dr,!bv(" 0o1")||!bv("0b1")||bv("+0x1"))){for(var kv,Av=function(e){var e=arguments.length<1?0:bv(function(e){e=vv(e,"number");return"bigint"==typeof e?e:Cv(e)}(e)),t=this;return fv(Iv,t)&&_v(function(){gv(t)})?dv(Object(e),t,Av):e},Nv=Y?ot(bv):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Ov=0;Nv.length>Ov;Ov++)hv(bv,kv=Nv[Ov])&&!hv(Av,kv)&&mv(Av,kv,yv(bv,kv));W(Di,dr,(Av.prototype=Iv).constructor=Av,{constructor:!0})}function Rv(n){Object.keys(n).forEach(function(e){var t;(void 0===(t=n[e])||Number.isNaN(t)||""===t||Array.isArray(t)&&0===t.length)&&delete n[e]})}var Dv,Mv,xv,Pv,Lv,Uv=function(){var t=g(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getCandidateInfo()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:n=e.sent,i=n.entries(),s=0;case 7:if(!(s<n.size)){e.next=18;break}if(a=i.next(),a=a.value){e.next=11;break}return e.abrupt("continue",15);case 11:if("candidate-pair"===(o=a[1]).type&&"succeeded"===o.state)return r=o.localCandidateId,e.abrupt("break",18);e.next=15;break;case 15:s++,e.next=7;break;case 18:if(!(s<n.size)){e.next=28;break}if(o=i.next(),u=o.value){e.next=22;break}return e.abrupt("continue",25);case 22:if("local-candidate"===(c=u[1]).type&&c.id===r)return e.abrupt("return",{connectionType:null!=(l=c.candidateType)?l:"",protocol:null!=(l=c.protocol)?l:"",relayProtocol:null!=(l=c.relayProtocol)?l:""});e.next=25;break;case 25:s++,e.next=18;break;case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),Fv=function(){var t=g(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={},i={},s={},a=new Map,o=new Map,t.forEach(function(e){"codec"===e.type&&a.set(e.id,e),"candidate-pair"===e.type&&"succeeded"===e.state&&(u=e.localCandidateId,n.webrtc_timestamp=e.time),"media-source"===e.type&&o.set(e.kind,e)}),t.forEach(function(e){var t;"local-candidate"===e.type&&e.id===u&&(r.network_type=e.networkType,r.protocol=e.protocol,r.candidate_type=e.candidateType),"audio"!==e.kind&&"audio"!==e.mediaType||("outbound-rtp"===e.type&&(i.codec=null==(t=a.get(e.codecId))?void 0:t.mimeType,i.total_packets_sent=e.packetsSent,i.retransmitted_packets_sent=e.retransmittedPacketsSent),"remote-inbound-rtp"===e.type&&(i.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,i.total_packets_received=e.packetsReceived,i.total_packets_lost_rate=t,i.total_packets_lost=e.packetsLost,i.jitter=1e3*e.jitter),"track"===e.type&&e.remoteSource&&(i.jitter_buffer_delay=e.jitterBufferDelay,i.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount)),"video"!==e.kind&&"video"!==e.mediaType||(s.video_source_width=null==(t=o.get("video"))?void 0:t.width,s.video_source_height=null==(t=o.get("video"))?void 0:t.height,s.video_source_frames_per_second=null==(t=o.get("video"))?void 0:t.framesPerSecond,"outbound-rtp"===e.type&&(s.codec=null==(t=a.get(e.codecId))?void 0:t.mimeType,s.fir_count=e.firCount,s.pli_count=e.pliCount,s.nack_count=e.nackCount,s.qp_sum=e.qpSum,s.retransmitted_packets_sent=e.retransmittedBytesSent,s.quality_limitation_reason=e.qualityLimitationReason,s.quality_limitation_resolution_changes=e.qualityLimitationResolutionChanges),"remote-inbound-rtp"===e.type&&(s.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type&&(s.header_bytes_received=e.headerBytesReceived,s.key_frames_decoded=e.keyFramesDecoded,s.total_decode_time=e.totalDecodeTime,s.total_inter_frame_delay=e.totalInterFrameDelay,s.total_squared_inter_frame_delay=e.totalSquaredInterFrameDelay,t=e.packetsLost/(e.packetsLost+e.packetsReceived)*100,s.total_packets_lost=e.packetsLost,s.total_packets_received=e.packetsReceived,s.total_packets_lost_rate=t),"track"===e.type&&(e.remoteSource?(s.jitter_buffer_delay=e.jitterBufferDelay,s.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount,s.received_frame_width=e.frameWidth,s.received_frame_height=e.frameHeight,s.frames_received=e.framesReceived,s.frames_decoded=e.framesDecoded,s.frames_dropped=e.framesDropped,s.freeze_count=e.freezeCount,s.pause_count=e.pauseCount,s.total_freezes_duration=e.totalFreezesDuration,s.total_pauses_duration=e.totalPausesDuration,s.total_frames_duration=e.totalFramesDuration,s.sum_of_squared_frames_duration=e.sumOfSquaredFramesDuration):(s.sent_frame_width=e.frameWidth,s.sent_frame_height=e.frameHeight)))}),Rv(r),Rv(i),Rv(s),n.transport_info=r,n.audio=i,n.video=s,e.abrupt("return",n);case 15:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),qv=function(){var t=g(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getStats()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:return n=e.sent,e.abrupt("return",Fv(n));case 6:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),jv=function(){function t(e){E(this,t),this._context=e}return b(t,[{key:"state",get:function(){return this._state}},{key:"_changeState",value:function(e){this._state&&this._state.type===e.type||(this._state&&this._state.destroy(),this._state=e,this._state.context=this._context,this._state.start())}}]),t}(),Hv=function(){function t(e){E(this,t),this._stateMutator=e}return b(t,[{key:"context",set:function(e){this._context=e}},{key:"start",value:function(){this._onStart()}},{key:"destroy",value:function(){this._onDestroy()}}]),t}(),Gv=function(){function n(e,t){E(this,n),this._context=e,this._stateMutator=t,this._context=e,this._stateMutator=t}return b(n,[{key:"state",get:function(){return this._stateMutator.state}}]),n}(),Vv=function(){T(n,Hv);var t=S(n);function n(e){return E(this,n),t.call(this,e)}return b(n)}(),Bv=((wt=Dv=Dv||{}).IDLE="idle",wt.OFFERING="offering",wt.ANSWERING="answering",wt.CONNECTED="connected",wt.RECONNECTING="reconnecting",wt.ICE_RESTART_OFFERING="iceRestartOffering",wt.ICE_RESTART_ANSWERING="iceRestartAnswering",wt.CLOSED="closed",function(){T(r,Vv);var t,n=S(r);function r(e,t){return E(this,r),I(w(e=n.call(this,e)),"type",Dv.ANSWERING),e._offerCommand=t,e}return b(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("answering"),this._context.createRTCConnection(),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.prepareSessionDescription(),this._context.sendAnswer().catch(function(e){});case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}()),Kv=function(){T(s,Vv);var i=S(s);function s(){var e;E(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(w(e=i.call.apply(i,[this].concat(n))),"type",Dv.CLOSED),e}return b(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),s}(),Qv=function(){T(r,Vv);var t,n=S(r);function r(e,t){return E(this,r),I(w(e=n.call(this,e)),"type",Dv.CONNECTED),e._isReconnected=t,e}return b(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toReconnecting(t);case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceDisconnected",value:function(){this._stateMutator.toReconnecting()}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),zv=function(){T(r,Vv);var t,n=S(r);function r(e,t){return E(this,r),I(w(e=n.call(this,e)),"type",Dv.ICE_RESTART_ANSWERING),e._offerCommand=t,e}return b(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartAnswering"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.sendAnswer().catch(function(e){});case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),Wv=function(){T(s,Vv);var i=S(s);function s(){var e;E(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(w(e=i.call.apply(i,[this].concat(n))),"type",Dv.ICE_RESTART_OFFERING),e}return b(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartOffering"),this._context.sendOffer(!0)}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),Yv=function(){T(s,Vv);var t,i=S(s);function s(){var e;E(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(w(e=i.call.apply(i,[this].concat(n))),"type",Dv.IDLE),e}return b(s,[{key:"_onStart",value:function(){}},{key:"_onDestroy",value:function(){}},{key:"createOffer",value:function(){this._stateMutator.toOffering()}},{key:"onOfferReceived",value:(t=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toAnswering(t);case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),Xv=function(){T(s,Vv);var i=S(s);function s(){var e;E(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(w(e=i.call.apply(i,[this].concat(n))),"type",Dv.OFFERING),e}return b(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("offering"),this._context.createRTCConnection(),this._context.prepareSessionDescription()}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),s}(),Jv=function(){T(r,Vv);var n=S(r);function r(e,t){return E(this,r),I(w(e=n.call(this,e)),"type",Dv.RECONNECTING),e._offerCommand=t,e}return b(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("reconnecting"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:function(e){this._stateMutator.toIceRestartAnswering(e)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(),Zv=function(){T(t,jv);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}},{key:"toIdle",value:function(){this._changeState(new Yv(this))}},{key:"toOffering",value:function(){this._changeState(new Xv(this))}},{key:"toAnswering",value:function(e){this._changeState(new Bv(this,e))}},{key:"toConnected",value:function(e){this._changeState(new Qv(this,e))}},{key:"toReconnecting",value:function(e){this._changeState(new Jv(this,e))}},{key:"toIceRestartOffering",value:function(){this._changeState(new Wv(this))}},{key:"toIceRestartAnswering",value:function(e){this._changeState(new zv(this,e))}},{key:"toClosed",value:function(){this._changeState(new Kv(this))}}]),t}(),$v=function(){T(n,Gv);var t=S(n);function n(e){return E(this,n),(e=t.call(this,e,new Zv(e)))._stateMutator.toIdle(),e}return b(n,[{key:"state",get:function(){return this._stateMutator.state}},{key:"onOfferReceived",value:function(e){C.verbose("[".concat(this.state.type,"] onOfferReceived"));var t=this.state;switch(t.type){case Dv.IDLE:case Dv.ANSWERING:case Dv.CONNECTED:case Dv.RECONNECTING:case Dv.ICE_RESTART_ANSWERING:t.onOfferReceived(e);break;default:C.error("[".concat(this.state.type,"] onOfferReceived"))}}},{key:"onAnswerReceived",value:function(e){C.verbose("[".concat(this.state.type,"] onAnswerReceived"));var t=this.state;switch(t.type){case Dv.OFFERING:case Dv.ICE_RESTART_OFFERING:t.onAnswerReceived(e);break;default:C.error("[".concat(this.state.type,"] onAnswerReceived"))}}},{key:"onClose",value:function(){C.verbose("[".concat(this.state.type,"] onClose"));var e=this.state;switch(e.type){case Dv.IDLE:case Dv.OFFERING:case Dv.ANSWERING:case Dv.CONNECTED:case Dv.RECONNECTING:case Dv.ICE_RESTART_OFFERING:case Dv.ICE_RESTART_ANSWERING:e.onClose();break;default:C.error("[".concat(this.state.type,"] onClose"))}}},{key:"createOffer",value:function(){C.verbose("[".concat(this.state.type,"] createOffer"));var e=this.state;e.type===Dv.IDLE?e.createOffer():C.error("[".concat(this.state.type,"] createOffer"))}},{key:"onIceConnected",value:function(){C.verbose("[".concat(this.state.type,"] onIceConnected"));var e=this.state;switch(e.type){case Dv.OFFERING:case Dv.ANSWERING:case Dv.RECONNECTING:case Dv.ICE_RESTART_OFFERING:case Dv.ICE_RESTART_ANSWERING:e.onIceConnected();break;default:C.error("[".concat(this.state.type,"] onIceConnected"))}}},{key:"onIceDisconnected",value:function(){C.verbose("[".concat(this.state.type,"] onIceDisconnected"));var e=this.state;e.type===Dv.CONNECTED?e.onIceDisconnected():C.error("[".concat(this.state.type,"] onIceDisconnected"))}},{key:"onIceFailed",value:function(){C.verbose("[".concat(this.state.type,"] onIceFailed"));var e=this.state;switch(e.type){case Dv.CONNECTED:case Dv.RECONNECTING:e.onIceFailed();break;default:C.error("[".concat(this.state.type,"] onIceFailed"))}}}]),n}(),e_=((In=Mv=Mv||{}).RELAY="relay",In.ALL="all",function(){T(l,Zf);var e,t,n,r,c=S(l);function l(e,t,n,r,i,s,a,o){var u;return E(this,l),(u=c.call(this))._ctx=e,u.id=t,u._signalingClient=n,u._localStream=r,u._isInitiator=i,u._turnCredential=s,u._mediaDirections=a,u._isDisposable=o,u._stateMachine=new $v({dispatchEvent:u._dispatchEvent.bind(w(u)),isInitiator:u._isInitiator,setRemoteDescription:u._setRemoteDescription.bind(w(u)),sendAnswer:u._sendAnswer.bind(w(u)),sendOffer:u._sendOffer.bind(w(u)),createRTCConnection:u._createRTCConnection.bind(w(u)),prepareSessionDescription:u._prepareSessionDescription.bind(w(u)),isDisposable:u._isDisposable}),r&&r.on("streamChanged",function(e){return u.onLocalStream(e)}),u}return b(l,[{key:"_state",get:function(){return this._stateMachine.state}},{key:"rtcConnection",get:function(){return this._rtcConnection}},{key:"remoteStream",get:function(){return this._remoteStream}},{key:"signalingClient",get:function(){return this._signalingClient}},{key:"onEvent",value:function(e){switch(e.type){case xv.CANDIDATE:return void this._receiveCandidate(e);case xv.OFFER:this._stateMachine.onOfferReceived(e);break;case xv.ANSWER:this._stateMachine.onAnswerReceived(e);break;default:C.error(new Error("unhandled call event ".concat(e)))}}},{key:"createOffer",value:function(){this._stateMachine.createOffer()}},{key:"close",value:function(){this._closeRTCConnection(),this._stateMachine.onClose()}},{key:"onLocalStream",value:function(e){if(this._rtcConnection){var t,n=Q(e.getTracks());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._replaceTrack(r)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getCandidateInfo",value:(r=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Uv(this.rtcConnection));case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getStatsLog",value:(n=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",qv(this.rtcConnection));case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"_replaceTrack",value:function(e){var t,n=Q(this._rtcConnection.getSenders());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.track&&r.track.kind===e.kind&&r.replaceTrack(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_createRTCConnection",value:function(){var e,r=this,t=(this._turnCredential&&(e={iceServers:[{username:this._turnCredential.username,credential:this._turnCredential.password,urls:this._turnCredential.turnUrls}],iceTransportPolicy:this._turnCredential.transportPolicy||Mv.ALL}),new RTCPeerConnection(e));t.onnegotiationneeded=function(){r._sendOffer(!1)},t.onicecandidate=function(e){var t,n;e.candidate&&null!=(t=(n=r._signalingClient).sendCandidate)&&t.call(n,e.candidate)},t.onconnectionstatechange=function(){return r._handleConnectionStateChange(t)},t.oniceconnectionstatechange=function(){return r._handleIceConnectionStateChange(t)},t.ontrack=function(e){return r._onRemoteTrack(e)},this._rtcConnection=t}},{key:"_closeRTCConnection",value:function(){this._rtcConnection&&(this._rtcConnection.onnegotiationneeded=null,this._rtcConnection.onicecandidate=null,this._rtcConnection.oniceconnectionstatechange=null,this._rtcConnection.onconnectionstatechange=null,this._rtcConnection.close(),this._rtcConnection=null,delete this._remoteStream)}},{key:"_prepareSessionDescription",value:function(){var e=this._mediaDirections,t=e.audio,e=e.video,n={sendrecv:[],sendonly:[],recvonly:[],none:[]};n[t].push("audio"),n[e].push("video"),n.sendrecv.length&&this._addTracks(n.sendrecv),n.sendonly.length&&this._addSendOnlyTransceivers(n.sendonly),n.recvonly.length&&this._addReceiveOnlyTransceivers(n.recvonly)}},{key:"_addTracks",value:function(t){var n=this,r=(C.debug("_addTracks()"),this._localStream.localStream);r.getTracks().forEach(function(e){t.includes(e.kind)&&n._rtcConnection.addTrack(e,r)})}},{key:"_addReceiveOnlyTransceivers",value:function(e){var t=this;e.forEach(function(e){t._rtcConnection.addTransceiver(e,{direction:"recvonly"})})}},{key:"_addSendOnlyTransceivers",value:function(e){var n=this,r=this._localStream.localStream;e.forEach(function(t){r.getTracks().forEach(function(e){e.kind===t&&n._rtcConnection.addTransceiver(e,{direction:"sendonly",streams:[r]})})})}},{key:"_setRemoteDescription",value:function(e,t){t=t.replace(/a=extmap:0 ulpfec\r\n/,""),e=new RTCSessionDescription({type:e,sdp:t});return this._rtcConnection.setRemoteDescription(e)}},{key:"_sendOffer",value:(t=g(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={iceRestart:t||!1},e.next=3,this._rtcConnection.createOffer(n);case 3:return n=e.sent,e.next=6,this._rtcConnection.setLocalDescription(n);case 6:return e.abrupt("return",this._signalingClient.sendOfferSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_sendAnswer",value:(e=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rtcConnection.createAnswer();case 2:return(t=e.sent).sdp=t.sdp.replace("actpass","active"),e.next=6,this._rtcConnection.setLocalDescription(t);case 6:return e.abrupt("return",this._signalingClient.sendAnswerSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_handleIceConnectionStateChange",value:function(e){switch(C.verbose("[".concat(this._state.type,"] iceConnectionState ").concat(e.iceConnectionState)),e.iceConnectionState){case"connected":this._stateMachine.onIceConnected();break;case"disconnected":this._stateMachine.onIceDisconnected();break;case"failed":this._dispatchEvent("iceFailed")}}},{key:"_handleConnectionStateChange",value:function(e){C.verbose("[".concat(this._state.type,"] connectionState ").concat(e.connectionState))}},{key:"_receiveCandidate",value:function(e){e=e.payload.candidate;this._rtcConnection.addIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.sdp}).catch(function(e){C.error(e)})}},{key:"_onRemoteTrack",value:function(e){this._remoteStream=e.streams[0],this._dispatchEvent("remoteStream",this._remoteStream)}}]),l}()),t_=((pa=xv=xv||{}).OFFER="offer",pa.ANSWER="answer",pa.CANDIDATE="candidate",b(function e(){var n=this;E(this,e),this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})})),n_=function(){var r=g(regeneratorRuntime.mark(function e(t,n,r){var i,s,a,o,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=3<l.length&&void 0!==l[3]?l[3]:{count:0,deferred:new t_},i=a.deferred,s=a.count,e.prev=2,e.next=5,n();case 5:a=e.sent,0<s&&null!=(o=r.onRecover)&&o.call(r),i.resolve(a),e.next=19;break;case 10:if(e.prev=10,e.t0=e.catch(2),null!=(o=r.onError)&&o.call(r,e.t0),0<=(u=t.calcTimeout(s+1)))return null!=(c=r.onRetrial)&&c.call(r,s+1,e.t0),setTimeout(function(){n_(t,n,r,{count:s+1,deferred:i})},u),e.abrupt("return",i.promise);e.next=18;break;case 18:i.reject(e.t0);case 19:return e.abrupt("return",i.promise);case 20:case"end":return e.stop()}},e,null,[[2,10]])}));return function(e,t,n){return r.apply(this,arguments)}}(),r_=function(){function e(){E(this,e)}return b(e,[{key:"calcTimeout",value:function(e){switch(e){case 1:return 1e3;case 2:return 2e3;case 3:return 3e3;default:return-1}}}]),e}(),i_=function(){function r(e,t,n){E(this,r),this.interval=e,this.noise=t,this.maxRetrial=n}return b(r,[{key:"calcTimeout",value:function(e){return e>this.maxRetrial?-1:e*this.interval+(Math.random()-.5)*this.noise*2}}]),r}(),s_=function(){function t(e){E(this,t),this._requests=new Map,this.timeoutTime=e}return b(t,[{key:"has",value:function(e){return this._requests.has(e)}},{key:"get",value:function(e){return this._requests.get(e)}},{key:"register",value:function(e){if(!e)throw new Error("invalid request id");if(this._requests.has(e))throw new Error("duplicate requests");var t=new t_;return this._requests.set(e,{deferred:t,timer:this._createTimeoutTimer(e)}),t}},{key:"unregister",value:function(e){if(!this._requests.has(e))return null;var t=this._requests.get(e),n=t.timer,t=t.deferred;return clearTimeout(n),this._requests.delete(e),t}},{key:"_createTimeoutTimer",value:function(e){var t=this;return setTimeout(function(){t.unregister(e).reject(new Error("no response due to timeout"))},this._getTimeoutTime())}},{key:"rejectAll",value:function(e){var t,n=Q(this._requests.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value,i=this._requests.get(r);clearTimeout(i.timer),i.deferred.reject(e)}}catch(e){n.e(e)}finally{n.f()}this._requests.clear()}},{key:"_getTimeoutTime",value:function(){return this.timeoutTime}}]),t}(),a_=function(){function i(e,t,n,r){E(this,i),I(this,"_timeoutTime",6e4),this._ctx=e,this._participantId=t,this._mediaDirections=n,this._endpointId=r,this._requestMap=new s_(this._timeoutTime)}var t,n,r;return b(i,[{key:"sendOfferSdp",value:(r=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._endpointId){e.next=5;break}return e.next=3,this._sendOfferAndUnregisterCreateEndpointRequest(t);case 3:e.next=7;break;case 5:return e.next=7,this._sendOfferAndUnregisterPutEndpointRequest(t);case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_sendOfferAndUnregisterCreateEndpointRequest",value:(n=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":create-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return n.apply(this,arguments)})},{key:"_sendOfferAndUnregisterPutEndpointRequest",value:(t=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":put-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return t.apply(this,arguments)})},{key:"registerCreateEndpointRequest",value:function(){if(this._endpointId)throw new Error("Cannot register create endpoint request on endpoint recycle");return this._requestMap.register("".concat(this._participantId,":create-endpoint-request"))}},{key:"registerPutEndpointRequest",value:function(){if(this._endpointId)return this._requestMap.register("".concat(this._participantId,":put-endpoint-request"));throw new Error("Cannot register put endpoint request without endpoint id")}},{key:"_sendCreateEndpoint",value:function(e){return this._ctx.sendCreateEndpoint(e)}},{key:"_sendPutEndpoint",value:function(e){return this._ctx.sendPutEndpoint(e)}}]),i}(),o_=function(){T(n,Hv);var t=S(n);function n(e){return E(this,n),t.call(this,e)}return b(n)}(),u_=((r=Pv=Pv||{}).PENDING="pending",r.ESTABLISHED="established",r.CONNECTED="connected",r.FAILED="failed",r.RELEASING="releasing",r.CLOSED="closed",function(){T(s,o_);var i=S(s);function s(){var e;E(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(w(e=i.call.apply(i,[this].concat(n))),"type",Pv.CLOSED),e}return b(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),s}()),c_=function(){T(n,o_);var t=S(n);function n(e){return E(this,n),I(w(e=t.call(this,e)),"type",Pv.CONNECTED),e}return b(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onICEFailed",value:function(){this._stateMutator.toPending()}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(),l_=function(){T(i,o_);var r=S(i);function i(e,t,n){return E(this,i),I(w(e=r.call(this,e)),"type",Pv.ESTABLISHED),e._sdp=t,e._hasPendingAttach=n,e}return b(i,[{key:"_onStart",value:function(){this._context.dispatchEvent("established"),this._context.setRemoteDescription(this._sdp),this._hasPendingAttach&&this.onAttach()}},{key:"_onDestroy",value:function(){}},{key:"onPCConnected",value:function(){this._stateMutator.toConnected()}},{key:"onICEFailed",value:function(){this._stateMutator.toPending()}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),i}(),h_=function(){T(s,o_);var i=S(s);function s(){var e;E(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(w(e=i.call.apply(i,[this].concat(n))),"type",Pv.FAILED),e}return b(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("failed"),this._context.endpoint.id?this._stateMutator.toReleasing():this._stateMutator.toClosed()}},{key:"_onDestroy",value:function(){}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),d_=function(){T(s,o_);var i=S(s);function s(){var e;E(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(w(e=i.call.apply(i,[this].concat(n))),"type",Pv.PENDING),e}return b(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("pending"),this._request()}},{key:"_onDestroy",value:function(){this._requestTimeout&&clearTimeout(this._requestTimeout),delete this._requestTimeout}},{key:"_request",value:function(){var e=this,t=(this._context.trialCount+=1,this._context.trialCount);9<=t?this._stateMutator.toFailed():1<t?this._requestTimeout=setTimeout(function(){e._context.createSession()},5e3*t+2e3*(Math.random()-.5)):this._context.createSession()}},{key:"onEndpointRequestSucceeded",value:function(e){this._stateMutator.toEstablished(e,this._hasPendingAttach)}},{key:"onEndpointRequestFailed",value:function(){this._request()}},{key:"onAttach",value:function(){this._hasPendingAttach=!0}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),f_=function(){T(s,o_);var i=S(s);function s(){var e;E(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(w(e=i.call.apply(i,[this].concat(n))),"type",Pv.RELEASING),e}return b(s,[{key:"_onStart",value:function(){this._context.dispatchEvent("releasing"),this._context.closePeerConnection(),this._context.endpoint.id&&this._context.requestRelease()}},{key:"_onDestroy",value:function(){}},{key:"onEndpointRequestSucceeded",value:function(){this._context.requestRelease()}},{key:"onEndpointRequestFailed",value:function(){this._stateMutator.toClosed()}},{key:"onReleased",value:function(){this._stateMutator.toClosed()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),s}(),p_=function(){T(t,jv);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t,[{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}},{key:"toPending",value:function(){this._changeState(new d_(this))}},{key:"toEstablished",value:function(e,t){this._changeState(new l_(this,e,t))}},{key:"toConnected",value:function(){this._changeState(new c_(this))}},{key:"toFailed",value:function(){this._changeState(new h_(this))}},{key:"toReleasing",value:function(){this._changeState(new f_(this))}},{key:"toClosed",value:function(){this._changeState(new u_(this))}}]),t}(),v_=function(){T(n,Gv);var t=S(n);function n(e){return E(this,n),(e=t.call(this,e,new p_(e)))._stateMutator.toPending(),e}return b(n,[{key:"state",get:function(){return this._stateMutator.state}},{key:"onEndpointRequestSucceeded",value:function(e){C.verbose("[".concat(this.state.type,"] onEndpointRequestSucceeded"));var t=this.state;switch(t.type){case Pv.PENDING:t.onEndpointRequestSucceeded(e);break;case Pv.RELEASING:t.onEndpointRequestSucceeded();break;default:C.error("[".concat(this.state.type,"] onEndpointRequestSucceeded"))}}},{key:"onEndpointRequestFailed",value:function(){C.verbose("[".concat(this.state.type,"] onEndpointCreateFailed"));var e=this.state;switch(e.type){case Pv.PENDING:case Pv.RELEASING:e.onEndpointRequestFailed();break;default:C.error("[".concat(this.state.type,"] onEndpointCreateFailed"))}}},{key:"onICEFailed",value:function(){C.verbose("[".concat(this.state.type,"] onICEFailed"));var e=this.state;switch(e.type){case Pv.ESTABLISHED:case Pv.CONNECTED:e.onICEFailed();break;default:C.error("[".concat(this.state.type,"] onICEFailed"))}}},{key:"onPCConnected",value:function(){C.verbose("[".concat(this.state.type,"] onPCConnected"));var e=this.state;e.type===Pv.ESTABLISHED?e.onPCConnected():C.error("[".concat(this.state.type,"] onPCConnected"))}},{key:"onAttach",value:function(){C.verbose("[".concat(this.state.type,"] onAttach"));var e=this.state;switch(e.type){case Pv.PENDING:case Pv.ESTABLISHED:case Pv.CONNECTED:e.onAttach();break;default:C.error("[".concat(this.state.type,"] onAttach"))}}},{key:"onRelease",value:function(){C.verbose("[".concat(this.state.type,"] onRelease"));var e=this.state;switch(e.type){case Pv.PENDING:case Pv.ESTABLISHED:case Pv.CONNECTED:e.onRelease();break;default:C.error("[".concat(this.state.type,"] onRelease"))}}},{key:"onReleased",value:function(){C.verbose("[".concat(this.state.type,"] onReleased"));var e=this.state;e.type===Pv.RELEASING?e.onReleased():C.error("[".concat(this.state.type,"] onReleased"))}},{key:"onExit",value:function(){C.verbose("[".concat(this.state.type,"] onExit"));var e=this.state;switch(e.type){case Pv.RELEASING:case Pv.PENDING:case Pv.CONNECTED:case Pv.ESTABLISHED:case Pv.FAILED:e.onExit();break;default:C.error("[".concat(this.state.type,"] onExit"))}}}]),n}(),__=function(){T(r,Dc);var n=S(r);function r(e){var t;return E(this,r),(t=n.call(this)).payload=e.payload||{},t}return b(r)}(),y_=function(){T(t,__);var e=S(t);function t(){return E(this,t),e.apply(this,arguments)}return b(t)}(),m_=((dt=Lv=Lv||{}).OFFER="offer",dt.ANSWER="answer",dt.CANDIDATE="candidate",function(){T(n,y_);var t=S(n);function n(e){return E(this,n),I(w(e=t.call(this,{payload:e})),"type",Lv.ANSWER),e}return b(n)}()),g_=function(){T(n,y_);var t=S(n);function n(e){return E(this,n),I(w(e=t.call(this,{payload:e})),"type",Lv.CANDIDATE),e}return b(n)}(),E_=function(){T(n,y_);var t=S(n);function n(e){return E(this,n),I(w(e=t.call(this,{payload:e})),"type",Lv.OFFER),e}return b(n)}(),b_=function(){function e(){E(this,e)}return b(e,null,[{key:"createOffer",value:function(e,t){return new E_({peerConnectionId:e,sdp:t})}},{key:"createAnswer",value:function(e,t){return new m_({peerConnectionId:e,sdp:t})}},{key:"createCandidate",value:function(e,t){return new g_({peerConnectionId:e,candidate:t})}}]),e}(),I_=function(){T(a,Zf);var s=S(a);function a(e,t,n,r){var i;return E(this,a),I(w(i=s.call(this)),"tmpId",oe()),I(w(i),"_createSession",function(){switch(C.debug("_createSession()"),i._type){case"master":i._createMasterSession();break;case"viewer":i._createViewerSession();break;default:C.error("Not supported endpoint type : ",i._type)}}),I(w(i),"_closePeerConnection",function(){C.debug("_closePeerConnection()"),i._pc.removeAllEventListeners(),i._pc.close()}),I(w(i),"_requestAttach",function(){n_(new i_(5e3,1e3,8),function(){return i._sendAttach(i._attachedTo)},{onError:function(e){C.error("Fail attach endpoint endpointId = ".concat(i.id,", to = ").concat(i._attachedTo," ErrorCode = ").concat(e.code))}}).then(function(){i._dispatchEvent("attached",i._attachedTo)})}),I(w(i),"_requestRelease",function(){C.debug("_requestRelease()"),i._sendReleaseEndpoint().then(function(){i._stateMachine.onReleased()}).catch(function(e){C.error("Release request failed",e),i._stateMachine.onReleased()})}),I(w(i),"_setRemoteDescription",function(e){C.debug("_setRemoteDescription()");var t=i._pc,e=b_.createAnswer(void 0,e);t.onEvent(e),t.once("connected",function(){i._stateMachine.onPCConnected(),i._sendConnected()}),t.once("iceFailed",function(){i._stateMachine.onICEFailed()})}),i._ctx=e,i._localStream=t,i._type=n,i._participantId=r,i._stateMachine=new v_({endpoint:w(i),dispatchEvent:i._dispatchEvent.bind(w(i)),createSession:i._createSession,setRemoteDescription:i._setRemoteDescription,closePeerConnection:i._closePeerConnection,requestAttach:i._requestAttach,requestRelease:i._requestRelease,trialCount:0}),i}return b(a,[{key:"pc",get:function(){return this._pc}},{key:"_state",get:function(){return this._stateMachine.state}},{key:"_masterSessionDirection",get:function(){return this._ctx.masterSessionDirection}},{key:"_viewerSessionDirection",get:function(){return this._ctx.viewerSessionDirection}},{key:"attach",value:function(e){C.debug("attach()"),this._attachedTo=e,this._stateMachine.onAttach()}},{key:"release",value:function(){C.debug("release()"),this._stateMachine.onRelease()}},{key:"exit",value:function(){C.debug("exit()"),this._closePeerConnection(),this._stateMachine.onExit()}},{key:"_createMasterSession",value:function(){C.debug("_createMasterSession()"),this._createPeerConnection(this._masterSessionDirection,this._localStream),this._requestCreateEndpoint()}},{key:"_createViewerSession",value:function(){C.debug("_createViewerSession()"),this._createPeerConnection(this._viewerSessionDirection,void 0),this._requestCreateEndpoint()}},{key:"_createPeerConnection",value:function(e,t){C.debug("_createPeerConnection()");var n=new a_(this._ctx,this._participantId,e,this.id);this._pc=new e_(this._ctx,void 0,n,t,!0,void 0,e,!0),this._dispatchEvent("pcChanged",this._pc)}},{key:"_requestCreateEndpoint",value:function(){var t=this,e=(C.debug("_requestCreateEndpoint()"),this._pc),n=this.id?e.signalingClient.registerPutEndpointRequest():e.signalingClient.registerCreateEndpointRequest();e.createOffer(),n.promise.then(function(e){t.id=e.payload.endpoint.id,t._stateMachine.onEndpointRequestSucceeded(e.payload.sdp)}).catch(function(e){C.error("Endpoint request failed",e),t._stateMachine.onEndpointRequestFailed()})}},{key:"_sendConnected",value:function(){return this._ctx.sendConnected(this)}},{key:"_sendReleaseEndpoint",value:function(){return this._ctx.sendReleaseEndpoint(this)}},{key:"_sendAttach",value:function(e){return this._ctx.sendAttach(this,e)}}]),a}(),T_=Nt,w_=Te,S_=fr,C_=ka,k_=Ko,A_=(Vn({target:"Promise",stat:!0},{allSettled:function(e){var o=this,t=S_.f(o),u=t.resolve,n=t.reject,r=C_(function(){var r=w_(o.resolve),i=[],s=0,a=1;k_(e,function(e){var t=s++,n=!1;a++,T_(r,o,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--a||u(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--a||u(i))})}),--a||u(i)});return r.error&&n(r.value),t.promise}}),function(){T(n,Zf);var e,t=S(n);function n(){return E(this,n),t.call(this)}return b(n,[{key:"stream",get:function(){return this._stream}},{key:"isSharing",get:function(){return!!this._stream}},{key:"startStream",value:(e=g(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getDisplayMedia({video:!0});case 3:t=e.sent,this._stream=t,this._stream.getVideoTracks()[0].onended=function(){n._releaseStream(),n._dispatchEvent("streamStopped")},e.next=19;break;case 8:e.prev=8,e.t0=e.catch(0),e.t1=e.t0.name,e.next="InvalidStateError"===e.t1?13:"NotAllowedError"===e.t1?14:"NotFoundError"===e.t1?15:"NotReadableError"===e.t1?16:17;break;case 13:case 14:case 15:case 16:return e.abrupt("break",18);case 17:throw new Error("");case 18:throw new Error("failed to start screen share");case 19:case"end":return e.stop()}},e,this,[[0,8]])})),function(){return e.apply(this,arguments)})},{key:"stopStream",value:function(){this._releaseStream(),this._dispatchEvent("streamStopped")}},{key:"_releaseStream",value:function(){if(this._stream){var e,t=Q(this._stream.getTracks());try{for(t.s();!(e=t.n()).done;)e.value.stop()}catch(e){t.e(e)}finally{t.f()}delete this._stream}}}]),n}()),N_=function(){T(i,Zf);var e,t,n,r=S(i);function i(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};return E(this,i),I(w(t=r.call(this)),"isCustomStreaming",!1),I(w(t),"_checkScreenSharePrerequisites",function(){if(!navigator.mediaDevices.getDisplayMedia)throw new Error("screen share is not supported in this browser")}),t._deviceManager=e,t._mediaConstraints=n,t._screenShare=new A_,t._screenShare.on("streamStopped",function(){t._releaseMergedStream(),t._dispatchEvent("screenShareStreamStopped")}),t}return b(i,[{key:"mediaConstraints",set:function(e){this._mediaConstraints=e}},{key:"hasPermission",get:function(){var e;return null==(e=this._mediaAccess)?void 0:e.hasPermission}},{key:"localStream",get:function(){return this.isCustomStreaming?this._customStream:this.isScreenSharing?this._mergedStream:this.getLocalMediaStream()}},{key:"mergedStream",get:function(){return this._mergedStream}},{key:"screenStream",get:function(){return this._screenShare.stream}},{key:"customStream",get:function(){return this._customStream}},{key:"isScreenSharing",get:function(){return this._screenShare.isSharing}},{key:"useScreenStream",value:(n=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkScreenSharePrerequisites(),e.next=3,this._screenShare.startStream();case 3:this._mergeScreenShareStream(),this._dispatchEvent("streamChanged",this.localStream);case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"stopScreenShare",value:function(){this._screenShare.isSharing&&this._screenShare.stopStream()}},{key:"startUsingExternalVideo",value:(t=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._streamProcessor=t,e.next=4,this._applyStreamProcessor();case 4:this.isCustomStreaming=!0,this._dispatchEvent("streamChanged",this.localStream),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),C.error("failed to use custom stream",e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])})),function(e){return t.apply(this,arguments)})},{key:"stopUsingExternalVideo",value:function(){this.isCustomStreaming&&(this._releaseCustomStream(!1),this.isCustomStreaming=!1,this._dispatchEvent("streamChanged",this.localStream))}},{key:"getLocalMediaStream",value:function(){return this._mediaAccess||this._grantMediaAccess(this._mediaConstraints),this._mediaAccess.stream}},{key:"revokeMediaAccess",value:function(){this._mediaAccess&&(this._mediaAccess.dispose(),this._mediaAccess=null)}},{key:"release",value:function(){this.stopScreenShare(),this.revokeMediaAccess()}},{key:"_grantMediaAccess",value:function(e){var t=this,n=(this._mediaAccess=this._deviceManager.useMedia(e),[]);this._mediaAccess.on("streamChanged",function(){t._screenShare.isSharing&&t._mergeScreenShareStream(),t.isCustomStreaming&&n.push(t._applyStreamProcessor()),0<n.length?Promise.allSettled(n).then(function(){return t._dispatchEvent("streamChanged",t.localStream)}):t._dispatchEvent("streamChanged",t.localStream)}),this._mediaAccess.on("audioOutputChanged",function(){return t._dispatchEvent("audioOutputChanged")})}},{key:"_mergeScreenShareStream",value:function(){var e;this._screenShare.isSharing&&(e=new MediaStream,this._mediaAccess.stream&&0<this._mediaAccess.stream.getAudioTracks().length&&e.addTrack(this._mediaAccess.stream.getAudioTracks()[0]),e.addTrack(this.screenStream.getVideoTracks()[0]),this._mergedStream=e)}},{key:"_applyStreamProcessor",value:(e=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=this._mediaAccess)&&t.stream)return e.next=3,this._streamProcessor(this._mediaAccess.stream);e.next=4;break;case 3:this._customStream=e.sent;case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_releaseMergedStream",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._mergedStream&&(this._mergedStream.removeTrack(this._mergedStream.getAudioTracks()[0]),delete this._mergedStream,e&&this._dispatchEvent("streamChanged",this.localStream))}},{key:"_releaseCustomStream",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._customStream&&(delete this._customStream,delete this._streamProcessor,e&&this._dispatchEvent("streamChanged",this.localStream))}}]),i}(),O_=function(){function i(e,t,n,r){E(this,i),this._liveEvent=e,this._sender=n,this._deviceManager=t,this._mediaOption=r}var t,n,r,s;return b(i,[{key:"mediaView",get:function(){return this._mediaView},set:function(e){this._mediaView!==e&&(this._mediaView&&(this._mediaView=null),e?this.isHostStream?this._mediaView=this._updateMediaViewStream(e,this.localStream):this._mediaView=this._updateMediaViewStream(e,this.stream):delete this._mediaView)}},{key:"localStream",get:function(){var e;return null==(e=this._localStream)?void 0:e.localStream}},{key:"stream",get:function(){var e;return null==(e=this._endpoint.pc)?void 0:e.remoteStream}},{key:"isHostStream",get:function(){return this._mediaOption}},{key:"_createLocalStream",value:function(){var e=this;this._localStream=new N_(this._deviceManager,{audio:!0,video:!0}),this._localStream.on("streamChanged",function(){e._onLocalStream()}),this._mediaOption.streamProcessor&&this._localStream.startUsingExternalVideo(this._mediaOption.streamProcessor)}},{key:"_createEndpoint",value:function(){var e,t=this;return this.isHostStream?(this._localStream||this._createLocalStream(),new I_({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},this._localStream,"master",this._liveEvent.host.hostId)):(e=new I_({masterSessionDirection:{audio:"sendonly",video:"sendonly"},viewerSessionDirection:{audio:"recvonly",video:"recvonly"},sender:this._sender,sendConnected:this._sendConnected.bind(this),sendReleaseEndpoint:this._sendReleaseEndpoint.bind(this),sendAttach:this._sendAttach.bind(this),sendCreateEndpoint:this._sendCreateEndpoint.bind(this),sendPutEndpoint:this._sendPutEndpoint.bind(this)},void 0,"viewer",this._liveEvent.currentLiveUser.participantId),this._unsubscriber=e.pc.on("remoteStream",function(e){t._onStream()}),e)}},{key:"openStream",value:function(){this._endpoint&&this._teardown(),this._endpoint=this._createEndpoint()}},{key:"closeStream",value:function(e){e&&this._endpoint.release(),this._teardown()}},{key:"attach",value:function(e){this._endpoint.attach(e)}},{key:"toggleAudio",value:function(t){var e;null!=(e=this.localStream.getAudioTracks())&&e.forEach(function(e){e.enabled=t}),this._mediaOption.turnAudioOn=t}},{key:"toggleVideo",value:function(t){var e;null!=(e=this.localStream.getVideoTracks())&&e.forEach(function(e){e.enabled=t}),this._mediaOption.turnVideoOn=t}},{key:"startUsingExternalVideo",value:(s=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localStream.startUsingExternalVideo(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"stopUsingExternalVideo",value:function(){this._localStream.stopUsingExternalVideo()}},{key:"chooseMediaDevice",value:function(e,t){this._deviceManager.selectDevice(e,t)}},{key:"_onLocalStream",value:function(){this.toggleAudio(this._mediaOption.turnAudioOn),this.toggleVideo(this._mediaOption.turnVideoOn),this._mediaView&&this._updateMediaViewStream(this._mediaView,this.localStream)}},{key:"_onStream",value:function(){var e=this.stream;this._mediaView&&this._updateMediaViewStream(this._mediaView,e)}},{key:"_updateMediaViewStream",value:function(e,t){return t&&(e.srcObject=t),e}},{key:"_sendConnected",value:(r=g(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.isHostStream?Df.createHostConnected(this._liveEvent.liveEventId,this._liveEvent.host.hostId,t.id):Df.createConnected(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,t.id),e.abrupt("return",this._sender.send(n));case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_sendReleaseEndpoint",value:function(e){e=this.isHostStream?Df.createHostDeleteStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,e.id):Df.createDeleteStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id);return this._sender.sendWithRetry(e)}},{key:"_sendAttach",value:function(e,t){e=Df.createAttach(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,e.id,t);return this._sender.sendWithRetry(e)}},{key:"_sendCreateEndpoint",value:(n=g(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHostStream)return n=Df.createHostCreateStream(this._liveEvent.liveEventId,this._liveEvent.host.hostId,t.sdp,"sendonly","sendonly"),e.abrupt("return",this._sender.send(n));e.next=5;break;case 5:return n=Df.createStream(this._liveEvent.liveEventId,this._liveEvent.currentLiveUser.participantId,t.sdp,"recvonly","recvonly"),e.abrupt("return",this._sender.send(n));case 7:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_sendPutEndpoint",value:(t=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._sendCreateEndpoint(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_teardown",value:function(){var e;null!=(e=this._endpoint)&&e.exit(),(this._endpoint=null)!=(e=this._unsubscriber)&&e.call(this),this._unsubscriber=null}}]),i}(),R_=(D.ErrorCode=void 0,(t=D.ErrorCode||(D.ErrorCode={}))[t.LIVE_EVENT_ID_NOT_FOUND=2800100]="LIVE_EVENT_ID_NOT_FOUND",t[t.ACTION_NOT_ALLOWED_IN_CURRENT_STATE=2800101]="ACTION_NOT_ALLOWED_IN_CURRENT_STATE",t[t.ACTION_NOT_ALLOWED_FOR_PARTICIPANT=2800102]="ACTION_NOT_ALLOWED_FOR_PARTICIPANT",t[t.USER_NOT_ENTERED_LIVE_EVENT=2800103]="USER_NOT_ENTERED_LIVE_EVENT",t[t.STREAM_NOT_STARTED=2800104]="STREAM_NOT_STARTED",t[t.CONNECTION_TO_MEDIA_STREAM_FAILED=2800105]="CONNECTION_TO_MEDIA_STREAM_FAILED",t[t.UNKNOWN_NETWORK_ERROR=2800400]="UNKNOWN_NETWORK_ERROR",t[t.QUERY_IN_PROGRESS=2800900]="QUERY_IN_PROGRESS",t[t.OPEN_CHANNEL_NOT_FETCHED=2800901]="OPEN_CHANNEL_NOT_FETCHED",function(){function e(){E(this,e)}return b(e,null,[{key:"getErrorMessage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=(t.invalidParameter,t.methodName),n=void 0===t?"":t;switch(e){case D.ErrorCode.LIVE_EVENT_ID_NOT_FOUND:return"The live event ID is not found.";case D.ErrorCode.ACTION_NOT_ALLOWED_IN_CURRENT_STATE:return"The user is trying to perform actions such as calling the ".concat(n,", ").concat(n,", ").concat(n," methods for a live event that is not in the 'ongoing' or 'ready' state.");case D.ErrorCode.ACTION_NOT_ALLOWED_FOR_PARTICIPANT:return"The participant is trying to perform actions that are only allowed for a host.";case D.ErrorCode.USER_NOT_ENTERED_LIVE_EVENT:return"The user is trying to perform actions on a live event without entering the event.";case D.ErrorCode.STREAM_NOT_STARTED:return"The user is trying to end a stream that doesn't exist.";case D.ErrorCode.CONNECTION_TO_MEDIA_STREAM_FAILED:return"The connection to media stream failed to establish.";case D.ErrorCode.UNKNOWN_NETWORK_ERROR:return"An unknown network error has occured.";case D.ErrorCode.QUERY_IN_PROGRESS:return"The last query is in progress.";case D.ErrorCode.OPEN_CHANNEL_NOT_FETCHED:return"The open channel for the live event is not fetched.";default:return""}}}]),e}()),D_=["message","error"],M_=function(){T(s,H(Error));var i=S(s);function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.message,r=t.error,t=G(t,D_),n=(E(this,s),n||R_.getErrorMessage(e,t)),t=i.call(this,n);return t.code=e,t._error=r,t}return b(s)}(),x_=function(){T(m,Zf);var t,e,n,r,i,s,a,o,u,c,l,h,d,f,p,v,_,y=S(m);function m(e){var t,n=e.deviceManager,r=e.sender,i=e.sb,s=e.userId,e=e.info;return E(this,m),I(w(t=y.call(this)),"_customItemsUpdatedAt",0),t._deviceManager=n,t._sender=r,t._sb=i,t._userId=s,t._streams=new Map,t._customItems=null,e&&Object.assign(w(t),e),t._unsubscriber=t._sender.on("command",function(e){t._onEvent(e)}),t}return b(m,[{key:"customItems",get:function(){return x({},this._customItems)},set:function(e){this._customItems=e}},{key:"myRole",get:function(){return this.userIdsForHost.includes(this._userId)?D.LiveEventRole.HOST:D.LiveEventRole.PARTICIPANT}},{key:"isHost",get:function(){return this.myRole===D.LiveEventRole.HOST}},{key:"isActiveHost",get:function(){return this.isHost&&!(null==this||!this.currentLiveUser.isHost)}},{key:"duration",get:function(){return 0<this._duration?this._duration:Date.now()-this.startedAt},set:function(e){this._duration=e}},{key:"fetchOpenChannel",value:(_=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sb.openChannel.getChannelWithoutCache(this.liveEventId);case 2:return t=e.sent,t=this._sb.openChannel.buildOpenChannelFromSerializedData(t),this.openChannel=t,e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return _.apply(this,arguments)})},{key:"_getOpenChannel",value:(v=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.openChannel)return e.abrupt("return",this.openChannel);e.next=2;break;case 2:return e.abrupt("return",this.fetchOpenChannel());case 3:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"enterAsHost",value:(p=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getOpenChannel();case 2:return n=e.sent,e.next=5,n.enter();case 5:return e.prev=5,e.next=8,this._sender.send(Df.createEnterHost(this.liveEventId,t));case 8:r=e.sent,r=r.payload.host,t&&this._streams.set(r.hostId,new O_(this,this._deviceManager,this._sender,t)),this.upsert({host:r}),this.upsert({currentLiveUser:r}),e.next=20;break;case 15:return e.prev=15,e.t0=e.catch(5),e.next=19,n.exit();case 19:throw e.t0;case 20:this._startToSendAlive();case 21:case"end":return e.stop()}},e,this,[[5,15]])})),function(e){return p.apply(this,arguments)})},{key:"setEventReady",value:(f=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:return e.next=4,this._sender.send(Df.createReady(this.liveEventId));case 4:t=e.sent,t=t.payload.liveEvent,this.upsert(t);case 7:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"startEvent",value:(d=g(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:return e.next=4,this._sender.send(Df.createStart(this.liveEventId));case 4:n=e.sent,n=n.payload.liveEvent,this.upsert(n),!this.isHostStreaming&&this.isActiveHost&&this.startStreaming(t),"boolean"==typeof(null==t?void 0:t.turnAudioOn)&&this._toggleAudio(t.turnAudioOn),"boolean"==typeof(null==t?void 0:t.turnVideoOn)&&this._toggleVideo(t.turnVideoOn);case 10:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"startStreaming",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{turnAudioOn:!0,turnVideoOn:!0};if(!this.isActiveHost)throw new Error("current host only action");var t=this._streams.get(this.host.hostId);t||(e=new O_(this,this._deviceManager,this._sender,e),this._streams.set(this.host.hostId,e)),t.openStream()}},{key:"endStreaming",value:function(){if(!this.isActiveHost)throw new Error("current host only action");var e=this._streams.get(this.host.hostId);e&&(this._streams.delete(this.host.hostId),e.closeStream(!0))}},{key:"createRTMPStream",value:(h=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new M_(D.ErrorCode.ACTION_NOT_ALLOWED_FOR_PARTICIPANT);case 2:return e.next=4,this._sender.send(Df.createRTMPStream(this.liveEventId));case 4:return t=e.sent,t=t.payload.host,this.upsert({host:t}),e.abrupt("return",t.rtmpStream);case 8:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"deleteRTMPStream",value:(l=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isHost){e.next=2;break}throw new Error("host only action");case 2:if(null!=(t=this.host)&&t.rtmpStream){e.next=4;break}throw new Error("no rtmp stream");case 4:return e.next=6,this._sender.send(Df.deleteRTMPStream(this.liveEventId,this.host.rtmpStream.rtmpStreamId));case 6:this.upsert({host:null});case 8:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"exitAsHost",value:(c=g(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isActiveHost){e.next=2;break}throw new Error("current host only action");case 2:return t=this.host.hostId,e.next=5,this._sender.send(Df.createExitHost(this.liveEventId,t));case 5:t=e.sent,n=t.payload.host,this.upsert({host:n}),this.teardown();case 9:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"endEvent",value:(u=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sender.send(Df.createEndLiveEvent(this.liveEventId));case 2:t=e.sent,t=t.payload.liveEvent,this.upsert(t),this.teardown();case 6:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"muteAudioInput",value:function(){this._toggleAudio(!1)}},{key:"unmuteAudioInput",value:function(){this._toggleAudio(!0)}},{key:"_toggleAudio",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");this._streams.get(this.host.hostId).toggleAudio(e),this._sender.send(Df.createAudio(this.liveEventId,this.host.hostId,e))}},{key:"stopVideo",value:function(){this._toggleVideo(!1)}},{key:"startVideo",value:function(){this._toggleVideo(!0)}},{key:"_toggleVideo",value:function(e){if(!this.isActiveHost)throw new Error("current host only action");this._streams.get(this.host.hostId).toggleVideo(e),this._sender.send(Df.createVideo(this.liveEventId,this.host.hostId,e))}},{key:"selectAudioInput",value:function(e){if(this.isActiveHost)return this._deviceManager.selectDevice("audioinput",e);throw new Error("current host only action")}},{key:"selectVideoInput",value:function(e){if(this.isActiveHost)return this._deviceManager.selectDevice("videoinput",e);throw new Error("current host only action")}},{key:"enter",value:(o=g(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getOpenChannel();case 2:return t=e.sent,e.next=5,t.enter();case 5:return e.prev=5,e.next=8,this._sender.send(Df.createEnter(this.liveEventId));case 8:n=e.sent,n=n.payload.participant,this.upsert({currentLiveUser:n}),this._tryOpen(),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(5),e.next=18,t.exit();case 18:throw e.t0;case 19:this._startToSendAlive();case 20:case"end":return e.stop()}},e,this,[[5,14]])})),function(){return o.apply(this,arguments)})},{key:"exit",value:(a=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sender.send(Df.createExit(this.liveEventId,this.currentLiveUser.participantId));case 2:e.sent.payload.participant,this.teardown();case 5:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"setVideoViewForLiveEvent",value:function(e,t){t=this._streams.get(t);t&&(t.mediaView=e)}},{key:"updateLiveEventInfo",value:(s=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Df.updateLiveEvent(this.liveEventId,t.userIdsForHost,t.title,t.coverUrl,t.coverFile),e.next=3,this._sender.send(n);case 3:n=e.sent,r=n.payload.liveEvent,this.upsert(r);case 6:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"fetchCustomItems",value:(i=g(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Df.createGetCustomItems(this.liveEventId),e.prev=1,e.next=4,this._sender.send(t);case 4:return t=e.sent,n=t.payload,this._setCustomItems(n.customItems),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),C.error("failed to update customItems"),e.t0;case 14:case"end":return e.stop()}},e,this,[[1,10]])})),function(){return i.apply(this,arguments)})},{key:"updateCustomItems",value:(r=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object.keys(t).some(function(e){return"string"!=typeof t[e]}))throw new Error("invalid parameter");e.next=2;break;case 2:return n=Df.createUpdateCustomItems(this.liveEventId,t),e.prev=3,e.next=6,this._sender.send(n);case 6:return n=e.sent,r=n.payload,this._setCustomItems(r.customItems,r.updatedAt),e.abrupt("return",r);case 12:throw e.prev=12,e.t0=e.catch(3),C.error("failed to update customItems"),e.t0;case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return r.apply(this,arguments)})},{key:"deleteCustomItems",value:(n=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.some(function(e){return"string"!=typeof e}))throw new Error("invalid parameter");e.next=2;break;case 2:return n=Df.createDeleteCustomItems(this.liveEventId,t),e.prev=3,e.next=6,this._sender.send(n);case 6:return n=e.sent,r=n.payload,this._setCustomItems(r.customItems,r.deletedAt),e.abrupt("return",r);case 12:throw e.prev=12,e.t0=e.catch(3),C.error("failed to delete customItems"),e.t0;case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return n.apply(this,arguments)})},{key:"deleteAllCustomItems",value:(e=g(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Df.createDeleteAllCustomItems(this.liveEventId),e.prev=1,e.next=4,this._sender.send(t);case 4:return t=e.sent,n=t.payload,this._setCustomItems(n.customItems,n.deletedAt),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),C.error("failed to delete all customItems"),e.t0;case 14:case"end":return e.stop()}},e,this,[[1,10]])})),function(){return e.apply(this,arguments)})},{key:"startUsingExternalVideo",value:(t=g(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isActiveHost){e.next=2;break}throw new Error("current host only action");case 2:if(n=this._streams.get(this.host.hostId)){e.next=5;break}throw new Error("no current stream");case 5:return e.next=7,n.startUsingExternalVideo(t);case 7:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"stopUsingExternalVideo",value:function(){if(!this.isActiveHost)throw new Error("current host only action");var e=this._streams.get(this.host.hostId);if(!e)throw new Error("no current stream");e.stopUsingExternalVideo()}},{key:"upsert",value:function(e){Object.assign(this,e),e.currentLiveUser&&(e.currentLiveUser.hostId?(this.currentLiveUser.isHost=!0,this.currentLiveUser.liveUserId=this.currentLiveUser.hostId):(this.currentLiveUser.isHost=!1,this.currentLiveUser.liveUserId=this.currentLiveUser.participantId))}},{key:"teardown",value:function(){null!=(e=this.openChannel)&&e.exit();var e,t,n=Q(this._streams.values());try{for(n.s();!(t=n.n()).done;)t.value.closeStream()}catch(e){n.e(e)}finally{n.f()}this._streams.clear(),this._stopToSendAlive(),this.upsert({currentLiveUser:void 0})}},{key:"_setCustomItems",value:function(e,t){return(void 0===t||t>this._customItemsUpdatedAt)&&(this._customItemsUpdatedAt=t,this._customItems=e||{},!0)}},{key:"_onEvent",value:function(e){if(this.liveEventId===e.payload.liveEventId)if(e instanceof Qd)this._onReady(e);else if(e instanceof zd)this._onStarted(e);else if(e instanceof Wd)this._onEnded(e);else if(e instanceof mf)this._onUpdated(e);else if(e instanceof Yd)this._onHostEntered(e);else if(e instanceof Xd)this._onHostExited(e);else if(e instanceof Jd)this._onHostConnected(e);else if(e instanceof vf)this._onHostDisconnected(e);else if(e instanceof Zd)this._onHostAudioStatusChanged(e);else if(e instanceof $d)this._onHostVideoStatusChanged(e);else if(e instanceof ef)this._onParticipantEntered(e);else if(e instanceof tf)this._onParticipantExited(e);else if(e instanceof Sf)this._onUpdateCustomItems(e);else{if(!(e instanceof Cf))throw new Error("unknown event is received");this._onDeleteCustomItems(e)}}},{key:"_onReady",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventReady",this)}},{key:"_onStarted",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventStarted",this),this._tryOpen()}},{key:"_onEnded",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventEnded",this),this.teardown()}},{key:"_onUpdated",value:function(e){e=e.payload.liveEvent;this.upsert(e),this._dispatchEvent("liveEventUpdated",this)}},{key:"_onHostEntered",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostEntered",this,this.host)}},{key:"_onHostExited",value:function(e){e=e.payload.host;this.upsert({host:void 0}),this._dispatchEvent("hostExited",this,e)}},{key:"_onHostConnected",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostConnected",this,this.host),this._tryOpen()}},{key:"_onHostDisconnected",value:function(e){e=e.payload.host;this.upsert({host:e}),this._dispatchEvent("hostDisconnected",this,this.host)}},{key:"_onHostAudioStatusChanged",value:function(e){e=e.payload.host;this.upsert({host:e}),e.isAudioOn&&this._dispatchEvent("hostUnmutedAudio",this,this.host),e.isAudioOn||this._dispatchEvent("hostMutedAudio",this,this.host)}},{key:"_onHostVideoStatusChanged",value:function(e){e=e.payload.host;this.upsert({host:e}),e.isVideoOn&&this._dispatchEvent("hostStartedVideo",this,this.host),e.isVideoOn||this._dispatchEvent("hostStoppedVideo",this,this.host)}},{key:"_onParticipantEntered",value:function(e){var e=e.payload,t=e.participant,n=e.participantCount,r=e.peakParticipantCount,e=e.cumulativeParticipantCount;this.upsert({participantCount:n,peakParticipantCount:r,cumulativeParticipantCount:e}),this._dispatchEvent("participantEntered",this,t)}},{key:"_onParticipantExited",value:function(e){var e=e.payload,t=e.participant,n=e.participantCount,r=e.peakParticipantCount,e=e.cumulativeParticipantCount;this.upsert({participantCount:n,peakParticipantCount:r,cumulativeParticipantCount:e}),this._dispatchEvent("participantExited",this,t)}},{key:"_onUpdateCustomItems",value:function(e){var e=e.payload,t=e.customItems,n=e.updatedAt;e.updatedKeys,this._setCustomItems(t,n)&&this._dispatchEvent("customItemsUpdated",t,n)}},{key:"_onDeleteCustomItems",value:function(e){var e=e.payload,t=e.customItems,n=e.deletedAt;e.deletedKeys,this._setCustomItems(t,n)&&this._dispatchEvent("customItemsDeleted",t,n)}},{key:"onDisconnected",value:function(){this._dispatchEvent("disconnected",this,new M_(D.ErrorCode.LIVE_EVENT_ID_NOT_FOUND)),this.teardown()}},{key:"_tryOpen",value:function(){var e,t;this.host&&this.currentLiveUser&&this.host.state===D.HostState.CONNECTED&&this.state===D.LiveEventState.ONGOING&&(e=this.host.hostId,this._streams.has(e)?t=this._streams.get(e):(t=new O_(this,this._deviceManager,this._sender),this._streams.set(e,t)),t.openStream(),t.attach(e))}},{key:"_tryClose",value:function(){}},{key:"_startToSendAlive",value:function(){var t=this;this.isActiveHost?this._aliveIntervalId=setInterval(function(){var e=Df.createHostAlive(t.liveEventId,t.host.hostId);t._sender.send(e)},3e3):this._aliveIntervalId=setInterval(function(){var e=Df.createAlive(t.liveEventId,t.currentLiveUser.participantId);t._sender.send(e)},9e4)}},{key:"_stopToSendAlive",value:function(){this._aliveIntervalId&&(clearInterval(this._aliveIntervalId),delete this._aliveIntervalId)}}]),m}(),P_=function(e,t){return(P_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}P_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var f=function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function re(e,a,o,u){return new(o=o||Promise)(function(n,t){function r(e){try{s(u.next(e))}catch(e){t(e)}}function i(e){try{s(u.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,i)}s((u=u.apply(e,a||[])).next())})}function ie(r,i){var s,a,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,a&&(o=2&t[0]?a.return:t[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,t[1])).done)return o;switch(a=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!((o=0<(o=u.trys).length&&o[o.length-1])||6!==t[0]&&2!==t[0])){u=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){u.label=t[1];break}if(6===t[0]&&u.label<o[1]){u.label=o[1],o=t;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(t);break}o[2]&&u.ops.pop(),u.trys.pop();continue}t=i.call(r,u)}catch(e){t=[6,e],a=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function se(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function L_(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function U_(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.defineProperty(q_,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(q_,"SDK_VERSION",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(q_,"SDK_MAJOR_VERSION",{get:function(){return q_.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(q_,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(q_,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0});var d,F_=q_;function q_(){}(i=d=d||{})[i.INVALID_TOKEN=400111]="INVALID_TOKEN",i[i.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",i[i.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",i[i.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",i[i.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",i[i.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",i[i.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",i[i.LOST_INSTANCE=700100]="LOST_INSTANCE",i[i.CONNECTION_RENEW=700102]="CONNECTION_RENEW",i[i.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",i[i.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",i[i.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",i[i.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",i[i.INVALID_PARAMETER=800110]="INVALID_PARAMETER",i[i.NETWORK_ERROR=800120]="NETWORK_ERROR",i[i.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",i[i.MALFORMED_DATA=800130]="MALFORMED_DATA",i[i.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",i[i.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",i[i.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",i[i.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",i[i.ACK_TIMEOUT=800180]="ACK_TIMEOUT",i[i.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",i[i.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",i[i.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",i[i.REQUEST_FAILED=800220]="REQUEST_FAILED",i[i.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",i[i.REQUEST_CANCELED=800240]="REQUEST_CANCELED",i[i.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",i[i.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",i[i.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",i[i.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",i[i.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED";function j_(e){return!(e instanceof p&&!e.shouldThrowOutside)}function H_(e,t){return e===t||(e=f({},e),t=f({},t),!(e.hasOwnProperty("messageId")&&t.hasOwnProperty("messageId")&&e.messageId!==t.messageId||e.hasOwnProperty("reqId")&&t.hasOwnProperty("reqId")&&e.reqId!==t.reqId||(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,t.hasOwnProperty("messageId")&&delete t.messageId,t.hasOwnProperty("reqId")&&delete t.reqId,JSON.stringify(e)!==JSON.stringify(t))))}function G_(e){return 0<e&&0<=Y_.indexOf(e)}function V_(e,t){if((t=void 0===t?!1:t)&&null===e)return!0;if(!(t=l("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type)){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return t}function B_(e){var t=void 0===(t=e.encryption)?null:t,n=void 0===(n=e.store)?null:n,e=void 0===(e=e.localCacheEnabled)||e;this.nestdb=null,this.store=n,this.preference=new ty({store:n}),this.encryption=null!=t?t:ey,this.localCacheEnabled=e}function K_(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}function Q_(){}function k(t){var n={};return t&&Object.keys(t).forEach(function(e){void 0!==t[e]&&NaN!==t[e]&&null!==t[e]&&(n[e]=t[e])}),n}a(o,z_=Error),Object.defineProperty(o.prototype,"isInvalidTokenError",{get:function(){return this.code===d.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===d.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===d.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(o,"debugModeRequired",{get:function(){return new o({code:d.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"lostInstance",{get:function(){return new o({code:d.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"connectionRenew",{get:function(){return new o({code:d.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"invalidConnectionStateTransition",{get:function(){return new o({code:d.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"connectionRequired",{get:function(){return new o({code:d.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"connectionCanceled",{get:function(){return new o({code:d.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"invalidParameters",{get:function(){return new o({code:d.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"networkError",{get:function(){return new o({code:d.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"markAsReadAllRateLimitExceeded",{get:function(){return new o({code:d.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"queryInProgress",{get:function(){return new o({code:d.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"noAckTimeout",{get:function(){return new o({code:d.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"loginTimeout",{get:function(){return new o({code:d.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"connectionClosed",{get:function(){return new o({code:d.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"requestFailed",{get:function(){return new o({code:d.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"fileUploadCanceled",{get:function(){return new o({code:d.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"requestCanceled",{get:function(){return new o({code:d.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"sessionTokenRefreshFailed",{get:function(){return new o({code:d.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(o,"sessionTokenRequestFailed",{get:function(){return new o({code:d.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),o.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this};var A,z_,p=o,W_=[d.CONNECTION_REQUIRED,d.NETWORK_ERROR,d.ACK_TIMEOUT,d.WEBSOCKET_CONNECTION_CLOSED,d.WEBSOCKET_CONNECTION_FAILED,d.FILE_UPLOAD_CANCEL_FAILED,d.REQUEST_CANCELED,d.INTERNAL_SERVER_ERROR,d.RATE_LIMIT_EXCEEDED,d.UNKNOWN_SERVER_ERROR],Y_=[d.WEBSOCKET_CONNECTION_CLOSED,d.WEBSOCKET_CONNECTION_FAILED,d.CONNECTION_REQUIRED],l=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||("string"!=typeof e?"object"==typeof e?X_(e,t):t instanceof e:typeof t===e)},X_=function(e,t,n){return!(!(n=void 0===n?!1:n)||null!=t)||Object.values(e).includes(t)},J_=function(t,e,n){return!(!(n=void 0===n?!1:n)||null!=e)||Array.isArray(e)&&e.every(function(e){return l(t,e)})},Z_=(Object.defineProperty(hy.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){l("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(hy.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){l("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(hy.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){l("number",e)&&1e3<=e&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(hy.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){l("number",e)&&5e3<=e&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),hy),$_={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},ey={encrypt:function(e){return e},decrypt:function(e){return e}},ty=(ly.prototype._savePreferenceKeys=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:U_([],L_(this._preference.keys()),!1),generation:1})];case 1:return e.sent(),[2]}})})},ly.prototype.init=function(u){var c;return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return this._keysAddress=u,[4,this._store.get(u)];case 1:t=null!=(c=e.sent())?c:[],e.label=2;case 2:e.trys.push([2,7,8,9]),n=se(t),r=n.next(),e.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._store.get(i)]);case 4:(s=e.sent())&&this._preference.set(i,s),e.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return s=e.sent(),a={error:s},[3,9];case 8:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 9:return[2]}})})},ly.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,null!=(n=this._preference.get(t))?n:null]})})},ly.prototype.set=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=!this._preference.has(n),[4,this._store.set({key:n,value:r,generation:1})];case 1:return e.sent(),this._preference.set(n,r),t?[4,this._savePreferenceKeys()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},ly.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.remove(t)];case 1:return e.sent(),this._preference.delete(t),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},ly.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._store.removeMany(U_([],L_(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},ly),ny=(Object.defineProperty(cy.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),cy.prototype.clear=function(){this.authToken=null,this.sessionKey=null},cy),ry=(uy.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},uy.prototype.on=function(e,t){return this._register(e,-1,t)},uy.prototype.once=function(e,t){return this._register(e,1,t)},uy.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},uy),iy=(oy.prototype.on=function(e,t){return new ry({container:this._container}).on(e,t)},oy.prototype.once=function(e,t){return new ry({container:this._container}).once(e,t)},oy.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var s=[];try{for(var a=se(i.keys()),o=a.next();!o.done;o=a.next()){var u=o.value,c=i.get(u);c.handler(t),0<c.occurence&&(c.occurence--,0===c.occurence&&s.push(u))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}s.forEach(function(e){return i.delete(e)})}},oy),sy=(ay.prototype.on=function(e){return this._dispatcher.on("event",e)},ay.prototype.once=function(e){return this._dispatcher.once("event",e)},ay.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},ay);function ay(){this._dispatcher=new iy}function oy(){this._container={}}function uy(e){e=e.container;this._container={},this._container=e,this.key=K_()}function cy(){this.sessionKey=null,this.authToken=null}function ly(e){e=e.store;this._preference=new Map,this._store=e}function hy(e){var e=void 0===e?{}:e,t=e.useMemberInfoInMessage,t=void 0!==t&&t,n=e.typingIndicatorInvalidateTime,n=void 0===n?1e4:n,r=e.typingIndicatorThrottle,r=void 0===r?1e3:r,e=e.websocketResponseTimeout,e=void 0===e?1e4:e;this._useMemberInfoInMessage=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=t,this._typingIndicatorInvalidateTime=n,this._typingIndicatorThrottle=r,this._websocketResponseTimeout=e}function o(e){var t=e.code,t=void 0===t?0:t,e=e.message,e=z_.call(this,e)||this;return e.shouldThrowOutside=!1,e.name="SendbirdError",e.code=t,Object.setPrototypeOf(e,o.prototype),e}(ga=A=A||{}).GET="GET",ga.POST="POST",ga.PUT="PUT",ga.DELETE="DELETE";a(Sy,yy=Q_),Sy.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},Object.defineProperty(Sy.prototype,"query",{get:function(){var t=this,n=k(this.params);return"?".concat(Object.keys(n).map(function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t.stringifyParams(n[e])))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(Sy.prototype,"payload",{get:function(){var r,i=this,s=k(this.params);return Object.keys(s).some(function(e){return V_(s[e])})?(r=new FormData,Object.keys(s).forEach(function(e){var t,n=s[e];V_(n)?r.append(e,n,null!=(t=n.name)?t:"filename"):r.append(e,i.stringifyParams(n))}),r):JSON.stringify(s)},enumerable:!1,configurable:!0});var dy,fy,py,vy,_y,yy,u=Sy,v=(a(wy,_y=Q_),Object.defineProperty(wy.prototype,"payload",{get:function(){return f({},this._payload)},enumerable:!1,configurable:!0}),wy.prototype.as=function(e){return new e(this._iid,this.payload)},wy),my=(a(Ty,vy=Q_),Ty),gy=(a(Iy,py=Q_),Iy),Ey=(a(by,fy=Q_),by);function by(e){var t=fy.call(this)||this;return t.statLog=e,t}function Iy(){return null!==py&&py.apply(this,arguments)||this}function Ty(e){var t=vy.call(this)||this;return t.requestId=e,t}function wy(e,t){var n=_y.call(this)||this;return n._iid=e,n._payload=t,n}function Sy(){var e=null!==yy&&yy.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=K_(),e}(Ni=dy=dy||{}).WEBSOCKET_CONNECT="ws:connect",Ni.API_RESULT="api:result";function Cy(){}Gy.payloadify=function(e){return k({stat_type:e.type,ts:e.createdAt,data:k(e.data)})};var ky,Ay,Ny,Oy,Ry=Gy,Dy=(Object.defineProperty(Hy.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",e=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(F_.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(e)},enumerable:!1,configurable:!0}),Hy.prototype._createHeader=function(e,t){void 0===t&&(t=null);var n=this._sdkState,r=n.appId,n=n.appVersion,n=f(f({},e.headers),{SendBird:"JS,".concat(F_.OS_VERSION,",").concat(F_.SDK_VERSION,",").concat(r).concat(n?",".concat(n):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(n["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(n["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(n["App-Id"]=r,n["Access-Token"]=this._auth.authToken),n},Hy.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new Ey(new Ry({type:dy.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},Hy.prototype.send=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:r=h.path,t=h.method,i=![A.GET,A.DELETE].includes(t),n=this._sdkState.api,n="".concat(n.host).concat(r).concat(i?"":h.query),r=i?h.payload:null,i=this._createHeader(h,r instanceof FormData?r:null),a=new AbortController,s=a.signal,this._abortControl.set(h.requestId,a),a=Date.now(),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(n,{method:t,body:r,headers:i,signal:s})];case 2:return[4,(o=e.sent()).json()];case 3:if(c=e.sent(),o.ok||o.redirected)return this._logger.debug("receive api response",h.requestId),this._statLogApiResult(h,a,null),[2,new v(this._iid,c)];throw c?(u=new p(c)).isSessionKeyExpiredError&&this._dispatcher.dispatch(new gy):u=p.requestFailed,this._statLogApiResult(h,a,u),u;case 4:throw c=e.sent(),this._statLogApiResult(h,a,c),c instanceof p?(this._logger.debug("fail api request",c),c):"AbortError"===c.name?p.requestCanceled:(l=p.networkError,this._logger.debug("fail api request",l),l);case 5:return[2]}})})},Hy.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},Hy.prototype.cancelAll=function(){var e,t;try{for(var n=se(this._abortControl.values()),r=n.next();!r.done;r=n.next())r.value.abort()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},Hy),My=(a(jy,Oy=Q_),jy.createFromRawMessage=function(e,t){var n=t.substring(0,4),r=null;try{r=JSON.parse(t.substring(4))}catch(e){n="NOOP"}finally{return new jy(e,n,r)}},jy.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},jy.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},jy),xy=(a(qy,Ny=Q_),qy.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},qy),Py=(a(Fy,Ay=xy),Fy),Ly=(Object.defineProperty(Uy.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),Uy.prototype.ping=function(){var e,t=this,n=new Py;try{var r=null!=(e=this.sdkState.websocket.pongTimeout)?e:5e3;this._pingTimeoutTimer=setTimeout(function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)},r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n},Uy.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},Uy.prototype.refreshTimer=function(){var e=this,t=(this._logger.debug("pinger.refreshTimer()"),null!=(t=this.sdkState.websocket.pingInterval)?t:15e3);this.stop(),this._pingTimer=setInterval(function(){e.ping()},t)},Uy.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},Uy.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},Uy);function Uy(e){var t=e.pingDelegate,n=e.sdkState,e=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=e}function Fy(){return Ay.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}function qy(e){var t=e.code,n=e.ackRequired,e=e.payload,e=void 0===e?null:e,r=this;return(r=Ny.call(this)||this).code=t,r.payload=e,r.requestId=null!=(t=r.payload.req_id)?t:K_(),r.ackRequired=n,r.payload.req_id=r.requestId,r}function jy(e,t,n,r){void 0===r&&(r="");var i=this;return(i=Oy.call(this)||this)._iid=e,i.code=t,i.payload=n,i.requestId=n?null!=(e=n.req_id)?e:r:"",i}function Hy(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,s=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on(function(e){e instanceof my&&s.cancel(e.requestId)}),this._logger=t}function Gy(e){var t=e.type,n=e.data,e=e.ts,e=void 0===e?Date.now():e;this.type=t,this.createdAt=e,this.data=n}(yr=ky=ky||{}).CONNECTING="CONNECTING",yr.OPEN="OPEN",yr.CLOSED="CLOSED";function Vy(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}a(Zy,Qy=iy),Object.defineProperty(Zy.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return ky.CONNECTING;case 1:return ky.OPEN}return ky.CLOSED},enumerable:!1,configurable:!0}),Zy.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach(function(e){e&&l("string",e)&&(e=My.createFromRawMessage(t._iid,e),t._logger.debug("receive websocket event",e),"LOGI"===e.code?(e.payload&&!e.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",e)):"PONG"===e.code?t._pinger&&t._pinger.pong():"EXPR"===e.code?e.payload&&0<e.payload.expires_in&&t._dispatcher.dispatch(new gy):"NOOP"!==e.code&&t.dispatch("message",e))})},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",p.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close")},this.lastActive=Date.now()},Zy.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=Cy,this._ws.onmessage=Cy,this._ws.onerror=Cy,this._ws.onclose=function(){e.dispatch("close")},this._ws.close(),this._ws=null)},Zy.prototype.send=function(e){if(!this._ws)throw p.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},Zy.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e)};var By,Ky,Qy,zy=Zy,Wy=(a(Jy,Ky=Q_),Jy),Yy=(Xy.prototype._sendApiRequest=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(t)];case 1:return[2,e.sent()]}})})},Xy.prototype._sendWebsocketRequest=function(s){return re(this,void 0,void 0,function(){var n,r,t,i=this;return ie(this,function(e){if(n=new Vy,s.ackRequired){r=null,t=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),i._ackStateMap.has(s.requestId)&&(i._ackStateMap.delete(s.requestId),r&&(clearTimeout(r),r=null),e?(i._logger.debug("fail websocket request",e),n.reject(e)):(i._logger.debug("receive websocket ack",s.requestId),n.resolve(t)))};try{r=setTimeout(function(){return t(p.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(s.requestId,{resolve:function(e){return t(null,e)},reject:function(e){return t(e)}}),this.websocketClient.send(s)}catch(e){t(e)}}else try{this.websocketClient.send(s),n.resolve(null)}catch(e){n.reject(e)}return[2,n.promise]})})},Xy.prototype.send=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t instanceof u?[4,this._sendApiRequest(t)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return t instanceof xy?[4,this._sendWebsocketRequest(t)]:[3,4];case 4:throw p.invalidParameters}})})},Xy.prototype.cancel=function(e){this.apiClient.cancel(e)},Xy.prototype.cancelAll=function(){this.apiClient.cancelAll()},Xy);function Xy(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,s=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=t,this.apiClient=new Dy(e,{auth:n,sdkState:r,dispatcher:i,logger:t}),this.websocketClient=new zy(e,{sdkState:r,dispatcher:i,logger:t}),this.websocketClient.on("message",function(e){var t;e.payload.unread_cnt&&s._dispatcher.dispatch(new Wy(e.payload.unread_cnt)),e.requestId?s._ackStateMap.has(e.requestId)&&(t=s._ackStateMap.get(e.requestId),"EROR"!==e.code?t.resolve(e):t.reject(new p({code:e.payload.code,message:e.payload.message}))):s._dispatcher.dispatch(e)}).on("close",function(){s._ackStateMap.forEach(function(e){e.reject(p.connectionClosed)}),s._ackStateMap.clear()})}function Jy(e){var t=e.all,n=e.custom_types,e=e.ts,r=Ky.call(this)||this;return r.all=t,r.customTypes=n,r.ts=e,r}function Zy(e,t){var n=t.sdkState,r=t.dispatcher,t=t.logger,i=Qy.call(this)||this;return i._pinger=null,i.lastActive=0,i._iid=e,i._sdkState=n,i._dispatcher=r,i._logger=t,i._sdkState.websocket.pingerDisabled||(i._pinger=new Ly({pingDelegate:{send:function(e){return i.send(e)},error:function(e){return i.error(e)}},sdkState:i._sdkState,logger:t})),i}(Qa=By=By||{})[Qa.NONE=0]="NONE",Qa[Qa.INITIALIZED=1]="INITIALIZED",Qa[Qa.CONNECTING=2]="CONNECTING",Qa[Qa.CONNECTED=3]="CONNECTED",Qa[Qa.RECONNECTING=4]="RECONNECTING",Qa[Qa.DISCONNECTED=5]="DISCONNECTED",Qa[Qa.LOGOUT=6]="LOGOUT";function $y(t){return re(void 0,void 0,void 0,function(){return ie(this,function(e){return[2,new Promise(function(e){return setTimeout(e,t)})]})})}function em(a,o,u){return void 0===u&&(u=new Mm),re(void 0,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:t=0,n=null,r=function(e){return n=null!=(e=void 0===e?null:e)?e:new Error("Halted")},i=function(){t=0},e.label=1;case 1:if(!(-1===o||t<o))return[3,9];e.label=2;case 2:return e.trys.push([2,4,,8]),[4,a(r,i)];case 3:if(s=e.sent(),n)throw n;return[2,s];case 4:if(s=e.sent(),n)return[3,6];if(++t===o)throw s;return[4,$y(u.calcTimeout(t))];case 5:return e.sent(),[3,7];case 6:throw n;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}})})}function ae(n){re(void 0,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:if((t=e.sent())instanceof p)return t.throwOutside(),[3,3];throw t;case 3:return[2]}})})}function tm(e,t){return null!==(t=void 0===t?null:t)&&Hm.set(e,t),null!=(t=Hm.get(e))?t:""}function nm(e){this.emojiHash=(e=void 0===e?{}:e).emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[]}a(_g,wm=Q_);var rm,im,sm,am,om,um,cm,lm,hm,dm,fm,pm,vm,_m,ym,mm,gm,Em,bm,Im,Tm,wm,Sm,Cm=_g,km=(Object.defineProperty(vg.prototype,"isReady",{get:function(){return this._currentConnectionStateType===By.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(vg.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===By.CONNECTING||this._currentConnectionStateType===By.RECONNECTING},enumerable:!1,configurable:!0}),vg.prototype.send=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return i instanceof xy?this.isReady?(this._logger.debug("send websocket request",i),[4,this.commandRouter.send(i)]):[3,2]:[3,4];case 1:case 5:return[2,e.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",i),t=new Vy,this._lazyCallQueue.push({command:i,deferred:t,timeout:setTimeout(function(){return r.timeout(i.requestId)},1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),p.connectionRequired;case 3:return[3,7];case 4:return i instanceof u?this._auth.hasSession?(this._logger.debug("send api request",i),[4,this.commandRouter.send(i)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",i),t=new Vy,this._lazyCallQueue.push({command:i,deferred:t,timeout:setTimeout(function(){return r.timeout(i.requestId)},1e4)}),[2,t.promise];throw n=p.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}})})},vg.prototype.forceSend=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._logger.debug("send websocket request (forced)",t),[4,this.commandRouter.send(t)];case 1:return[2,e.sent()]}})})},vg.prototype.timeout=function(t){this._logger.debug("timeout request",t);var e=this._lazyCallQueue.findIndex(function(e){return e.command.requestId===t});-1<e&&(this._lazyCallQueue[e].deferred.reject(p.connectionRequired),this._lazyCallQueue.splice(e,1))},vg.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},vg.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},vg),Am=(a(pg,Tm=u),pg),Nm=(a(fg,Im=xy),fg),Om=(a(dg,bm=v),dg),Rm=(a(hg,Em=My),hg),Dm=(a(lg,gm=Q_),lg),Mm=(cg.prototype.calcTimeout=function(){return 0},cg),xm=(ug.prototype.createRefreshWebsocketCommand=function(e){return new Nm({authToken:e,expiringSession:!0})},ug.prototype._refreshSessionKey=function(a,o){return re(this,void 0,void 0,function(){var t,n,r,i,s=this;return ie(this,function(e){switch(e.label){case 0:if(this._currentConnectionStateType!==By.CONNECTED)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this.createRefreshWebsocketCommand(a),[4,this._requestQueue.forceSend(t)];case 2:if(t=e.sent(),r=t.as(Rm),n=r.newKey,r=r.error)throw r;return this.auth.sessionKey=null!=n?n:this.auth.sessionKey,this._logger.debug("session refreshed"),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2];case 3:if(r=e.sent(),j_(r))throw r;return r.isSessionTokenExpiredError?(this._handleError(o),[2]):[3,4];case 4:return e.trys.push([4,6,,7]),i=new Am({userId:this._sdkState.userId,authToken:a,expiringSession:!0}),[4,em(function(n){return re(s,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(i)];case 1:return t=e.sent(),t=t.as(Om).key,this.auth.sessionKey=t,[3,3];case 2:throw(t=e.sent()).isSessionTokenExpiredError&&n(p.sessionTokenRefreshFailed),t;case 3:return[2]}})})},3)];case 5:return e.sent(),this._logger.debug("session refreshed"),[3,7];case 6:return e.sent(),this._handleError(o),[2];case 7:return ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionRefreshed(),[2]})})}),o&&o.resolve(),[2]}})})},ug.prototype._handleError=function(e){var t=this,n=p.sessionTokenRefreshFailed;ae(function(){return re(t,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionError(n),[2]})})}),e&&e.reject(n)},ug.prototype.refresh=function(){return re(this,void 0,void 0,function(){var n,t,r,i=this;return ie(this,function(e){return this.handler?(n=new Vy,t=function(e){e?(i._logger.debug("session refreshing.."),i.auth.authToken=e,i._refreshSessionKey(e,n)):(i._logger.debug("session closed"),ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionClosed(),[2]})})}),n.resolve())},r=function(){i._dispatcher.dispatch(new Dm);var t=p.sessionTokenRequestFailed;i.handler&&(ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionError(t),[2]})})}),n.reject(t))},this._logger.debug("session expired"),this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,n):ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return this.handler.onSessionTokenRequired(t,r),[2]})})}),[2,n.promise]):[2]})})},ug),ca=(og.prototype.run=function(e){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},og.prototype.onConnect=function(e,t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},og.prototype.onReconnect=function(e,t){return t.resetReconnectCount,re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},og.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},og.prototype.onLogout=function(e){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2]})})},og),Pm=(a(ag,mm=ca),ag.prototype.run=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return t=r.sdkState.userId,r.logout(),ae(function(){return re(n,void 0,void 0,function(){return ie(this,function(e){return r.connectionHandlers.forEach(function(e){e.onDisconnected(t)}),[2]})})}),[4,r.changeState(new jm)];case 1:return e.sent(),[2]}})})},ag),Lm=(a(sg,ym=ca),sg.prototype.run=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),this._autoReconnect?[4,t.changeState(new Um)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},sg.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new qm({authToken:n}))];case 1:return e.sent(),[2]}})})},sg.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Um)];case 1:return e.sent(),[2]}})})},sg.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Pm)];case 1:return e.sent(),[2]}})})},sg),Um=(a(ig,_m=ca),ig.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},ig.prototype.run=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s=this;return ie(this,function(e){switch(e.label){case 0:t=new Vy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectStarted()}),[2]})})}),e.label=1;case 1:return e.trys.push([1,4,,9]),r=a.sdkState.websocket,n=r.reconnectMaxRetry,r=r.reconnectRetryStrategy,[4,em(function(n,r){return re(s,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this._haltConnect=n,this._resetConnect=r,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.connect()];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof p&&t.code===d.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},n,r)];case 2:return e.sent(),[4,a.changeState(new Fm)];case 3:return e.sent(),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectSucceeded()}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return i=e.sent(),j_(i)?[3,7]:!(i instanceof p)||i.code===d.CONNECTION_CANCELED?[3,6]:[4,a.changeState(new Lm({autoReconnect:!1}))];case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return a.connectionHandlers.forEach(function(e){e.onReconnectFailed()}),this.flushCallbacks(i),[2]})})}),[3,8];case 7:throw i;case 8:return[3,9];case 9:return[2,t.promise]}})})},ig.prototype.onConnect=function(n,e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new Vy,this._resetConnect&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},ig.prototype.onReconnect=function(n,e){var e=e.resetReconnectCount,r=void 0!==e&&e;return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new Vy,this._resetConnect&&r&&this._resetConnect(),n.cancelConnectForRetry(),this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},ig.prototype.onDisconnect=function(t,e){var n=e.error,r=void 0===n?null:n,n=e.autoReconnect,i=void 0===n||n;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=r?r:p.connectionCanceled),[4,t.changeState(new Lm({autoReconnect:i}))];case 1:return e.sent(),[2]}})})},ig.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,t.changeState(new Pm)];case 1:return e.sent(),[2]}})})},ig),Fm=(a(rg,vm=ca),rg.prototype.onReconnect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return t.disconnect(),[4,t.changeState(new Um)];case 1:return e.sent(),[2]}})})},rg.prototype.onDisconnect=function(t,e){var n=e.autoReconnect;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Lm({autoReconnect:n}))];case 1:return e.sent(),[2]}})})},rg.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new Pm)];case 1:return e.sent(),[2]}})})},rg),qm=(a(ng,pm=ca),ng.prototype.flushCallbacks=function(t){void 0===t&&(t=null),this._callbacks.forEach(function(e){return e(t)})},ng.prototype.run=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:t=new Vy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),e.label=1;case 1:return e.trys.push([1,4,,9]),[4,em(function(n){return re(r,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this._haltConnect=n,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i.connect(this._authToken)];case 2:return e.sent(),[3,4];case 3:if((t=e.sent())instanceof p&&t.code===d.CONNECTION_CANCELED)return n(t),[2];throw t;case 4:return[2]}})})},i.sdkState.websocket.connectMaxRetry)];case 2:return e.sent(),[4,i.changeState(new Fm)];case 3:return e.sent(),ae(function(){return re(r,void 0,void 0,function(){return ie(this,function(e){return i.connectionHandlers.forEach(function(e){e.onConnected(i.sdkState.userId)}),this.flushCallbacks(null),[2]})})}),[3,9];case 4:return n=e.sent(),j_(n)?[3,7]:(i.disconnect(),!(n instanceof p)||n.code===d.CONNECTION_CANCELED?[3,6]:[4,i.changeState(new jm)]);case 5:e.sent(),e.label=6;case 6:return ae(function(){return re(r,void 0,void 0,function(){return ie(this,function(e){return this.flushCallbacks(n),[2]})})}),[3,8];case 7:throw n;case 8:return[3,9];case 9:return[2,t.promise]}})})},ng.prototype.onConnect=function(e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new Vy,this._callbacks.push(function(e){return e?t.reject(e):t.resolve()}),[2,t.promise]})})},ng.prototype.onDisconnect=function(t,e){var e=e.error,n=void 0===e?null:e;return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(null!=n?n:p.connectionCanceled),[4,t.changeState(new Pm)];case 1:return e.sent(),[2]}})})},ng.prototype.onLogout=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,t.changeState(new Pm)];case 1:return e.sent(),[2]}})})},ng),jm=(a(tg,fm=ca),tg.prototype.onConnect=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,t.changeState(new qm({authToken:n}))];case 1:return e.sent(),[2]}})})},tg),Hm=new Map,yo=(eg.payloadify=function(e){return e?{}:null},eg),Gm="/".concat("v3","/users"),Vm="/".concat("v3","/storage/file"),Bm="/".concat("v3","/group_channels"),Km="/".concat("v3","/open_channels"),Qm="/".concat("v3","/sdk/open_channels"),zm="/".concat("v3","/search"),Wm="/".concat("v3","/report"),Ym="/".concat("v3","/emojis"),Xm="/".concat("v3","/emoji_categories"),Jm="/".concat("v3","/sdk/statistics"),Zm=(a($m,dm=u),$m);function $m(e){var t=e.userId,e=e.metadata,n=dm.call(this)||this;return n.method=A.POST,n.path="".concat(Gm,"/").concat(t,"/metadata"),n.params={metadata:e},n}function eg(e){this._iid="",this._iid=e}function tg(){var e=null!==fm&&fm.apply(this,arguments)||this;return e.type=By.INITIALIZED,e.name="initialized",e}function ng(e){var e=e.authToken,t=pm.call(this)||this;return t.type=By.CONNECTING,t.name="connecting",t._authToken="",t._haltConnect=null,t._callbacks=[],t._authToken=e,t}function rg(){var e=null!==vm&&vm.apply(this,arguments)||this;return e.type=By.CONNECTED,e.name="connected",e}function ig(){var e=null!==_m&&_m.apply(this,arguments)||this;return e.type=By.RECONNECTING,e.name="reconnecting",e._haltConnect=null,e._resetConnect=null,e._callbacks=[],e}function sg(e){var e=e.autoReconnect,t=ym.call(this)||this;return t.type=By.DISCONNECTED,t.name="disconnected",t._autoReconnect=!1,t._autoReconnect=e,t}function ag(){var e=null!==mm&&mm.apply(this,arguments)||this;return e.type=By.LOGOUT,e.name="logout",e}function og(){this.type=By.NONE,this.name="none"}function ug(e){var t=e.auth,n=e.sdkState,r=e.dispatcher,i=e.requestQueue,e=e.logger,s=this;this._currentConnectionStateType=By.INITIALIZED,this.auth=t,this._sdkState=n,this._dispatcher=r,this._requestQueue=i,this._logger=e,this._dispatcher.on(function(e){var t;e instanceof Cm?(t=e.stateType,s._currentConnectionStateType=t):e instanceof gy&&s.refresh()})}function cg(){}function lg(){return null!==gm&&gm.apply(this,arguments)||this}function hg(e,t,n){e=Em.call(this,e,"LOGI",n)||this;return e.error=null,e.newKey=n.new_key,e.error=n.error?new p(n.error):null,e}function dg(e,t){e=bm.call(this,e,t)||this,t=t.key;return e.key=t,e}function fg(e){var t=e.authToken,e=e.expiringSession;return Im.call(this,{code:"LOGI",payload:{token:t,expiring_session:void 0===e||e?1:0},ackRequired:!0})||this}function pg(e){var t=e.userId,n=e.authToken,e=e.expiringSession,e=void 0===e||e,r=Tm.call(this)||this;return r.path="/users/".concat(t,"/session_key"),r.method=A.POST,r.params={token:n,expiring_session:!!e},r.requireAuth=!1,r}function vg(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,t=t.logger,a=this;this._currentConnectionStateType=By.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new Yy(e,{auth:n,sdkState:r,dispatcher:i,logger:t}),this._auth=n,this._logger=t,this._dispatcher=i,this._dispatcher.on(function(e){if(e instanceof Cm){e=e.stateType;switch(a._currentConnectionStateType=e){case By.CONNECTED:var t=a._lazyCallQueue;a._lazyCallQueue=[],t.forEach(function(s){return re(a,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:t=s.command,n=s.deferred,r=s.timeout,clearTimeout(r),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.send(t)];case 2:return r=e.sent(),n.resolve(r),[3,4];case 3:return i=e.sent(),n.reject(i),[3,4];case 4:return[2]}})})});break;case By.INITIALIZED:case By.DISCONNECTED:case By.LOGOUT:t=a._lazyCallQueue,a._lazyCallQueue=[],t.forEach(function(r){return re(a,void 0,void 0,function(){var t,n;return ie(this,function(e){return t=r.deferred,n=r.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(p.connectionClosed):t.reject(p.connectionRequired),[2]})})})}}})}function _g(e){var e=e.stateType,t=wm.call(this)||this;return t.stateType=e,t}a(function(e,t){return(e=Sm.call(this,e,t)||this).metadata=t,e},Sm=v),(Ai=rm=rm||{}).BASE="base",Ai.GROUP="group",Ai.OPEN="open",(va=im=im||{}).OPERATOR="operator",va.NONE="none",(Sr=sm=sm||{}).BASE="base",Sr.USER="user",Sr.FILE="file",Sr.ADMIN="admin",(Oi=am=am||{}).ALL="",Oi.USER="MESG",Oi.FILE="FILE",Oi.ADMIN="ADMM",(mr=om=om||{}).USER="MESG",mr.FILE="FILE",mr.ADMIN="ADMM",(Ba=um=um||{}).USERS="users",Ba.CHANNEL="channel",(ct=cm=cm||{}).ALL="all",ct.NONE="none",ct.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",(Tn=lm=lm||{}).DEFAULT="default",Tn.SUPPRESS="suppress",(Ye=hm=hm||{}).PENDING="pending",Ye.SCHEDULED="scheduled",Ye.SUCCEEDED="succeeded",Ye.FAILED="failed",Ye.CANCELED="canceled";function yg(e){switch(e){case rm.GROUP:return Bm;case rm.OPEN:return Km;default:return null}}function mg(e){switch(e){case rm.GROUP:return"".concat(Wm,"/group_channels");case rm.OPEN:return"".concat(Wm,"/open_channels");default:return null}}function gg(e,t,n){return e=Cg(e.mentionType,e.mentionedUserIds,n),t=Cg(t.mentionType,t.mentionedUserIds,n),!e&&t?1:e&&!t?-1:0}var Eg,bg,Ig,Tg,wg,Sg,Cg=function(e,t,n){var r,i;switch(e){case um.CHANNEL:return!0;case um.USERS:if(t)try{for(var s=se(t),a=s.next();!a.done;a=s.next())if(a.value===n)return!0}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},kg=(a(Lg,wg=u),Lg),Ag=(a(Pg,Tg=v),Pg),Ng=(a(xg,Ig=u),xg),Og=(a(Mg,bg=v),Mg),Rg=(a(Dg,Eg=u),Dg);function Dg(e){var t=e.userId,e=e.metadataKey,n=Eg.call(this)||this;return n.method=A.DELETE,n.path="".concat(Gm,"/").concat(t,"/metadata/").concat(e),n}function Mg(e,t){e=bg.call(this,e,t)||this;return e.metadata=t,e}function xg(e){var t=e.userId,n=e.metadata,e=e.upsert,r=Ig.call(this)||this;return r.method=A.PUT,r.path="".concat(Gm,"/").concat(t,"/metadata"),r.params={metadata:n,upsert:e},r}function Pg(e,t){e=Tg.call(this,e,t)||this;return e.metaData=null!=t?t:{},e}function Lg(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metadata;return(t=wg.call(this)||this).method=A.POST,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:e,include_ts:!0},t}a(function(){return null!==Sg&&Sg.apply(this,arguments)||this},Sg=v);a(jg,Ug=u);var Ug,Fg,qg=jg;function jg(e){var e=e.userId,t=Ug.call(this)||this;return t.method=A.DELETE,t.path="".concat(Gm,"/").concat(e,"/metadata"),t}a(function(){return null!==Fg&&Fg.apply(this,arguments)||this},Fg=v);function Hg(e,t){return void 0===t&&(t=null),(e=JSON.parse(JSON.stringify(e)))._iid&&delete e._iid,t&&t(e),e}function Gg(e,t){return void 0===t&&(t=null),e=JSON.parse(JSON.stringify(e)),t&&t(e),e}function h(t){return{do:function(e){t||e()},throw:function(e){if(!t)throw e}}}var Vg;(Ot=Vg=Vg||{}).ONLINE="online",Ot.OFFLINE="offline",Ot.NON_AVAILABLE="nonavailable";a(hE,Xg=yo),hE.payloadify=function(e){return e?k(f(f({},Xg.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null},Object.defineProperty(hE.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(tm(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),hE.prototype.serialize=function(){return Hg(this)},hE.prototype._isValidMetaData=function(t){return!Array.isArray(t)&&0<Object.keys(t).length&&Object.keys(t).map(function(e){return t[e]}).every(function(e){return l("string",e)})},hE.prototype._applyMetaData=function(t,n){var r=this;void 0===n&&(n=!1),Object.keys(t).forEach(function(e){n?delete r.metaData[e]:r.metaData[e]=t[e]})},hE.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(this._isValidMetaData(r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Zm({userId:n.userId,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Ag).metaData,this._applyMetaData(n),[2,this.metaData]}})})},hE.prototype.updateMetaData=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(this._isValidMetaData(r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Ng({userId:n.userId,metadata:r,upsert:i}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Og).metadata,this._applyMetaData(n),[2,this.metaData]}})})},hE.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)).throw(p.invalidParameters),n=y.of(this._iid),t=n.sdkState,n=n.requestQueue,t=new Rg({userId:t.userId,metadataKey:r}),[4,n.send(t)];case 1:return e.sent(),this._applyMetaData(((n={})[r]=!0,n),!0),[2,this.metaData]}})})},hE.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new qg({userId:n.userId}),[4,t.send(n)];case 1:return e.sent(),this.metaData={},[2]}})})};var Bg,Kg,Qg,zg,Wg,Yg,Xg,_=hE,Jg=(a(lE,Yg=Q_),lE),Zg=(cE.payloadify=function(e){return f(f({},_.payloadify(e.user)),{emoji_hash:e.appInfo.emojiHash,file_upload_size_limit:e.appInfo.uploadSizeLimit,application_attributes:e.appInfo.applicationAttributes,premium_feature_list:e.appInfo.premiumFeatureList,login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},cE.prototype.apply=function(){var t=this.reconnectInterval,n=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,e=y.of(this._iid);e.sdkState.websocket.pingInterval=1e3*this.pingInterval,e.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,e.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,e.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(e){return 0<e?1e3*Math.min(t*Math.pow(r,e-1),n):10}},e.appInfo=this.appInfo,e.sessionManager.currentUser=this.user,e.connectedAt=this.connectedAt,this.firstConnectedAt||(e.firstConnectedAt=this.connectedAt),e.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,e.concurrentCallLimit=this.concurrentCallLimit,e.backOffDelay=this.backOffDelay,e.dispatcher.dispatch(new Jg({userProfile:this}))},cE),$g=(a(uE,Wg=My),uE.asError=function(e){return new uE(null,"LOGI",f({user_id:null,error:!0},e))},uE.prototype.applyTo=function(e){if(this.error)throw this.error;var t=y.of(e);if(!t)throw p.lostInstance;t.sessionManager.auth.sessionKey=this.key,tm(e,this.ekey),this.userProfile.apply()},uE),eE=(a(oE,zg=Q_),oE),tE=(a(aE,Qg=iy),Object.defineProperty(aE.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),aE.prototype.changeState=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this._currentState=t,this._dispatcher.dispatch(new Cm({stateType:t.type})),this._logger.debug("connection state changes to ".concat(t.name)),[4,this._currentState.run(this)];case 1:return e.sent(),[2]}})})},aE.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,i=t.userId,t=t.extensions,s=this._sessionManager.auth,a=t.sb_syncmanager?"s".concat(t.sb_syncmanager):"",t=t.sb_uikit?"u".concat(t.sb_uikit):"",a="JS/c".concat(F_.SDK_VERSION,"/").concat(a,"/").concat(t);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(F_.OS_VERSION),"&sv=").concat(encodeURIComponent(F_.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(s.hasSession?"&key=".concat(encodeURIComponent(s.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(a,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=1")},aE.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new eE(e))},aE.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new Ey(new Ry({type:dy.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},aE.prototype.connect=function(i){return void 0===i&&(i=""),re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){return t=this._url(i),n=new Vy,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){r._loginTimer=null,r._dispatcher.dispatch($g.asError(p.loginTimeout))},this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]})})},aE.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch($g.asError(p.connectionRenew))},aE.prototype.disconnect=function(){this._websocketClient.disconnect()},aE.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()},aE),nE=(Object.defineProperty(sE.prototype,"isConnected",{get:function(){return this._context.currentState.type===By.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(sE.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===By.CONNECTING||e.type===By.RECONNECTING},enumerable:!1,configurable:!0}),sE.prototype.connect=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onConnect(this._context,t)];case 1:return e.sent(),[2]}})})},sE.prototype.reconnect=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},sE.prototype.resetAndReconnect=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},sE.prototype.background=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}})})},sE.prototype.disconnect=function(t){return void 0===t&&(t=null),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:t,autoReconnect:!0})];case 1:return e.sent(),[2]}})})},sE.prototype.logout=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}})})},sE),rE=(a(iE,Kg=u),iE);function iE(e){var t=e.deviceId,e=e.statLogs,n=Kg.call(this)||this;return n.method=A.POST,n.path="".concat(Jm),n.params={device_id:t,log_entries:e.map(function(e){return Ry.payloadify(e)})},n}function sE(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.disableAutoReconnect,t=void 0!==t&&t,u=this;this._context=null,this._logger=o,this._context=new tE(e,{sdkState:n,connectionHandlers:r,sessionManager:i,websocketClient:s,dispatcher:a,logger:o}),t||s.on("close",function(){"foreground"===n.appState&&setTimeout(function(){u._logger.debug("try reconnect by websocket connection closed"),u.reconnect()},100)})}function aE(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,t=t.entryState,t=void 0===t?new jm:t,u=Qg.call(this)||this;return u._currentState=null,u._loginTimer=null,u._connectingAt=0,u._connectionRequestQueue=[],u._iid=e,u.sdkState=n,u.connectionHandlers=r,u._sessionManager=i,u._websocketClient=s,u._dispatcher=a,u._logger=o,u._currentState=t,u._websocketClient.on("message",function(e){var t;"LOGI"===e.code&&(u._loginTimer&&(clearTimeout(u._loginTimer),u._loginTimer=null),(t=e.as($g)).error?(t.error.isSessionKeyExpiredError&&u._dispatcher.dispatch(new gy),u._connectionRequestQueue.forEach(function(e){return e.reject(t.error)}),u._statLogConnection(t.error)):(t.applyTo(u._iid),u._connectionRequestQueue.forEach(function(e){return e.resolve()}),e=t.userProfile,u._enableStatLog(e.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),u._statLogConnection(null)),u._connectionRequestQueue=[])}).on("close",function(){0<u._connectionRequestQueue.length&&(u._connectionRequestQueue.forEach(function(e){return e.reject(p.networkError)}),u._connectionRequestQueue=[],u._statLogConnection(p.networkError))}),u}function oE(e){var t=zg.call(this)||this;return t.enabled=e,t}function uE(e,t,n){var r=this;return(r=Wg.call(this,e,t,n)||this).error=null,r.userProfile=new Zg(e,n),r.key=n.key,r.ekey=null!=(t=n.ekey)?t:"",r.error=n.error?new p(n):null,r}function cE(e,t){this._iid=e,this.appInfo=new nm(t),this.user=new _(e,t),this.connectedAt=1e3*(null!=(e=t.login_ts)?e:0),this.firstConnectedAt=0,this.pingInterval=null!=(e=t.ping_interval)?e:15e3,this.pongTimeout=null!=(e=t.pong_timeout)?e:5e3,this.reconnectInterval=null!=(e=null==(e=t.reconnect)?void 0:e.interval)?e:3e3,this.reconnectMaxInterval=null!=(e=null==(e=t.reconnect)?void 0:e.max_interval)?e:6e4,this.reconnectRetryCount=null!=(e=null==(e=t.reconnect)?void 0:e.retry_cnt)?e:5,this.reconnectIntervalMultiple=null!=(e=null==(e=t.reconnect)?void 0:e.mul)?e:2,this.maxUnreadCountOnSuperGroup=null!=(e=t.max_unread_cnt_on_super_group)?e:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!=(e=t.concurrent_call_limit)?e:5,this.backOffDelay=null!=(e=t.back_off_delay)?e:100}function lE(e){var e=e.userProfile,t=Yg.call(this)||this;return t.userProfile=e,t}function hE(e,t){var n=this;return(n=Xg.call(this,e)||this).userId=null!=(e=null!=(e=t.guest_id)?e:t.user_id)?e:"",n.nickname=null!=(e=null!=(e=t.nickname)?e:t.name)?e:"",n.plainProfileUrl=null!=(e=null!=(e=t.profile_url)?e:t.image)?e:"",n.requireAuth=null!=(e=t.require_auth_for_profile_image)&&e,n.metaData=null!=(e=t.metadata)?e:{},n.connectionStatus=Vg.NON_AVAILABLE,X_(Vg,t.is_online)?n.connectionStatus=t.is_online:l("boolean",t.is_online)&&(n.connectionStatus=t.is_online?Vg.ONLINE:Vg.OFFLINE),n.isActive=null==(e=t.is_active)||e,n.lastSeenAt=null!=(e=t.last_seen_at)?e:null,n.preferredLanguages=t.preferred_languages?U_([],L_(t.preferred_languages),!1):null,n.friendDiscoveryKey=null!=(e=t.friend_discovery_key)?e:null,n.friendName=null!=(e=t.friend_name)?e:null,n}(ht=Bg=Bg||{})[ht.PENDING=0]="PENDING",ht[ht.ENABLED=1]="ENABLED",ht[ht.DISABLED=2]="DISABLED";Object.defineProperty(pE.prototype,"isEnabled",{get:function(){return this.enabledstate===Bg.ENABLED},enumerable:!1,configurable:!0}),pE.prototype._save=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map(function(e){return Ry.payloadify(e)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},pE.prototype._flush=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(!this.isEnabled)return[3,7];if(this.isFlushing)return[3,7];this.isFlushing=!0,e.label=1;case 1:return e.trys.push([1,5,6,7]),0<(t=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length?(n=new rE({deviceId:this.deviceId,statLogs:t}),[4,this.requestQueue.send(n)]):[3,4];case 2:return e.sent(),this.queue=this.queue.slice(t.length),[4,this._save()];case 3:e.sent(),e.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return e.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return[2]}})})},pE.prototype.init=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.key=r,this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.get(this.key)]:[3,4];case 1:return(t=e.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map(function(e){return new Ry({type:e.stat_type,ts:e.ts,data:e.data})}),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,108e5<=Date.now()-this.lastFlushedAt&&this.queue.length>=this.minLimit?(t=Math.min(Math.floor(18e4*Math.random()),100),[4,$y(t)]):[3,4]):[3,4];case 2:return e.sent(),[4,this._flush()];case 3:e.sent(),e.label=4;case 4:return this.dispatcher.on(function(e){var t;e instanceof Ey?(t=e.statLog,n.put(t)):e instanceof eE&&(n.enabledstate=e.enabled?Bg.ENABLED:Bg.DISABLED,n.isEnabled?n.queue.length>=n.limit&&n._flush():n.clear())}),[2]}})})},pE.prototype.put=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.enabledstate===Bg.DISABLED?[3,3]:(this.queue.push(t),[4,this._save()]);case 1:return e.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},pE.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})};var dE,fE=pE;function pE(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,i=e.baseLimit,i=void 0===i?100:i,s=e.maxLimit,s=void 0===s?1e3:s,e=e.minLimit,e=void 0===e?10:e;this.queue=[],this.enabledstate=Bg.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=K_(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=i,this.limit=i,this.maxLimit=s,this.minLimit=e}(wr=dE=dE||{})[wr.NONE=0]="NONE",wr[wr.VERBOSE=1]="VERBOSE",wr[wr.DEBUG=2]="DEBUG",wr[wr.INFO=3]="INFO",wr[wr.WARN=4]="WARN",wr[wr.ERROR=5]="ERROR";NE.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=dE.VERBOSE&&console.log.apply(console,U_(["[verbose]"],L_(e),!1))},NE.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=dE.DEBUG&&console.log.apply(console,U_(["[debug]"],L_(e),!1))},NE.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=dE.INFO&&console.log.apply(console,U_(["[info]"],L_(e),!1))},NE.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=dE.WARN&&console.warn.apply(console,U_(["[warn]"],L_(e),!1))},NE.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=dE.ERROR&&console.error.apply(console,U_(["[error]"],L_(e),!1))};var vE,_E,yE,mE,gE=NE,EE={},y=(AE.of=function(e){if(EE[e])return EE[e];throw p.lostInstance},AE),We=(kE.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,t=(t.onlineDetector,t.cacheContext),t=void 0===t?null:t;this._iid=e,this._cacheContext=t,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=s,this._logger=a},kE),bE=(a(CE,mE=u),CE),IE=(a(SE,yE=v),SE),TE=(a(wE,_E=yo),wE.payloadify=function(e){return e?k(f(f({},_E.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(e){return _.payloadify(e)}):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null},wE);function wE(e,t){var n=this;return(n=_E.call(this,e)||this).replyCount=0,n.mostRepliedUsers=null,n.lastRepliedAt=0,n.updatedAt=0,n.replyCount=null!=(e=t.reply_count)?e:0,n.mostRepliedUsers=t.hasOwnProperty("most_replies")&&J_("object",t.most_replies)?t.most_replies.map(function(e){return new _(n._iid,e)}):[],n.lastRepliedAt=null!=(e=t.last_replied_at)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,n}function SE(e,t){var n=this;return(n=yE.call(this,e,t)||this).url=t.url,n.fileSize=null!=(e=t.file_size)?e:0,n.thumbnailSizes=null!=(e=t.thumbnails)?e:[],n.requireAuth=null!=(e=t.require_auth)&&e,n}function CE(e){var t=mE.call(this)||this;if(t.method=A.POST,t.path="".concat(Vm),t.params=k({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var n=0;n<e.thumbnailSizes.length;n++){var r=e.thumbnailSizes[n],i=r.maxWidth,r=r.maxHeight;t.params["thumbnail".concat(n+1)]="".concat(i,",").concat(r)}return t.requestId=e.requestId,t}function kE(){}function AE(e,t){var n,r,i,s;return this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,EE[e]||(EE[e]=this,n=null!=(n=t.options)?n:new Z_,r=this.sdkState={appId:t.appId,appVersion:null!=(r=t.appVersion)?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!=(r=t.apiHost)?r:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!=(r=t.websocketHost)?r:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new Mm,responseTimeout:n.websocketResponseTimeout}},this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0},i=this.logger=new gE,this.logger.level=null!=(s=t.logLevel)?s:dE.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new B_({encryption:t.encryption,store:t.store,localCacheEnabled:null!=(s=t.localCacheEnabled)&&s}),this.debugMode=null!=(s=t.debugMode)&&s,this.maxSuperGroupChannelUnreadCount=F_.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=n.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=n.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=n.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null,t=this.dispatcher=new sy,s=new ny,this.requestQueue=new km(e,{auth:s,sdkState:r,dispatcher:t,logger:i}),this.sessionManager=new xm({auth:s,sdkState:r,dispatcher:t,requestQueue:this.requestQueue,logger:i}),this.connectionManager=new nE(e,{sdkState:r,connectionHandlers:this.connectionHandlers,dispatcher:t,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,logger:i}),this.statLogCollector=new fE({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:t})),EE[e]}function NE(){this.level=dE.WARN}(e=vE=vE||{}).ADD="add",e.DELETE="delete";function OE(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=l("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,e=e.updated_at;t&&l("string",n)&&l("string",r)&&X_(vE,r)&&l("string",i)&&i&&l("number",e)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=e)}Object.defineProperty(HE.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),HE.payloadify=function(e){return e?k({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},HE.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case vE.ADD:t<0&&this.userIds.push(e.userId);break;case vE.DELETE:0<=t&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}};var RE,DE=HE,ME=(jE.payloadify=function(e){return e?k({key:e.key,value:null!=(e=e.value)?e:[]}):null},jE),xE=(qE.payloadify=function(e){var t;return e?k({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!=(t=e.width)?t:0,height:null!=(t=e.height)?t:0,alt:e.alt}):null},qE),PE=(FE.payloadify=function(e){return e?k({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?xE.payloadify(e.defaultImage):null}):null},FE),LE=(UE.payloadify=function(e){return e?k({name:e.name,volume:e.volume}):null},UE);function UE(e){var t;this.name=null,this.volume=0,this.name=null!=(t=e.name)?t:"default",this.volume=null!=(t=e.volume)?t:1}function FE(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new xE(e["og:image"]))}function qE(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}function jE(e){this.key=e.key,this.value=J_("string",e.value)?U_([],L_(e.value),!1):[]}function HE(e){var t,n,r=e.key,i=null!=(i=U_([],L_(e.user_ids),!1))?i:[],s=e.updated_at,a=(l("string",r)&&r&&J_("string",i)&&0<i.length&&l("number",s)&&(this.key=r,this.userIds=i,this.updatedAt=s),{});try{for(var o=se(this.userIds),u=o.next();!u.done;u=o.next())a[u.value]=this.updatedAt}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this._version=a}(Rn=RE=RE||{}).PENDING="pending",Rn.IN_QUEUE="in_queue",Rn.SENT="sent",Rn.FAILED="failed",Rn.CANCELED="canceled",Rn.REMOVED="removed";function GE(e){return l("number",e.prevResultSize)&&l("number",e.nextResultSize)&&l("boolean",e.isInclusive)&&l("boolean",e.reverse)&&l("string",e.messageTypeFilter)&&X_(am,e.messageTypeFilter)&&J_("string",e.customTypesFilter,!0)&&J_("string",e.senderUserIdsFilter,!0)&&l("boolean",e.includeMetaArray)&&l("boolean",e.includeReactions)&&l("boolean",e.includeParentMessageInfo)}a(C0,$E=yo),C0.payloadify=function(e){var t;return e?k(f(f({},$E.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:function(e){switch(e){case sm.BASE:return"";case sm.USER:return"MESG";case sm.FILE:return"FILE";case sm.ADMIN:return"ADMM"}}(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null==(t=e.mentionedUsers)?void 0:t.map(function(e){return _.payloadify(e)}),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?TE.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(e){return DE.payloadify(e)}),sorted_metaarray:null==(t=e.metaArrays)?void 0:t.map(function(e){return ME.payloadify(e)}),og_tag:PE.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:LE.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null==(t=e.scheduledInfo)?void 0:t.scheduledMessageId,scheduled_at:null==(t=e.scheduledInfo)?void 0:t.scheduledAt,scheduled_status:e._scheduledStatus})):null},C0.prototype.isIdentical=function(e){return this.messageId===e.messageId},C0.prototype.isEqual=function(e){return H_(this,e)},C0.prototype.isUserMessage=function(){return this.messageType===sm.USER},C0.prototype.isFileMessage=function(){return this.messageType===sm.FILE},C0.prototype.isAdminMessage=function(){return this.messageType===sm.ADMIN},C0.prototype.serialize=function(){return Hg(this)},C0.prototype.getMetaArraysByKeys=function(t){return this.metaArrays.filter(function(e){return t.includes(e.key)})},C0.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},C0.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new DE(DE.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},C0.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1};var VE,BE,KE,QE,zE,WE,YE,XE,JE,ZE,$E,e0=C0,t0=(a(S0,ZE=_),S0.payloadify=function(e){return e?k(f(f({},ZE.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null},S0),n0=(a(w0,JE=e0),w0.payloadify=function(e){return e?k(f(f({},JE.payloadify.call(this,e)),{user:t0.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null},Object.defineProperty(w0.prototype,"isResendable",{get:function(){return this.sendingStatus===hm.FAILED&&0<(e=this.errorCode)&&0<=W_.indexOf(e);var e},enumerable:!1,configurable:!0}),w0.prototype.isIdentical=function(e){return 0<this.messageId&&0<e.messageId?this.messageId===e.messageId:this.reqId===e.reqId},w0),r0=(T0.payloadify=function(e){return e?k({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(T0.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),T0),i0={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:am.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},s0=(a(I0,XE=e0),I0.payloadify=function(e){return e?k(f(f({},XE.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:u0(e.parentMessage)})):null},I0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},i0),n),h(0<this.messageId&&l("number",t)&&GE(n)).throw(p.invalidParameters),[4,ub.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},I0),a0=(b0.payloadify=function(e){return e?k({type:e.type,vendor:e.vendor,detail:e.detail}):null},b0),o0=(a(E0,YE=n0),E0.payloadify=function(e){return e?k(f(f({},YE.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(e){return a0.payloadify(e)}),parent_message_info:u0(e.parentMessage)})):null},E0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},i0),n),h(0<this.messageId&&l("number",t)&&GE(n)).throw(p.invalidParameters),[4,ub.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},E0),u0=function(e){if(e)switch(e.messageType){case sm.USER:return o0.payloadify(e);case sm.FILE:return l0.payloadify(e);case sm.ADMIN:return s0.payloadify(e)}return null},c0=function(e,t){switch(t.type){case"MESG":return new o0(e,t);case"FILE":return new l0(e,t);case"ADMM":case"BRDM":return new s0(e,t)}return null},l0=(a(g0,WE=n0),g0.payloadify=function(e){return e?k(f(f({},WE.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map(function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:u0(e.parentMessage)})):null},Object.defineProperty(g0.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(tm(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),g0.prototype.getThreadedMessagesByTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},i0),n),h(0<this.messageId&&l("number",t)&&GE(n)).throw(p.invalidParameters),[4,ub.of(this._iid).getThreadedMessagesByTimestamp(this,t,n)];case 1:return[2,e.sent()]}})})},g0),h0=(a(m0,zE=xy),m0),d0=(a(y0,QE=u),y0),f0=(a(_0,KE=My),_0),p0=(a(v0,BE=v),v0);function v0(e,t){var n,r=this,e=((r=BE.call(this,e,t)||this).message=new l0(e,t),y.of(e).sdkState);return r.isMentioned=Cg(r.message.mentionType,null!=(n=r.message.mentionedUserIds)?n:r.message.mentionedUsers.map(function(e){return e.userId}),e.userId),r.forceUpdateLastMessage=null!=(n=t.force_update_last_message)&&n,r}function _0(e,t,n){var r,i=this,e=((i=KE.call(this,e,"FILE",n)||this).message=new l0(e,n),y.of(e).sdkState);return i.isMentioned=Cg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function y0(e){var t=this,t=QE.call(this)||this,n=[];return e.mentionType===um.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),t.method=A.POST,t.path="".concat(yg(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),t.params=k({message_type:sm.FILE,user_id:e.userId,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:n,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes.map(function(e){return r0.payloadify(e)}),require_auth:e.requireAuth,sorted_metaarray:null==(n=e.metaArrays)?void 0:n.map(function(e){return ME.payloadify(e)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:LE.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,req_id:e.reqId}),t}function m0(e){var t,n=[];return e.mentionType===um.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),zE.call(this,{code:"FILE",ackRequired:!0,payload:k({channel_url:e.channelUrl,url:e.url,name:null!=(t=e.fileName)?t:"",type:null!=(t=e.mimeType)?t:"",size:null!=(t=e.fileSize)?t:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==lm.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function g0(e,t){var n,r=this,i=((r=WE.call(this,e,t)||this).messageParams=null,r.plainUrl="",r.requireAuth=!1,r.name=null,r.size=0,r.type=null,r.thumbnails=[],r.messageSurvivalSeconds=-1,r.messageType=sm.FILE,null!=(i=t.file)?i:null);return r.plainUrl=(null!=(n=null!=(n=null==i?void 0:i.url)?n:t.url)?n:"").split("?auth=")[0],r.name=null!=(n=null!=(n=null==i?void 0:i.name)?n:t.name)?n:"File",r.size=null!=(n=null!=(n=null==i?void 0:i.size)?n:t.size)?n:0,r.data=null!=(n=null!=(n=null==i?void 0:i.data)?n:t.custom)?n:"",r.type=i?null!=(n=i.type)?n:"":null!=(i=t.type)?i:"",r.requireAuth=null!=(n=t.require_auth)&&n,r.thumbnails=t.thumbnails?t.thumbnails.map(function(e){return new r0(f(f({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(r.requireAuth?"?auth=".concat(tm(r._iid)):"")}))}):[],r.messageSurvivalSeconds=null!=(i=t.message_survival_seconds)?i:-1,t.parent_message_info&&(n=t.parent_message_info,i=f(f({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(i=n.file)?void 0:i.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=c0(e,i)),r}function E0(e,t){var n,r,i,s=this;if((s=YE.call(this,e,t)||this).message="",s.messageParams=null,s.translations={},s.translationTargetLanguages=[],s.messageSurvivalSeconds=-1,s.plugins=[],s.message=t.message,s.messageType=sm.USER,s.translations=null!=(r=t.translations)?r:{},s.translationTargetLanguages=null!=(r=t.target_langs)?r:[],s.translations==={}&&0<s.translationTargetLanguages.length)try{for(var a=se(s.translationTargetLanguages),o=a.next();!o.done;o=a.next()){var u=o.value;s.translations[u]=""}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s.messageSurvivalSeconds=null!=(r=t.message_survival_seconds)?r:-1,s.plugins=t.plugins?t.plugins.map(function(e){return new a0(e)}):[],t.parent_message_info&&(i=t.parent_message_info,t=f(f({},i),{created_at:i.ts,message_id:s.parentMessageId,channel_url:s.channelUrl,channel_type:s.channelType,file:i.file,url:null==(n=i.file)?void 0:n.url,require_auth:null==(r=i.file)?void 0:r.require_auth}),s.parentMessage=c0(e,k(t))),s}function b0(e){var t;this.type=null,this.vendor=null,this.detail={},this.type=null!=(t=e.type)?t:"",this.vendor=null!=(t=e.vendor)?t:"",e.hasOwnProperty("detail")&&l("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}function I0(e,t){var n,r=this;return(r=XE.call(this,e,t)||this).message=null,r.translations={},r.message=null!=(n=t.message)?n:"",r.messageType=sm.ADMIN,r.translations=null!=(n=t.translations)?n:{},t.parent_message_info&&(n=t.parent_message_info,n=f(f({},n),{message_id:r.parentMessageId,channel_url:r.channelUrl,channel_type:r.channelType,file:n.file,url:null==(t=n.file)?void 0:t.url,require_auth:null==(t=n.file)?void 0:t.require_auth}),r.parentMessage=c0(e,n)),r}function T0(e){var t;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!=(t=e.real_width)?t:e.width,this.realHeight=null!=(t=e.real_height)?t:e.height}function w0(e,t){var n=this;if((n=JE.call(this,e,t)||this).sender=null,n.reqId="",n.replyToChannel=!1,n.sendingStatus=null,n.errorCode=0,n.sender=t.user?new t0(n._iid,t.user):t.sender_id,n.reqId=null!=(e=null!=(e=t.req_id)?e:t.request_id)?e:"",n.replyToChannel=null!=(e=t.is_reply_to_channel)&&e,t.request_state&&X_(hm,t.request_state)&&(n.sendingStatus=t.request_state),!n.sendingStatus)if(0<n.messageId)n.sendingStatus=hm.SUCCEEDED;else if(n.scheduledInfo)switch(n._scheduledStatus=t.scheduled_status,t.scheduled_status){case RE.SENT:case RE.IN_QUEUE:n.sendingStatus=hm.SUCCEEDED;break;case RE.PENDING:n.sendingStatus=hm.SCHEDULED;break;case RE.FAILED:case RE.REMOVED:n.sendingStatus=hm.FAILED;break;case RE.CANCELED:n.sendingStatus=hm.CANCELED}else n.sendingStatus=hm.PENDING;return n.errorCode=null!=(e=t.error_code)?e:0,n}function S0(e,t){e=ZE.call(this,e,t)||this;return e.role=null,e.isBlockedByMe=!1,e.role=X_(im,t.role)?t.role:im.NONE,t.hasOwnProperty("is_blocked_by_me")&&(e.isBlockedByMe=t.is_blocked_by_me),e}function C0(e,t){var n=this,e=((n=$E.call(this,e)||this).channelUrl=null,n.channelType=rm.BASE,n.messageId=0,n.parentMessageId=null,n.parentMessage=null,n.silent=!1,n.isOperatorMessage=!1,n.messageType=sm.BASE,n.data=null,n.customType=null,n.mentionType=null,n.mentionedUsers=[],n.mentionedUserIds=[],n.mentionedMessageTemplate=null,n.threadInfo=null,n.reactions=[],n.metaArrays=[],n.ogMetaData=null,n.appleCriticalAlertOptions=null,n.createdAt=0,n.updatedAt=0,n.scheduledInfo=null,n._scheduledStatus=null,n.messageId=null!=(e=null!=(e=t.msg_id)?e:t.message_id)?e:0,n.channelUrl=t.channel_url,n.channelType=X_(rm,t.channel_type)?t.channel_type:rm.GROUP,t.channel&&(t.channel.channel_url&&(n.channelUrl=t.channel.channel_url),t.channel.channel_type&&(n.channelType=t.channel.channel_type)),n.parentMessageId=null!=(e="string"==typeof t.parent_message_id?parseInt(t.parent_message_id):t.parent_message_id)?e:0,n.data=null!=(e=t.data)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.mentionType=X_(um,t.mention_type)?t.mention_type:null,t.mentioned_users),e=(n.mentionedUsers=e?e.map(function(e){return new _(n._iid,e)}):null,t.mentioned_user_ids);n.mentionedUserIds=null!=e?e:null,n.mentionedMessageTemplate=null!=(e=t.mentioned_message_template)?e:"",n.threadInfo=t.thread_info?new TE(n._iid,t.thread_info):null,n.reactions=t.reactions?t.reactions.map(function(e){return new DE(e)}):[];for(var r=null!=(e=t.metaarray)?e:{},i=null!=(e=t.metaarray_key_order)?e:Object.keys(r).sort(function(e,t){return e.localeCompare(t)}),s=0;s<i.length;s++){var a=i[s];n.metaArrays.push(new ME({key:a,value:r[a]||[]}))}return t.sorted_metaarray&&(n.metaArrays=t.sorted_metaarray.map(function(e){return new ME(e)})),n.ogMetaData=t.og_tag?new PE(t.og_tag):null,n.silent=null!=(e=t.silent)&&e,n.isOperatorMessage=null!=(e=t.is_op_msg)&&e,n.appleCriticalAlertOptions=t.apple_critical_alert_options?new LE(t.apple_critical_alert_options):null,n.createdAt=null!=(e=null!=(e=t.created_at)?e:t.ts)?e:0,n.updatedAt=null!=(e=t.updated_at)?e:0,"number"==typeof t.scheduled_message_id&&"number"==typeof t.scheduled_at&&t.scheduled_status&&(n.scheduledInfo={scheduledMessageId:t.scheduled_message_id,scheduledAt:t.scheduled_at},n._scheduledStatus=t.scheduled_status),n}(n=VE=VE||{})[n.PENDING=0]="PENDING",n[n.UPLOADING=1]="UPLOADING",n[n.UPLOADED=2]="UPLOADED",n[n.SENDING=3]="SENDING",n[n.FAILED=4]="FAILED";function k0(e){return X_(cm,e.replyType)&&l("boolean",e.includeReactions)&&l("boolean",e.includeMetaArray)&&l("boolean",e.includeParentMessageInfo)&&l("boolean",e.includeThreadInfo)&&l("boolean",e.includePollDetails)}Object.defineProperty(D0.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===By.CONNECTED||this._connectionState===By.CONNECTING||this._connectionState===By.RECONNECTING},enumerable:!1,configurable:!0}),D0.prototype._sendFileMessage=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this._shouldSendThroughWebSocket?(t=new h0(f(f({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)]):[3,2];case 1:return[2,e.sent().as(f0).message];case 2:return t=new d0(f(f({channelUrl:n.url,channelType:n.channelType,url:r.params.fileUrl,userId:this._sdkState.userId,requireAuth:r.requireAuth},r.params),{reqId:r.requestId})),[4,this._requestQueue.send(t)];case 3:return[2,e.sent().as(p0).message]}})})},D0.prototype._resolveMessageQueue=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:if(!(t=this._queueMap.get(h.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,e.label=1;case 1:e.trys.push([1,15,16,17]),i=se(t.messageQueue),s=i.next(),e.label=2;case 2:if(s.done)return[3,14];switch((a=s.value).state){case VE.PENDING:case VE.UPLOADING:return[3,3];case VE.UPLOADED:return[3,4];case VE.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(a),[3,13];case 4:if(!r)return[3,10];e.label=5;case 5:return e.trys.push([5,8,,9]),a.state=VE.SENDING,[4,this._sendFileMessage(h,a)];case 6:return o=e.sent(),a.deferred.resolve(o),[4,$y(100)];case 7:return e.sent(),[3,9];case 8:return o=e.sent(),a.deferred.reject(o),[3,9];case 9:return[3,11];case 10:n.push(a),e.label=11;case 11:return[3,13];case 12:return a.deferred.reject(a.error.code===d.REQUEST_CANCELED?p.fileUploadCanceled:a.error),[3,13];case 13:return s=i.next(),[3,2];case 14:return[3,17];case 15:return c=e.sent(),c={error:c},[3,17];case 16:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 17:return u=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,u?[4,this._resolveMessageQueue(h)]:[3,19];case 18:e.sent(),e.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,e.label=21;case 21:return[2]}})})},D0.prototype._uploadNextPendingItem=function(c){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=this._queueMap.get(c.url),(n=t.messageQueue.find(function(e){return e.state===VE.PENDING}))?V_(n.params.file)?t.uploadQueue.length<6?(n.state=VE.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!e.sent())return[3,8];e.label=2;case 2:return e.trys.push([2,4,5,7]),r=new bE({file:n.params.file,channelUrl:c.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return r=e.sent(),a=r.as(IE),o=a.url,i=a.fileSize,i=void 0===i?n.params.fileSize:i,s=a.thumbnailSizes,s=void 0===s?n.params.thumbnailSizes:s,a=a.requireAuth,a=void 0!==a&&a,n.params.fileUrl=o,n.params.fileSize=i,n.params.thumbnailSizes=s,n.params.requireAuth=a,n.requireAuth=a,n.state=VE.UPLOADED,[3,7];case 4:return o=e.sent(),n.state=VE.FAILED,n.error=o,[3,7];case 5:return 0<=(u=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(u,1),this._uploadNextPendingItem(c)),[4,this._resolveMessageQueue(c)];case 6:return e.sent(),[7];case 7:return[3,10];case 8:return n.state=VE.FAILED,n.error=p.connectionRequired,0<=(u=t.uploadQueue.findIndex(function(e){return e.requestId===n.requestId}))&&(t.uploadQueue.splice(u,1),this._uploadNextPendingItem(c)),[4,this._resolveMessageQueue(c)];case 9:e.sent(),e.label=10;case 10:return[3,13];case 11:return n.params.thumbnailSizes=[],n.state=VE.UPLOADED,[4,this._resolveMessageQueue(c)];case 12:e.sent(),e.label=13;case 13:return[2]}})})},D0.prototype.request=function(n,r,i){var s;return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=new Vy,V_(i.file)&&(i.fileName=null!=(s=i.fileName)?s:i.file.name,i.mimeType=null!=(s=i.mimeType)?s:i.file.type,i.fileSize=null!=(s=i.fileSize)?s:i.file.size),this._queueMap.has(n.url)||this._queueMap.set(n.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(n.url).messageQueue.push({requestId:r,params:i,state:VE.PENDING,deferred:t,requireAuth:i.requireAuth}),this._uploadNextPendingItem(n),[2,t.promise]})})},D0.prototype.cancel=function(e,t){void 0===t&&(t=null);var n,r,i=this._queueMap.get(e.url);if(i){i=t?[i.messageQueue.find(function(e){return e.requestId===t})]:U_([],L_(i.messageQueue),!1);try{for(var s=se(i),a=s.next();!a.done;a=s.next()){var o=a.value;if(o)switch(o.state){case VE.PENDING:o.state=VE.FAILED,o.error=p.requestCanceled,this._resolveMessageQueue(e);break;case VE.UPLOADING:this._requestQueue.cancel(o.requestId)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}};var A0,N0=D0,O0={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:am.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:cm.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},R0={replyType:cm.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includePollDetails:!1};function D0(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,t=t.cacheContext,a=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=t,this._dispatcher=r,this._dispatcher.on(function(e){e instanceof Cm&&(a._connectionState=e.stateType)}),this._onlineDetector=s}(bn=A0=A0||{}).UNKNOWN="UNKNOWN",bn.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",bn.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",bn.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",bn.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",bn.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",bn.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",bn.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",bn.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",bn.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",bn.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",bn.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",bn.REQUEST_MESSAGE="REQUEST_MESSAGE",bn.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",bn.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",bn.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",bn.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",bn.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",bn.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",bn.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",bn.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",bn.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",bn.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";a(j0,P0=Q_);var M0,x0,P0,L0,U0=j0,F0=(a(q0,x0=Q_),q0);function q0(e){var t=e.messageIds,e=e.source,n=x0.call(this)||this;return n.messageIds=t,n.source=e,n}function j0(e){var t=e.messages,e=e.source,n=P0.call(this)||this;return n.messages=t,n.source=e,n}function H0(e){var t=e.reqId,e=e.source,n=L0.call(this)||this;return n.reqId=t,n.source=e,n}a(H0,L0=Q_);a(kb,Z0=u);var G0,V0,B0,K0,Q0,z0,W0,Y0,X0,J0,Z0,$0=kb,eb=(a(Cb,J0=v),Cb),tb=(a(Sb,X0=u),Sb),nb=(a(wb,Y0=v),wb),rb=(a(Tb,W0=u),Tb),ib=(a(Ib,z0=v),Ib),sb=(a(bb,Q0=u),bb),ab=(a(Eb,K0=v),Eb),ob={},ub=(gb.of=function(e){return ob[e]},gb.prototype.buildMessageFromSerializedData=function(e){var t=Gg(e);switch(t.messageType){case sm.USER:return new o0(this._iid,o0.payloadify(t));case sm.FILE:return new l0(this._iid,l0.payloadify(t));case sm.ADMIN:return new s0(this._iid,s0.payloadify(t))}return null},gb.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return k({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations)})},gb.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return k({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),fileType:e.fileType,requireAuth:t.requireAuth})},gb.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return f(f({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},gb.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return f(f({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},gb.prototype.buildSenderFromSerializedData=function(e){e=Gg(e);return new t0(this._iid,t0.payloadify(e))},gb.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=new $0(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(eb).message]}})})},gb.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=new sb(n),[4,this._requestQueue.send(t)];case 1:return[2,e.sent().as(ab).message]}})})},gb.prototype.getMessagesByTimestamp=function(r,i,s,a,o){return void 0===o&&(o=A0.REQUEST_MESSAGE),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=new tb(f(f({channelType:i,channelUrl:r,timestamp:s},O0),a)),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(nb).messages,this._dispatcher.dispatch(new U0({messages:n,source:o})),[2,n]}})})},gb.prototype.getThreadedMessagesByTimestamp=function(i,s,a,o){return void 0===o&&(o=A0.REQUEST_THREADED_MESSAGE),re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=new tb(f(f(f({channelUrl:i.channelUrl,channelType:i.channelType,timestamp:s},i0),a),{replyType:cm.ALL,parentMessageId:i.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(nb).messages,(r=n.slice(1)).forEach(function(e){e.parentMessage=i}),this._dispatcher.dispatch(new U0({messages:r,source:o})),[2,{parentMessage:n[0],threadedMessages:r}]}})})},gb.prototype.getMessageChangelogs=function(a,o,u,c,l){return void 0===l&&(l=A0.REQUEST_MESSAGE_CHANGELOGS),re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return t=new rb(k(f(f({channelType:o,channelUrl:a,timestamp:"number"==typeof u?u:null,token:"string"==typeof u?u:null},R0),c))),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),i=t.as(ib),n=i.updatedMessages,s=i.deletedMessagesInfo,r=i.hasMore,i=i.nextToken,s=s.map(function(e){return e.messageId}),0<n.length&&this._dispatcher.dispatch(new U0({messages:n,source:l})),0<s.length&&this._dispatcher.dispatch(new F0({messageIds:s,source:l})),[2,{updatedMessages:n,deletedMessageIds:s,hasMore:r,token:i}]}})})},gb),cb=(mb.prototype._trigger=function(e,t){switch(t.sendingStatus){case hm.PENDING:this._onPending(t);break;case hm.FAILED:case hm.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);break;case hm.SCHEDULED:case hm.SUCCEEDED:this._onSucceeded(t)}},mb.prototype.onPending=function(e){return this._onPending=e,this},mb.prototype.onFailed=function(e){return this._onFailed=e,this},mb.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},mb),lb=(a(yb,B0=yo),yb),hb={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,includePollDetails:!1},Y=(Object.defineProperty(_b.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(_b.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),_b.prototype._validate=function(){return l("number",this.limit)&&0<this.limit},_b),db=(a(vb,V0=u),vb),fb=(a(pb,G0=v),pb);function pb(t,e){var n=G0.call(this,t,e)||this;return n.messages=e.results.map(function(e){return c0(t,e)}),n.hasNext=e.has_next,n.nextToken=e.end_cursor,n}function vb(e){var t=e.channelCustomType,n=e.keyword,r=e.limit,i=e.reverse,s=e.exactMatch,a=e.channelUrl,o=e.order,u=e.messageTimestampFrom,c=e.messageTimestampTo,l=e.advancedQuery,h=e.targetFields,e=e.nextToken,d=V0.call(this)||this;return d.method=A.GET,d.path="".concat(zm,"/messages"),d.params={custom_type:t,query:n,limit:r,reverse:i,exact_match:s,channel_url:a,message_ts_from:u,message_ts_to:c,sort_field:o,advanced_query:l,target_fields:h,after:e},d}function _b(e,t){this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!=(e=t.limit)?e:20}function yb(e,t){var n=B0.call(this,e)||this,r=(n.threadInfo=null,n.targetMessageId=0,n.channelUrl=null,n.channelType=null,t.thread_info),i=t.root_message_id,s=t.channel_url,t=t.channel_type;return r&&l("object",r)&&l("number",i)&&l("string",s)&&l("string",t)&&(n.threadInfo=new TE(e,r),n.targetMessageId=i,n.channelUrl=s,n.channelType=t),n}function mb(){this._onPending=Cy,this._onFailed=Cy,this._onSucceeded=Cy}function gb(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,t=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._onlineDetector=s,this._cacheContext=t,this.fileMessageQueue=new N0(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:t}),ob[e]=this}function Eb(e,t){var n=K0.call(this,e,t)||this;return n.message=t?c0(e,f({},t)):null,n}function bb(e){var t=e.channelUrl,e=e.scheduledMessageId,n=Q0.call(this)||this;return n.method=A.GET,n.path="".concat(Bm,"/").concat(encodeURIComponent(t),"/scheduled_messages/").concat(encodeURIComponent(e)),n.params={},n}function Ib(t,e){var n=z0.call(this,t,e)||this;return n.updatedMessages=e.updated.map(function(e){return c0(t,e)}),n.deletedMessagesInfo=e.deleted.map(function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}}),n.hasMore=e.has_more,n.nextToken=e.next,n}function Tb(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,i=e.token,s=e.replyType,a=e.includeMetaArray,o=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,e=e.includePollDetails,l=W0.call(this)||this;return l.method=A.GET,l.path="".concat(yg(t),"/").concat(encodeURIComponent(n),"/messages/changelogs"),l.params={change_ts:r,token:i,with_sorted_meta_array:a,include_reactions:o,include_thread_info:u,include_reply_type:s,include_parent_message_info:c,include_poll_details:e},l}function wb(t,e){var n=Y0.call(this,t,e)||this;return n.messages=e.messages.map(function(e){return c0(t,e)}),n}function Sb(e){var t=e.channelType,n=e.channelUrl,r=e.timestamp,r=void 0===r?null:r,i=e.token,i=void 0===i?null:i,s=e.prevResultSize,a=e.nextResultSize,o=e.isInclusive,u=e.reverse,c=e.messageTypeFilter,l=e.customTypesFilter,h=e.senderUserIdsFilter,d=e.replyType,f=e.includeMetaArray,p=e.includeReactions,v=e.parentMessageId,_=e.includeThreadInfo,y=e.includeParentMessageInfo,m=e.showSubchannelMessagesOnly,e=e.includePollDetails,g=X0.call(this)||this;return g.method=A.GET,g.path="".concat(yg(t),"/").concat(encodeURIComponent(n),"/messages"),g.params=k({is_sdk:!0,prev_limit:s,next_limit:a,include:o,reverse:u,message_ts:r,message_id:i,message_type:null!=c?c:null,custom_types:l,sender_ids:h,include_reply_type:d,with_sorted_meta_array:f,include_reactions:p,parent_message_id:v,include_thread_info:_,include_parent_message_info:y,show_subchannel_message_only:m,include_poll_details:e}),g}function Cb(e,t){var n=J0.call(this,e,t)||this;return n.message=t?c0(e,f({},t)):null,n}function kb(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,i=e.includeMetaArray,s=e.includeReactions,a=e.includeThreadInfo,o=e.includeParentMessageInfo,e=e.includePollDetails,u=Z0.call(this)||this;return u.method=A.GET,u.path="".concat(yg(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r)),u.params={is_sdk:!0,with_sorted_meta_array:i,include_reactions:s,include_thread_info:a,include_parent_message_info:o,include_poll_details:e},u}(ot=M0=M0||{}).SCORE="score",ot.TIMESTAMP="ts";a(qb,Rb=Y),qb.prototype._validate=function(){return Rb.prototype._validate.call(this)&&l("string",this.keyword)&&0<this.keyword.length&&l("boolean",this.reverse)&&l("boolean",this.exactMatch)&&l("string",this.channelUrl)&&l("string",this.channelCustomType)&&(l("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(l("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&X_(M0,this.order)&&l("boolean",this.advancedQuery)&&J_("string",this.targetFields,!0)},qb.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=y.of(this._iid).requestQueue,n=new db(f(f({},this),{nextToken:this._nextToken||null})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(fb),r=n.messages,i=n.hasNext,s=n.nextToken,this._nextToken=s,this._hasNext=i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})};var Ab,Nb,Ob,Rb,Db=qb,W=(a(Fb,Ob=Y),Fb.prototype._validate=function(){return Ob.prototype._validate.call(this)&&l("string",this.channelUrl)&&X_(rm,this.channelType)},Fb),Mb=(a(Ub,Nb=W),Ub.prototype._validate=function(){return Nb.prototype._validate.call(this)&&l("boolean",this.reverse)&&X_(am,this.messageTypeFilter)&&X_(cm,this.replyType)&&J_("string",this.customTypesFilter,!0)&&J_("string",this.senderUserIdsFilter,!0)&&l("boolean",this.includeMetaArray)&&l("boolean",this.includeReactions)&&l("boolean",this.includeParentMessageInfo)&&l("boolean",this.includeThreadInfo)&&l("boolean",this.showSubchannelMessagesOnly)},Ub.prototype.load=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,ub.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return t=e.sent(),this._edge=Math.min.apply(Math,U_([Number.MAX_SAFE_INTEGER],L_(t.map(function(e){return e.createdAt})),!1)),this._hasNext=t.length>=this.limit,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},Ub),xb={channelUrl:null,scheduledMessageId:0},Pb=(a(Lb,Ab=We),Lb.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;Ab.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new ub(e,{sdkState:n,dispatcher:r,requestQueue:s,onlineDetector:o,cacheContext:t})},Lb.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},Lb.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},Lb.prototype.getMessage=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){return n=f(f({},hb),n),h(l("string",(t=n).channelUrl)&&l("string",t.channelType)&&X_(rm,t.channelType)&&l("number",t.messageId)&&l("boolean",t.includeMetaArray)&&l("boolean",t.includeParentMessageInfo)&&l("boolean",t.includeThreadInfo)&&l("boolean",t.includePollDetails)).throw(p.invalidParameters),[2,this._manager.getMessage(n)];var t})})},Lb.prototype.getScheduledMessage=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){return n=f(f({},xb),n),h(l("string",(t=n).channelUrl)&&l("number",t.scheduledMessageId)).throw(p.invalidParameters),[2,this._manager.getScheduledMessage(n)];var t})})},Lb);function Lb(){var e=null!==Ab&&Ab.apply(this,arguments)||this;return e.name="message",e}function Ub(e,t,n,r){var i=this;return(i=Nb.call(this,e,t,n,r)||this).reverse=!1,i.messageTypeFilter=am.ALL,i.customTypesFilter=null,i.senderUserIdsFilter=null,i.replyType=cm.NONE,i.includeMetaArray=!1,i.includeReactions=!1,i.includeParentMessageInfo=!1,i.includeThreadInfo=!1,i.showSubchannelMessagesOnly=!1,i._edge=Number.MAX_SAFE_INTEGER,i.reverse=null!=(e=r.reverse)&&e,i.messageTypeFilter=null!=(t=r.messageTypeFilter)?t:am.ALL,i.customTypesFilter=null!=(n=r.customTypesFilter)?n:null,i.senderUserIdsFilter=null!=(e=r.senderUserIdsFilter)?e:null,i.replyType=null!=(t=r.replyType)?t:cm.NONE,i.includeMetaArray=null!=(n=r.includeMetaArray)&&n,i.includeReactions=null!=(e=r.includeReactions)&&e,i.includeParentMessageInfo=null!=(t=r.includeParentMessageInfo)&&t,i.includeThreadInfo=null!=(n=r.includeThreadInfo)&&n,i.showSubchannelMessagesOnly=null!=(e=r.showSubchannelMessagesOnly)&&e,i}function Fb(e,t,n,r){e=Ob.call(this,e,r)||this;return e.channelUrl=t,e.channelType=n,e}function qb(e,t){var n=this;return(n=Rb.call(this,e,t)||this).keyword="",n.reverse=!1,n.exactMatch=!1,n.channelUrl="",n.channelCustomType="",n.messageTimestampFrom=null,n.messageTimestampTo=null,n.order=M0.SCORE,n.advancedQuery=!1,n.targetFields=null,n._nextToken="",n.keyword=t.keyword,n.reverse=null!=(e=t.reverse)&&e,n.exactMatch=null!=(e=t.exactMatch)&&e,n.channelUrl=null!=(e=t.channelUrl)?e:"",n.channelCustomType=null!=(e=t.channelCustomType)?e:"",n.messageTimestampFrom=null!=(e=t.messageTimestampFrom)?e:null,n.messageTimestampTo=null!=(e=t.messageTimestampTo)?e:null,n.order=null!=(e=t.order)?e:M0.SCORE,n.advancedQuery=null!=(e=t.advancedQuery)&&e,n.targetFields=null!=(e=t.targetFields)?e:null,n}function jb(e){return l("string",e.data,!0)&&l("string",e.customType,!0)&&X_(um,e.mentionType)&&J_("string",e.mentionedUserIds,!0)&&J_(_,e.mentionedUsers,!0)&&l("string",e.mentionedMessageTemplate,!0)&&J_(ME,e.metaArrays,!0)&&l("number",e.parentMessageId,!0)&&l("boolean",e.isReplyToChannel)&&X_(lm,e.pushNotificationDeliveryOption,!0)&&l(LE,e.appleCriticalAlertOptions,!0)}function Hb(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}var Gb,Di={data:null,customType:null,mentionType:um.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},Vb=f(f({},Di),{message:null,translationTargetLanguages:null});(dr=Gb=Gb||{}).FILE="file",dr.BLOB="blob",dr.BLOB_LIKE_OBJECT="blobLikeObject",dr.URL="url";function Bb(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob}function Kb(e){return e===Gb.BLOB||e===Gb.FILE}function Qb(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}function zb(e){return jb(e)&&(V_(e.file)||l("string",e.fileUrl))&&l("string",e.fileName,!0)&&l("string",e.mimeType,!0)&&l("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every(function(e){return l("object",e)&&0<e.maxWidth&&0<e.maxHeight}))}var Wb,Yb=f(f({},Di),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1});(wt=Wb=Wb||{}).MUTED="muted",wt.BANNED="banned";function Xb(e){return l("string",e.data,!0)&&l("string",e.customType,!0)&&X_(um,e.mentionType)&&J_("string",e.mentionedUserIds,!0)&&J_(_,e.mentionedUsers,!0)&&l("string",e.mentionedMessageTemplate,!0)&&J_(ME,e.metaArrays,!0)&&X_(lm,e.pushNotificationDeliveryOption,!0)&&l(LE,e.appleCriticalAlertOptions,!0)}RI.payloadify=function(e){return e?k({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null};var Jb,Zb,$b,eI,tI,nI,rI,iI,sI,aI,oI,uI=RI,cI=(a(OI,oI=_),OI.payloadify=function(e){return e?k(f(f({},oI.payloadify.call(this,e)),uI.payloadify(e.restrictionInfo))):null},OI),In={data:null,customType:null,mentionType:um.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},lI=f(f({},In),{message:null,translationTargetLanguages:null}),hI=f({},In),dI=(a(NI,aI=u),NI),fI=(a(AI,sI=v),AI),pI=(a(kI,iI=W),kI.prototype._validate=function(){return iI.prototype._validate.call(this)},kI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:(t=[],this._hasNext?(this._isLoading=!0,n=y.of(this._iid).requestQueue,r=new dI(f(f({},this),{channelUrl:this.channelUrl,token:this._token})),[4,n.send(r)]):[3,2]):[3,5];case 1:return n=e.sent(),r=n.as(fI),i=r.operators,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,t];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},kI),vI=(a(CI,rI=u),CI),_I=(a(SI,nI=v),SI),yI=(a(wI,tI=W),wI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=y.of(this._iid).requestQueue,n=new vI(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(_I),r=n.mutedUsers,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},wI),mI=(a(TI,eI=u),TI),gI=(a(II,$b=v),II),EI=(a(bI,Zb=W),bI.prototype._validate=function(){return Zb.prototype._validate.call(this)},bI.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=y.of(this._iid).requestQueue,n=new mI(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(gI),r=n.bannedUsers,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},bI);function bI(e,t,n,r){return Zb.call(this,e,t,n,r)||this}function II(t,e){var n=$b.call(this,t,e)||this,r=(n.token=null,n.bannedUsers=[],e.next),e=e.banned_list;return n.token=r,e&&0<e.length&&(n.bannedUsers=e.map(function(e){return new cI(t,e.user)})),n}function TI(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.limit,e=e.token;return(t=eI.call(this)||this).method=A.GET,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=k({limit:i,token:e}),t}function wI(e,t,n,r){return tI.call(this,e,t,n,r)||this}function SI(t,e){var n=nI.call(this,t,e)||this,r=(n.token=null,n.mutedUsers=[],e.next),e=e.muted_list;return n.token=r,e&&0<e.length&&(n.mutedUsers=e.map(function(e){return new cI(t,e)})),n}function CI(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.limit,e=e.token;return(t=rI.call(this)||this).method=A.GET,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={limit:i,token:e},t}function kI(e,t,n,r){return iI.call(this,e,t,n,r)||this}function AI(t,e){var n=sI.call(this,t,e)||this;return n.operators=e.operators.map(function(e){return new _(t,e)}),n.token=e.next,n}function NI(e){var t=e.channelUrl,n=e.channelType,r=e.token,e=e.limit,i=aI.call(this)||this;return i.method=A.GET,i.path="".concat(yg(n),"/").concat(encodeURIComponent(t),"/operators"),i.params={token:r,limit:e},i}function OI(e,t){e=oI.call(this,e,t)||this;return e.restrictionInfo=null,e.restrictionInfo=new uI(t),e}function RI(e){var t;this.restrictionType=null,this.description=null,this.endAt=-1,X_(Wb,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!=(t=e.description)?t:null,this.endAt=null!=(t=null!=(t=e.end_at)?t:e.muted_end_at)?t:-1}(pa=Jb=Jb||{}).SPAM="spam",pa.HARASSING="harassing",pa.SUSPICIOUS="suspicious",pa.INAPPROPRIATE="inappropriate";a(PI,DI=u);var DI,MI,xI=PI;function PI(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=DI.call(this)||this).method=A.POST,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}a(function(){return null!==MI&&MI.apply(this,arguments)||this},MI=v);a(qI,LI=u);var LI,UI,FI=qI;function qI(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.operatorUserIds;return(t=LI.call(this)||this).method=A.DELETE,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/operators"),t.params={operator_ids:e},t}a(function(e,t){return UI.call(this,e,t)||this},UI=v);a(VT,iT=u);var jI,HI,GI,VI,BI,KI,QI,zI,WI,YI,XI,JI,ZI,$I,eT,tT,nT,rT,iT,sT,aT=VT,oT=(a(GT,rT=v),GT),uT=(a(HT,nT=u),HT),cT=(a(jT,tT=v),jT),lT=(a(qT,eT=u),qT),hT=(a(FT,$I=v),FT),dT=(a(UT,ZI=My),UT),fT=(a(LT,JI=u),LT),pT=(a(PT,XI=v),PT),vT=(a(xT,YI=u),xT),_T=(a(MT,WI=v),MT),yT=(a(DT,zI=u),DT),mT=(a(RT,QI=v),RT),gT=(a(OT,KI=u),OT),ET=(a(NT,BI=v),NT),bT=(a(AT,VI=u),AT),IT=(a(kT,GI=v),kT),TT=(a(CT,HI=My),CT),wT=(a(ST,jI=u),ST);function ST(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=jI.call(this)||this).method=A.DELETE,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/metacounter/").concat(e),t.params=null,t}function CT(e,t,n){e=HI.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function kT(e,t){e=GI.call(this,e,t)||this;return e.metaCounter=t,e}function AT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.metaCounter,s=e.upsert,s=void 0!==s&&s,e=e.mode,e=void 0===e?"set":e;return(t=VI.call(this)||this).method=A.PUT,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:i,upsert:s,mode:e},t}function NT(e,t){e=BI.call(this,e,t)||this;return e.metaCounter=t,e}function OT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.metaCounter;return(t=KI.call(this)||this).method=A.POST,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={metacounter:e},t}function RT(e,t){e=QI.call(this,e,t)||this;return e.metaCounter=t,e}function DT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=zI.call(this)||this).method=A.GET,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/metacounter"),t.params={keys:e},t}function MT(e,t){e=WI.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function xT(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=YI.call(this)||this).method=A.PUT,t.path="".concat(yg(e),"/").concat(encodeURIComponent(n),"/metadata"),t.params={include_ts:!0},t}function PT(e,t){e=XI.call(this,e,t)||this,e.ts=null,t=t.ts;return e.ts=null!=t?t:null,e}function LT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.key;return(t=JI.call(this)||this).method=A.DELETE,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/metadata/").concat(e),t.params={include_ts:!0},t}function UT(e,t,n){e=ZI.call(this,e,"SYEV",n)||this;return e.created=null,e.updated=null,e.deleted=null,n.data&&(e.created=n.data.created,e.updated=n.data.updated,e.deleted=n.data.deleted),e}function FT(e,t){var e=$I.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function qT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.metadata,e=e.upsert;return(t=eT.call(this)||this).method=A.PUT,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={metadata:i,include_ts:!0,upsert:null!=e&&e},t}function jT(e,t){var e=tT.call(this,e,t)||this,n=(e.ts=null,t.metadata),t=t.ts;return e.metadata=n,e.ts=null!=t?t:null,e}function HT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.keys;return(t=nT.call(this)||this).method=A.GET,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/metadata"),t.params={keys:e,include_ts:!0},t}function GT(e,t){var e=rT.call(this,e,t)||this,n=(e.isMuted=!1,e.startAt=null,e.endAt=null,e.remainingDuration=null,e.description=null,t.is_muted),r=t.start_at,i=t.end_at,s=t.remaining_duration,t=t.description;return e.isMuted=n,e.startAt=r,e.endAt=i,e.remainingDuration=s,e.description=t,e}function VT(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=iT.call(this)||this).method=A.GET,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/mute/").concat(e),t}a(function(e,t){return sT.call(this,e,t)||this},sT=v);a(zT,BT=u);var BT,KT,QT=zT;function zT(e){var t=this,n=e.channelUrl,e=e.channelType;return(t=BT.call(this)||this).method=A.DELETE,t.path="".concat(yg(e),"/").concat(encodeURIComponent(n),"/metacounter"),t.params=null,t}a(function(){return null!==KT&&KT.apply(this,arguments)||this},KT=v);a(JT,WT=u);var WT,YT,XT=JT;function JT(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.userId,s=e.seconds,e=e.description;return(t=WT.call(this)||this).method=A.POST,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/mute"),t.params={user_id:i,seconds:s,description:e},t}a(function(e,t){return YT.call(this,e,t)||this},YT=v);a(iw,$T=My);var ZT,$T,ew,tw=iw,nw=(a(rw,ZT=u),rw);function rw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=ZT.call(this)||this).method=A.DELETE,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/mute/").concat(encodeURIComponent(e)),t}function iw(e,t,n){var r=$T.call(this,e,"SYEV",n)||this;return r.user=new cI(e,n.data),r}a(function(){return null!==ew&&ew.apply(this,arguments)||this},ew=v);a(hw,aw=My);var sw,aw,ow,uw=hw,cw=(a(lw,sw=u),lw);function lw(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.userId,s=e.seconds,e=e.description;return(t=sw.call(this)||this).method=A.POST,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/ban"),t.params=k({user_id:i,seconds:s,description:e}),t}function hw(e,t,n){var r=aw.call(this,e,"SYEV",n)||this;return r.user=new cI(e,n.data),r}a(function(){return null!==ow&&ow.apply(this,arguments)||this},ow=v);a(mw,fw=My);var dw,fw,pw,vw=mw,_w=(a(yw,dw=u),yw);function yw(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.userId;return(t=dw.call(this)||this).method=A.DELETE,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/ban/").concat(encodeURIComponent(e)),t}function mw(e,t,n){var r=fw.call(this,e,"SYEV",n)||this;return r.memberCount=null,r.joinedMemberCount=null,r.user=new cI(e,n.data),n.data.member_count&&(r.memberCount=n.data.member_count),n.data.joined_member_count&&(r.joinedMemberCount=n.data.joined_member_count),r}a(function(){return null!==pw&&pw.apply(this,arguments)||this},pw=v);a(Sw,Ew=My);var gw,Ew,bw,Iw=Sw,Tw=(a(ww,gw=u),ww);function ww(e){var t=this,n=e.channelUrl,r=e.channelType,e=e.freezing;return(t=gw.call(this)||this).method=A.PUT,t.path="".concat(yg(r),"/").concat(encodeURIComponent(n),"/freeze"),t.params={freeze:e},t}function Sw(e,t,n){var r=Ew.call(this,e,"SYEV",n)||this;return r.user=new cI(e,n.data),r}a(function(){return null!==bw&&bw.apply(this,arguments)||this},bw=v);a(sS,Lw=My);var Cw,kw,Aw,Nw,Ow,Rw,Dw,Mw,xw,Pw,Lw,Uw,Fw=sS,qw=(a(iS,Pw=u),iS),jw=(a(rS,xw=u),rS),Hw=(a(nS,Mw=u),nS),Gw=(a(tS,Dw=xy),tS),Vw=(a(eS,Rw=My),eS),Bw=(a($w,Ow=xy),$w),Kw=(a(Zw,Nw=My),Zw),Qw=(a(Jw,Aw=xy),Jw),zw=(a(Xw,kw=My),Xw),Ww=(a(Yw,Cw=u),Yw);function Yw(e){var t=Cw.call(this)||this;return t.method=A.DELETE,t.path="".concat(yg(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),t}function Xw(e,t,n){var r,i=this,e=((i=kw.call(this,e,"FEDI",n)||this).message=new l0(e,n),y.of(e).sdkState);return i.mentionCountChange=gg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function Jw(e){var t=[];return e.mentionType===um.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),Aw.call(this,{code:"FEDI",ackRequired:!0,payload:k({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function Zw(e,t,n){var r,i=this,e=((i=Nw.call(this,e,"MEDI",n)||this).message=new o0(e,n),y.of(e).sdkState);return i.mentionCountChange=gg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function $w(e){var t=[];return e.mentionType===um.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),Ow.call(this,{code:"MEDI",ackRequired:!0,payload:k({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}function eS(e,t,n){var r,i=this,e=((i=Rw.call(this,e,"MESG",n)||this).message=new o0(e,n),y.of(e).sdkState);return i.isMentioned=Cg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function tS(e){var t=[];return e.mentionType===um.USERS&&(e.mentionedUserIds?t=e.mentionedUserIds:e.mentionedUsers&&(t=e.mentionedUsers.map(function(e){return e.userId}))),Dw.call(this,{code:"MESG",ackRequired:!0,payload:k({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:t,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==lm.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:0<e.parentMessageId?e.parentMessageId:null,req_id:e.reqId})})||this}function nS(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,a=e.offendingUserId,o=e.messageId,e=e.description;return(t=Mw.call(this)||this).method=A.POST,t.path="".concat(mg(r),"/").concat(encodeURIComponent(n),"/messages/").concat(o),t.params={report_category:i,reporting_user_id:s,report_description:e,offending_user_id:a},t}function rS(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,a=e.offendingUserId,e=e.description;return(t=xw.call(this)||this).method=A.POST,t.path="/report/users/".concat(a),t.params={channel_url:n,channel_type:r===rm.OPEN?"open_channels":"group_channels",report_category:i,reporting_user_id:s,report_description:e},t}function iS(e){var t=this,n=e.channelUrl,r=e.channelType,i=e.category,s=e.userId,e=e.description;return(t=Pw.call(this)||this).method=A.POST,t.path="".concat(mg(r),"/").concat(encodeURIComponent(n)),t.params={report_category:i,reporting_user_id:s,report_description:e},t}function sS(e,t,n){e=Lw.call(this,e,"SYEV",n)||this;return e.freeze=n.data.freeze,e}a(function(){return null!==Uw&&Uw.apply(this,arguments)||this},Uw=v);a(HS,yS=My);var aS,oS,uS,cS,lS,hS,dS,fS,pS,vS,_S,yS,mS,gS=HS,ES=(a(jS,_S=u),jS),bS=(a(qS,vS=v),qS),IS=(a(FS,pS=u),FS),TS=(a(US,fS=v),US),wS=(a(LS,dS=u),LS),SS=(a(PS,hS=v),PS),CS=(a(xS,lS=u),xS),kS=(a(MS,cS=v),MS),AS=(a(DS,uS=u),DS),NS=(a(RS,oS=v),RS),OS=(a(m,aS=yo),m.payloadify=function(e){return k(f(f({},aS.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:_.payloadify(e.creator),created_at:e.createdAt/1e3}))},m.prototype.isGroupChannel=function(){return this.channelType===rm.GROUP},m.prototype.isOpenChannel=function(){return this.channelType===rm.OPEN},Object.defineProperty(m.prototype,"cachedMetaData",{get:function(){var n={};return this._cachedMetaData.forEach(function(e,t){e.isRemoved||(n[t]=e.value)}),n},enumerable:!1,configurable:!0}),m.prototype._upsertCachedMetaData=function(n,r){var i=this;Object.keys(n).forEach(function(e){var t=i._cachedMetaData.get(e);(!t||t.updatedAt<=r)&&i._cachedMetaData.set(e,{value:n[e],isRemoved:!1,updatedAt:r})})},m.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach(function(e){e=n._cachedMetaData.get(e);e&&e.updatedAt<t&&(e.isRemoved=!1,e.updatedAt=t)})},m.prototype._generateRequestId=function(){return"rq-".concat(K_())},m.prototype.isIdentical=function(e){return e&&this.url===e.url},m.prototype.isEqual=function(e){return H_(this,e)},m.prototype.createOperatorListQuery=function(e){return new pI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},m.prototype.createMutedUserListQuery=function(e){return new yI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},m.prototype.createBannedUserListQuery=function(e){return new EI(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},m.prototype.createPreviousMessageListQuery=function(e){return new Mb(this._iid,this.url,this.channelType,e=void 0===e?{}:e)},m.prototype.addOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",r)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new xI({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.removeOperators=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",r)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new FI({channelUrl:this.url,channelType:this.channelType,operatorUserIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.getMyMutedInfo=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new aT({channelUrl:this.url,channelType:this.channelType,userId:n.userId}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(oT),r=n.isMuted,i=n.startAt,s=n.endAt,a=n.remainingDuration,o=n.description,[2,{isMuted:r,startAt:i,endAt:s,remainingDuration:a,description:o}]}})})},m.prototype.getMetaData=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",s)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new uT({channelUrl:this.url,channelType:this.channelType,keys:s}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(cT),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},m.prototype.getAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new uT({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(cT),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},m.prototype.createMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new kg({channelUrl:this.url,channelType:this.channelType,metadata:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(Ag).metaData,this._upsertCachedMetaData(n,0),[2,n]}})})},m.prototype.updateMetaData=function(s,a){return void 0===a&&(a=!1),re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new lT({channelUrl:this.url,channelType:this.channelType,metadata:s,upsert:a}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(hT),r=n.metadata,i=n.ts,this._upsertCachedMetaData(r,i),[2,r]}})})},m.prototype.deleteMetaData=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new fT({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(pT).ts,this._removeFromCachedMetaData([r],n),[2]}})})},m.prototype.deleteAllMetaData=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new vT({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(_T).ts,this._removeFromCachedMetaData(U_([],L_(this._cachedMetaData.keys()),!1),n),[2]}})})},m.prototype.getMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",r)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new yT({channelUrl:this.url,channelType:this.channelType,keys:r}),[4,t.send(n)];case 1:return[2,e.sent().as(mT).metaCounter]}})})},m.prototype.getAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new yT({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,t.send(n)];case 1:return[2,e.sent().as(mT).metaCounter]}})})},m.prototype.createMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new gT({channelUrl:this.url,channelType:this.channelType,metaCounter:r}),[4,t.send(n)];case 1:return[2,e.sent().as(ET).metaCounter]}})})},m.prototype.updateMetaCounters=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new bT({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:i}),[4,t.send(n)];case 1:return[2,e.sent().as(IT).metaCounter]}})})},m.prototype.increaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new bT({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return[2,e.sent().as(IT).metaCounter]}})})},m.prototype.decreaseMetaCounters=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new bT({channelUrl:this.url,channelType:this.channelType,metaCounter:r,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return[2,e.sent().as(IT).metaCounter]}})})},m.prototype.deleteMetaCounter=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new wT({channelUrl:this.url,channelType:this.channelType,key:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.deleteAllMetaCounters=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new QT({channelUrl:this.url,channelType:this.channelType}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.muteUser=function(t,n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.muteUserWithUserId(t.userId,n,r)]})})},m.prototype.muteUserWithUserId=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)&&l("number",i,!0)&&l("string",s,!0)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new XT({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.unmuteUser=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unmuteUserWithUserId(t.userId)]})})},m.prototype.unmuteUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new nw({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.banUser=function(t,n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.banUserWithUserId(t.userId,n,r)]})})},m.prototype.banUserWithUserId=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)&&l("number",i,!0)&&l("string",s,!0)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new cw({channelUrl:this.url,channelType:this.channelType,userId:r,seconds:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.unbanUser=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unbanUserWithUserId(t.userId)]})})},m.prototype.unbanUserWithUserId=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new _w({channelUrl:this.url,channelType:this.channelType,userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.freeze=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new Tw({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!0,[2]}})})},m.prototype.unfreeze=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new Tw({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,t.send(n)];case 1:return e.sent(),this.isFrozen=!1,[2]}})})},m.prototype.getMessagesByTimestamp=function(n,r){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return r=f(f({},O0),r),h(l("number",n)&&(l("number",(t=r).prevResultSize)&&l("number",t.nextResultSize)&&l("boolean",t.isInclusive)&&l("boolean",t.reverse)&&l("string",t.messageTypeFilter)&&X_(am,t.messageTypeFilter)&&J_("string",t.customTypesFilter,!0)&&J_("string",t.senderUserIdsFilter,!0)&&X_(cm,t.replyType)&&l("boolean",t.includeMetaArray)&&l("boolean",t.includeReactions)&&l("boolean",t.includeParentMessageInfo)&&l("boolean",t.includeThreadInfo)&&l("boolean",t.showSubchannelMessagesOnly))).throw(p.invalidParameters),[4,ub.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,n,r)];case 1:return[2,e.sent()]}var t})})},m.prototype.getMessageChangeLogsSinceTimestamp=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},R0),n),h(l("number",t)&&k0(n)).throw(p.invalidParameters),[4,ub.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},m.prototype.getMessageChangeLogsSinceToken=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return n=f(f({},R0),n),h(l("string",t)&&k0(n)).throw(p.invalidParameters),[4,ub.of(this._iid).getMessageChangelogs(this.url,this.channelType,t,n)];case 1:return[2,e.sent()]}})})},m.prototype._createPendingSendableMessagePayload=function(e,t,n){var r=y.of(this._iid).sessionManager;return k({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(e){return ME.payloadify(e)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?LE.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:t0.payloadify(r.currentUser),req_id:t,request_state:hm.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:e.mentionedUsers})},m.prototype._createPendingUserMessage=function(e,t,n){var r={};if(e.translationTargetLanguages)try{for(var i=se(e.translationTargetLanguages),s=i.next();!s.done;s=i.next())r[s.value]=""}catch(e){o={error:e}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(o)throw o.error}}var a=k(f(f({},this._createPendingSendableMessagePayload(e,t,n)),{type:sm.USER,message:e.message,translations:r})),o=new o0(this._iid,a);return o.messageParams=e,o},m.prototype._createPendingScheduledUserMessage=function(e,t,n){t=this._createPendingUserMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},m.prototype._createPendingFileMessage=function(e,t,n){t=k(f(f({},this._createPendingSendableMessagePayload(e,t,n)),{type:sm.FILE,url:e.fileUrl,file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}}):[]})),n=new l0(this._iid,t);return n.messageParams=e,n},m.prototype._createPendingScheduledFileMessage=function(e,t,n){t=this._createPendingFileMessage(e,t,n);return t.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},t},m.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===d.REQUEST_CANCELED?e.sendingStatus=hm.CANCELED:n||(e.sendingStatus=hm.FAILED)},m.prototype.sendUserMessage=function(e){return e=f(f({},Vb),e),h(jb(t=e)&&l("string",t.message)&&J_("string",t.translationTargetLanguages,!0)).throw(p.invalidParameters),this._sendUserMessage(e);var t},m.prototype._sendUserMessage=function(r,i,e){var n,s=this,t=(void 0===i&&(i=Date.now()),void 0===e&&(e=null),y.of(this._iid)),a=t.dispatcher,t=t.requestQueue,o=e,u=new cb,e=(o||(o=this._generateRequestId(),n=y.of(this._iid).dispatcher,$y(2).then(function(){var t=s._createPendingUserMessage(r,o,i);n.dispatch(new U0({messages:[t],source:A0.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})})),new Gw(f({channelUrl:this.url,channelType:this.channelType,reqId:o},r)));return t.send(e).then(function(e){var t=e.as(Vw).message;a.dispatch(new U0({messages:[t],source:A0.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})}).catch(function(n){if(j_(n))throw n;$y(2).then(function(){var t=s._createPendingUserMessage(r,o,i),e=y.of(s._iid).cacheContext.localCacheEnabled&&G_(n.code);s._markMessageAsFailed(t,n,e),a.dispatch(new U0({messages:[t],source:t.sendingStatus===hm.PENDING?A0.REQUEST_RESEND_MESSAGE:A0.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(n,t)]})})})})}),u},m.prototype._autoResendUserMessage=function(e){return h(e instanceof o0).throw(p.invalidParameters),this._sendUserMessage(e.messageParams,e.createdAt,e.reqId)},m.prototype.resendUserMessage=function(r){var i;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return h(r instanceof o0&&!r.scheduledInfo).throw(p.invalidParameters),t=new Vy,n=null!=(i=r.messageParams)?i:k({data:r.data,customType:r.customType,mentionType:r.mentionType,mentionedUsers:r.mentionedUsers,mentionedUserIds:r.mentionedUserIds,mentionedMessageTemplate:r.mentionedMessageTemplate,metaArrays:r.metaArrays,parentMessageId:r.parentMessageId,appleCriticalAlertOptions:r.appleCriticalAlertOptions,message:r.message,translationTargetLanguages:Object.keys(r.translations)}),this._sendUserMessage(n).onFailed(function(e){return t.reject(e)}).onSucceeded(function(e){return t.resolve(e)}),[2,t.promise]})})},m.prototype.updateUserMessage=function(s,a){return re(this,void 0,void 0,function(){var n,r,i;return ie(this,function(e){switch(e.label){case 0:return a=f(f({},lI),a),h(l("number",s)&&(Xb(t=a)&&l("string",t.message,!0)&&J_("string",t.translationTargetLanguages,!0))).throw(p.invalidParameters),r=y.of(this._iid),n=r.dispatcher,r=r.requestQueue,i=new Bw(f({channelType:this.channelType,channelUrl:this.url,messageId:s},a)),[4,r.send(i)];case 1:return r=e.sent(),i=r.as(Kw).message,n.dispatch(new U0({messages:[i],source:A0.EVENT_MESSAGE_UPDATED})),[2,i]}var t})})},m.prototype.copyUserMessage=function(r,i){var s;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return h(r instanceof m&&i instanceof o0&&i.sendingStatus===hm.SUCCEEDED&&r.url===i.channelUrl&&!i.scheduledInfo).throw(p.invalidParameters),t=new Vy,n=null!=(s=i.messageParams)?s:f(f({},i),{mentionType:i.mentionType,mentionedUserIds:null!=(s=i.mentionedUserIds)?s:null==(s=i.mentionedUsers)?void 0:s.map(function(e){return e.userId}),translationTargetLanguages:Object.keys(i.translations),pushNotificationDeliveryOption:lm.DEFAULT,parentMessageId:null,isReplyToChannel:!1}),r._sendUserMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},m.prototype.translateUserMessage=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(r instanceof o0&&0<r.messageId&&J_("string",i)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new wS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,translationTargetLanguages:i}),[4,t.send(n)];case 1:return[2,e.sent().as(SS).message]}})})},m.prototype._createScheduledUserMessage=function(e,r){var i=this,t=y.of(this._iid).requestQueue,s=Date.now(),a=this._generateRequestId(),n=($y(2).then(function(){var t=i._createPendingScheduledUserMessage(e,a,s);ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}),new CS(f({reqId:a,channelType:this.channelType,channelUrl:this.url},e)));t.send(n).then(function(e){var t=e.as(kS).message;ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(j_(n))throw n;$y(2).then(function(){var t=i._createPendingScheduledUserMessage(e,a,s);i._markMessageAsFailed(t,n),ae(function(){return re(i,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(n,t)]})})})})})},m.prototype.sendFileMessage=function(e){return e=f(f({},Yb),e),h(zb(e)).throw(p.invalidParameters),this._sendFileMessage(e)},m.prototype._sendFileMessage=function(r,i,e){var s=this,a=(void 0===i&&(i=Date.now()),void 0===e&&(e=null),y.of(this._iid).dispatcher),t=ub.of(this._iid).fileMessageQueue,o=e,u=new cb;return o||(o=this._generateRequestId(),$y(2).then(function(){var t=s._createPendingFileMessage(r,o,i);a.dispatch(new U0({messages:[t],source:A0.EVENT_MESSAGE_SENT_PENDING})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})})),t.request(this,o,r).then(function(t){a.dispatch(new U0({messages:[t],source:A0.EVENT_MESSAGE_SENT_SUCCESS})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(null,t)]})})})}).catch(function(n){if(j_(n))throw n;$y(2).then(function(){var t=s._createPendingFileMessage(r,o,i),e=y.of(s._iid).cacheContext.localCacheEnabled&&G_(n.code);s._markMessageAsFailed(t,n,e),a.dispatch(new U0({messages:[t],source:t.sendingStatus===hm.PENDING?A0.REQUEST_RESEND_MESSAGE:A0.EVENT_MESSAGE_SENT_FAILED})),ae(function(){return re(s,void 0,void 0,function(){return ie(this,function(e){return[2,u._trigger(n,t)]})})})})}),u},m.prototype._autoResendFileMessage=function(e){h(e instanceof l0).throw(p.invalidParameters);var t=y.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.createdAt,e.reqId).onFailed(function(e){t.debug("autoResendFileMessage failed",e)}).onSucceeded(function(e){t.debug("autoResendFileMessage success",e)})},m.prototype._createScheduledFileMessage=function(e,r,i,s){var a=this,t=y.of(this._iid).requestQueue,n=new AS(f(f({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));t.send(n).then(function(e){var t=e.as(NS).message;ae(function(){return re(a,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(null,t)]})})})}).catch(function(n){if(j_(n))throw n;$y(2).then(function(){var t=a._createPendingScheduledFileMessage(e,i,s);a._markMessageAsFailed(t,n),ae(function(){return re(a,void 0,void 0,function(){return ie(this,function(e){return[2,r._trigger(n,t)]})})})})})},m.prototype.sendFileMessages=function(e){h(e.every(function(e){return zb(f(f({},Yb),e))})).throw(p.invalidParameters);var t,n,r=new cb;try{for(var i=se(e),s=i.next();!s.done;s=i.next()){var a=s.value;this.sendFileMessage(a).onPending(function(e){return r._trigger(null,e)}).onFailed(function(e,t){return r._trigger(e,t)}).onSucceeded(function(e){return r._trigger(null,e)})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},m.prototype.resendFileMessage=function(i,s){var a;return re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){return h(i instanceof l0&&s instanceof Blob&&!i.scheduledInfo).throw(p.invalidParameters),n=new Vy,r=null!=(a=i.messageParams)?a:(t=s,k({data:i.data,customType:i.customType,mentionType:i.mentionType,mentionedUsers:i.mentionedUsers,mentionedUserIds:i.mentionedUserIds,metaArrays:i.metaArrays,parentMessageId:i.parentMessageId,appleCriticalAlertOptions:i.appleCriticalAlertOptions,file:t=void 0===s?null:t,fileUrl:i.url,fileName:i.name,fileSize:i.size,mimeType:i.type,thumbnailSizes:i.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}})})),this._sendFileMessage(r).onFailed(function(e){return n.reject(e)}).onSucceeded(function(e){return n.resolve(e)}),[2,n.promise];var t})})},m.prototype.updateFileMessage=function(i,s){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return s=f(f({},hI),s),h(l("number",i)&&Xb(s)).throw(p.invalidParameters),n=y.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new Qw(f({channelType:this.channelType,channelUrl:this.url,messageId:i},s)),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(zw).message,t.dispatch(new U0({messages:[r],source:A0.EVENT_MESSAGE_UPDATED})),[2,r]}})})},m.prototype.cancelUploadingFileMessage=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return h(l("string",t)).throw(p.invalidParameters),ub.of(this._iid).fileMessageQueue.cancel(this,t),[2,!0]})})},m.prototype.copyFileMessage=function(r,i){var s;return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){return h(r instanceof m&&i instanceof l0&&i.sendingStatus===hm.SUCCEEDED&&r.url===i.channelUrl&&!i.scheduledInfo).throw(p.invalidParameters),t=new Vy,n=f(f({},i),{fileUrl:i.url,fileName:i.name,fileSize:i.size,mimeType:i.type,mentionType:i.mentionType,mentionedUserIds:null!=(s=i.mentionedUserIds)?s:null==(s=i.mentionedUsers)?void 0:s.map(function(e){return e.userId}),pushNotificationDeliveryOption:lm.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:i.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),requireAuth:i.requireAuth}),r._sendFileMessage(n).onSucceeded(function(e){return t.resolve(e)}).onFailed(function(e){return t.reject(e)}),[2,t.promise]})})},m.prototype.deleteMessage=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(r instanceof n0).throw(p.invalidParameters),0<r.messageId?(t=y.of(this._iid).requestQueue,n=new Ww({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},m.prototype.addReaction=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(r instanceof e0&&0<r.messageId&&l("string",i)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new ES({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:i}),[4,t.send(n)];case 1:return[2,e.sent().as(bS).reactionEvent]}})})},m.prototype.deleteReaction=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(r instanceof e0&&0<r.messageId&&l("string",i)).throw(p.invalidParameters),t=y.of(this._iid).requestQueue,n=new IS({channelType:this.channelType,channelUrl:this.url,messageId:r.messageId,reactionKey:i}),[4,t.send(n)];case 1:return[2,e.sent().as(TS).reactionEvent]}})})},m.prototype._updateMessageMetaArray=function(i,s,a,o){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return n=y.of(this._iid),t=n.dispatcher,n=n.requestQueue,r=new Bw({channelType:this.channelType,channelUrl:this.url,messageId:i,metaArrayParams:{array:s,mode:a,upsert:o}}),[4,n.send(r)];case 1:return n=e.sent(),r=n.as(Kw).message,t.dispatch(new U0({messages:[r],source:A0.EVENT_MESSAGE_UPDATED})),[2,r]}})})},m.prototype.createMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return h(n instanceof n0&&0<n.messageId&&J_("string",r)).throw(p.invalidParameters),t=r.map(function(e){return new ME({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"add",!0)]})})},m.prototype.deleteMessageMetaArrayKeys=function(n,r){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return h(n instanceof n0&&0<n.messageId&&J_("string",r)).throw(p.invalidParameters),t=r.map(function(e){return new ME({key:e})}),[2,this._updateMessageMetaArray(n.messageId,t,"remove",!0)]})})},m.prototype.addMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){return h(t instanceof n0&&0<t.messageId&&n.every(function(e){return e instanceof ME})).throw(p.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"add",!0)]})})},m.prototype.removeMessageMetaArrayValues=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){return h(t instanceof n0&&0<t.messageId&&n.every(function(e){return e instanceof ME})).throw(p.invalidParameters),[2,this._updateMessageMetaArray(t.messageId,n,"remove",!0)]})})},m.prototype.report=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(X_(Jb,r)&&l("string",i)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new qw({channelUrl:this.url,channelType:this.channelType,userId:n.userId,category:r,description:i}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.reportUser=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(r instanceof _&&X_(Jb,i)&&l("string",s)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new jw({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.userId,category:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m.prototype.reportMessage=function(r,i,s){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(r instanceof n0&&X_(Jb,i)&&l("string",s)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new Hw({channelUrl:this.url,channelType:this.channelType,userId:n.userId,offendingUserId:r.sender.userId,messageId:r.messageId,category:i,description:s}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},m);function m(e,t){var n=this;return(n=aS.call(this,e)||this).url="",n.channelType=rm.BASE,n.name="",n.coverUrl="",n.customType="",n.data="",n.isFrozen=!1,n.isEphemeral=!1,n.creator=null,n.createdAt=0,n.url=t.channel_url,n.name=null!=(e=t.name)?e:"",n.coverUrl=null!=(e=t.cover_url)?e:"",n.customType=null!=(e=t.custom_type)?e:"",n.data=null!=(e=t.data)?e:"",n.isFrozen=!!l("boolean",t.freeze)&&t.freeze,n.isEphemeral=!!l("boolean",t.is_ephemeral)&&t.is_ephemeral,n.creator=t.created_by?new _(n._iid,t.created_by):null,n.createdAt=1e3*t.created_at,n._cachedMetaData=new Map,t.metadata&&t.ts&&Object.keys(t.metadata).forEach(function(e){n._cachedMetaData.set(e,{value:t.metadata[e],isRemoved:!1,updatedAt:t.ts})}),n}function RS(e,t){var n=oS.call(this,e,t)||this;return n.message=new l0(e,t),n}function DS(e){var t=this,t=uS.call(this)||this,n=[],r=(e.mentionType===um.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),i=e.channelUrl;return t.method=A.POST,t.path="".concat(yg(r),"/").concat(encodeURIComponent(i),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:om.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(e){return r0.payloadify(e)}):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return ME.payloadify(e)}),apple_critical_alert_options:LE.payloadify(e.appleCriticalAlertOptions),push_option:e.pushNotificationDeliveryOption},t}function MS(e,t){var n=cS.call(this,e,t)||this;return n.message=new o0(e,t),n}function xS(e){var t=this,t=lS.call(this)||this,n=[],r=(e.mentionType===um.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map(function(e){return e.userId}))),e.channelType),i=e.channelUrl;return t.method=A.POST,t.path="".concat(yg(r),"/").concat(encodeURIComponent(i),"/scheduled_messages"),t.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:om.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:n,sorted_metaarray:null==(r=e.metaArrays)?void 0:r.map(function(e){return ME.payloadify(e)}),apple_critical_alert_options:LE.payloadify(e.appleCriticalAlertOptions),target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption},t}function PS(e,t){var n=hS.call(this,e,t)||this;return n.message=new o0(e,t),n}function LS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.translationTargetLanguages,i=dS.call(this)||this;return i.method=A.POST,i.path="".concat(yg(t),"/").concat(encodeURIComponent(n),"/messages/").concat(encodeURIComponent(r),"/translation"),i.params={target_langs:e},i}function US(e,t){e=fS.call(this,e,t)||this;return e.reactionEvent=new OE(f({},t)),e}function FS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,i=pS.call(this)||this;return i.method=A.DELETE,i.path="".concat(yg(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),i.params={reaction:e},i}function qS(e,t){e=vS.call(this,e,t)||this;return e.reactionEvent=new OE(t),e}function jS(e){var t=e.channelType,n=e.channelUrl,r=e.messageId,e=e.reactionKey,i=_S.call(this)||this;return i.method=A.POST,i.path="".concat(yg(t),"/").concat(encodeURIComponent(n),"/messages/").concat(r,"/reactions"),i.params={reaction:e},i}function HS(e,t,n){e=yS.call(this,e,"DELM",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.messageId=Number(n.msg_id),e}(r=mS=mS||{})[r.NONE=0]="NONE",r[r.CHANNEL_ENTER=10102]="CHANNEL_ENTER",r[r.CHANNEL_EXIT=10103]="CHANNEL_EXIT",r[r.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",r[r.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",r[r.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",r[r.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",r[r.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",r[r.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",r[r.TYPING_START=10900]="TYPING_START",r[r.TYPING_END=10901]="TYPING_END",r[r.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",r[r.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",r[r.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",r[r.CHANNEL_INVITE=10020]="CHANNEL_INVITE",r[r.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",r[r.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",r[r.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",r[r.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",r[r.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",r[r.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",r[r.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",r[r.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE";Object.defineProperty(lC.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===rm.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(lC.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===rm.OPEN},enumerable:!1,configurable:!0});var GS,VS,BS,KS,QS,zS,WS,YS=lC,XS=(a(cC,WS=My),cC),JS=(a(uC,zS=XS),uC),ZS=(a(oC,QS=My),oC),$S=(a(aC,KS=My),aC),eC=(a(sC,BS=My),sC),tC=(a(iC,VS=My),iC),nC=(a(rC,GS=My),rC);function rC(e,t,n){var r=GS.call(this,e,"MTHD",n)||this;return r.event=new lb(e,n),r}function iC(e,t,n){e=VS.call(this,e,"MRCT",n)||this;return e.channelUrl=n.channel_url,e.channelType=n.channel_type,e.event=new OE(n),e}function sC(e,t,n){var r,i=this,e=((i=BS.call(this,e,"AEDI",n)||this).message=new s0(e,n),y.of(e).sdkState);return i.mentionCountChange=gg({mentionType:null!=(r=null==(r=n.old_values)?void 0:r.mention_type)?r:null,mentionedUserIds:null!=(n=null==(r=n.old_values)?void 0:r.mentioned_user_ids)?n:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!=(r=i.message.mentionedUserIds)?r:null==(n=i.message.mentionedUsers)?void 0:n.map(function(e){return e.userId})},e.userId),i}function aC(e,t,n){var r,i=this,e=((i=KS.call(this,e,"ADMM",n)||this).message=new s0(e,n),y.of(e).sdkState);return i.isMentioned=Cg(i.message.mentionType,null!=(r=i.message.mentionedUserIds)?r:null==(r=i.message.mentionedUsers)?void 0:r.map(function(e){return e.userId}),e.userId),i.forceUpdateLastMessage=null!=(r=n.force_update_last_message)&&r,i}function oC(e,t,n){e=QS.call(this,e,"MCNT",n)||this;return e.groupChannelMemberCounts=n.group_channels.map(function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}}),e.openChannelMemberCounts=n.open_channels.map(function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}}),e}function uC(e,t,n){var r=zS.call(this,e,t,n)||this,e=n.data.operators,t=void 0===e?[]:e;return r.operators=t.map(function(e){return new _(r._iid,e)}),r}function cC(e,t,n){e=WS.call(this,e,"SYEV",n)||this;return e.event=new YS(n),e}function lC(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}a(wC,pC=yo),Object.defineProperty(wC.prototype,"enteredChannels",{get:function(){var t=this;return this._enteredChannelUrls.map(function(e){return t._channels.get(e)}).filter(function(e){return null!==e})},enumerable:!1,configurable:!0}),wC.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},wC.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},wC.prototype.exit=function(e){e=this._enteredChannelUrls.indexOf(e);0<=e&&this._enteredChannelUrls.splice(e,1)},wC.prototype.exitAll=function(){this._enteredChannelUrls=[]},wC.prototype.get=function(t){var n;return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,null!=(n=this._channels.get(t))?n:null]})})},wC.prototype.upsert=function(t){return re(this,void 0,void 0,function(){var n=this;return ie(this,function(e){return t.forEach(function(e){var t;n._channels.has(e.url)?(t=n._channels.get(e.url),Object.assign(t,e)):n._channels.set(e.url,e)}),[2]})})},wC.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._channels.delete(t),this.exit(t),[2]})})},wC.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]})})};var hC,dC,fC,pC,vC,_C=wC,yC={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},mC=(a(TC,fC=u),TC),gC=(a(IC,dC=v),IC),EC=(a(bC,hC=u),bC);function bC(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,i=e.name,s=e.data,a=e.customType,e=e.operatorUserIds;return(t=hC.call(this)||this).method=A.POST,t.path=Km,t.params=k({channel_url:n,cover_url:l("string",r)?r:null,cover_file:V_(r)?r:null,name:i,data:s,custom_type:a,operators:e}),t}function IC(e,t){var n=dC.call(this,e,t)||this;return n.channel=null,n.channel=new fk(e,t),n}function TC(e){var t=e.channelUrl,e=e.isInternalCall,n=fC.call(this)||this;return n.method=A.GET,n.path="".concat(e?Qm:Km,"/").concat(encodeURIComponent(t)),n}function wC(){var e=null!==pC&&pC.apply(this,arguments)||this;return e._channels=new Map,e._enteredChannelUrls=[],e}a(function(e,t){var n=vC.call(this,e,t)||this;return n.channel=new fk(e,t),n},vC=v);a(sk,xC=xy);var SC,CC,kC,AC,NC,OC,RC,DC,MC,xC,PC,LC=sk,UC=(a(ik,MC=My),ik),FC=(a(rk,DC=xy),rk),qC=(a(nk,RC=My),nk),jC={},HC=(tk.of=function(e){return jC[e]},tk.prototype.buildOpenChannelFromSerializedData=function(e){e=Gg(e);return new fk(e._iid,fk.payloadify(e))},tk.prototype.getChannelFromCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.get(t)];case 1:return[2,e.sent()]}})})},tk.prototype.upsertChannelsToCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._openChannelCache.upsert(t)];case 1:return e.sent(),[2]}})})},tk.prototype.removeChannelsFromCache=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,7]),t=se(a),n=t.next(),e.label=1;case 1:return n.done?[3,4]:(r=n.value,[4,this._openChannelCache.remove(r)]);case 2:e.sent(),e.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=e.sent(),i={error:r},[3,7];case 6:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}})})},tk.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},tk.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},tk.prototype._handleEvent=function(ne){return re(this,void 0,void 0,function(){var a,U,o,t,u,c,F,l,n,r,q,j,s,H,G,h,i,d,f,p,v,_,y,V,B,m,g,E,K,Q,b,I,T,w,S,C,k,z,A,W,N,Y,O,R,D,M,x,P,X,J,Z,$,ee,te,L=this;return ie(this,function(e){switch(e.label){case 0:switch(e.trys.push([0,51,,52]),ne.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"SYEV":return[3,27]}return[3,50];case 1:return t=null,"MESG"===ne.code?t=ne.as(Vw):"FILE"===ne.code?t=ne.as(f0):"ADMM"!==ne.code&&"BRDM"!=ne.code||(t=ne.as($S)),t?(a=t.message,U=t.isMentioned,a.channelType!==rm.OPEN?[3,3]:[4,this.getChannel(a.channelUrl,!0)]):[3,3];case 2:o=e.sent(),ae(function(){return re(L,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(o.url)&&r.onMessageReceived(o,a),U&&r.onMentionReceived(o,a)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=3;case 3:return[3,50];case 4:return t=null,"MEDI"===ne.code?t=ne.as(Kw):"FEDI"===ne.code?t=ne.as(zw):"AEDI"===ne.code&&(t=ne.as(eC)),!t||(u=t.message).channelType!==rm.OPEN?[3,6]:[4,this.getChannel(u.channelUrl,!0)];case 5:c=e.sent(),ae(function(){return re(L,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(c.url)&&r.onMessageUpdated(c,u)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=6;case 6:return[3,50];case 7:return n=ne.as(gS),f=n.channelUrl,r=n.channelType,F=n.messageId,r!==rm.OPEN?[3,9]:[4,this.getChannel(f,!0)];case 8:l=e.sent(),ae(function(){return re(L,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())r=n.value,this._openChannelCache.isEnteredChannel(l.url)&&r.onMessageDeleted(l,F)}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]})})}),e.label=9;case 9:return[3,50];case 10:return n=ne.as(tC),f=n.channelUrl,r=n.channelType,q=n.event,r!==rm.OPEN?[3,12]:[4,this.getChannel(f,!0)];case 11:j=e.sent(),ae(function(){return re(L,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onReactionUpdated(j,q)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=12;case 12:return[3,50];case 13:return(s=ne.as(nC).event).channelType!==rm.OPEN?[3,15]:[4,this.getChannel(s.channelUrl,!0)];case 14:H=e.sent(),ae(function(){return re(L,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onThreadInfoUpdated(H,s)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=15;case 15:return[3,50];case 16:G=ne.as(ZS).openChannelMemberCounts,h=[],e.label=17;case 17:e.trys.push([17,22,23,24]),i=se(G),d=i.next(),e.label=18;case 18:return d.done?[3,21]:(p=d.value,f=p.channelUrl,E=p.participantCount,p=p.updatedAt,[4,this.getChannelFromCache(f)]);case 19:(v=e.sent())&&v._updateParticipantCount(E,p)&&h.push(v),e.label=20;case 20:return d=i.next(),[3,18];case 21:return[3,24];case 22:return v=e.sent(),ee={error:v},[3,24];case 23:try{d&&!d.done&&(te=i.return)&&te.call(i)}finally{if(ee)throw ee.error}return[7];case 24:return 0<h.length?[4,this.upsertChannelsToCache(h)]:[3,26];case 25:e.sent(),ae(function(){return re(L,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){try{for(t=se(this._openChannelHandlers.values()),n=t.next();!n.done;n=t.next())n.value.onChannelMemberCountChanged(h)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}}return[2]})})}),e.label=26;case 26:return[3,50];case 27:if((_=ne.as(XS).event).isOpenChannelEvent)switch(_.category){case mS.CHANNEL_ENTER:return[3,28];case mS.CHANNEL_EXIT:return[3,30];case mS.CHANNEL_OPERATOR_UPDATE:return[3,32];case mS.USER_CHANNEL_MUTE:case mS.USER_CHANNEL_UNMUTE:return[3,34];case mS.USER_CHANNEL_BAN:case mS.USER_CHANNEL_UNBAN:return[3,36];case mS.CHANNEL_FREEZE:case mS.CHANNEL_UNFREEZE:return[3,38];case mS.CHANNEL_DELETED:return[3,40];case mS.CHANNEL_PROP_CHANGED:return[3,43];case mS.CHANNEL_META_DATA_CHANGED:return[3,45];case mS.CHANNEL_META_COUNTERS_CHANGED:return[3,47]}return[3,49];case 28:return[4,this.getChannel(_.channelUrl,!0)];case 29:return y=e.sent(),g=ne.as(UC),E=g.participantCount,V=g.user,B=y._updateParticipantCount(E,_.ts),ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserEntered(y,V),B&&e.onChannelParticipantCountChanged(y)}),[2]})})}),[3,49];case 30:return[4,this.getChannel(_.channelUrl,!0)];case 31:return m=e.sent(),g=ne.as(qC),E=g.participantCount,K=g.user,Q=m._updateParticipantCount(E,_.ts),ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onUserExited(m,K),Q&&e.onChannelParticipantCountChanged(m)}),[2]})})}),[3,49];case 32:return[4,this.getChannel(_.channelUrl,!0)];case 33:return b=e.sent(),I=ne.as(JS).operators,b.operators=I,this.upsertChannelsToCache([b]),ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onOperatorUpdated(b,I)}),[2]})})}),[3,49];case 34:return[4,this.getChannel(_.channelUrl,!0)];case 35:return T=e.sent(),w=_.category===mS.USER_CHANNEL_MUTE,S=ne.as(w?tw:uw).user,ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){w?e.onUserMuted(T,S):e.onUserUnmuted(T,S)}),[2]})})}),[3,49];case 36:return[4,this.getChannel(_.channelUrl,!0)];case 37:return C=e.sent(),k=_.category===mS.USER_CHANNEL_BAN,z=ne.as(k?vw:Iw).user,ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){k?e.onUserBanned(C,z):e.onUserUnbanned(C,z)}),[2]})})}),[3,49];case 38:return[4,this.getChannel(_.channelUrl,!0)];case 39:return A=e.sent(),W=ne.as(Fw).freeze,A.isFrozen=W,this.upsertChannelsToCache([A]),ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){W?e.onChannelFrozen(A):e.onChannelUnfrozen(A)}),[2]})})}),[3,49];case 40:return[4,this.getChannel(_.channelUrl,!0)];case 41:return N=e.sent(),[4,this.removeChannelsFromCache([N.url])];case 42:return e.sent(),ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelDeleted(N.url,N.channelType)}),[2]})})}),[3,49];case 43:return[4,this.getChannelWithoutCache(_.channelUrl,!0)];case 44:return Y=e.sent(),ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){e.onChannelChanged(Y)}),[2]})})}),[3,49];case 45:return[4,this.getChannel(_.channelUrl,!0)];case 46:return O=e.sent(),P=ne.as(dT),R=P.created,D=P.updated,M=P.deleted,R&&O._upsertCachedMetaData(R,_.ts),D&&O._upsertCachedMetaData(D,_.ts),M&&O._removeFromCachedMetaData(M,_.ts),ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){R&&e.onMetaDataCreated(O,R),D&&e.onMetaDataUpdated(O,D),M&&e.onMetaDataDeleted(O,M)}),[2]})})}),[3,49];case 47:return[4,this.getChannel(_.channelUrl,!0)];case 48:return x=e.sent(),P=ne.as(TT),X=P.created,J=P.updated,Z=P.deleted,ae(function(){return re(L,void 0,void 0,function(){return ie(this,function(e){return this._openChannelHandlers.forEach(function(e){X&&e.onMetaCounterCreated(x,X),J&&e.onMetaCounterUpdated(x,J),Z&&e.onMetaCounterDeleted(x,Z)}),[2]})})}),[3,49];case 49:return[3,50];case 50:return[3,52];case 51:if($=e.sent(),j_($))throw $;return[3,52];case 52:return[2]}})})},tk.prototype.addHandler=function(e,t){this._openChannelHandlers.set(e,t)},tk.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},tk.prototype.clearHandler=function(){this._openChannelHandlers.clear()},tk.prototype.getChannel=function(n,e){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:h(l("string",n)).throw(p.invalidParameters),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.getChannelFromCache(n)];case 2:return(t=e.sent())?[2,t]:[3,4];case 3:return e.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(n)];case 5:return[2,e.sent()]}})})},tk.prototype.getChannelWithoutCache=function(r,i){return void 0===i&&(i=!1),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)).throw(p.invalidParameters),t=new mC({channelUrl:r,isInternalCall:i}),[4,this._requestQueue.send(t)];case 1:return t=e.sent(),n=t.as(gC).channel,[4,this.upsertChannelsToCache([n])];case 2:return e.sent(),[2,n]}})})},tk.prototype.createChannel=function(i){return re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){switch(e.label){case 0:return i=f(f({},yC),i),h(J_("string",(t=i).operatorUserIds,!0)&&(l("string",t.coverUrlOrImage)||V_(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&l("string",t.name,!0)&&l("string",t.data,!0)&&l("string",t.customType,!0)&&(l("string",t.channelUrl)&&/^\w+$/.test(t.channelUrl)||null===t.channelUrl)).throw(p.invalidParameters),n=new EC(i),[4,this._requestQueue.send(n)];case 1:return n=e.sent(),r=n.as(gC).channel,this.upsertChannelsToCache([r]),[2,r]}var t})})},tk),GC={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},VC=(a(ek,OC=u),ek),BC=(a($C,NC=v),$C),KC=(a(ZC,AC=W),ZC.prototype._validate=function(){return AC.prototype._validate.call(this)},ZC.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=y.of(this._iid).requestQueue,n=new VC(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(BC),r=n.participants,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},ZC),QC=(a(JC,kC=u),JC),zC=(a(XC,CC=v),XC),WC=(a(YC,SC=u),YC);function YC(e){var t=this,e=e.channelUrl;return(t=SC.call(this)||this).method=A.DELETE,t.path="".concat(Km,"/").concat(encodeURIComponent(e)),t}function XC(e,t){var n=CC.call(this,e,t)||this;return n.channel=new fk(e,t),n}function JC(e){var t=this,n=e.channelUrl,r=e.coverUrlOrImage,i=e.name,s=e.data,a=e.customType,e=e.operatorUserIds;return(t=kC.call(this)||this).method=A.PUT,t.path="".concat(Km,"/").concat(encodeURIComponent(n)),t.params=k({cover_url:l("string",r)?r:null,cover_file:V_(r)?r:null,name:i,data:s,custom_type:a,operators:e}),t}function ZC(e,t,n){return AC.call(this,e,t,rm.OPEN,n)||this}function $C(t,e){var n=NC.call(this,t,e)||this,r=(n.token=null,n.participants=[],e.next),e=e.participants;return n.token=r,n.participants=e.map(function(e){return new _(t,e)}),n}function ek(e){var t=this,n=e.channelUrl,r=e.token,e=e.limit;return(t=OC.call(this)||this).method=A.GET,t.path="".concat(Km,"/").concat(encodeURIComponent(n),"/participants"),t.params={token:r,limit:e},t}function tk(e,t){var n=t.sdkState,r=t.dispatcher,t=t.requestQueue,a=this;this._sdkState=n,this._requestQueue=t,this._dispatcher=r,this._openChannelCache=new _C(e),this._openChannelHandlers=new Map,this._dispatcher.on(function(e){var t,n;if(e instanceof My)a._handleEvent(e);else if(e instanceof Cm&&e.stateType===By.CONNECTED){var r=a._openChannelCache.enteredChannels;try{for(var i=se(r),s=i.next();!s.done;s=i.next())s.value.enter()}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}),jC[e]=this}function nk(e,t,n){var r,i=this,i=RC.call(this,e,"EXIT",n)||this;return n.data&&(i.participantCount=null!=(r=n.data.participant_count)?r:0,i.user=new _(e,n.data),i.ts=null!=(r=n.data.edge_ts)?r:0),i}function rk(e){e=e.channelUrl;return DC.call(this,{code:"EXIT",payload:{channel_url:e},ackRequired:!0})||this}function ik(e,t,n){var r,i=this,i=MC.call(this,e,"ENTR",n)||this;return n.data&&(i.participantCount=null!=(r=n.data.participant_count)?r:0,i.user=new _(e,n.data),i.ts=null!=(r=n.data.edge_ts)?r:0),i}function sk(e){e=e.channelUrl;return xC.call(this,{code:"ENTR",payload:{channel_url:e},ackRequired:!0})||this}a(function(e,t){return PC.call(this,e,t)||this},PC=v);a(Sk,dk=OS),Sk.payloadify=function(e){return e?k(f(f({},OS.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map(function(e){return _.payloadify(e)})})):null},Sk.prototype.serialize=function(){return Hg(this)},Sk.prototype.isOperator=function(t){return t instanceof _?this.isOperator(t.userId):this.operators.some(function(e){return e.userId===t})},Sk.prototype._updateParticipantCount=function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)},Sk.prototype.createParticipantListQuery=function(e){return new KC(this._iid,this.url,e)},Sk.prototype.refresh=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,HC.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}})})},Sk.prototype.enter=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new LC({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(UC),r=n.participantCount,i=n.ts,this._updateParticipantCount(r,i),HC.of(this._iid).setEnteredToCache(this),[2]}})})},Sk.prototype.exit=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new FC({channelUrl:this.url}),[4,t.send(n)];case 1:return t=e.sent(),n=t.as(qC),r=n.participantCount,i=n.ts,this._updateParticipantCount(r,i),HC.of(this._iid).setExitedToCache(this),ub.of(this._iid).fileMessageQueue.cancel(this),[2]}})})},Sk.prototype.updateChannel=function(s){return re(this,void 0,void 0,function(){var n,r,i;return ie(this,function(e){switch(e.label){case 0:return s=f(f({},GC),s),h(J_("string",(t=s).operatorUserIds,!0)&&(l("string",t.coverUrlOrImage)||V_(t.coverUrlOrImage)||null===t.coverUrlOrImage)&&l("string",t.name,!0)&&l("string",t.data,!0)&&l("string",t.customType,!0)).throw(p.invalidParameters),r=y.of(this._iid).requestQueue,n=new QC(f({channelUrl:this.url},s)),[4,r.send(n)];case 1:return r=e.sent(),i=r.as(zC).channel,[4,HC.of(this._iid).upsertChannelsToCache([i])];case 2:return e.sent(),[2,i]}var t})})},Sk.prototype.updateChannelWithOperatorUserIds=function(n,r,i,s,a){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return t=f(f({},GC),{name:n,coverUrlOrImage:r,data:i,operatorUserIds:s,customType:a}),[2,this.updateChannel(t)]})})},Sk.prototype.delete=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new WC({channelUrl:this.url}),[4,t.send(n)];case 1:return e.sent(),[4,HC.of(this._iid).removeChannelsFromCache([this.url])];case 2:return e.sent(),[2]}})})};var ak,ok,uk,ck,lk,hk,dk,fk=Sk,pk=(a(wk,hk=function(){this.onUserMuted=Cy,this.onUserUnmuted=Cy,this.onUserBanned=Cy,this.onUserUnbanned=Cy,this.onChannelChanged=Cy,this.onChannelDeleted=Cy,this.onChannelFrozen=Cy,this.onChannelUnfrozen=Cy,this.onOperatorUpdated=Cy,this.onChannelMemberCountChanged=Cy,this.onMetaDataCreated=Cy,this.onMetaDataUpdated=Cy,this.onMetaDataDeleted=Cy,this.onMetaCounterCreated=Cy,this.onMetaCounterUpdated=Cy,this.onMetaCounterDeleted=Cy,this.onMessageReceived=Cy,this.onMessageUpdated=Cy,this.onMessageDeleted=Cy,this.onMentionReceived=Cy,this.onReactionUpdated=Cy,this.onThreadInfoUpdated=Cy}),a(Tk,lk=wk),Tk),vk=(a(Ik,ck=u),Ik),_k=(a(bk,uk=v),bk),yk=(a(Ek,ok=Y),Ek.prototype._validate=function(){return ok.prototype._validate.call(this)&&l("boolean",this.includeFrozen)&&l("boolean",this.includeMetaData)&&l("string",this.nameKeyword,!0)&&l("string",this.urlKeyword,!0)&&J_("string",this.customTypes,!0)},Ek.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,t=y.of(this._iid).requestQueue,n=new vk(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,3]:[3,6];case 1:return t=e.sent(),n=t.as(_k),r=n.channels,i=n.token,this._token=i,this._hasNext=!!i,[4,HC.of(this._iid).upsertChannelsToCache(r)];case 2:return e.sent(),this._isLoading=!1,[2,r];case 3:return[2,[]];case 4:throw p.queryInProgress;case 5:return[3,7];case 6:throw p.invalidParameters;case 7:return[2]}})})},Ek),mk=(a(gk,ak=We),gk.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.onlineDetector,t=t.cacheContext;ak.prototype.init.call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:a,onlineDetector:o,cacheContext:t}),this._manager=new HC(e,{sdkState:n,dispatcher:r,requestQueue:s})},gk.prototype.createOpenChannelListQuery=function(e){return new yk(this._iid,e=void 0===e?{}:e)},gk.prototype.addOpenChannelHandler=function(e,t){this._manager.addHandler(e,t)},gk.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},gk.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},gk.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},gk.prototype.getChannel=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.getChannel(t)]})})},gk.prototype.getChannelWithoutCache=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.getChannelWithoutCache(t)]})})},gk.prototype.createChannel=function(t){return void 0===t&&(t={}),re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this._manager.createChannel(t)]})})},gk.prototype.createChannelWithOperatorUserIds=function(n,r,i,s,a){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){return(t=f({},yC)).name=n,t.coverUrlOrImage=r,t.data=i,t.operatorUserIds=s,t.customType=a,[2,this._manager.createChannel(t)]})})},gk);function gk(){var e=null!==ak&&ak.apply(this,arguments)||this;return e.name="openChannel",e}function Ek(e,t){var n=this;return(n=ok.call(this,e,t)||this).includeFrozen=!0,n.includeMetaData=!0,n.nameKeyword=null,n.urlKeyword=null,n.customTypes=null,n.includeFrozen=null==(e=t.includeFrozen)||e,n.includeMetaData=null==(e=t.includeMetaData)||e,n.nameKeyword=null!=(e=t.nameKeyword)?e:null,n.urlKeyword=null!=(e=t.urlKeyword)?e:null,n.customTypes=null!=(e=t.customTypes)?e:null,n}function bk(t,e){var n=uk.call(this,t,e)||this,r=(n.token=null,n.channels=[],n.ts=null,e.next),i=e.channels,e=e.ts;return n.token=r,i&&0<i.length&&(n.channels=i.map(function(e){return new fk(t,e)})),n.ts="number"==typeof e?e:null,n}function Ik(e){var t=this,n=e.token,r=e.limit,i=e.nameKeyword,s=e.urlKeyword,a=e.customTypes,o=e.includeFrozen,e=e.includeMetaData;return(t=ck.call(this)||this).method=A.GET,t.path=Km,t.params=k({token:n,limit:r,name_contains:i,url_contains:s,custom_types:a,show_frozen:o,show_metadata:e}),t}function Tk(t){void 0===t&&(t={});var n=lk.call(this)||this;return Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&(n[e]=t[e])}),n}function wk(){var e=null!==hk&&hk.apply(this,arguments)||this;return e.onUserEntered=Cy,e.onUserExited=Cy,e.onChannelParticipantCountChanged=Cy,e}function Sk(t,e){var n,r=this;return(r=dk.call(this,t,e)||this)._lastParticipantCountUpdated=0,r.participantCount=0,r.operators=[],r.channelType=rm.OPEN,r.participantCount=null!=(n=e.participant_count)?n:0,r.operators=Array.isArray(e.operators)?e.operators.map(function(e){return new _(t,e)}):[],r}function Ck(c){return function(e,t,n,r){Nk(t);var i=Ok(e),s=Rk(i),a=Dk(i),o=c?a-1:0,u=c?-1:1;if(n<2)for(;;){if(o in s){r=s[o],o+=u;break}if(o+=u,c?o<0:a<=o)throw Mk("Reduce of empty array with no initial value")}for(;c?0<=o:o<a;o+=u)o in s&&(r=t(r,s[o],o,i));return r}}var kk="LIVE_EVENT_MANAGER",Ak=function(){function t(e){var n=this;E(this,t),this._liveEvents=[],this._ctx=e,this._ctx.sb.openChannel.addOpenChannelHandler(kk,new pk({onUserBanned:function(t,e){e.userId===n._ctx.sb.currentUser.userId&&(e=n._liveEvents.find(function(e){return(null==(e=e.openChannel)?void 0:e.url)===t.url}))&&e.onDisconnected()}}))}var n,r,i;return b(t,[{key:"createLiveEvent",value:(i=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Df.createLiveEvent(pc.SINGLE_HOST,t.userIdsForHost?[].concat(V(t.userIdsForHost),[this.userId]):[this.userId],t.title,t.coverUrl,t.coverFile,t.customItems),e.next=3,this._ctx.commandRouter.send(n);case 3:return n=e.sent,r=n.payload.liveEvent,r=new x_({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:r}),e.prev=6,e.next=9,r.fetchOpenChannel();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),C.error("failed to fetch initial open channel");case 14:return this._liveEvents.push(r),e.abrupt("return",r);case 16:case"end":return e.stop()}},e,this,[[6,11]])})),function(e){return i.apply(this,arguments)})},{key:"getLiveEvent",value:(r=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Df.createGetLiveEvent(t),e.next=3,this._ctx.commandRouter.send(n);case 3:return n=e.sent,r=n.payload.liveEvent,e.abrupt("return",this.deserializeLiveEvent(r));case 6:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"deserializeLiveEvent",value:(n=g(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1<(n=this._liveEvents.findIndex(function(e){return e.liveEventId===t.liveEventId})))return(r=this._liveEvents[n]).upsert(t),e.prev=4,e.next=7,r.fetchOpenChannel();e.next=15;break;case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),C.error("failed to fetch initial open channel");case 12:return e.abrupt("return",r);case 15:return i=new x_({deviceManager:this._ctx.deviceManager,sender:this._ctx.commandRouter,sb:this._ctx.sb,userId:this.userId,info:t}),e.prev=16,e.next=19,i.fetchOpenChannel();case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(16),C.error("failed to fetch initial open channel");case 24:return this._liveEvents.push(i),e.abrupt("return",i);case 26:case"end":return e.stop()}},e,this,[[4,9],[16,21]])})),function(e){return n.apply(this,arguments)})},{key:"clear",value:function(){this._liveEvents=[],this._ctx.sb.openChannel.removeOpenChannelHandler(kk);var e,t=Q(this._liveEvents);try{for(t.s();!(e=t.n()).done;)e.value.teardown()}catch(e){t.e(e)}finally{t.f()}}}]),t}(),Nk=Te,Ok=pe,Rk=Pe,Dk=Oe,Mk=TypeError,dt=Vn,xk={left:Ck(!1),right:Ck(!0)}.left,fr=ut,t=Ui,i=(dt({target:"Array",proto:!0,forced:!_l("reduce")||!t&&79<fr&&fr<83},{reduce:function(e){var t=arguments.length;return xk(this,e,t,1<t?arguments[1]:void 0)}}),function(){function n(e,t){E(this,n),this.key=e,this.value=t}return b(n,[{key:"toString",value:function(){return this.key}},{key:"equals",value:function(e){return this.value.width===e.value.width&&this.value.height===e.value.height}}]),n}()),Pk=(I(i,"_720P",new i("_720P",{width:1280,height:720})),I(i,"_540P",new i("_540P",{width:960,height:540})),I(i,"_480P",new i("_480P",{width:848,height:480})),I(i,"_360P",new i("_360P",{width:640,height:360})),i._720P),Lk=function(){T(i,Zf);var r=S(i);function i(e,t){var n;return E(this,i),I(w(n=r.call(this)),"hasPermission",!1),n._streamManger=e,n.constraints=t,n}return b(i,[{key:"stream",get:function(){return this._streamManger.stream}},{key:"dispose",value:function(){var e;this.removeAllEventListeners(),null!=(e=this.onDisposed)&&e.call(this)}},{key:"streamChanged",value:function(e){this._dispatchEvent("streamChanged",e)}},{key:"audioOutputChanged",value:function(){this._dispatchEvent("audioOutputChanged")}}]),i}(),Uk=Nt,Fk=Ee,qk=Ne,jk=Pu,Hk=le,Gk=we,Vk=qf,Bk=jf;Ff("match",function(r,o,u){return[function(e){var t=Hk(this),n=null==e?void 0:Gk(e,r);return n?Uk(n,e,t):new RegExp(e)[r](jk(t))},function(e){var t=Fk(this),n=jk(e),e=u(o,t,n);if(e.done)return e.value;if(!t.global)return Bk(t,n);for(var r=t.unicode,i=[],s=t.lastIndex=0;null!==(a=Bk(t,n));){var a=jk(a[0]);""===(i[s]=a)&&(t.lastIndex=Vk(n,qk(t.lastIndex),r)),s++}return 0===s?null:i}]});function Kk(e,t){var n,r,i,s,a;t.audio&&0===e.getAudioTracks().length&&e.addTrack((i=Qk=Qk||new(window.AudioContext||window.webkitAudioContext),zk=i.createOscillator(),n=i.createMediaStreamDestination(),(r=i.createGain()).gain.setValueAtTime(0,i.currentTime),zk.connect(r),r.connect(n),zk.start(),Xk=n.stream.getAudioTracks()[0],n.stream.getAudioTracks()[0])),t.video&&0===e.getVideoTracks().length&&e.addTrack((i=x(x({},Pk.value),{},{frameRate:24}),s=i.width,a=i.height,i=i.frameRate,(Wk=Wk||document.createElement("canvas")).width=s,Wk.height=a,Wk.getContext("2d").fillRect(0,0,s,a),Yk=Yk||setInterval(function(){Wk.getContext("2d").fillRect(0,0,s,a)},1e3),i=Wk.captureStream(i),Jk=i.getVideoTracks()[0],i.getVideoTracks()[0]))}var Qk,zk,Wk,Yk,Xk,Jk,ga=ue,Ni=xe,Zk=Pu,$k=go.trim,yr=Ar,eA=Me.parseInt,Qa=Me.Symbol,tA=Qa&&Qa.iterator,nA=/^[+-]?0x/i,rA=Ni(nA.exec),ca=8!==eA(yr+"08")||22!==eA(yr+"0x16")||tA&&!ga(function(){eA(Object(tA))})?function(e,t){e=$k(Zk(e));return eA(e,t>>>0||(rA(nA,e)?16:10))}:eA;Vn({global:!0,forced:parseInt!=ca},{parseInt:ca});function iA(){Xk&&Xk.stop(),Jk&&Jk.stop(),Jk=Xk=null,Yk&&(clearInterval(Yk),Yk=null),zk&&(zk.onended=function(){zk.disconnect(),zk=null},zk.stop())}function sA(e){if(e){var t,n=Q(e.getTracks());try{for(n.s();!(t=n.n()).done;)t.value.stop()}catch(e){n.e(e)}finally{n.f()}}}function aA(e,t,n){return(e=e.match(t))&&e.length>=n&&parseInt(e[n],10)}var oA="safari"===function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;var t=window.navigator;if(t.mozGetUserMedia)e.browser="firefox",e.version=aA(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)e.browser="chrome",e.version=aA(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=aA(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=aA(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return e}().browser,uA=function(){function t(e){E(this,t),I(this,"_hasPermission",!1),this._deviceManager=e,this._updateQueued=!1}var e;return b(t,[{key:"updateStream",value:(e=g(regeneratorRuntime.mark(function e(){var t,n,r,i,s,a,o,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._updateAt)return this._updateQueued=!0,e.abrupt("return");e.next=3;break;case 3:if(t=this._deviceManager.mediaAccesses.some(function(e){return e.constraints.audio}),n=this._deviceManager.mediaAccesses.some(function(e){return e.constraints.video}),t||n){e.next=9;break}return sA(this.stream),iA(),e.abrupt("return");case 9:return this._updateAt=Date.now(),(r=this.stream)||(s=new MediaStream,Kk(s,{audio:t,video:n}),this.stream=s),oA&&sA(r),e.prev=13,e.next=16,this._deviceManager.getMediaConstraints({usingAudio:t,usingVideo:n});case 16:return s=e.sent,e.next=19,navigator.mediaDevices.getUserMedia(s);case 19:i=e.sent,this._hasPermission=!0,a=Q(this._deviceManager.mediaAccesses);try{for(a.s();!(o=a.n()).done;)o.value.hasPermission=!0}catch(e){a.e(e)}finally{a.f()}iA(),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),i=new MediaStream;case 29:Kk(i,{audio:t,video:n}),oA||sA(r),this.stream=i,u=Q(this._deviceManager.mediaAccesses);try{for(u.s();!(c=u.n()).done;)c.value.streamChanged(this.stream)}catch(e){u.e(e)}finally{u.f()}delete this._updateAt,this._updateQueued?(this._updateQueued=!1,this.updateStream()):this._deviceManager.refreshMediaDevices({audio:t,video:n},!0);case 36:case"end":return e.stop()}},e,this,[[13,26]])})),function(){return e.apply(this,arguments)})}]),t}();function cA(e,t){return(null==e?void 0:e.deviceId)===(null==t?void 0:t.deviceId)&&(null==e?void 0:e.label)===(null==t?void 0:t.label)&&(null==e?void 0:e.groupId)===(null==t?void 0:t.groupId)}function lA(i){return function(e,t,n){var e=CA(kA(e)),t=SA(t),r=e.length,n=void 0===n?" ":CA(n);return t<=r||""==n?e:((r=AA(n,OA((t=t-r)/n.length))).length>t&&(r=NA(r,0,t)),i?e+r:r+e)}}var hA,dA,fA,pA,vA=function(){function t(){var e=this;E(this,t),this.mediaAccesses=[],this._availableMediaDevices={audioinput:[],audiooutput:[],videoinput:[]},this._currentMediaDevices={audioinput:void 0,audiooutput:void 0,videoinput:void 0},this._sendbirdCallListeners=new Map,this._streamManager=new uA(this),navigator.mediaDevices.ondevicechange=function(){return e._onDeviceChanged()}}var n,r,e,i;return b(t,[{key:"_onDeviceChanged",value:function(){0!==this.mediaAccesses.length&&this.refreshMediaDevices({audio:this.mediaAccesses.some(function(e){return e.constraints.audio}),video:this.mediaAccesses.some(function(e){return e.constraints.video})})}},{key:"addSendBirdCallListener",value:function(e,t){this._sendbirdCallListeners.set(e,t)}},{key:"removeSendBirdCallListener",value:function(e){this._sendbirdCallListeners.delete(e)}},{key:"removeAllSendBirdCallListener",value:function(){this._sendbirdCallListeners.clear()}},{key:"getCurrentAudioInputDevice",value:function(){return this._currentMediaDevices.audioinput}},{key:"getCurrentAudioOutputDevice",value:function(){return this._currentMediaDevices.audiooutput}},{key:"getCurrentVideoInputDevice",value:function(){return this._currentMediaDevices.videoinput}},{key:"getAvailableAudioInputDevices",value:function(){return this._availableMediaDevices.audioinput}},{key:"getAvailableAudioOutputDevices",value:function(){return this._availableMediaDevices.audiooutput}},{key:"getAvailableVideoInputDevices",value:function(){return this._availableMediaDevices.videoinput}},{key:"_updateStream",value:(i=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._streamManager.updateStream());case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_registerMediaAccess",value:function(e){var t=this;this.mediaAccesses.push(e),e.onDisposed=function(){return t.stopMedia(e)}}},{key:"useMedia",value:function(e){{if(e.audio||e.video)return e=new Lk(this._streamManager,e),this._registerMediaAccess(e),this._updateStream(),e;C.error(new Error("you should set true for at least 1 media type."))}}},{key:"stopMedia",value:function(e){this.mediaAccesses.splice(this.mediaAccesses.indexOf(e),1),this._updateStream()}},{key:"fetchMediaDevices",value:(e=g(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.reduce(function(e,t){return e[t.kind].push(t),e},{audioinput:[],audiooutput:[],videoinput:[]}));case 4:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"getMediaConstraints",value:(r=g(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.usingAudio,r=t.usingVideo,i={audio:!1,video:!1},e.next=4,this.fetchMediaDevices();case 4:return s=e.sent,a=s.audioinput,s=s.videoinput,n&&a.length&&(a=this.getCurrentAudioInputDevice(),i.audio={deviceId:null==a?void 0:a.deviceId}),r&&s.length&&(a=this.getCurrentVideoInputDevice(),i.video=x(x({deviceId:null==a?void 0:a.deviceId},Pk.value),{},{frameRate:24})),e.abrupt("return",i);case 10:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_updateCurrentMediaDevice",value:function(e,t){var n,r=this._availableMediaDevices[e],i=this._currentMediaDevices[e],s=r.find(function(e){return e.deviceId===(null==t?void 0:t.deviceId)});return s||(C.warning("Selected device is unavailable. fallback to default device."),s=(null!=(n=s)?n:0<r.length)?r[0]:null),!cA(i,this._currentMediaDevices[e]=s)}},{key:"_onAudioOutputChanged",value:function(){var e,t=Q(this.mediaAccesses);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.constraints.audio&&n.audioOutputChanged()}}catch(e){t.e(e)}finally{t.f()}}},{key:"selectDevice",value:function(e,t){t.kind!==e?C.error(new Error("Tried to select invalid device of type")):this._updateCurrentMediaDevice(e,t)&&("audioinput"!==e&&"videoinput"!==e||this._updateStream(),"audiooutput"===e&&this._onAudioOutputChanged())}},{key:"_updateAvailableDevices",value:function(e,t){var n,r,i,s=this._currentMediaDevices[e];if(!!function(e,t){if(e.length===t.length){for(var n=0;n<t.length;n++)if(!cA(e[n],t[n]))return;return 1}}(this._availableMediaDevices[e],t))return!1;this._availableMediaDevices[e]=t,s=this._updateCurrentMediaDevice(e,s);var a,o=Q(this._sendbirdCallListeners.values());try{for(o.s();!(a=o.n()).done;){var u=a.value,c=this._currentMediaDevices[e];switch(e){case"audioinput":null!=(n=u.onAudioInputDeviceChanged)&&n.call(u,c,t);break;case"audiooutput":null!=(r=u.onAudioOutputDeviceChanged)&&r.call(u,c,t);break;case"videoinput":null!=(i=u.onVideoInputDeviceChanged)&&i.call(u,c,t)}}}catch(e){o.e(e)}finally{o.f()}return s}},{key:"refreshMediaDevices",value:(n=g(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,u,c,l=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.audio,r=t.video,i=1<l.length&&void 0!==l[1]&&l[1],n||r){e.next=4;break}throw new Error("at least one of the audio or video must be true");case 4:return e.next=6,this.fetchMediaDevices();case 6:o=e.sent,s=o.audioinput,a=o.audiooutput,o=o.videoinput,c=u=!1,n&&(u=this._updateAvailableDevices("audioinput",s),c=this._updateAvailableDevices("audiooutput",a)),r&&(u=this._updateAvailableDevices("videoinput",o)||u),!i&&u&&this._updateStream(),c&&this._onAudioOutputChanged();case 16:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]),t}(),_A="v1.0.0-beta.6",yA=function(){function t(e){E(this,t),this._parse=e}return b(t,[{key:"parseToJson",value:function(e){try{return JSON.parse(e)}catch(e){return{}}}},{key:"validate",value:function(e){var t=e.cmd,n=e.request_id,e=e.call_type;return!!(n||t||e)}},{key:"parseCommand",value:function(e){return e.error?{isValid:!0,error:{requestId:e.request_id,message:e.message,code:e.code}}:{isValid:!0,command:this._parse(e)}}},{key:"parse",value:function(e){e=this.parseToJson(e);return this.validate(e)?this.parseCommand(e):{isValid:!1}}}]),t}(),mA=function(){T(r,Zf);var n=S(r);function r(e){var t;return E(this,r),(t=n.call(this))._ctx=e,t._ws=null,t._retryTimer=null,t._closed=!0,t._sessionKey=null,t._requestMap=new s_(t._getTimeoutTime()),t._messageParser=new yA(t._ctx.parse),t._hostUrl=null!=(e=t._ctx.websocketHost)?e:"wss://ws-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",t._ctx.appId),t}return b(r,[{key:"connect",value:function(){var r=this;return new Promise(function(e,t){r._sessionKey||t(new Error("tried to connect to websocket server without auth")),r._ws=r._createWebSocket(),r._closed=!1,r._ws.onopen=function(){r._onOpen(),e(null)},r._ws.onmessage=function(e){var e=r._messageParser.parse(e.data),t=e.isValid,n=e.error,e=e.command;t&&(n?r._processError(n):r.processCommand(e))},r._ws.onerror=function(e){return r._onError(e)},r._ws.onclose=function(){r._onClose(),t(new Error("websocket connection failed"))}})}},{key:"_processError",value:function(e){var t=e.requestId,e=(e.code,e.message),t=this._requestMap.unregister(t);t&&t.reject(new Error(e))}},{key:"processCommand",value:function(e){this._dispatchEvent("command",e)}},{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._disconnect(),this._sessionKey=null}},{key:"_disconnect",value:function(){this._ws&&(this._closed=!0,this._removeRetryTimer(),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onerror=null,this._ws.onclose=null,this._ws.close(),this._requestMap.rejectAll(new Error("request failed due to websocket connection lost")),this._ws=null)}},{key:"isConnected",get:function(){return!!this._ws&&1===this._ws.readyState}},{key:"_onOpen",value:function(){}},{key:"_onError",value:function(e){}},{key:"_onClose",value:function(){this._startToReconnect()}},{key:"_createWebSocket",value:function(){var e="/?sbcall_session_token=".concat(encodeURIComponent(this._sessionKey),"&sbcall_client_id=").concat(encodeURIComponent(this._ctx.clientId),"&sendbird=").concat(encodeURIComponent(this._getVersion()));return new WebSocket(this._getHost()+e)}},{key:"_getVersion",value:function(){return"JS,".concat(this._getOsVersion(),",").concat(_A)}},{key:"_getHost",value:function(){return this._hostUrl}},{key:"_startToReconnect",value:function(){this._closed||this._retryTimer||(this._retryTimer=setTimeout(this._reconnect.bind(this),this._getRetryTime()))}},{key:"_reconnect",value:function(){this._removeRetryTimer(),this.connect().catch(function(){})}},{key:"_removeRetryTimer",value:function(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)}},{key:"_getTimeoutTime",value:function(){return 6e4}},{key:"_getRetryTime",value:function(){return 2e3}},{key:"_getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),r}(),gA=function(){function t(e){E(this,t),this._ctx=e,this._fetch=function(){var e;return(e=window).fetch.apply(e,arguments)},this._sessionKey=null,this._hostUrl=null!=(e=this._ctx.apiHost)?e:"https://api-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",this._ctx.appId)}var n;return b(t,[{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._sessionKey=null}},{key:"send",value:(n=g(regeneratorRuntime.mark(function e(t){var n,r,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getApiOption){e.next=2;break}throw new Error("invalid api request ".concat(JSON.stringify(t)));case 2:if((n=t.getApiOption()).auth&&!this._sessionKey)throw new Error("tried to call private api without auth");e.next=5;break;case 5:return i=x({},n.headers),n.body instanceof FormData||(i["Content-Type"]="application/json"),i.SendBird="JS,".concat(this._getOsVersion(),",").concat(_A),i["SBCall-Client-Id"]=this._ctx.clientId,this._sessionKey&&(i["SBCall-Session-Token"]=this._sessionKey),e.next=12,this._fetch("".concat(this._getHost()).concat(n.path),{method:n.method,body:n.body instanceof FormData?n.body:JSON.stringify(n.body),headers:i});case 12:return r=e.sent,e.next=15,r.text();case 15:i=e.sent,s=null,e.prev=17,s=JSON.parse(i),e.next=24;break;case 21:throw e.prev=21,e.t0=e.catch(17),new Error("malformed data");case 24:if(r.ok){e.next=34;break}if(s.error)throw new Error("server error");e.next=29;break;case 29:if(500===r.status)throw new Error("internal server error");e.next=31;break;case 31:if(300<=r.status&&r.status<400)throw new Error("malformed data");e.next=33;break;case 33:throw new Error("request failed");case 34:if(e.prev=34,a=this._ctx.parseResponse(t,s))return e.abrupt("return",a);e.next=38;break;case 38:e.next=43;break;case 40:return e.prev=40,e.t1=e.catch(34),e.abrupt("return",s);case 43:return e.abrupt("return",s);case 44:case"end":return e.stop()}},e,this,[[17,21],[34,40]])})),function(e){return n.apply(this,arguments)})},{key:"_getHost",value:function(){return this._hostUrl}},{key:"_getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),t}(),EA=function(){T(s,Zf);var t,n,r,i=S(s);function s(e){var t;return E(this,s),(t=i.call(this))._ctx=e,t.wsClient=new mA(x(x({},e),{},{parse:function(e){return Df.parse(e)}})),t.apiClient=new gA(x(x({},e),{},{parseResponse:function(e,t){return Df.parseResponse(e,t)}})),t._unsubscriber=t.wsClient.on("command",function(e){t._dispatchEvent("command",e)}),t}return b(s,[{key:"connectWs",value:function(){return this.wsClient.connect()}},{key:"sendAPI",value:function(e){return this.apiClient.send(e)}},{key:"send",value:(r=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sendAPI(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"sendWithRetry",value:(n=g(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o=this,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<u.length&&void 0!==u[1]?u[1]:new r_,s=2<u.length&&void 0!==u[2]?u[2]:{count:0,deferred:new t_},r=s.deferred,i=s.count,e.prev=3,e.next=6,this.send(t);case 6:s=e.sent,r.resolve(s),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),0<(a=n.calcTimeout(i))?setTimeout(function(){o.sendWithRetry(t,n,{count:i+1,deferred:r})},a):r.reject(e.t0);case 14:return e.abrupt("return",r.promise);case 15:case"end":return e.stop()}},e,this,[[3,10]])})),function(e){return n.apply(this,arguments)})},{key:"_setSessionKey",value:function(e){this.apiClient.setSessionKey(e),this.wsClient.setSessionKey(e)}},{key:"authenticate",value:(t=g(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userId,r=t.accessToken,e.prev=1,e.next=4,this._ctx.sb.connect(n,r);case 4:return i=Df.createAuth(this._ctx.appId,n,r),e.next=7,this.send(i);case 7:i=e.sent,this._setSessionKey(i.sbcall_session_token),this._ctx.liveEventManager.userId=i.user.user_id,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(1),C.error("failed to authenticate user ".concat(n)),e.t0;case 16:case"end":return e.stop()}},e,this,[[1,12]])})),function(e){return t.apply(this,arguments)})},{key:"deauthenticate",value:function(){this.apiClient.clearSessionKey(),this.wsClient.clearSessionKey()}}]),s}(),bA=ke,IA=Pu,TA=le,wA=RangeError,Ai=xe,SA=Ne,CA=Pu,kA=le,AA=Ai(function(e){var t=IA(TA(this)),n="",r=bA(e);if(r<0||r==1/0)throw wA("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}),NA=Ai("".slice),OA=Math.ceil,va={start:lA(!1),end:lA(!0)},Sr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(tt),Oi=Vn,RA=va.start,DA=(Oi({target:"String",proto:!0,forced:Sr},{padStart:function(e){return RA(this,e,1<arguments.length?arguments[1]:void 0)}}),{VERBOSE:{level:-1,name:yl.VERBOSE,public:!1},DEBUG:{level:1,name:yl.DEBUG,public:!1},INFO:{level:2,name:yl.INFO,public:!0},WARNING:{level:3,name:yl.WARNING,public:!0},ERROR:{level:4,name:yl.ERROR,public:!0},NONE:{level:100,name:yl.NONE,public:!0}}),MA=function(){function t(e){E(this,t),this.level=e||yl.NONE}return b(t,[{key:"setLoggerLevel",value:function(e){var t;return null!=(t=DA[e])&&t.public&&(this.level=e),this.level}},{key:"_enabledFor",value:function(e){try{return DA[this.level].level<=DA[e].level}catch(e){return!1}}}]),t}(),xA=function(){T(n,MA);var t=S(n);function n(e){return E(this,n),t.call(this,e)}return b(n,[{key:"_getLogType",value:function(e){switch(e){case yl.ERROR:return"error";case yl.WARNING:return"warn";default:return"log"}}},{key:"_getTimeString",value:function(e){var t=e.getFullYear().toString().padStart(2,"0"),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),a=e.getSeconds().toString().padStart(2,"0"),e=e.getMilliseconds().toString().padStart(2,"0");return"[".concat(t,".").concat(n,".").concat(r," ").concat(i,":").concat(s,":").concat(a,":").concat(e,"]")}},{key:"_permit",value:function(e){var t=this._getLogType(e),n=new Date;if(this._enabledFor(e)&&console&&console[t]){for(var n="".concat(this._getTimeString(n)," [").concat(e,"]"),r=arguments.length,i=new Array(1<r?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];(e=console)[t].apply(e,[n].concat(i))}}}]),n}();(mr=hA=hA||{}).SUCCESS="success",mr.PENDING="pending",mr.ERROR="error",(Ba=dA=dA||{}).DEFAULT="default",Ba.ALL="all",Ba.MENTION_ONLY="mention_only",Ba.OFF="off",(ct=fA=fA||{}).FCM="gcm",ct.APNS="apns",ct.UNKNOWN="unknown",(Tn=pA=pA||{}).ALTERNATIVE="alternative",Tn.DEFAULT="default";var PA;(Ye=PA=PA||{}).LATEST_LAST_MESSAGE="latest_last_message",Ye.CHRONOLOGICAL="chronological",Ye.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",Ye.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";function LA(e){switch(e){case PA.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case PA.CHRONOLOGICAL:return["-createdAt","syncIndex"];case PA.CHANNEL_NAME_ALPHABETICAL:return["name"]}}qA.prototype.clone=function(){var t=new qA,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach(function(e){t[e]=n[e]}),t},qA.prototype.match=function(e){switch(this.messageTypeFilter){case am.USER:if(e.messageType!==sm.USER)return!1;break;case am.FILE:if(e.messageType!==sm.FILE)return!1;break;case am.ADMIN:if(e.messageType!==sm.ADMIN)return!1}if(this.customTypesFilter&&0<this.customTypesFilter.length&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&0<this.senderUserIdsFilter.length){if(!(e instanceof n0))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case cm.NONE:if(0<e.parentMessageId)return!1;break;case cm.ONLY_REPLY_TO_CHANNEL:if(e instanceof n0&&0<e.parentMessageId&&!e.replyToChannel)return!1}return!0};var UA,FA=qA;function qA(){this.messageTypeFilter=am.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=cm.NONE}(Ot=UA=UA||{}).CHANNEL_LATEST="channel_latest",Ot.NEWEST_CHILD_MESSAGE="newest_child_message";function jA(e){switch(e){case UA.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case UA.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}}f(f({},Vb),{scheduledAt:null}),f(f({},Di),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1});var HA,GA,VA,BA,KA={},QA=(a(tN,BA=yo),tN.of=function(e){return KA[e]},Object.defineProperty(tN.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(tN.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),tN.prototype._serialize=function(e){if(0<e.messageId)throw p.invalidParameters;var t,n=f({},e.serialize());return e instanceof o0?(e.messageParams&&(n.messageParams=Hb(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,f(f({},Hb(t)),{scheduledAt:t.scheduledAt})))):e instanceof l0&&(e.messageParams&&(n.messageParams=Qb(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,f(f({},Qb(t)),{scheduledAt:t.scheduledAt})))),n},tN.prototype._deserialize=function(e){return e?(e=f(f({},e),{messageId:parseInt(e.messageId)}),ub.of(this._iid).buildMessageFromSerializedData(e)):null},tN.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},tN.prototype.fetch=function(e){var t=e.channelUrl,i=void 0===t?null:t,t=e.filter,s=void 0===t?new FA:t,t=e.order,a=void 0===t?UA.CHANNEL_LATEST:t,t=e.sendingStatus,o=void 0===t?null:t,t=e.backward,u=void 0!==t&&t,t=e.parentMessageId,c=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(n=jA(a),t={"/where":function(e){return!!(a!==UA.NEWEST_CHILD_MESSAGE||c&&0!==e.parentMessageId&&e.parentMessageId===c)&&s.match(r._deserialize(e))}},i&&(t.channelUrl=i),o&&(t.sendingStatus=o),t={where:t,index:n,backward:u},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({})];case 2:return n=e.sent(),[2,Promise.all(n.map(function(o){return re(r,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return t=ub.of(this._iid),n=this._deserialize(o),(r=o.messageParams)?n instanceof o0?(n.messageParams=t.buildUserMessageCreateParamsFromSerializedData(r,n),[3,4]):[3,1]:[3,4];case 1:return n instanceof l0?r.fileKey&&"string"==typeof r.fileKey&&Kb(r.fileType)?(i=r,[4,this.collection.getBlob(r.fileKey)]):[3,3]:[3,4];case 2:i.file=e.sent(),e.label=3;case 3:n.messageParams=t.buildFileMessageCreateParamsFromSerializedData(r,n),e.label=4;case 4:return n.scheduledInfo&&o.scheduledInfo&&o.scheduledInfo.scheduledMessageParams?n instanceof o0?(s=o.scheduledInfo.scheduledMessageParams,n.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(s,n),[3,8]):[3,5]:[3,8];case 5:return n instanceof l0?(s=o.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof s.fileKey&&Kb(s.fileType)?(a=s,[4,this.collection.getBlob(s.fileKey)]):[3,7]:[3,8];case 6:a.file=e.sent(),e.label=7;case 7:n.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(s,n),e.label=8;case 8:return[2,n]}})})}))];case 3:return[2,[]]}})})},tN.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new FA),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.fetch({filter:n,order:UA.NEWEST_CHILD_MESSAGE,channelUrl:t.channelUrl,backward:!1,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},tN.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,3];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},tN.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},tN.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=se(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})},tN.prototype.removeMessagesOfChannel=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t}})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},tN.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},tN.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(i){return re(t,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return i instanceof l0?i.messageParams&&(t=i.messageParams).file&&Bb(t.file)?[4,this.collection.saveBlob(t.file,i.reqId)]:[3,2]:[3,4];case 1:r=e.sent(),t.fileKey=r,t.fileType=Gb.BLOB,e.label=2;case 2:return i.scheduledInfo&&i.scheduledInfo.scheduledMessageParams&&(n=i.scheduledInfo.scheduledMessageParams).file&&Bb(n.file)?[4,this.collection.saveBlob(n.file,i.reqId)]:[3,4];case 3:r=e.sent(),n.fileKey=r,n.fileType=Gb.BLOB,e.label=4;case 4:return[2]}})})}))];case 1:return e.sent(),[2]}})})},tN),zA={},WA=(a(eN,VA=yo),eN.of=function(e){return zA[e]},Object.defineProperty(eN.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(eN.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),eN.prototype._serialize=function(e){return f(f({},e.serialize()),{messageId:"".concat(e.messageId)})},eN.prototype._deserialize=function(e){return e=f(f({},e),{messageId:parseInt(e.messageId)}),ub.of(this._iid).buildMessageFromSerializedData(e)},eN.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(n))]:[3,2];case 1:if(t=e.sent())return[2,this._deserialize(t)];e.label=2;case 2:return[2,null]}})})},eN.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,t=e.limit,s=void 0===t?100:t,t=e.filter,a=void 0===t?new FA:t,t=e.order,o=void 0===t?UA.CHANNEL_LATEST:t,t=e.backward,u=void 0!==t&&t,t=e.parentMessageId,c=void 0===t?null:t;return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=jA(o),t={where:{channelUrl:r,"/where":function(e){if(i)switch(o){case UA.CHANNEL_LATEST:if(!u&&e.createdAt>i||u&&e.createdAt<i)return!1;break;case UA.NEWEST_CHILD_MESSAGE:if(!c||0===e.parentMessageId||e.parentMessageId!==c)return!1}return a.match(n._deserialize(e))}},index:t,backward:u},[4,this.collection.query(t)]):[3,3];case 1:return[4,e.sent().fetch({limit:s})];case 2:return t=e.sent(),[2,Promise.all(t.map(function(i){return re(n,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=this._deserialize(i),(n=i.messageParams)?t instanceof o0?(t.messageParams=n,[3,4]):[3,1]:[3,4];case 1:return t instanceof l0?n.fileKey&&"string"==typeof n.fileKey&&Kb(n.fileType)?(r=n,[4,this.collection.getBlob(n.fileKey)]):[3,3]:[3,4];case 2:r.file=e.sent(),e.label=3;case 3:t.messageParams=n,e.label=4;case 4:return[2,t]}})})}))];case 3:return[2,[]]}})})},eN.prototype.getAllChildMessages=function(t,n){return void 0===n&&(n=new FA),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.fetch({channelUrl:t.channelUrl,token:Date.now(),limit:null,backward:!1,filter:n,order:UA.NEWEST_CHILD_MESSAGE,parentMessageId:t.messageId})];case 1:return[2,e.sent()]}})})},eN.prototype.upsert=function(r){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(r)]:[3,5];case 1:return e.sent(),t=r.map(function(e){return n._serialize(e)}),[4,this.collection.upsertMany(t)];case 2:return e.sent(),[4,this.upsertChildMessages(r)];case 3:return e.sent(),[4,this._unsentMessageCache.upsertChildMessages(r)];case 4:e.sent(),e.label=5;case 5:return[2]}})})},eN.prototype.upsertChildMessages=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=[],0<(null==(n=r.threadInfo)?void 0:n.replyCount)?[4,this.getAllChildMessages(r)]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return 0<t.length?(t.forEach(function(e){return e.applyParentMessage(r)}),[4,this.upsert(t)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},eN.prototype.remove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(!this.localCacheEnabled)return[3,8];e.label=1;case 1:e.trys.push([1,6,7,8]),t=se(a),n=t.next(),e.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:e.sent(),e.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return r=e.sent(),i={error:r},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})},eN.prototype.removeMessagesOfChannel=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:n},index:jA(UA.CHANNEL_LATEST)})]:[3,6];case 1:return e.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync"))];case 2:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/sync.meta"))];case 3:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs"))];case 4:return e.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(n,"/message/changelogs.meta"))];case 5:e.sent(),e.label=6;case 6:return[2]}})})},eN.prototype.removeUnderOffset=function(t,n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:t,createdAt:{"<":n}},index:jA(UA.CHANNEL_LATEST)})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},eN.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},eN.prototype.countBetween=function(r,i,s){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?(t=jA(UA.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:r,"/where":function(e){e=n._deserialize(e);return s.includes(e.createdAt)&&i.match(e)}},index:t}).count()]):[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},eN.prototype.saveBlobs=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(r){return re(t,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return r instanceof l0&&r.messageParams&&(t=r.messageParams).file&&Bb(t.file)?[4,this.collection.saveBlob(t.file,r.reqId)]:[3,2];case 1:n=e.sent(),t.fileKey=n,e.label=2;case 2:return[2]}})})}))];case 1:return e.sent(),[2]}})})},eN),YA=(a($A,GA=Q_),$A),XA={},JA=(ZA.of=function(e){return XA[e]},ZA.prototype.processNonAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=se(t),r=n.next();!r.done;r=n.next())0===(i=r.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=hm.FAILED,i.errorCode=d.ACK_TIMEOUT,this._dispatcher.dispatch(new U0({messages:[i],source:A0.LOCAL_MESSAGE_FAILED})))}catch(e){s={error:e}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}}return[2]}})})},ZA.prototype.processAutoResendRegisteredPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=e.sent();try{for(n=se(t),r=n.next();!r.done;r=n.next())(i=r.value).errorCode&&G_(i.errorCode)&&(s=(new Date).getTime(),a=i.createdAt+2592e5,s<=a?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),i.sendingStatus=hm.FAILED,this._dispatcher.dispatch(new U0({messages:[i],source:A0.LOCAL_MESSAGE_FAILED}))))}catch(e){o={error:e}}finally{try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(o)throw o.error}}return[2]}})})},ZA.prototype.completeCurrentAndProcessNextAutoResend=function(e){this._localCacheEnabled&&(e.sendingStatus===hm.SUCCEEDED||e.sendingStatus===hm.FAILED&&!G_(e.errorCode))&&(0<=(e=this.indexOf(e))&&this._autoResendQueue.splice(e,1),0===e&&this._processNextAutoResend())},ZA.prototype._fetchAllCachedPendingMessages=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return(t=QA.of(this._iid))?[4,t.fetch({sendingStatus:hm.PENDING,backward:!0})]:[3,2];case 1:return n=e.sent(),[3,3];case 2:n=[],e.label=3;case 3:return[2,n]}})})},ZA.prototype.indexOf=function(e){return 0<this._autoResendQueue.length?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId):-1},ZA.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map(function(e){return e.reqId}).indexOf(e.reqId)},ZA.prototype._processNextAutoResend=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{0<this._autoResendQueue.length?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new YA({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}return[2]})})},ZA);function ZA(e,t){var n=t.localCacheEnabled,r=t.dispatcher,i=t.sdkState,t=t.logger,s=this;(XA[e]=this)._iid=e,(XA[e]=this)._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=t,this._sdkState=i,this._localCacheEnabled&&r.on(function(e){if(e instanceof Cm)switch(e.stateType){case By.CONNECTED:s._isProcessingAutoResend||s.processAutoResendRegisteredPendingMessages().then(function(){return s._processNextAutoResend()});break;case By.DISCONNECTED:s._isProcessingAutoResend=!1}})}function $A(e){var e=e.message,t=GA.call(this)||this;return t.message=e,t}function eN(e,t){var n=t.sdkState,r=t.cacheContext,t=t.unsentMessageCache,i=VA.call(this,e)||this;return i._sdkState=n,i._cacheContext=r,i._unsentMessageCache=t,zA[e]=i}function tN(e,t){var n=t.sdkState,t=t.cacheContext,r=BA.call(this,e)||this;return r._sdkState=n,r._cacheContext=t,KA[e]=r}(wr=HA=HA||{})[wr.USER_BLOCK=20001]="USER_BLOCK",wr[wr.USER_UNBLOCK=2e4]="USER_UNBLOCK",wr[wr.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED";bN.getDataAsUserBlockEvent=function(e,t){var t=t.data,n=t.blocker,t=t.blockee;return{blocker:new _(e,n),blockee:new _(e,t)}},bN.getDataAsFriendDiscoveredEvent=function(t,e){e=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(e)?e.map(function(e){return new _(t,e)}):[]}};var nN,rN,iN,sN,aN,oN,uN=bN,cN=(a(EN,oN=Q_),EN),lN=(a(gN,aN=My),gN),hN=(a(mN,sN=u),mN),dN=(a(yN,iN=v),yN),fN=(a(_N,rN=u),_N),pN=(a(vN,nN=v),vN);function vN(e,t){e=nN.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function _N(e){var t=e.userId,e=e.pushTriggerOption,n=rN.call(this)||this;return n.method=A.PUT,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push_preference"),n.params={push_trigger_option:e},n}function yN(e,t){e=iN.call(this,e,t)||this;return e.pushTriggerOption=t.push_trigger_option,e}function mN(e){var e=e.userId,t=sN.call(this)||this;return t.method=A.GET,t.path="".concat(Gm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function gN(e,t,n){e=aN.call(this,e,"USEV",n)||this;return e.event=new uN(n),e}function EN(e,t){var t=t.userId,n=oN.call(this)||this;return n._iid=e,n.userId=t,n}function bN(e){this.category=e.cat,this.data=e.data}var IN,TN,wN,SN,CN,kN,AN={profileImage:null,profileUrl:null,nickname:null},NN=(a(function(){return null!==IN&&IN.apply(this,arguments)||this},IN=yo),a(FN,CN=iy),Object.defineProperty(FN.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),FN.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=null,e.dispatch("pause")},3e4)),this._currentState=document.visibilityState},FN.prototype.start=function(){this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})},FN.prototype.stop=function(){this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})},FN),ON=(Object.defineProperty(UN.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),UN.prototype._onlineWorker=function(){this.connectionDelegate.reconnect()},UN.prototype._offlineWorker=function(){this.connectionDelegate.disconnect()},UN.prototype.start=function(){this.isAvailable&&(window.addEventListener("online",this._onlineWorker),window.addEventListener("offline",this._offlineWorker))},UN.prototype.stop=function(){this.isAvailable&&(window.removeEventListener("online",this._onlineWorker,!1),window.removeEventListener("offline",this._offlineWorker,!1))},UN.prototype.isOnline=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this.isAvailable?[2,navigator.onLine]:[2,new Promise(function(e,t){fetch("https://www.google.com",{method:A.GET}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},UN),RN=(a(LN,SN=u),LN),DN=(a(PN,wN=v),PN),MN=(a(xN,TN=u),xN);function xN(e){var t=e.userId,e=e.token,n=TN.call(this)||this;return n.method=A.POST,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push/apns"),n.params={apns_device_token:e,always_push:!0},n}function PN(e,t){var n=wN.call(this,e,t)||this;return n.user=null,n.user=new _(e,f({},t)),n}function LN(e){var t=e.userId,n=e.nickname,n=void 0===n?null:n,r=e.profileUrl,r=void 0===r?null:r,i=e.profileImage,i=void 0===i?null:i,e=e.preferredLanguages,e=void 0===e?null:e,s=SN.call(this)||this;return s.method=A.PUT,s.path="".concat(Gm,"/").concat(encodeURIComponent(t)),s.params=k({nickname:n,profile_url:r,profile_file:i,preferred_languages:e}),s}function UN(e){var t=e.logger,e=e.connectionDelegate,e=void 0===e?null:e;this.logger=t,e&&(this.connectionDelegate=e),this._onlineWorker=this._onlineWorker.bind(this),this._offlineWorker=this._offlineWorker.bind(this)}function FN(){var e=CN.call(this)||this;return e._pauseDelayTimer=null,e._currentState="visible",e._toggleState=e._toggleState.bind(e),e}a(function(e,t){var n=kN.call(this,e,t)||this;return n.token=t.token,n.type=t.type?fA[t.type.toLowerCase()]:fA.UNKNOWN,n.user=new _(e,t.user),n},kN=v);a(GN,qN=u);var qN,jN,HN=GN;function GN(e){var t=e.userId,e=e.token,n=qN.call(this)||this;return n.method=A.POST,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push/gcm"),n.params={gcm_reg_token:e,always_push:!0},n}a(function(e,t){var n=jN.call(this,e,t)||this;return n.token=t.token,n.type=t.type?fA[t.type.toLowerCase()]:fA.UNKNOWN,n.user=new _(e,t.user),n},jN=v);a(QN,VN=u);var VN,BN,KN=QN;function QN(e){var t=e.userId,e=e.token,n=VN.call(this)||this;return n.method=A.DELETE,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push/apns/").concat(encodeURIComponent(e)),n}a(function(e,t){var n=BN.call(this,e,t)||this;return n.token=t.token,n.user=new _(e,t.user),n},BN=v);a(XN,zN=u);var zN,WN,YN=XN;function XN(e){var t=e.userId,e=e.token,n=zN.call(this)||this;return n.method=A.DELETE,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push/gcm/").concat(encodeURIComponent(e)),n}a(function(e,t){var n=WN.call(this,e,t)||this;return n.token=t.token,n.user=new _(e,t.user),n},WN=v);a(e1,JN=u);var JN,ZN,$N=e1;function e1(e){var e=e.userId,t=JN.call(this)||this;return t.method=A.DELETE,t.path="".concat(Gm,"/").concat(encodeURIComponent(e),"/push/apns"),t}a(function(e,t){var n=ZN.call(this,e,t)||this;return n.type=t.type?fA[t.type.toLowerCase()]:fA.UNKNOWN,n.user=new _(e,t.user),n},ZN=v);a(i1,t1=u);var t1,n1,r1=i1;function i1(e){var e=e.userId,t=t1.call(this)||this;return t.method=A.DELETE,t.path="".concat(Gm,"/").concat(encodeURIComponent(e),"/push/gcm"),t}a(function(e,t){var n=n1.call(this,e,t)||this;return n.type=t.type?fA[t.type.toLowerCase()]:fA.UNKNOWN,n.user=new _(e,t.user),n},n1=v);a(X1,g1=u);var s1,a1,o1,u1,c1,l1,h1,d1,f1,p1,v1,_1,y1,m1,g1,E1,b1=X1,I1=(a(Y1,m1=v),Y1),T1=(a(W1,y1=u),W1),w1=(a(z1,_1=v),z1),S1=(a(Q1,v1=u),Q1),C1=(a(K1,p1=v),K1),k1=(a(B1,f1=u),B1),A1=(a(V1,d1=v),V1),N1=(a(G1,h1=u),G1),O1=(a(H1,l1=v),H1),R1=(a(j1,c1=u),j1),D1=(a(q1,u1=v),q1),M1=(a(F1,o1=u),F1),x1=(a(U1,a1=v),U1),P1=(a(L1,s1=u),L1);function L1(e){var t=e.userId,e=e.blockedUserId,n=s1.call(this)||this;return n.method=A.POST,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/block"),n.params={target_id:e},n}function U1(e,t){e=a1.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function F1(e){var t=e.userId,n=e.snoozeOn,r=e.startTs,e=e.endTs,i=o1.call(this)||this;return i.method=A.PUT,i.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push_preference"),i.params={snooze_enabled:n,snooze_start_ts:r,snooze_end_ts:e},i}function q1(e,t){e=u1.call(this,e,t)||this;return e.snoozePeriod={isSnoozeOn:t.snooze_enabled},"number"==typeof t.snooze_start_ts&&(e.snoozePeriod.startTs=t.snooze_start_ts),"number"==typeof t.snooze_end_ts&&(e.snoozePeriod.endTs=t.snooze_end_ts),e}function j1(e){var e=e.userId,t=c1.call(this)||this;return t.method=A.GET,t.path="".concat(Gm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function H1(e,t){e=l1.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function G1(e){var t=e.userId,n=e.doNotDisturbOn,r=e.startHour,i=e.startMin,s=e.endHour,a=e.endMin,e=e.timezone,o=h1.call(this)||this;return o.method=A.PUT,o.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push_preference"),o.params={do_not_disturb:n,start_hour:r,start_min:i,end_hour:s,end_min:a,timezone:e},o}function V1(e,t){e=d1.call(this,e,t)||this;return e.preference={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone},e}function B1(e){var e=e.userId,t=f1.call(this)||this;return t.method=A.GET,t.path="".concat(Gm,"/").concat(encodeURIComponent(e),"/push_preference"),t}function K1(e,t){e=p1.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function Q1(e){var t=e.userId,e=e.willAutoAccept,n=v1.call(this)||this;return n.method=A.PUT,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/channel_invitation_preference"),n.params={auto_accept:e},n}function z1(e,t){e=_1.call(this,e,t)||this;return e.autoAccept=t.auto_accept,e}function W1(e){var e=e.userId,t=y1.call(this)||this;return t.method=A.GET,t.path="".concat(Gm,"/").concat(encodeURIComponent(e),"/channel_invitation_preference"),t}function Y1(e,t){e=m1.call(this,e,t)||this;return e.pushTokens={type:t.type?fA[t.type.toLowerCase()]:fA.UNKNOWN,deviceTokens:t.device_tokens,hasMore:t.has_more,token:t.token},e}function X1(e){var t=e.userId,n=e.type,r=e.token,e=e.ts,i=g1.call(this)||this;return i.method=A.GET,i.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push/").concat(encodeURIComponent(n),"/device_tokens"),i.params={created_ts:e,token:r},i}a(function(e,t){var n=E1.call(this,e,t)||this;return n.user=new _(e,t),n},E1=v);a(eO,J1=u);var J1,Z1,$1=eO;function eO(e){var t=e.userId,e=e.unblockedUserId,n=J1.call(this)||this;return n.method=A.DELETE,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/block/").concat(encodeURIComponent(e)),n}a(function(){return null!==Z1&&Z1.apply(this,arguments)||this},Z1=v);a(AO,cO=u);var tO,nO,rO,iO,sO,aO,oO,uO,cO,lO,hO=AO,dO=(a(kO,uO=v),kO),fO=(a(CO,oO=u),CO),pO=(a(SO,aO=v),SO),vO=(a(wO,sO=u),wO),_O=(a(TO,iO=v),TO),yO=(a(IO,rO=u),IO),mO=(a(bO,nO=v),bO),gO=(a(EO,tO=u),EO);function EO(e){var t=e.userId,e=e.discoveryKeys,n=tO.call(this)||this;return n.method=A.DELETE,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discovery_keys:e},n}function bO(e,t){e=nO.call(this,e,t)||this;return e.friendDiscoveryRequestId=t.friend_discovery_request_id,e}function IO(e){var t=e.userId,e=e.discoveries,n=rO.call(this)||this;return n.method=A.PUT,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/friend_discoveries"),n.params={friend_discoveries:e.map(function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}})},n}function TO(t,e){var n=iO.call(this,t,e)||this;return n.changelogs={addedUsers:e.added.map(function(e){return new _(t,e)}),updatedUsers:e.updated.map(function(e){return new _(t,e)}),deletedUserIds:e.deleted,hasMore:e.has_more,token:e.next},n}function wO(e){var t=e.userId,e=e.token,n=sO.call(this)||this;return n.method=A.GET,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/friends/changelogs"),n.params={token:e},n}function SO(e,t){e=aO.call(this,e,t)||this;return e.name=t.name,e}function CO(e){var t=e.userId,e=e.templateName,n=oO.call(this)||this;return n.method=A.PUT,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/push/template"),n.params={name:e},n}function kO(e,t){e=uO.call(this,e,t)||this;return e.name=t.name,e}function AO(e){var e=e.userId,t=cO.call(this)||this;return t.method=A.GET,t.path="".concat(Gm,"/").concat(encodeURIComponent(e),"/push/template"),t}a(function(){return null!==lO&&lO.apply(this,arguments)||this},lO=v);a(FO,RO=u);var NO,OO,RO,DO,MO=FO,xO=(a(UO,OO=v),UO),PO=(a(LO,NO=u),LO);function LO(e){var t=e.userId,e=e.userIds,n=NO.call(this)||this;return n.method=A.DELETE,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}function UO(t,e){var n=OO.call(this,t,e)||this;return n.users=e.users.map(function(e){return new _(t,e)}),n}function FO(e){var t=e.userId,e=e.userIds,n=RO.call(this)||this;return n.method=A.POST,n.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/friends"),n.params={user_ids:e},n}a(function(){return null!==DO&&DO.apply(this,arguments)||this},DO=v);a(WO,HO=u);var qO,jO,HO,GO,VO=WO,BO=(a(zO,jO=v),zO),KO=(a(QO,qO=u),QO);function QO(e){var t=e.userId,e=e.allowFriendDiscovery,n=qO.call(this)||this;return n.method=A.PUT,n.path="".concat(Gm,"/").concat(t,"/allow_friend_discovery"),n.params={allow_friend_discovery:e},n}function zO(e,t){e=jO.call(this,e,t)||this;return e.allowFriendDiscovery=t.allow_friend_discovery,e}function WO(e){var e=e.userId,t=HO.call(this)||this;return t.method=A.GET,t.path="".concat(Gm,"/").concat(e,"/allow_friend_discovery"),t.params={},t}a(function(){return null!==GO&&GO.apply(this,arguments)||this},GO=v);function YO(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map(function(e){return new fR(e)}):[]}var XO,JO,ZO,$O,eR,tR,nR,rR,iR,sR,aR,oR,uR,cR,lR,hR,dR=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url},fR=function(e){var t;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!=(t=e.id)?t:0,this.name=null!=(t=e.name)?t:"",this.url=null!=(t=e.url)?t:"",this.emojis=e.emojis?e.emojis.map(function(e){return new dR(e)}):[]},pR=(a(QR,hR=u),QR),vR=(a(KR,lR=v),KR),_R=(a(BR,cR=u),BR),yR=(a(VR,uR=v),VR),mR=(a(GR,oR=u),GR),gR=(a(HR,aR=v),HR),ER=(a(jR,sR=u),jR),bR=(a(qR,iR=v),qR),IR=(a(FR,rR=Y),FR.prototype._validate=function(){return rR.prototype._validate.call(this)&&J_("string",this.userIdsFilter,!0)&&l("string",this.metaDataKeyFilter,!0)&&J_("string",this.metaDataValuesFilter,!0)&&l("string",this.metaDataKeyFilter,!0)},FR.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=y.of(this._iid).requestQueue,n=new ER(f(f({},this),{token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(bR),r=n.users,i=n.next,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},FR),TR=(a(UR,nR=u),UR),wR=(a(LR,tR=v),LR),SR=(a(PR,eR=Y),PR.prototype._validate=function(){return eR.prototype._validate.call(this)&&J_("string",this.userIdsFilter,!0)},PR.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new TR(f(f({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(wR),r=n.users,i=n.next,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},PR),CR=(a(xR,$O=u),xR),kR=(a(MR,ZO=v),MR),AR=(a(DR,JO=Y),DR.prototype._validate=function(){return JO.prototype._validate.call(this)},DR.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new CR(f(f({},this),{userId:n.userId,token:this._token})),[4,t.send(n)]):[3,2]:[3,5];case 1:return t=e.sent(),n=t.as(kR),r=n.users,i=n.hasMore,s=n.next,this._token=s,this._hasNext=i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}})})},DR),NR={},OR=(RR.get=function(e){return NR[e]},RR);function RR(e){var t=e.dbname,n=e.itemSizeLimit,r=e.cacheLimit,r=void 0===r?256:r,i=e.blockHashBase,i=void 0===i?2:i,s=e.blockHashMultiplier,s=void 0===s?10:s,a=e.blockHashConstant,a=void 0===a?11:a,o=e.transactionApplyDelay,o=void 0===o?200:o,e=e.disableLogger,e=void 0!==e&&e;return NR[t]||(this.itemSizeLimit=void 0===n?1048576:n,this.cacheLimit=r,this.blockHashBase=i,this.blockHashMultiplier=s,this.blockHashConstant=a,this.transactionApplyDelay=o,this.disableLogger=e,NR[t]=this),NR[t]}function DR(){return null!==JO&&JO.apply(this,arguments)||this}function MR(t,e){var n=ZO.call(this,t,e)||this;return n.hasMore=e.has_more,n.users=e.users.map(function(e){return new _(t,e)}),n.next=e.next,n}function xR(e){var t=e.userId,n=e.limit,e=e.token,r=$O.call(this)||this;return r.method=A.GET,r.path="".concat(Gm,"/").concat(encodeURIComponent(t),"/friends"),r.params={limit:n,token:e},r}function PR(e,t){var n=this;return(n=eR.call(this,e,t)||this).userIdsFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n}function LR(t,e){var n=tR.call(this,t,e)||this;return n.users=e.users.map(function(e){return new _(t,e)}),n.next=e.next,n}function UR(e){var t=e.userId,n=e.limit,r=e.token,e=e.userIdsFilter,i=nR.call(this)||this;return i.method=A.GET,i.path="".concat(Gm,"/").concat(t,"/block"),i.params=k({limit:n,token:r,user_ids:e}),i}function FR(e,t){var n=this;return(n=rR.call(this,e,t)||this).userIdsFilter=null,n.metaDataKeyFilter=null,n.metaDataValuesFilter=null,n.nicknameStartsWithFilter=null,n.userIdsFilter=null!=(e=t.userIdsFilter)?e:null,n.metaDataKeyFilter=null!=(e=t.metaDataKeyFilter)?e:null,n.metaDataValuesFilter=null!=(e=t.metaDataValuesFilter)?e:null,n.nicknameStartsWithFilter=t.nicknameStartsWithFilter||null,n}function qR(t,e){var n=iR.call(this,t,e)||this;return n.users=e.users.map(function(e){return new _(t,e)}),n.next=e.next,n}function jR(e){var t=e.limit,n=e.token,r=e.userIdsFilter,i=e.metaDataKeyFilter,s=e.metaDataValuesFilter,e=e.nicknameStartsWithFilter,a=sR.call(this)||this;return a.method=A.GET,a.path=Gm,a.params=k({limit:t,token:n,user_ids:r,metadatakey:i,metadatavalues_in:s,nickname_startswith:e}),a}function HR(e,t){e=aR.call(this,e,t)||this;return e.emoji=new dR(t),e}function GR(e){var e=e.key,t=oR.call(this)||this;return t.method=A.GET,t.path="".concat(Ym,"/").concat(e),t}function VR(e,t){e=uR.call(this,e,t)||this;return e.emojiCategory=new fR(t),e}function BR(e){var e=e.categoryId,t=cR.call(this)||this;return t.method=A.GET,t.path="".concat(Xm,"/").concat(e),t}function KR(e,t){e=lR.call(this,e,t)||this;return e.emojiContainer=new YO(t),e}function QR(){var e=hR.call(this)||this;return e.method=A.GET,e.path=Xm,e}(e=XO=XO||{})[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND";a(O,WR=Error),Object.defineProperty(O,"storeNotDefined",{get:function(){return new O({code:XO.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailable",{get:function(){return new O({code:XO.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeNotAvailableInPrivateBrowsing",{get:function(){return new O({code:XO.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeIsFull",{get:function(){return new O({code:XO.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeKeyTypeIsInvalid",{get:function(){return new O({code:XO.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenIntegrity",{get:function(){return new O({code:XO.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeBrokenBlob",{get:function(){return new O({code:XO.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeEncryptionInvalid",{get:function(){return new O({code:XO.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeItemSizeExceeded",{get:function(){return new O({code:XO.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeReadFailed",{get:function(){return new O({code:XO.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"storeWriteFailed",{get:function(){return new O({code:XO.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"databaseSchemaNotOnUpgrade",{get:function(){return new O({code:XO.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionNotReady",{get:function(){return new O({code:XO.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotMatch",{get:function(){return new O({code:XO.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionQueryNotValid",{get:function(){return new O({code:XO.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionInsertDuplicate",{get:function(){return new O({code:XO.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotFound",{get:function(){return new O({code:XO.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionKeyNotGiven",{get:function(){return new O({code:XO.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionWriteFailed",{get:function(){return new O({code:XO.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"collectionItemSizeExceeded",{get:function(){return new O({code:XO.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTableIsRequired",{get:function(){return new O({code:XO.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"indexTypesNotMatch",{get:function(){return new O({code:XO.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"compareTypesNotMatch",{get:function(){return new O({code:XO.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(O,"circularReferenceFound",{get:function(){return new O({code:XO.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0});var zR,WR,N=O;function O(e){var t=e.code,t=void 0===t?XO.UNKNOWN_ERROR:t,e=e.message,e=WR.call(this,void 0===e?"Unknown error occurred.":e)||this;return e.code=t,Object.setPrototypeOf(e,O.prototype),e}(Rn=zR=zR||{}).INIT="init",Rn.READY="ready",Rn.CLOSED="closed";function YR(e,t){if(void 0===t&&(t=new WeakMap),"object"!=typeof e||null===e)return e;if(t.has(e))throw N.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map(function(e){return YR(e,t)});else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=YR(e[r],t);return t.delete(e),n}function XR(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw N.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n}function JR(t){return new Promise(function(e){setTimeout(function(){return e()},t)})}function ZR(e,t){if(t){if("function"==typeof e)return e(t);for(var n in e)if(["/and","&&"].includes(n)){if(e[n].some(function(e){return!ZR(e,t)}))return}else if(["/or","||"].includes(n)){if(e[n].every(function(e){return!ZR(e,t)}))return}else if("/where"===n){if(!(0,e[n])(t))return}else{var r=n;if("object"==typeof e[r]){var i,s=e[r];for(i in s)switch(i){case"/eq":case"=":if((a=t[r])!==(o=s[i]))return;break;case"/neq":case"!=":if((a=t[r])===(o=s[i]))return;break;case"/gt":case">":var a=t[r],o=s[i];if(0<XR(a,o))break;return;case"/gte":case">=":if(a=t[r],o=s[i],0<=XR(a,o))break;return;case"/lt":case"<":if(a=t[r],o=s[i],XR(a,o)<0)break;return;case"/lte":case"<=":if(a=t[r],o=s[i],XR(a,o)<=0)break;return;case"/in":if(a=t[r],(o=s[i]).includes(a))break;return;case"/nin":if(a=t[r],(o=s[i]).includes(a))return;break;case"/contain":if(a=t[r],o=s[i],a.includes(o))break;return;case"/regex":if(a=t[r],(o=s[i]).test(a))break;return;case"/where":if(a=t[r],!(0,s[i])(a))return}}else if("function"==typeof e[r]){if(!e[r](t[r]))return}else if(e[r]!==t[r])return}return 1}}function $R(){}function eD(){return Promise.resolve()}function tD(e){return e}function nD(e,t){t(null)}var rD=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t};function iD(e,t){return"".concat(vD(e,t),".metadata")}function sD(e,t){return"".concat(vD(e,t),"/block.")}function aD(e,t){return"".concat(vD(e,t),"/blob.")}function oD(e,t,n,r){return void 0===r&&(r=0),"".concat(aD(e,t)).concat(n,".").concat(r)}Object.defineProperty(ED.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(ED.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(ED.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(ED.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(ED.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),ED.prototype.prev=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:if(!this.hasPrevious)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._prevValue,[4,(n=this)._backward()];case 2:return n._prevValue=e.sent()||null,this._nextValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},ED.prototype.next=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:if(!this.hasNext)return[3,6];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this._nextValue,[4,(n=this)._forward()];case 2:return n._nextValue=e.sent()||null,this._prevValue=t,[3,4];case 3:return r=e.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,e.sent()];case 6:this._complete(),e.label=7;case 7:return[2]}})})},ED.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()};var uD,cD,lD,hD=ED,dD=(gD.prototype.findOptimizedStartPosition=function(){var s=this,a=["=","/eq",">",">=","/gt","/gte"],o=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var e=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var t in this._indexer.fields){var n=this._indexer.fields[t],r=1;if("-"===n[0]&&(n=n.slice(1),r=-1),this.condition[n])if("object"==typeof this.condition[n]){var i,u=0<r?o:a;for(i in this.condition[n])if(u.includes(i))for(var c=e;0<=c;c--)if(r*XR(this._indexer.origin[c].columnValues[t],this.condition[n][i])<=0){e=c;break}}else for(c=e;0<=c;c--)if(r*XR(this._indexer.origin[c].columnValues[t],this.condition[n])<=0){e=c;break}}return Math.min(e+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=this,t=0;t<this._indexer.fields.length;t++)!function(n){var r=h._indexer.fields[n],i=1;if("-"===r[0]&&(r=r.slice(1),i=-1),h.condition[r])if("object"==typeof h.condition[r])Object.keys(h.condition[r]).forEach(function(e){if((0<i?a:o).includes(e))for(var t=l;t<s._indexer.origin.length;t++)if(0<=i*XR(s._indexer.origin[t].columnValues[n],s.condition[r][e])){l=t;break}});else for(var e=l;e<h._indexer.origin.length;e++)if(0<=i*XR(h._indexer.origin[e].columnValues[n],h.condition[r])){l=e;break}}(t);return Math.max(l-1,0)},gD.prototype.each=function(c){return re(this,void 0,void 0,function(){var r,i,s,a,t,n,o,u=this;return ie(this,function(e){switch(e.label){case 0:if(r=this.findOptimizedStartPosition(),i=0,this.backward&&this._indexer.origin[r]&&(i=this._indexer.origin[r].keys.length-1),s=function(){if(u._indexer.origin[r]){if(!u._indexer.origin[r].keys[++i]){if(!u._indexer.origin[++r])return!1;i=0}return!0}return!1},a=function(){if(u._indexer.origin[r]){if(!u._indexer.origin[r].keys[--i]){if(!u._indexer.origin[--r])return!1;i=u._indexer.origin[r].keys.length-1}return!0}return!1},t=null,!this._indexer.origin[r])return[3,4];n=this.backward?a:s,e.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])];case 2:if(o=e.sent(),ZR(this.condition,o))return t=o,[3,4];e.label=3;case 3:if(n())return[3,1];e.label=4;case 4:return[4,new Promise(function(e){e=new hD({initialNextValue:YR(t),iterator:c,forward:function(){return re(u,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:t=this.backward?a:s,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])]:[3,3];case 2:return n=e.sent(),ZR(this.condition,n)?[2,YR(n)]:[3,1];case 3:return[2,null]}})})},backward:function(){return re(u,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:t=this.backward?s:a,e.label=1;case 1:return t()?[4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[i])]:[3,3];case 2:return n=e.sent(),ZR(this.condition,n)?[2,YR(n)]:[3,1];case 3:return[2,null]}})})},complete:e});c(e)})];case 5:return[2,e.sent()]}})})},gD),fD=(mD.prototype.fetch=function(a){return void 0===a&&(a={}),re(this,void 0,void 0,function(){var n,r,i,t,s=this;return ie(this,function(e){switch(e.label){case 0:if(n=Math.max(a.offset||0,0),0===(r="number"==typeof a.limit?a.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(r<0)throw N.collectionQueryNotValid;e.label=1;case 1:return e.trys.push([1,4,,5]),i=[],[4,this._mutex.lock()];case 2:return e.sent(),[4,this._iterator.each(function(t){return re(s,void 0,void 0,function(){return ie(this,function(e){return!t.error&&t.hasNext?0===n?(i.push(t.nextValue),0<r&&r<=i.length?t.stop():t.next()):(n--,t.next()):t.stop(),[2]})})})];case 3:return e.sent(),this._mutex.unlock(),[2,i];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[2]}})})},mD.prototype.count=function(){return re(this,void 0,void 0,function(){var n,t,r=this;return ie(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),n=0,[4,this._mutex.lock()];case 1:return e.sent(),[4,this._iterator.each(function(t){return re(r,void 0,void 0,function(){return ie(this,function(e){return!t.error&&t.hasNext?(n++,t.next()):t.stop(),[2]})})})];case 2:return e.sent(),this._mutex.unlock(),[2,n];case 3:throw t=e.sent(),this._mutex.unlock(),t;case 4:return[2]}})})},mD),pD=function(e){return"".concat("nest","@").concat(e)},vD=function(e,t){return"".concat(pD(e),"/").concat(t)},_D=(yD.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(0<n){for(var r=Math.ceil(e.data.length/n),r="".concat(r,".").concat(e.type,".").concat(t),i=[],s=0;s<e.data.length;s+=n){var a=e.data.slice(s,s+n);i.push(a)}return{blobId:r,shards:i}}return{blobId:null,shards:null}},yD.prototype._encode=function(n){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){var t=new FileReader;t.onload=function(){e({data:t.result,type:n.type})},t.readAsDataURL(n)})];case 1:return[2,e.sent()]}})})},yD.prototype._decode=function(o){return re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return"undefined"==typeof fetch?[3,3]:[4,fetch(o.data)];case 1:return[4,e.sent().blob()];case 2:return[2,e.sent()];case 3:for(t=[],n=atob(o.data.split(",")[1]),r=0;r<n.length;r+=512){for(i=n.slice(r,r+512),s=new Array(i.length),a=0;a<i.length;a++)s[a]=i.charCodeAt(a);t.push(new Uint8Array(s))}return[2,new Blob(t,{type:o.type})]}})})},yD.prototype.get=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:if(t=[],n=L_(a.split("."),2),r=n[0],n=n[1],!(0<(r=parseInt(r))))return[3,6];i=0,e.label=1;case 1:return i<r?(s=oD(this.dbname,this.collectionName,a,i),[4,this._store.get(s)]):[3,4];case 2:if(!(s=e.sent())||!s.d)throw N.storeBrokenBlob;t.push(s.d),e.label=3;case 3:return i++,[3,1];case 4:return[4,this._decode({data:t.join(""),type:n})];case 5:return[2,e.sent()];case 6:return[2,null]}})})},yD.prototype.save=function(o,u){return void 0===u&&(u="".concat(Date.now())),re(this,void 0,void 0,function(){var t,n,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return t=[],[4,this._encode(o)];case 1:if(n=e.sent(),n=this._makeShards(n,u),r=n.blobId,i=n.shards,!r)return[3,3];for(s=0;s<i.length;s++)a=oD(this.dbname,this.collectionName,r,s),t.push({key:a,value:{d:i[s]},generation:1});return[4,this._store.setMany(t)];case 2:if(e.sent().some(function(e){return e instanceof Error}))throw N.storeWriteFailed;return[2,r];case 3:return[2,null]}})})},yD.prototype.remove=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:if(t=[],n=L_(s.split("."),1),n=n[0],!(0<(r=parseInt(n))))return[3,2];for(i=0;i<r;i++)t.push(oD(this.dbname,this.collectionName,s,i));return[4,this._store.removeMany(t)];case 1:e.sent(),e.label=2;case 2:return[2]}})})},yD.prototype.clear=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=aD(this.dbname,this.collectionName),n=[],[4,this._store.getAllKeys()];case 1:r=e.sent();try{for(i=se(r),s=i.next();!s.done;s=i.next())(a=s.value).startsWith(t)&&n.push(a)}catch(e){o={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(o)throw o.error}}return[4,this._store.removeMany(r)];case 2:return e.sent(),[2]}})})},yD);function yD(e){var t=e.dbname,n=e.collectionName,e=e.store;this.dbname=t,this.collectionName=n,this._store=e}function mD(e){var t=e.condition,t=void 0===t?{}:t,n=e.backward,n=void 0!==n&&n,r=e.mutex,i=e.blockManager,e=e.indexer;this._mutex=r,this._iterator=new dD({condition:t,backward:n,blockManager:i,indexer:e})}function gD(e){var t=e.condition,n=e.backward,n=void 0!==n&&n,r=e.blockManager,e=e.indexer;this.condition=void 0===t?{}:t,this.backward=n,this._blockManager=r,this._indexer=e}function ED(e){var t=e.initialPrevValue,n=e.initialNextValue,n=void 0===n?null:n,r=e.iterator,i=e.map,i=void 0===i?tD:i,s=e.backward,s=void 0===s?eD:s,a=e.forward,a=void 0===a?eD:a,e=e.complete,e=void 0===e?$R:e;this._prevValue=void 0===t?null:t,this._nextValue=n,this._error=null,this._map=i,this._backward=s,this._forward=a,this._iterator=r,this._complete=e}(n=uD=uD||{})[n.COMMIT=0]="COMMIT",n[n.WRITE=1]="WRITE",n[n.ERROR=2]="ERROR",(bn=cD=cD||{}).PENDING="pending",bn.PERSISTENT="persistent",bn.VOLATILE="volatile",(ot=lD=lD||{})[ot.NO_CACHE=0]="NO_CACHE",ot[ot.DEFAULT=1]="DEFAULT",ot[ot.PERSISTENT=2]="PERSISTENT";var bD=[cD.PENDING,cD.VOLATILE],ID={},TD=(MD.get=function(e){return ID[e]},Object.defineProperty(MD.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),MD.prototype.find=function(r,i,s){return void 0===s&&(s=lD.DEFAULT),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return(t=this.get(i))?[3,2]:[4,r.get(i)];case 1:return(n=e.sent())&&(t={key:i,value:n,generation:1,state:s===lD.PERSISTENT?cD.PERSISTENT:cD.VOLATILE},this.put(t)),[3,3];case 2:s===lD.PERSISTENT&&(t.state=cD.PERSISTENT),e.label=3;case 3:return[2,t]}})})},MD.prototype.get=function(e,t){void 0===t&&(t=lD.DEFAULT);var e=this._items.map(function(e){return e.key}).indexOf(e);return-1<e?(e=this._items[e],t===lD.PERSISTENT&&(e.state=cD.PERSISTENT),t!==lD.NO_CACHE&&this.put(e),e):null},MD.prototype.put=function(e){var t,n;if(0<this._limit){var r=this._items.map(function(e){return e.key}).indexOf(e.key);if(-1<r)bD.includes(this._items[r].state)&&bD.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter(function(e){return e.state===cD.VOLATILE}).length-this._limit;if(0<i){var s=[];try{for(var a=se(this._items),o=a.next();!o.done;o=a.next()){var u=o.value;u.state===cD.VOLATILE&&0<i?i--:s.push(u)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this._items=s}}}},MD.prototype.remove=function(e){e=this._items.map(function(e){return e.key}).indexOf(e);-1<e&&this._items.splice(e,1)},MD.prototype.clearByCondition=function(t){this._items=this._items.filter(function(e){return!t(e)})},MD.prototype.clear=function(e){this._items=(e=void 0===e?!1:e)?[]:this._items.filter(function(e){return e.state!==cD.VOLATILE})},MD),wD=(Object.defineProperty(DD.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(DD.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),DD.prototype._getReducedRecordset=function(n){return void 0===n&&(n=[]),re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=e.sent()||[]).push.apply(t,U_([],L_(n),!1)),[2,this._reduceRecordSet(t)]}})})},DD.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;0<=r;r--){for(var i=e[r],s=[],a=i.requests.length-1;0<=a;a--){var o=i.requests[a],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0)}0<s.length&&(i.requests=s,t.unshift(i))}return t},DD.prototype._applyRecord=function(c,l){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:t=TD.get(this.dbname),n=l.generation,r=l.requests,i=null,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.setMany(r.map(function(e){return f(f({},e.data),{generation:n})}))];case 2:for(s=e.sent(),a=0;a<r.length;a++)s[a]instanceof Error&&(i=i||s[a],o=r[a].data,t.put(f(f({},o),{generation:n,state:cD.PERSISTENT})));return[3,4];case 3:return u=e.sent(),i=u,[3,4];case 4:return i?[3,6]:(u=c.filter(function(e){return e.generation!==n}),[4,this._store.set({key:this.recordsetKey,value:u,generation:n})]);case 5:return e.sent(),this._onWrite.forEach(function(e){e(r.map(function(e){return e.data}))}),[3,7];case 6:this._onError.forEach(function(e){return e(i)}),e.label=7;case 7:return[2]}})})},DD.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return[4,(t=this)._store.get(this.metadataKey)];case 1:return t._metadata=e.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:n=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),r=se(n),i=r.next(),e.label=4;case 4:return i.done?[3,7]:(s=i.value,[4,this._applyRecord(n,s)]);case 5:e.sent(),e.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return s=e.sent(),a={error:s},[3,10];case 9:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},DD.prototype.on=function(e,t,n){switch(e){case uD.COMMIT:this._onCommit.set(t,n);break;case uD.WRITE:this._onWrite.set(t,n);break;case uD.ERROR:this._onError.set(t,n)}},DD.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t=void 0===t?null:t}),TD.get(this.dbname).put(f({state:cD.PENDING,generation:this.generation},e))},DD.prototype.requestMultipleWrite=function(e,t){void 0===t&&(t=null);var n,r,i=TD.get(this.dbname);try{for(var s=se(e),a=s.next();!a.done;a=s.next()){var o=a.value;this._requests.push({data:o,options:t}),i.put(f({state:cD.PENDING,generation:this.generation},o))}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},DD.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return TD.get(this.dbname).clearByCondition(function(e){return e.state===cD.PENDING}),this._requests=[],[2]})})},DD.prototype.commit=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d=this;return ie(this,function(e){switch(e.label){case 0:if(!(0<(t=this._requests).length))return[3,4];for(n=[],r={},u=t.length-1;0<=u;u--)i=t[u],c=i.data,r[c.key]||(r[c.key]=!0,n.unshift(i));return s={generation:this.generation,requests:n},[4,this._getReducedRecordset([s])];case 1:return a=e.sent(),[4,this._store.set({key:this.recordsetKey,value:a,generation:this.generation})];case 2:return e.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(e.sent(),o=TD.get(this.dbname),u=0;u<n.length;u++)l=n[u],c=l.data,l=l.options,o.put(f(f({},c),{generation:s.generation,state:l&&l.persistent?cD.PERSISTENT:cD.VOLATILE}));this._requests=[],this._onCommit.forEach(function(e){e(t.map(function(e){return e.data}))}),h=OR.get(this.dbname),setTimeout(function(){try{d._applyRecord(a,s)}catch(t){d._onError.forEach(function(e){return e(t)})}},h.transactionApplyDelay),e.label=4;case 4:return[2]}})})},DD),SD=(RD.createFromCacheItem=function(e){return e?new RD(e.value):null},Object.defineProperty(RD.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(RD.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),RD.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},RD.prototype.getItemByKey=function(t){var n=this;return this._items.find(function(e){e=e[n.keyName];return t===e})},RD.prototype.has=function(e){var t=this;return this._items.map(function(e){return e[t.keyName]}).includes(e)},RD.prototype.add=function(e){var t=this,n=this._items.map(function(e){return e[t.keyName]}).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},RD.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},RD.prototype.clear=function(){this._items=[]},RD),CD=(Object.defineProperty(OD.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),OD.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,e="".concat(function(e,t,n){t=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||rD)(e,t)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(sD(n,r)).concat(i,".").concat(e);var n,r,i},OD.prototype._findBlock=function(s){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:t=TD.get(this.dbname),n=this.metadata.blockLevel,e.label=1;case 1:return 0<n?(r=this.createBlockId(s,n),[4,t.find(this._store,r)]):[3,4];case 2:if((r=e.sent())&&(i=SD.createFromCacheItem(r)).getItemByKey(s))return[2,i];e.label=3;case 3:return n--,[3,1];case 4:return[2,null]}})})},OD.prototype.getFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return[2,(t=e.sent())?t.getItemByKey(n):null]}})})},OD.prototype.putToBlock=function(i,s){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return n=OR.get(this.dbname),t=this.createBlockId(i),n=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,TD.get(this.dbname).find(this._store,t)];case 1:return r=e.sent(),(r=r?SD.createFromCacheItem(r):new SD({blockId:t,keyName:this.keyName,items:[],limit:n})).add(s)?(this._transaction.requestWrite({key:r.blockId,value:r.serialize()}),[2,!0]):[2,!1]}})})},OD.prototype.removeFromBlock=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._findBlock(n)];case 1:return(t=e.sent())&&t.remove(n)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}})})},OD.prototype.clearAllBlocks=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u;return ie(this,function(e){switch(e.label){case 0:return t=sD(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return n=e.sent(),n=n.filter(function(e){return e.startsWith(t)}),[4,this._store.removeMany(n)];case 2:e.sent(),r=TD.get(this.dbname);try{for(i=se(n),s=i.next();!s.done;s=i.next())a=s.value,r.remove(a)}catch(e){o={error:e}}finally{try{s&&!s.done&&(u=i.return)&&u.call(i)}finally{if(o)throw o.error}}return[2]}})})},OD),kD=(ND.createKey=function(e){return e.join(">")},ND.parseKey=function(e){return e.split(">")},ND.prototype._addItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),n=L_(this.indexOf(e),2),r=n[0];return n[1]?!this._table[r].keys.includes(t)&&(this._table[r].keys.push(t),!0):(this._table.splice(r,0,{columnValues:e,keys:[t]}),!0)},ND.prototype._removeItem=function(e){var t=e[this.keyName],e=this.getColumnValues(e),e=L_(this.indexOf(e),2),n=e[0];if(e[1]){e=this._table[n].keys.indexOf(t);if(-1<e)return this._table[n].keys.splice(e,1),0===this._table[n].keys.length&&this._table.splice(n,1),!0}return!1},Object.defineProperty(ND.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(ND.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),ND.prototype.getColumnValues=function(e){var t,n,r=[];try{for(var i=se(this.fields),s=i.next();!s.done;s=i.next()){var a,o=s.value,u=e[o="-"===o[0]?o.slice(1):o];if(a=typeof u,null!==u&&"undefined"!=a&&"boolean"!=a&&"number"!=a&&"string"!=a)throw N.indexTypesNotMatch;r.push(e[o])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},ND.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,n=XR(e[n],t[n]);if(0!==n)return r*n}return 0},ND.prototype.indexOf=function(e){if(0<this._table.length){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(0<i)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},ND.prototype.ensure=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d,f,p,v;return ie(this,function(e){switch(e.label){case 0:return[4,(t=TD.get(this.dbname)).find(this._store,this.indexerKey,lD.PERSISTENT)];case 1:return(n=e.sent())?[3,11]:(r=sD(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:i=e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),s=se(i),a=s.next(),e.label=4;case 4:return a.done?[3,7]:(o=a.value).startsWith(r)?[4,t.find(this._store,o,lD.NO_CACHE)]:[3,6];case 5:o=e.sent(),h=SD.createFromCacheItem(o);try{for(p=void 0,u=se(h.items),c=u.next();!c.done;c=u.next())l=c.value,this._addItem(l)}catch(e){p={error:e}}finally{try{c&&!c.done&&(v=u.return)&&v.call(u)}finally{if(p)throw p.error}}e.label=6;case 6:return a=s.next(),[3,4];case 7:return[3,10];case 8:return h=e.sent(),d={error:h},[3,10];case 9:try{a&&!a.done&&(f=s.return)&&f.call(s)}finally{if(d)throw d.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=n.value,this._table=YR(this._origin),e.label=12;case 12:return[2]}})})},ND.prototype.drop=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return TD.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}})})},ND.prototype.addItem=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._addItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},ND.prototype.removeItem=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._removeItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},ND.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},ND.prototype.commit=function(){this._origin=this._table,this._table=YR(this._origin)},ND.prototype.abort=function(){this._table=YR(this._origin)},ND),AD="undefined"!=typeof document&&"undefined"!=typeof navigator;function ND(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,e=e.store,a=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=(t=this.dbname,n=this.collectionName,r=this.fields.join(">"),"".concat(vD(t,n),"/index.").concat(r)),this._transaction=s,this._store=e,this._transaction.on(uD.COMMIT,this.indexerKey,function(){return a.commit()}),this._transaction.on(uD.ERROR,this.indexerKey,function(){return a.abort()})}function OD(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,i=void 0===i?rD:i,s=e.transaction,e=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=i,this.metadata=r,this._transaction=s,this._store=e}function RD(e){var t=e.blockId,n=e.keyName,r=e.items,r=void 0===r?[]:r,e=e.limit;this.blockId=t,this.keyName=n,this.limit=e,this._items=U_([],L_(r),!1)}function DD(e){var t=e.dbname,n=e.collectionName,e=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey="".concat(vD(t,n),"/trans.metadata"),this.recordsetKey="".concat(vD(t,n),"/trans.recordset"),this._store=e}function MD(e){var t=e.dbname,e=e.limit,e=void 0===e?256:e;return ID[t]||(this.dbname=t,this._items=[],this._limit=e,ID[t]=this),ID[t]}AD&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var xD=AD&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");AD&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),AD&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),AD&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");function PD(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})}var LD,UD,FD=AD&&navigator.userAgent&&navigator.userAgent.includes("Edge/");(dr=LD=LD||{})[dr.PROCESSING=0]="PROCESSING",dr[dr.DONE=1]="DONE",(wt=UD=UD||{}).NEWNODE="newnode",wt.REMOVENODE="removenode",wt.CLAIM_HOST="claimhost",wt.SYNC_HOST="synchost",wt.REQUEST_LOCK="requestlock",wt.ACQUIRE_LOCK="acquirelock",wt.RELEASE_LOCK="releaselock";var qD,jD={},HD=(Object.defineProperty(eM.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(eM.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(eM.prototype,"isInSync",{get:function(){return this._state==LD.DONE},enumerable:!1,configurable:!0}),eM.prototype._send=function(e,t){var n,e={nodeId:this.nodeId,requestId:null!=(n=null==(t=void 0===t?{}:t)?void 0:t.requestId)?n:PD(),key:this.key,op:e,data:null!=(n=t.data)?n:null,ts:Date.now()};return AD&&window.postMessage(e,"*"),e},eM.prototype._acquire=function(e){(e=void 0===e?null:e)?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null},eM.prototype._release=function(t){var e,n;this._currentItem&&this._currentItem.requestId===t&&(e=this._currentItem,this._currentItem=null,e.nodeId===this.nodeId&&this._send(UD.RELEASE_LOCK,{requestId:e.requestId}),-1<(n=this._queue.findIndex(function(e){return e.requestId===t}))&&this._queue.splice(n,1),e.onReleased(t))},eM.prototype._requestLock=function(i){var s=this;return new Promise(function(t){var e,n={nodeId:i.nodeId,requestId:i.requestId,ts:i.ts,onAcquired:function(e){s.isHost&&s._send(UD.ACQUIRE_LOCK,{requestId:e}),t()},onReleased:function(){s._acquire(s._queue[0])}},r=!1;for(e in s._queue)if(s._queue[e].ts>n.ts){s._queue.splice(parseInt(e),0,n),r=!0;break}r||s._queue.push(n),s._currentItem||s._acquire(s._queue[0])})},eM.prototype._sendSync=function(){var e;this.isHost&&this._send(UD.SYNC_HOST,{data:{currentItemRequestId:null==(e=this._currentItem)?void 0:e.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},eM.prototype._waitUntilSyncCompleted=function(){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(e){t._activationQueue.push(e)})]:[2]})})},eM.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout(function(){e._completeSync()},8))},eM.prototype._completeSync=function(){this.isInSync||(this._state=LD.DONE,this._activationQueue.forEach(function(e){return e()}),this._activationQueue=[])},eM.prototype.registerNode=function(){this._send(UD.NEWNODE),this._waitSync()},eM.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(UD.CLAIM_HOST),this._waitSync()},eM.prototype.lock=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),t=this._send(UD.REQUEST_LOCK),[4,this._requestLock(t)];case 2:return e.sent(),[2]}})})},eM.prototype.unlock=function(){var e;this._release(null==(e=this._currentItem)?void 0:e.requestId)},eM),GD=($D.metadataOf=function(n,r,i){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=iD(n,r),[4,i.get(t)];case 1:return[2,e.sent()]}})})},Object.defineProperty($D.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty($D.prototype,"isReady",{get:function(){return this._state===zR.READY},enumerable:!1,configurable:!0}),$D.prototype.init=function(){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h,d,f,p=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._mutex.lock()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,9,,10]),t=OR.get(this.dbname),[4,$D.metadataOf(this.dbname,this.name,this._store)];case 3:return n=e.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:e.sent(),this._blockManager=new CD({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=U_([],L_(this.indexes),!1),i=[],s=r.map(function(e){return kD.createKey(e)}),a=n?n.indexes.map(function(e){return kD.createKey(e)}):[];try{for(o=se(a),u=o.next();!u.done;u=o.next())c=u.value,s.includes(c)||i.push(kD.parseKey(c))}catch(e){d={error:e}}finally{try{u&&!u.done&&(f=o.return)&&f.call(o)}finally{if(d)throw d.error}}return(l=[]).push.apply(l,U_([],L_(r.map(function(e){e=new kD({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store});return p._indexers.push(e),e.ensure()})),!1)),l.push.apply(l,U_([],L_(i.map(function(e){return new kD({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return e.sent(),[4,this._transaction.commit()];case 6:return e.sent(),s.sort().join(",")===a.sort().join(",")?[3,8]:(l=iD(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:l,value:this._metadata,generation:1})]);case 7:e.sent(),e.label=8;case 8:return this._state=zR.READY,this._mutex.unlock(),[3,10];case 9:throw h=e.sent(),this._mutex.unlock(),h;case 10:return[2]}})})},$D.prototype.close=function(){this._state=zR.CLOSED},$D.prototype._hasPropertyOfKeyName=function(e){e=e[this.keyName];return"string"==typeof e&&!!e},$D.prototype._getIndexerBy=function(e){e=(e=void 0===e?null:e)||[this.keyName];var t,n,r=kD.createKey(e);try{for(var i=se(this._indexers),s=i.next();!s.done;s=i.next()){var a=s.value;if(r===kD.createKey(a.fields))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},$D.prototype._upgradeBlockLevel=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return t=iD(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:t,value:this._metadata,generation:1})];case 1:return e.sent(),[2]}})})},$D.prototype._requestInsert=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return t=a[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return e.sent()?[3,13]:[4,this._blockManager.putToBlock(t,a)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,a)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),n=se(this._indexers),r=n.next(),e.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(a)];case 7:e.sent(),e.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=e.sent(),i={error:i},[3,12];case 11:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 12:return[3,14];case 13:throw N.collectionInsertDuplicate;case 14:return[2]}})})},$D.prototype._requestUpsert=function(d){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l,h;return ie(this,function(e){switch(e.label){case 0:return t=d[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[3,13]:[4,this._blockManager.putToBlock(t,d)];case 2:return e.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return e.sent(),[4,this._blockManager.putToBlock(t,d)];case 4:e.sent(),e.label=5;case 5:e.trys.push([5,10,11,12]),r=se(this._indexers),i=r.next(),e.label=6;case 6:return i.done?[3,9]:[4,(o=i.value).addItem(d)];case 7:e.sent(),e.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return u=e.sent(),u={error:u},[3,12];case 11:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,d)];case 14:e.sent(),e.label=15;case 15:e.trys.push([15,21,22,23]),s=se(this._indexers),a=s.next(),e.label=16;case 16:return a.done?[3,20]:0===(o=a.value).diff(o.getColumnValues(n),o.getColumnValues(d))?[3,19]:[4,o.removeItem(n)];case 17:return e.sent(),[4,o.addItem(d)];case 18:e.sent(),e.label=19;case 19:return a=s.next(),[3,16];case 20:return[3,23];case 21:return l=e.sent(),l={error:l},[3,23];case 22:try{a&&!a.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}return[7];case 23:return[2]}})})},$D.prototype._requestUpdate=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return t=u[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=e.sent())?[4,this._blockManager.putToBlock(t,u)]:[3,11];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,9,10,11]),r=se(this._indexers),i=r.next(),e.label=4;case 4:return i.done?[3,8]:0===(s=i.value).diff(s.getColumnValues(n),s.getColumnValues(u))?[3,7]:[4,s.removeItem(n)];case 5:return e.sent(),[4,s.addItem(u)];case 6:e.sent(),e.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return a=e.sent(),a={error:a},[3,11];case 10:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 11:return[2]}})})},$D.prototype._requestRemove=function(a){return re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:return[4,this._blockManager.getFromBlock(a)];case 1:return(t=e.sent())?[4,this._blockManager.removeFromBlock(a)]:[3,10];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),n=se(this._indexers),r=n.next(),e.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:e.sent(),e.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=e.sent(),i={error:i},[3,10];case 9:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 10:return[2]}})})},$D.prototype._requestClear=function(){return re(this,void 0,void 0,function(){var t,n,r,i;return ie(this,function(e){switch(e.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:e.sent(),e.label=2;case 2:e.trys.push([2,7,8,9]),t=se(this._indexers),n=t.next(),e.label=3;case 3:return n.done?[3,6]:[4,n.value.clear()];case 4:e.sent(),e.label=5;case 5:return n=t.next(),[3,3];case 6:return[3,9];case 7:return r=e.sent(),r={error:r},[3,9];case 8:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}return[7];case 9:return[2]}})})},$D.prototype.getByKey=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(n)];case 3:return t=e.sent(),this._mutex.unlock(),[2,YR(t)];case 4:throw t=e.sent(),this._mutex.unlock(),t;case 5:return[3,7];case 6:throw N.collectionNotReady;case 7:return[2]}})})},$D.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new fD({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},$D.prototype.insertOne=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestInsert(YR(n))];throw N.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw N.collectionNotReady;case 9:return[2]}})})},$D.prototype.insertMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),u.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw N.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=se(u),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(YR(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),s={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,u];case 12:return i=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),i;case 14:return[3,16];case 15:throw N.collectionNotReady;case 16:return[2]}})})},$D.prototype.upsertOne=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpsert(YR(n))];throw N.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw N.collectionNotReady;case 9:return[2]}})})},$D.prototype.upsertMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,12,,14]),u.some(function(e){return!o._hasPropertyOfKeyName(e)}))throw N.collectionKeyNotGiven;e.label=3;case 3:e.trys.push([3,8,9,10]),t=se(u),n=t.next(),e.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(YR(r))]);case 5:e.sent(),e.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return r=e.sent(),s={error:r},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return e.sent(),this._mutex.unlock(),[2,u];case 12:return i=e.sent(),[4,this._transaction.clear()];case 13:throw e.sent(),this._mutex.unlock(),i;case 14:return[3,16];case 15:throw N.collectionNotReady;case 16:return[2]}})})},$D.prototype.update=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:if(e.trys.push([2,5,,7]),this._hasPropertyOfKeyName(n))return[4,this._requestUpdate(YR(n))];throw N.collectionKeyNotGiven;case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[2,n];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw N.collectionNotReady;case 9:return[2]}})})},$D.prototype.updateIf=function(h,d){return re(this,void 0,void 0,function(){var i,s,t,n,r,a,o,u,c,l=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,15]),a=h.where,i=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,r=h.backward,r=void 0!==r&&r,s=[],[4,new dD({condition:i,blockManager:this._blockManager,backward:r,indexer:this._getIndexerBy(a)}).each(function(r){return re(l,void 0,void 0,function(){var t,n;return ie(this,function(e){if(r.error)throw r.stop(),r.error;if(r.hasNext){if(t=r.nextValue,ZR(i,t)&&d.set){if("function"!=typeof d.set)for(n in d.set)t[n]=d.set[n];else d.set(t);s.push(t)}r.next()}else r.stop();return[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=se(s),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(r=n.value,[4,this._requestUpdate(YR(r))]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),u={error:a},[3,11];case 10:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,s];case 13:return o=e.sent(),[4,this._transaction.clear()];case 14:throw e.sent(),this._mutex.unlock(),o;case 15:return[3,17];case 16:throw this._transaction.clear(),N.collectionNotReady;case 17:return[2]}})})},$D.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestRemove(n)];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw N.collectionNotReady;case 9:return[2]}})})},$D.prototype.removeIf=function(h){return re(this,void 0,void 0,function(){var r,i,t,n,s,a,o,u,c,l=this;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,13,,14]),a=h.where,r=void 0===a?{}:a,a=h.index,a=void 0===a?null:a,s=h.backward,s=void 0!==s&&s,i=[],[4,new dD({condition:r,blockManager:this._blockManager,backward:s,indexer:this._getIndexerBy(a)}).each(function(n){return re(l,void 0,void 0,function(){var t;return ie(this,function(e){if(n.error)throw n.stop(),n.error;return n.hasNext?(t=n.nextValue,ZR(r,t)&&(t=t[this.keyName],i.push(t)),n.next()):n.stop(),[2]})})})];case 3:e.sent(),e.label=4;case 4:e.trys.push([4,9,10,11]),t=se(i),n=t.next(),e.label=5;case 5:return n.done?[3,8]:(s=n.value,[4,this._requestRemove(s)]);case 6:e.sent(),e.label=7;case 7:return n=t.next(),[3,5];case 8:return[3,11];case 9:return a=e.sent(),u={error:a},[3,11];case 10:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return e.sent(),this._mutex.unlock(),[2,i];case 13:throw o=e.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw this._transaction.clear(),N.collectionNotReady;case 16:return[2]}})})},$D.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw N.collectionNotReady;case 9:return[2]}})})},$D.prototype.getBlob=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(t)];case 1:return[2,e.sent()]}})})},$D.prototype.saveBlob=function(t,n){return void 0===n&&(n=null),re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.save(t,n)];case 1:return[2,e.sent()]}})})},$D.prototype.removeBlob=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(t)];case 1:return e.sent(),[2]}})})},$D.prototype.removeAllBlobs=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}})})},$D),VD={},BD=(Object.defineProperty(ZD.prototype,"rawData",{get:function(){return VD[this.dbname]},set:function(e){VD[this.dbname]=e},enumerable:!1,configurable:!0}),ZD.prototype.observe=function(t,e,n){var r=this;this.observer[t]={},e.forEach(function(e){return r.observer[t][e]=n})},ZD.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this.dbname=n,VD[this.dbname]={},e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get($_.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify($_.value))throw N.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set($_)];case 4:return e.sent(),[7];case 5:return[2]}})})},ZD.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,Object.keys(VD[this.dbname]).filter(function(e){return e!==$_.key})]})})},ZD.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,JR(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.get?t.get(n):null)throw t;return[2,VD[this.dbname][n]?this._encryption.decrypt(VD[this.dbname][n]):null]}})})},ZD.prototype.set=function(i){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return[4,JR(this.delay)];case 1:if(e.sent(),t=i.key,r=i.value,n=this.observer[t],n=n&&n.set?n.set(t):null)throw n;if(n=this._encryption.encrypt(r),r=JSON.stringify(n),t===$_.key||r.length<this.itemSizeLimit)return VD[this.dbname][t]=n,[2,VD[this.dbname][t]];throw N.storeItemSizeExceeded}})})},ZD.prototype.setMany=function(t){return re(this,void 0,void 0,function(){var i,s=this;return ie(this,function(e){switch(e.label){case 0:return[4,JR(this.delay)];case 1:return e.sent(),i=[],t.forEach(function(e){var t,n=e.key,e=e.value,r=s.observer[n];r&&r.set&&r.set(n)?i.push(N.collectionWriteFailed):(r=s._encryption.encrypt(e),t=JSON.stringify(r),n===$_.key||t.length<s.itemSizeLimit?(VD[s.dbname][n]=r,i.push(e)):i.push(N.storeItemSizeExceeded))}),[2,i]}})})},ZD.prototype.remove=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,JR(this.delay)];case 1:if(e.sent(),t=this.observer[n],t=t&&t.remove?t.remove(n):null)throw t;return VD[this.dbname][n]&&delete VD[this.dbname][n],[2,n]}})})},ZD.prototype.removeMany=function(u){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return ie(this,function(e){switch(e.label){case 0:return[4,JR(this.delay)];case 1:e.sent();try{for(t=se(u),n=t.next();!n.done;n=t.next()){if(r=n.value,i=this.observer[r],s=i&&i.remove?i.remove(r):null)throw s;VD[this.dbname][r]&&delete VD[this.dbname][r]}}catch(e){a={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}}return[2,u]}})})},ZD.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,JR(this.delay)];case 1:return e.sent(),VD[this.dbname]={},[2]}})})},ZD),KD=(JD.prototype.init=function(i){return re(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(e){switch(e.label){case 0:return this.dbname=i,[4,new Promise(function(e,t){var n;r._window&&AD?xD?((n=r._indexedDB.open("_testMozilla")).onerror=function(){return t(N.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}):FD?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(N.storeNotAvailableInPrivateBrowsing):e():t(N.storeNotAvailable)})];case 1:return e.sent(),t=this,[4,new Promise(function(t,n){var e=r._indexedDB.open(i);e.addEventListener("upgradeneeded",function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"})}),e.addEventListener("success",function(e){return t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 2:t._database=e.sent(),e.label=3;case 3:return e.trys.push([3,,5,7]),[4,this.get($_.key)];case 4:if((n=e.sent())&&JSON.stringify(n)!==JSON.stringify($_.value))throw N.storeEncryptionInvalid;return[3,7];case 5:return[4,this.set($_)];case 6:return e.sent(),[7];case 7:return[2]}})})},JD.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").getAllKeys();e.addEventListener("success",function(e){t(e.target.result.filter(function(e){return e!==$_.key}))}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},JD.prototype.get=function(i){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t,n){var e=r._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").get(i);e.addEventListener("success",function(e){return t(e.target.result?r._encryption.decrypt(e.target.result.value):null)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return[2,e.sent()]}})})},JD.prototype.set=function(t){return re(this,void 0,void 0,function(){var r,i,s=this;return ie(this,function(e){switch(e.label){case 0:return r=t.key,i=t.value,[4,new Promise(function(t,n){var e=s._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").put({key:r,value:s._encryption.encrypt(i)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(e){return n(e.target.error)})})];case 1:return e.sent(),[2,i]}})})},JD.prototype.setMany=function(n){return re(this,void 0,void 0,function(){var t,i,s=this;return ie(this,function(e){switch(e.label){case 0:return t=[],i=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),n.forEach(function(e){var n=e.key,r=e.value;t.push(new Promise(function(t){var e=i.put({key:n,value:s._encryption.encrypt(r)});e.addEventListener("success",function(e){t(e.target.result)}),e.addEventListener("error",function(){t(N.collectionWriteFailed)})}))}),[4,Promise.all(t)];case 1:return e.sent(),[2,n.map(function(e){return e.value})]}})})},JD.prototype.remove=function(i){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").delete(i);n.addEventListener("success",function(){return e(i)}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},JD.prototype.removeMany=function(t){return re(this,void 0,void 0,function(){var i;return ie(this,function(e){switch(e.label){case 0:return i=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),[4,Promise.all(t.map(function(r){return new Promise(function(e,t){var n=i.delete(r);n.addEventListener("success",function(){return e(r)}),n.addEventListener("error",function(e){return t(e.target.error)})})}))];case 1:return[2,e.sent()]}})})},JD.prototype.clear=function(){return re(this,void 0,void 0,function(){var r=this;return ie(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e,t){var n=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").clear();n.addEventListener("success",function(){return e()}),n.addEventListener("error",function(e){return t(e.target.error)})})];case 1:return[2,e.sent()]}})})},JD),QD=(XD.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},XD.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},XD.prototype.init=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:this.dbname=n,e.label=1;case 1:return e.trys.push([1,,3,5]),[4,this.get($_.key)];case 2:if((t=e.sent())&&JSON.stringify(t)!==JSON.stringify($_.value))throw N.storeEncryptionInvalid;return[3,5];case 3:return[4,this.set($_)];case 4:return e.sent(),[7];case 5:return[2]}})})},XD.prototype.getAllKeys=function(){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return t=this._getActualKey($_.key),[4,this._asyncStorage.getAllKeys()];case 1:return[2,e.sent().filter(function(e){return n._isBelonging(e)&&e!==t}).map(function(e){return e.substring("".concat(n.dbname,"/").length)})]}})})},XD.prototype.get=function(n){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(n))];case 1:return[2,(t=e.sent())?this._encryption.decrypt(JSON.parse(t)):null]}})})},XD.prototype.set=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=r.key,n=r.value,n=JSON.stringify(this._encryption.encrypt(n)),t===$_.key||n.length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),n)]:[3,2];case 1:return e.sent(),[2,JSON.parse(n)];case 2:throw N.storeItemSizeExceeded}})})},XD.prototype.setMany=function(h){return re(this,void 0,void 0,function(){var t,n,r,i,s,a,o,u,c,l;return ie(this,function(e){switch(e.label){case 0:t=[],n=[];try{for(r=se(h),i=r.next();!i.done;i=r.next()){s=i.value;try{a=s.key,o=s.value,u=JSON.stringify(this._encryption.encrypt(o)),a===$_.key||u.length<this.itemSizeLimit?(n.push([this._getActualKey(a),u]),t.push(o)):t.push(N.storeItemSizeExceeded)}catch(e){t.push(N.collectionWriteFailed)}}}catch(e){c={error:e}}finally{try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._asyncStorage.multiSet(n)];case 2:return e.sent(),[3,4];case 3:return e.sent(),[2,new Array(t.length).fill(N.collectionWriteFailed)];case 4:return[2,t]}})})},XD.prototype.remove=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.removeItem(this._getActualKey(t))];case 1:return e.sent(),[2,t]}})})},XD.prototype.removeMany=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._asyncStorage.multiRemove(n.map(function(e){return t._getActualKey(e)}))];case 1:return e.sent(),[2,n]}})})},XD.prototype.clear=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,this.getAllKeys()];case 1:return t=e.sent(),[4,this.removeMany(t)];case 2:return e.sent(),[4,this.remove($_.key)];case 3:return e.sent(),[2]}})})},XD),zD=!0,WD=(YD.off=function(){zD=!1},YD.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];zD&&console.log.apply(console,U_(["".concat("[NESTDB]","[LOG]")],L_(e),!1))},YD.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];zD&&console.warn.apply(console,U_(["".concat("[NESTDB]","[WARNING]")],L_(e),!1))},YD.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];zD&&console.error.apply(console,U_(["".concat("[NESTDB]","[ERROR]")],L_(e),!1))},YD);function YD(){}function XD(e){var t=e.AsyncStorage,e=e.encryption,e=void 0===e?ey:e;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=e}function JD(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;e=e.encryption,e=void 0===e?ey:e;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=e}function ZD(e){var t=(e=void 0===e?{}:e).itemSizeLimit,t=void 0===t?4194304:t,n=e.delay,n=void 0===n?1:n,e=e.encryption,e=void 0===e?ey:e;this._encryption=e,this.itemSizeLimit=t,this.delay=n,this.observer={}}function $D(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,e=e.store,a=this;this._state=zR.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=U_([[r]],L_(s.filter(function(e){return kD.createKey(e)!==a.keyName})),!1),this._keyHash=i,this._store=e,this._mutex=new HD("".concat(vD(t,n),".lock")),this._blobContainer=new _D({dbname:t,collectionName:n,store:e}),this._transaction=new wD({dbname:t,collectionName:n,store:e})}function eM(e,t){void 0===t&&(t={});var f=this;return this._state=LD.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],jD[e]&&!t.forceCreate||(this.nodeId=PD(),this.key=e,AD&&(!t.startAsInvisible&&"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&f.claimHost()}),window.addEventListener("message",function(e){var t,n,r=e.data,i=r.nodeId,s=r.requestId,a=r.key,o=r.op,u=r.data;if(i!==f.nodeId&&a===f.key)switch(o){case UD.NEWNODE:f._sendSync();break;case UD.CLAIM_HOST:f._sendSync(),f._hostId=i;break;case UD.SYNC_HOST:if(!f.isInSync){f._activationTimeout&&clearTimeout(f._activationTimeout);var c=u.currentItemRequestId,l=u.queue;try{for(var h=se(l),d=h.next();!d.done;d=h.next())!function(t){f._queue.findIndex(function(e){return e.requestId===t.requestId})<0&&f._requestLock({nodeId:t.nodeId,requestId:t.requestId,key:f.key,op:UD.REQUEST_LOCK,ts:t.ts})}(d.value)}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}f._currentItem=f._queue.find(function(e){return e.requestId===c}),f._completeSync()}break;case UD.REMOVENODE:f._queue=f._queue.filter(function(e){return e.nodeId!==r.nodeId}),f._currentItem&&f._currentItem.nodeId===r.nodeId&&(f._currentItem=null,f._acquire(f._queue[0]));break;case UD.REQUEST_LOCK:f._requestLock(r);break;case UD.ACQUIRE_LOCK:l=f._queue.find(function(e){return e.requestId===s});f._acquire(l);break;case UD.RELEASE_LOCK:f._release(s)}}),window.addEventListener("beforeunload",function(){f._send(UD.REMOVENODE)})),jD[e]=this),jD[e]}(In=qD=qD||{}).INIT="INIT",In.OPENING="OPENING",In.OPENED="OPENED",In.CLOSED="CLOSED";Object.defineProperty(iM.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(iM.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),iM.prototype.commitSchema=function(n){return re(this,void 0,void 0,function(){var t=this;return ie(this,function(e){switch(e.label){case 0:return this._state!==qD.OPENING?[3,2]:[4,Promise.all(n.map(function(i){return re(t,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return t=i.collectionName,n=i.keyName,r=i.index,r=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new GD({dbname:this.name,collectionName:t,keyName:n,keyHash:i.keyHash||null,indexes:r,store:this._store})),[4,this._collections.get(t).init()];case 1:return e.sent(),[2]}})})}))];case 1:return e.sent(),[3,3];case 2:throw N.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},iM.prototype.open=function(){var i;return re(this,void 0,void 0,function(){var o,n,u,r,c=this;return ie(this,function(e){switch(e.label){case 0:return[4,this._globalMutex.lock()];case 1:if(e.sent(),this._state===qD.OPENED)return[3,15];this._state=qD.OPENING,e.label=2;case 2:return e.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return e.sent(),t=this.name,o="".concat(pD(t),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(o)];case 4:return u=null!=(i=e.sent())?i:n,[2,new Promise(function(r,i){function s(r){u.version<c._version?c._event.upgrade(u.version,function(n){return re(c,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:if(n)return[3,5];u.version++,u.collectionNames=Array.from(this._collections.keys()),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._store.set({key:o,value:u,generation:this._version})];case 2:return e.sent(),r({continued:!0}),[3,4];case 3:return t=e.sent(),r({continued:!1,err:t}),[3,4];case 4:return[3,6];case 5:r({continued:!1,err:n}),e.label=6;case 6:return[2]}})})}):r({continued:!1})}function a(e){var t,n=e.continued,e=void 0===(e=e.err)?null:e;void 0!==n&&n?setTimeout(function(){return s(a)},10):e?(WD.error(e.message),c._globalMutex.unlock(),c._event.error(e),i(e)):(t=[],u.collectionNames.forEach(function(n){c._collections.has(n)||t.push(re(c,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return[4,GD.metadataOf(this.name,n,this._store)];case 1:return(t=e.sent())?(t=new GD({dbname:this.name,collectionName:n,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(n,t),[4,t.init()]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})}))}),Promise.all(t).then(function(){c._state=qD.OPENED,c._globalMutex.unlock(),c._event.success(),r()}).catch(function(e){WD.error(e.message),c._globalMutex.unlock(),c._event.error(e),i(e)}))}s(a)})];case 5:switch((r=e.sent()).code){case XO.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case XO.STORE_NOT_AVAILABLE:return[3,8];case XO.STORE_ENCRYPTION_INVALID:return[3,10]}return[3,13];case 6:return WD.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new BD({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 7:return e.sent(),[3,14];case 8:return WD.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new BD({}),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 9:return e.sent(),[3,14];case 10:return WD.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return e.sent(),this._globalMutex.unlock(),this._event.error(r),[4,this.open()];case 12:return e.sent(),[3,14];case 13:throw WD.error(r.message),this._globalMutex.unlock(),this._event.error(r),r;case 14:return[3,15];case 15:return[2]}var t})})},iM.prototype.close=function(){this._collections.forEach(function(e){return e.close()}),this._state=qD.CLOSED},iM.prototype.clear=function(){return re(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return e.sent(),[2]}})})},iM.prototype.reset=function(){return re(this,void 0,void 0,function(){var t,n=this;return ie(this,function(e){switch(e.label){case 0:return this.close(),(t=TD.get(this.name))&&t.clearByCondition(function(e){return e.key.startsWith(pD(n.name))}),[4,this._store.clear()];case 1:return e.sent(),[2]}})})},iM.prototype.on=function(e,t){this._event[e]=t},iM.prototype.off=function(e){"function"==typeof this._event[e]&&(this._event[e]="upgrade"===e?nD:$R)},iM.prototype.collection=function(e){return this._collections.get(e)||null};var tM=iM,nM=null,rM=(R.init=function(e){var t,n=e.appId,r=e.appVersion,r=void 0===r?null:r,i=e.modules,i=void 0===i?[]:i,s=e.options,s=void 0===s?new Z_:s,a=e.debugMode,a=void 0!==a&&a,o=e.customApiHost,u=e.customWebSocketHost,c=e.newInstance,l=e.logLevel,h=e.localCacheEnabled,h=void 0!==h&&h,d=e.localCacheEncryption,e=e.useAsyncStorageStore,e=void 0===e?null:e;return!nM||void 0!==c&&c?(c="su-".concat(K_()),t=new BD({encryption:d=null!=d?d:{encrypt:function(e){return e},decrypt:function(e){return e}}}),a||(t=e?new QD({AsyncStorage:e,encryption:d}):new KD({encryption:d})),new y(c,{appId:n,appVersion:r,options:s,apiHost:null!=o?o:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=u?u:"wss://ws-".concat(n,".sendbird.com"),store:t,encryption:d,logLevel:l,localCacheEnabled:h,debugMode:a}),e=new R(c,s,U_(U_([],L_(i),!1),[new Pb],!1)),nM=nM||e,e):nM},Object.defineProperty(R,"instance",{get:function(){return nM},enumerable:!1,configurable:!0}),Object.defineProperty(R,"version",{get:function(){return"4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appId",{get:function(){return y.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appInfo",{get:function(){return y.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"appVersion",{get:function(){var e;return null!=(e=y.of(this._iid).sdkState.appVersion)?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"debugMode",{get:function(){return y.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"logLevel",{get:function(){return y.of(this._iid).logger.level},set:function(e){y.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isCacheEnabled",{get:function(){return y.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"ekey",{get:function(){return tm(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"currentUser",{get:function(){var e;return null!=(e=y.of(this._iid).sessionManager.currentUser)?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"connectionState",{get:function(){var e=y.of(this._iid).connectionManager;return e.isConnected?ky.OPEN:e.isConnecting?ky.CONNECTING:ky.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"lastConnectedAt",{get:function(){var e=y.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),R.prototype._getPreferenceCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")},R.prototype._getUserProfileCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")},R.prototype.getMemoryStoreForDebugging=function(){var e=y.of(this._iid),t=e.debugMode,e=e.cacheContext;if(t)return e.store instanceof BD?e.store:null;throw p.debugModeRequired},R.prototype.addExtension=function(e,t){var n=y.of(this._iid).sdkState;-1<["sb_uikit","sb_syncmanager"].indexOf(e)&&(n.extensions[e]=t)},R.prototype.initializeCache=function(o){return re(this,void 0,void 0,function(){var t,r,i,s,a;return ie(this,function(e){switch(e.label){case 0:return i=y.of(this._iid),t=i.sdkState,r=i.cacheContext,s=i.connectionManager,i=i.dispatcher,t.userId&&t.userId===o?[3,6]:[4,s.logout()];case 1:return e.sent(),t.userId=o,r.localCacheEnabled?(s="sendbird@".concat(t.appId,"/").concat(o,".db"),r.nestdb&&r.nestdb.state!==qD.CLOSED&&r.nestdb.name===s?[3,3]:((a=r.nestdb=new tM({name:"sendbird@".concat(t.appId,"/").concat(o,".db"),version:1,store:r.store})).on("upgrade",(n=a,function(e,t){0===e?n.commitSchema([{collectionName:"GroupChannel",keyName:"url",index:[LA(PA.LATEST_LAST_MESSAGE),LA(PA.CHRONOLOGICAL),LA(PA.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:"Message",keyName:"messageId",index:[jA(UA.CHANNEL_LATEST),jA(UA.NEWEST_CHILD_MESSAGE)]},{collectionName:"UnsentMessage",keyName:"reqId",index:[jA(UA.CHANNEL_LATEST),jA(UA.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]).then(function(){return t()}).catch(function(e){return t(e)}):t()})),[4,a.open()])):[3,6];case 2:e.sent(),i.dispatch(new cN(this._iid,{userId:o})),e.label=3;case 3:return[4,r.preference.init(this._getPreferenceCacheKey(o))];case 4:return e.sent(),[4,r.preference.get(this._getUserProfileCacheKey(o))];case 5:(a=e.sent())&&new Zg(this._iid,a).apply(),e.label=6;case 6:return[2]}var n})})},R.prototype.clearCachedData=function(){return re(this,void 0,void 0,function(){var t;return ie(this,function(e){switch(e.label){case 0:return(t=y.of(this._iid).cacheContext).localCacheEnabled?(t.nestdb&&t.nestdb.clear(),[4,t.preference.clear()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.clearCachedMessages=function(t){return re(this,void 0,void 0,function(){var n,r,i=this;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",t)).throw(p.invalidParameters),n=WA.of(this._iid),r=QA.of(this._iid),n&&r?[4,Promise.all(t.map(function(t){return re(i,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,n.removeMessagesOfChannel(t)];case 1:return e.sent(),[4,r.removeMessagesOfChannel(t)];case 2:return e.sent(),[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.connect=function(a,o){return void 0===o&&(o=null),re(this,void 0,void 0,function(){var t,n,r,i,s;return ie(this,function(e){switch(e.label){case 0:i=y.of(this._iid),t=i.sdkState,n=i.cacheContext,r=i.connectionManager,i=i.statLogCollector,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.initializeCache(a)];case 2:return e.sent(),[3,4];case 3:return e.sent(),s=y.of(this._iid).logger,n.localCacheEnabled=!1,s.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return[4,i.init("sendbird@".concat(t.appId,"/").concat(a,".statlog"))];case 5:return e.sent(),[4,r.connect(o)];case 6:return e.sent(),this._appStateChangeDetector.start(),t.appState="foreground",[4,null==(s=JA.of(this._iid))?void 0:s.processNonAutoResendRegisteredPendingMessages()];case 7:return e.sent(),this._onlineDetector.start(),[2,this.currentUser]}})})},R.prototype.reconnect=function(){var e=y.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.sessionManager.auth.hasSession;return e&&t.resetAndReconnect().then(function(){n.appState="foreground"}).catch(function(){}),e},R.prototype.disconnect=function(){return re(this,void 0,void 0,function(){var t,n,r;return ie(this,function(e){switch(e.label){case 0:return r=y.of(this._iid),t=r.connectionManager,n=r.cacheContext,r=r.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return e.sent(),n.localCacheEnabled?[4,this.clearCachedData()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},R.prototype.setBackgroundState=function(){var e=y.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"foreground"===n.appState&&(n.appState="background",e.debug("going background state"),t.background())},R.prototype.setForegroundState=function(){var e=y.of(this._iid),t=e.connectionManager,n=e.sdkState,e=e.logger;"background"===n.appState&&(n.appState="foreground",e.debug("going foreground state"),t.resetAndReconnect())},R.prototype.setSessionHandler=function(e){h(!1).throw(p.invalidParameters),y.of(this._iid).sessionManager.handler=e},R.prototype.addUserEventHandler=function(e,t){h(l("string",e)&&!1).throw(p.invalidParameters),y.of(this._iid).userEventHandlers.set(e,t)},R.prototype.removeUserEventHandler=function(e){y.of(this._iid).userEventHandlers.delete(e)},R.prototype.removeAllUserEventHandler=function(){y.of(this._iid).userEventHandlers.clear()},R.prototype.addConnectionHandler=function(e,t){h(l("string",e)&&!1).throw(p.invalidParameters),y.of(this._iid).connectionHandlers.set(e,t)},R.prototype.removeConnectionHandler=function(e){y.of(this._iid).connectionHandlers.delete(e)},R.prototype.removeAllConnectionHandler=function(){y.of(this._iid).connectionHandlers.clear()},R.prototype.createApplicationUserListQuery=function(e){return new IR(this._iid,e=void 0===e?{}:e)},R.prototype.createBlockedUserListQuery=function(e){return new SR(this._iid,e=void 0===e?{}:e)},R.prototype.createFriendListQuery=function(e){return new AR(this._iid,e=void 0===e?{}:e)},R.prototype.createMessageSearchQuery=function(e){return new Db(this._iid,e)},R.prototype.buildUserFromSerializedData=function(e){e=Gg(e);return new _(this._iid,_.payloadify(e))},R.prototype.updateCurrentUserInfo=function(i){return void 0===i&&(i={}),re(this,void 0,void 0,function(){var n,r;return ie(this,function(e){switch(e.label){case 0:return i=f(f({},AN),i),h(V_((t=i).profileImage,!0)&&l("string",t.profileUrl,!0)&&l("string",t.nickname,!0)).throw(p.invalidParameters),this.currentUser?(n=y.of(this._iid),r=n.sdkState,n=n.requestQueue,r=new RN(f({userId:r.userId},i)),[4,n.send(r)]):[3,2];case 1:return n=e.sent(),r=n.as(DN).user,this.currentUser&&(i.nickname&&(this.currentUser.nickname=r.nickname),(i.profileUrl||i.profileImage)&&(this.currentUser.plainProfileUrl=r.profileUrl)),[2,r];case 2:throw p.connectionRequired}var t})})},R.prototype.updateCurrentUserInfoWithPreferredLanguages=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",r)).throw(p.invalidParameters),this.currentUser?(t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new RN({userId:n.userId,preferredLanguages:r}),[4,t.send(n)]):[3,2];case 1:return t=e.sent(),n=t.as(DN).user,this.currentUser&&(this.currentUser.preferredLanguages=n.preferredLanguages),[2,n];case 2:throw p.connectionRequired}})})},R.prototype.registerFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(h(l("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new HN({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,hA.SUCCESS];case 3:return e.sent(),[2,hA.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,hA.PENDING];case 6:return[2]}})})},R.prototype.unregisterFCMPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(h(l("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new YN({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,hA.SUCCESS];case 3:return e.sent(),[2,hA.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,hA.PENDING];case 6:return[2]}})})},R.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return this.currentUser?(t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new r1({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.registerAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(h(l("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new MN({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,hA.SUCCESS];case 3:return e.sent(),[2,hA.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,hA.PENDING];case 6:return[2]}})})},R.prototype.unregisterAPNSPushTokenForCurrentUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:if(h(l("string",r)).throw(p.invalidParameters),!this.currentUser)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new KN({userId:n.userId,token:r}),[4,t.send(n)];case 2:return e.sent(),this._fcmPushToken="",[2,hA.SUCCESS];case 3:return e.sent(),[2,hA.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=r,[2,hA.PENDING];case 6:return[2]}})})},R.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return this.currentUser?(t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new $N({userId:n.userId}),[4,t.send(n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},R.prototype.getChannelInvitationPreference=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new T1({userId:n.userId}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(w1).autoAccept}]}})})},R.prototype.setChannelInvitationPreference=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("boolean",r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new S1({userId:n.userId,willAutoAccept:r}),[4,t.send(n)];case 1:return[2,{autoAccept:e.sent().as(C1).autoAccept}]}})})},R.prototype.getDoNotDisturb=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new k1({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(A1).preference]}})})},R.prototype.setDoNotDisturb=function(r,i,s,a,o,u){return void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===u&&(u=""),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("boolean",r)&&l("number",i)&&l("number",s)&&l("number",a)&&l("number",o)&&l("string",u)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new N1({userId:n.userId,doNotDisturbOn:r,startHour:i,startMin:s,endHour:a,endMin:o,timezone:u}),[4,t.send(n)];case 1:return[2,e.sent().as(O1).preference]}})})},R.prototype.getSnoozePeriod=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new R1({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(D1).snoozePeriod]}})})},R.prototype.setSnoozePeriod=function(r,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("boolean",r)&&l("number",i)&&l("number",s)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new M1({userId:n.userId,snoozeOn:r,startTs:i,endTs:s}),[4,t.send(n)];case 1:return[2,e.sent().as(x1).snoozePeriod]}})})},R.prototype.getMyPushTokensByToken=function(r,i){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)&&X_(fA,i)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new b1({userId:n.userId,type:i,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(I1).pushTokens]}})})},R.prototype.getPushTriggerOption=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new hN({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(dN).pushTriggerOption]}})})},R.prototype.setPushTriggerOption=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(X_(dA,r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new fN({userId:n.userId,pushTriggerOption:r}),[4,t.send(n)];case 1:return[2,e.sent().as(pN).pushTriggerOption]}})})},R.prototype.getPushTemplate=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new hO({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(dO).name]}})})},R.prototype.setPushTemplate=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(X_(pA,r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new fO({userId:n.userId,templateName:r}),[4,t.send(n)];case 1:return[2,e.sent().as(pO).name]}})})},R.prototype.blockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(r instanceof _||l("string",r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new P1({userId:n.userId,blockedUserId:r instanceof _?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.blockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.blockUser(t)]})})},R.prototype.unblockUser=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(r instanceof _||l("string",r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new $1({userId:n.userId,unblockedUserId:r instanceof _?r.userId:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.unblockUserWithUserId=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.unblockUser(t)]})})},R.prototype.getFriendChangeLogsByToken=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("string",r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new vO({userId:n.userId,token:r}),[4,t.send(n)];case 1:return[2,e.sent().as(_O).changelogs]}})})},R.prototype.getAllowFriendDiscovery=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new VO({userId:n.userId}),[4,t.send(n)];case 1:return[2,e.sent().as(BO).allowFriendDiscovery]}})})},R.prototype.setAllowFriendDiscovery=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(l("boolean",r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new KO({userId:n.userId,allowFriendDiscovery:r}),[4,t.send(n)];case 1:return e.sent(),[2,r]}})})},R.prototype.uploadFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new yO({userId:n.userId,discoveries:r}),[4,t.send(n)];case 1:return[2,e.sent().as(mO).friendDiscoveryRequestId]}})})},R.prototype.deleteFriendDiscovery=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.deleteFriendDiscoveries([t])]})})},R.prototype.deleteFriendDiscoveries=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new gO({userId:n.userId,discoveryKeys:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.addFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new MO({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return[2,e.sent().as(xO).users]}})})},R.prototype.deleteFriend=function(t){return re(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.deleteFriends([t])]})})},R.prototype.deleteFriends=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return h(J_("string",r)).throw(p.invalidParameters),t=y.of(this._iid),n=t.sdkState,t=t.requestQueue,n=new PO({userId:n.userId,userIds:r}),[4,t.send(n)];case 1:return e.sent(),[2]}})})},R.prototype.getAllEmoji=function(){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new pR,[4,t.send(n)];case 1:return[2,e.sent().as(vR).emojiContainer]}})})},R.prototype.getEmojiCategory=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new _R({categoryId:r}),[4,t.send(n)];case 1:return[2,e.sent().as(yR).emojiCategory]}})})},R.prototype.getEmoji=function(r){return re(this,void 0,void 0,function(){var t,n;return ie(this,function(e){switch(e.label){case 0:return t=y.of(this._iid).requestQueue,n=new mR({key:r}),[4,t.send(n)];case 1:return[2,e.sent().as(gR).emoji]}})})},R);function R(a,e,t){var o=this,e=(this._fcmPushToken=null,this._apnsPushToken=null,this._iid=a,this.options=e,y.of(a)),u=e.sdkState,c=e.cacheContext,n=e.dispatcher,r=e.sessionManager,i=e.requestQueue,s=e.logger,l=e.userEventHandlers;this._onlineDetector=new ON({logger:s,connectionDelegate:{reconnect:function(){var e=y.of(a),t=e.sdkState,e=e.connectionManager;"foreground"===t.appState&&e.resetAndReconnect()},disconnect:function(){y.of(a).connectionManager.disconnect()}}}),new JA(a,{localCacheEnabled:c.localCacheEnabled,dispatcher:n,sdkState:u,logger:s}),t.forEach(function(e){e.init(a,{sdkState:u,cacheContext:c,dispatcher:n,sessionManager:r,requestQueue:i,logger:s,onlineDetector:o._onlineDetector}),o[e.name]=e}),this._appStateChangeDetector=new NN,this._appStateChangeDetector.on("resume",function(){s.debug("the page resumes from freeze"),o.setForegroundState()}).on("pause",function(){s.debug("the page freezes"),o.setBackgroundState()}),n.on(function(e){var t;if(e instanceof My)"USEV"===e.code&&(i=e.as(lN).event).category===HA.FRIEND_DISCOVERED&&(t=uN.getDataAsFriendDiscoveredEvent(a,i).friendDiscoveries,ae(function(){return re(o,void 0,void 0,function(){return ie(this,function(e){return[2,l.forEach(function(e){e.onFriendsDiscovered(t)})]})})}));else if(e instanceof Wy){var n=y.of(o._iid).subscribedUnreadMessageCount,r=!1,i=e.ts;if("number"==typeof i&&i>n.ts){if(n.all!==e.all&&(r=!0),n.all=0<=e.all?e.all:0,e.customTypes)for(var s in e.customTypes)n.customTypes[s]!==e.customTypes[s]&&(r=!0),n.customTypes[s]=e.customTypes[s];r=r&&0<n.ts,n.ts=i}r&&ae(function(){return re(o,void 0,void 0,function(){return ie(this,function(e){return[2,l.forEach(function(e){e.onTotalUnreadMessageCountUpdated(n.all,n.customTypes)})]})})})}else e instanceof Jg&&c.localCacheEnabled&&c.preference.set(o._getUserProfileCacheKey(u.userId),Zg.payloadify(e.userProfile))})}function iM(e){var t=e.name,n=e.version,r=e.store,e=e.config;this.name=t,this._version=n,this._state=qD.INIT,this._config=e||new OR({dbname:t}),this._store=r,this._event={success:$R,error:$R,upgrade:nD},this._collections=new Map,this._globalMutex=new HD("".concat(this.name,".lock")),this._config.disableLogger&&WD.off(),new TD({dbname:t,limit:this._config.cacheLimit})}pa=new(function(){function e(){E(this,e),I(this,"_ctx",{})}var t,n,r,i;return b(e,[{key:"init",value:function(e){var t=e.appId,e=e.chatInstance;this._ctx.sb=e||rM.init({appId:t,modules:[new mk]}),this._consoleLogListener=new xA(yl.NONE),C.addListener(this._consoleLogListener),this._ctx.appId=t,this._ctx.clientId=oe(),this._ctx.commandRouter=new EA(this._ctx),this._ctx.deviceManager=new vA,this._ctx.liveEventManager=new Ak(this._ctx)}},{key:"setLoggerLevel",value:function(e){return this._consoleLogListener.setLoggerLevel(e)}},{key:"authenticate",value:(i=g(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.commandRouter.authenticate({userId:t,accessToken:n});case 2:return e.next=4,this._ctx.commandRouter.connectWs();case 4:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"deauthenticate",value:(r=g(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.sb.disconnect();case 2:this._ctx.commandRouter.deauthenticate(),this._ctx.liveEventManager.clear(),C.removeAllListener();case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"createLiveEvent",value:(n=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.liveEventManager.createLiveEvent(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getLiveEvent",value:(t=g(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.liveEventManager.getLiveEvent(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"createLiveEventListQuery",value:function(e){return new Ll(e,this._ctx.commandRouter,this._ctx.liveEventManager)}},{key:"useMedia",value:function(e){return this._ctx.deviceManager.useMedia(e)}},{key:"getCurrentAudioInputDevice",value:function(){return this._ctx.deviceManager.getCurrentAudioInputDevice()}},{key:"getAvailableAudioInputDevices",value:function(){return this._ctx.deviceManager.getAvailableAudioInputDevices()}},{key:"selectAudioInput",value:function(e){return this._ctx.deviceManager.selectDevice("audioinput",e)}},{key:"getCurrentVideoInputDevice",value:function(){return this._ctx.deviceManager.getCurrentVideoInputDevice()}},{key:"getAvailableVideoInputDevices",value:function(){return this._ctx.deviceManager.getAvailableVideoInputDevices()}},{key:"selectVideoInput",value:function(e){return this._ctx.deviceManager.selectDevice("videoinput",e)}}]),e}());D.LiveEvent=x_,D.SendbirdLive=pa,Object.defineProperty(D,"__esModule",{value:!0})});