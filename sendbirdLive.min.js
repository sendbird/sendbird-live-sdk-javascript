(function(g,f){typeof exports==='object'&&typeof module!=='undefined'?f(exports):typeof define==='function'&&define.amd?define(['exports'],f):(g=typeof globalThis!=='undefined'?globalThis:g||self,f(g.sendbirdLive={}));})(this,(function(exports){'use strict';function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}// Unique ID creation requires a high quality random # generator. In the browser we therefore
// require the crypto API and do not support built-in fallback to lower quality random number
// generators (like Math.random()).
var getRandomValues;
var rnds8 = new Uint8Array(16);
function rng() {
  // lazy load so that environments that need to polyfill have a chance to do so
  if (!getRandomValues) {
    // getRandomValues needs to be invoked in a context where "this" is a Crypto implementation. Also,
    // find the complete implementation of crypto (msCrypto) on IE11.
    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);

    if (!getRandomValues) {
      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');
    }
  }

  return getRandomValues(rnds8);
}var REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(uuid) {
  return typeof uuid === 'string' && REGEX.test(uuid);
}/**
 * Convert array of 16 byte values to UUID string format of the form:
 * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
 */

var byteToHex = [];

for (var i$1 = 0; i$1 < 256; ++i$1) {
  byteToHex.push((i$1 + 0x100).toString(16).substr(1));
}

function stringify(arr) {
  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  // Note: Be careful editing this code!  It's been tuned for performance
  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434
  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one
  // of the following:
  // - One or more input array values don't map to a hex octet (leading to
  // "undefined" in the uuid)
  // - Invalid input values for the RFC `version` or `variant` fields

  if (!validate(uuid)) {
    throw TypeError('Stringified UUID is invalid');
  }

  return uuid;
}function parse(uuid) {
  if (!validate(uuid)) {
    throw TypeError('Invalid UUID');
  }

  var v;
  var arr = new Uint8Array(16); // Parse ########-....-....-....-............

  arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;
  arr[1] = v >>> 16 & 0xff;
  arr[2] = v >>> 8 & 0xff;
  arr[3] = v & 0xff; // Parse ........-####-....-....-............

  arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;
  arr[5] = v & 0xff; // Parse ........-....-####-....-............

  arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;
  arr[7] = v & 0xff; // Parse ........-....-....-####-............

  arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;
  arr[9] = v & 0xff; // Parse ........-....-....-....-############
  // (Use "/" to avoid 32-bit truncation when bit-shifting high-order bytes)

  arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;
  arr[11] = v / 0x100000000 & 0xff;
  arr[12] = v >>> 24 & 0xff;
  arr[13] = v >>> 16 & 0xff;
  arr[14] = v >>> 8 & 0xff;
  arr[15] = v & 0xff;
  return arr;
}function stringToBytes(str) {
  str = unescape(encodeURIComponent(str)); // UTF8 escape

  var bytes = [];

  for (var i = 0; i < str.length; ++i) {
    bytes.push(str.charCodeAt(i));
  }

  return bytes;
}

var DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';
var URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';
function v35 (name, version, hashfunc) {
  function generateUUID(value, namespace, buf, offset) {
    if (typeof value === 'string') {
      value = stringToBytes(value);
    }

    if (typeof namespace === 'string') {
      namespace = parse(namespace);
    }

    if (namespace.length !== 16) {
      throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');
    } // Compute hash of namespace and value, Per 4.3
    // Future: Use spread syntax when supported on all platforms, e.g. `bytes =
    // hashfunc([...namespace, ... value])`


    var bytes = new Uint8Array(16 + value.length);
    bytes.set(namespace);
    bytes.set(value, namespace.length);
    bytes = hashfunc(bytes);
    bytes[6] = bytes[6] & 0x0f | version;
    bytes[8] = bytes[8] & 0x3f | 0x80;

    if (buf) {
      offset = offset || 0;

      for (var i = 0; i < 16; ++i) {
        buf[offset + i] = bytes[i];
      }

      return buf;
    }

    return stringify(bytes);
  } // Function#name is not settable on some platforms (#270)


  try {
    generateUUID.name = name; // eslint-disable-next-line no-empty
  } catch (err) {} // For CommonJS default export support


  generateUUID.DNS = DNS;
  generateUUID.URL = URL;
  return generateUUID;
}/*
 * Browser-compatible JavaScript MD5
 *
 * Modification of JavaScript MD5
 * https://github.com/blueimp/JavaScript-MD5
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 *
 * Based on
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */
function md5(bytes) {
  if (typeof bytes === 'string') {
    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape

    bytes = new Uint8Array(msg.length);

    for (var i = 0; i < msg.length; ++i) {
      bytes[i] = msg.charCodeAt(i);
    }
  }

  return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes), bytes.length * 8));
}
/*
 * Convert an array of little-endian words to an array of bytes
 */


function md5ToHexEncodedArray(input) {
  var output = [];
  var length32 = input.length * 32;
  var hexTab = '0123456789abcdef';

  for (var i = 0; i < length32; i += 8) {
    var x = input[i >> 5] >>> i % 32 & 0xff;
    var hex = parseInt(hexTab.charAt(x >>> 4 & 0x0f) + hexTab.charAt(x & 0x0f), 16);
    output.push(hex);
  }

  return output;
}
/**
 * Calculate output length with padding and bit length
 */


function getOutputLength(inputLength8) {
  return (inputLength8 + 64 >>> 9 << 4) + 14 + 1;
}
/*
 * Calculate the MD5 of an array of little-endian words, and a bit length.
 */


function wordsToMd5(x, len) {
  /* append padding */
  x[len >> 5] |= 0x80 << len % 32;
  x[getOutputLength(len) - 1] = len;
  var a = 1732584193;
  var b = -271733879;
  var c = -1732584194;
  var d = 271733878;

  for (var i = 0; i < x.length; i += 16) {
    var olda = a;
    var oldb = b;
    var oldc = c;
    var oldd = d;
    a = md5ff(a, b, c, d, x[i], 7, -680876936);
    d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);
    c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);
    b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);
    a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);
    d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);
    c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);
    b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);
    a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);
    d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);
    c = md5ff(c, d, a, b, x[i + 10], 17, -42063);
    b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);
    a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);
    d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);
    c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);
    b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);
    a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);
    d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);
    c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);
    b = md5gg(b, c, d, a, x[i], 20, -373897302);
    a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);
    d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);
    c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);
    b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);
    a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);
    d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);
    c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);
    b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);
    a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);
    d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);
    c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);
    b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);
    a = md5hh(a, b, c, d, x[i + 5], 4, -378558);
    d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);
    c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);
    b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);
    a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);
    d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);
    c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);
    b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);
    a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);
    d = md5hh(d, a, b, c, x[i], 11, -358537222);
    c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);
    b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);
    a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);
    d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);
    c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);
    b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);
    a = md5ii(a, b, c, d, x[i], 6, -198630844);
    d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);
    c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);
    b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);
    a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);
    d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);
    c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);
    b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);
    a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);
    d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);
    c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);
    b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);
    a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);
    d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);
    c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);
    b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);
    a = safeAdd(a, olda);
    b = safeAdd(b, oldb);
    c = safeAdd(c, oldc);
    d = safeAdd(d, oldd);
  }

  return [a, b, c, d];
}
/*
 * Convert an array bytes to an array of little-endian words
 * Characters >255 have their high-byte silently ignored.
 */


function bytesToWords(input) {
  if (input.length === 0) {
    return [];
  }

  var length8 = input.length * 8;
  var output = new Uint32Array(getOutputLength(length8));

  for (var i = 0; i < length8; i += 8) {
    output[i >> 5] |= (input[i / 8] & 0xff) << i % 32;
  }

  return output;
}
/*
 * Add integers, wrapping at 2^32. This uses 16-bit operations internally
 * to work around bugs in some JS interpreters.
 */


function safeAdd(x, y) {
  var lsw = (x & 0xffff) + (y & 0xffff);
  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
  return msw << 16 | lsw & 0xffff;
}
/*
 * Bitwise rotate a 32-bit number to the left.
 */


function bitRotateLeft(num, cnt) {
  return num << cnt | num >>> 32 - cnt;
}
/*
 * These functions implement the four basic operations the algorithm uses.
 */


function md5cmn(q, a, b, x, s, t) {
  return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b);
}

function md5ff(a, b, c, d, x, s, t) {
  return md5cmn(b & c | ~b & d, a, b, x, s, t);
}

function md5gg(a, b, c, d, x, s, t) {
  return md5cmn(b & d | c & ~d, a, b, x, s, t);
}

function md5hh(a, b, c, d, x, s, t) {
  return md5cmn(b ^ c ^ d, a, b, x, s, t);
}

function md5ii(a, b, c, d, x, s, t) {
  return md5cmn(c ^ (b | ~d), a, b, x, s, t);
}v35('v3', 0x30, md5);function v4(options, buf, offset) {
  options = options || {};
  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`

  rnds[6] = rnds[6] & 0x0f | 0x40;
  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided

  if (buf) {
    offset = offset || 0;

    for (var i = 0; i < 16; ++i) {
      buf[offset + i] = rnds[i];
    }

    return buf;
  }

  return stringify(rnds);
}// Adapted from Chris Veness' SHA1 code at
// http://www.movable-type.co.uk/scripts/sha1.html
function f$1(s, x, y, z) {
  switch (s) {
    case 0:
      return x & y ^ ~x & z;

    case 1:
      return x ^ y ^ z;

    case 2:
      return x & y ^ x & z ^ y & z;

    case 3:
      return x ^ y ^ z;
  }
}

function ROTL(x, n) {
  return x << n | x >>> 32 - n;
}

function sha1(bytes) {
  var K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];
  var H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];

  if (typeof bytes === 'string') {
    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape

    bytes = [];

    for (var i = 0; i < msg.length; ++i) {
      bytes.push(msg.charCodeAt(i));
    }
  } else if (!Array.isArray(bytes)) {
    // Convert Array-like to Array
    bytes = Array.prototype.slice.call(bytes);
  }

  bytes.push(0x80);
  var l = bytes.length / 4 + 2;
  var N = Math.ceil(l / 16);
  var M = new Array(N);

  for (var _i = 0; _i < N; ++_i) {
    var arr = new Uint32Array(16);

    for (var j = 0; j < 16; ++j) {
      arr[j] = bytes[_i * 64 + j * 4] << 24 | bytes[_i * 64 + j * 4 + 1] << 16 | bytes[_i * 64 + j * 4 + 2] << 8 | bytes[_i * 64 + j * 4 + 3];
    }

    M[_i] = arr;
  }

  M[N - 1][14] = (bytes.length - 1) * 8 / Math.pow(2, 32);
  M[N - 1][14] = Math.floor(M[N - 1][14]);
  M[N - 1][15] = (bytes.length - 1) * 8 & 0xffffffff;

  for (var _i2 = 0; _i2 < N; ++_i2) {
    var W = new Uint32Array(80);

    for (var t = 0; t < 16; ++t) {
      W[t] = M[_i2][t];
    }

    for (var _t = 16; _t < 80; ++_t) {
      W[_t] = ROTL(W[_t - 3] ^ W[_t - 8] ^ W[_t - 14] ^ W[_t - 16], 1);
    }

    var a = H[0];
    var b = H[1];
    var c = H[2];
    var d = H[3];
    var e = H[4];

    for (var _t2 = 0; _t2 < 80; ++_t2) {
      var s = Math.floor(_t2 / 20);
      var T = ROTL(a, 5) + f$1(s, b, c, d) + e + K[s] + W[_t2] >>> 0;
      e = d;
      d = c;
      c = ROTL(b, 30) >>> 0;
      b = a;
      a = T;
    }

    H[0] = H[0] + a >>> 0;
    H[1] = H[1] + b >>> 0;
    H[2] = H[2] + c >>> 0;
    H[3] = H[3] + d >>> 0;
    H[4] = H[4] + e >>> 0;
  }

  return [H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff, H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff, H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff, H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff, H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff];
}v35('v5', 0x50, sha1);class Command {}/**
 * @interface
 * Api Option
 */

class APICommand extends Command {
  constructor() {
    super();
  }

  getApiOption() {
    return {
      auth: this.getAuth(),
      path: this.getPath(),
      method: this.getMethod(),
      body: this.getData(),
      headers: this.getHeaders()
    };
  }

  getAuth() {
    return true;
  }

  getHeaders() {
    return {};
  }

}class LiveEventAPICommand extends APICommand {
  constructor() {
    super();
  }

  getPath() {
    return `/v1${this.getSubPath()}`;
  }

}let LiveEventDataType;

(function (LiveEventDataType) {
  LiveEventDataType["CREATE"] = "create";
  LiveEventDataType["GET"] = "get";
  LiveEventDataType["DELETE"] = "delete";
  LiveEventDataType["QUERY"] = "query";
  LiveEventDataType["READY"] = "ready";
  LiveEventDataType["START"] = "start";
  LiveEventDataType["ENTER_HOST"] = "enter_host";
  LiveEventDataType["GET_HOSTS"] = "get_hosts";
  LiveEventDataType["EXIT_HOST"] = "exit_host";
  LiveEventDataType["HOST_ALIVE"] = "host_alive";
  LiveEventDataType["AUDIO"] = "audio";
  LiveEventDataType["VIDEO"] = "video";
  LiveEventDataType["HOST_CREATE_STREAM"] = "host_create_stream";
  LiveEventDataType["HOST_DELETE_STREAM"] = "host_delete_stream";
  LiveEventDataType["HOST_CONNECTED"] = "host_connected";
  LiveEventDataType["ENTER"] = "enter";
  LiveEventDataType["EXIT"] = "exit";
  LiveEventDataType["ALIVE"] = "alive";
  LiveEventDataType["GET_PARTICIPANTS"] = "get_participants";
  LiveEventDataType["CREATE_STREAM"] = "create_stream";
  LiveEventDataType["DELETE_STREAM"] = "delete_stream";
  LiveEventDataType["CONNECTED"] = "connected";
  LiveEventDataType["ATTACH"] = "attach";
  LiveEventDataType["LIVE_EVENT_READY"] = "live_event_ready";
  LiveEventDataType["LIVE_EVENT_STARTED"] = "live_event_started";
  LiveEventDataType["LIVE_EVENT_ENDED"] = "live_event_ended";
  LiveEventDataType["HOST_ENTERED"] = "host_entered";
  LiveEventDataType["HOST_EXITED"] = "host_exited";
  LiveEventDataType["HOST_DISCONNECTED"] = "host_disconnected";
  LiveEventDataType["HOST_AUDIO_STATUS_CHANGED"] = "host_audio_status_changed";
  LiveEventDataType["HOST_VIDEO_STATUS_CHANGED"] = "host_video_status_changed";
  LiveEventDataType["PARTICIPANT_ENTERED"] = "participant_entered";
  LiveEventDataType["PARTICIPANT_EXITED"] = "participant_exited";
})(LiveEventDataType || (LiveEventDataType = {}));

let HostType;
/**
 * A class that provides media options that can be set when establishing a media stream for a live event.
 */

(function (HostType) {
  HostType["SINGLE_HOST"] = "single_host";
  HostType["MULTIPLE_HOST"] = "multiple_host";
})(HostType || (HostType = {}));class ResponseCommand extends Command {
  constructor(json) {
    super();
    this.payload = this.parseData(json);
  } // TODO: Revisit


}class LiveEventResponseCommand extends ResponseCommand {}function parseLiveEvent(data) {
  return {
    liveEventId: data.live_event_id,
    // hostType: data.host_type,
    createdAt: data.created_at,
    setReadyAt: data.set_ready_at,
    startedAt: data.started_at,
    endedAt: data.ended_at,
    state: data.state,
    isHostStreaming: data.is_host_streaming,
    createdBy: data.created_by,
    setReadyBy: data.set_ready_by,
    startedBy: data.started_by,
    endedBy: data.ended_by,
    duration: data.duration,
    host: data.host ? parseHost(data.host) : undefined,
    participantCount: data.participantCount,
    peakParticipantCount: data.peak_participant_count,
    cumulativeParticipantCount: data.cumulative_participant_count,
    userIdsForHost: data.user_ids_for_host,
    customItems: data.custom_items
  };
}
function parseHost(data) {
  return {
    hostId: data.host_id,
    userId: data.user.user_id,
    nickname: data.user.nickname,
    profileURL: data.user.profile_url,
    enteredAt: data.entered_at,
    connectedAt: data.connected_at,
    disconnectedAt: data.disconnected_at,
    exitedAt: data.exited_at,
    duration: data.duration,
    state: data.state,
    isAudioOn: data.is_audio_on,
    isVideoOn: data.is_video_on,
    liveEventId: data.live_event_id
  };
}
function parseEndpoint(data) {
  return {
    id: data.rtcstream_id
  };
}
function parseParticipant(data) {
  return {
    participantId: data.participant_id,
    userId: data.user.user_id,
    nickname: data.user.nickname,
    profileURL: data.user.profile_url,
    enteredAt: data.entered_at,
    exitedAt: data.exited_at,
    duration: data.duration,
    state: data.state,
    liveEventId: data.live_event_id
  };
}function createQuery(params) {
  return Object.keys(params).filter(k => params[k] != null).map(k => `${encodeURIComponent(k)}=${toQueryParam(params[k])}`).join('&');
}
function toQueryParam(v) {
  if (Array.isArray(v)) {
    return v.map(item => encodeURIComponent(item.toString())).join(',');
  }

  return encodeURIComponent(v.toString());
}class LiveEventListQueryCommand extends LiveEventAPICommand {
  constructor(params, prevToken, nextToken) {
    super();

    _defineProperty(this, "type", LiveEventDataType.QUERY);

    this.params = this._normalizeParams(params);
    this.prevToken = prevToken;
    this.nextToken = nextToken;
  }

  getData() {
    return undefined;
  }

  getSubPath() {
    return `/live-events?${this._createQuery()}`;
  }

  getMethod() {
    return 'GET';
  }

  _normalizeParams(_ref) {
    let {
      hostType,
      liveEventState,
      createdAtRange,
      participantCountRange,
      durationRange,
      liveEventIds,
      createdByUserIds,
      limit
    } = _ref;
    const normalized = {
      hostType,
      liveEventState,
      createdAtRange,
      participantCountRange,
      durationRange,
      liveEventIds,
      createdByUserIds,
      limit: limit != null ? Math.min(Math.max(1, limit), 100) : undefined
    };
    return normalized;
  }

  _createQuery() {
    return createQuery({
      hostType: this.params.hostType,
      liveEventState: this.params.liveEventState,
      created_at_start_date: this.params.createdAtRange?.[0],
      created_at_end_date: this.params.createdAtRange?.[0],
      participant_count_gte: this.params.participantCountRange?.[0],
      participant_count_lte: this.params.participantCountRange?.[1],
      duration_range_gte: this.params.durationRange?.[0],
      duration_range_lte: this.params.durationRange?.[1],
      liveEventIds: this.params.liveEventIds,
      createdByUserIds: this.params.createdByUserIds,
      limit: this.params.limit,
      prev: this.prevToken,
      next: this.nextToken
    });
  }

}
class LiveEventListQueryResponseCommand extends LiveEventResponseCommand {
  // override payload: LiveEventListQueryResponsePayload;
  parseData(data) {
    return {
      liveEvents: data.live_events?.map(parseLiveEvent),
      prev: data.prev,
      next: data.next
    };
  }

}/**
 * A query class that provides queries used to retrieve a list of live events.
 */
class LiveEventListQuery {
  constructor(params, sender) {
    this.isLoading = false;
    this.params = params;
    this.sender = sender;
    this.prevToken = null;
    this.nextToken = null;
  }

  get hasPrev() {
    return !!this.prevToken;
  }

  get hasNext() {
    return !this.prevToken && !this.nextToken || !!this.nextToken;
  }

  async next() {
    if (this.isLoading) {
      // FIXME :: define error
      // throw new ClientError(ErrorCode.ERR_QUERY_IN_PROGRESS);
      throw new Error('query is in progress');
    }

    if (!this.hasNext) {
      return [];
    }

    return this._sendQueryCommand(null, this.nextToken);
  }

  async prev() {
    if (this.isLoading) {
      // FIXME :: define error
      // throw new ClientError(ErrorCode.ERR_QUERY_IN_PROGRESS);
      throw new Error('query is in progress');
    }

    if (!this.hasPrev) {
      return [];
    }

    return this._sendQueryCommand(this.prevToken, null);
  }

  async _sendQueryCommand(prevToken, nextToken) {
    if (!!prevToken && !!nextToken) {
      throw new Error('internal error while creating LiveEventListQueryCommand');
    }

    const command = new LiveEventListQueryCommand(this.params, prevToken, nextToken);
    const res = await this.sender.send(command);
    const {
      payload
    } = res;
    this.isLoading = true;
    this.prevToken = payload.prev;
    this.nextToken = payload.next;
    this.isLoading = false;
    return payload.liveEvents;
  }

}var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};var check = function (it) {
  return it && it.Math == Math && it;
};

// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
var global$a =
  // eslint-disable-next-line es-x/no-global-this -- safe
  check(typeof globalThis == 'object' && globalThis) ||
  check(typeof window == 'object' && window) ||
  // eslint-disable-next-line no-restricted-globals -- safe
  check(typeof self == 'object' && self) ||
  check(typeof commonjsGlobal == 'object' && commonjsGlobal) ||
  // eslint-disable-next-line no-new-func -- fallback
  (function () { return this; })() || Function('return this')();var objectGetOwnPropertyDescriptor = {};var fails$9 = function (exec) {
  try {
    return !!exec();
  } catch (error) {
    return true;
  }
};var fails$8 = fails$9;

// Detect IE8's incomplete defineProperty implementation
var descriptors = !fails$8(function () {
  // eslint-disable-next-line es-x/no-object-defineproperty -- required for testing
  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;
});var fails$7 = fails$9;

var functionBindNative = !fails$7(function () {
  // eslint-disable-next-line es-x/no-function-prototype-bind -- safe
  var test = (function () { /* empty */ }).bind();
  // eslint-disable-next-line no-prototype-builtins -- safe
  return typeof test != 'function' || test.hasOwnProperty('prototype');
});var NATIVE_BIND$1 = functionBindNative;

var call$4 = Function.prototype.call;

var functionCall = NATIVE_BIND$1 ? call$4.bind(call$4) : function () {
  return call$4.apply(call$4, arguments);
};var objectPropertyIsEnumerable = {};var $propertyIsEnumerable = {}.propertyIsEnumerable;
// eslint-disable-next-line es-x/no-object-getownpropertydescriptor -- safe
var getOwnPropertyDescriptor$1 = Object.getOwnPropertyDescriptor;

// Nashorn ~ JDK8 bug
var NASHORN_BUG = getOwnPropertyDescriptor$1 && !$propertyIsEnumerable.call({ 1: 2 }, 1);

// `Object.prototype.propertyIsEnumerable` method implementation
// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable
objectPropertyIsEnumerable.f = NASHORN_BUG ? function propertyIsEnumerable(V) {
  var descriptor = getOwnPropertyDescriptor$1(this, V);
  return !!descriptor && descriptor.enumerable;
} : $propertyIsEnumerable;var createPropertyDescriptor$2 = function (bitmap, value) {
  return {
    enumerable: !(bitmap & 1),
    configurable: !(bitmap & 2),
    writable: !(bitmap & 4),
    value: value
  };
};var NATIVE_BIND = functionBindNative;

var FunctionPrototype$1 = Function.prototype;
var bind = FunctionPrototype$1.bind;
var call$3 = FunctionPrototype$1.call;
var uncurryThis$9 = NATIVE_BIND && bind.bind(call$3, call$3);

var functionUncurryThis = NATIVE_BIND ? function (fn) {
  return fn && uncurryThis$9(fn);
} : function (fn) {
  return fn && function () {
    return call$3.apply(fn, arguments);
  };
};var uncurryThis$8 = functionUncurryThis;

var toString$1 = uncurryThis$8({}.toString);
var stringSlice = uncurryThis$8(''.slice);

var classofRaw = function (it) {
  return stringSlice(toString$1(it), 8, -1);
};var uncurryThis$7 = functionUncurryThis;
var fails$6 = fails$9;
var classof = classofRaw;

var $Object$2 = Object;
var split = uncurryThis$7(''.split);

// fallback for non-array-like ES3 and non-enumerable old V8 strings
var indexedObject = fails$6(function () {
  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346
  // eslint-disable-next-line no-prototype-builtins -- safe
  return !$Object$2('z').propertyIsEnumerable(0);
}) ? function (it) {
  return classof(it) == 'String' ? split(it, '') : $Object$2(it);
} : $Object$2;var $TypeError$5 = TypeError;

// `RequireObjectCoercible` abstract operation
// https://tc39.es/ecma262/#sec-requireobjectcoercible
var requireObjectCoercible$2 = function (it) {
  if (it == undefined) throw $TypeError$5("Can't call method on " + it);
  return it;
};// toObject with fallback for non-array-like ES3 strings
var IndexedObject = indexedObject;
var requireObjectCoercible$1 = requireObjectCoercible$2;

var toIndexedObject$4 = function (it) {
  return IndexedObject(requireObjectCoercible$1(it));
};// `IsCallable` abstract operation
// https://tc39.es/ecma262/#sec-iscallable
var isCallable$a = function (argument) {
  return typeof argument == 'function';
};var isCallable$9 = isCallable$a;

var isObject$5 = function (it) {
  return typeof it == 'object' ? it !== null : isCallable$9(it);
};var global$9 = global$a;
var isCallable$8 = isCallable$a;

var aFunction = function (argument) {
  return isCallable$8(argument) ? argument : undefined;
};

var getBuiltIn$4 = function (namespace, method) {
  return arguments.length < 2 ? aFunction(global$9[namespace]) : global$9[namespace] && global$9[namespace][method];
};var uncurryThis$6 = functionUncurryThis;

var objectIsPrototypeOf = uncurryThis$6({}.isPrototypeOf);var getBuiltIn$3 = getBuiltIn$4;

var engineUserAgent = getBuiltIn$3('navigator', 'userAgent') || '';var global$8 = global$a;
var userAgent = engineUserAgent;

var process = global$8.process;
var Deno = global$8.Deno;
var versions = process && process.versions || Deno && Deno.version;
var v8 = versions && versions.v8;
var match, version$1;

if (v8) {
  match = v8.split('.');
  // in old Chrome, versions of V8 isn't V8 = Chrome / 10
  // but their correct versions are not interesting for us
  version$1 = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);
}

// BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`
// so check `userAgent` even if `.v8` exists, but 0
if (!version$1 && userAgent) {
  match = userAgent.match(/Edge\/(\d+)/);
  if (!match || match[1] >= 74) {
    match = userAgent.match(/Chrome\/(\d+)/);
    if (match) version$1 = +match[1];
  }
}

var engineV8Version = version$1;/* eslint-disable es-x/no-symbol -- required for testing */

var V8_VERSION = engineV8Version;
var fails$5 = fails$9;

// eslint-disable-next-line es-x/no-object-getownpropertysymbols -- required for testing
var nativeSymbol = !!Object.getOwnPropertySymbols && !fails$5(function () {
  var symbol = Symbol();
  // Chrome 38 Symbol has incorrect toString conversion
  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances
  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||
    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances
    !Symbol.sham && V8_VERSION && V8_VERSION < 41;
});/* eslint-disable es-x/no-symbol -- required for testing */

var NATIVE_SYMBOL$1 = nativeSymbol;

var useSymbolAsUid = NATIVE_SYMBOL$1
  && !Symbol.sham
  && typeof Symbol.iterator == 'symbol';var getBuiltIn$2 = getBuiltIn$4;
var isCallable$7 = isCallable$a;
var isPrototypeOf = objectIsPrototypeOf;
var USE_SYMBOL_AS_UID$1 = useSymbolAsUid;

var $Object$1 = Object;

var isSymbol$2 = USE_SYMBOL_AS_UID$1 ? function (it) {
  return typeof it == 'symbol';
} : function (it) {
  var $Symbol = getBuiltIn$2('Symbol');
  return isCallable$7($Symbol) && isPrototypeOf($Symbol.prototype, $Object$1(it));
};var $String$1 = String;

var tryToString$1 = function (argument) {
  try {
    return $String$1(argument);
  } catch (error) {
    return 'Object';
  }
};var isCallable$6 = isCallable$a;
var tryToString = tryToString$1;

var $TypeError$4 = TypeError;

// `Assert: IsCallable(argument) is true`
var aCallable$1 = function (argument) {
  if (isCallable$6(argument)) return argument;
  throw $TypeError$4(tryToString(argument) + ' is not a function');
};var aCallable = aCallable$1;

// `GetMethod` abstract operation
// https://tc39.es/ecma262/#sec-getmethod
var getMethod$1 = function (V, P) {
  var func = V[P];
  return func == null ? undefined : aCallable(func);
};var call$2 = functionCall;
var isCallable$5 = isCallable$a;
var isObject$4 = isObject$5;

var $TypeError$3 = TypeError;

// `OrdinaryToPrimitive` abstract operation
// https://tc39.es/ecma262/#sec-ordinarytoprimitive
var ordinaryToPrimitive$1 = function (input, pref) {
  var fn, val;
  if (pref === 'string' && isCallable$5(fn = input.toString) && !isObject$4(val = call$2(fn, input))) return val;
  if (isCallable$5(fn = input.valueOf) && !isObject$4(val = call$2(fn, input))) return val;
  if (pref !== 'string' && isCallable$5(fn = input.toString) && !isObject$4(val = call$2(fn, input))) return val;
  throw $TypeError$3("Can't convert object to primitive value");
};var shared$3 = {exports: {}};var global$7 = global$a;

// eslint-disable-next-line es-x/no-object-defineproperty -- safe
var defineProperty$2 = Object.defineProperty;

var defineGlobalProperty$3 = function (key, value) {
  try {
    defineProperty$2(global$7, key, { value: value, configurable: true, writable: true });
  } catch (error) {
    global$7[key] = value;
  } return value;
};var global$6 = global$a;
var defineGlobalProperty$2 = defineGlobalProperty$3;

var SHARED = '__core-js_shared__';
var store$3 = global$6[SHARED] || defineGlobalProperty$2(SHARED, {});

var sharedStore = store$3;var store$2 = sharedStore;

(shared$3.exports = function (key, value) {
  return store$2[key] || (store$2[key] = value !== undefined ? value : {});
})('versions', []).push({
  version: '3.23.4',
  mode: 'global',
  copyright: 'Â© 2014-2022 Denis Pushkarev (zloirock.ru)',
  license: 'https://github.com/zloirock/core-js/blob/v3.23.4/LICENSE',
  source: 'https://github.com/zloirock/core-js'
});var requireObjectCoercible = requireObjectCoercible$2;

var $Object = Object;

// `ToObject` abstract operation
// https://tc39.es/ecma262/#sec-toobject
var toObject$1 = function (argument) {
  return $Object(requireObjectCoercible(argument));
};var uncurryThis$5 = functionUncurryThis;
var toObject = toObject$1;

var hasOwnProperty = uncurryThis$5({}.hasOwnProperty);

// `HasOwnProperty` abstract operation
// https://tc39.es/ecma262/#sec-hasownproperty
// eslint-disable-next-line es-x/no-object-hasown -- safe
var hasOwnProperty_1 = Object.hasOwn || function hasOwn(it, key) {
  return hasOwnProperty(toObject(it), key);
};var uncurryThis$4 = functionUncurryThis;

var id = 0;
var postfix = Math.random();
var toString = uncurryThis$4(1.0.toString);

var uid$2 = function (key) {
  return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString(++id + postfix, 36);
};var global$5 = global$a;
var shared$2 = shared$3.exports;
var hasOwn$6 = hasOwnProperty_1;
var uid$1 = uid$2;
var NATIVE_SYMBOL = nativeSymbol;
var USE_SYMBOL_AS_UID = useSymbolAsUid;

var WellKnownSymbolsStore = shared$2('wks');
var Symbol$1 = global$5.Symbol;
var symbolFor = Symbol$1 && Symbol$1['for'];
var createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol$1 : Symbol$1 && Symbol$1.withoutSetter || uid$1;

var wellKnownSymbol$2 = function (name) {
  if (!hasOwn$6(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {
    var description = 'Symbol.' + name;
    if (NATIVE_SYMBOL && hasOwn$6(Symbol$1, name)) {
      WellKnownSymbolsStore[name] = Symbol$1[name];
    } else if (USE_SYMBOL_AS_UID && symbolFor) {
      WellKnownSymbolsStore[name] = symbolFor(description);
    } else {
      WellKnownSymbolsStore[name] = createWellKnownSymbol(description);
    }
  } return WellKnownSymbolsStore[name];
};var call$1 = functionCall;
var isObject$3 = isObject$5;
var isSymbol$1 = isSymbol$2;
var getMethod = getMethod$1;
var ordinaryToPrimitive = ordinaryToPrimitive$1;
var wellKnownSymbol$1 = wellKnownSymbol$2;

var $TypeError$2 = TypeError;
var TO_PRIMITIVE = wellKnownSymbol$1('toPrimitive');

// `ToPrimitive` abstract operation
// https://tc39.es/ecma262/#sec-toprimitive
var toPrimitive$1 = function (input, pref) {
  if (!isObject$3(input) || isSymbol$1(input)) return input;
  var exoticToPrim = getMethod(input, TO_PRIMITIVE);
  var result;
  if (exoticToPrim) {
    if (pref === undefined) pref = 'default';
    result = call$1(exoticToPrim, input, pref);
    if (!isObject$3(result) || isSymbol$1(result)) return result;
    throw $TypeError$2("Can't convert object to primitive value");
  }
  if (pref === undefined) pref = 'number';
  return ordinaryToPrimitive(input, pref);
};var toPrimitive = toPrimitive$1;
var isSymbol = isSymbol$2;

// `ToPropertyKey` abstract operation
// https://tc39.es/ecma262/#sec-topropertykey
var toPropertyKey$2 = function (argument) {
  var key = toPrimitive(argument, 'string');
  return isSymbol(key) ? key : key + '';
};var global$4 = global$a;
var isObject$2 = isObject$5;

var document$1 = global$4.document;
// typeof document.createElement is 'object' in old IE
var EXISTS$1 = isObject$2(document$1) && isObject$2(document$1.createElement);

var documentCreateElement$1 = function (it) {
  return EXISTS$1 ? document$1.createElement(it) : {};
};var DESCRIPTORS$7 = descriptors;
var fails$4 = fails$9;
var createElement = documentCreateElement$1;

// Thanks to IE8 for its funny defineProperty
var ie8DomDefine = !DESCRIPTORS$7 && !fails$4(function () {
  // eslint-disable-next-line es-x/no-object-defineproperty -- required for testing
  return Object.defineProperty(createElement('div'), 'a', {
    get: function () { return 7; }
  }).a != 7;
});var DESCRIPTORS$6 = descriptors;
var call = functionCall;
var propertyIsEnumerableModule = objectPropertyIsEnumerable;
var createPropertyDescriptor$1 = createPropertyDescriptor$2;
var toIndexedObject$3 = toIndexedObject$4;
var toPropertyKey$1 = toPropertyKey$2;
var hasOwn$5 = hasOwnProperty_1;
var IE8_DOM_DEFINE$1 = ie8DomDefine;

// eslint-disable-next-line es-x/no-object-getownpropertydescriptor -- safe
var $getOwnPropertyDescriptor$1 = Object.getOwnPropertyDescriptor;

// `Object.getOwnPropertyDescriptor` method
// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor
objectGetOwnPropertyDescriptor.f = DESCRIPTORS$6 ? $getOwnPropertyDescriptor$1 : function getOwnPropertyDescriptor(O, P) {
  O = toIndexedObject$3(O);
  P = toPropertyKey$1(P);
  if (IE8_DOM_DEFINE$1) try {
    return $getOwnPropertyDescriptor$1(O, P);
  } catch (error) { /* empty */ }
  if (hasOwn$5(O, P)) return createPropertyDescriptor$1(!call(propertyIsEnumerableModule.f, O, P), O[P]);
};var objectDefineProperty = {};var DESCRIPTORS$5 = descriptors;
var fails$3 = fails$9;

// V8 ~ Chrome 36-
// https://bugs.chromium.org/p/v8/issues/detail?id=3334
var v8PrototypeDefineBug = DESCRIPTORS$5 && fails$3(function () {
  // eslint-disable-next-line es-x/no-object-defineproperty -- required for testing
  return Object.defineProperty(function () { /* empty */ }, 'prototype', {
    value: 42,
    writable: false
  }).prototype != 42;
});var isObject$1 = isObject$5;

var $String = String;
var $TypeError$1 = TypeError;

// `Assert: Type(argument) is Object`
var anObject$4 = function (argument) {
  if (isObject$1(argument)) return argument;
  throw $TypeError$1($String(argument) + ' is not an object');
};var DESCRIPTORS$4 = descriptors;
var IE8_DOM_DEFINE = ie8DomDefine;
var V8_PROTOTYPE_DEFINE_BUG$1 = v8PrototypeDefineBug;
var anObject$3 = anObject$4;
var toPropertyKey = toPropertyKey$2;

var $TypeError = TypeError;
// eslint-disable-next-line es-x/no-object-defineproperty -- safe
var $defineProperty = Object.defineProperty;
// eslint-disable-next-line es-x/no-object-getownpropertydescriptor -- safe
var $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;
var ENUMERABLE = 'enumerable';
var CONFIGURABLE$1 = 'configurable';
var WRITABLE = 'writable';

// `Object.defineProperty` method
// https://tc39.es/ecma262/#sec-object.defineproperty
objectDefineProperty.f = DESCRIPTORS$4 ? V8_PROTOTYPE_DEFINE_BUG$1 ? function defineProperty(O, P, Attributes) {
  anObject$3(O);
  P = toPropertyKey(P);
  anObject$3(Attributes);
  if (typeof O === 'function' && P === 'prototype' && 'value' in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {
    var current = $getOwnPropertyDescriptor(O, P);
    if (current && current[WRITABLE]) {
      O[P] = Attributes.value;
      Attributes = {
        configurable: CONFIGURABLE$1 in Attributes ? Attributes[CONFIGURABLE$1] : current[CONFIGURABLE$1],
        enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],
        writable: false
      };
    }
  } return $defineProperty(O, P, Attributes);
} : $defineProperty : function defineProperty(O, P, Attributes) {
  anObject$3(O);
  P = toPropertyKey(P);
  anObject$3(Attributes);
  if (IE8_DOM_DEFINE) try {
    return $defineProperty(O, P, Attributes);
  } catch (error) { /* empty */ }
  if ('get' in Attributes || 'set' in Attributes) throw $TypeError('Accessors not supported');
  if ('value' in Attributes) O[P] = Attributes.value;
  return O;
};var DESCRIPTORS$3 = descriptors;
var definePropertyModule$3 = objectDefineProperty;
var createPropertyDescriptor = createPropertyDescriptor$2;

var createNonEnumerableProperty$2 = DESCRIPTORS$3 ? function (object, key, value) {
  return definePropertyModule$3.f(object, key, createPropertyDescriptor(1, value));
} : function (object, key, value) {
  object[key] = value;
  return object;
};var makeBuiltIn$2 = {exports: {}};var DESCRIPTORS$2 = descriptors;
var hasOwn$4 = hasOwnProperty_1;

var FunctionPrototype = Function.prototype;
// eslint-disable-next-line es-x/no-object-getownpropertydescriptor -- safe
var getDescriptor = DESCRIPTORS$2 && Object.getOwnPropertyDescriptor;

var EXISTS = hasOwn$4(FunctionPrototype, 'name');
// additional protection from minified / mangled / dropped function names
var PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';
var CONFIGURABLE = EXISTS && (!DESCRIPTORS$2 || (DESCRIPTORS$2 && getDescriptor(FunctionPrototype, 'name').configurable));

var functionName = {
  EXISTS: EXISTS,
  PROPER: PROPER,
  CONFIGURABLE: CONFIGURABLE
};var uncurryThis$3 = functionUncurryThis;
var isCallable$4 = isCallable$a;
var store$1 = sharedStore;

var functionToString = uncurryThis$3(Function.toString);

// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper
if (!isCallable$4(store$1.inspectSource)) {
  store$1.inspectSource = function (it) {
    return functionToString(it);
  };
}

var inspectSource$2 = store$1.inspectSource;var global$3 = global$a;
var isCallable$3 = isCallable$a;
var inspectSource$1 = inspectSource$2;

var WeakMap$2 = global$3.WeakMap;

var nativeWeakMap = isCallable$3(WeakMap$2) && /native code/.test(inspectSource$1(WeakMap$2));var shared$1 = shared$3.exports;
var uid = uid$2;

var keys = shared$1('keys');

var sharedKey$2 = function (key) {
  return keys[key] || (keys[key] = uid(key));
};var hiddenKeys$4 = {};var NATIVE_WEAK_MAP = nativeWeakMap;
var global$2 = global$a;
var uncurryThis$2 = functionUncurryThis;
var isObject = isObject$5;
var createNonEnumerableProperty$1 = createNonEnumerableProperty$2;
var hasOwn$3 = hasOwnProperty_1;
var shared = sharedStore;
var sharedKey$1 = sharedKey$2;
var hiddenKeys$3 = hiddenKeys$4;

var OBJECT_ALREADY_INITIALIZED = 'Object already initialized';
var TypeError$1 = global$2.TypeError;
var WeakMap$1 = global$2.WeakMap;
var set, get, has;

var enforce = function (it) {
  return has(it) ? get(it) : set(it, {});
};

var getterFor = function (TYPE) {
  return function (it) {
    var state;
    if (!isObject(it) || (state = get(it)).type !== TYPE) {
      throw TypeError$1('Incompatible receiver, ' + TYPE + ' required');
    } return state;
  };
};

if (NATIVE_WEAK_MAP || shared.state) {
  var store = shared.state || (shared.state = new WeakMap$1());
  var wmget = uncurryThis$2(store.get);
  var wmhas = uncurryThis$2(store.has);
  var wmset = uncurryThis$2(store.set);
  set = function (it, metadata) {
    if (wmhas(store, it)) throw new TypeError$1(OBJECT_ALREADY_INITIALIZED);
    metadata.facade = it;
    wmset(store, it, metadata);
    return metadata;
  };
  get = function (it) {
    return wmget(store, it) || {};
  };
  has = function (it) {
    return wmhas(store, it);
  };
} else {
  var STATE = sharedKey$1('state');
  hiddenKeys$3[STATE] = true;
  set = function (it, metadata) {
    if (hasOwn$3(it, STATE)) throw new TypeError$1(OBJECT_ALREADY_INITIALIZED);
    metadata.facade = it;
    createNonEnumerableProperty$1(it, STATE, metadata);
    return metadata;
  };
  get = function (it) {
    return hasOwn$3(it, STATE) ? it[STATE] : {};
  };
  has = function (it) {
    return hasOwn$3(it, STATE);
  };
}

var internalState = {
  set: set,
  get: get,
  has: has,
  enforce: enforce,
  getterFor: getterFor
};var fails$2 = fails$9;
var isCallable$2 = isCallable$a;
var hasOwn$2 = hasOwnProperty_1;
var DESCRIPTORS$1 = descriptors;
var CONFIGURABLE_FUNCTION_NAME = functionName.CONFIGURABLE;
var inspectSource = inspectSource$2;
var InternalStateModule = internalState;

var enforceInternalState = InternalStateModule.enforce;
var getInternalState = InternalStateModule.get;
// eslint-disable-next-line es-x/no-object-defineproperty -- safe
var defineProperty$1 = Object.defineProperty;

var CONFIGURABLE_LENGTH = DESCRIPTORS$1 && !fails$2(function () {
  return defineProperty$1(function () { /* empty */ }, 'length', { value: 8 }).length !== 8;
});

var TEMPLATE = String(String).split('String');

var makeBuiltIn$1 = makeBuiltIn$2.exports = function (value, name, options) {
  if (String(name).slice(0, 7) === 'Symbol(') {
    name = '[' + String(name).replace(/^Symbol\(([^)]*)\)/, '$1') + ']';
  }
  if (options && options.getter) name = 'get ' + name;
  if (options && options.setter) name = 'set ' + name;
  if (!hasOwn$2(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {
    if (DESCRIPTORS$1) defineProperty$1(value, 'name', { value: name, configurable: true });
    else value.name = name;
  }
  if (CONFIGURABLE_LENGTH && options && hasOwn$2(options, 'arity') && value.length !== options.arity) {
    defineProperty$1(value, 'length', { value: options.arity });
  }
  try {
    if (options && hasOwn$2(options, 'constructor') && options.constructor) {
      if (DESCRIPTORS$1) defineProperty$1(value, 'prototype', { writable: false });
    // in V8 ~ Chrome 53, prototypes of some methods, like `Array.prototype.values`, are non-writable
    } else if (value.prototype) value.prototype = undefined;
  } catch (error) { /* empty */ }
  var state = enforceInternalState(value);
  if (!hasOwn$2(state, 'source')) {
    state.source = TEMPLATE.join(typeof name == 'string' ? name : '');
  } return value;
};

// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative
// eslint-disable-next-line no-extend-native -- required
Function.prototype.toString = makeBuiltIn$1(function toString() {
  return isCallable$2(this) && getInternalState(this).source || inspectSource(this);
}, 'toString');var isCallable$1 = isCallable$a;
var definePropertyModule$2 = objectDefineProperty;
var makeBuiltIn = makeBuiltIn$2.exports;
var defineGlobalProperty$1 = defineGlobalProperty$3;

var defineBuiltIn$1 = function (O, key, value, options) {
  if (!options) options = {};
  var simple = options.enumerable;
  var name = options.name !== undefined ? options.name : key;
  if (isCallable$1(value)) makeBuiltIn(value, name, options);
  if (options.global) {
    if (simple) O[key] = value;
    else defineGlobalProperty$1(key, value);
  } else {
    try {
      if (!options.unsafe) delete O[key];
      else if (O[key]) simple = true;
    } catch (error) { /* empty */ }
    if (simple) O[key] = value;
    else definePropertyModule$2.f(O, key, {
      value: value,
      enumerable: false,
      configurable: !options.nonConfigurable,
      writable: !options.nonWritable
    });
  } return O;
};var objectGetOwnPropertyNames = {};var ceil = Math.ceil;
var floor = Math.floor;

// `Math.trunc` method
// https://tc39.es/ecma262/#sec-math.trunc
// eslint-disable-next-line es-x/no-math-trunc -- safe
var mathTrunc = Math.trunc || function trunc(x) {
  var n = +x;
  return (n > 0 ? floor : ceil)(n);
};var trunc = mathTrunc;

// `ToIntegerOrInfinity` abstract operation
// https://tc39.es/ecma262/#sec-tointegerorinfinity
var toIntegerOrInfinity$2 = function (argument) {
  var number = +argument;
  // eslint-disable-next-line no-self-compare -- NaN check
  return number !== number || number === 0 ? 0 : trunc(number);
};var toIntegerOrInfinity$1 = toIntegerOrInfinity$2;

var max = Math.max;
var min$1 = Math.min;

// Helper for a popular repeating case of the spec:
// Let integer be ? ToInteger(index).
// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).
var toAbsoluteIndex$1 = function (index, length) {
  var integer = toIntegerOrInfinity$1(index);
  return integer < 0 ? max(integer + length, 0) : min$1(integer, length);
};var toIntegerOrInfinity = toIntegerOrInfinity$2;

var min = Math.min;

// `ToLength` abstract operation
// https://tc39.es/ecma262/#sec-tolength
var toLength$1 = function (argument) {
  return argument > 0 ? min(toIntegerOrInfinity(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991
};var toLength = toLength$1;

// `LengthOfArrayLike` abstract operation
// https://tc39.es/ecma262/#sec-lengthofarraylike
var lengthOfArrayLike$1 = function (obj) {
  return toLength(obj.length);
};var toIndexedObject$2 = toIndexedObject$4;
var toAbsoluteIndex = toAbsoluteIndex$1;
var lengthOfArrayLike = lengthOfArrayLike$1;

// `Array.prototype.{ indexOf, includes }` methods implementation
var createMethod = function (IS_INCLUDES) {
  return function ($this, el, fromIndex) {
    var O = toIndexedObject$2($this);
    var length = lengthOfArrayLike(O);
    var index = toAbsoluteIndex(fromIndex, length);
    var value;
    // Array#includes uses SameValueZero equality algorithm
    // eslint-disable-next-line no-self-compare -- NaN check
    if (IS_INCLUDES && el != el) while (length > index) {
      value = O[index++];
      // eslint-disable-next-line no-self-compare -- NaN check
      if (value != value) return true;
    // Array#indexOf ignores holes, Array#includes - not
    } else for (;length > index; index++) {
      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;
    } return !IS_INCLUDES && -1;
  };
};

var arrayIncludes = {
  // `Array.prototype.includes` method
  // https://tc39.es/ecma262/#sec-array.prototype.includes
  includes: createMethod(true),
  // `Array.prototype.indexOf` method
  // https://tc39.es/ecma262/#sec-array.prototype.indexof
  indexOf: createMethod(false)
};var uncurryThis$1 = functionUncurryThis;
var hasOwn$1 = hasOwnProperty_1;
var toIndexedObject$1 = toIndexedObject$4;
var indexOf = arrayIncludes.indexOf;
var hiddenKeys$2 = hiddenKeys$4;

var push = uncurryThis$1([].push);

var objectKeysInternal = function (object, names) {
  var O = toIndexedObject$1(object);
  var i = 0;
  var result = [];
  var key;
  for (key in O) !hasOwn$1(hiddenKeys$2, key) && hasOwn$1(O, key) && push(result, key);
  // Don't enum bug & hidden keys
  while (names.length > i) if (hasOwn$1(O, key = names[i++])) {
    ~indexOf(result, key) || push(result, key);
  }
  return result;
};// IE8- don't enum bug keys
var enumBugKeys$3 = [
  'constructor',
  'hasOwnProperty',
  'isPrototypeOf',
  'propertyIsEnumerable',
  'toLocaleString',
  'toString',
  'valueOf'
];var internalObjectKeys$1 = objectKeysInternal;
var enumBugKeys$2 = enumBugKeys$3;

var hiddenKeys$1 = enumBugKeys$2.concat('length', 'prototype');

// `Object.getOwnPropertyNames` method
// https://tc39.es/ecma262/#sec-object.getownpropertynames
// eslint-disable-next-line es-x/no-object-getownpropertynames -- safe
objectGetOwnPropertyNames.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {
  return internalObjectKeys$1(O, hiddenKeys$1);
};var objectGetOwnPropertySymbols = {};// eslint-disable-next-line es-x/no-object-getownpropertysymbols -- safe
objectGetOwnPropertySymbols.f = Object.getOwnPropertySymbols;var getBuiltIn$1 = getBuiltIn$4;
var uncurryThis = functionUncurryThis;
var getOwnPropertyNamesModule = objectGetOwnPropertyNames;
var getOwnPropertySymbolsModule = objectGetOwnPropertySymbols;
var anObject$2 = anObject$4;

var concat = uncurryThis([].concat);

// all object keys, includes non-enumerable and symbols
var ownKeys$1 = getBuiltIn$1('Reflect', 'ownKeys') || function ownKeys(it) {
  var keys = getOwnPropertyNamesModule.f(anObject$2(it));
  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;
  return getOwnPropertySymbols ? concat(keys, getOwnPropertySymbols(it)) : keys;
};var hasOwn = hasOwnProperty_1;
var ownKeys = ownKeys$1;
var getOwnPropertyDescriptorModule = objectGetOwnPropertyDescriptor;
var definePropertyModule$1 = objectDefineProperty;

var copyConstructorProperties$1 = function (target, source, exceptions) {
  var keys = ownKeys(source);
  var defineProperty = definePropertyModule$1.f;
  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;
  for (var i = 0; i < keys.length; i++) {
    var key = keys[i];
    if (!hasOwn(target, key) && !(exceptions && hasOwn(exceptions, key))) {
      defineProperty(target, key, getOwnPropertyDescriptor(source, key));
    }
  }
};var fails$1 = fails$9;
var isCallable = isCallable$a;

var replacement = /#|\.prototype\./;

var isForced$1 = function (feature, detection) {
  var value = data[normalize(feature)];
  return value == POLYFILL ? true
    : value == NATIVE ? false
    : isCallable(detection) ? fails$1(detection)
    : !!detection;
};

var normalize = isForced$1.normalize = function (string) {
  return String(string).replace(replacement, '.').toLowerCase();
};

var data = isForced$1.data = {};
var NATIVE = isForced$1.NATIVE = 'N';
var POLYFILL = isForced$1.POLYFILL = 'P';

var isForced_1 = isForced$1;var global$1 = global$a;
var getOwnPropertyDescriptor = objectGetOwnPropertyDescriptor.f;
var createNonEnumerableProperty = createNonEnumerableProperty$2;
var defineBuiltIn = defineBuiltIn$1;
var defineGlobalProperty = defineGlobalProperty$3;
var copyConstructorProperties = copyConstructorProperties$1;
var isForced = isForced_1;

/*
  options.target         - name of the target object
  options.global         - target is the global object
  options.stat           - export as static methods of target
  options.proto          - export as prototype methods of target
  options.real           - real prototype method for the `pure` version
  options.forced         - export even if the native feature is available
  options.bind           - bind methods to the target, required for the `pure` version
  options.wrap           - wrap constructors to preventing global pollution, required for the `pure` version
  options.unsafe         - use the simple assignment of property instead of delete + defineProperty
  options.sham           - add a flag to not completely full polyfills
  options.enumerable     - export as enumerable property
  options.dontCallGetSet - prevent calling a getter on target
  options.name           - the .name of the function if it does not match the key
*/
var _export = function (options, source) {
  var TARGET = options.target;
  var GLOBAL = options.global;
  var STATIC = options.stat;
  var FORCED, target, key, targetProperty, sourceProperty, descriptor;
  if (GLOBAL) {
    target = global$1;
  } else if (STATIC) {
    target = global$1[TARGET] || defineGlobalProperty(TARGET, {});
  } else {
    target = (global$1[TARGET] || {}).prototype;
  }
  if (target) for (key in source) {
    sourceProperty = source[key];
    if (options.dontCallGetSet) {
      descriptor = getOwnPropertyDescriptor(target, key);
      targetProperty = descriptor && descriptor.value;
    } else targetProperty = target[key];
    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);
    // contained in target
    if (!FORCED && targetProperty !== undefined) {
      if (typeof sourceProperty == typeof targetProperty) continue;
      copyConstructorProperties(sourceProperty, targetProperty);
    }
    // add a flag to not completely full polyfills
    if (options.sham || (targetProperty && targetProperty.sham)) {
      createNonEnumerableProperty(sourceProperty, 'sham', true);
    }
    defineBuiltIn(target, key, sourceProperty, options);
  }
};var objectDefineProperties = {};var internalObjectKeys = objectKeysInternal;
var enumBugKeys$1 = enumBugKeys$3;

// `Object.keys` method
// https://tc39.es/ecma262/#sec-object.keys
// eslint-disable-next-line es-x/no-object-keys -- safe
var objectKeys$1 = Object.keys || function keys(O) {
  return internalObjectKeys(O, enumBugKeys$1);
};var DESCRIPTORS = descriptors;
var V8_PROTOTYPE_DEFINE_BUG = v8PrototypeDefineBug;
var definePropertyModule = objectDefineProperty;
var anObject$1 = anObject$4;
var toIndexedObject = toIndexedObject$4;
var objectKeys = objectKeys$1;

// `Object.defineProperties` method
// https://tc39.es/ecma262/#sec-object.defineproperties
// eslint-disable-next-line es-x/no-object-defineproperties -- safe
objectDefineProperties.f = DESCRIPTORS && !V8_PROTOTYPE_DEFINE_BUG ? Object.defineProperties : function defineProperties(O, Properties) {
  anObject$1(O);
  var props = toIndexedObject(Properties);
  var keys = objectKeys(Properties);
  var length = keys.length;
  var index = 0;
  var key;
  while (length > index) definePropertyModule.f(O, key = keys[index++], props[key]);
  return O;
};var getBuiltIn = getBuiltIn$4;

var html$1 = getBuiltIn('document', 'documentElement');/* global ActiveXObject -- old IE, WSH */

var anObject = anObject$4;
var definePropertiesModule = objectDefineProperties;
var enumBugKeys = enumBugKeys$3;
var hiddenKeys = hiddenKeys$4;
var html = html$1;
var documentCreateElement = documentCreateElement$1;
var sharedKey = sharedKey$2;

var GT = '>';
var LT = '<';
var PROTOTYPE = 'prototype';
var SCRIPT = 'script';
var IE_PROTO = sharedKey('IE_PROTO');

var EmptyConstructor = function () { /* empty */ };

var scriptTag = function (content) {
  return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;
};

// Create object with fake `null` prototype: use ActiveX Object with cleared prototype
var NullProtoObjectViaActiveX = function (activeXDocument) {
  activeXDocument.write(scriptTag(''));
  activeXDocument.close();
  var temp = activeXDocument.parentWindow.Object;
  activeXDocument = null; // avoid memory leak
  return temp;
};

// Create object with fake `null` prototype: use iframe Object with cleared prototype
var NullProtoObjectViaIFrame = function () {
  // Thrash, waste and sodomy: IE GC bug
  var iframe = documentCreateElement('iframe');
  var JS = 'java' + SCRIPT + ':';
  var iframeDocument;
  iframe.style.display = 'none';
  html.appendChild(iframe);
  // https://github.com/zloirock/core-js/issues/475
  iframe.src = String(JS);
  iframeDocument = iframe.contentWindow.document;
  iframeDocument.open();
  iframeDocument.write(scriptTag('document.F=Object'));
  iframeDocument.close();
  return iframeDocument.F;
};

// Check for document.domain and active x support
// No need to use active x approach when document.domain is not set
// see https://github.com/es-shims/es5-shim/issues/150
// variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346
// avoid IE GC bug
var activeXDocument;
var NullProtoObject = function () {
  try {
    activeXDocument = new ActiveXObject('htmlfile');
  } catch (error) { /* ignore */ }
  NullProtoObject = typeof document != 'undefined'
    ? document.domain && activeXDocument
      ? NullProtoObjectViaActiveX(activeXDocument) // old IE
      : NullProtoObjectViaIFrame()
    : NullProtoObjectViaActiveX(activeXDocument); // WSH
  var length = enumBugKeys.length;
  while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];
  return NullProtoObject();
};

hiddenKeys[IE_PROTO] = true;

// `Object.create` method
// https://tc39.es/ecma262/#sec-object.create
// eslint-disable-next-line es-x/no-object-create -- safe
var objectCreate = Object.create || function create(O, Properties) {
  var result;
  if (O !== null) {
    EmptyConstructor[PROTOTYPE] = anObject(O);
    result = new EmptyConstructor();
    EmptyConstructor[PROTOTYPE] = null;
    // add "__proto__" for Object.getPrototypeOf polyfill
    result[IE_PROTO] = O;
  } else result = NullProtoObject();
  return Properties === undefined ? result : definePropertiesModule.f(result, Properties);
};var wellKnownSymbol = wellKnownSymbol$2;
var create = objectCreate;
var defineProperty = objectDefineProperty.f;

var UNSCOPABLES = wellKnownSymbol('unscopables');
var ArrayPrototype = Array.prototype;

// Array.prototype[@@unscopables]
// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables
if (ArrayPrototype[UNSCOPABLES] == undefined) {
  defineProperty(ArrayPrototype, UNSCOPABLES, {
    configurable: true,
    value: create(null)
  });
}

// add a key to Array.prototype[@@unscopables]
var addToUnscopables$1 = function (key) {
  ArrayPrototype[UNSCOPABLES][key] = true;
};var $$2 = _export;
var $includes = arrayIncludes.includes;
var fails = fails$9;
var addToUnscopables = addToUnscopables$1;

// FF99+ bug
var BROKEN_ON_SPARSE = fails(function () {
  return !Array(1).includes();
});

// `Array.prototype.includes` method
// https://tc39.es/ecma262/#sec-array.prototype.includes
$$2({ target: 'Array', proto: true, forced: BROKEN_ON_SPARSE }, {
  includes: function includes(el /* , fromIndex = 0 */) {
    return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);
  }
});

// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables
addToUnscopables('includes');/**
 * A class that provides information for configuring a live event when it is created.
 */

/**
 * A class that provides parameters that are used to query a list of live events.
 */

/**
 * An enum that provides information about roles that users can take in a live event.
 */
exports.LiveEventRole=void 0;
/**
 * An enum that provides information about the states of a live event.
 */

(function (LiveEventRole) {
  LiveEventRole["HOST"] = "host";
  LiveEventRole["PARTICIPANT"] = "participant";
})(exports.LiveEventRole || (exports.LiveEventRole = {}));

exports.LiveEventState=void 0;
/**
 * An enum that provides information about the states of a host.
 */

(function (LiveEventState) {
  LiveEventState["CREATED"] = "created";
  LiveEventState["READY"] = "ready";
  LiveEventState["ONGOING"] = "ongoing";
  LiveEventState["PAUSED"] = "paused";
  LiveEventState["ENDED"] = "ended";
})(exports.LiveEventState || (exports.LiveEventState = {}));

exports.HostState=void 0;
/**
 * An enum that provides information about the states of a participant.
 */

(function (HostState) {
  HostState["ENTERED"] = "entered";
  HostState["CONNECTED"] = "connected";
  HostState["DISCONNECTED"] = "disconnected";
  HostState["EXITED"] = "exited";
})(exports.HostState || (exports.HostState = {}));

exports.ParticipantState=void 0;
/**
 * A class that provides event listener methods that are invoked when actions are taken in a live event.
 */

(function (ParticipantState) {
  ParticipantState["ENTERED"] = "entered";
  ParticipantState["EXITED"] = "exited";
})(exports.ParticipantState || (exports.ParticipantState = {}));class AuthCommand extends APICommand {
  constructor(appId, userId, accessToken) {
    super();
    this.appId = appId;
    this.userId = userId;
    this.accessToken = accessToken;
  }

  getAuth() {
    return false;
  }

  getData() {
    return {
      app_id: this.appId,
      user_id: this.userId,
      access_token: this.accessToken
    };
  }

  getPath() {
    return `/v1/users/${encodeURIComponent(this.userId)}/login`;
  }

  getMethod() {
    return 'POST';
  }

}let APIMethodType;

(function (APIMethodType) {
  APIMethodType["POST"] = "POST";
  APIMethodType["GET"] = "GET";
  APIMethodType["DELETE"] = "DELETE";
  APIMethodType["OPTION"] = "OPTION";
})(APIMethodType || (APIMethodType = {}));class CreateLiveEventCommand extends LiveEventAPICommand {
  constructor(hostType, hostIds) {
    super();

    _defineProperty(this, "type", LiveEventDataType.CREATE);

    this.hostType = hostType;
    this.hostIds = Array.isArray(hostIds) ? hostIds : [hostIds];
  }

  getData() {
    return {
      'host_type': this.hostType,
      'user_ids_for_host': this.hostIds
    };
  }

  getSubPath() {
    return '/live-events';
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class CreateLiveEventResponseCommand extends LiveEventResponseCommand {
  // override payload: CreateLiveEventResponsePayload;
  parseData(data) {
    return {
      liveEvent: parseLiveEvent(data.live_event)
    };
  }

}class GetLiveEventCommand extends LiveEventAPICommand {
  constructor(liveEventId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.GET);

    this.liveEventId = liveEventId;
  }

  getData() {
    return undefined;
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}`;
  }

  getMethod() {
    return APIMethodType.GET;
  }

}
class GetLiveEventResponseCommand extends LiveEventResponseCommand {
  // override payload: GetLiveEventResponsePayload;
  parseData(data) {
    return {
      liveEvent: parseLiveEvent(data.live_event)
    };
  }

}class EnterHostCommand extends LiveEventAPICommand {
  constructor(liveEventId, mediaOption) {
    super();

    _defineProperty(this, "type", LiveEventDataType.ENTER_HOST);

    _defineProperty(this, "mediaOption", {
      turnAudioOn: true,
      turnVideoOn: true
    });

    this.liveEventId = liveEventId;
    this.mediaOption = mediaOption;
  }

  getData() {
    return {
      is_audio_on: this.mediaOption.turnAudioOn,
      is_video_on: this.mediaOption.turnVideoOn
    };
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/hosts`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class EnterHostResponseCommand extends LiveEventResponseCommand {
  // override payload: EnterHostResponsePayload;
  parseData(data) {
    return {
      host: parseHost(data.host)
    };
  }

}class ReadyCommand extends LiveEventAPICommand {
  constructor(liveEventId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.READY);

    this.liveEventId = liveEventId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/ready`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class ReadyResponseCommand extends LiveEventResponseCommand {
  // override payload: ReadyResponsePayload;
  parseData(data) {
    return {
      liveEvent: parseLiveEvent(data.live_event)
    };
  }

}class StartCommand extends LiveEventAPICommand {
  constructor(liveEventId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.START);

    this.liveEventId = liveEventId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/start`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class StartResponseCommand extends LiveEventResponseCommand {
  // override payload: StartResponsePayload;
  parseData(data) {
    return {
      liveEvent: parseLiveEvent(data.live_event)
    };
  }

}class ExitHostCommand extends LiveEventAPICommand {
  constructor(liveEventId, hostId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.EXIT_HOST);

    this.liveEventId = liveEventId;
    this.hostId = hostId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/hosts/${this.hostId}`;
  }

  getMethod() {
    return APIMethodType.DELETE;
  }

}
class ExitHostResponseCommand extends LiveEventResponseCommand {
  // override payload: ExitHostResponsePayload;
  parseData(data) {
    return {
      host: parseHost(data.host)
    };
  }

}class EndLiveEventCommand extends LiveEventAPICommand {
  constructor(liveEventId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.DELETE);

    this.liveEventId = liveEventId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}`;
  }

  getMethod() {
    return APIMethodType.DELETE;
  }

}
class EndLiveEventResponseCommand extends LiveEventResponseCommand {
  // override payload: EndLiveEventResponsePayload;
  parseData(data) {
    return {
      liveEvent: parseLiveEvent(data.live_event)
    };
  }

}class EnterCommand extends LiveEventAPICommand {
  constructor(liveEventId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.ENTER);

    this.liveEventId = liveEventId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/participants`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class EnterResponseCommand extends LiveEventResponseCommand {
  // override payload: EnterResponsePayload;
  parseData(data) {
    return {
      participant: parseParticipant(data.participant)
    };
  }

}class ExitCommand extends LiveEventAPICommand {
  constructor(liveEventId, participantId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.EXIT);

    this.liveEventId = liveEventId;
    this.participantId = participantId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/participants/${this.participantId}`;
  }

  getMethod() {
    return APIMethodType.DELETE;
  }

}
class ExitResponseCommand extends LiveEventResponseCommand {
  // override payload: ExitResponsePayload;
  parseData(data) {
    return {
      participant: parseParticipant(data.participant)
    };
  }

}class ConnectedCommand extends LiveEventAPICommand {
  constructor(liveEventId, participantId, endpointId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.CONNECTED);

    this.liveEventId = liveEventId;
    this.participantId = participantId;
    this.endpointId = endpointId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/participants/${this.participantId}/rtcstreams/${this.endpointId}/connected`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class ConnectedResponseCommand extends LiveEventResponseCommand {
  // override payload: ConnectedResponsePayload;
  parseData(data) {
    return {
      endpoint: parseEndpoint(data.rtcstream)
    };
  }

}class HostConnectedCommand extends LiveEventAPICommand {
  constructor(liveEventId, hostId, endpointId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.HOST_CONNECTED);

    this.liveEventId = liveEventId;
    this.hostId = hostId;
    this.endpointId = endpointId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/hosts/${this.hostId}/rtcstreams/${this.endpointId}/connected`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class HostConnectedResponseCommand extends LiveEventResponseCommand {
  // override payload: HostConnectedResponsePayload;
  parseData(data) {
    return {
      endpoint: parseEndpoint(data.rtcstream)
    };
  }

}class DeleteStreamCommand extends LiveEventAPICommand {
  constructor(liveEventId, participantId, endpointId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.DELETE_STREAM);

    this.liveEventId = liveEventId;
    this.participantId = participantId;
    this.endpointId = endpointId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/participants/${this.participantId}/rtcstreams/${this.endpointId}`;
  }

  getMethod() {
    return APIMethodType.DELETE;
  }

}
class DeleteStreamResponseCommand extends LiveEventResponseCommand {
  // override payload: DeleteStreamResponsePayload;
  parseData(data) {
    return {};
  }

}class HostDeleteStreamCommand extends LiveEventAPICommand {
  constructor(liveEventId, hostId, endpointId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.HOST_DELETE_STREAM);

    this.liveEventId = liveEventId;
    this.hostId = hostId;
    this.endpointId = endpointId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/hosts/${this.hostId}/rtcstreams/${this.endpointId}`;
  }

  getMethod() {
    return APIMethodType.DELETE;
  }

}
class HostDeleteStreamResponseCommand extends LiveEventResponseCommand {
  // override payload: HostDeleteStreamResponsePayload;
  parseData(data) {
    return {};
  }

}class AttachCommand extends LiveEventAPICommand {
  constructor(liveEventId, participantId, endpointId, attachTo) {
    super();

    _defineProperty(this, "type", LiveEventDataType.ATTACH);

    this.liveEventId = liveEventId;
    this.participantId = participantId;
    this.endpointId = endpointId;
    this.attachTo = attachTo;
  }

  getData() {
    return {
      attach_to: this.attachTo
    };
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/participants/${this.participantId}/rtcstreams/${this.endpointId}/attach`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class AttachResponseCommand extends LiveEventResponseCommand {
  // override payload: AttachResponsePayload;
  parseData(data) {
    return {
      endpoint: parseEndpoint(data.rtcstream)
    };
  }

}class EventCommand extends Command {
  // TODO: Revisit âï¸
  // TODO: any?
  constructor(json) {
    super();
    this.type = json.type;
    this.version = json.version;
    this.messageId = json.message_id;
    this.payload = this.parseData(json.payload);
  } // TODO: Revisit?


}class ReadyEventCommand extends EventCommand {
  // override payload: ReturnType<ReadyEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      liveEvent: parseLiveEvent(data.live_event)
    };
  }

}class StartedEventCommand extends EventCommand {
  // override payload: ReturnType<StartedEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      liveEvent: parseLiveEvent(data.live_event)
    };
  }

}class EndedEventCommand extends EventCommand {
  // override payload: ReturnType<EndedEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      liveEvent: parseLiveEvent(data.live_event)
    };
  }

}class HostEnteredEventCommand extends EventCommand {
  // override payload: ReturnType<HostEnteredEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      host: parseHost(data.host)
    };
  }

}class HostExitedEventCommand extends EventCommand {
  // override payload: ReturnType<HostExitedEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      host: parseHost(data.host)
    };
  }

}class HostConnectedEventCommand extends EventCommand {
  // override payload: ReturnType<HostConnectedEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      host: parseHost(data.host)
    };
  }

}class HostAudioStatusChangedEventCommand extends EventCommand {
  // override payload: ReturnType<HostAudioStatusChangedEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      host: parseHost(data.host)
    };
  }

}class HostVideoStatusChangedEventCommand extends EventCommand {
  // override payload: ReturnType<HostVideoStatusChangedEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      host: parseHost(data.host)
    };
  }

}class ParticipantEnteredEventCommand extends EventCommand {
  // override payload: ReturnType<ParticipantEnteredEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      participant: parseParticipant(data.participant),
      participantCount: data.particpant_count,
      peakParticipantCount: data.peak_participant_count,
      cumulativeParticipantCount: data.cumulative_participant_count
    };
  }

}class ParticipantExitedEventCommand extends EventCommand {
  // override payload: ReturnType<ParticipantExitedEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      participant: parseParticipant(data.participant),
      participantCount: data.particpant_count,
      peakParticipantCount: data.peak_participant_count,
      cumulativeParticipantCount: data.cumulative_participant_count
    };
  }

}class CreateStreamCommand extends LiveEventAPICommand {
  constructor(liveEventId, participantId, sdp, audioAttr, videoAttr) {
    super();

    _defineProperty(this, "type", LiveEventDataType.CREATE_STREAM);

    this.liveEventId = liveEventId;
    this.participantId = participantId;
    this.sdp = sdp;
    this.audioAttr = audioAttr;
    this.videoAttr = videoAttr;
  }

  getData() {
    return {
      sdp: this.sdp,
      audio_attr: this.audioAttr,
      video_attr: this.videoAttr
    };
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/participants/${this.participantId}/rtcstreams`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class CreateStreamResponseCommand extends LiveEventResponseCommand {
  // override payload: CreateStreamResponsePayload;
  parseData(data) {
    return {
      sdp: data.sdp,
      endpoint: parseEndpoint(data.rtcstream)
    };
  }

}class GetHostsResponseCommand extends LiveEventResponseCommand {
  // override payload: GetHostsResponsePayload;
  parseData(data) {
    return {
      hosts: data.hosts.map(parseHost)
    };
  }

}class HostAliveCommand extends LiveEventAPICommand {
  constructor(liveEventId, hostId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.HOST_ALIVE);

    this.liveEventId = liveEventId;
    this.hostId = hostId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/hosts/${this.hostId}/alive`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class HostAliveResponseCommand extends LiveEventResponseCommand {
  // override payload: HostAliveResponsePayload;
  parseData(data) {
    return {};
  }

}class HostCreateStreamCommand extends LiveEventAPICommand {
  constructor(liveEventId, hostId, sdp, audioAttr, videoAttr) {
    super();

    _defineProperty(this, "type", LiveEventDataType.HOST_CREATE_STREAM);

    this.liveEventId = liveEventId;
    this.hostId = hostId;
    this.sdp = sdp;
    this.audioAttr = audioAttr;
    this.videoAttr = videoAttr;
  }

  getData() {
    return {
      sdp: this.sdp,
      audio_attr: this.audioAttr,
      video_attr: this.videoAttr
    };
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/hosts/${this.hostId}/rtcstreams`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class HostCreateStreamResponseCommand extends LiveEventResponseCommand {
  // override payload: HostCreateStreamResponsePayload;
  parseData(data) {
    return {
      sdp: data.sdp,
      endpoint: parseEndpoint(data.rtcstream)
    };
  }

}class AliveCommand extends LiveEventAPICommand {
  constructor(liveEventId, participantId) {
    super();

    _defineProperty(this, "type", LiveEventDataType.ALIVE);

    this.liveEventId = liveEventId;
    this.participantId = participantId;
  }

  getData() {
    return {};
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/participants/${this.participantId}/alive`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}
class AliveResponseCommand extends LiveEventResponseCommand {
  // override payload: AliveResponsePayload;
  parseData(data) {
    return {};
  }

}class GetParticipantsResponseCommand extends LiveEventResponseCommand {
  // override payload: GetParticipantsResponsePayload;
  parseData(data) {
    return {
      participant: parseParticipant(data.participant)
    };
  }

}class AudioCommand extends LiveEventAPICommand {
  constructor(liveEventId, hostId, on) {
    super();

    _defineProperty(this, "type", LiveEventDataType.AUDIO);

    this.liveEventId = liveEventId;
    this.hostId = hostId;
    this.on = on;
  }

  getData() {
    return {
      on: this.on
    };
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/hosts/${this.hostId}/audio`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}class VideoCommand extends LiveEventAPICommand {
  constructor(liveEventId, hostId, on) {
    super();

    _defineProperty(this, "type", LiveEventDataType.VIDEO);

    this.liveEventId = liveEventId;
    this.hostId = hostId;
    this.on = on;
  }

  getData() {
    return {
      on: this.on
    };
  }

  getSubPath() {
    return `/live-events/${this.liveEventId}/hosts/${this.hostId}/video`;
  }

  getMethod() {
    return APIMethodType.POST;
  }

}class HostDisconnectedEventCommand extends EventCommand {
  // override payload: ReturnType<HostDisconnectedEventCommand['parseData']>;
  parseData(data) {
    return {
      liveEventId: data.live_event_id,
      host: parseHost(data.host)
    };
  }

}class LiveCommandFactory {
  static createAuth(appId, userId, accessToken) {
    return new AuthCommand(appId, userId, accessToken);
  }

  static createLiveEvent(hostType, hostIds) {
    return new CreateLiveEventCommand(hostType, hostIds);
  }

  static createGetLiveEvent(liveEventId) {
    return new GetLiveEventCommand(liveEventId);
  }

  static createEnterHost(liveEventId, mediaOption) {
    return new EnterHostCommand(liveEventId, mediaOption);
  }

  static createReady(liveEventId) {
    return new ReadyCommand(liveEventId);
  }

  static createStart(liveEventId) {
    return new StartCommand(liveEventId);
  }

  static createExitHost(liveEventId, hostId) {
    return new ExitHostCommand(liveEventId, hostId);
  }

  static createEndLiveEvent(liveEventId) {
    return new EndLiveEventCommand(liveEventId);
  }

  static createEnter(liveEventId) {
    return new EnterCommand(liveEventId);
  }

  static createExit(liveEventId, participantId) {
    return new ExitCommand(liveEventId, participantId);
  }

  static createConnected(liveEventId, participantId, endpointId) {
    return new ConnectedCommand(liveEventId, participantId, endpointId);
  }

  static createHostConnected(liveEventId, hostId, endpointId) {
    return new HostConnectedCommand(liveEventId, hostId, endpointId);
  }

  static createStream(liveEventId, participantId, sdp, audioAttr, videoAttr) {
    return new CreateStreamCommand(liveEventId, participantId, sdp, audioAttr, videoAttr);
  }

  static createHostCreateStream(liveEventId, hostId, sdp, audioAttr, videoAttr) {
    return new HostCreateStreamCommand(liveEventId, hostId, sdp, audioAttr, videoAttr);
  }

  static createDeleteStream(liveEventId, participantId, endpointId) {
    return new DeleteStreamCommand(liveEventId, participantId, endpointId);
  }

  static createHostDeleteStream(liveEventId, hostId, endpointId) {
    return new HostDeleteStreamCommand(liveEventId, hostId, endpointId);
  }

  static createAttach(liveEventId, participantId, endpointId, attachTo) {
    return new AttachCommand(liveEventId, participantId, endpointId, attachTo);
  }

  static createAudio(liveEventId, hostId, on) {
    return new AudioCommand(liveEventId, hostId, on);
  }

  static createVideo(liveEventId, hostId, on) {
    return new VideoCommand(liveEventId, hostId, on);
  }

  static createAlive(liveEventId, participantId) {
    return new AliveCommand(liveEventId, participantId);
  }

  static createHostAlive(liveEventId, participantId) {
    return new HostAliveCommand(liveEventId, participantId);
  }

  static parseResponse(command, json) {
    try {
      switch (command.type) {
        case LiveEventDataType.CREATE:
          return new CreateLiveEventResponseCommand(json);

        case LiveEventDataType.GET:
          return new GetLiveEventResponseCommand(json);

        case LiveEventDataType.DELETE:
          return new EndLiveEventResponseCommand(json);

        case LiveEventDataType.QUERY:
          return new LiveEventListQueryResponseCommand(json);

        case LiveEventDataType.READY:
          return new ReadyResponseCommand(json);

        case LiveEventDataType.START:
          return new StartResponseCommand(json);

        case LiveEventDataType.ENTER_HOST:
          return new EnterHostResponseCommand(json);

        case LiveEventDataType.GET_HOSTS:
          return new GetHostsResponseCommand(json);

        case LiveEventDataType.EXIT_HOST:
          return new ExitHostResponseCommand(json);

        case LiveEventDataType.HOST_ALIVE:
          return new HostAliveResponseCommand(json);

        case LiveEventDataType.AUDIO:
          return new HostAudioStatusChangedEventCommand(json);

        case LiveEventDataType.VIDEO:
          return new HostVideoStatusChangedEventCommand(json);

        case LiveEventDataType.HOST_CREATE_STREAM:
          return new HostCreateStreamResponseCommand(json);

        case LiveEventDataType.HOST_DELETE_STREAM:
          return new HostDeleteStreamResponseCommand(json);

        case LiveEventDataType.HOST_CONNECTED:
          return new HostConnectedResponseCommand(json);

        case LiveEventDataType.ENTER:
          return new EnterResponseCommand(json);

        case LiveEventDataType.EXIT:
          return new ExitResponseCommand(json);

        case LiveEventDataType.ALIVE:
          return new AliveResponseCommand(json);

        case LiveEventDataType.GET_PARTICIPANTS:
          return new GetParticipantsResponseCommand(json);

        case LiveEventDataType.CREATE_STREAM:
          return new CreateStreamResponseCommand(json);

        case LiveEventDataType.DELETE_STREAM:
          return new DeleteStreamResponseCommand(json);

        case LiveEventDataType.CONNECTED:
          return new ConnectedResponseCommand(json);

        case LiveEventDataType.ATTACH:
          return new AttachResponseCommand(json);
      }
    } catch (e) {
      // TODO :: logger
      // logger.error(new ClientError(ErrorCode.ERR_WRONG_RESPONSE, { error }));
      return undefined;
    }
  }

  static parse(json) {
    if (json.call_type !== 'live') return;

    try {
      switch (json.type) {
        case LiveEventDataType.LIVE_EVENT_READY:
          return new ReadyEventCommand(json);

        case LiveEventDataType.LIVE_EVENT_STARTED:
          return new StartedEventCommand(json);

        case LiveEventDataType.LIVE_EVENT_ENDED:
          return new EndedEventCommand(json);

        case LiveEventDataType.HOST_ENTERED:
          return new HostEnteredEventCommand(json);

        case LiveEventDataType.HOST_EXITED:
          return new HostExitedEventCommand(json);

        case LiveEventDataType.HOST_CONNECTED:
          return new HostConnectedEventCommand(json);

        case LiveEventDataType.HOST_DISCONNECTED:
          return new HostDisconnectedEventCommand(json);

        case LiveEventDataType.HOST_AUDIO_STATUS_CHANGED:
          return new HostAudioStatusChangedEventCommand(json);

        case LiveEventDataType.HOST_VIDEO_STATUS_CHANGED:
          return new HostVideoStatusChangedEventCommand(json);

        case LiveEventDataType.PARTICIPANT_ENTERED:
          return new ParticipantEnteredEventCommand(json);

        case LiveEventDataType.PARTICIPANT_EXITED:
          return new ParticipantExitedEventCommand(json);
      }
    } catch (error) {
      // TODO :: logger
      // logger.error(new ClientError(ErrorCode.ERR_WRONG_RESPONSE, { error }));
      return undefined;
    }
  }

}// Reference: https://developer.mozilla.org/en-US/docs/Web/API/EventTarget
// Reference: https://nodejs.org/api/events.html#events_class_eventemitter
// However the implementation is slightly different
class EventTarget {
  constructor() {
    _defineProperty(this, "_listeners", {});

    _defineProperty(this, "on", this.addEventListener);

    _defineProperty(this, "off", this.removeEventListener);
  }

  addEventListener(type, callback) {
    if (!(type in this._listeners)) {
      this._listeners[type] = [];
    }

    this._listeners[type].push(callback);

    return () => this.removeEventListener(type, callback);
  }

  once(type, givenCb) {
    const _this = this;

    const cb = function () {
      givenCb(...arguments);

      _this.removeEventListener(type, cb);
    };

    return this.on(type, cb);
  }

  removeEventListener(type, callback) {
    if (!(type in this._listeners)) {
      return;
    }

    const stack = this._listeners[type];

    for (let i = 0, l = stack.length; i < l; i++) {
      if (stack[i] === callback) {
        stack.splice(i, 1);
        return;
      }
    }
  }

  removeAllEventListeners() {
    this._listeners = {};
  }

  _dispatchEvent(type) {
    if (!(type in this._listeners)) {
      return;
    }

    const stack = this._listeners[type].slice();

    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      args[_key - 1] = arguments[_key];
    }

    for (let i = 0, l = stack.length; i < l; i++) {
      stack[i].call(this, ...args);
    }
  }

}
/**
 Cobb, TODO: dispatch along with direct method call in _dispatchEvent
 ex:
 ```ts
   dispatch({ event: 'recordingSucceeded' });
   this._onRecordingSucceeded();
 ```
 */let LEVELS;

(function (LEVELS) {
  LEVELS["VERBOSE"] = "VERBOSE";
  LEVELS["DEBUG"] = "DEBUG";
  LEVELS["INFO"] = "INFO";
  LEVELS["WARNING"] = "WARNING";
  LEVELS["ERROR"] = "ERROR";
  LEVELS["NONE"] = "NONE";
})(LEVELS || (LEVELS = {}));class Logger {
  constructor() {
    this._listeners = [];
  }

  verbose() {
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    this._log(LEVELS.VERBOSE, ...args);
  }

  debug() {
    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }

    this._log(LEVELS.DEBUG, ...args);
  }

  info() {
    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      args[_key3] = arguments[_key3];
    }

    this._log(LEVELS.INFO, ...args);
  }

  warning() {
    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
      args[_key4] = arguments[_key4];
    }

    this._log(LEVELS.WARNING, ...args);
  }

  error() {
    for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {
      args[_key5] = arguments[_key5];
    }

    this._log(LEVELS.ERROR, ...args);
  }

  _log(lv) {
    for (var _len6 = arguments.length, args = new Array(_len6 > 1 ? _len6 - 1 : 0), _key6 = 1; _key6 < _len6; _key6++) {
      args[_key6 - 1] = arguments[_key6];
    }

    for (let listener of this._listeners) {
      listener._permit(lv, ...args);
    }
  }

  addListener(listener) {
    this._listeners.push(listener);
  }

  removeListener(listener) {
    const index = this._listeners.indexOf(listener);

    if (index !== -1) {
      this._listeners.splice(index, 1);
    }
  }

  removeAllListener() {
    this._listeners = [];
  } // private _makeSDKLogMessage(...args: any[]) {
  //   // TODO: Improve Serialization
  //   // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Using_JSON.stringify
  //   const sdkLog = args.map(arg => JSON.stringify(arg));
  //   return maskPrivateData(sdkLog.toString());
  // }


}

const logger = new Logger();// TODO:: I think it's better to make a global declare file
const isInvalidValue = value => typeof value === 'undefined' || Number.isNaN(value) || value === '' || value === [];

const deleteEmptyValues = obj => {
  Object.keys(obj).forEach(key => {
    if (isInvalidValue(obj[key])) {
      delete obj[key];
    }
  });
};
const getCandidateInfo = async rtcConnection => {
  if (!rtcConnection) {
    throw new Error(`'getCandidateInfo()' is called without rtcConnection`);
  }

  const rtcStatsReport = await rtcConnection.getStats();
  let localCandidateId;
  const reportsIter = rtcStatsReport.entries();
  let index = 0;

  for (; index < rtcStatsReport.size; index++) {
    const {
      value
    } = reportsIter.next();
    if (!value) continue;
    const report = value[1];

    if (report.type === 'candidate-pair' && report.state === 'succeeded') {
      // get active local-candidate id, because firefox have two local-candidate information.
      localCandidateId = report.localCandidateId;
      break;
    }
  }

  for (; index < rtcStatsReport.size; index++) {
    const {
      value
    } = reportsIter.next();
    if (!value) continue;
    const report = value[1];

    if (report.type === 'local-candidate' && report.id === localCandidateId) {
      return {
        connectionType: report.candidateType ?? '',
        protocol: report.protocol ?? '',
        relayProtocol: report.relayProtocol ?? ''
      };
    }
  }

  return null;
};

const parseStats = async rtcStats => {
  const statsLog = {};
  const transportInfo = {};
  const audio = {};
  const video = {};
  const codecInfo = new Map();
  const activeMediaSource = new Map();
  let localCandidateId;
  rtcStats.forEach(report => {
    // get pre-information about webrtc status
    if (report.type === 'codec') {
      codecInfo.set(report.id, report);
    }

    if (report.type === 'candidate-pair' && report.state === 'succeeded') {
      // get local-candidate id with state's value is succeeded
      localCandidateId = report.localCandidateId;
      statsLog.webrtc_timestamp = report.time;
    } // get active media resource infomation


    if (report.type === 'media-source') {
      activeMediaSource.set(report.kind, report);
    }
  });
  rtcStats.forEach(report => {
    // get local network status
    if (report.type === 'local-candidate' && report.id === localCandidateId) {
      transportInfo.network_type = report.networkType;
      transportInfo.protocol = report.protocol;
      transportInfo.candidate_type = report.candidateType;
    } // get webrtc status about audio


    if (report.kind === 'audio' || report.mediaType === 'audio') {
      // status of sending audio
      if (report.type === 'outbound-rtp') {
        audio.codec = codecInfo.get(report.codecId)?.mimeType;
        audio.total_packets_sent = report.packetsSent;
        audio.retransmitted_packets_sent = report.retransmittedPacketsSent;
      } // the other endpoint's received audio status.


      if (report.type === 'remote-inbound-rtp') {
        audio.rtt = report.roundTripTime * 1000;
      } // status of received audio in local


      if (report.type === 'inbound-rtp') {
        const totalPacketsLostRate = report.packetsLost / (report.packetsLost + report.packetsReceived) * 100;
        audio.total_packets_received = report.packetsReceived;
        audio.total_packets_lost_rate = totalPacketsLostRate;
        audio.total_packets_lost = report.packetsLost;
        audio.jitter = report.jitter * 1000;
      }

      if (report.type === 'track') {
        if (report.remoteSource) {
          // local received audio status.
          audio.jitter_buffer_delay = report.jitterBufferDelay;
          audio.jitter_buffer_emitted_count = report.jitterBufferDelayEmittedCount;
        }
      }
    } // get webrtc status of video


    if (report.kind === 'video' || report.mediaType === 'video') {
      // set video resource information.
      video.video_source_width = activeMediaSource.get('video')?.width;
      video.video_source_height = activeMediaSource.get('video')?.height;
      video.video_source_frames_per_second = activeMediaSource.get('video')?.framesPerSecond; // status of sending video

      if (report.type === 'outbound-rtp') {
        video.codec = codecInfo.get(report.codecId)?.mimeType;
        video.fir_count = report.firCount;
        video.pli_count = report.pliCount;
        video.nack_count = report.nackCount;
        video.qp_sum = report.qpSum;
        video.retransmitted_packets_sent = report.retransmittedBytesSent;
        video.quality_limitation_reason = report.qualityLimitationReason;
        video.quality_limitation_resolution_changes = report.qualityLimitationResolutionChanges;
      } // the other endpoint's received video status.


      if (report.type === 'remote-inbound-rtp') {
        video.rtt = report.roundTripTime * 1000;
      } // status of received video in local


      if (report.type === 'inbound-rtp') {
        video.header_bytes_received = report.headerBytesReceived;
        video.key_frames_decoded = report.keyFramesDecoded;
        video.total_decode_time = report.totalDecodeTime;
        video.total_inter_frame_delay = report.totalInterFrameDelay;
        video.total_squared_inter_frame_delay = report.totalSquaredInterFrameDelay;
        const totalPacketsLostRate = report.packetsLost / (report.packetsLost + report.packetsReceived) * 100;
        video.total_packets_lost = report.packetsLost;
        video.total_packets_received = report.packetsReceived;
        video.total_packets_lost_rate = totalPacketsLostRate;
      }

      if (report.type === 'track') {
        if (report.remoteSource) {
          // local received video status.
          video.jitter_buffer_delay = report.jitterBufferDelay;
          video.jitter_buffer_emitted_count = report.jitterBufferDelayEmittedCount;
          video.received_frame_width = report.frameWidth;
          video.received_frame_height = report.frameHeight;
          video.frames_received = report.framesReceived;
          video.frames_decoded = report.framesDecoded;
          video.frames_dropped = report.framesDropped;
          video.freeze_count = report.freezeCount;
          video.pause_count = report.pauseCount;
          video.total_freezes_duration = report.totalFreezesDuration;
          video.total_pauses_duration = report.totalPausesDuration;
          video.total_frames_duration = report.totalFramesDuration;
          video.sum_of_squared_frames_duration = report.sumOfSquaredFramesDuration;
        } else {
          // local sent video status.
          video.sent_frame_width = report.frameWidth;
          video.sent_frame_height = report.frameHeight;
        }
      }
    }
  });
  deleteEmptyValues(transportInfo);
  deleteEmptyValues(audio);
  deleteEmptyValues(video);
  statsLog.transport_info = transportInfo;
  statsLog.audio = audio;
  statsLog.video = video; // TODO: How to delete if it's audio call

  return statsLog;
};

const getStatsLog = async rtcConnection => {
  if (!rtcConnection) {
    throw new Error(`'getStats()' is called without rtcConnection`);
  }

  const rtcStatsReport = await rtcConnection.getStats();
  return parseStats(rtcStatsReport);
};class StateMutator {
  constructor(_context) {
    this._context = _context;
  }

  get state() {
    return this._state;
  }

  _changeState(state) {
    if (this._state && this._state.type === state.type) {
      // logger.error(new Error('self-transition is not allowed'));
      return;
    } // logger.debug(`[${this.name}] state: ${this._state ? this._state.type : 'null'} -> ${state.type}`);


    if (this._state) {
      this._state.destroy();
    }

    this._state = state;
    this._state.context = this._context;

    this._state.start();
  }

}class State {
  constructor(_stateMutator) {
    this._stateMutator = _stateMutator;
  }

  set context(context) {
    this._context = context;
  }

  start() {
    this._onStart();
  }

  destroy() {
    this._onDestroy();
  }

}class StateMachine {
  constructor(_context, _stateMutator) {
    this._context = _context;
    this._stateMutator = _stateMutator;
    this._context = _context;
    this._stateMutator = _stateMutator;
  }

  get state() {
    return this._stateMutator.state;
  }

}class PeerConnectionState extends State {
  constructor(stateMutator) {
    super(stateMutator);
  }

}let PeerConnectionStateType;

(function (PeerConnectionStateType) {
  PeerConnectionStateType["IDLE"] = "idle";
  PeerConnectionStateType["OFFERING"] = "offering";
  PeerConnectionStateType["ANSWERING"] = "answering";
  PeerConnectionStateType["CONNECTED"] = "connected";
  PeerConnectionStateType["RECONNECTING"] = "reconnecting";
  PeerConnectionStateType["ICE_RESTART_OFFERING"] = "iceRestartOffering";
  PeerConnectionStateType["ICE_RESTART_ANSWERING"] = "iceRestartAnswering";
  PeerConnectionStateType["CLOSED"] = "closed";
})(PeerConnectionStateType || (PeerConnectionStateType = {}));class PeerConnectionAnsweringState extends PeerConnectionState {
  constructor(stateMutator, offerCommand) {
    super(stateMutator);

    _defineProperty(this, "type", PeerConnectionStateType.ANSWERING);

    this._offerCommand = offerCommand;
  }

  _onStart() {
    this._context.dispatchEvent('answering');

    this._context.createRTCConnection();

    if (this._offerCommand) {
      this.onOfferReceived(this._offerCommand);
    }
  }

  _onDestroy() {}

  async onOfferReceived(command) {
    await this._context.setRemoteDescription('offer', command.payload.sdp);

    this._context.prepareSessionDescription();

    this._context.sendAnswer().catch(e => {// logger.debug(e)
    });
  }

  onIceConnected() {
    this._stateMutator.toConnected(false);
  }

  onClose() {
    this._stateMutator.toClosed();
  }

}class PeerConnectionClosedState extends PeerConnectionState {
  constructor() {
    super(...arguments);

    _defineProperty(this, "type", PeerConnectionStateType.CLOSED);
  }

  _onStart() {
    this._context.dispatchEvent('closed');
  }

  _onDestroy() {}

}class PeerConnectionConnectedState extends PeerConnectionState {
  constructor(stateMutator, isReconnected) {
    super(stateMutator);

    _defineProperty(this, "type", PeerConnectionStateType.CONNECTED);

    this._isReconnected = isReconnected;
  }

  _onStart() {
    this._context.dispatchEvent('connected');
  }

  _onDestroy() {}

  async onOfferReceived(command) {
    this._stateMutator.toReconnecting(command);
  }

  onIceDisconnected() {
    this._stateMutator.toReconnecting();
  }

  onIceFailed() {
    if (this._context.isDisposable) {
      this.onClose();
    }

    if (this._context.isInitiator) {
      this._stateMutator.toIceRestartOffering();
    } else {
      this._stateMutator.toIceRestartAnswering();
    }
  }

  onClose() {
    this._stateMutator.toClosed();
  }

}class PeerConnectionIceRestartAnsweringState extends PeerConnectionState {
  constructor(stateMutator, offerCommand) {
    super(stateMutator);

    _defineProperty(this, "type", PeerConnectionStateType.ICE_RESTART_ANSWERING);

    this._offerCommand = offerCommand;
  }

  _onStart() {
    this._context.dispatchEvent('iceRestartAnswering');

    if (this._offerCommand) {
      this.onOfferReceived(this._offerCommand);
    }
  }

  _onDestroy() {}

  async onOfferReceived(command) {
    await this._context.setRemoteDescription('offer', command.payload.sdp);

    this._context.sendAnswer().catch(e => {// logger.debug(e)
    });
  }

  onIceConnected() {
    this._stateMutator.toConnected(true);
  }

  onClose() {
    this._stateMutator.toClosed();
  }

}class PeerConnectionIceRestartOfferingState extends PeerConnectionState {
  constructor() {
    super(...arguments);

    _defineProperty(this, "type", PeerConnectionStateType.ICE_RESTART_OFFERING);
  }

  _onStart() {
    this._context.dispatchEvent('iceRestartOffering');

    this._context.sendOffer(true);
  }

  _onDestroy() {}

  onAnswerReceived(command) {
    this._context.setRemoteDescription('answer', command.payload.sdp);
  }

  onIceConnected() {
    this._stateMutator.toConnected(true);
  }

  onClose() {
    this._stateMutator.toClosed();
  }

}class PeerConnectionIdleState extends PeerConnectionState {
  constructor() {
    super(...arguments);

    _defineProperty(this, "type", PeerConnectionStateType.IDLE);
  }

  _onStart() {}

  _onDestroy() {}

  createOffer() {
    this._stateMutator.toOffering();
  }

  async onOfferReceived(offerCommand) {
    this._stateMutator.toAnswering(offerCommand);
  }

  onClose() {
    this._stateMutator.toClosed();
  }

}class PeerConnectionOfferingState extends PeerConnectionState {
  constructor() {
    super(...arguments);

    _defineProperty(this, "type", PeerConnectionStateType.OFFERING);
  }

  _onStart() {
    this._context.dispatchEvent('offering');

    this._context.createRTCConnection();

    this._context.prepareSessionDescription();
  }

  _onDestroy() {}

  onAnswerReceived(command) {
    this._context.setRemoteDescription('answer', command.payload.sdp);
  }

  onIceConnected() {
    this._stateMutator.toConnected(false);
  }

  onClose() {
    this._stateMutator.toClosed();
  }

}class PeerConnectionReconnectingState extends PeerConnectionState {
  constructor(stateMutator, offerCommand) {
    super(stateMutator);

    _defineProperty(this, "type", PeerConnectionStateType.RECONNECTING);

    this._offerCommand = offerCommand;
  }

  _onStart() {
    this._context.dispatchEvent('reconnecting');

    if (this._offerCommand) {
      this.onOfferReceived(this._offerCommand);
    }
  }

  _onDestroy() {}

  onOfferReceived(command) {
    this._stateMutator.toIceRestartAnswering(command);
  }

  onIceConnected() {
    this._stateMutator.toConnected(true);
  }

  onIceFailed() {
    if (this._context.isDisposable) {
      this.onClose();
    }

    if (this._context.isInitiator) {
      this._stateMutator.toIceRestartOffering();
    } else {
      this._stateMutator.toIceRestartAnswering();
    }
  }

  onClose() {
    this._stateMutator.toClosed();
  }

}class PeerConnectionStateMutator extends StateMutator {
  get state() {
    return this._state;
  }

  get name() {
    return 'PeerConnection';
  }

  toIdle() {
    this._changeState(new PeerConnectionIdleState(this));
  }

  toOffering() {
    this._changeState(new PeerConnectionOfferingState(this));
  }

  toAnswering(offerCommand) {
    this._changeState(new PeerConnectionAnsweringState(this, offerCommand));
  }

  toConnected(isReconnected) {
    this._changeState(new PeerConnectionConnectedState(this, isReconnected));
  }

  toReconnecting(offerCommand) {
    this._changeState(new PeerConnectionReconnectingState(this, offerCommand));
  }

  toIceRestartOffering() {
    this._changeState(new PeerConnectionIceRestartOfferingState(this));
  }

  toIceRestartAnswering(offerCommand) {
    this._changeState(new PeerConnectionIceRestartAnsweringState(this, offerCommand));
  }

  toClosed() {
    this._changeState(new PeerConnectionClosedState(this));
  }

}class PeerConnectionStateMachine extends StateMachine {
  constructor(context) {
    super(context, new PeerConnectionStateMutator(context));

    this._stateMutator.toIdle();
  }

  get state() {
    return this._stateMutator.state;
  }

  onOfferReceived(command) {
    logger.verbose(`[${this.state.type}] onOfferReceived`);
    const {
      state
    } = this;

    switch (state.type) {
      case PeerConnectionStateType.IDLE:
        state.onOfferReceived(command);
        break;

      case PeerConnectionStateType.ANSWERING:
        state.onOfferReceived(command);
        break;

      case PeerConnectionStateType.CONNECTED:
        state.onOfferReceived(command);
        break;

      case PeerConnectionStateType.RECONNECTING:
        state.onOfferReceived(command);
        break;

      case PeerConnectionStateType.ICE_RESTART_ANSWERING:
        state.onOfferReceived(command);
        break;

      default:
        logger.error(`[${this.state.type}] onOfferReceived`);
    }
  }

  onAnswerReceived(command) {
    logger.verbose(`[${this.state.type}] onAnswerReceived`);
    const {
      state
    } = this;

    switch (state.type) {
      case PeerConnectionStateType.OFFERING:
        state.onAnswerReceived(command);
        break;

      case PeerConnectionStateType.ICE_RESTART_OFFERING:
        state.onAnswerReceived(command);
        break;

      default:
        logger.error(`[${this.state.type}] onAnswerReceived`);
    }
  }

  onClose() {
    logger.verbose(`[${this.state.type}] onClose`);
    const {
      state
    } = this;

    switch (state.type) {
      case PeerConnectionStateType.IDLE:
        state.onClose();
        break;

      case PeerConnectionStateType.OFFERING:
        state.onClose();
        break;

      case PeerConnectionStateType.ANSWERING:
        state.onClose();
        break;

      case PeerConnectionStateType.CONNECTED:
        state.onClose();
        break;

      case PeerConnectionStateType.RECONNECTING:
        state.onClose();
        break;

      case PeerConnectionStateType.ICE_RESTART_OFFERING:
        state.onClose();
        break;

      case PeerConnectionStateType.ICE_RESTART_ANSWERING:
        state.onClose();
        break;

      default:
        logger.error(`[${this.state.type}] onClose`);
    }
  }

  createOffer() {
    logger.verbose(`[${this.state.type}] createOffer`);
    const {
      state
    } = this;

    switch (state.type) {
      case PeerConnectionStateType.IDLE:
        state.createOffer();
        break;

      default:
        logger.error(`[${this.state.type}] createOffer`);
    }
  }

  onIceConnected() {
    logger.verbose(`[${this.state.type}] onIceConnected`);
    const {
      state
    } = this;

    switch (state.type) {
      case PeerConnectionStateType.OFFERING:
        state.onIceConnected();
        break;

      case PeerConnectionStateType.ANSWERING:
        state.onIceConnected();
        break;

      case PeerConnectionStateType.RECONNECTING:
        state.onIceConnected();
        break;

      case PeerConnectionStateType.ICE_RESTART_OFFERING:
        state.onIceConnected();
        break;

      case PeerConnectionStateType.ICE_RESTART_ANSWERING:
        state.onIceConnected();
        break;

      default:
        logger.error(`[${this.state.type}] onIceConnected`);
    }
  }

  onIceDisconnected() {
    logger.verbose(`[${this.state.type}] onIceDisconnected`);
    const {
      state
    } = this;

    switch (state.type) {
      case PeerConnectionStateType.CONNECTED:
        state.onIceDisconnected();
        break;

      default:
        logger.error(`[${this.state.type}] onIceDisconnected`);
    }
  }

  onIceFailed() {
    logger.verbose(`[${this.state.type}] onIceFailed`);
    const {
      state
    } = this;

    switch (state.type) {
      case PeerConnectionStateType.CONNECTED:
        state.onIceFailed();
        break;

      case PeerConnectionStateType.RECONNECTING:
        state.onIceFailed();
        break;

      default:
        logger.error(`[${this.state.type}] onIceFailed`);
    }
  }

}let IceTransportPolicyType;

(function (IceTransportPolicyType) {
  IceTransportPolicyType["RELAY"] = "relay";
  IceTransportPolicyType["ALL"] = "all";
})(IceTransportPolicyType || (IceTransportPolicyType = {}));class PeerConnection extends EventTarget {
  constructor(_ctx, id, // Empty string means initial peer connection (for anything)
  _signalingClient, _localStream, _isInitiator, _turnCredential, _mediaDirections, _isDisposable) {
    super();
    this._ctx = _ctx;
    this.id = id;
    this._signalingClient = _signalingClient;
    this._localStream = _localStream;
    this._isInitiator = _isInitiator;
    this._turnCredential = _turnCredential;
    this._mediaDirections = _mediaDirections;
    this._isDisposable = _isDisposable;
    this._stateMachine = new PeerConnectionStateMachine({
      dispatchEvent: this._dispatchEvent.bind(this),
      isInitiator: this._isInitiator,
      setRemoteDescription: this._setRemoteDescription.bind(this),
      sendAnswer: this._sendAnswer.bind(this),
      sendOffer: this._sendOffer.bind(this),
      createRTCConnection: this._createRTCConnection.bind(this),
      prepareSessionDescription: this._prepareSessionDescription.bind(this),
      isDisposable: this._isDisposable
    });

    if (_localStream) {
      _localStream.on('streamChanged', stream => this.onLocalStream(stream));
    }
  }

  get _state() {
    return this._stateMachine.state;
  }

  get rtcConnection() {
    return this._rtcConnection;
  }

  get remoteStream() {
    return this._remoteStream;
  }

  get signalingClient() {
    return this._signalingClient;
  } // TODO: Narrow down command type, remove directCallCommand dependency


  onEvent(command) {
    switch (command.type) {
      case PeerConnectionDataType$1.CANDIDATE:
        this._receiveCandidate(command);

        return;

      case PeerConnectionDataType$1.OFFER:
        this._stateMachine.onOfferReceived(command);

        break;

      case PeerConnectionDataType$1.ANSWER:
        this._stateMachine.onAnswerReceived(command);

        break;

      default:
        logger.error(new Error(`unhandled call event ${command}`));
    }
  }

  createOffer() {
    this._stateMachine.createOffer();
  }

  close() {
    this._closeRTCConnection();

    this._stateMachine.onClose();
  }

  onLocalStream(stream) {
    if (!this._rtcConnection) return;

    for (const track of stream.getTracks()) {
      this._replaceTrack(track);
    }
  }

  async getCandidateInfo() {
    return getCandidateInfo(this.rtcConnection);
  }

  async getStatsLog() {
    return getStatsLog(this.rtcConnection);
  }

  _replaceTrack(track) {
    for (const sender of this._rtcConnection.getSenders()) {
      if (sender.track && sender.track.kind === track.kind) {
        sender.replaceTrack(track);
      }
    }
  }

  _createRTCConnection() {
    let peerConnectionOptions;

    if (this._turnCredential) {
      peerConnectionOptions = {
        iceServers: [{
          username: this._turnCredential.username,
          credential: this._turnCredential.password,
          urls: this._turnCredential.turnUrls
        }],
        // FIXME :: fix this
        // iceTransportPolicy: ICE_TRANSPORT_POLICY || this._turnCredential.transportPolicy || IceTransportPolicyType.ALL,
        iceTransportPolicy: this._turnCredential.transportPolicy || IceTransportPolicyType.ALL
      };
    }

    const rtcConnection = new RTCPeerConnection(peerConnectionOptions);

    rtcConnection.onnegotiationneeded = () => {
      this._sendOffer(false);
    };

    rtcConnection.onicecandidate = ev => {
      if (ev.candidate) {
        this._signalingClient.sendCandidate?.(ev.candidate);
      }
    };

    rtcConnection.onconnectionstatechange = () => this._handleConnectionStateChange(rtcConnection);

    rtcConnection.oniceconnectionstatechange = () => this._handleIceConnectionStateChange(rtcConnection);

    rtcConnection.ontrack = ev => this._onRemoteTrack(ev);

    this._rtcConnection = rtcConnection;
  }

  _closeRTCConnection() {
    if (this._rtcConnection) {
      this._rtcConnection.onnegotiationneeded = null;
      this._rtcConnection.onicecandidate = null; // Cobb: Why no onIceCandidatesRemoved?

      this._rtcConnection.oniceconnectionstatechange = null;
      this._rtcConnection.onconnectionstatechange = null;

      this._rtcConnection.close();

      this._rtcConnection = null;
      delete this._remoteStream;
    }
  }

  _prepareSessionDescription() {
    const {
      audio,
      video
    } = this._mediaDirections;
    const directions = {
      sendrecv: [],
      sendonly: [],
      recvonly: [],
      none: []
    };
    directions[audio].push('audio');
    directions[video].push('video');
    if (directions.sendrecv.length) this._addTracks(directions.sendrecv);
    if (directions.sendonly.length) this._addSendOnlyTransceivers(directions.sendonly);
    if (directions.recvonly.length) this._addReceiveOnlyTransceivers(directions.recvonly);
  }

  _addTracks(kinds) {
    logger.debug('_addTracks()');
    const {
      localStream
    } = this._localStream;
    localStream.getTracks().forEach(track => {
      if (kinds.includes(track.kind)) this._rtcConnection.addTrack(track, localStream);
    });
  }

  _addReceiveOnlyTransceivers(kinds) {
    kinds.forEach(kind => {
      this._rtcConnection.addTransceiver(kind, {
        direction: 'recvonly'
      });
    });
  }

  _addSendOnlyTransceivers(kinds) {
    const {
      localStream
    } = this._localStream;
    kinds.forEach(kind => {
      localStream.getTracks().forEach(track => {
        if (track.kind === kind) this._rtcConnection.addTransceiver(track, {
          direction: 'sendonly',
          streams: [localStream]
        });
      });
    });
  }

  _setRemoteDescription(type, sdp) {
    // issue: calls-3875
    // chromium 100 version adds this line and recv session of group call doesn't work.
    const newSdp = sdp.replace(/a=extmap:0 ulpfec\r\n/, '');
    const remoteDesc = new RTCSessionDescription({
      type,
      sdp: newSdp
    });
    return this._rtcConnection.setRemoteDescription(remoteDesc);
  }

  async _sendOffer(iceRestart) {
    const option = {
      iceRestart: iceRestart || false
    };
    const offer = await this._rtcConnection.createOffer(option);
    await this._rtcConnection.setLocalDescription(offer);
    return this._signalingClient.sendOfferSdp(this._rtcConnection.localDescription);
  }

  async _sendAnswer() {
    const answer = await this._rtcConnection.createAnswer();
    answer.sdp = answer.sdp.replace('actpass', 'active');
    await this._rtcConnection.setLocalDescription(answer);
    return this._signalingClient.sendAnswerSdp(this._rtcConnection.localDescription);
  }

  _handleIceConnectionStateChange(rtcConnection) {
    logger.verbose(`[${this._state.type}] iceConnectionState ${rtcConnection.iceConnectionState}`);

    switch (rtcConnection.iceConnectionState) {
      case 'connected':
        this._stateMachine.onIceConnected();

        break;

      case 'disconnected':
        this._stateMachine.onIceDisconnected();

        break;

      case 'failed':
        this._dispatchEvent('iceFailed');

        break;
    }
  }

  _handleConnectionStateChange(rtcConnection) {
    logger.verbose(`[${this._state.type}] connectionState ${rtcConnection.connectionState}`);
  } // TODO: Remove DirectCallCommand dependency


  _receiveCandidate(command) {
    const {
      candidate
    } = command.payload;

    this._rtcConnection.addIceCandidate({
      sdpMLineIndex: candidate.sdpMLineIndex,
      sdpMid: candidate.sdpMid,
      candidate: candidate.sdp
    }).catch(error => {
      logger.error(error);
    });
  }

  _onRemoteTrack(ev) {
    this._remoteStream = ev.streams[0];

    this._dispatchEvent('remoteStream', this._remoteStream);
  }

}let PeerConnectionDataType$1;

(function (PeerConnectionDataType) {
  PeerConnectionDataType["OFFER"] = "offer";
  PeerConnectionDataType["ANSWER"] = "answer";
  PeerConnectionDataType["CANDIDATE"] = "candidate";
})(PeerConnectionDataType$1 || (PeerConnectionDataType$1 = {}));class Deferred {
  constructor() {
    this.promise = new Promise((resolve, reject) => {
      this.resolve = resolve;
      this.reject = reject;
    });
  }

}const sendWithRetry = async function (strategy, request, listeners) {
  let meta = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {
    count: 0,
    deferred: new Deferred()
  };
  const {
    deferred,
    count
  } = meta;

  try {
    const res = await request();
    if (count > 0) listeners.onRecover?.();
    deferred.resolve(res);
  } catch (e) {
    listeners.onError?.(e);
    const timeout = strategy.calcTimeout(count + 1);

    if (timeout >= 0) {
      listeners.onRetrial?.(count + 1, e);
      setTimeout(() => {
        sendWithRetry(strategy, request, listeners, {
          count: count + 1,
          deferred
        });
      }, timeout);
      return deferred.promise;
    }

    deferred.reject(e);
  }

  return deferred.promise;
};class IncrementalStrategy {
  calcTimeout(count) {
    switch (count) {
      case 1:
        return 1000;

      case 2:
        return 2000;

      case 3:
        return 3000;

      default:
        return -1;
    }
  }

}class RandomNoise {
  constructor(interval, noise, maxRetrial) {
    this.interval = interval;
    this.noise = noise;
    this.maxRetrial = maxRetrial;
  }

  calcTimeout(count) {
    if (count > this.maxRetrial) return -1;
    return count * this.interval + (Math.random() - 0.5) * this.noise * 2;
  }

}// import { ErrorCode } from 'common/errors/errorCode';

class RequestMap {
  constructor(timeoutTime) {
    this._requests = new Map();
    this.timeoutTime = timeoutTime;
  }

  has(key) {
    return this._requests.has(key);
  }

  get(key) {
    return this._requests.get(key);
  }

  register(requestId) {
    if (!requestId) throw new Error(`invalid request id`); // TODO: Return promise rejection

    if (this._requests.has(requestId)) throw new Error('duplicate requests'); // TODO: Return promise rejection

    const deferred = new Deferred();

    this._requests.set(requestId, {
      deferred,
      timer: this._createTimeoutTimer(requestId)
    });

    return deferred;
  }

  unregister(requestId) {
    if (!this._requests.has(requestId)) return null;

    const {
      timer,
      deferred
    } = this._requests.get(requestId);

    clearTimeout(timer);

    this._requests.delete(requestId);

    return deferred;
  }

  _createTimeoutTimer(requestId) {
    return setTimeout(() => {
      const deferred = this.unregister(requestId);
      deferred.reject( // TODO :: error
      // new ClientError(ErrorCode.ERR_NO_RESPONSE_DUE_TO_TIMEOUT)
      new Error('no response due to timeout'));
    }, this._getTimeoutTime());
  }

  rejectAll(error) {
    for (const reqId of this._requests.keys()) {
      const req = this._requests.get(reqId);

      clearTimeout(req.timer);
      req.deferred.reject(error);
    }

    this._requests.clear();
  }

  _getTimeoutTime() {
    return this.timeoutTime;
  }

}class RoomSignalingClient {
  constructor(_ctx, // FIXME :: fix parameter name
  _participantId, _mediaDirections, _endpointId // Recycle endpoint
  ) {
    _defineProperty(this, "_timeoutTime", 60000);

    this._ctx = _ctx;
    this._participantId = _participantId;
    this._mediaDirections = _mediaDirections;
    this._endpointId = _endpointId;
    this._requestMap = new RequestMap(this._timeoutTime);
  }

  async sendOfferSdp(sd) {
    if (!this._endpointId) {
      await this._sendOfferAndUnregisterCreateEndpointRequest(sd);
    } else {
      await this._sendOfferAndUnregisterPutEndpointRequest(sd);
    }
  }

  async _sendOfferAndUnregisterCreateEndpointRequest(sd) {
    const deferred = this._requestMap.unregister(`${this._participantId}:create-endpoint-request`);

    try {
      const res = await this._sendCreateEndpoint(sd);
      if (deferred) deferred.resolve(res);
      return res;
    } catch (error) {
      if (deferred) deferred.reject(error);
      throw error;
    }
  }

  async _sendOfferAndUnregisterPutEndpointRequest(sd) {
    const deferred = this._requestMap.unregister(`${this._participantId}:put-endpoint-request`);

    try {
      const res = await this._sendCreateEndpoint(sd);
      if (deferred) deferred.resolve(res);
      return res;
    } catch (error) {
      if (deferred) deferred.reject(error);
      throw error;
    }
  }

  registerCreateEndpointRequest() {
    // FIXME :: logger
    // logger.debug('registerCreateEndpointRequest()');
    if (this._endpointId) {
      throw new Error('Cannot register create endpoint request on endpoint recycle');
    } // return this._requestMap.register(`${this._participantId}:create-endpoint-request`) as Deferred<CreateEndpointResponseCommand>;


    return this._requestMap.register(`${this._participantId}:create-endpoint-request`);
  }

  registerPutEndpointRequest() {
    // logger.debug('registerPutEndpointRequest()');
    if (!this._endpointId) {
      throw new Error('Cannot register put endpoint request without endpoint id');
    } // return this._requestMap.register(`${this._participantId}:put-endpoint-request`) as Deferred<PutEndpointResponseCommand>;


    return this._requestMap.register(`${this._participantId}:put-endpoint-request`);
  }

  _sendCreateEndpoint(sd) {
    return this._ctx.sendCreateEndpoint(sd);
  }

  _sendPutEndpoint(sd) {
    return this._ctx.sendPutEndpoint(sd);
  }

}class EndpointState extends State {
  constructor(stateMutator) {
    super(stateMutator);
  }

}let EndpointStateType;

(function (EndpointStateType) {
  EndpointStateType["PENDING"] = "pending";
  EndpointStateType["ESTABLISHED"] = "established";
  EndpointStateType["CONNECTED"] = "connected";
  EndpointStateType["FAILED"] = "failed";
  EndpointStateType["RELEASING"] = "releasing";
  EndpointStateType["CLOSED"] = "closed";
})(EndpointStateType || (EndpointStateType = {}));class EndpointClosedState extends EndpointState {
  constructor() {
    super(...arguments);

    _defineProperty(this, "type", EndpointStateType.CLOSED);
  }

  _onStart() {
    this._context.dispatchEvent('closed');
  }

  _onDestroy() {}

}class EndpointConnectedState extends EndpointState {
  constructor(stateMutator) {
    super(stateMutator);

    _defineProperty(this, "type", EndpointStateType.CONNECTED);
  }

  _onStart() {
    this._context.dispatchEvent('connected');
  }

  _onDestroy() {}

  onICEFailed() {
    this._stateMutator.toPending();
  }

  onAttach() {
    this._context.requestAttach();
  }

  onRelease() {
    this._stateMutator.toReleasing();
  }

  onExit() {
    this._stateMutator.toClosed();
  }

}class EndpointEstablishedState extends EndpointState {
  constructor(stateMutator, sdp, hasPendingAttach) {
    super(stateMutator);

    _defineProperty(this, "type", EndpointStateType.ESTABLISHED);

    this._sdp = sdp;
    this._hasPendingAttach = hasPendingAttach;
  }

  _onStart() {
    this._context.dispatchEvent('established');

    this._context.setRemoteDescription(this._sdp);

    if (this._hasPendingAttach) this.onAttach();
  }

  _onDestroy() {}

  onPCConnected() {
    this._stateMutator.toConnected();
  }

  onICEFailed() {
    this._stateMutator.toPending();
  }

  onAttach() {
    this._context.requestAttach();
  }

  onRelease() {
    this._stateMutator.toReleasing();
  }

  onExit() {
    this._stateMutator.toClosed();
  }

}class EndpointFailedState extends EndpointState {
  constructor() {
    super(...arguments);

    _defineProperty(this, "type", EndpointStateType.FAILED);
  }

  _onStart() {
    this._context.dispatchEvent('failed');

    if (this._context.endpoint.id) {
      this._stateMutator.toReleasing();
    } else {
      this._stateMutator.toClosed();
    }
  }

  _onDestroy() {}

  onExit() {
    this._stateMutator.toClosed();
  }

}class EndpointPendingState extends EndpointState {
  constructor() {
    super(...arguments);

    _defineProperty(this, "type", EndpointStateType.PENDING);
  }

  _onStart() {
    this._context.dispatchEvent('pending');

    this._request();
  }

  _onDestroy() {
    if (this._requestTimeout) clearTimeout(this._requestTimeout);
    delete this._requestTimeout;
  }

  _request() {
    this._context.trialCount += 1;
    const {
      trialCount
    } = this._context;

    if (trialCount >= 9) {
      this._stateMutator.toFailed();
    } else if (trialCount > 1) {
      this._requestTimeout = setTimeout(() => {
        this._context.createSession();
      }, trialCount * 5000 + (Math.random() - 0.5) * 2000);
    } else {
      this._context.createSession();
    }
  }

  onEndpointRequestSucceeded(sdp) {
    this._stateMutator.toEstablished(sdp, this._hasPendingAttach);
  }

  onEndpointRequestFailed() {
    this._request();
  }

  onAttach() {
    this._hasPendingAttach = true;
  }

  onRelease() {
    this._stateMutator.toReleasing();
  }

  onExit() {
    this._stateMutator.toClosed();
  }

}class EndpointReleasingState extends EndpointState {
  constructor() {
    super(...arguments);

    _defineProperty(this, "type", EndpointStateType.RELEASING);
  }

  _onStart() {
    this._context.dispatchEvent('releasing');

    this._context.closePeerConnection();

    if (this._context.endpoint.id) {
      this._context.requestRelease();
    }
  }

  _onDestroy() {}

  onEndpointRequestSucceeded() {
    this._context.requestRelease();
  }

  onEndpointRequestFailed() {
    this._stateMutator.toClosed();
  }

  onReleased() {
    this._stateMutator.toClosed();
  }

  onExit() {
    this._stateMutator.toClosed();
  }

}class EndpointStateMutator extends StateMutator {
  get state() {
    return this._state;
  }

  get name() {
    return 'PeerConnection';
  }

  toPending() {
    this._changeState(new EndpointPendingState(this));
  }

  toEstablished(sdp, hasPendingAttach) {
    this._changeState(new EndpointEstablishedState(this, sdp, hasPendingAttach));
  }

  toConnected() {
    this._changeState(new EndpointConnectedState(this));
  }

  toFailed() {
    this._changeState(new EndpointFailedState(this));
  }

  toReleasing() {
    this._changeState(new EndpointReleasingState(this));
  }

  toClosed() {
    this._changeState(new EndpointClosedState(this));
  }

}class EndpointStateMachine extends StateMachine {
  constructor(context) {
    super(context, new EndpointStateMutator(context));

    this._stateMutator.toPending();
  }

  get state() {
    return this._stateMutator.state;
  }

  onEndpointRequestSucceeded(sdp) {
    logger.verbose(`[${this.state.type}] onEndpointRequestSucceeded`);
    const {
      state
    } = this;

    switch (state.type) {
      case EndpointStateType.PENDING:
        state.onEndpointRequestSucceeded(sdp);
        break;

      case EndpointStateType.RELEASING:
        state.onEndpointRequestSucceeded();
        break;

      default:
        logger.error(`[${this.state.type}] onEndpointRequestSucceeded`);
    }
  }

  onEndpointRequestFailed() {
    logger.verbose(`[${this.state.type}] onEndpointCreateFailed`);
    const {
      state
    } = this;

    switch (state.type) {
      case EndpointStateType.PENDING:
        state.onEndpointRequestFailed();
        break;

      case EndpointStateType.RELEASING:
        state.onEndpointRequestFailed();
        break;

      default:
        logger.error(`[${this.state.type}] onEndpointCreateFailed`);
    }
  }

  onICEFailed() {
    logger.verbose(`[${this.state.type}] onICEFailed`);
    const {
      state
    } = this;

    switch (state.type) {
      case EndpointStateType.ESTABLISHED:
        state.onICEFailed();
        break;

      case EndpointStateType.CONNECTED:
        state.onICEFailed();
        break;

      default:
        logger.error(`[${this.state.type}] onICEFailed`);
    }
  }

  onPCConnected() {
    logger.verbose(`[${this.state.type}] onPCConnected`);
    const {
      state
    } = this;

    switch (state.type) {
      case EndpointStateType.ESTABLISHED:
        state.onPCConnected();
        break;

      default:
        logger.error(`[${this.state.type}] onPCConnected`);
    }
  }

  onAttach() {
    logger.verbose(`[${this.state.type}] onAttach`);
    const {
      state
    } = this;

    switch (state.type) {
      case EndpointStateType.PENDING:
        state.onAttach();
        break;

      case EndpointStateType.ESTABLISHED:
        state.onAttach();
        break;

      case EndpointStateType.CONNECTED:
        state.onAttach();
        break;

      default:
        logger.error(`[${this.state.type}] onAttach`);
    }
  }

  onRelease() {
    logger.verbose(`[${this.state.type}] onRelease`);
    const {
      state
    } = this;

    switch (state.type) {
      case EndpointStateType.PENDING:
        state.onRelease();
        break;

      case EndpointStateType.ESTABLISHED:
        state.onRelease();
        break;

      case EndpointStateType.CONNECTED:
        state.onRelease();
        break;

      default:
        logger.error(`[${this.state.type}] onRelease`);
    }
  }

  onReleased() {
    logger.verbose(`[${this.state.type}] onReleased`);
    const {
      state
    } = this;

    switch (state.type) {
      case EndpointStateType.RELEASING:
        state.onReleased();
        break;

      default:
        logger.error(`[${this.state.type}] onReleased`);
    }
  }

  onExit() {
    logger.verbose(`[${this.state.type}] onExit`);
    const {
      state
    } = this;

    switch (state.type) {
      case EndpointStateType.RELEASING:
        state.onExit();
        break;

      case EndpointStateType.PENDING:
        state.onExit();
        break;

      case EndpointStateType.CONNECTED:
        state.onExit();
        break;

      case EndpointStateType.ESTABLISHED:
        state.onExit();
        break;

      case EndpointStateType.FAILED:
        state.onExit();
        break;

      default:
        logger.error(`[${this.state.type}] onExit`);
    }
  }

}class InternalCommand extends Command {
  constructor(json) {
    super();
    this.payload = json.payload || {};
  }

}class PeerConnectionInternalCommand extends InternalCommand {}let PeerConnectionDataType;

(function (PeerConnectionDataType) {
  PeerConnectionDataType["OFFER"] = "offer";
  PeerConnectionDataType["ANSWER"] = "answer";
  PeerConnectionDataType["CANDIDATE"] = "candidate";
})(PeerConnectionDataType || (PeerConnectionDataType = {}));class AnswerCommand extends PeerConnectionInternalCommand {
  // override payload: AnswerCommandPayload;
  constructor(payload) {
    super({
      payload
    });

    _defineProperty(this, "type", PeerConnectionDataType.ANSWER);
  }

}class CandidateCommand extends PeerConnectionInternalCommand {
  // override payload: CandidateCommandPayload;
  constructor(payload) {
    super({
      payload
    });

    _defineProperty(this, "type", PeerConnectionDataType.CANDIDATE);
  }

}class OfferCommand extends PeerConnectionInternalCommand {
  // override payload: OfferCommandPayload;
  constructor(payload) {
    super({
      payload
    });

    _defineProperty(this, "type", PeerConnectionDataType.OFFER);
  }

}class PeerConnectionCommandFactory {
  static createOffer(peerConnectionId, sdp) {
    return new OfferCommand({
      peerConnectionId,
      sdp
    });
  }

  static createAnswer(peerConnectionId, sdp) {
    return new AnswerCommand({
      peerConnectionId,
      sdp
    });
  }

  static createCandidate(peerConnectionId, candidate) {
    // TODO: Any??
    return new CandidateCommand({
      peerConnectionId,
      candidate
    });
  }

}class Endpoint extends EventTarget {
  constructor(_ctx, _localStream, _type, _participantId) {
    super();

    _defineProperty(this, "tmpId", v4());

    _defineProperty(this, "_createSession", () => {
      logger.debug('_createSession()');

      switch (this._type) {
        case 'master':
          this._createMasterSession();

          break;

        case 'viewer':
          this._createViewerSession();

          break;

        default:
          logger.error('Not supported endpoint type : ', this._type);
      }
    });

    _defineProperty(this, "_closePeerConnection", () => {
      logger.debug('_closePeerConnection()');

      this._pc.removeAllEventListeners(); // TODO: needed?


      this._pc.close();
    });

    _defineProperty(this, "_requestAttach", () => {
      const request = () => this._sendAttach(this._attachedTo); // TODO: Cancel on release, exit and different attach


      sendWithRetry(new RandomNoise(5000, 1000, 8), request, {
        onError: e => {
          logger.error(`Fail attach endpoint endpointId = ${this.id}, to = ${this._attachedTo} ErrorCode = ${e.code}`);
        }
      }).then(() => {
        this._dispatchEvent('attached', this._attachedTo);
      });
    });

    _defineProperty(this, "_requestRelease", () => {
      logger.debug('_requestRelease()');

      this._sendReleaseEndpoint().then(() => {
        this._stateMachine.onReleased();
      }).catch(error => {
        logger.error('Release request failed', error);

        this._stateMachine.onReleased(); // TODO: ??

      });
    });

    _defineProperty(this, "_setRemoteDescription", sdp => {
      logger.debug('_setRemoteDescription()');
      const pc = this._pc;
      const answer = PeerConnectionCommandFactory.createAnswer(undefined, sdp);
      pc.onEvent(answer);
      pc.once('connected', () => {
        this._stateMachine.onPCConnected();

        this._sendConnected();
      });
      pc.once('iceFailed', () => {
        this._stateMachine.onICEFailed();
      });
    });

    this._ctx = _ctx;
    this._localStream = _localStream;
    this._type = _type;
    this._participantId = _participantId;
    this._stateMachine = new EndpointStateMachine({
      endpoint: this,
      dispatchEvent: this._dispatchEvent.bind(this),
      createSession: this._createSession,
      setRemoteDescription: this._setRemoteDescription,
      closePeerConnection: this._closePeerConnection,
      requestAttach: this._requestAttach,
      requestRelease: this._requestRelease,
      trialCount: 0
    });
  }

  get pc() {
    return this._pc;
  }

  get _state() {
    return this._stateMachine.state;
  }

  get _masterSessionDirection() {
    return this._ctx.masterSessionDirection;
  }

  get _viewerSessionDirection() {
    return this._ctx.viewerSessionDirection;
  } // TODO: Not available in sendonly connection


  attach(to) {
    logger.debug('attach()'); // TODO: If attach not available?
    // to.viewerEndpoint = this;

    this._attachedTo = to;

    this._stateMachine.onAttach();
  }

  release() {
    logger.debug('release()');

    this._stateMachine.onRelease();
  }

  exit() {
    logger.debug('exit()');

    this._closePeerConnection();

    this._stateMachine.onExit();
  }

  _createMasterSession() {
    logger.debug(`_createMasterSession()`);

    this._createPeerConnection(this._masterSessionDirection, this._localStream);

    this._requestCreateEndpoint();
  }

  _createViewerSession() {
    logger.debug(`_createViewerSession()`);

    this._createPeerConnection(this._viewerSessionDirection, undefined);

    this._requestCreateEndpoint();
  }

  _createPeerConnection(mediaDirection, localStream) {
    logger.debug('_createPeerConnection()');
    const signalingClient = new RoomSignalingClient(this._ctx, this._participantId, mediaDirection, this.id);
    this._pc = new PeerConnection(this._ctx, undefined, signalingClient, localStream, true, undefined, mediaDirection, true);

    this._dispatchEvent('pcChanged', this._pc);
  }

  _requestCreateEndpoint() {
    logger.debug('_requestCreateEndpoint()');
    const pc = this._pc;
    let deferred; // FIXME :: enforce type

    if (this.id) {
      deferred = pc.signalingClient.registerPutEndpointRequest();
    } else {
      deferred = pc.signalingClient.registerCreateEndpointRequest();
    }

    pc.createOffer();
    deferred.promise.then(res => {
      this.id = res.payload.endpoint.id;

      this._stateMachine.onEndpointRequestSucceeded(res.payload.sdp);
    }).catch(error => {
      logger.error(`Endpoint request failed`, error);

      this._stateMachine.onEndpointRequestFailed();
    });
  }

  _sendConnected() {
    return this._ctx.sendConnected(this);
  }

  _sendReleaseEndpoint() {
    return this._ctx.sendReleaseEndpoint(this);
  }

  _sendAttach(to) {
    return this._ctx.sendAttach(this, to);
  }

}// import { ClientError } from 'common/errors/clientError';
class ScreenShare extends EventTarget {
  constructor() {
    super();
  }

  get stream() {
    return this._stream;
  }

  get isSharing() {
    return !!this._stream;
  }

  async startStream() {
    try {
      const stream = await navigator.mediaDevices.getDisplayMedia({
        video: true
      });
      this._stream = stream;

      this._stream.getVideoTracks()[0].onended = () => {
        this._releaseStream();

        this._dispatchEvent('streamStopped');
      };
    } catch (e) {

      switch (e.name) {
        case 'InvalidStateError':
          // FIXME :: add error
          // errorCode = ErrorCode.ERR_NOT_SUPPORTED_APP_STATE_FOR_SCREEN_SHARE;
          break;

        case 'NotAllowedError':
          // errorCode = ErrorCode.ERR_PERMISSION_DENIED_FOR_SCREEN_SHARE;
          break;

        case 'NotFoundError':
          // errorCode = ErrorCode.ERR_SELECTED_CONTENT_NOT_EXIST;
          break;

        case 'NotReadableError':
          // errorCode = ErrorCode.ERR_SELECTED_CONTENT_INACCESSIBLE;
          break;

        default:
          // errorCode = ErrorCode.ERR_SCREEN_SHARE_FAILED_DUE_TO_UNKNOWN_REASON;
          throw new Error('');
      } // throw new ClientError(errorCode);


      throw new Error('failed to start screen share');
    }
  }

  stopStream() {
    this._releaseStream();

    this._dispatchEvent('streamStopped');
  }

  _releaseStream() {
    if (!this._stream) return;

    for (const track of this._stream.getTracks()) {
      track.stop();
    }

    delete this._stream;
  }

}class LocalStream extends EventTarget {
  constructor(_deviceManager) {
    let _mediaConstraints = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
      audio: true,
      video: true
    };

    super();

    _defineProperty(this, "_checkScreenSharePrerequisites", () => {
      if (!navigator.mediaDevices.getDisplayMedia) {
        // TODO :: throw error
        // const msg = ErrorUtil.getErrorMessage(ErrorCode.ERR_NOT_SUPPORTED_BROWSER_FOR_SCREEN_SHARE);
        // logger.error(msg);
        throw new Error('screen share is not supported in this browser');
      }
    });

    this._deviceManager = _deviceManager;
    this._mediaConstraints = _mediaConstraints;
    this._screenShare = new ScreenShare();

    this._screenShare.on('streamStopped', () => {
      this._releaseMergedStream();

      this._dispatchEvent('screenShareStreamStopped');
    });
  }

  set mediaConstraints(constraints) {
    this._mediaConstraints = constraints;
  }

  get hasPermission() {
    return this._mediaAccess?.hasPermission;
  }

  get localStream() {
    return this.isScreenSharing ? this._mergedStream : this.getLocalMediaStream();
  }

  get mergedStream() {
    return this._mergedStream;
  }

  get screenStream() {
    return this._screenShare.stream;
  }

  get isScreenSharing() {
    return this._screenShare.isSharing;
  }

  async useScreenStream() {
    this._checkScreenSharePrerequisites();

    await this._screenShare.startStream();

    this._mergeScreenShareStream();

    this._dispatchEvent('streamChanged', this.localStream);
  }

  getLocalMediaStream() {
    if (!this._mediaAccess) {
      this._grantMediaAccess(this._mediaConstraints);
    }

    return this._mediaAccess.stream;
  }

  stopScreenShare() {
    if (!this._screenShare.isSharing) return;

    this._screenShare.stopStream();
  }

  revokeMediaAccess() {
    if (this._mediaAccess) {
      this._mediaAccess.dispose();

      this._mediaAccess = null;
    }
  }

  release() {
    this.stopScreenShare();
    this.revokeMediaAccess();
  }

  _grantMediaAccess(constraints) {
    this._mediaAccess = this._deviceManager.useMedia(constraints);

    this._mediaAccess.on('streamChanged', () => {
      if (this._screenShare.isSharing) {
        this._mergeScreenShareStream();
      }

      this._dispatchEvent('streamChanged', this.localStream);
    });

    this._mediaAccess.on('audioOutputChanged', () => this._dispatchEvent('audioOutputChanged'));
  }

  _mergeScreenShareStream() {
    if (!this._screenShare.isSharing) return;
    const stream = new MediaStream();

    if (this._mediaAccess.stream && this._mediaAccess.stream.getAudioTracks().length > 0) {
      stream.addTrack(this._mediaAccess.stream.getAudioTracks()[0]);
    }

    stream.addTrack(this.screenStream.getVideoTracks()[0]);
    this._mergedStream = stream;
  }

  _releaseMergedStream() {
    if (!this._mergedStream) return;

    this._mergedStream.removeTrack(this._mergedStream.getAudioTracks()[0]);

    delete this._mergedStream;

    this._dispatchEvent('streamChanged', this.localStream);
  }

}class Stream {
  constructor(liveEvent, deviceManager, sender, mediaOption) {
    this._liveEvent = liveEvent;
    this._sender = sender;
    this._deviceManager = deviceManager;
    this._mediaOption = mediaOption;
  }

  get mediaView() {
    return this._mediaView;
  }

  set mediaView(mediaView) {
    if (this._mediaView === mediaView) return;

    if (this._mediaView) {
      this._mediaView = null;
    }

    if (!mediaView) {
      delete this._mediaView;
      return;
    }

    this._mediaView = this._updateMediaViewStream(mediaView, this.stream);
  }

  get localStream() {
    return this._localStream.localStream;
  }

  get stream() {
    return this._endpoint.pc?.remoteStream;
  }

  _createLocalStream() {
    this._localStream = new LocalStream(this._deviceManager, {
      audio: true,
      video: true
    });

    this._localStream.on('streamChanged', () => {
      this._onLocalStream();
    });
  }

  _createEndpoint() {
    if (this._liveEvent.isHost) {
      if (!this._localStream) {
        this._createLocalStream();
      }

      return new Endpoint({
        masterSessionDirection: {
          audio: 'sendonly',
          video: 'sendonly'
        },
        viewerSessionDirection: {
          audio: 'recvonly',
          video: 'recvonly'
        },
        sender: this._sender,
        sendConnected: this._sendConnected.bind(this),
        sendReleaseEndpoint: this._sendReleaseEndpoint.bind(this),
        sendAttach: this._sendAttach.bind(this),
        sendCreateEndpoint: this._sendCreateEndpoint.bind(this),
        sendPutEndpoint: this._sendPutEndpoint.bind(this)
      }, this._localStream, 'master', this._liveEvent.host.hostId);
    } else {
      const endpoint = new Endpoint({
        masterSessionDirection: {
          audio: 'sendonly',
          video: 'sendonly'
        },
        viewerSessionDirection: {
          audio: 'recvonly',
          video: 'recvonly'
        },
        sender: this._sender,
        sendConnected: this._sendConnected.bind(this),
        sendReleaseEndpoint: this._sendReleaseEndpoint.bind(this),
        sendAttach: this._sendAttach.bind(this),
        sendCreateEndpoint: this._sendCreateEndpoint.bind(this),
        sendPutEndpoint: this._sendPutEndpoint.bind(this)
      }, undefined, 'viewer', this._liveEvent.currentLiveUser.participantId);
      this._unsubscriber = endpoint.pc.on('remoteStream', stream => {
        this._onStream();
      });
      return endpoint;
    }
  }

  openStream() {
    if (this._endpoint) {
      this._teardown();
    }

    this._endpoint = this._createEndpoint();
  }

  closeStream(needRelease) {
    if (needRelease) {
      this._endpoint.release();
    }

    this._teardown();
  }

  attach(to) {
    this._endpoint.attach(to);
  }

  toggleAudio(enabled) {
    this.localStream.getAudioTracks()?.forEach(track => {
      track.enabled = enabled;
    });
    this._mediaOption.turnAudioOn = enabled;
  }

  toggleVideo(enabled) {
    this.localStream.getVideoTracks()?.forEach(track => {
      track.enabled = enabled;
    });
    this._mediaOption.turnVideoOn = enabled;
  } // FIXME :: follow calls' interfaces


  chooseMediaDevice(kind, mediaDeviceInfo) {
    this._deviceManager.selectDevice(kind, mediaDeviceInfo);
  }

  _onLocalStream() {
    this.toggleAudio(this._mediaOption.turnAudioOn);
    this.toggleVideo(this._mediaOption.turnVideoOn);
  }

  _onStream() {
    const {
      stream
    } = this;

    if (this._mediaView) {
      this._updateMediaViewStream(this._mediaView, stream);
    }
  } // FIXME :: add audio output handling


  _updateMediaViewStream(mediaView, stream) {
    if (stream) {
      mediaView.srcObject = stream;
    }

    return mediaView;
  }

  async _sendConnected(endpoint) {
    let command;

    if (this._liveEvent.isHost) {
      command = LiveCommandFactory.createHostConnected(this._liveEvent.liveEventId, this._liveEvent.host.hostId, endpoint.id);
    } else {
      command = LiveCommandFactory.createConnected(this._liveEvent.liveEventId, this._liveEvent.currentLiveUser.participantId, endpoint.id);
    }

    return this._sender.send(command);
  }

  _sendReleaseEndpoint(endpoint) {
    let command;

    if (this._liveEvent.isHost) {
      command = LiveCommandFactory.createHostDeleteStream(this._liveEvent.liveEventId, this._liveEvent.host.hostId, endpoint.id);
    } else {
      command = LiveCommandFactory.createDeleteStream(this._liveEvent.liveEventId, this._liveEvent.currentLiveUser.participantId, endpoint.id);
    }

    return this._sender.sendWithRetry(command);
  }

  _sendAttach(endpoint, to) {
    const command = LiveCommandFactory.createAttach(this._liveEvent.liveEventId, this._liveEvent.currentLiveUser.participantId, endpoint.id, to);
    return this._sender.sendWithRetry(command);
  }

  async _sendCreateEndpoint(sd) {
    if (this._liveEvent.isActiveHost) {
      const command = LiveCommandFactory.createHostCreateStream(this._liveEvent.liveEventId, this._liveEvent.host.hostId, sd.sdp, 'sendonly', 'sendonly');
      return this._sender.send(command);
    } else {
      const command = LiveCommandFactory.createStream(this._liveEvent.liveEventId, this._liveEvent.currentLiveUser.participantId, sd.sdp, 'recvonly', 'recvonly');
      return this._sender.send(command);
    }
  }

  async _sendPutEndpoint(sd) {
    return this._sendCreateEndpoint(sd);
  }

  _teardown() {
    this._endpoint?.exit();
    this._endpoint = null;
    this._unsubscriber?.();
    this._unsubscriber = null;
  }

}/**
 * A class that provides methods for a host and participants to stream and receive media during a live event.
 */
class LiveEvent extends EventTarget {
  /**
   * An open channel that is used for the live event.
   */

  /**
   * Unique identifier for the live event.
   */

  /**
   * Host of the live event.
   */

  /**
   * The state of a live event. Valid values are created, ready, ongoing, and ended.
   */

  /**
   * Indicates whether the host is streaming media.
   */

  /**
   * The timestamp of when the live event was created, in miliseconds.
   */

  /**
   * The timestamp of when the live event was set ready, in miliseconds.
   */

  /**
   * The timestamp of when the live event was started, in miliseconds.
   */

  /**
   * The timestamp of when the live event was ended, in miliseconds.
   */

  /**
   * User ID of the user that created the live event.
   */

  /**
   * User ID of the user that set the live event ready.
   */

  /**
   * User ID of the user that started the live event.
   */

  /**
   * User ID of the user that ended the live event.
   */

  /**
   * The period from the time when the live event was created to the time the live event was ended.
   */

  /**
   * The number of participants in a live event which is counted by the number of devices and browsers concurrently connected to Sendbird server.
   */

  /**
   * The highest number of `participantCount` measured at a given time during a live event.
   */

  /**
   * The sum of all participants that entered and exited a live event.
   */

  /**
   * A unique key-value pair of information stored in a live event.
   */
  // TODO :: call unsubscriber
  constructor(_ref) {
    let {
      deviceManager,
      sender,
      sb,
      userId,
      info
    } = _ref;
    super();
    this._deviceManager = deviceManager;
    this._sender = sender;
    this._sb = sb;
    this._userId = userId;
    this._streams = new Map(); // FIXME :: vulnerable Object.assign()

    if (info) {
      Object.assign(this, info);
    }

    this._unsubscriber = this._sender.on('command', command => {
      this._onEvent(command);
    });
  }
  /**
   * The role of the user in a live event.
   */


  get myRole() {
    if (this.userIdsForHost.includes(this._userId)) {
      return exports.LiveEventRole.HOST;
    }

    return exports.LiveEventRole.PARTICIPANT;
  }

  get isHost() {
    return this.myRole === exports.LiveEventRole.HOST;
  }

  get isActiveHost() {
    return this.isHost && !!this.host;
  }

  async fetchOpenChannel() {
    const data = await this._sb.openChannel.getChannelWithoutCache(this.liveEventId);

    const channel = this._sb.openChannel.buildOpenChannelFromSerializedData(data);

    this.openChannel = channel;
    return channel;
  }

  async _getOpenChannel() {
    if (this.openChannel) return this.openChannel;
    return this.fetchOpenChannel();
  }
  /**
   * Enters a live event as a host. Only the host can perform this action.
   *
   * @param mediaOption
   */


  async enterAsHost(mediaOption) {
    const channel = await this._getOpenChannel();
    await channel.enter();

    try {
      const command = await this._sender.send(LiveCommandFactory.createEnterHost(this.liveEventId, mediaOption));
      const {
        host
      } = command.payload;

      this._streams.set(host.hostId, new Stream(this, this._deviceManager, this._sender, mediaOption));

      this.upsert({
        host
      });
    } catch (e) {
      await channel.exit();
      throw e;
    }

    this._startToSendAlive();
  }
  /**
   * Sets a live event ready before starting a live event. Only the host can perform this action.
   */


  async setEventReady() {
    if (!this.isHost) {
      throw new Error('host only action'); // logger.error('host only action')
    }

    const command = await this._sender.send(LiveCommandFactory.createReady(this.liveEventId));
    const {
      liveEvent
    } = command.payload;
    this.upsert(liveEvent);
  } // TODO :: start stream if stream doesn't exist yet

  /**
   * Starts the live event. Only the host can perform this action. Calling this method implicitly calls `startStreaming()`.
   *
   * @param mediaOption
   */


  async startEvent(mediaOption) {
    if (!this.isHost) {
      throw new Error('host only action'); // logger.error('host only action')
    }

    const command = await this._sender.send(LiveCommandFactory.createStart(this.liveEventId));
    const {
      liveEvent
    } = command.payload;
    this.upsert(liveEvent);

    if (!this.isHostStreaming) {
      this.startStreaming(mediaOption);
    }

    this._toggleAudio(mediaOption.turnAudioOn);

    this._toggleVideo(mediaOption.turnVideoOn);
  }
  /**
   * Starts media streaming of a host in the live event. Only the host can perform this action.
   *
   * @param mediaOption
   */


  startStreaming(mediaOption) {
    if (!this.isActiveHost) {
      // logger.warning(`Failed to start stream because the client is not host.`);
      throw new Error('current host only action');
    }

    const stream = new Stream(this, this._deviceManager, this._sender, mediaOption);

    this._streams.set(this.host.hostId, stream);

    stream.openStream();
  }
  /**
   * Ends media streaming of a host in the live event. Only the host can perform this action.
   */


  endStreaming() {
    if (!this.isActiveHost) {
      // logger.warning(`Failed to start stream because the client is not host.`);
      throw new Error('current host only action');
    }

    const stream = this._streams.get(this.host.hostId);

    if (stream) {
      this._streams.delete(this.host.hostId);

      stream.closeStream(true);
    }
  }
  /**
   * Exits a live event as a host.
   */


  async exitAsHost() {
    const {
      hostId
    } = this.host;
    const command = await this._sender.send(LiveCommandFactory.createExitHost(this.liveEventId, hostId));
    const {
      host
    } = command.payload;
    this.upsert({
      host
    });
    this.teardown();
  }
  /**
   * Ends a live event. Only the host can perform this action. Calling this method implicitly calls `endStreaming()`.
   */


  async endEvent() {
    const command = await this._sender.send(LiveCommandFactory.createEndLiveEvent(this.liveEventId));
    const {
      liveEvent
    } = command.payload;
    this.upsert(liveEvent);
    this.teardown();
  }
  /**
   * Mutes the audio of a live event. Only the host can perform this action.
   */


  muteAudioInput() {
    this._toggleAudio(false);
  }
  /**
   * Unmutes the audio of a live event. Only the host can perform this action.
   */


  unmuteAudioInput() {
    this._toggleAudio(true);
  } // TODO :: upsert host


  _toggleAudio(enabled) {
    if (!this.isActiveHost) {
      // logger.warning(`Failed to start stream because the client is not host.`);
      throw new Error('current host only action');
    } // TODO :: check false change
    // if (this.isAudioEnabled === enabled) return;


    const stream = this._streams.get(this.host.hostId);

    stream.toggleAudio(enabled);

    this._sender.send(LiveCommandFactory.createAudio(this.liveEventId, this.host.hostId, enabled));
  }
  /**
   * Turns off the video of a live event. Only the host can perform this action.
   */


  stopVideo() {
    this._toggleVideo(false);
  }
  /**
   * Turns on the video of a live event. Only the host can perform this action.
   */


  startVideo() {
    this._toggleVideo(true);
  } // TODO :: upsert host


  _toggleVideo(enabled) {
    if (!this.isActiveHost) {
      // logger.warning(`Failed to start stream because the client is not host.`);
      throw new Error('current host only action');
    } // TODO :: check false change
    // if (this.isVideoEnabled === enabled) return;


    const stream = this._streams.get(this.host.hostId);

    stream.toggleVideo(enabled);

    this._sender.send(LiveCommandFactory.createVideo(this.liveEventId, this.host.hostId, enabled));
  }
  /**
   * Selects a device for audio input for a live event. Only the host can perform this action.
   */


  selectAudioInput(mediaDeviceInfo) {
    return this._deviceManager.selectDevice('audioinput', mediaDeviceInfo);
  }
  /**
   * Selects a device for video output during a live event. Only the host can perform this action.
   */


  selectVideoInput(mediaDeviceInfo) {
    return this._deviceManager.selectDevice('videoinput', mediaDeviceInfo);
  }
  /**
   * Enters a live event.
   */


  async enter() {
    const channel = await this._getOpenChannel();
    await channel.enter();

    try {
      const command = await this._sender.send(LiveCommandFactory.createEnter(this.liveEventId));
      const {
        participant
      } = command.payload;
      this.upsert({
        currentLiveUser: participant
      });

      this._tryOpen();
    } catch (e) {
      await channel.exit();
      throw e;
    }

    this._startToSendAlive();
  }
  /**
   * Exits a live event.
   */


  async exit() {
    const command = await this._sender.send(LiveCommandFactory.createExit(this.liveEventId, this.currentLiveUser.participantId));
    command.payload;
    this.upsert({
      currentLiveUser: undefined
    });
    this.teardown();
  }

  setVideoViewForLiveEvent(mediaView, hostId) {
    const stream = this._streams.get(hostId);

    if (stream) {
      stream.mediaView = mediaView;
    }
  }

  upsert(props) {
    Object.assign(this, { ...props
    });
  }

  teardown() {
    this.openChannel?.exit();

    for (const stream of this._streams.values()) {
      stream.closeStream();
    }

    this._streams.clear();

    this._stopToSendAlive();
  } // FIXME :: fix type signature


  _onEvent(command) {
    if (this.liveEventId !== command.payload.liveEventId) {
      return;
    }

    if (command instanceof ReadyEventCommand) {
      this._onReady(command);
    } else if (command instanceof StartedEventCommand) {
      this._onStarted(command);
    } else if (command instanceof EndedEventCommand) {
      this._onEnded(command);
    } else if (command instanceof HostEnteredEventCommand) {
      this._onHostEntered(command);
    } else if (command instanceof HostExitedEventCommand) {
      this._onHostExited(command);
    } else if (command instanceof HostConnectedEventCommand) {
      this._onHostConnected(command);
    } else if (command instanceof HostDisconnectedEventCommand) {
      this._onHostDisconnected(command);
    } else if (command instanceof HostAudioStatusChangedEventCommand) {
      this._onHostAudioStatusChanged(command);
    } else if (command instanceof HostVideoStatusChangedEventCommand) {
      this._onHostVideoStatusChanged(command);
    } else if (command instanceof ParticipantEnteredEventCommand) {
      this._onParticipantEntered(command);
    } else if (command instanceof ParticipantExitedEventCommand) {
      this._onParticipantExited(command);
    } else {
      throw new Error('unknown event is received');
    }
  }

  _onReady(command) {
    const {
      liveEvent
    } = command.payload;
    this.upsert(liveEvent);

    this._dispatchEvent('liveEventReady', this);
  }

  _onStarted(command) {
    const {
      liveEvent
    } = command.payload;
    this.upsert(liveEvent);

    this._dispatchEvent('liveEventStarted', this);

    this._tryOpen();
  }

  _onEnded(command) {
    const {
      liveEvent
    } = command.payload;
    this.upsert(liveEvent);

    this._dispatchEvent('liveEventEnded', this);

    this.teardown();
  }

  _onHostEntered(command) {
    const {
      host
    } = command.payload;
    this.upsert({
      host
    });

    this._dispatchEvent('hostEntered', this, this.host);
  }

  _onHostExited(command) {
    const {
      host
    } = command.payload;
    this.upsert({
      host: undefined
    });

    this._dispatchEvent('hostExited', this, host);
  }

  _onHostConnected(command) {
    const {
      host
    } = command.payload;
    this.upsert({
      host
    });

    this._dispatchEvent('hostConnected', this, this.host);

    this._tryOpen();
  }

  _onHostDisconnected(command) {
    const {
      host
    } = command.payload;
    this.upsert({
      host
    });

    this._dispatchEvent('hostDisconnected', this, this.host);
  }

  _onHostAudioStatusChanged(command) {
    const {
      host
    } = command.payload;
    this.upsert({
      host
    });
    if (host.isAudioOn) this._dispatchEvent('hostUnmutedAudio', this, this.host);
    if (!host.isAudioOn) this._dispatchEvent('hostMutedAudio', this, this.host);
  }

  _onHostVideoStatusChanged(command) {
    const {
      host
    } = command.payload;
    this.upsert({
      host
    });
    if (host.isVideoOn) this._dispatchEvent('hostStartedVideo', this, this.host);
    if (!host.isVideoOn) this._dispatchEvent('hostStoppedVideo', this, this.host);
  }

  _onParticipantEntered(command) {
    const {
      participant
    } = command.payload;

    this._dispatchEvent('participantEntered', this, participant);
  }

  _onParticipantExited(command) {
    const {
      participant
    } = command.payload;

    this._dispatchEvent('participantExited', this, participant);
  }

  _tryOpen() {
    if (!this.host || this.host.state !== exports.HostState.CONNECTED || this.state !== exports.LiveEventState.ONGOING) {
      return;
    }

    const {
      hostId
    } = this.host;
    let stream;

    if (this._streams.has(hostId)) {
      stream = this._streams.get(hostId);
    } else {
      stream = new Stream(this, this._deviceManager, this._sender);

      this._streams.set(hostId, stream);
    }

    stream.openStream();
    stream.attach(hostId);
  } // TODO :: implement this


  _tryClose() {}

  _startToSendAlive() {
    if (this.isActiveHost) {
      this._aliveIntervalId = setInterval(() => {
        const command = LiveCommandFactory.createHostAlive(this.liveEventId, this.host.hostId);

        this._sender.send(command);
      }, 3000);
    } else {
      this._aliveIntervalId = setInterval(() => {
        const command = LiveCommandFactory.createAlive(this.liveEventId, this.currentLiveUser.participantId);

        this._sender.send(command);
      }, 90000);
    }
  }

  _stopToSendAlive() {
    if (this._aliveIntervalId) {
      clearInterval(this._aliveIntervalId);
      delete this._aliveIntervalId;
    }
  }

}class LiveEventManager {
  constructor(ctx) {
    this._liveEvents = [];
    this._ctx = ctx;
  }

  async createLiveEvent(config) {
    const command = await this._ctx.commandRouter.send(LiveCommandFactory.createLiveEvent(HostType.SINGLE_HOST, config.userIdsForHost));
    const liveEventInfo = command.payload.liveEvent;
    const liveEvent = new LiveEvent({
      deviceManager: this._ctx.deviceManager,
      sender: this._ctx.commandRouter,
      sb: this._ctx.sb,
      userId: this.userId,
      info: liveEventInfo
    });

    try {
      await liveEvent.fetchOpenChannel(); // TODO :: reconsider parameter naming

      if (config.title) {
        await liveEvent.openChannel.updateChannel({
          name: config.title
        });
      }

      if (config.coverImage) {
        await liveEvent.openChannel.updateChannel({
          coverUrlOrImage: config.coverImage
        });
      }
    } catch (e) {
      logger.error('failed to fetch initial open channel');
    }

    this._liveEvents.push(liveEvent);

    return liveEvent;
  }

  async getLiveEvent(liveEventId) {
    const command = await this._ctx.commandRouter.send(LiveCommandFactory.createGetLiveEvent(liveEventId));
    const liveEventInfo = command.payload.liveEvent;

    const index = this._liveEvents.findIndex(liveEvent => {
      return liveEvent.liveEventId === liveEventId;
    });

    if (index > -1) {
      const liveEvent = this._liveEvents[index];
      liveEvent.upsert(liveEventInfo);

      try {
        await liveEvent.fetchOpenChannel();
      } catch (e) {
        logger.error('failed to fetch initial open channel');
      }

      return liveEvent;
    } else {
      const liveEvent = new LiveEvent({
        deviceManager: this._ctx.deviceManager,
        sender: this._ctx.commandRouter,
        sb: this._ctx.sb,
        userId: this.userId,
        info: liveEventInfo
      });

      try {
        await liveEvent.fetchOpenChannel();
      } catch (e) {
        logger.error('failed to fetch initial open channel');
      }

      this._liveEvents.push(liveEvent);

      return liveEvent;
    }
  }

  clear() {
    this._liveEvents = [];

    for (const liveEvent of this._liveEvents) {
      liveEvent.teardown();
    }
  }

}// Ref: https://stackoverflow.com/a/51398471/9018724
// TODO: Is it okay to open to public?
class Resolution {
  constructor(key, value) {
    this.key = key;
    this.value = value;
  }

  toString() {
    return this.key;
  }

  equals(to) {
    return this.value.width === to.value.width && this.value.height === to.value.height;
  }

}

_defineProperty(Resolution, "_720P", new Resolution('_720P', {
  width: 1280,
  height: 720
}));

_defineProperty(Resolution, "_540P", new Resolution('_540P', {
  width: 960,
  height: 540
}));

_defineProperty(Resolution, "_480P", new Resolution('_480P', {
  width: 848,
  height: 480
}));

_defineProperty(Resolution, "_360P", new Resolution('_360P', {
  width: 640,
  height: 360
}));

const DEFAULT_FRAME_RATE = 24;
const DEFAULT_RESOLUTION = Resolution._720P;/**
 * @partialPublic
 */
class MediaAccess extends EventTarget {
  // TODO: Any better way to make sure onDisposed has been registered?
  constructor(_streamManger, constraints) {
    super();

    _defineProperty(this, "hasPermission", false);

    this._streamManger = _streamManger;
    this.constraints = constraints;
  }

  get stream() {
    return this._streamManger.stream;
  }
  /**
   * @public
   */


  dispose() {
    this.removeAllEventListeners();
    this.onDisposed?.();
  }

  streamChanged(stream) {
    this._dispatchEvent('streamChanged', stream);
  }

  audioOutputChanged() {
    this._dispatchEvent('audioOutputChanged');
  }

}let audioContext;
let oscillator;
let canvasElement;
let drawCanvasTimerId;
let dummyAudioTrack;
let dummyVideoTrack;

const createSilence = () => {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }

  const ctx = audioContext;
  oscillator = ctx.createOscillator();
  const dst = ctx.createMediaStreamDestination();
  const gainNode = ctx.createGain();
  gainNode.gain.setValueAtTime(0, ctx.currentTime);
  oscillator.connect(gainNode).connect(dst);
  oscillator.start();
  dummyAudioTrack = dst.stream.getAudioTracks()[0];
  return dst.stream.getAudioTracks()[0];
};

const createBlack = _ref => {
  let {
    width,
    height,
    frameRate
  } = _ref;

  if (!canvasElement) {
    canvasElement = document.createElement('canvas');
  }

  canvasElement.width = width;
  canvasElement.height = height;
  canvasElement.getContext('2d').fillRect(0, 0, width, height);

  if (!drawCanvasTimerId) {
    drawCanvasTimerId = setInterval(() => {
      canvasElement.getContext('2d').fillRect(0, 0, width, height);
    }, 1000);
  }

  const stream = canvasElement.captureStream(frameRate);
  dummyVideoTrack = stream.getVideoTracks()[0];
  return stream.getVideoTracks()[0];
};

const fillStream = (stream, constraints) => {
  if (constraints.audio && stream.getAudioTracks().length === 0) {
    stream.addTrack(createSilence());
  }

  if (constraints.video && stream.getVideoTracks().length === 0) {
    stream.addTrack(createBlack({ ...DEFAULT_RESOLUTION.value,
      frameRate: DEFAULT_FRAME_RATE
    }));
  }
};
function releaseDummyStream() {
  // release dummyStream
  if (dummyAudioTrack) dummyAudioTrack.stop();
  if (dummyVideoTrack) dummyVideoTrack.stop();
  dummyAudioTrack = null;
  dummyVideoTrack = null;

  if (drawCanvasTimerId) {
    clearInterval(drawCanvasTimerId);
    drawCanvasTimerId = null;
  }

  if (oscillator) {
    oscillator.onended = () => {
      oscillator.disconnect();
      oscillator = null;
    };

    oscillator.stop();
  }
}
function stopStream(stream) {
  if (!stream) return;

  for (const track of stream.getTracks()) {
    track.stop();
  }
}const extractVersion = (uastring, expr, pos) => {
  const match = uastring.match(expr);
  return match && match.length >= pos && parseInt(match[pos], 10);
};

const detectBrowserType = () => {
  // Returned result object.
  const result = {
    browser: null,
    version: null
  }; // Fail early if it's not a browser

  if (typeof window === 'undefined' || !window.navigator) {
    result.browser = 'Not a browser.';
    return result;
  }

  const {
    navigator
  } = window;

  if (navigator.mozGetUserMedia) {
    // Firefox.
    result.browser = 'firefox';
    result.version = extractVersion(navigator.userAgent, /Firefox\/(\d+)\./, 1);
  } else {
    // @ts-ignore
    if (navigator.webkitGetUserMedia || window.isSecureContext === false && window.webkitRTCPeerConnection // @ts-ignore
    && !window.RTCIceGatherer) {
      // Chrome, Chromium, Webview, Opera.
      // Version matches Chrome/WebRTC version.
      // Chrome 74 removed webkitGetUserMedia on http as well so we need the
      // more complicated fallback to webkitRTCPeerConnection.
      result.browser = 'chrome';
      result.version = extractVersion(navigator.userAgent, /Chrom(e|ium)\/(\d+)\./, 2);
    } else if (navigator.mediaDevices && navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)) {
      // Edge.
      result.browser = 'edge';
      result.version = extractVersion(navigator.userAgent, /Edge\/(\d+).(\d+)$/, 2);
    } else if (window.RTCPeerConnection && navigator.userAgent.match(/AppleWebKit\/(\d+)\./)) {
      // Safari.
      result.browser = 'safari';
      result.version = extractVersion(navigator.userAgent, /AppleWebKit\/(\d+)\./, 1);
      result.supportsUnifiedPlan = window.RTCRtpTransceiver && 'currentDirection' in window.RTCRtpTransceiver.prototype;
    } else {
      // Default fallthrough: not supported.
      result.browser = 'Not a supported browser.';
      return result;
    }
  }

  return result;
};

const isSafari = detectBrowserType().browser === 'safari';
class StreamManager {
  constructor(deviceManager) {
    _defineProperty(this, "_hasPermission", false);

    this._deviceManager = deviceManager;
    this._updateQueued = false;
  }

  async updateStream() {
    if (this._updateAt) {
      this._updateQueued = true;
      return;
    }

    const usingAudio = this._deviceManager.mediaAccesses.some(ma => ma.constraints.audio);

    const usingVideo = this._deviceManager.mediaAccesses.some(ma => ma.constraints.video);

    if (!usingAudio && !usingVideo) {
      stopStream(this.stream);
      releaseDummyStream();
      return;
    }

    this._updateAt = Date.now();
    const prevStream = this.stream; // TODO :: is this a best way to handle it?
    // for initial call before getUserMedia prompt resolved.

    if (!prevStream) {
      const stream = new MediaStream();
      fillStream(stream, {
        audio: usingAudio,
        video: usingVideo
      });
      this.stream = stream;
    } // safari allows only one local media stream.
    // so, safari can't support seamless stream change.


    if (isSafari) {
      stopStream(prevStream);
    }

    let stream;

    try {
      const constraints = await this._deviceManager.getMediaConstraints({
        usingAudio,
        usingVideo
      });
      stream = await navigator.mediaDevices.getUserMedia(constraints);
      this._hasPermission = true;

      for (const mediaAccess of this._deviceManager.mediaAccesses) {
        mediaAccess.hasPermission = true;
      }

      releaseDummyStream(); // If getting the device stream succeeded, the dummy track will stop.
    } catch (e) {
      // logger.error(`Fail get local media stream Error[${e}]`);
      stream = new MediaStream();
    }

    fillStream(stream, {
      audio: usingAudio,
      video: usingVideo
    });

    if (!isSafari) {
      stopStream(prevStream);
    }

    this.stream = stream;

    for (const mediaAccess of this._deviceManager.mediaAccesses) {
      mediaAccess.streamChanged(this.stream);
    }

    delete this._updateAt;

    if (this._updateQueued) {
      this._updateQueued = false;
      this.updateStream();
    } else {
      this._deviceManager.refreshMediaDevices({
        audio: usingAudio,
        video: usingVideo
      }, true);
    }
  }

}function eqDevice(l, r) {
  return l?.deviceId === r?.deviceId && l?.label === r?.label && l?.groupId === r?.groupId;
}

function eqDevices(ls, rs) {
  if (ls.length !== rs.length) return false;

  for (let i = 0; i < rs.length; i++) {
    if (!eqDevice(ls[i], rs[i])) return false;
  }

  return true;
}

class DeviceManager {
  constructor() {
    this.mediaAccesses = [];
    this._availableMediaDevices = {
      audioinput: [],
      audiooutput: [],
      videoinput: []
    };
    this._currentMediaDevices = {
      audioinput: undefined,
      audiooutput: undefined,
      videoinput: undefined
    };
    this._sendbirdCallListeners = new Map();
    this._streamManager = new StreamManager(this);

    navigator.mediaDevices.ondevicechange = () => this._onDeviceChanged();
  }

  _onDeviceChanged() {
    if (this.mediaAccesses.length === 0) return;
    this.refreshMediaDevices({
      audio: this.mediaAccesses.some(a => a.constraints.audio),
      video: this.mediaAccesses.some(a => a.constraints.video)
    });
  }

  addSendBirdCallListener(id, listener) {
    this._sendbirdCallListeners.set(id, listener);
  }

  removeSendBirdCallListener(id) {
    this._sendbirdCallListeners.delete(id);
  }

  removeAllSendBirdCallListener() {
    this._sendbirdCallListeners.clear();
  }

  getCurrentAudioInputDevice() {
    return this._currentMediaDevices.audioinput;
  }

  getCurrentAudioOutputDevice() {
    return this._currentMediaDevices.audiooutput;
  }

  getCurrentVideoInputDevice() {
    return this._currentMediaDevices.videoinput;
  }

  getAvailableAudioInputDevices() {
    return this._availableMediaDevices.audioinput;
  }

  getAvailableAudioOutputDevices() {
    return this._availableMediaDevices.audiooutput;
  }

  getAvailableVideoInputDevices() {
    return this._availableMediaDevices.videoinput;
  }

  async _updateStream() {
    return this._streamManager.updateStream();
  }

  _registerMediaAccess(mediaAccess) {
    this.mediaAccesses.push(mediaAccess);

    mediaAccess.onDisposed = () => this.stopMedia(mediaAccess);
  }

  useMedia(constraints) {
    if (!constraints.audio && !constraints.video) {
      logger.error(new Error(`you should set true for at least 1 media type.`));
      return undefined;
    }

    const mediaAccess = new MediaAccess(this._streamManager, constraints);

    this._registerMediaAccess(mediaAccess);

    this._updateStream();

    return mediaAccess;
  }

  stopMedia(mediaAccess) {
    this.mediaAccesses.splice(this.mediaAccesses.indexOf(mediaAccess), 1);

    this._updateStream();
  }

  async fetchMediaDevices() {
    const devices = await navigator.mediaDevices.enumerateDevices();
    return devices.reduce((acc, device) => {
      acc[device.kind].push(device);
      return acc;
    }, {
      audioinput: [],
      audiooutput: [],
      videoinput: []
    });
  }

  async getMediaConstraints(_ref) {
    let {
      usingAudio,
      usingVideo
    } = _ref;
    const constraints = {
      audio: false,
      video: false
    }; // TODO: Why??

    const {
      audioinput,
      videoinput
    } = await this.fetchMediaDevices();

    if (usingAudio && audioinput.length) {
      const device = this.getCurrentAudioInputDevice();
      constraints.audio = {
        // TODO: Shouldn't it be done after checking if current device exists?
        deviceId: device?.deviceId
      };
    }

    if (usingVideo && videoinput.length) {
      const device = this.getCurrentVideoInputDevice();
      constraints.video = {
        deviceId: device?.deviceId,
        // TODO: Hmm..
        ...DEFAULT_RESOLUTION.value,
        frameRate: DEFAULT_FRAME_RATE
      };
    }

    return constraints;
  }

  _updateCurrentMediaDevice(kind, mediaDeviceInfo) {
    const availables = this._availableMediaDevices[kind];
    const oldCurrent = this._currentMediaDevices[kind];
    let newCurrent = availables.find(d => d.deviceId === mediaDeviceInfo?.deviceId);

    if (!newCurrent) {
      logger.warning(`Selected device is unavailable. fallback to default device.`);
      newCurrent = newCurrent ?? availables.length > 0 ? availables[0] : null;
    } // @ts-ignore


    this._currentMediaDevices[kind] = newCurrent;
    return !eqDevice(oldCurrent, newCurrent);
  }

  _onAudioOutputChanged() {
    for (const access of this.mediaAccesses) {
      if (access.constraints.audio) {
        access.audioOutputChanged();
      }
    }
  }

  selectDevice(kind, mediaDeviceInfo) {
    if (mediaDeviceInfo.kind !== kind) {
      logger.error(new Error(`Tried to select invalid device of type`));
      return;
    }

    if (this._updateCurrentMediaDevice(kind, mediaDeviceInfo)) {
      if (kind === 'audioinput' || kind === 'videoinput') {
        this._updateStream();
      }

      if (kind === 'audiooutput') {
        this._onAudioOutputChanged();
      }
    }
  }

  _updateAvailableDevices(kind, availables) {
    const oldCurrent = this._currentMediaDevices[kind];
    const oldAvailables = this._availableMediaDevices[kind];
    const isNew = !eqDevices(oldAvailables, availables);
    if (!isNew) return false;
    let isCurrentUpdated = false; // @ts-ignore

    this._availableMediaDevices[kind] = availables;
    isCurrentUpdated = this._updateCurrentMediaDevice(kind, oldCurrent);

    for (const listener of this._sendbirdCallListeners.values()) {
      const current = this._currentMediaDevices[kind];

      switch (kind) {
        case 'audioinput':
          listener.onAudioInputDeviceChanged?.(current, availables);
          break;

        case 'audiooutput':
          listener.onAudioOutputDeviceChanged?.(current, availables);
          break;

        case 'videoinput':
          listener.onVideoInputDeviceChanged?.(current, availables);
          break;
      }
    }

    return isCurrentUpdated;
  }

  async refreshMediaDevices(_ref2) {
    let {
      audio,
      video
    } = _ref2;
    let skipUpdateStream = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    if (!audio && !video) throw new Error('at least one of the audio or video must be true');
    const {
      audioinput,
      audiooutput,
      videoinput
    } = await this.fetchMediaDevices();
    let isInputUpdated = false;
    let isOutputUpdated = false;

    if (audio) {
      isInputUpdated = this._updateAvailableDevices('audioinput', audioinput);
      isOutputUpdated = this._updateAvailableDevices('audiooutput', audiooutput);
    }

    if (video) isInputUpdated = this._updateAvailableDevices('videoinput', videoinput) || isInputUpdated;

    if (!skipUpdateStream && isInputUpdated) {
      this._updateStream();
    }

    if (isOutputUpdated) this._onAudioOutputChanged();
  }

}var name = "live-js";
var version = "v1.0.0-beta";
var main = "index.js";
var repository = "https://github.com/sendbird/live-js.git";
var author = "Junyoung Lim <junyoung.lim@sendbird.com>";
var license = "MIT";
var devDependencies = {
	"@babel/preset-env": "^7.18.2",
	"@babel/preset-typescript": "^7.17.12",
	"@microsoft/api-extractor": "^7.28.4",
	"@rollup/plugin-babel": "^5.3.1",
	"@rollup/plugin-commonjs": "^22.0.0",
	"@rollup/plugin-json": "^4.1.0",
	"@rollup/plugin-node-resolve": "^13.3.0",
	"@rollup/plugin-replace": "^4.0.0",
	"@types/uuid": "^8.3.4",
	"@typescript-eslint/eslint-plugin": "^5.21.0",
	"@typescript-eslint/parser": "^5.21.0",
	"babel-plugin-module-resolver": "^4.1.0",
	eslint: "^8.14.0",
	"eslint-import-resolver-typescript": "^2.7.1",
	husky: "^7.0.0",
	jest: "^28.0.2",
	"lint-staged": ">=10",
	rollup: "^2.70.2",
	"rollup-plugin-eslint": "^7.0.0",
	"rollup-plugin-filesize": "^9.1.2",
	"rollup-plugin-progress": "^1.1.2",
	"rollup-plugin-uglify": "^6.0.4",
	"typedoc-plugin-missing-exports": "^0.23.0",
	typescript: "^4.6.3"
};
var scripts = {
	prepare: "husky install",
	"compile-type": "tsc",
	"type-check": "tsc --noEmit",
	prebuild: "npm run type-check",
	build: "rollup -c",
	"build:watch": "rollup -c --watch",
	docs: "typedoc src/sendbirdLiveMain.ts"
};
var dependencies = {
	"@sendbird/chat": "^4.0.6",
	"core-js": "3",
	"node-fetch": "^3.2.6",
	typedoc: "^0.23.7",
	uuid: "^8.3.2"
};
var pack = {
	name: name,
	version: version,
	main: main,
	repository: repository,
	author: author,
	license: license,
	devDependencies: devDependencies,
	scripts: scripts,
	"lint-staged": {
	"*.{js,ts}": "eslint --cache --fix"
},
	dependencies: dependencies
};// import { logger } from 'common/logger/logger';
class WSMessageParser {
  constructor(parse) {
    this._parse = parse;
  }

  parseToJson(response) {
    try {
      return JSON.parse(response);
    } catch (e) {
      // logger.error('failed to parse JSON message', e);
      return {};
    }
  }
  /**
   * Validate if message is one of PeerCommand and Response
   */


  validate(json) {
    const {
      cmd
    } = json;
    const requestId = json.request_id;
    const callType = json.call_type;
    if (!requestId && !cmd && !callType) return false;
    return true;
  }

  parseCommand(json) {
    if (json.error) {
      // TODO: It's better to return Error object. However, how can I deliver requestId?
      const error = {
        requestId: json.request_id,
        message: json.message,
        code: json.code
      };
      return {
        isValid: true,
        error
      };
    }

    return {
      isValid: true,
      command: this._parse(json)
    }; // TODO :: Don't hard code parse logic
    // if (json.call_type === 'room') {
    //   return {
    //     isValid: true,
    //     command: RoomCommandFactory.parse(json),
    //   };
    // }
    //
    // return {
    //   isValid: true,
    //   command: CommandFactory.parse(json),
    // };
  }
  /**
   * @param message: Websocket message
   * @returns ParseResult
   */


  parse(message) {
    const json = this.parseToJson(message);
    const isValid = this.validate(json);

    if (!isValid) {
      return {
        isValid: false
      };
    }

    return this.parseCommand(json);
  }

}// import { VersionUtil } from 'common/consts/versionUtil';
class WebSocketClient extends EventTarget {
  constructor(_ctx) {
    super();
    this._ctx = _ctx;
    this._ws = null;
    this._retryTimer = null;
    this._closed = true;
    this._sessionKey = null;
    this._requestMap = new RequestMap(this._getTimeoutTime());
    this._messageParser = new WSMessageParser(this._ctx.parse);
    this._hostUrl = this._ctx.websocketHost ?? 'wss://ws-IDENTIFIER.calls.sendbird.com'.replace('IDENTIFIER', this._ctx.appId);
  }

  connect() {
    return new Promise((resolve, reject) => {
      if (!this._sessionKey) {
        reject(new Error(`tried to connect to websocket server without auth`));
      }

      this._ws = this._createWebSocket();
      this._closed = false;

      this._ws.onopen = () => {
        this._onOpen();

        resolve(null);
      };

      this._ws.onmessage = e => {
        const {
          isValid,
          error,
          command
        } = this._messageParser.parse(e.data);

        if (!isValid) return;

        if (error) {
          this._processError(error);

          return;
        }

        this.processCommand(command);
      }; // eslint-disable-next-line no-unused-vars


      this._ws.onerror = e => this._onError(e);

      this._ws.onclose = () => {
        this._onClose(); // reject(new ClientError(ErrorCode.ERR_WEBSOCKET_CONNECTION_FAILED));


        reject(new Error('websocket connection failed'));
      };
    });
  }

  _processError(error) {
    const {
      requestId,
      code,
      message
    } = error;

    const deferred = this._requestMap.unregister(requestId);

    if (!deferred) return; // logger.debug(requestId, error.message);
    // deferred.reject(new ServerError(code, { message }));

    deferred.reject(new Error(message));
  }

  processCommand(command) {
    this._dispatchEvent("command", command); // TODO : use event pattern instead of direct reference
    // const { router } = this._ctx;
    // if (command instanceof DirectCallPeerCommand) {
    //   router.routeDirectCallPeerCommand(command, CommandReceivedType.WS);
    // } else if (command instanceof DirectCallResponseCommand) {
    //   const deferred = this._requestMap.unregister(command.requestId);
    //   if (!deferred) return;
    //
    //   router.routeDirectCallResponseCommand(command, deferred);
    // } else if (command instanceof DirectCallServerCommand) {
    //   router.routeDirectCallServerCommand(command, CommandReceivedType.WS);
    // } else if (command instanceof LogServerCommand) {
    //   router.routeLogServerCommand(command);
    // } else if (command instanceof ServerCommand) {
    //   router.routeServerCommand(command);
    // } else if (command instanceof PeerCommand) {
    //   router.routePeerCommand(command);
    // }

  }

  setSessionKey(sessionKey) {
    this._sessionKey = sessionKey;
  }

  clearSessionKey() {
    this._disconnect();

    this._sessionKey = null;
  }

  _disconnect() {
    if (!this._ws) return;
    this._closed = true;

    this._removeRetryTimer();

    this._ws.onopen = null;
    this._ws.onmessage = null;
    this._ws.onerror = null;
    this._ws.onclose = null;

    this._ws.close(); // this._requestMap.rejectAll(new ClientError(ErrorCode.ERR_REQUEST_FAILED_DUE_TO_WEBSOCKET_CONNECTION_LOST));


    this._requestMap.rejectAll(new Error('request failed due to websocket connection lost'));

    this._ws = null;
  } // send(req: DirectCallCommand) {
  //   const responsePromise = req.requireResponse()
  //     ? this._requestMap.register(req.requestId).promise
  //     : Promise.resolve();
  //
  //   const data = req.serialize();
  //   this._ws.send(`${data}\n`);
  //
  //   return responsePromise;
  // }


  get isConnected() {
    if (!this._ws) return false;
    return this._ws.readyState === 1;
  }

  _onOpen() {// TODO :: fix this
    // this._ctx.router.routeWebSocketInternalCommand(CommandFactory.createWebSocketConnectedCommand());
  }

  _onError(e) {// logger.error(e);
  }

  _onClose() {
    this._startToReconnect();
  }

  _createWebSocket() {
    const params = `/?sbcall_session_token=${encodeURIComponent(this._sessionKey)}&sbcall_client_id=${encodeURIComponent(this._ctx.clientId)}&sendbird=${encodeURIComponent(this._getVersion())}`;
    return new WebSocket(this._getHost() + params);
  }

  _getVersion() {
    return `JS,${this._getOsVersion()},${pack.version}`;
  }

  _getHost() {
    return this._hostUrl;
  }

  _startToReconnect() {
    if (this._closed) return;
    if (this._retryTimer) return;
    this._retryTimer = setTimeout(this._reconnect.bind(this), this._getRetryTime());
  }

  _reconnect() {
    this._removeRetryTimer();

    this.connect().catch(() => {// logger.error('websocket reconnection is failed.');
    });
  }

  _removeRetryTimer() {
    if (this._retryTimer) {
      clearTimeout(this._retryTimer);
      this._retryTimer = null;
    }
  }

  _getTimeoutTime() {
    return 60000;
  }

  _getRetryTime() {
    return 2000;
  }

  _getOsVersion() {
    return typeof navigator !== 'undefined' && navigator.userAgent ? navigator.userAgent.replace(/,/g, '.') : 'undefined';
  }

}// import nodeFetch from 'node-fetch';
class APIClient {
  constructor(_ctx) {
    this._ctx = _ctx;

    this._fetch = function () {
      return window.fetch(...arguments);
    };

    this._sessionKey = null; // FIXME :: generalize host url

    this._hostUrl = this._ctx.apiHost ?? 'https://api-IDENTIFIER.calls.sendbird.com'.replace('IDENTIFIER', this._ctx.appId);
  }

  setSessionKey(sessionKey) {
    this._sessionKey = sessionKey;
  }

  clearSessionKey() {
    this._sessionKey = null;
  }

  async send(req) {
    if (!req.getApiOption) throw new Error(`invalid api request ${JSON.stringify(req)}`);
    const apiConfig = req.getApiOption();
    if (apiConfig.auth && !this._sessionKey) throw new Error(`tried to call private api without auth`);
    const headers = {
      'Content-Type': 'application/json',
      ...apiConfig.headers
    };
    headers.SendBird = `JS,${this._getOsVersion()},${pack.version}`;
    headers['SBCall-Client-Id'] = this._ctx.clientId;

    if (this._sessionKey) {
      headers['SBCall-Session-Token'] = this._sessionKey;
    }

    const res = await this._fetch(`${this._getHost()}${apiConfig.path}`, {
      method: apiConfig.method,
      body: JSON.stringify(apiConfig.body),
      headers
    });
    const body = await res.text();
    let bodyJson = null;

    try {
      bodyJson = JSON.parse(body);
    } catch (e) {
      // FIXME :: throw error
      // throw new ClientError(ErrorCode.ERR_MALFORMED_DATA);
      throw new Error('malformed data');
    }

    if (!res.ok) {
      if (bodyJson.error) {
        // throw new ServerError(bodyJson.code, { message: bodyJson.message });
        throw new Error('server error');
      } else {
        if (res.status === 500) {
          // throw new ClientError(ErrorCode.INTERNAL_SERVER_ERROR);
          throw new Error('internal server error');
        }

        if (res.status >= 300 && res.status < 400) {
          // throw new ClientError(ErrorCode.ERR_MALFORMED_DATA);
          throw new Error('malformed data');
        } // throw new ClientError(ErrorCode.ERR_REQUEST_FAILED);


        throw new Error('request failed');
      }
    }

    try {
      const command = this._ctx.parseResponse(req, bodyJson);

      if (command) {
        return command;
      }
    } catch (e) {
      return bodyJson;
    }

    return bodyJson;
  }

  _getHost() {
    return this._hostUrl;
  }

  _getOsVersion() {
    return typeof navigator !== 'undefined' && navigator.userAgent ? navigator.userAgent.replace(/,/g, '.') : 'undefined';
  }

}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t;}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r);}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e));}catch(e){s(e);}}function a(e){try{u(r.throw(e));}catch(e){s(e);}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t);}))).then(o,a);}u((r=r.apply(e,t||[])).next());}))}function i(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o);}catch(e){s=[6,e],r=0;}finally{n=i=0;}if(5&s[0])throw s[1];return {value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return {next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value);}catch(e){i={error:e};}finally{try{r&&!r.done&&(n=s.return)&&n.call(s);}finally{if(i)throw i.error}}return o}function a(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var u,c$1="4.0.6",l$1=function(){function e(){}return Object.defineProperty(e,"OS_VERSION",{get:function(){return "undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_VERSION",{get:function(){return "4.0.6"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_MAJOR_VERSION",{get:function(){return e.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"INTERNAL_CALL",{get:function(){return "ic"},enumerable:!1,configurable:!0}),e}();!function(e){e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",e[e.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED";}(u||(u={}));var d$1,h$1=function(e){return !(e instanceof p&&!e.shouldThrowOutside)},p=function(e){function n(t){var r=t.code,i=void 0===r?0:r,s=t.message,o=e.call(this,s)||this;return o.shouldThrowOutside=!1,o.name="SendbirdError",o.code=i,Object.setPrototypeOf(o,n.prototype),o}return t(n,e),Object.defineProperty(n.prototype,"isInvalidTokenError",{get:function(){return this.code===u.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===u.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===u.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n,"debugModeRequired",{get:function(){return new n({code:u.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"lostInstance",{get:function(){return new n({code:u.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRenew",{get:function(){return new n({code:u.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidConnectionStateTransition",{get:function(){return new n({code:u.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRequired",{get:function(){return new n({code:u.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionCanceled",{get:function(){return new n({code:u.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidParameters",{get:function(){return new n({code:u.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"networkError",{get:function(){return new n({code:u.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"markAsReadAllRateLimitExceeded",{get:function(){return new n({code:u.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"queryInProgress",{get:function(){return new n({code:u.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"noAckTimeout",{get:function(){return new n({code:u.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"loginTimeout",{get:function(){return new n({code:u.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionClosed",{get:function(){return new n({code:u.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestFailed",{get:function(){return new n({code:u.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileUploadCanceled",{get:function(){return new n({code:u.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestCanceled",{get:function(){return new n({code:u.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRefreshFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRequestFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),n.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},n}(Error),f=[u.CONNECTION_REQUIRED,u.NETWORK_ERROR,u.ACK_TIMEOUT,u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.FILE_UPLOAD_CANCEL_FAILED,u.REQUEST_CANCELED,u.INTERNAL_SERVER_ERROR,u.RATE_LIMIT_EXCEEDED,u.UNKNOWN_SERVER_ERROR],_$1=[u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.CONNECTION_REQUIRED],g=function(e,t){if(e!==t){var r=n({},e),i=n({},t);return (!r.hasOwnProperty("messageId")||!i.hasOwnProperty("messageId")||r.messageId===i.messageId)&&((!r.hasOwnProperty("reqId")||!i.hasOwnProperty("reqId")||r.reqId===i.reqId)&&(r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,i.hasOwnProperty("messageId")&&delete i.messageId,i.hasOwnProperty("reqId")&&delete i.reqId,JSON.stringify(r)===JSON.stringify(i)))}return !0},y=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||("string"!=typeof e?"object"==typeof e?m(e,t):v(e,t):typeof t===e)},m=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Object.values(e).includes(t)},v=function(e,t){return t instanceof e},E=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Array.isArray(t)&&t.every((function(t){return y(e,t)}))},I=function(e){return e>0&&_$1.indexOf(e)>=0},S=function(e,t){if(void 0===t&&(t=!1),t&&null===e)return !0;var n=y("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},b=function(){function e(e){var t=void 0===e?{}:e,n=t.useMemberInfoInMessage,r=void 0!==n&&n,i=t.typingIndicatorInvalidateTime,s=void 0===i?1e4:i,o=t.typingIndicatorThrottle,a=void 0===o?1e3:o,u=t.websocketResponseTimeout,c=void 0===u?1e4:u;this._useMemberInfoInMessage=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=r,this._typingIndicatorInvalidateTime=s,this._typingIndicatorThrottle=a,this._websocketResponseTimeout=c;}return Object.defineProperty(e.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){y("boolean",e)&&(this._useMemberInfoInMessage=e);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){y("number",e)&&(this._typingIndicatorInvalidateTime=e);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){y("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){y("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e);},enumerable:!1,configurable:!0}),e}(),N={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},A$1={encrypt:function(e){return e},decrypt:function(e){return e}},C$1=function(){function e(e){var t=e.store;this._preference=new Map,this._store=t;}return e.prototype._savePreferenceKeys=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._store.set({key:this._keysAddress,value:a([],o(this._preference.keys()),!1),generation:1})];case 1:return e.sent(),[2]}}))}))},e.prototype.init=function(e){var t;return r(this,void 0,void 0,(function(){var n,r,o,a,u,c,l,d;return i(this,(function(i){switch(i.label){case 0:return this._keysAddress=e,[4,this._store.get(e)];case 1:n=null!==(t=i.sent())&&void 0!==t?t:[],i.label=2;case 2:i.trys.push([2,7,8,9]),r=s(n),o=r.next(),i.label=3;case 3:return o.done?[3,6]:(a=o.value,[4,this._store.get(a)]);case 4:(u=i.sent())&&this._preference.set(a,u),i.label=5;case 5:return o=r.next(),[3,3];case 6:return [3,9];case 7:return c=i.sent(),l={error:c},[3,9];case 8:try{o&&!o.done&&(d=r.return)&&d.call(r);}finally{if(l)throw l.error}return [7];case 9:return [2]}}))}))},e.prototype.get=function(e){var t;return r(this,void 0,void 0,(function(){return i(this,(function(n){return [2,null!==(t=this._preference.get(e))&&void 0!==t?t:null]}))}))},e.prototype.set=function(e,t){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=!this._preference.has(e),[4,this._store.set({key:e,value:t,generation:1})];case 1:return r.sent(),this._preference.set(e,t),n?[4,this._savePreferenceKeys()]:[3,3];case 2:r.sent(),r.label=3;case 3:return [2]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._store.remove(e)];case 1:return t.sent(),this._preference.delete(e),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._store.removeMany(a([],o(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}}))}))},e}(),O=function(e){var t=e.encryption,n=void 0===t?null:t,r=e.store,i=void 0===r?null:r,s=e.localCacheEnabled,o=void 0===s||s;this.nestdb=null,this.store=i,this.preference=new C$1({store:i}),this.encryption=null!=n?n:A$1,this.localCacheEnabled=o;},w=function(){function e(){this.sessionKey=null,this.authToken=null;}return Object.defineProperty(e.prototype,"hasSession",{get:function(){return !!this.sessionKey},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this.authToken=null,this.sessionKey=null;},e}(),R=function(){var e=(new Date).getTime();return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},D=function(){function e(e){var t=e.container;this._container={},this._container=t,this.key=R();}return e.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},e.prototype.on=function(e,t){return this._register(e,-1,t)},e.prototype.once=function(e,t){return this._register(e,1,t)},e.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key);},e}(),M=function(){function e(){this._container={};}return e.prototype.on=function(e,t){return new D({container:this._container}).on(e,t)},e.prototype.once=function(e,t){return new D({container:this._container}).once(e,t)},e.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var o=[];try{for(var a=s(i.keys()),u=a.next();!u.done;u=a.next()){var c=u.value,l=i.get(c);l.handler(t),l.occurence>0&&(l.occurence--,0===l.occurence&&o.push(c));}}catch(e){n={error:e};}finally{try{u&&!u.done&&(r=a.return)&&r.call(a);}finally{if(n)throw n.error}}o.forEach((function(e){return i.delete(e)}));}},e}(),k=function(){function e(){this._dispatcher=new M;}return e.prototype.on=function(e){return this._dispatcher.on("event",e)},e.prototype.once=function(e){return this._dispatcher.once("event",e)},e.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e);},e}(),L=function(){},U$1=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0!==e[n]&&NaN!==e[n]&&null!==e[n]&&(t[n]=e[n]);})),t};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE";}(d$1||(d$1={}));var P,q$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params={},t.requireAuth=!0,t.headers={},t.requestId=R(),t}return t(n,e),n.prototype.stringifyParams=function(e){return "object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},Object.defineProperty(n.prototype,"query",{get:function(){var e=this,t=U$1(this.params);return "?".concat(Object.keys(t).map((function(n){return "".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e.stringifyParams(t[n])))})).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"payload",{get:function(){var e=this,t=U$1(this.params);if(Object.keys(t).some((function(e){return S(t[e])}))){var n=new FormData;return Object.keys(t).forEach((function(r){var i,s=t[r];if(S(s)){var o=s;n.append(r,o,null!==(i=o.name)&&void 0!==i?i:"filename");}else n.append(r,e.stringifyParams(s));})),n}return JSON.stringify(t)},enumerable:!1,configurable:!0}),n}(L),F=function(e){function r(t,n){var r=e.call(this)||this;return r._iid=t,r._payload=n,r}return t(r,e),Object.defineProperty(r.prototype,"payload",{get:function(){return n({},this._payload)},enumerable:!1,configurable:!0}),r.prototype.as=function(e){return new e(this._iid,this.payload)},r}(L),x=function(e){function n(t){var n=e.call(this)||this;return n.requestId=t,n}return t(n,e),n}(L),G$1=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(L),Q$1=function(e){function n(t){var n=e.call(this)||this;return n.statLog=t,n}return t(n,e),n}(L);!function(e){e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result";}(P||(P={}));var j,K$1=function(){function e(e){var t=e.type,n=e.data,r=e.ts,i=void 0===r?Date.now():r;this.type=t,this.createdAt=i,this.data=n;}return e.payloadify=function(e){return U$1({stat_type:e.type,ts:e.createdAt,data:U$1(e.data)})},e}(),z$1=function(){return "undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product},V$1=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.logger,o=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on((function(e){e instanceof x&&o.cancel(e.requestId);})),this._logger=s;}return Object.defineProperty(e.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t=z$1()?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",i=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return "".concat(t,"/c").concat(l$1.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(i)},enumerable:!1,configurable:!0}),e.prototype._createHeader=function(e,t){void 0===t&&(t=null);var r=this._sdkState,i=r.appId,s=r.appVersion,o=n(n({},e.headers),{SendBird:"JS,".concat(l$1.OS_VERSION,",").concat(l$1.SDK_VERSION,",").concat(i).concat(s?",".concat(s):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(o["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(o["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(o["App-Id"]=i,o["Access-Token"]=this._auth.authToken),o},e.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new Q$1(new K$1({type:P.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})));},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,o,a,u,c,l,h,f,_,g,y,m;return i(this,(function(i){switch(i.label){case 0:t=e.path,n=e.method,r=![d$1.GET,d$1.DELETE].includes(n),s=this._sdkState.api,o="".concat(s.host).concat(t).concat(r?"":e.query),a=r?e.payload:null,u=this._createHeader(e,a instanceof FormData?a:null),c=new AbortController,l=c.signal,this._abortControl.set(e.requestId,c),h=Date.now(),i.label=1;case 1:return i.trys.push([1,4,,5]),[4,fetch(o,{method:n,body:a,headers:u,signal:l})];case 2:return [4,(f=i.sent()).json()];case 3:if(_=i.sent(),f.ok||f.redirected)return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,h,null),[2,new F(this._iid,_)];throw _?((g=new p(_)).isSessionKeyExpiredError&&this._dispatcher.dispatch(new G$1),this._statLogApiResult(e,h,g),g):(g=p.requestFailed,this._statLogApiResult(e,h,g),g);case 4:throw y=i.sent(),this._statLogApiResult(e,h,y),y instanceof p?(this._logger.debug("fail api request",y),y):"AbortError"===y.name?p.requestCanceled:(m=p.networkError,this._logger.debug("fail api request",m),m);case 5:return [2]}}))}))},e.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e));},e.prototype.cancelAll=function(){var e,t;try{for(var n=s(this._abortControl.values()),r=n.next();!r.done;r=n.next()){r.value.abort();}}catch(t){e={error:t};}finally{try{r&&!r.done&&(t=n.return)&&t.call(n);}finally{if(e)throw e.error}}this._abortControl.clear();},e}(),B$1=function(e){function n(t,n,r,i){void 0===i&&(i="");var s,o=this;return (o=e.call(this)||this)._iid=t,o.code=n,o.payload=r,o.requestId=r?null!==(s=r.req_id)&&void 0!==s?s:i:"",o}return t(n,e),n.createFromRawMessage=function(e,t){var r=t.substring(0,4),i=null;try{i=JSON.parse(t.substring(4));}catch(e){r="NOOP";}finally{return new n(e,r,i)}},n.prototype.convertToMessage=function(){return "".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},n}(L),H$2=function(e){function n(t){var n,r=t.code,i=t.ackRequired,s=t.payload,o=void 0===s?null:s,a=this;return (a=e.call(this)||this).code=r,a.payload=o,a.requestId=null!==(n=a.payload.req_id)&&void 0!==n?n:R(),a.ackRequired=i,a.payload.req_id=a.requestId,a}return t(n,e),n.prototype.convertToMessage=function(){return "".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n}(L),W$1=function(e){function n(){return e.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return t(n,e),n}(H$2),X$1=function(){function e(e){var t=e.pingDelegate,n=e.sdkState,r=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=r;}return Object.defineProperty(e.prototype,"isWaiting",{get:function(){return !!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),e.prototype.ping=function(){var e,t=this,n=new W$1;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null);}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()");}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null);}return n},e.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null);},e.prototype.refreshTimer=function(){var e,t=this;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping();}),n);},e.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping();},e.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null);},e}(),Y=function(){};!function(e){e.CONNECTING="CONNECTING",e.OPEN="OPEN",e.CLOSED="CLOSED";}(j||(j={}));var J$1,Z$1=function(e){function n(t,n){var r=n.sdkState,i=n.dispatcher,s=n.logger,o=e.call(this)||this;return o._pinger=null,o.lastActive=0,o._iid=t,o._sdkState=r,o._dispatcher=i,o._logger=s,o._sdkState.websocket.pingerDisabled||(o._pinger=new X$1({pingDelegate:{send:function(e){return o.send(e)},error:function(e){return o.error(e)}},sdkState:o._sdkState,logger:s})),o}return t(n,e),Object.defineProperty(n.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return j.CONNECTING;case 1:return j.OPEN}return j.CLOSED},enumerable:!1,configurable:!0}),n.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open");},this._ws.onmessage=function(e){e.data.split("\n").forEach((function(e){if(e&&y("string",e)){var n=B$1.createFromRawMessage(t._iid,e);t._logger.debug("receive websocket event",n),"LOGI"===n.code?(n.payload&&!n.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",n)):"PONG"===n.code?t._pinger&&t._pinger.pong():"EXPR"===n.code?n.payload&&n.payload.expires_in>0&&t._dispatcher.dispatch(new G$1):"NOOP"===n.code||t.dispatch("message",n);}}));},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",p.networkError);},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close");},this.lastActive=Date.now();},n.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=Y,this._ws.onmessage=Y,this._ws.onerror=Y,this._ws.onclose=function(){e.dispatch("close");},this._ws.close(),this._ws=null);},n.prototype.send=function(e){if(!this._ws)throw p.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage());},n.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e);},n}(M),$$1=function(e){function n(t){var n=t.all,r=t.custom_types,i=t.ts,s=e.call(this)||this;return s.all=n,s.customTypes=r,s.ts=i,s}return t(n,e),n}(L),ee$1=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n;}));},te$1=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.logger,o=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=s,this.apiClient=new V$1(e,{auth:n,sdkState:r,dispatcher:i,logger:s}),this.websocketClient=new Z$1(e,{sdkState:r,dispatcher:i,logger:s}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&o._dispatcher.dispatch(new $$1(e.payload.unread_cnt)),e.requestId){if(o._ackStateMap.has(e.requestId)){var t=o._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new p({code:e.payload.code,message:e.payload.message}));}}else o._dispatcher.dispatch(e);})).on("close",(function(){o._ackStateMap.forEach((function(e){e.reject(p.connectionClosed);})),o._ackStateMap.clear();}));}return e.prototype._sendApiRequest=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this.apiClient.send(e)];case 1:return [2,t.sent()]}}))}))},e.prototype._sendWebsocketRequest=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s=this;return i(this,(function(i){if(t=new ee$1,e.ackRequired){n=null,r=function(r,i){void 0===r&&(r=null),void 0===i&&(i=null),s._ackStateMap.has(e.requestId)&&(s._ackStateMap.delete(e.requestId),n&&(clearTimeout(n),n=null),r?(s._logger.debug("fail websocket request",r),t.reject(r)):(s._logger.debug("receive websocket ack",e.requestId),t.resolve(i)));};try{n=setTimeout((function(){return r(p.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return r(null,e)},reject:function(e){return r(e)}}),this.websocketClient.send(e);}catch(e){r(e);}}else try{this.websocketClient.send(e),t.resolve(null);}catch(e){t.reject(e);}return [2,t.promise]}))}))},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e instanceof q$1?[4,this._sendApiRequest(e)]:[3,2];case 1:case 3:return [2,t.sent()];case 2:return e instanceof H$2?[4,this._sendWebsocketRequest(e)]:[3,4];case 4:throw p.invalidParameters}}))}))},e.prototype.cancel=function(e){this.apiClient.cancel(e);},e.prototype.cancelAll=function(){this.apiClient.cancelAll();},e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.LOGOUT=6]="LOGOUT";}(J$1||(J$1={}));var ne,re,ie,se$1,oe$2,ae,ue$2,ce$2,le$2,de$2=function(e){function n(t){var n=t.stateType,r=e.call(this)||this;return r.stateType=n,r}return t(n,e),n}(L),he$2=function(){function e(e,t){var n=t.auth,s=t.sdkState,o=t.dispatcher,a=t.logger,u=this;this._currentConnectionStateType=J$1.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new te$1(e,{auth:n,sdkState:s,dispatcher:o,logger:a}),this._auth=n,this._logger=a,this._dispatcher=o,this._dispatcher.on((function(e){if(e instanceof de$2){var t=e.stateType;switch(u._currentConnectionStateType=t,t){case J$1.CONNECTED:var n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return r(u,void 0,void 0,(function(){var t,n,r,s,o;return i(this,(function(i){switch(i.label){case 0:t=e.command,n=e.deferred,r=e.timeout,clearTimeout(r),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.send(t)];case 2:return s=i.sent(),n.resolve(s),[3,4];case 3:return o=i.sent(),n.reject(o),[3,4];case 4:return [2]}}))}))}));break;case J$1.INITIALIZED:case J$1.DISCONNECTED:case J$1.LOGOUT:n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return r(u,void 0,void 0,(function(){var t,n;return i(this,(function(r){return t=e.deferred,n=e.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(p.connectionClosed):t.reject(p.connectionRequired),[2]}))}))}));}}}));}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._currentConnectionStateType===J$1.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===J$1.CONNECTING||this._currentConnectionStateType===J$1.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.send=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return e instanceof H$2?this.isReady?(this._logger.debug("send websocket request",e),[4,this.commandRouter.send(e)]):[3,2]:[3,4];case 1:case 5:return [2,i.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",e),t=new ee$1,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),p.connectionRequired;case 3:return [3,7];case 4:return e instanceof q$1?this._auth.hasSession?(this._logger.debug("send api request",e),[4,this.commandRouter.send(e)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",e),t=new ee$1,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw n=p.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return [2]}}))}))},e.prototype.forceSend=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._logger.debug("send websocket request (forced)",e),[4,this.commandRouter.send(e)];case 1:return [2,t.sent()]}}))}))},e.prototype.timeout=function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(p.connectionRequired),this._lazyCallQueue.splice(t,1));},e.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e);},e.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll();},e}(),pe$2=function(e){function n(t){var n=t.userId,r=t.authToken,i=t.expiringSession,s=void 0===i||i,o=e.call(this)||this;return o.path="/users/".concat(n,"/session_key"),o.method=d$1.POST,o.params={token:r,expiring_session:!!s},o.requireAuth=!1,o}return t(n,e),n}(q$1),fe$2=function(e){function n(t){var n=t.authToken,r=t.expiringSession,i=void 0===r||r;return e.call(this,{code:"LOGI",payload:{token:n,expiring_session:i?1:0},ackRequired:!0})||this}return t(n,e),n}(H$2),_e$2=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=n.key;return r.key=i,r}return t(n,e),n}(F),ge$2=function(e){function n(t,n,r){var i=e.call(this,t,"LOGI",r)||this;return i.error=null,i.newKey=r.new_key,i.error=r.error?new p(r.error):null,i}return t(n,e),n}(B$1),ye$2=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(L),me$2=function(e){return r(void 0,void 0,void 0,(function(){return i(this,(function(t){return [2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},ve$2=function(){function e(){}return e.prototype.calcTimeout=function(){return 0},e}(),Ee$2=function(e,t,n){return void 0===n&&(n=new ve$2),r(void 0,void 0,void 0,(function(){var r,s,o,a,u,c;return i(this,(function(i){switch(i.label){case 0:r=0,s=null,o=function(e){return void 0===e&&(e=null),s=null!=e?e:new Error("Halted")},a=function(){r=0;},i.label=1;case 1:if(!(-1===t||r<t))return [3,9];i.label=2;case 2:return i.trys.push([2,4,,8]),[4,e(o,a)];case 3:if(u=i.sent(),s)throw s;return [2,u];case 4:if(c=i.sent(),s)return [3,6];if(++r===t)throw c;return [4,me$2(n.calcTimeout(r))];case 5:return i.sent(),[3,7];case 6:throw s;case 7:return [3,8];case 8:return [3,1];case 9:return [2]}}))}))},Ie$1=function(e){return r(void 0,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:if(!((t=n.sent())instanceof p))throw t;return t.throwOutside(),[3,3];case 3:return [2]}}))}))},Te$1=function(){function e(e){var t=e.auth,n=e.sdkState,r=e.dispatcher,i=e.requestQueue,s=e.logger,o=this;this._currentConnectionStateType=J$1.INITIALIZED,this.auth=t,this._sdkState=n,this._dispatcher=r,this._requestQueue=i,this._logger=s,this._dispatcher.on((function(e){if(e instanceof de$2){var t=e.stateType;o._currentConnectionStateType=t;}else e instanceof G$1&&o.refresh();}));}return e.prototype.createRefreshWebsocketCommand=function(e){return new fe$2({authToken:e,expiringSession:!0})},e.prototype._refreshSessionKey=function(e,t){return r(this,void 0,void 0,(function(){var n,s,o,a,u,c,l,d=this;return i(this,(function(f){switch(f.label){case 0:if(this._currentConnectionStateType!==J$1.CONNECTED)return [3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),n=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(n)];case 2:if(s=f.sent(),o=s.as(ge$2),a=o.newKey,u=o.error)throw u;return this.auth.sessionKey=null!=a?a:this.auth.sessionKey,this._logger.debug("session refreshed"),Ie$1((function(){return r(d,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionRefreshed(),[2]}))}))})),t&&t.resolve(),[2];case 3:if(c=f.sent(),h$1(c))throw c;return c.isSessionTokenExpiredError?(this._handleError(t),[2]):[3,4];case 4:return f.trys.push([4,6,,7]),l=new pe$2({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),[4,Ee$2((function(e){return r(d,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(l)];case 1:return t=i.sent(),n=t.as(_e$2).key,this.auth.sessionKey=n,[3,3];case 2:throw (r=i.sent()).isSessionTokenExpiredError&&e(p.sessionTokenRefreshFailed),r;case 3:return [2]}}))}))}),3)];case 5:return f.sent(),this._logger.debug("session refreshed"),[3,7];case 6:return f.sent(),this._handleError(t),[2];case 7:return Ie$1((function(){return r(d,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionRefreshed(),[2]}))}))})),t&&t.resolve(),[2]}}))}))},e.prototype._handleError=function(e){var t=this,n=p.sessionTokenRefreshFailed;Ie$1((function(){return r(t,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionError(n),[2]}))}))})),e&&e.reject(n);},e.prototype.refresh=function(){return r(this,void 0,void 0,(function(){var e,t,n,s=this;return i(this,(function(o){return this.handler?(e=new ee$1,t=function(t){t?(s._logger.debug("session refreshing.."),s.auth.authToken=t,s._refreshSessionKey(t,e)):(s._logger.debug("session closed"),Ie$1((function(){return r(s,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionClosed(),[2]}))}))})),e.resolve());},n=function(){s._dispatcher.dispatch(new ye$2);var t=p.sessionTokenRequestFailed;s.handler&&(Ie$1((function(){return r(s,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionError(t),[2]}))}))})),e.reject(t));},this._logger.debug("session expired"),this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,e):Ie$1((function(){return r(s,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionTokenRequired(t,n),[2]}))}))})),[2,e.promise]):[2]}))}))},e}(),be$2=function(){function e(){this.type=J$1.NONE,this.name="none";}return e.prototype.run=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2]}))}))},e.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2]}))}))},e.prototype.onReconnect=function(e,t){return t.resetReconnectCount,r(this,void 0,void 0,(function(){return i(this,(function(e){return [2]}))}))},e.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,r(this,void 0,void 0,(function(){return i(this,(function(e){return [2]}))}))},e.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2]}))}))},e}(),Ne$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=J$1.LOGOUT,t.name="logout",t}return t(n,e),n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(s){switch(s.label){case 0:return t=e.sdkState.userId,e.logout(),Ie$1((function(){return r(n,void 0,void 0,(function(){return i(this,(function(n){return e.connectionHandlers.forEach((function(e){e.onDisconnected(t);})),[2]}))}))})),[4,e.changeState(new Re$2)];case 1:return s.sent(),[2]}}))}))},n}(be$2),Ae$3=function(e){function n(t){var n=t.autoReconnect,r=e.call(this)||this;return r.type=J$1.DISCONNECTED,r.name="disconnected",r._autoReconnect=!1,r._autoReconnect=n,r}return t(n,e),n.prototype.run=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.disconnect(),this._autoReconnect?[4,e.changeState(new Ce$1)]:[3,2];case 1:t.sent(),t.label=2;case 2:return [2]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e.disconnect(),[4,e.changeState(new we$1({authToken:t}))];case 1:return n.sent(),[2]}}))}))},n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,e.changeState(new Ce$1)];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,e.changeState(new Ne$1)];case 1:return t.sent(),[2]}}))}))},n}(be$2),Ce$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=J$1.RECONNECTING,t.name="reconnecting",t._haltConnect=null,t._resetConnect=null,t._callbacks=[],t}return t(n,e),n.prototype.flushCallbacks=function(e){void 0===e&&(e=null),this._callbacks.forEach((function(t){return t(e)}));},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,s,o,a,c=this;return i(this,(function(l){switch(l.label){case 0:t=new ee$1,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),Ie$1((function(){return r(c,void 0,void 0,(function(){return i(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectStarted();})),[2]}))}))})),l.label=1;case 1:return l.trys.push([1,4,,9]),n=e.sdkState.websocket,s=n.reconnectMaxRetry,o=n.reconnectRetryStrategy,[4,Ee$2((function(t,n){return r(c,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:this._haltConnect=t,this._resetConnect=n,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.connect()];case 2:return i.sent(),[3,4];case 3:if((r=i.sent())instanceof p&&r.code===u.CONNECTION_CANCELED)return t(r),[2];throw r;case 4:return [2]}}))}))}),s,o)];case 2:return l.sent(),[4,e.changeState(new Oe$1)];case 3:return l.sent(),Ie$1((function(){return r(c,void 0,void 0,(function(){return i(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded();})),this.flushCallbacks(null),[2]}))}))})),[3,9];case 4:return a=l.sent(),h$1(a)?[3,7]:a instanceof p?a.code===u.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Ae$3({autoReconnect:!1}))]:[3,6];case 5:l.sent(),l.label=6;case 6:return Ie$1((function(){return r(c,void 0,void 0,(function(){return i(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectFailed();})),this.flushCallbacks(a),[2]}))}))})),[3,8];case 7:throw a;case 8:return [3,9];case 9:return [2,t.promise]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){return t=new ee$1,this._resetConnect&&this._resetConnect(),e.cancelConnectForRetry(),this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),[2,t.promise]}))}))},n.prototype.onReconnect=function(e,t){var n=t.resetReconnectCount,s=void 0!==n&&n;return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){return t=new ee$1,this._resetConnect&&s&&this._resetConnect(),e.cancelConnectForRetry(),this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),[2,t.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,s=void 0===n?null:n,o=t.autoReconnect,a=void 0===o||o;return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(null!=s?s:p.connectionCanceled),[4,e.changeState(new Ae$3({autoReconnect:a}))];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,e.changeState(new Ne$1)];case 1:return t.sent(),[2]}}))}))},n}(be$2),Oe$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=J$1.CONNECTED,t.name="connected",t}return t(n,e),n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.disconnect(),[4,e.changeState(new Ce$1)];case 1:return t.sent(),[2]}}))}))},n.prototype.onDisconnect=function(e,t){var n=t.autoReconnect;return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,e.changeState(new Ae$3({autoReconnect:n}))];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,e.changeState(new Ne$1)];case 1:return t.sent(),[2]}}))}))},n}(be$2),we$1=function(e){function n(t){var n=t.authToken,r=e.call(this)||this;return r.type=J$1.CONNECTING,r.name="connecting",r._authToken="",r._haltConnect=null,r._callbacks=[],r._authToken=n,r}return t(n,e),n.prototype.flushCallbacks=function(e){void 0===e&&(e=null),this._callbacks.forEach((function(t){return t(e)}));},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,s=this;return i(this,(function(o){switch(o.label){case 0:t=new ee$1,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),o.label=1;case 1:return o.trys.push([1,4,,9]),[4,Ee$2((function(t){return r(s,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:this._haltConnect=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return r.sent(),[3,4];case 3:if((n=r.sent())instanceof p&&n.code===u.CONNECTION_CANCELED)return t(n),[2];throw n;case 4:return [2]}}))}))}),e.sdkState.websocket.connectMaxRetry)];case 2:return o.sent(),[4,e.changeState(new Oe$1)];case 3:return o.sent(),Ie$1((function(){return r(s,void 0,void 0,(function(){return i(this,(function(t){return e.connectionHandlers.forEach((function(t){t.onConnected(e.sdkState.userId);})),this.flushCallbacks(null),[2]}))}))})),[3,9];case 4:return n=o.sent(),h$1(n)?[3,7]:(e.disconnect(),n instanceof p?n.code===u.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Re$2)]:[3,6]);case 5:o.sent(),o.label=6;case 6:return Ie$1((function(){return r(s,void 0,void 0,(function(){return i(this,(function(e){return this.flushCallbacks(n),[2]}))}))})),[3,8];case 7:throw n;case 8:return [3,9];case 9:return [2,t.promise]}}))}))},n.prototype.onConnect=function(e){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return e=new ee$1,this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,s=void 0===n?null:n;return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(null!=s?s:p.connectionCanceled),[4,e.changeState(new Ne$1)];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,e.changeState(new Ne$1)];case 1:return t.sent(),[2]}}))}))},n}(be$2),Re$2=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=J$1.INITIALIZED,t.name="initialized",t}return t(n,e),n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return [4,e.changeState(new we$1({authToken:t}))];case 1:return n.sent(),[2]}}))}))},n}(be$2),De$2=new Map,Me$2=function(e,t){var n;return void 0===t&&(t=null),null!==t&&De$2.set(e,t),null!==(n=De$2.get(e))&&void 0!==n?n:""},ke$1=function(e){void 0===e&&(e={}),this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[];},Le$2=function(){function e(e){this._iid="",this._iid=e;}return e.payloadify=function(e){return e?{}:null},e}(),Ue$2="/".concat("v3","/users"),Pe$2="/".concat("v3","/storage/file"),qe$2="/".concat("v3","/group_channels"),xe$1="/".concat("v3","/open_channels"),Ge$2="/".concat("v3","/sdk/open_channels"),Qe$2="/".concat("v3","/search"),je$2="/".concat("v3","/report"),Ke$2="/".concat("v3","/emojis"),ze$2="/".concat("v3","/emoji_categories"),Be$2="/".concat("v3","/sdk/statistics"),He$2=function(e){function n(t){var n=t.userId,r=t.metadata,i=e.call(this)||this;return i.method=d$1.POST,i.path="".concat(Ue$2,"/").concat(n,"/metadata"),i.params={metadata:r},i}return t(n,e),n}(q$1);!function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}t(n,e);}(F),function(e){e.BASE="base",e.GROUP="group",e.OPEN="open";}(ne||(ne={})),function(e){e.OPERATOR="operator",e.NONE="none";}(re||(re={})),function(e){e.BASE="base",e.USER="user",e.FILE="file",e.ADMIN="admin";}(ie||(ie={})),function(e){e.ALL="",e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM";}(se$1||(se$1={})),function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM";}(oe$2||(oe$2={})),function(e){e.USERS="users",e.CHANNEL="channel";}(ae||(ae={})),function(e){e.ALL="all",e.NONE="none",e.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel";}(ue$2||(ue$2={})),function(e){e.DEFAULT="default",e.SUPPRESS="suppress";}(ce$2||(ce$2={})),function(e){e.PENDING="pending",e.SCHEDULED="scheduled",e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled";}(le$2||(le$2={}));var We$2=function(e){switch(e){case ne.GROUP:return qe$2;case ne.OPEN:return xe$1;default:return null}},Xe$2=function(e){switch(e){case ne.GROUP:return "".concat(je$2,"/group_channels");case ne.OPEN:return "".concat(je$2,"/open_channels");default:return null}},Ye$2=function(e,t,n){var r,i;switch(e){case ae.CHANNEL:return !0;case ae.USERS:if(t)try{for(var o=s(t),a=o.next();!a.done;a=o.next()){if(a.value===n)return !0}}catch(e){r={error:e};}finally{try{a&&!a.done&&(i=o.return)&&i.call(o);}finally{if(r)throw r.error}}}return !1},Je$2=function(e,t,n){var r=Ye$2(e.mentionType,e.mentionedUserIds,n),i=Ye$2(t.mentionType,t.mentionedUserIds,n);return !r&&i?1:r&&!i?-1:0},Ze$2=function(e){function n(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.metadata;return (n=e.call(this)||this).method=d$1.POST,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:s,include_ts:!0},n}return t(n,e),n}(q$1),$e$2=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metaData=null!=n?n:{},r}return t(n,e),n}(F),et$2=function(e){function n(t){var n=t.userId,r=t.metadata,i=t.upsert,s=e.call(this)||this;return s.method=d$1.PUT,s.path="".concat(Ue$2,"/").concat(n,"/metadata"),s.params={metadata:r,upsert:i},s}return t(n,e),n}(q$1),tt$2=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}return t(n,e),n}(F),nt$2=function(e){function n(t){var n=t.userId,r=t.metadataKey,i=e.call(this)||this;return i.method=d$1.DELETE,i.path="".concat(Ue$2,"/").concat(n,"/metadata/").concat(r),i}return t(n,e),n}(q$1);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e);}(F);var rt$2=function(e){function n(t){var n=t.userId,r=e.call(this)||this;return r.method=d$1.DELETE,r.path="".concat(Ue$2,"/").concat(n,"/metadata"),r}return t(n,e),n}(q$1);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e);}(F);var it$2,st$2=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},ot$2=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},at$2=function(e){return {do:function(t){e||t();},throw:function(t){if(!e)throw t}}};!function(e){e.ONLINE="online",e.OFFLINE="offline",e.NON_AVAILABLE="nonavailable";}(it$2||(it$2={}));var ut$2,ct$2=function(e){function s(t,n){var r,i,s,u,c,l,d,h,p,f,_,g,v=this;return (v=e.call(this,t)||this).userId=null!==(i=null!==(r=n.guest_id)&&void 0!==r?r:n.user_id)&&void 0!==i?i:"",v.nickname=null!==(u=null!==(s=n.nickname)&&void 0!==s?s:n.name)&&void 0!==u?u:"",v.plainProfileUrl=null!==(l=null!==(c=n.profile_url)&&void 0!==c?c:n.image)&&void 0!==l?l:"",v.requireAuth=null!==(d=n.require_auth_for_profile_image)&&void 0!==d&&d,v.metaData=null!==(h=n.metadata)&&void 0!==h?h:{},v.connectionStatus=it$2.NON_AVAILABLE,m(it$2,n.is_online)?v.connectionStatus=n.is_online:y("boolean",n.is_online)&&(v.connectionStatus=n.is_online?it$2.ONLINE:it$2.OFFLINE),v.isActive=null===(p=n.is_active)||void 0===p||p,v.lastSeenAt=null!==(f=n.last_seen_at)&&void 0!==f?f:null,v.preferredLanguages=n.preferred_languages?a([],o(n.preferred_languages),!1):null,v.friendDiscoveryKey=null!==(_=n.friend_discovery_key)&&void 0!==_?_:null,v.friendName=null!==(g=n.friend_name)&&void 0!==g?g:null,v}return t(s,e),s.payloadify=function(t){return t?U$1(n(n({},e.payloadify.call(this,t)),{user_id:t.userId,nickname:t.nickname,profile_url:t.plainProfileUrl,require_auth_for_profile_image:t.requireAuth,metadata:t.metaData,is_online:t.connectionStatus,is_active:t.isActive,last_seen_at:t.lastSeenAt,preferred_languages:t.preferredLanguages,friend_discovery_key:t.friendDiscoveryKey,friend_name:t.friendName})):null},Object.defineProperty(s.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(Me$2(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),s.prototype.serialize=function(){return st$2(this)},s.prototype._isValidMetaData=function(e){return !Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return y("string",e)}))},s.prototype._applyMetaData=function(e,t){var n=this;void 0===t&&(t=!1),Object.keys(e).forEach((function(r){t?delete n.metaData[r]:n.metaData[r]=e[r];}));},s.prototype.createMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,o,a;return i(this,(function(i){switch(i.label){case 0:return at$2(this._isValidMetaData(e)).throw(p.invalidParameters),t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,s=new He$2({userId:n.userId,metadata:e}),[4,r.send(s)];case 1:return o=i.sent(),a=o.as($e$2).metaData,this._applyMetaData(a),[2,this.metaData]}}))}))},s.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,s,o,a,u;return i(this,(function(i){switch(i.label){case 0:return at$2(this._isValidMetaData(e)).throw(p.invalidParameters),n=St$2.of(this._iid),r=n.sdkState,s=n.requestQueue,o=new et$2({userId:r.userId,metadata:e,upsert:t}),[4,s.send(o)];case 1:return a=i.sent(),u=a.as(tt$2).metadata,this._applyMetaData(u),[2,this.metaData]}}))}))},s.prototype.deleteMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,o;return i(this,(function(i){switch(i.label){case 0:return at$2(y("string",e)).throw(p.invalidParameters),t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,s=new nt$2({userId:n.userId,metadataKey:e}),[4,r.send(s)];case 1:return i.sent(),this._applyMetaData(((o={})[e]=!0,o),!0),[2,this.metaData]}}))}))},s.prototype.deleteAllMetaData=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new rt$2({userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),this.metaData={},[2]}}))}))},s}(Le$2),lt$2=function(e){function n(t){var n=t.userProfile,r=e.call(this)||this;return r.userProfile=n,r}return t(n,e),n}(L),dt$2=function(){function e(e,t){var n,r,i,s,o,a,u,c,l,d,h,p,f,_;this._iid=e,this.appInfo=new ke$1(t),this.user=new ct$2(e,t),this.connectedAt=1e3*(null!==(n=t.login_ts)&&void 0!==n?n:0),this.firstConnectedAt=0,this.pingInterval=null!==(r=t.ping_interval)&&void 0!==r?r:15e3,this.pongTimeout=null!==(i=t.pong_timeout)&&void 0!==i?i:5e3,this.reconnectInterval=null!==(o=null===(s=t.reconnect)||void 0===s?void 0:s.interval)&&void 0!==o?o:3e3,this.reconnectMaxInterval=null!==(u=null===(a=t.reconnect)||void 0===a?void 0:a.max_interval)&&void 0!==u?u:6e4,this.reconnectRetryCount=null!==(l=null===(c=t.reconnect)||void 0===c?void 0:c.retry_cnt)&&void 0!==l?l:5,this.reconnectIntervalMultiple=null!==(h=null===(d=t.reconnect)||void 0===d?void 0:d.mul)&&void 0!==h?h:2,this.maxUnreadCountOnSuperGroup=null!==(p=t.max_unread_cnt_on_super_group)&&void 0!==p?p:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(f=t.concurrent_call_limit)&&void 0!==f?f:5,this.backOffDelay=null!==(_=t.back_off_delay)&&void 0!==_?_:100;}return e.payloadify=function(e){return n(n({},ct$2.payloadify(e.user)),{emoji_hash:e.appInfo.emojiHash,file_upload_size_limit:e.appInfo.uploadSizeLimit,application_attributes:e.appInfo.applicationAttributes,premium_feature_list:e.appInfo.premiumFeatureList,login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},e.prototype.apply=function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=St$2.of(this._iid);r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}},r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new lt$2({userProfile:this}));},e}(),ht$2=function(e){function r(t,n,r){var i,s=this;return (s=e.call(this,t,n,r)||this).error=null,s.userProfile=new dt$2(t,r),s.key=r.key,s.ekey=null!==(i=r.ekey)&&void 0!==i?i:"",s.error=r.error?new p(r):null,s}return t(r,e),r.asError=function(e){return new r(null,"LOGI",n({user_id:null,error:!0},e))},r.prototype.applyTo=function(e){if(this.error)throw this.error;var t=St$2.of(e);if(!t)throw p.lostInstance;t.sessionManager.auth.sessionKey=this.key,Me$2(e,this.ekey),this.userProfile.apply();},r}(B$1),pt$2=function(e){function n(t){var n=e.call(this)||this;return n.enabled=t,n}return t(n,e),n}(L),ft$2=function(e){function n(t,n){var r=n.sdkState,i=n.connectionHandlers,s=n.sessionManager,o=n.websocketClient,a=n.dispatcher,u=n.logger,c=n.entryState,l=void 0===c?new Re$2:c,d=e.call(this)||this;return d._currentState=null,d._loginTimer=null,d._connectingAt=0,d._connectionRequestQueue=[],d._iid=t,d.sdkState=r,d.connectionHandlers=i,d._sessionManager=s,d._websocketClient=o,d._dispatcher=a,d._logger=u,d._currentState=l,d._websocketClient.on("message",(function(e){if("LOGI"===e.code){d._loginTimer&&(clearTimeout(d._loginTimer),d._loginTimer=null);var t=e.as(ht$2);if(t.error)t.error.isSessionKeyExpiredError&&d._dispatcher.dispatch(new G$1),d._connectionRequestQueue.forEach((function(e){return e.reject(t.error)})),d._statLogConnection(t.error);else {t.applyTo(d._iid),d._connectionRequestQueue.forEach((function(e){return e.resolve()}));var n=t.userProfile;d._enableStatLog(n.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),d._statLogConnection(null);}d._connectionRequestQueue=[];}})).on("close",(function(){d._connectionRequestQueue.length>0&&(d._connectionRequestQueue.forEach((function(e){return e.reject(p.networkError)})),d._connectionRequestQueue=[],d._statLogConnection(p.networkError));})),d}return t(n,e),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),n.prototype.changeState=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._currentState=e,this._dispatcher.dispatch(new de$2({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)];case 1:return t.sent(),[2]}}))}))},n.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,i=t.userId,s=t.extensions,o=this._sessionManager.auth,a=s.sb_syncmanager?"s".concat(s.sb_syncmanager):"",u=s.sb_uikit?"u".concat(s.sb_uikit):"",c="JS/c".concat(l$1.SDK_VERSION,"/").concat(a,"/").concat(u);return "".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(l$1.OS_VERSION),"&sv=").concat(encodeURIComponent(l$1.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(o.hasSession?"&key=".concat(encodeURIComponent(o.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(c,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=1")},n.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new pt$2(e));},n.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new Q$1(new K$1({type:P.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})));},n.prototype.connect=function(e){return void 0===e&&(e=""),r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){return t=this._url(e),n=new ee$1,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((function(){r._loginTimer=null,r._dispatcher.dispatch(ht$2.asError(p.loginTimeout));}),this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]}))}))},n.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(ht$2.asError(p.connectionRenew));},n.prototype.disconnect=function(){this._websocketClient.disconnect();},n.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect();},n}(M),_t$2=function(){function e(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,o=t.dispatcher,a=t.logger,u=t.disableAutoReconnect,c=void 0!==u&&u,l=this;this._context=null,this._logger=a,this._context=new ft$2(e,{sdkState:n,connectionHandlers:r,sessionManager:i,websocketClient:s,dispatcher:o,logger:a}),c||s.on("close",(function(){"foreground"===n.appState&&setTimeout((function(){l._logger.debug("try reconnect by websocket connection closed"),l.reconnect();}),100);}));}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._context.currentState.type===J$1.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===J$1.CONNECTING||e.type===J$1.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.connect=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._context.currentState.onConnect(this._context,e)];case 1:return t.sent(),[2]}}))}))},e.prototype.reconnect=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}}))}))},e.prototype.resetAndReconnect=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}}))}))},e.prototype.background=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}}))}))},e.prototype.disconnect=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._context.currentState.onDisconnect(this._context,{error:e,autoReconnect:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}}))}))},e}(),gt$2=function(e){function n(t){var n=t.deviceId,r=t.statLogs,i=e.call(this)||this;return i.method=d$1.POST,i.path="".concat(Be$2),i.params={device_id:n,log_entries:r.map((function(e){return K$1.payloadify(e)}))},i}return t(n,e),n}(q$1);!function(e){e[e.PENDING=0]="PENDING",e[e.ENABLED=1]="ENABLED",e[e.DISABLED=2]="DISABLED";}(ut$2||(ut$2={}));var yt$2,mt$2=function(){function e(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,i=e.baseLimit,s=void 0===i?100:i,o=e.maxLimit,a=void 0===o?1e3:o,u=e.minLimit,c=void 0===u?10:u;this.queue=[],this.enabledstate=ut$2.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=R(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=s,this.limit=s,this.maxLimit=a,this.minLimit=c;}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.enabledstate===ut$2.ENABLED},enumerable:!1,configurable:!0}),e.prototype._save=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map((function(e){return K$1.payloadify(e)})),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return [2]}}))}))},e.prototype._flush=function(){return r(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:if(!this.isEnabled)return [3,7];if(this.isFlushing)return [3,7];this.isFlushing=!0,n.label=1;case 1:return n.trys.push([1,5,6,7]),(e=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length>0?(t=new gt$2({deviceId:this.deviceId,statLogs:e}),[4,this.requestQueue.send(t)]):[3,4];case 2:return n.sent(),this.queue=this.queue.slice(e.length),[4,this._save()];case 3:n.sent(),n.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return n.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return [2]}}))}))},e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return this.key=e,this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.get(this.key)]:[3,4];case 1:return (t=i.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map((function(e){return new K$1({type:e.stat_type,ts:e.ts,data:e.data})})),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit?(n=Math.min(Math.floor(18e4*Math.random()),100),[4,me$2(n)]):[3,4]):[3,4];case 2:return i.sent(),[4,this._flush()];case 3:i.sent(),i.label=4;case 4:return this.dispatcher.on((function(e){if(e instanceof Q$1){var t=e.statLog;r.put(t);}else e instanceof pt$2&&(r.enabledstate=e.enabled?ut$2.ENABLED:ut$2.DISABLED,r.isEnabled?r.queue.length>=r.limit&&r._flush():r.clear());})),[2]}}))}))},e.prototype.put=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.enabledstate===ut$2.DISABLED?[3,3]:(this.queue.push(e),[4,this._save()]);case 1:return t.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:t.sent(),t.label=3;case 3:return [2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}}))}))},e}();!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.DEBUG=2]="DEBUG",e[e.INFO=3]="INFO",e[e.WARN=4]="WARN",e[e.ERROR=5]="ERROR";}(yt$2||(yt$2={}));var vt$2,Et$2=function(){function e(){this.level=yt$2.WARN;}return e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yt$2.VERBOSE&&console.log.apply(console,a(["[verbose]"],o(e),!1));},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yt$2.DEBUG&&console.log.apply(console,a(["[debug]"],o(e),!1));},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yt$2.INFO&&console.log.apply(console,a(["[info]"],o(e),!1));},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yt$2.WARN&&console.warn.apply(console,a(["[warn]"],o(e),!1));},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=yt$2.ERROR&&console.error.apply(console,a(["[error]"],o(e),!1));},e}(),It$2={},St$2=function(){function e(e,t){var n,r,i,s,o,a,u;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!It$2[e]){It$2[e]=this;var c=null!==(n=t.options)&&void 0!==n?n:new b,d=this.sdkState={appId:t.appId,appVersion:null!==(r=t.appVersion)&&void 0!==r?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!==(i=t.apiHost)&&void 0!==i?i:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!==(s=t.websocketHost)&&void 0!==s?s:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new ve$2,responseTimeout:c.websocketResponseTimeout}};this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0};var h=this.logger=new Et$2;this.logger.level=null!==(o=t.logLevel)&&void 0!==o?o:yt$2.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new O({encryption:t.encryption,store:t.store,localCacheEnabled:null!==(a=t.localCacheEnabled)&&void 0!==a&&a}),this.debugMode=null!==(u=t.debugMode)&&void 0!==u&&u,this.maxSuperGroupChannelUnreadCount=l$1.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=c.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=c.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=c.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null;var p=this.dispatcher=new k,f=new w;this.requestQueue=new he$2(e,{auth:f,sdkState:d,dispatcher:p,logger:h}),this.sessionManager=new Te$1({auth:f,sdkState:d,dispatcher:p,requestQueue:this.requestQueue,logger:h}),this.connectionManager=new _t$2(e,{sdkState:d,connectionHandlers:this.connectionHandlers,dispatcher:p,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,logger:h}),this.statLogCollector=new mt$2({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:p});}return It$2[e]}return e.of=function(e){if(It$2[e])return It$2[e];throw p.lostInstance},e}(),Tt$2=function(){function e(){}return e.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,o=t.logger;t.onlineDetector;var a=t.cacheContext,u=void 0===a?null:a;this._iid=e,this._cacheContext=u,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=s,this._logger=o;},e}(),bt$2=function(e){function n(t){var n=e.call(this)||this;if(n.method=d$1.POST,n.path="".concat(Pe$2),n.params=U$1({file:t.file,channel_url:t.channelUrl}),t.thumbnailSizes)for(var r=0;r<t.thumbnailSizes.length;r++){var i=t.thumbnailSizes[r],s=i.maxWidth,o=i.maxHeight;n.params["thumbnail".concat(r+1)]="".concat(s,",").concat(o);}return n.requestId=t.requestId,n}return t(n,e),n}(q$1),Nt$2=function(e){function n(t,n){var r,i,s,o=this;return (o=e.call(this,t,n)||this).url=n.url,o.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,o.thumbnailSizes=null!==(i=n.thumbnails)&&void 0!==i?i:[],o.requireAuth=null!==(s=n.require_auth)&&void 0!==s&&s,o}return t(n,e),n}(F),At$2=function(e){function r(t,n){var r,i,s,o=this;return (o=e.call(this,t)||this).replyCount=0,o.mostRepliedUsers=null,o.lastRepliedAt=0,o.updatedAt=0,o.replyCount=null!==(r=n.reply_count)&&void 0!==r?r:0,o.mostRepliedUsers=n.hasOwnProperty("most_replies")&&E("object",n.most_replies)?n.most_replies.map((function(e){return new ct$2(o._iid,e)})):[],o.lastRepliedAt=null!==(i=n.last_replied_at)&&void 0!==i?i:0,o.updatedAt=null!==(s=n.updated_at)&&void 0!==s?s:0,o}return t(r,e),r.payloadify=function(t){return t?U$1(n(n({},e.payloadify.call(this,t)),{reply_count:t.replyCount,most_replies:Array.isArray(t.mostRepliedUsers)?t.mostRepliedUsers.map((function(e){return ct$2.payloadify(e)})):[],last_replied_at:t.lastRepliedAt,updated_at:t.updatedAt})):null},r}(Le$2);!function(e){e.ADD="add",e.DELETE="delete";}(vt$2||(vt$2={}));var Ct$2,Ot$1,wt$2=function(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=y("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,s=e.updated_at;t&&y("string",n)&&y("string",r)&&m(vt$2,r)&&y("string",i)&&i&&y("number",s)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=s);},Rt$2=function(){function e(e){var t,n,r,i=e.key,u=null!==(r=a([],o(e.user_ids),!1))&&void 0!==r?r:[],c=e.updated_at;y("string",i)&&i&&E("string",u)&&u.length>0&&y("number",c)&&(this.key=i,this.userIds=u,this.updatedAt=c);var l={};try{for(var d=s(this.userIds),h=d.next();!h.done;h=d.next()){l[h.value]=this.updatedAt;}}catch(e){t={error:e};}finally{try{h&&!h.done&&(n=d.return)&&n.call(d);}finally{if(t)throw t.error}}this._version=l;}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),e.payloadify=function(e){return e?U$1({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},e.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case vt$2.ADD:t<0&&this.userIds.push(e.userId);break;case vt$2.DELETE:t>=0&&this.userIds.splice(t,1);}this._version[e.userId]=e.updatedAt;}this.updatedAt=Math.max(this.updatedAt,e.updatedAt);}},e}(),Dt$2=function(){function e(e){this.key=e.key,this.value=E("string",e.value)?a([],o(e.value),!1):[];}return e.payloadify=function(e){var t;return e?U$1({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null},e}(),Mt$2=function(){function e(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt);}return e.payloadify=function(e){var t,n;return e?U$1({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}):null},e}(),kt$2=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new Mt$2(e["og:image"]));}return e.payloadify=function(e){return e?U$1({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Mt$2.payloadify(e.defaultImage):null}):null},e}(),Lt$1=function(){function e(e){var t,n;this.name=null,this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1;}return e.payloadify=function(e){return e?U$1({name:e.name,volume:e.volume}):null},e}();!function(e){e.PENDING="pending",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled";}(Ct$2||(Ct$2={})),function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed";}(Ot$1||(Ot$1={}));var Ut$2,Pt$2=function(e){switch(e){case ie.BASE:return "";case ie.USER:return "MESG";case ie.FILE:return "FILE";case ie.ADMIN:return "ADMM"}},qt$2=function(e){function r(t,n){var r,i,s,o,a,u,c,l,d,h,p,f,_,g=this;(g=e.call(this,t)||this).channelUrl=null,g.channelType=ne.BASE,g.messageId=0,g.parentMessageId=null,g.parentMessage=null,g.silent=!1,g.isOperatorMessage=!1,g.messageType=ie.BASE,g.data=null,g.customType=null,g.mentionType=null,g.mentionedUsers=[],g.mentionedUserIds=[],g.mentionedMessageTemplate=null,g.threadInfo=null,g.reactions=[],g.metaArrays=[],g.ogMetaData=null,g.appleCriticalAlertOptions=null,g.createdAt=0,g.updatedAt=0,g.scheduledInfo=null,g._scheduledStatus=null,g.messageId=null!==(i=null!==(r=n.msg_id)&&void 0!==r?r:n.message_id)&&void 0!==i?i:0,g.channelUrl=n.channel_url,g.channelType=m(ne,n.channel_type)?n.channel_type:ne.GROUP,n.channel&&(n.channel.channel_url&&(g.channelUrl=n.channel.channel_url),n.channel.channel_type&&(g.channelType=n.channel.channel_type)),g.parentMessageId=null!==(s="string"==typeof n.parent_message_id?parseInt(n.parent_message_id):n.parent_message_id)&&void 0!==s?s:0,g.data=null!==(o=n.data)&&void 0!==o?o:"",g.customType=null!==(a=n.custom_type)&&void 0!==a?a:"",g.mentionType=m(ae,n.mention_type)?n.mention_type:null;var y=n.mentioned_users;g.mentionedUsers=y?y.map((function(e){return new ct$2(g._iid,e)})):null;var v=n.mentioned_user_ids;g.mentionedUserIds=null!=v?v:null,g.mentionedMessageTemplate=null!==(u=n.mentioned_message_template)&&void 0!==u?u:"",g.threadInfo=n.thread_info?new At$2(g._iid,n.thread_info):null,g.reactions=n.reactions?n.reactions.map((function(e){return new Rt$2(e)})):[];for(var E=null!==(c=n.metaarray)&&void 0!==c?c:{},I=null!==(l=n.metaarray_key_order)&&void 0!==l?l:Object.keys(E).sort((function(e,t){return e.localeCompare(t)})),S=0;S<I.length;S++){var T=I[S];g.metaArrays.push(new Dt$2({key:T,value:E[T]||[]}));}return n.sorted_metaarray&&(g.metaArrays=n.sorted_metaarray.map((function(e){return new Dt$2(e)}))),g.ogMetaData=n.og_tag?new kt$2(n.og_tag):null,g.silent=null!==(d=n.silent)&&void 0!==d&&d,g.isOperatorMessage=null!==(h=n.is_op_msg)&&void 0!==h&&h,g.appleCriticalAlertOptions=n.apple_critical_alert_options?new Lt$1(n.apple_critical_alert_options):null,g.createdAt=null!==(f=null!==(p=n.created_at)&&void 0!==p?p:n.ts)&&void 0!==f?f:0,g.updatedAt=null!==(_=n.updated_at)&&void 0!==_?_:0,"number"==typeof n.scheduled_message_id&&"number"==typeof n.scheduled_at&&n.scheduled_status&&(g.scheduledInfo={scheduledMessageId:n.scheduled_message_id,scheduledAt:n.scheduled_at},g._scheduledStatus=n.scheduled_status),g}return t(r,e),r.payloadify=function(t){var r,i,s,o;return t?U$1(n(n({},e.payloadify.call(this,t)),{channel_url:t.channelUrl,channel_type:t.channelType,message_id:t.messageId,type:Pt$2(t.messageType),parent_message_id:t.parentMessageId,data:t.data,custom_type:t.customType,mention_type:t.mentionType,mentioned_user_ids:t.mentionedUserIds,mentioned_users:null===(r=t.mentionedUsers)||void 0===r?void 0:r.map((function(e){return ct$2.payloadify(e)})),mentioned_message_template:t.mentionedMessageTemplate,thread_info:t.threadInfo?At$2.payloadify(t.threadInfo):null,reactions:t.reactions.map((function(e){return Rt$2.payloadify(e)})),sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return Dt$2.payloadify(e)})),og_tag:kt$2.payloadify(t.ogMetaData),silent:t.silent,is_op_msg:t.isOperatorMessage,apple_critical_alert_options:Lt$1.payloadify(t.appleCriticalAlertOptions),created_at:t.createdAt,updated_at:t.updatedAt,scheduled_message_id:null===(s=t.scheduledInfo)||void 0===s?void 0:s.scheduledMessageId,scheduled_at:null===(o=t.scheduledInfo)||void 0===o?void 0:o.scheduledAt,scheduled_status:t._scheduledStatus})):null},r.prototype.isIdentical=function(e){return this.messageId===e.messageId},r.prototype.isEqual=function(e){return g(this,e)},r.prototype.isUserMessage=function(){return this.messageType===ie.USER},r.prototype.isFileMessage=function(){return this.messageType===ie.FILE},r.prototype.isAdminMessage=function(){return this.messageType===ie.ADMIN},r.prototype.serialize=function(){return st$2(this)},r.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},r.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},r.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new Rt$2(Rt$2.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})));}},r.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return !1},r}(Le$2),Ft$1=function(e){function r(t,n){var r=e.call(this,t,n)||this;return r.role=null,r.isBlockedByMe=!1,r.role=m(re,n.role)?n.role:re.NONE,n.hasOwnProperty("is_blocked_by_me")&&(r.isBlockedByMe=n.is_blocked_by_me),r}return t(r,e),r.payloadify=function(t){return t?U$1(n(n({},e.payloadify.call(this,t)),{role:t.role,is_blocked_by_me:t.isBlockedByMe})):null},r}(ct$2),xt$1=function(e){function r(t,n){var r,i,s,o,a=this;if((a=e.call(this,t,n)||this).sender=null,a.reqId="",a.replyToChannel=!1,a.sendingStatus=null,a.errorCode=0,a.sender=n.user?new Ft$1(a._iid,n.user):n.sender_id,a.reqId=null!==(i=null!==(r=n.req_id)&&void 0!==r?r:n.request_id)&&void 0!==i?i:"",a.replyToChannel=null!==(s=n.is_reply_to_channel)&&void 0!==s&&s,n.request_state&&m(le$2,n.request_state)&&(a.sendingStatus=n.request_state),!a.sendingStatus)if(a.messageId>0)a.sendingStatus=le$2.SUCCEEDED;else if(a.scheduledInfo)switch(a._scheduledStatus=n.scheduled_status,n.scheduled_status){case Ot$1.SENT:case Ot$1.IN_QUEUE:a.sendingStatus=le$2.SUCCEEDED;break;case Ot$1.PENDING:a.sendingStatus=le$2.SCHEDULED;break;case Ot$1.FAILED:case Ot$1.REMOVED:a.sendingStatus=le$2.FAILED;break;case Ot$1.CANCELED:a.sendingStatus=le$2.CANCELED;}else a.sendingStatus=le$2.PENDING;return a.errorCode=null!==(o=n.error_code)&&void 0!==o?o:0,a}return t(r,e),r.payloadify=function(t){return t?U$1(n(n({},e.payloadify.call(this,t)),{user:Ft$1.payloadify(t.sender),req_id:t.reqId,is_reply_to_channel:t.replyToChannel,request_state:t.sendingStatus,error_code:t.errorCode})):null},Object.defineProperty(r.prototype,"isResendable",{get:function(){return this.sendingStatus===le$2.FAILED&&((e=this.errorCode)>0&&f.indexOf(e)>=0);var e;},enumerable:!1,configurable:!0}),r.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},r}(qt$2),Gt$1=function(){function e(e){var t,n;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(t=e.real_width)&&void 0!==t?t:e.width,this.realHeight=null!==(n=e.real_height)&&void 0!==n?n:e.height;}return e.payloadify=function(e){return e?U$1({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(e.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),e}(),Qt$1={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:se$1.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},jt$1=function(e){return y("number",e.prevResultSize)&&y("number",e.nextResultSize)&&y("boolean",e.isInclusive)&&y("boolean",e.reverse)&&y("string",e.messageTypeFilter)&&m(se$1,e.messageTypeFilter)&&E("string",e.customTypesFilter,!0)&&E("string",e.senderUserIdsFilter,!0)&&y("boolean",e.includeMetaArray)&&y("boolean",e.includeReactions)&&y("boolean",e.includeParentMessageInfo)},Kt$1=function(e){function s(t,r){var i,s,o,a,u=this;if((u=e.call(this,t,r)||this).message=null,u.translations={},u.message=null!==(i=r.message)&&void 0!==i?i:"",u.messageType=ie.ADMIN,u.translations=null!==(s=r.translations)&&void 0!==s?s:{},r.parent_message_info){var c=r.parent_message_info,l=n(n({},c),{message_id:u.parentMessageId,channel_url:u.channelUrl,channel_type:u.channelType,file:c.file,url:null===(o=c.file)||void 0===o?void 0:o.url,require_auth:null===(a=c.file)||void 0===a?void 0:a.require_auth});u.parentMessage=Ht$1(t,l);}return u}return t(s,e),s.payloadify=function(t){return t?U$1(n(n({},e.payloadify.call(this,t)),{message:t.message,translations:t.translations,parent_message_info:Bt$1(t.parentMessage)})):null},s.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return t=n(n({},Qt$1),t),at$2(this.messageId>0&&y("number",e)&&jt$1(t)).throw(p.invalidParameters),[4,En$2.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return [2,r.sent()]}}))}))},s}(qt$2),zt$1=function(){function e(e){var t,n;this.type=null,this.vendor=null,this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.hasOwnProperty("detail")&&y("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail);}return e.payloadify=function(e){return e?U$1({type:e.type,vendor:e.vendor,detail:e.detail}):null},e}(),Vt$1=function(e){function o(t,r){var i,o,a,u,c,l,d,h=this;if((h=e.call(this,t,r)||this).message="",h.messageParams=null,h.translations={},h.translationTargetLanguages=[],h.messageSurvivalSeconds=-1,h.plugins=[],h.message=r.message,h.messageType=ie.USER,h.translations=null!==(a=r.translations)&&void 0!==a?a:{},h.translationTargetLanguages=null!==(u=r.target_langs)&&void 0!==u?u:[],h.translations==={}&&h.translationTargetLanguages.length>0)try{for(var p=s(h.translationTargetLanguages),f=p.next();!f.done;f=p.next()){var _=f.value;h.translations[_]="";}}catch(e){i={error:e};}finally{try{f&&!f.done&&(o=p.return)&&o.call(p);}finally{if(i)throw i.error}}if(h.messageSurvivalSeconds=null!==(c=r.message_survival_seconds)&&void 0!==c?c:-1,h.plugins=r.plugins?r.plugins.map((function(e){return new zt$1(e)})):[],r.parent_message_info){var g=r.parent_message_info,y=n(n({},g),{created_at:g.ts,message_id:h.parentMessageId,channel_url:h.channelUrl,channel_type:h.channelType,file:g.file,url:null===(l=g.file)||void 0===l?void 0:l.url,require_auth:null===(d=g.file)||void 0===d?void 0:d.require_auth});h.parentMessage=Ht$1(t,U$1(y));}return h}return t(o,e),o.payloadify=function(t){return t?U$1(n(n({},e.payloadify.call(this,t)),{message:t.message,translations:t.translations,message_survival_seconds:t.messageSurvivalSeconds,plugins:t.plugins.map((function(e){return zt$1.payloadify(e)})),parent_message_info:Bt$1(t.parentMessage)})):null},o.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return t=n(n({},Qt$1),t),at$2(this.messageId>0&&y("number",e)&&jt$1(t)).throw(p.invalidParameters),[4,En$2.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return [2,r.sent()]}}))}))},o}(xt$1),Bt$1=function(e){if(e)switch(e.messageType){case ie.USER:return Vt$1.payloadify(e);case ie.FILE:return Wt$1.payloadify(e);case ie.ADMIN:return Kt$1.payloadify(e)}return null},Ht$1=function(e,t){switch(t.type){case"MESG":return new Vt$1(e,t);case"FILE":return new Wt$1(e,t);case"ADMM":case"BRDM":return new Kt$1(e,t)}return null},Wt$1=function(e){function s(t,r){var i,s,o,a,u,c,l,d,h,p,f,_,g,y,m,v=this;(v=e.call(this,t,r)||this).messageParams=null,v.plainUrl="",v.requireAuth=!1,v.name=null,v.size=0,v.type=null,v.thumbnails=[],v.messageSurvivalSeconds=-1,v.messageType=ie.FILE;var E=null!==(i=r.file)&&void 0!==i?i:null;if(v.plainUrl=(null!==(o=null!==(s=null==E?void 0:E.url)&&void 0!==s?s:r.url)&&void 0!==o?o:"").split("?auth=")[0],v.name=null!==(u=null!==(a=null==E?void 0:E.name)&&void 0!==a?a:r.name)&&void 0!==u?u:"File",v.size=null!==(l=null!==(c=null==E?void 0:E.size)&&void 0!==c?c:r.size)&&void 0!==l?l:0,v.data=null!==(h=null!==(d=null==E?void 0:E.data)&&void 0!==d?d:r.custom)&&void 0!==h?h:"",v.type=E?null!==(p=E.type)&&void 0!==p?p:"":null!==(f=r.type)&&void 0!==f?f:"",v.requireAuth=null!==(_=r.require_auth)&&void 0!==_&&_,v.thumbnails=r.thumbnails?r.thumbnails.map((function(e){return new Gt$1(n(n({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(v.requireAuth?"?auth=".concat(Me$2(v._iid)):"")}))})):[],v.messageSurvivalSeconds=null!==(g=r.message_survival_seconds)&&void 0!==g?g:-1,r.parent_message_info){var I=r.parent_message_info,S=n(n({},I),{message_id:v.parentMessageId,channel_url:v.channelUrl,channel_type:v.channelType,file:I.file,url:null===(y=I.file)||void 0===y?void 0:y.url,require_auth:null===(m=I.file)||void 0===m?void 0:m.require_auth});v.parentMessage=Ht$1(t,S);}return v}return t(s,e),s.payloadify=function(t){return t?U$1(n(n({},e.payloadify.call(this,t)),{url:t.plainUrl,require_auth:t.requireAuth,file:{name:t.name,size:t.size,type:t.type,data:t.data},thumbnails:t.thumbnails.map((function(e){return {url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:t.messageSurvivalSeconds,parent_message_info:Bt$1(t.parentMessage)})):null},Object.defineProperty(s.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(Me$2(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),s.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return t=n(n({},Qt$1),t),at$2(this.messageId>0&&y("number",e)&&jt$1(t)).throw(p.invalidParameters),[4,En$2.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return [2,r.sent()]}}))}))},s}(xt$1),Xt$1=function(e){function n(t){var n,r,i,s=[];return t.mentionType===ae.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"FILE",ackRequired:!0,payload:U$1({channel_url:t.channelUrl,url:t.url,name:null!==(n=t.fileName)&&void 0!==n?n:"",type:null!==(r=t.mimeType)&&void 0!==r?r:"",size:null!==(i=t.fileSize)&&void 0!==i?i:0,custom:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes,require_auth:t.requireAuth,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:s,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==ce$2.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId})})||this}return t(n,e),n}(H$2),Yt$1=function(e){function n(t){var n,r=this;r=e.call(this)||this;var i=[];return t.mentionType===ae.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId})))),r.method=d$1.POST,r.path="".concat(We$2(t.channelType),"/").concat(encodeURIComponent(t.channelUrl),"/messages"),r.params=U$1({message_type:ie.FILE,user_id:t.userId,url:t.fileUrl,mention_type:t.mentionType,mentioned_user_ids:i,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,data:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes.map((function(e){return Gt$1.payloadify(e)})),require_auth:t.requireAuth,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return Dt$2.payloadify(e)})),push_option:t.pushNotificationDeliveryOption,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,apple_critical_alert_options:Lt$1.payloadify(t.appleCriticalAlertOptions),reply_to_channel:t.isReplyToChannel,req_id:t.reqId}),r}return t(n,e),n}(q$1),Jt$1=function(e){function n(t,n,r){var i,s,o,a=this;(a=e.call(this,t,"FILE",r)||this).message=new Wt$1(t,r);var u=St$2.of(t).sdkState;return a.isMentioned=Ye$2(a.message.mentionType,null!==(i=a.message.mentionedUserIds)&&void 0!==i?i:null===(s=a.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),u.userId),a.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,a}return t(n,e),n}(B$1),Zt$1=function(e){function n(t,n){var r,i,s=this;(s=e.call(this,t,n)||this).message=new Wt$1(t,n);var o=St$2.of(t).sdkState;return s.isMentioned=Ye$2(s.message.mentionType,null!==(r=s.message.mentionedUserIds)&&void 0!==r?r:s.message.mentionedUsers.map((function(e){return e.userId})),o.userId),s.forceUpdateLastMessage=null!==(i=n.force_update_last_message)&&void 0!==i&&i,s}return t(n,e),n}(F);!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED";}(Ut$2||(Ut$2={}));var $t$1,en$2=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,o=t.cacheContext,a=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=o,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof de$2&&(a._connectionState=e.stateType);})),this._onlineDetector=s;}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===J$1.CONNECTED||this._connectionState===J$1.CONNECTING||this._connectionState===J$1.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return this._shouldSendThroughWebSocket?(r=new Xt$1(n(n({channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,requireAuth:t.requireAuth},t.params),{reqId:t.requestId})),[4,this._requestQueue.send(r)]):[3,2];case 1:return s=i.sent(),[2,s.as(Jt$1).message];case 2:return r=new Yt$1(n(n({channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,userId:this._sdkState.userId,requireAuth:t.requireAuth},t.params),{reqId:t.requestId})),[4,this._requestQueue.send(r)];case 3:return s=i.sent(),[2,s.as(Zt$1).message]}}))}))},e.prototype._resolveMessageQueue=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,a,c,l,d,h,f,_,g;return i(this,(function(i){switch(i.label){case 0:if(!(t=this._queueMap.get(e.url)))return [3,21];if(t.isResolving)return [3,20];t.isResolving=!0,n=[],r=!0,i.label=1;case 1:i.trys.push([1,15,16,17]),o=s(t.messageQueue),a=o.next(),i.label=2;case 2:if(a.done)return [3,14];switch(c=a.value,c.state){case Ut$2.PENDING:case Ut$2.UPLOADING:return [3,3];case Ut$2.UPLOADED:return [3,4];case Ut$2.FAILED:return [3,12]}return [3,13];case 3:return r=!1,n.push(c),[3,13];case 4:if(!r)return [3,10];i.label=5;case 5:return i.trys.push([5,8,,9]),c.state=Ut$2.SENDING,[4,this._sendFileMessage(e,c)];case 6:return l=i.sent(),c.deferred.resolve(l),[4,me$2(100)];case 7:return i.sent(),[3,9];case 8:return d=i.sent(),c.deferred.reject(d),[3,9];case 9:return [3,11];case 10:n.push(c),i.label=11;case 11:return [3,13];case 12:return c.deferred.reject(c.error.code===u.REQUEST_CANCELED?p.fileUploadCanceled:c.error),[3,13];case 13:return a=o.next(),[3,2];case 14:return [3,17];case 15:return h=i.sent(),_={error:h},[3,17];case 16:try{a&&!a.done&&(g=o.return)&&g.call(o);}finally{if(_)throw _.error}return [7];case 17:return f=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,f?[4,this._resolveMessageQueue(e)]:[3,19];case 18:i.sent(),i.label=19;case 19:return [3,21];case 20:t.isResolveRequestPending=!0,i.label=21;case 21:return [2]}}))}))},e.prototype._uploadNextPendingItem=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,o,a,u,c,l,d,h,f,_,g;return i(this,(function(i){switch(i.label){case 0:return t=this._queueMap.get(e.url),(n=t.messageQueue.find((function(e){return e.state===Ut$2.PENDING})))?S(n.params.file)?t.uploadQueue.length<6?(n.state=Ut$2.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!i.sent())return [3,8];i.label=2;case 2:return i.trys.push([2,4,5,7]),r=new bt$2({file:n.params.file,channelUrl:e.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return s=i.sent(),o=s.as(Nt$2),a=o.url,u=o.fileSize,c=void 0===u?n.params.fileSize:u,l=o.thumbnailSizes,d=void 0===l?n.params.thumbnailSizes:l,h=o.requireAuth,f=void 0!==h&&h,n.params.fileUrl=a,n.params.fileSize=c,n.params.thumbnailSizes=d,n.params.requireAuth=f,n.requireAuth=f,n.state=Ut$2.UPLOADED,[3,7];case 4:return _=i.sent(),n.state=Ut$2.FAILED,n.error=_,[3,7];case 5:return (g=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(g,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 6:return i.sent(),[7];case 7:return [3,10];case 8:return n.state=Ut$2.FAILED,n.error=p.connectionRequired,(g=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(g,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 9:i.sent(),i.label=10;case 10:return [3,13];case 11:return n.params.thumbnailSizes=[],n.state=Ut$2.UPLOADED,[4,this._resolveMessageQueue(e)];case 12:i.sent(),i.label=13;case 13:return [2]}}))}))},e.prototype.request=function(e,t,n){var s,o,a;return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){return r=new ee$1,S(n.file)&&(n.fileName=null!==(s=n.fileName)&&void 0!==s?s:n.file.name,n.mimeType=null!==(o=n.mimeType)&&void 0!==o?o:n.file.type,n.fileSize=null!==(a=n.fileSize)&&void 0!==a?a:n.file.size),this._queueMap.has(e.url)||this._queueMap.set(e.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(e.url).messageQueue.push({requestId:t,params:n,state:Ut$2.PENDING,deferred:r,requireAuth:n.requireAuth}),this._uploadNextPendingItem(e),[2,r.promise]}))}))},e.prototype.cancel=function(e,t){var n,r;void 0===t&&(t=null);var i=this._queueMap.get(e.url);if(i){var u=t?[i.messageQueue.find((function(e){return e.requestId===t}))]:a([],o(i.messageQueue),!1);try{for(var c=s(u),l=c.next();!l.done;l=c.next()){var d=l.value;if(d)switch(d.state){case Ut$2.PENDING:d.state=Ut$2.FAILED,d.error=p.requestCanceled,this._resolveMessageQueue(e);break;case Ut$2.UPLOADING:this._requestQueue.cancel(d.requestId);}}}catch(e){n={error:e};}finally{try{l&&!l.done&&(r=c.return)&&r.call(c);}finally{if(n)throw n.error}}}},e}(),tn$2={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:se$1.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:ue$2.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},nn$1=function(e){return y("number",e.prevResultSize)&&y("number",e.nextResultSize)&&y("boolean",e.isInclusive)&&y("boolean",e.reverse)&&y("string",e.messageTypeFilter)&&m(se$1,e.messageTypeFilter)&&E("string",e.customTypesFilter,!0)&&E("string",e.senderUserIdsFilter,!0)&&m(ue$2,e.replyType)&&y("boolean",e.includeMetaArray)&&y("boolean",e.includeReactions)&&y("boolean",e.includeParentMessageInfo)&&y("boolean",e.includeThreadInfo)&&y("boolean",e.showSubchannelMessagesOnly)},rn$2={replyType:ue$2.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includePollDetails:!1},sn$2=function(e){return m(ue$2,e.replyType)&&y("boolean",e.includeReactions)&&y("boolean",e.includeMetaArray)&&y("boolean",e.includeParentMessageInfo)&&y("boolean",e.includeThreadInfo)&&y("boolean",e.includePollDetails)};!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",e.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",e.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",e.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",e.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",e.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",e.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",e.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",e.REQUEST_MESSAGE="REQUEST_MESSAGE",e.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",e.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",e.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",e.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",e.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",e.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",e.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",e.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",e.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",e.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";}($t$1||($t$1={}));var on$2,un$2=function(e){function n(t){var n=t.messages,r=t.source,i=e.call(this)||this;return i.messages=n,i.source=r,i}return t(n,e),n}(L),cn$2=function(e){function n(t){var n=t.messageIds,r=t.source,i=e.call(this)||this;return i.messageIds=n,i.source=r,i}return t(n,e),n}(L);(function(e){function n(t){var n=t.reqId,r=t.source,i=e.call(this)||this;return i.reqId=n,i.source=r,i}return t(n,e),n})(L);var dn$2=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,s=t.includeMetaArray,o=t.includeReactions,a=t.includeThreadInfo,u=t.includeParentMessageInfo,c=t.includePollDetails,l=e.call(this)||this;return l.method=d$1.GET,l.path="".concat(We$2(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(i)),l.params={is_sdk:!0,with_sorted_meta_array:s,include_reactions:o,include_thread_info:a,include_parent_message_info:u,include_poll_details:c},l}return t(n,e),n}(q$1),hn$2=function(e){function r(t,r){var i=e.call(this,t,r)||this;return i.message=r?Ht$1(t,n({},r)):null,i}return t(r,e),r}(F),pn$2=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=void 0===i?null:i,o=t.token,a=void 0===o?null:o,u=t.prevResultSize,c=t.nextResultSize,l=t.isInclusive,h=t.reverse,p=t.messageTypeFilter,f=t.customTypesFilter,_=t.senderUserIdsFilter,g=t.replyType,y=t.includeMetaArray,m=t.includeReactions,v=t.parentMessageId,E=t.includeThreadInfo,I=t.includeParentMessageInfo,S=t.showSubchannelMessagesOnly,T=t.includePollDetails,b=e.call(this)||this;return b.method=d$1.GET,b.path="".concat(We$2(n),"/").concat(encodeURIComponent(r),"/messages"),b.params=U$1({is_sdk:!0,prev_limit:u,next_limit:c,include:l,reverse:h,message_ts:s,message_id:a,message_type:null!=p?p:null,custom_types:f,sender_ids:_,include_reply_type:g,with_sorted_meta_array:y,include_reactions:m,parent_message_id:v,include_thread_info:E,include_parent_message_info:I,show_subchannel_message_only:S,include_poll_details:T}),b}return t(n,e),n}(q$1),fn$2=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.messages=n.messages.map((function(e){return Ht$1(t,e)})),r}return t(n,e),n}(F),_n$2=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=t.token,o=t.replyType,a=t.includeMetaArray,u=t.includeReactions,c=t.includeThreadInfo,l=t.includeParentMessageInfo,h=t.includePollDetails,p=e.call(this)||this;return p.method=d$1.GET,p.path="".concat(We$2(n),"/").concat(encodeURIComponent(r),"/messages/changelogs"),p.params={change_ts:i,token:s,with_sorted_meta_array:a,include_reactions:u,include_thread_info:c,include_reply_type:o,include_parent_message_info:l,include_poll_details:h},p}return t(n,e),n}(q$1),gn$2=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.updatedMessages=n.updated.map((function(e){return Ht$1(t,e)})),r.deletedMessagesInfo=n.deleted.map((function(e){return {messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r}return t(n,e),n}(F),yn$2=function(e){function n(t){var n=t.channelUrl,r=t.scheduledMessageId,i=e.call(this)||this;return i.method=d$1.GET,i.path="".concat(qe$2,"/").concat(encodeURIComponent(n),"/scheduled_messages/").concat(encodeURIComponent(r)),i.params={},i}return t(n,e),n}(q$1),mn$2=function(e){function r(t,r){var i=e.call(this,t,r)||this;return i.message=r?Ht$1(t,n({},r)):null,i}return t(r,e),r}(F),vn$2={},En$2=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,o=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._onlineDetector=s,this._cacheContext=o,this.fileMessageQueue=new en$2(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:o}),vn$2[e]=this;}return e.of=function(e){return vn$2[e]},e.prototype.buildMessageFromSerializedData=function(e){var t=ot$2(e);switch(t.messageType){case ie.USER:return new Vt$1(this._iid,Vt$1.payloadify(t));case ie.FILE:return new Wt$1(this._iid,Wt$1.payloadify(t));case ie.ADMIN:return new Kt$1(this._iid,Kt$1.payloadify(t))}return null},e.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return U$1({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations)})},e.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return U$1({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map((function(e){return {maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth})},e.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return n(n({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return n(n({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildSenderFromSerializedData=function(e){var t=ot$2(e);return new Ft$1(this._iid,Ft$1.payloadify(t))},e.prototype.getMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=new dn$2(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(hn$2).message]}}))}))},e.prototype.getScheduledMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=new yn$2(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(mn$2).message]}}))}))},e.prototype.getMessagesByTimestamp=function(e,t,s,o,a){return void 0===a&&(a=$t$1.REQUEST_MESSAGE),r(this,void 0,void 0,(function(){var r,u,c;return i(this,(function(i){switch(i.label){case 0:return r=new pn$2(n(n({channelType:t,channelUrl:e,timestamp:s},tn$2),o)),[4,this._requestQueue.send(r)];case 1:return u=i.sent(),c=u.as(fn$2).messages,this._dispatcher.dispatch(new un$2({messages:c,source:a})),[2,c]}}))}))},e.prototype.getThreadedMessagesByTimestamp=function(e,t,s,o){return void 0===o&&(o=$t$1.REQUEST_THREADED_MESSAGE),r(this,void 0,void 0,(function(){var r,a,u,c;return i(this,(function(i){switch(i.label){case 0:return r=new pn$2(n(n(n({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},Qt$1),s),{replyType:ue$2.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(r)];case 1:return a=i.sent(),u=a.as(fn$2).messages,(c=u.slice(1)).forEach((function(t){t.parentMessage=e;})),this._dispatcher.dispatch(new un$2({messages:c,source:o})),[2,{parentMessage:u[0],threadedMessages:c}]}}))}))},e.prototype.getMessageChangelogs=function(e,t,s,o,a){return void 0===a&&(a=$t$1.REQUEST_MESSAGE_CHANGELOGS),r(this,void 0,void 0,(function(){var r,u,c,l,d,h,p,f;return i(this,(function(i){switch(i.label){case 0:return r=new _n$2(U$1(n(n({channelType:t,channelUrl:e,timestamp:"number"==typeof s?s:null,token:"string"==typeof s?s:null},rn$2),o))),[4,this._requestQueue.send(r)];case 1:return u=i.sent(),c=u.as(gn$2),l=c.updatedMessages,d=c.deletedMessagesInfo,h=c.hasMore,p=c.nextToken,f=d.map((function(e){return e.messageId})),l.length>0&&this._dispatcher.dispatch(new un$2({messages:l,source:a})),f.length>0&&this._dispatcher.dispatch(new cn$2({messageIds:f,source:a})),[2,{updatedMessages:l,deletedMessageIds:f,hasMore:h,token:p}]}}))}))},e}(),In$1=function(){function e(){this._onPending=Y,this._onFailed=Y,this._onSucceeded=Y;}return e.prototype._trigger=function(e,t){switch(t.sendingStatus){case le$2.PENDING:this._onPending(t);break;case le$2.FAILED:case le$2.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);break;case le$2.SCHEDULED:case le$2.SUCCEEDED:this._onSucceeded(t);}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}(),Sn$1=function(e){function n(t,n){var r=e.call(this,t)||this;r.threadInfo=null,r.targetMessageId=0,r.channelUrl=null,r.channelType=null;var i=n.thread_info,s=n.root_message_id,o=n.channel_url,a=n.channel_type;return i&&y("object",i)&&y("number",s)&&y("string",o)&&y("string",a)&&(r.threadInfo=new At$2(t,i),r.targetMessageId=s,r.channelUrl=o,r.channelType=a),r}return t(n,e),n}(Le$2),Tn$2={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,includePollDetails:!1},bn$1=function(){function e(e,t){var n;this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(n=t.limit)&&void 0!==n?n:20;}return Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),e.prototype._validate=function(){return y("number",this.limit)&&this.limit>0},e}(),Nn$2=function(e){function n(t){var n=t.channelCustomType,r=t.keyword,i=t.limit,s=t.reverse,o=t.exactMatch,a=t.channelUrl,u=t.order,c=t.messageTimestampFrom,l=t.messageTimestampTo,h=t.advancedQuery,p=t.targetFields,f=t.nextToken,_=e.call(this)||this;return _.method=d$1.GET,_.path="".concat(Qe$2,"/messages"),_.params={custom_type:n,query:r,limit:i,reverse:s,exact_match:o,channel_url:a,message_ts_from:c,message_ts_to:l,sort_field:u,advanced_query:h,target_fields:p,after:f},_}return t(n,e),n}(q$1),An$1=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.messages=n.results.map((function(e){return Ht$1(t,e)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r}return t(n,e),n}(F);!function(e){e.SCORE="score",e.TIMESTAMP="ts";}(on$2||(on$2={}));var Cn$2=function(e){function s(t,n){var r,i,s,o,a,u,c,l,d,h=this;return (h=e.call(this,t,n)||this).keyword="",h.reverse=!1,h.exactMatch=!1,h.channelUrl="",h.channelCustomType="",h.messageTimestampFrom=null,h.messageTimestampTo=null,h.order=on$2.SCORE,h.advancedQuery=!1,h.targetFields=null,h._nextToken="",h.keyword=n.keyword,h.reverse=null!==(r=n.reverse)&&void 0!==r&&r,h.exactMatch=null!==(i=n.exactMatch)&&void 0!==i&&i,h.channelUrl=null!==(s=n.channelUrl)&&void 0!==s?s:"",h.channelCustomType=null!==(o=n.channelCustomType)&&void 0!==o?o:"",h.messageTimestampFrom=null!==(a=n.messageTimestampFrom)&&void 0!==a?a:null,h.messageTimestampTo=null!==(u=n.messageTimestampTo)&&void 0!==u?u:null,h.order=null!==(c=n.order)&&void 0!==c?c:on$2.SCORE,h.advancedQuery=null!==(l=n.advancedQuery)&&void 0!==l&&l,h.targetFields=null!==(d=n.targetFields)&&void 0!==d?d:null,h}return t(s,e),s.prototype._validate=function(){return e.prototype._validate.call(this)&&y("string",this.keyword)&&this.keyword.length>0&&y("boolean",this.reverse)&&y("boolean",this.exactMatch)&&y("string",this.channelUrl)&&y("string",this.channelCustomType)&&(y("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(y("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&m(on$2,this.order)&&y("boolean",this.advancedQuery)&&E("string",this.targetFields,!0)},s.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,r,s,o,a,u;return i(this,(function(i){switch(i.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$2.of(this._iid).requestQueue,t=new Nn$2(n(n({},this),{nextToken:this._nextToken?this._nextToken:null})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=i.sent(),s=r.as(An$1),o=s.messages,a=s.hasNext,u=s.nextToken,this._nextToken=u,this._hasNext=a,this._isLoading=!1,[2,o];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},s}(bn$1),On$1=function(e){function n(t,n,r,i){var s=e.call(this,t,i)||this;return s.channelUrl=n,s.channelType=r,s}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&y("string",this.channelUrl)&&m(ne,this.channelType)},n}(bn$1),wn$2=function(e){function n(t,n,r,i){var s,o,a,u,c,l,d,h,p,f,_=this;return (_=e.call(this,t,n,r,i)||this).reverse=!1,_.messageTypeFilter=se$1.ALL,_.customTypesFilter=null,_.senderUserIdsFilter=null,_.replyType=ue$2.NONE,_.includeMetaArray=!1,_.includeReactions=!1,_.includeParentMessageInfo=!1,_.includeThreadInfo=!1,_.showSubchannelMessagesOnly=!1,_._edge=Number.MAX_SAFE_INTEGER,_.reverse=null!==(s=i.reverse)&&void 0!==s&&s,_.messageTypeFilter=null!==(o=i.messageTypeFilter)&&void 0!==o?o:se$1.ALL,_.customTypesFilter=null!==(a=i.customTypesFilter)&&void 0!==a?a:null,_.senderUserIdsFilter=null!==(u=i.senderUserIdsFilter)&&void 0!==u?u:null,_.replyType=null!==(c=i.replyType)&&void 0!==c?c:ue$2.NONE,_.includeMetaArray=null!==(l=i.includeMetaArray)&&void 0!==l&&l,_.includeReactions=null!==(d=i.includeReactions)&&void 0!==d&&d,_.includeParentMessageInfo=null!==(h=i.includeParentMessageInfo)&&void 0!==h&&h,_.includeThreadInfo=null!==(p=i.includeThreadInfo)&&void 0!==p&&p,_.showSubchannelMessagesOnly=null!==(f=i.showSubchannelMessagesOnly)&&void 0!==f&&f,_}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&y("boolean",this.reverse)&&m(se$1,this.messageTypeFilter)&&m(ue$2,this.replyType)&&E("string",this.customTypesFilter,!0)&&E("string",this.senderUserIdsFilter,!0)&&y("boolean",this.includeMetaArray)&&y("boolean",this.includeReactions)&&y("boolean",this.includeParentMessageInfo)&&y("boolean",this.includeThreadInfo)&&y("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,En$2.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,a([Number.MAX_SAFE_INTEGER],o(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},n}(On$1),Rn$1={channelUrl:null,scheduledMessageId:0},Dn$1=function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="message",t}return t(s,e),s.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,o=n.requestQueue,a=n.logger,u=n.onlineDetector,c=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:o,logger:a,onlineDetector:u,cacheContext:c}),this._manager=new En$2(t,{sdkState:r,dispatcher:i,requestQueue:o,onlineDetector:u,cacheContext:c});},s.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},s.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},s.prototype.getMessage=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return e=n(n({},Tn$2),e),at$2(function(e){return y("string",e.channelUrl)&&y("string",e.channelType)&&m(ne,e.channelType)&&y("number",e.messageId)&&y("boolean",e.includeMetaArray)&&y("boolean",e.includeParentMessageInfo)&&y("boolean",e.includeThreadInfo)&&y("boolean",e.includePollDetails)}(e)).throw(p.invalidParameters),[2,this._manager.getMessage(e)]}))}))},s.prototype.getScheduledMessage=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return e=n(n({},Rn$1),e),at$2(function(e){return y("string",e.channelUrl)&&y("number",e.scheduledMessageId)}(e)).throw(p.invalidParameters),[2,this._manager.getScheduledMessage(e)]}))}))},s}(Tt$2);
var oe$1,ue$1={data:null,customType:null,mentionType:ae.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},ce$1=function(u){return y("string",u.data,!0)&&y("string",u.customType,!0)&&m(ae,u.mentionType)&&E("string",u.mentionedUserIds,!0)&&E(ct$2,u.mentionedUsers,!0)&&y("string",u.mentionedMessageTemplate,!0)&&E(Dt$2,u.metaArrays,!0)&&y("number",u.parentMessageId,!0)&&y("boolean",u.isReplyToChannel)&&m(ce$2,u.pushNotificationDeliveryOption,!0)&&y(Lt$1,u.appleCriticalAlertOptions,!0)},le$1=function(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null},de$1=n(n({},ue$1),{message:null,translationTargetLanguages:null}),he$1=function(e){return ce$1(e)&&y("string",e.message)&&E("string",e.translationTargetLanguages,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url";}(oe$1||(oe$1={}));var pe$1,fe$1=function(e){return "undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},me$1=function(e){return e===oe$1.BLOB||e===oe$1.FILE},ve$1=function(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null},ye$1=n(n({},ue$1),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1}),ge$1=function(e){return ce$1(e)&&(S(e.file)||y("string",e.fileUrl))&&y("string",e.fileName,!0)&&y("string",e.mimeType,!0)&&y("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return y("object",e)&&e.maxWidth>0&&e.maxHeight>0})))};!function(e){e.MUTED="muted",e.BANNED="banned";}(pe$1||(pe$1={}));var _e$1,Te=function(){function e(e){var t,r,i;this.restrictionType=null,this.description=null,this.endAt=-1,m(pe$1,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(t=e.description)&&void 0!==t?t:null,this.endAt=null!==(i=null!==(r=e.end_at)&&void 0!==r?r:e.muted_end_at)&&void 0!==i?i:-1;}return e.payloadify=function(e){return e?U$1({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null},e}(),Ue$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.restrictionInfo=null,r.restrictionInfo=new Te(n),r}return t(t$1,e),t$1.payloadify=function(t){return t?U$1(n(n({},e.payloadify.call(this,t)),Te.payloadify(t.restrictionInfo))):null},t$1}(ct$2),Ie={data:null,customType:null,mentionType:ae.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},we=function(u){return y("string",u.data,!0)&&y("string",u.customType,!0)&&m(ae,u.mentionType)&&E("string",u.mentionedUserIds,!0)&&E(ct$2,u.mentionedUsers,!0)&&y("string",u.mentionedMessageTemplate,!0)&&E(Dt$2,u.metaArrays,!0)&&m(ce$2,u.pushNotificationDeliveryOption,!0)&&y(Lt$1,u.appleCriticalAlertOptions,!0)},Me$1=n(n({},Ie),{message:null,translationTargetLanguages:null}),Ee$1=function(e){return we(e)&&y("string",e.message,!0)&&E("string",e.translationTargetLanguages,!0)},Se=n({},Ie),be$1=function(e){function t$1(t){var n=t.channelUrl,r=t.channelType,i=t.token,a=t.limit,s=e.call(this)||this;return s.method=d$1.GET,s.path="".concat(We$2(r),"/").concat(encodeURIComponent(n),"/operators"),s.params={token:i,limit:a},s}return t(t$1,e),t$1}(q$1),Ce=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.operators=n.operators.map((function(e){return new ct$2(t,e)})),r.token=n.next,r}return t(t$1,e),t$1}(F),Ae$2=function(e){function t$1(t,n,r,i){return e.call(this,t,n,r,i)||this}return t(t$1,e),t$1.prototype._validate=function(){return e.prototype._validate.call(this)},t$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,a,s;return i(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=St$2.of(this._iid).requestQueue,n$1=new be$1(n(n({},this),{channelUrl:this.channelUrl,token:this._token})),[4,t.send(n$1)]):[3,2]):[3,5];case 1:return r=o.sent(),i$1=r.as(Ce),a=i$1.operators,s=i$1.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,a];case 2:return [2,e];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},t$1}(On$1),Pe$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.limit,s=t.token;return (n=e.call(this)||this).method=d$1.GET,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/mute"),n.params={limit:a,token:s},n}return t(t$1,e),t$1}(q$1),De$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;r.token=null,r.mutedUsers=[];var i=n.next,a=n.muted_list;return r.token=i,a&&a.length>0&&(r.mutedUsers=a.map((function(e){return new Ue$1(t,e)}))),r}return t(t$1,e),t$1}(F),Re$1=function(e){function t$1(t,n,r,i){return e.call(this,t,n,r,i)||this}return t(t$1,e),t$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,a;return i(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$2.of(this._iid).requestQueue,t=new Pe$1(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n$1=s.sent(),r=n$1.as(De$1),i$1=r.mutedUsers,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i$1];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},t$1}(On$1),qe$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.limit,s=t.token;return (n=e.call(this)||this).method=d$1.GET,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/ban"),n.params=U$1({limit:a,token:s}),n}return t(t$1,e),t$1}(q$1),Ne=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;r.token=null,r.bannedUsers=[];var i=n.next,a=n.banned_list;return r.token=i,a&&a.length>0&&(r.bannedUsers=a.map((function(e){return new Ue$1(t,e.user)}))),r}return t(t$1,e),t$1}(F),Oe=function(e){function t$1(t,n,r,i){return e.call(this,t,n,r,i)||this}return t(t$1,e),t$1.prototype._validate=function(){return e.prototype._validate.call(this)},t$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,a;return i(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$2.of(this._iid).requestQueue,t=new qe$1(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n$1=s.sent(),r=n$1.as(Ne),i$1=r.bannedUsers,a=r.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,i$1];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},t$1}(On$1);!function(e){e.SPAM="spam",e.HARASSING="harassing",e.SUSPICIOUS="suspicious",e.INAPPROPRIATE="inappropriate";}(_e$1||(_e$1={}));var ke=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.operatorUserIds;return (n=e.call(this)||this).method=d$1.POST,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:a},n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var Fe$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.operatorUserIds;return (n=e.call(this)||this).method=d$1.DELETE,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:a},n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){return e.call(this,t,n)||this}t(t$1,e);}(F);var Le$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId;return (n=e.call(this)||this).method=d$1.GET,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/mute/").concat(a),n}return t(t$1,e),t$1}(q$1),Qe$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;r.isMuted=!1,r.startAt=null,r.endAt=null,r.remainingDuration=null,r.description=null;var i=n.is_muted,a=n.start_at,s=n.end_at,o=n.remaining_duration,u=n.description;return r.isMuted=i,r.startAt=a,r.endAt=s,r.remainingDuration=o,r.description=u,r}return t(t$1,e),t$1}(F),ze$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.keys;return (n=e.call(this)||this).method=d$1.GET,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={keys:a,include_ts:!0},n}return t(t$1,e),t$1}(q$1),xe=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;r.ts=null;var i=n.metadata,a=n.ts;return r.metadata=i,r.ts=null!=a?a:null,r}return t(t$1,e),t$1}(F),Ge$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.metadata,s=t.upsert;return (n=e.call(this)||this).method=d$1.PUT,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:a,include_ts:!0,upsert:null!=s&&s},n}return t(t$1,e),t$1}(q$1),Ve$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;r.ts=null;var i=n.metadata,a=n.ts;return r.metadata=i,r.ts=null!=a?a:null,r}return t(t$1,e),t$1}(F),je$1=function(e){function t$1(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.created=null,i.updated=null,i.deleted=null,r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return t(t$1,e),t$1}(B$1),Be$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.key;return (n=e.call(this)||this).method=d$1.DELETE,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metadata/").concat(a),n.params={include_ts:!0},n}return t(t$1,e),t$1}(q$1),We$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;r.ts=null;var i=n.ts;return r.ts=null!=i?i:null,r}return t(t$1,e),t$1}(F),Ke$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType;return (n=e.call(this)||this).method=d$1.PUT,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={include_ts:!0},n}return t(t$1,e),t$1}(q$1),Ye$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;r.ts=null;var i=n.ts;return r.ts=null!=i?i:null,r}return t(t$1,e),t$1}(F),He$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.keys;return (n=e.call(this)||this).method=d$1.GET,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={keys:a},n}return t(t$1,e),t$1}(q$1),Je$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return t(t$1,e),t$1}(F),Xe$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.metaCounter;return (n=e.call(this)||this).method=d$1.POST,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:a},n}return t(t$1,e),t$1}(q$1),Ze$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return t(t$1,e),t$1}(F),$e$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.metaCounter,s=t.upsert,o=void 0!==s&&s,u=t.mode,c=void 0===u?"set":u;return (n=e.call(this)||this).method=d$1.PUT,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:a,upsert:o,mode:c},n}return t(t$1,e),t$1}(q$1),et$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return t(t$1,e),t$1}(F),tt$1=function(e){function t$1(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.created=null,i.updated=null,i.deleted=null,r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return t(t$1,e),t$1}(B$1),nt$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.key;return (n=e.call(this)||this).method=d$1.DELETE,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metacounter/").concat(a),n.params=null,n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){return e.call(this,t,n)||this}t(t$1,e);}(F);var rt$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType;return (n=e.call(this)||this).method=d$1.DELETE,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/metacounter"),n.params=null,n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var it$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId,s=t.seconds,o=t.description;return (n=e.call(this)||this).method=d$1.POST,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/mute"),n.params={user_id:a,seconds:s,description:o},n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){return e.call(this,t,n)||this}t(t$1,e);}(F);var at$1=function(e){function t$1(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Ue$1(t,r.data),i}return t(t$1,e),t$1}(B$1),st$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId;return (n=e.call(this)||this).method=d$1.DELETE,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/mute/").concat(encodeURIComponent(a)),n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var ot$1=function(e){function t$1(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Ue$1(t,r.data),i}return t(t$1,e),t$1}(B$1),ut$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId,s=t.seconds,o=t.description;return (n=e.call(this)||this).method=d$1.POST,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/ban"),n.params=U$1({user_id:a,seconds:s,description:o}),n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var ct$1=function(e){function t$1(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.memberCount=null,i.joinedMemberCount=null,i.user=new Ue$1(t,r.data),r.data.member_count&&(i.memberCount=r.data.member_count),r.data.joined_member_count&&(i.joinedMemberCount=r.data.joined_member_count),i}return t(t$1,e),t$1}(B$1),lt$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.userId;return (n=e.call(this)||this).method=d$1.DELETE,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/ban/").concat(encodeURIComponent(a)),n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var dt$1=function(e){function t$1(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new Ue$1(t,r.data),i}return t(t$1,e),t$1}(B$1),ht$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.freezing;return (n=e.call(this)||this).method=d$1.PUT,n.path="".concat(We$2(i),"/").concat(encodeURIComponent(r),"/freeze"),n.params={freeze:a},n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var pt$1=function(e){function t$1(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.freeze=r.data.freeze,i}return t(t$1,e),t$1}(B$1),ft$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.category,s=t.userId,o=t.description;return (n=e.call(this)||this).method=d$1.POST,n.path="".concat(Xe$2(i),"/").concat(encodeURIComponent(r)),n.params={report_category:a,reporting_user_id:s,report_description:o},n}return t(t$1,e),t$1}(q$1),mt$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.category,s=t.userId,o=t.offendingUserId,u=t.description;return (n=e.call(this)||this).method=d$1.POST,n.path="/report/users/".concat(o),n.params={channel_url:r,channel_type:i===ne.OPEN?"open_channels":"group_channels",report_category:a,reporting_user_id:s,report_description:u},n}return t(t$1,e),t$1}(q$1),vt$1=function(e){function t$1(t){var n=this,r=t.channelUrl,i=t.channelType,a=t.category,s=t.userId,o=t.offendingUserId,u=t.messageId,c=t.description;return (n=e.call(this)||this).method=d$1.POST,n.path="".concat(Xe$2(i),"/").concat(encodeURIComponent(r),"/messages/").concat(u),n.params={report_category:a,reporting_user_id:s,report_description:c,offending_user_id:o},n}return t(t$1,e),t$1}(q$1),yt$1=function(t$1){function n(n){var r=[];return n.mentionType===ae.USERS&&(n.mentionedUserIds?r=n.mentionedUserIds:n.mentionedUsers&&(r=n.mentionedUsers.map((function(e){return e.userId})))),t$1.call(this,{code:"MESG",ackRequired:!0,payload:U$1({channel_url:n.channelUrl,message:n.message,data:n.data,custom_type:n.customType,metaarray:n.metaArrays,mention_type:n.mentionType,mentioned_user_ids:r,mentioned_message_template:n.mentionedMessageTemplate,target_langs:n.translationTargetLanguages,push_option:n.pushNotificationDeliveryOption&&n.pushNotificationDeliveryOption!==ce$2.DEFAULT?n.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:n.appleCriticalAlertOptions,silent:n.silent,reply_to_channel:n.isReplyToChannel,parent_message_id:n.parentMessageId>0?n.parentMessageId:null,req_id:n.reqId})})||this}return t(n,t$1),n}(H$2),gt$1=function(e){function t$1(t,n,r){var i,a,s,o=this;(o=e.call(this,t,"MESG",r)||this).message=new Vt$1(t,r);var u=St$2.of(t).sdkState;return o.isMentioned=Ye$2(o.message.mentionType,null!==(i=o.message.mentionedUserIds)&&void 0!==i?i:null===(a=o.message.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})),u.userId),o.forceUpdateLastMessage=null!==(s=r.force_update_last_message)&&void 0!==s&&s,o}return t(t$1,e),t$1}(B$1),_t$1=function(t$1){function n(n){var r=[];return n.mentionType===ae.USERS&&(n.mentionedUserIds?r=n.mentionedUserIds:n.mentionedUsers&&(r=n.mentionedUsers.map((function(e){return e.userId})))),t$1.call(this,{code:"MEDI",ackRequired:!0,payload:U$1({channel_url:n.channelUrl,msg_id:n.messageId,message:n.message,data:n.data,custom_type:n.customType,metaarray:n.metaArrayParams,mention_type:n.mentionType,mentioned_user_ids:r,mentioned_message_template:n.mentionedMessageTemplate,apple_critical_alert_options:n.appleCriticalAlertOptions})})||this}return t(n,t$1),n}(H$2),Tt$1=function(e){function t$1(t,n,r){var i,a,s,o,u,c,l=this;(l=e.call(this,t,"MEDI",r)||this).message=new Vt$1(t,r);var d=St$2.of(t).sdkState;return l.mentionCountChange=Je$2({mentionType:null!==(a=null===(i=r.old_values)||void 0===i?void 0:i.mention_type)&&void 0!==a?a:null,mentionedUserIds:null!==(o=null===(s=r.old_values)||void 0===s?void 0:s.mentioned_user_ids)&&void 0!==o?o:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},d.userId),l}return t(t$1,e),t$1}(B$1),Ut$1=function(t$1){function n(n){var r=[];return n.mentionType===ae.USERS&&(n.mentionedUserIds?r=n.mentionedUserIds:n.mentionedUsers&&(r=n.mentionedUsers.map((function(e){return e.userId})))),t$1.call(this,{code:"FEDI",ackRequired:!0,payload:U$1({channel_url:n.channelUrl,msg_id:n.messageId,data:n.data,custom_type:n.customType,metaarray:n.metaArrayParams,mention_type:n.mentionType,mentioned_user_ids:r,apple_critical_alert_options:n.appleCriticalAlertOptions})})||this}return t(n,t$1),n}(H$2),It$1=function(e){function t$1(t,n,r){var i,a,s,o,u,c,l=this;(l=e.call(this,t,"FEDI",r)||this).message=new Wt$1(t,r);var d=St$2.of(t).sdkState;return l.mentionCountChange=Je$2({mentionType:null!==(a=null===(i=r.old_values)||void 0===i?void 0:i.mention_type)&&void 0!==a?a:null,mentionedUserIds:null!==(o=null===(s=r.old_values)||void 0===s?void 0:s.mentioned_user_ids)&&void 0!==o?o:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},d.userId),l}return t(t$1,e),t$1}(B$1),wt$1=function(e){function t$1(t){var n=e.call(this)||this;return n.method=d$1.DELETE,n.path="".concat(We$2(t.channelType),"/").concat(t.channelUrl,"/messages/").concat(t.messageId),n}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var Mt$1=function(e){function t$1(t,n,r){var i=e.call(this,t,"DELM",r)||this;return i.channelUrl=r.channel_url,i.channelType=r.channel_type,i.messageId=Number(r.msg_id),i}return t(t$1,e),t$1}(B$1),Et$1=function(e){function t$1(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.reactionKey,s=e.call(this)||this;return s.method=d$1.POST,s.path="".concat(We$2(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/reactions"),s.params={reaction:a},s}return t(t$1,e),t$1}(q$1),St$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.reactionEvent=new wt$2(n),r}return t(t$1,e),t$1}(F),bt$1=function(e){function t$1(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.reactionKey,s=e.call(this)||this;return s.method=d$1.DELETE,s.path="".concat(We$2(n),"/").concat(encodeURIComponent(r),"/messages/").concat(i,"/reactions"),s.params={reaction:a},s}return t(t$1,e),t$1}(q$1),Ct$1=function(e){function t$1(t,n$1){var r=e.call(this,t,n$1)||this;return r.reactionEvent=new wt$2(n({},n$1)),r}return t(t$1,e),t$1}(F),At$1=function(e){function t$1(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,a=t.translationTargetLanguages,s=e.call(this)||this;return s.method=d$1.POST,s.path="".concat(We$2(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(i),"/translation"),s.params={target_langs:a},s}return t(t$1,e),t$1}(q$1),Pt$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.message=new Vt$1(t,n),r}return t(t$1,e),t$1}(F),Dt$1=function(t$1){function n(n){var r,i=this;i=t$1.call(this)||this;var s=[];n.mentionType===ae.USERS&&(n.mentionedUserIds?s=n.mentionedUserIds:n.mentionedUsers&&(s=n.mentionedUsers.map((function(e){return e.userId}))));var u=n.channelType,c=n.channelUrl;return i.method=d$1.POST,i.path="".concat(We$2(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),i.params={req_id:n.reqId,scheduled_at:n.scheduledAt,message_type:oe$2.USER,message:n.message,custom_type:n.customType,data:n.data,mention_type:n.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=n.metaArrays)||void 0===r?void 0:r.map((function(e){return Dt$2.payloadify(e)})),apple_critical_alert_options:Lt$1.payloadify(n.appleCriticalAlertOptions),target_langs:n.translationTargetLanguages,push_option:n.pushNotificationDeliveryOption},i}return t(n,t$1),n}(q$1),Rt$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.message=new Vt$1(t,n),r}return t(t$1,e),t$1}(F),qt$1=function(t$1){function n(n){var r,i=this;i=t$1.call(this)||this;var s=[];n.mentionType===ae.USERS&&(n.mentionedUserIds?s=n.mentionedUserIds:n.mentionedUsers&&(s=n.mentionedUsers.map((function(e){return e.userId}))));var u=n.channelType,c=n.channelUrl;return i.method=d$1.POST,i.path="".concat(We$2(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),i.params={req_id:n.reqId,scheduled_at:n.scheduledAt,message_type:oe$2.FILE,url:n.fileUrl,file_name:n.fileName,file_size:n.fileSize,file_type:n.mimeType,thumbnails:n.thumbnailSizes?n.thumbnailSizes.map((function(e){return Gt$1.payloadify(e)})):[],custom_type:n.customType,data:n.data,require_auth:n.requireAuth,mention_type:n.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=n.metaArrays)||void 0===r?void 0:r.map((function(e){return Dt$2.payloadify(e)})),apple_critical_alert_options:Lt$1.payloadify(n.appleCriticalAlertOptions),push_option:n.pushNotificationDeliveryOption},i}return t(n,t$1),n}(q$1),Nt$1=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.message=new Wt$1(t,n),r}return t(t$1,e),t$1}(F),kt$1=function(e){function l(n,r){var a,s,o,u,c=this;return (c=e.call(this,n)||this).url="",c.channelType=ne.BASE,c.name="",c.coverUrl="",c.customType="",c.data="",c.isFrozen=!1,c.isEphemeral=!1,c.creator=null,c.createdAt=0,c.url=r.channel_url,c.name=null!==(a=r.name)&&void 0!==a?a:"",c.coverUrl=null!==(s=r.cover_url)&&void 0!==s?s:"",c.customType=null!==(o=r.custom_type)&&void 0!==o?o:"",c.data=null!==(u=r.data)&&void 0!==u?u:"",c.isFrozen=!!y("boolean",r.freeze)&&r.freeze,c.isEphemeral=!!y("boolean",r.is_ephemeral)&&r.is_ephemeral,c.creator=r.created_by?new ct$2(c._iid,r.created_by):null,c.createdAt=1e3*r.created_at,c._cachedMetaData=new Map,r.metadata&&r.ts&&Object.keys(r.metadata).forEach((function(e){c._cachedMetaData.set(e,{value:r.metadata[e],isRemoved:!1,updatedAt:r.ts});})),c}return t(l,e),l.payloadify=function(t){return U$1(n(n({},e.payloadify.call(this,t)),{channel_url:t.url,name:t.name,cover_url:t.coverUrl,custom_type:t.customType,data:t.data,freeze:t.isFrozen,is_ephemeral:t.isEphemeral,created_by:ct$2.payloadify(t.creator),created_at:t.createdAt/1e3}))},l.prototype.isGroupChannel=function(){return this.channelType===ne.GROUP},l.prototype.isOpenChannel=function(){return this.channelType===ne.OPEN},Object.defineProperty(l.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value);})),e},enumerable:!1,configurable:!0}),l.prototype._upsertCachedMetaData=function(e,t){var n=this;Object.keys(e).forEach((function(r){var i=n._cachedMetaData.get(r);(!i||i.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t});}));},l.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!1,r.updatedAt=t);}));},l.prototype._generateRequestId=function(){return "rq-".concat(R())},l.prototype.isIdentical=function(e){return e&&this.url===e.url},l.prototype.isEqual=function(e){return g(this,e)},l.prototype.createOperatorListQuery=function(e){return void 0===e&&(e={}),new Ae$2(this._iid,this.url,this.channelType,e)},l.prototype.createMutedUserListQuery=function(e){return void 0===e&&(e={}),new Re$1(this._iid,this.url,this.channelType,e)},l.prototype.createBannedUserListQuery=function(e){return void 0===e&&(e={}),new Oe(this._iid,this.url,this.channelType,e)},l.prototype.createPreviousMessageListQuery=function(e){return void 0===e&&(e={}),new wn$2(this._iid,this.url,this.channelType,e)},l.prototype.addOperators=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(i){switch(i.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),t=St$2.of(this._iid).requestQueue,n=new ke({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return i.sent(),[2]}}))}))},l.prototype.removeOperators=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(i){switch(i.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),t=St$2.of(this._iid).requestQueue,n=new Fe$1({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return i.sent(),[2]}}))}))},l.prototype.getMyMutedInfo=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,a,s,o,u,c,l;return i(this,(function(d){switch(d.label){case 0:return e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Le$1({channelUrl:this.url,channelType:this.channelType,userId:t.userId}),[4,n.send(r)];case 1:return i$1=d.sent(),a=i$1.as(Qe$1),s=a.isMuted,o=a.startAt,u=a.endAt,c=a.remainingDuration,l=a.description,[2,{isMuted:s,startAt:o,endAt:u,remainingDuration:c,description:l}]}}))}))},l.prototype.getMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,i$1,a,s,o;return i(this,(function(u){switch(u.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),t=St$2.of(this._iid).requestQueue,n=new ze$1({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return i$1=u.sent(),a=i$1.as(xe),s=a.metadata,o=a.ts,this._upsertCachedMetaData(s,o),[2,s]}}))}))},l.prototype.getAllMetaData=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,a;return i(this,(function(s){switch(s.label){case 0:return e=St$2.of(this._iid).requestQueue,t=new ze$1({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(xe),i$1=r.metadata,a=r.ts,this._upsertCachedMetaData(i$1,a),[2,i$1]}}))}))},l.prototype.createMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(a){switch(a.label){case 0:return t=St$2.of(this._iid).requestQueue,n=new Ze$2({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,t.send(n)];case 1:return r=a.sent(),i$1=r.as($e$2).metaData,this._upsertCachedMetaData(i$1,0),[2,i$1]}}))}))},l.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,i$1,a,s,o;return i(this,(function(u){switch(u.label){case 0:return n=St$2.of(this._iid).requestQueue,r=new Ge$1({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),[4,n.send(r)];case 1:return i$1=u.sent(),a=i$1.as(Ve$1),s=a.metadata,o=a.ts,this._upsertCachedMetaData(s,o),[2,s]}}))}))},l.prototype.deleteMetaData=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,a;return i(this,(function(s){switch(s.label){case 0:return at$2(y("string",e)).throw(p.invalidParameters),n=St$2.of(this._iid).requestQueue,r=new Be$1({channelUrl:this.url,channelType:this.channelType,key:e}),[4,n.send(r)];case 1:return i$1=s.sent(),a=i$1.as(We$1).ts,this._removeFromCachedMetaData([e],a),[2]}}))}))},l.prototype.deleteAllMetaData=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=St$2.of(this._iid).requestQueue,t=new Ke$1({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n=i.sent(),r=n.as(Ye$1).ts,this._removeFromCachedMetaData(a([],o(this._cachedMetaData.keys()),!1),r),[2]}}))}))},l.prototype.getMetaCounters=function(e){return r(this,void 0,void 0,(function(){var t,n,i$1;return i(this,(function(a){switch(a.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),t=St$2.of(this._iid).requestQueue,n=new He$1({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return i$1=a.sent(),[2,i$1.as(Je$1).metaCounter]}}))}))},l.prototype.getAllMetaCounters=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:return e=St$2.of(this._iid).requestQueue,t=new He$1({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(Je$1).metaCounter]}}))}))},l.prototype.createMetaCounters=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=St$2.of(this._iid).requestQueue,n=new Xe$1({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Ze$1).metaCounter]}}))}))},l.prototype.updateMetaCounters=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,i$1;return i(this,(function(a){switch(a.label){case 0:return n=St$2.of(this._iid).requestQueue,r=new $e$1({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),[4,n.send(r)];case 1:return i$1=a.sent(),[2,i$1.as(et$1).metaCounter]}}))}))},l.prototype.increaseMetaCounters=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=St$2.of(this._iid).requestQueue,n=new $e$1({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(et$1).metaCounter]}}))}))},l.prototype.decreaseMetaCounters=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=St$2.of(this._iid).requestQueue,n=new $e$1({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(et$1).metaCounter]}}))}))},l.prototype.deleteMetaCounter=function(e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return at$2(y("string",e)).throw(p.invalidParameters),n=St$2.of(this._iid).requestQueue,r=new nt$1({channelUrl:this.url,channelType:this.channelType,key:e}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},l.prototype.deleteAllMetaCounters=function(){return r(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return e=St$2.of(this._iid).requestQueue,t=new rt$1({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},l.prototype.muteUser=function(e,t,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return [2,this.muteUserWithUserId(e.userId,t,n)]}))}))},l.prototype.muteUserWithUserId=function(e,n,r$1){return r(this,void 0,void 0,(function(){var i$1,a;return i(this,(function(s){switch(s.label){case 0:return at$2(y("string",e)&&y("number",n,!0)&&y("string",r$1,!0)).throw(p.invalidParameters),i$1=St$2.of(this._iid).requestQueue,a=new it$1({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:n,description:r$1}),[4,i$1.send(a)];case 1:return s.sent(),[2]}}))}))},l.prototype.unmuteUser=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.unmuteUserWithUserId(e.userId)]}))}))},l.prototype.unmuteUserWithUserId=function(e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return at$2(y("string",e)).throw(p.invalidParameters),n=St$2.of(this._iid).requestQueue,r=new st$1({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},l.prototype.banUser=function(e,t,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return [2,this.banUserWithUserId(e.userId,t,n)]}))}))},l.prototype.banUserWithUserId=function(e,n,r$1){return r(this,void 0,void 0,(function(){var i$1,a;return i(this,(function(s){switch(s.label){case 0:return at$2(y("string",e)&&y("number",n,!0)&&y("string",r$1,!0)).throw(p.invalidParameters),i$1=St$2.of(this._iid).requestQueue,a=new ut$1({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:n,description:r$1}),[4,i$1.send(a)];case 1:return s.sent(),[2]}}))}))},l.prototype.unbanUser=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.unbanUserWithUserId(e.userId)]}))}))},l.prototype.unbanUserWithUserId=function(e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return at$2(y("string",e)).throw(p.invalidParameters),n=St$2.of(this._iid).requestQueue,r=new lt$1({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},l.prototype.freeze=function(){return r(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return e=St$2.of(this._iid).requestQueue,t=new ht$1({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!0,[2]}}))}))},l.prototype.unfreeze=function(){return r(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return e=St$2.of(this._iid).requestQueue,t=new ht$1({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!1,[2]}}))}))},l.prototype.getMessagesByTimestamp=function(e,n$1){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return n$1=n(n({},tn$2),n$1),at$2(y("number",e)&&nn$1(n$1)).throw(p.invalidParameters),[4,En$2.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,n$1)];case 1:return [2,r.sent()]}}))}))},l.prototype.getMessageChangeLogsSinceTimestamp=function(e,n$1){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return n$1=n(n({},rn$2),n$1),at$2(y("number",e)&&sn$2(n$1)).throw(p.invalidParameters),[4,En$2.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n$1)];case 1:return [2,r.sent()]}}))}))},l.prototype.getMessageChangeLogsSinceToken=function(e,n$1){return r(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return n$1=n(n({},rn$2),n$1),at$2(y("string",e)&&sn$2(n$1)).throw(p.invalidParameters),[4,En$2.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n$1)];case 1:return [2,r.sent()]}}))}))},l.prototype._createPendingSendableMessagePayload=function(e,t,n){var r=St$2.of(this._iid).sessionManager;return U$1({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map((function(e){return Dt$2.payloadify(e)})):null,apple_critical_alert_options:e.appleCriticalAlertOptions?Lt$1.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:Ft$1.payloadify(r.currentUser),req_id:t,request_state:le$2.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:e.mentionedUsers})},l.prototype._createPendingUserMessage=function(e,t,n$1){var r,i,a={};if(e.translationTargetLanguages)try{for(var s$1=s(e.translationTargetLanguages),o=s$1.next();!o.done;o=s$1.next()){a[o.value]="";}}catch(e){r={error:e};}finally{try{o&&!o.done&&(i=s$1.return)&&i.call(s$1);}finally{if(r)throw r.error}}var l=U$1(n(n({},this._createPendingSendableMessagePayload(e,t,n$1)),{type:ie.USER,message:e.message,translations:a})),d=new Vt$1(this._iid,l);return d.messageParams=e,d},l.prototype._createPendingScheduledUserMessage=function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},l.prototype._createPendingFileMessage=function(e,t,n$1){var r=U$1(n(n({},this._createPendingSendableMessagePayload(e,t,n$1)),{type:ie.FILE,url:e.fileUrl,file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return {url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),i=new Wt$1(this._iid,r);return i.messageParams=e,i},l.prototype._createPendingScheduledFileMessage=function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},l.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===u.REQUEST_CANCELED?e.sendingStatus=le$2.CANCELED:n||(e.sendingStatus=le$2.FAILED);},l.prototype.sendUserMessage=function(e){return e=n(n({},de$1),e),at$2(he$1(e)).throw(p.invalidParameters),this._sendUserMessage(e)},l.prototype._sendUserMessage=function(e,t,n$1){var r$1=this;void 0===t&&(t=Date.now()),void 0===n$1&&(n$1=null);var i$1=St$2.of(this._iid),a=i$1.dispatcher,s=i$1.requestQueue,o=n$1,c=new In$1;if(!o){o=this._generateRequestId();var l=St$2.of(this._iid).dispatcher;me$2(2).then((function(){var n=r$1._createPendingUserMessage(e,o,t);l.dispatch(new un$2({messages:[n],source:$t$1.EVENT_MESSAGE_SENT_PENDING})),Ie$1((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,c._trigger(null,n)]}))}))}));}));}var d=new yt$1(n({channelUrl:this.url,channelType:this.channelType,reqId:o},e));return s.send(d).then((function(e){var t=e.as(gt$1).message;a.dispatch(new un$2({messages:[t],source:$t$1.EVENT_MESSAGE_SENT_SUCCESS})),Ie$1((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,c._trigger(null,t)]}))}))}));})).catch((function(n){if(h$1(n))throw n;me$2(2).then((function(){var i$1=r$1._createPendingUserMessage(e,o,t),s=St$2.of(r$1._iid).cacheContext.localCacheEnabled&&I(n.code);r$1._markMessageAsFailed(i$1,n,s),a.dispatch(new un$2({messages:[i$1],source:i$1.sendingStatus===le$2.PENDING?$t$1.REQUEST_RESEND_MESSAGE:$t$1.EVENT_MESSAGE_SENT_FAILED})),Ie$1((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,c._trigger(n,i$1)]}))}))}));}));})),c},l.prototype._autoResendUserMessage=function(e){return at$2(e instanceof Vt$1).throw(p.invalidParameters),this._sendUserMessage(e.messageParams,e.createdAt,e.reqId)},l.prototype.resendUserMessage=function(e){var t;return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){var a;return at$2(e instanceof Vt$1&&!e.scheduledInfo).throw(p.invalidParameters),n=new ee$1,r=null!==(t=e.messageParams)&&void 0!==t?t:U$1({data:(a=e).data,customType:a.customType,mentionType:a.mentionType,mentionedUsers:a.mentionedUsers,mentionedUserIds:a.mentionedUserIds,mentionedMessageTemplate:a.mentionedMessageTemplate,metaArrays:a.metaArrays,parentMessageId:a.parentMessageId,appleCriticalAlertOptions:a.appleCriticalAlertOptions,message:a.message,translationTargetLanguages:Object.keys(a.translations)}),this._sendUserMessage(r).onFailed((function(e){return n.reject(e)})).onSucceeded((function(e){return n.resolve(e)})),[2,n.promise]}))}))},l.prototype.updateUserMessage=function(e,n$1){return r(this,void 0,void 0,(function(){var r,i$1,a,s,o,c;return i(this,(function(l){switch(l.label){case 0:return n$1=n(n({},Me$1),n$1),at$2(y("number",e)&&Ee$1(n$1)).throw(p.invalidParameters),r=St$2.of(this._iid),i$1=r.dispatcher,a=r.requestQueue,s=new _t$1(n({channelType:this.channelType,channelUrl:this.url,messageId:e},n$1)),[4,a.send(s)];case 1:return o=l.sent(),c=o.as(Tt$1).message,i$1.dispatch(new un$2({messages:[c],source:$t$1.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},l.prototype.copyUserMessage=function(e,t){var n$1,r$1,i$1;return r(this,void 0,void 0,(function(){var a,o;return i(this,(function(c){return at$2(e instanceof l&&t instanceof Vt$1&&t.sendingStatus===le$2.SUCCEEDED&&e.url===t.channelUrl&&!t.scheduledInfo).throw(p.invalidParameters),a=new ee$1,o=null!==(n$1=t.messageParams)&&void 0!==n$1?n$1:n(n({},t),{mentionType:t.mentionType,mentionedUserIds:null!==(r$1=t.mentionedUserIds)&&void 0!==r$1?r$1:null===(i$1=t.mentionedUsers)||void 0===i$1?void 0:i$1.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(t.translations),pushNotificationDeliveryOption:ce$2.DEFAULT,parentMessageId:null,isReplyToChannel:!1}),e._sendUserMessage(o).onSucceeded((function(e){return a.resolve(e)})).onFailed((function(e){return a.reject(e)})),[2,a.promise]}))}))},l.prototype.translateUserMessage=function(e,t){return r(this,void 0,void 0,(function(){var n,i$1,a;return i(this,(function(s){switch(s.label){case 0:return at$2(e instanceof Vt$1&&e.messageId>0&&E("string",t)).throw(p.invalidParameters),n=St$2.of(this._iid).requestQueue,i$1=new At$1({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),[4,n.send(i$1)];case 1:return a=s.sent(),[2,a.as(Pt$1).message]}}))}))},l.prototype._createScheduledUserMessage=function(e,t){var n$1=this,r$1=St$2.of(this._iid).requestQueue,i$1=Date.now(),a=this._generateRequestId();me$2(2).then((function(){var r$1=n$1._createPendingScheduledUserMessage(e,a,i$1);Ie$1((function(){return r(n$1,void 0,void 0,(function(){return i(this,(function(e){return [2,t._trigger(null,r$1)]}))}))}));}));var s=new Dt$1(n({reqId:a,channelType:this.channelType,channelUrl:this.url},e));r$1.send(s).then((function(e){var r$1=e.as(Rt$1).message;Ie$1((function(){return r(n$1,void 0,void 0,(function(){return i(this,(function(e){return [2,t._trigger(null,r$1)]}))}))}));})).catch((function(r$1){if(h$1(r$1))throw r$1;me$2(2).then((function(){var s=n$1._createPendingScheduledUserMessage(e,a,i$1);n$1._markMessageAsFailed(s,r$1),Ie$1((function(){return r(n$1,void 0,void 0,(function(){return i(this,(function(e){return [2,t._trigger(r$1,s)]}))}))}));}));}));},l.prototype.sendFileMessage=function(e){return e=n(n({},ye$1),e),at$2(ge$1(e)).throw(p.invalidParameters),this._sendFileMessage(e)},l.prototype._sendFileMessage=function(e,t,n){var r$1=this;void 0===t&&(t=Date.now()),void 0===n&&(n=null);var i$1=St$2.of(this._iid).dispatcher,a=En$2.of(this._iid).fileMessageQueue,s=n,o=new In$1;return s||(s=this._generateRequestId(),me$2(2).then((function(){var n=r$1._createPendingFileMessage(e,s,t);i$1.dispatch(new un$2({messages:[n],source:$t$1.EVENT_MESSAGE_SENT_PENDING})),Ie$1((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,o._trigger(null,n)]}))}))}));}))),a.request(this,s,e).then((function(e){i$1.dispatch(new un$2({messages:[e],source:$t$1.EVENT_MESSAGE_SENT_SUCCESS})),Ie$1((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(t){return [2,o._trigger(null,e)]}))}))}));})).catch((function(n){if(h$1(n))throw n;me$2(2).then((function(){var a=r$1._createPendingFileMessage(e,s,t),u=St$2.of(r$1._iid).cacheContext.localCacheEnabled&&I(n.code);r$1._markMessageAsFailed(a,n,u),i$1.dispatch(new un$2({messages:[a],source:a.sendingStatus===le$2.PENDING?$t$1.REQUEST_RESEND_MESSAGE:$t$1.EVENT_MESSAGE_SENT_FAILED})),Ie$1((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,o._trigger(n,a)]}))}))}));}));})),o},l.prototype._autoResendFileMessage=function(e){at$2(e instanceof Wt$1).throw(p.invalidParameters);var t=St$2.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.createdAt,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e);})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e);}))},l.prototype._createScheduledFileMessage=function(e,t,n$1,r$1){var i$1=this,a=St$2.of(this._iid).requestQueue,s=new qt$1(n(n({reqId:n$1,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));a.send(s).then((function(e){var n=e.as(Nt$1).message;Ie$1((function(){return r(i$1,void 0,void 0,(function(){return i(this,(function(e){return [2,t._trigger(null,n)]}))}))}));})).catch((function(a){if(h$1(a))throw a;me$2(2).then((function(){var s=i$1._createPendingScheduledFileMessage(e,n$1,r$1);i$1._markMessageAsFailed(s,a),Ie$1((function(){return r(i$1,void 0,void 0,(function(){return i(this,(function(e){return [2,t._trigger(a,s)]}))}))}));}));}));},l.prototype.sendFileMessages=function(e){var t,n$1;at$2(e.every((function(e){return ge$1(n(n({},ye$1),e))}))).throw(p.invalidParameters);var r=new In$1;try{for(var i=s(e),a=i.next();!a.done;a=i.next()){var s$1=a.value;this.sendFileMessage(s$1).onPending((function(e){return r._trigger(null,e)})).onFailed((function(e,t){return r._trigger(e,t)})).onSucceeded((function(e){return r._trigger(null,e)}));}}catch(e){t={error:e};}finally{try{a&&!a.done&&(n$1=i.return)&&n$1.call(i);}finally{if(t)throw t.error}}return r},l.prototype.resendFileMessage=function(e,t){var n;return r(this,void 0,void 0,(function(){var r,i$1;return i(this,(function(a){return at$2(e instanceof Wt$1&&t instanceof Blob&&!e.scheduledInfo).throw(p.invalidParameters),r=new ee$1,i$1=null!==(n=e.messageParams)&&void 0!==n?n:function(e,t){return void 0===t&&(t=null),U$1({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:t,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((function(e){return {maxWidth:e.width,maxHeight:e.height}}))})}(e,t),this._sendFileMessage(i$1).onFailed((function(e){return r.reject(e)})).onSucceeded((function(e){return r.resolve(e)})),[2,r.promise]}))}))},l.prototype.updateFileMessage=function(e,n$1){return r(this,void 0,void 0,(function(){var r,i$1,a,s,o,c;return i(this,(function(l){switch(l.label){case 0:return n$1=n(n({},Se),n$1),at$2(y("number",e)&&function(e){return we(e)}(n$1)).throw(p.invalidParameters),r=St$2.of(this._iid),i$1=r.dispatcher,a=r.requestQueue,s=new Ut$1(n({channelType:this.channelType,channelUrl:this.url,messageId:e},n$1)),[4,a.send(s)];case 1:return o=l.sent(),c=o.as(It$1).message,i$1.dispatch(new un$2({messages:[c],source:$t$1.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},l.prototype.cancelUploadingFileMessage=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(n){return at$2(y("string",e)).throw(p.invalidParameters),En$2.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]}))}))},l.prototype.copyFileMessage=function(e,t){var n$1,r$1;return r(this,void 0,void 0,(function(){var i$1,a;return i(this,(function(o){return at$2(e instanceof l&&t instanceof Wt$1&&t.sendingStatus===le$2.SUCCEEDED&&e.url===t.channelUrl&&!t.scheduledInfo).throw(p.invalidParameters),i$1=new ee$1,a=n(n({},t),{fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,mentionType:t.mentionType,mentionedUserIds:null!==(n$1=t.mentionedUserIds)&&void 0!==n$1?n$1:null===(r$1=t.mentionedUsers)||void 0===r$1?void 0:r$1.map((function(e){return e.userId})),pushNotificationDeliveryOption:ce$2.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:t.thumbnails.map((function(e){return {maxWidth:e.width,maxHeight:e.height}})),requireAuth:t.requireAuth}),e._sendFileMessage(a).onSucceeded((function(e){return i$1.resolve(e)})).onFailed((function(e){return i$1.reject(e)})),[2,i$1.promise]}))}))},l.prototype.deleteMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return at$2(e instanceof xt$1).throw(p.invalidParameters),e.messageId>0?(t=St$2.of(this._iid).requestQueue,n=new wt$1({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,t.send(n)]):[3,2];case 1:r.sent(),r.label=2;case 2:return [2]}}))}))},l.prototype.addReaction=function(e,n){return r(this,void 0,void 0,(function(){var r,i$1,a;return i(this,(function(s){switch(s.label){case 0:return at$2(e instanceof qt$2&&e.messageId>0&&y("string",n)).throw(p.invalidParameters),r=St$2.of(this._iid).requestQueue,i$1=new Et$1({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:n}),[4,r.send(i$1)];case 1:return a=s.sent(),[2,a.as(St$1).reactionEvent]}}))}))},l.prototype.deleteReaction=function(e,n){return r(this,void 0,void 0,(function(){var r,i$1,a;return i(this,(function(s){switch(s.label){case 0:return at$2(e instanceof qt$2&&e.messageId>0&&y("string",n)).throw(p.invalidParameters),r=St$2.of(this._iid).requestQueue,i$1=new bt$1({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:n}),[4,r.send(i$1)];case 1:return a=s.sent(),[2,a.as(Ct$1).reactionEvent]}}))}))},l.prototype._updateMessageMetaArray=function(e,t,n,r$1){return r(this,void 0,void 0,(function(){var i$1,a,s,o,u,c;return i(this,(function(l){switch(l.label){case 0:return i$1=St$2.of(this._iid),a=i$1.dispatcher,s=i$1.requestQueue,o=new _t$1({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r$1}}),[4,s.send(o)];case 1:return u=l.sent(),c=u.as(Tt$1).message,a.dispatch(new un$2({messages:[c],source:$t$1.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},l.prototype.createMessageMetaArrayKeys=function(e,t){return r(this,void 0,void 0,(function(){var n;return i(this,(function(i){return at$2(e instanceof xt$1&&e.messageId>0&&E("string",t)).throw(p.invalidParameters),n=t.map((function(e){return new Dt$2({key:e})})),[2,this._updateMessageMetaArray(e.messageId,n,"add",!0)]}))}))},l.prototype.deleteMessageMetaArrayKeys=function(e,t){return r(this,void 0,void 0,(function(){var n;return i(this,(function(i){return at$2(e instanceof xt$1&&e.messageId>0&&E("string",t)).throw(p.invalidParameters),n=t.map((function(e){return new Dt$2({key:e})})),[2,this._updateMessageMetaArray(e.messageId,n,"remove",!0)]}))}))},l.prototype.addMessageMetaArrayValues=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){return at$2(e instanceof xt$1&&e.messageId>0&&t.every((function(e){return e instanceof Dt$2}))).throw(p.invalidParameters),[2,this._updateMessageMetaArray(e.messageId,t,"add",!0)]}))}))},l.prototype.removeMessageMetaArrayValues=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){return at$2(e instanceof xt$1&&e.messageId>0&&t.every((function(e){return e instanceof Dt$2}))).throw(p.invalidParameters),[2,this._updateMessageMetaArray(e.messageId,t,"remove",!0)]}))}))},l.prototype.report=function(e,r$1){return r(this,void 0,void 0,(function(){var i$1,a,s,o;return i(this,(function(u){switch(u.label){case 0:return at$2(m(_e$1,e)&&y("string",r$1)).throw(p.invalidParameters),i$1=St$2.of(this._iid),a=i$1.sdkState,s=i$1.requestQueue,o=new ft$1({channelUrl:this.url,channelType:this.channelType,userId:a.userId,category:e,description:r$1}),[4,s.send(o)];case 1:return u.sent(),[2]}}))}))},l.prototype.reportUser=function(e,r$1,a){return r(this,void 0,void 0,(function(){var s,o,u,c;return i(this,(function(l){switch(l.label){case 0:return at$2(e instanceof ct$2&&m(_e$1,r$1)&&y("string",a)).throw(p.invalidParameters),s=St$2.of(this._iid),o=s.sdkState,u=s.requestQueue,c=new mt$1({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:e.userId,category:r$1,description:a}),[4,u.send(c)];case 1:return l.sent(),[2]}}))}))},l.prototype.reportMessage=function(e,r$1,i$1){return r(this,void 0,void 0,(function(){var a,s,o,u;return i(this,(function(c){switch(c.label){case 0:return at$2(e instanceof xt$1&&m(_e$1,r$1)&&y("string",i$1)).throw(p.invalidParameters),a=St$2.of(this._iid),s=a.sdkState,o=a.requestQueue,u=new vt$1({channelUrl:this.url,channelType:this.channelType,userId:s.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:r$1,description:i$1}),[4,o.send(u)];case 1:return c.sent(),[2]}}))}))},l}(Le$2);var B,H$1,z,q;!function(e){e.SUCCESS="success",e.PENDING="pending",e.ERROR="error";}(B||(B={})),function(e){e.DEFAULT="default",e.ALL="all",e.MENTION_ONLY="mention_only",e.OFF="off";}(H$1||(H$1={})),function(e){e.FCM="gcm",e.APNS="apns",e.UNKNOWN="unknown";}(z||(z={})),function(e){e.ALTERNATIVE="alternative",e.DEFAULT="default";}(q||(q={}));var K,G,Q,W="GroupChannel",V="url",J="Message",X="messageId";!function(e){e.LATEST_LAST_MESSAGE="latest_last_message",e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";}(K||(K={})),function(e){e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";}(G||(G={})),function(e){e.CREATED_AT="created_at",e.SCHEDULED_AT="scheduled_at";}(Q||(Q={}));var Z,$=function(e){switch(e){case K.LATEST_LAST_MESSAGE:return ["-lastMessageUpdatedAt","-createdAt","syncIndex"];case K.CHRONOLOGICAL:return ["-createdAt","syncIndex"];case K.CHANNEL_NAME_ALPHABETICAL:return ["name"]}},ee=function(){function r(){this.messageTypeFilter=se$1.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=ue$2.NONE;}return r.prototype.clone=function(){var e=new r,t=JSON.parse(JSON.stringify(this));return Object.keys(t).forEach((function(s){e[s]=t[s];})),e},r.prototype.match=function(r){switch(this.messageTypeFilter){case se$1.USER:if(r.messageType!==ie.USER)return !1;break;case se$1.FILE:if(r.messageType!==ie.FILE)return !1;break;case se$1.ADMIN:if(r.messageType!==ie.ADMIN)return !1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(r.customType))return !1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(r instanceof xt$1))return !1;if(!this.senderUserIdsFilter.includes(r.sender.userId))return !1}switch(this.replyType){case ue$2.NONE:if(r.parentMessageId>0)return !1;break;case ue$2.ONLY_REPLY_TO_CHANNEL:if(r instanceof xt$1&&r.parentMessageId>0&&!r.replyToChannel)return !1}return !0},r}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message";}(Z||(Z={}));var te,se=function(e){switch(e){case Z.CHANNEL_LATEST:return ["channelUrl","-createdAt","-messageId"];case Z.NEWEST_CHILD_MESSAGE:return ["channelUrl","-parentMessageId","-createdAt","-messageId"]}};n(n({},de$1),{scheduledAt:null});n(n({},ue$1),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1});var ce="UnsentMessage",oe="reqId",le={},ue=function(e){function t$1(t,s){var n=s.sdkState,r=s.cacheContext,a=e.call(this,t)||this;return a._sdkState=n,a._cacheContext=r,le[t]=a,a}return t(t$1,e),t$1.of=function(e){return le[e]},Object.defineProperty(t$1.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(t$1.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t$1.prototype._serialize=function(e){if(e.messageId>0)throw p.invalidParameters;var t,s=n({},e.serialize());return e instanceof Vt$1?(e.messageParams&&(s.messageParams=le$1(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(s.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,n(n({},le$1(t)),{scheduledAt:t.scheduledAt})))):e instanceof Wt$1&&(e.messageParams&&(s.messageParams=ve$1(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(s.scheduledInfo.scheduledMessageParams=function(e){return n(n({},ve$1(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))),s},t$1.prototype._deserialize=function(e){return e?(e=n(n({},e),{messageId:parseInt(e.messageId)}),En$2.of(this._iid).buildMessageFromSerializedData(e)):null},t$1.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=s.sent())return [2,this._deserialize(t)];s.label=2;case 2:return [2,null]}}))}))},t$1.prototype.fetch=function(e){var t=e.channelUrl,s=void 0===t?null:t,n=e.filter,r$1=void 0===n?new ee:n,a=e.order,i$1=void 0===a?Z.CHANNEL_LATEST:a,c=e.sendingStatus,o=void 0===c?null:c,g=e.backward,p=void 0!==g&&g,m=e.parentMessageId,v=void 0===m?null:m;return r(this,void 0,void 0,(function(){var e,t,n,a,c=this;return i(this,(function(g){switch(g.label){case 0:return this.localCacheEnabled?(e=se(i$1),t={"/where":function(e){return !!(i$1!==Z.NEWEST_CHILD_MESSAGE||v&&0!==e.parentMessageId&&e.parentMessageId===v)&&r$1.match(c._deserialize(e))}},s&&(t.channelUrl=s),o&&(t.sendingStatus=o),n={where:t,index:e,backward:p},[4,this.collection.query(n)]):[3,3];case 1:return [4,g.sent().fetch({})];case 2:return a=g.sent(),[2,Promise.all(a.map((function(e){return r(c,void 0,void 0,(function(){var t,s,n,r,a,i$1;return i(this,(function(c){switch(c.label){case 0:return t=En$2.of(this._iid),s=this._deserialize(e),(n=e.messageParams)?s instanceof Vt$1?(s.messageParams=t.buildUserMessageCreateParamsFromSerializedData(n,s),[3,4]):[3,1]:[3,4];case 1:return s instanceof Wt$1?n.fileKey&&"string"==typeof n.fileKey&&me$1(n.fileType)?(r=n,[4,this.collection.getBlob(n.fileKey)]):[3,3]:[3,4];case 2:r.file=c.sent(),c.label=3;case 3:s.messageParams=t.buildFileMessageCreateParamsFromSerializedData(n,s),c.label=4;case 4:return s.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?s instanceof Vt$1?(a=e.scheduledInfo.scheduledMessageParams,s.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(a,s),[3,8]):[3,5]:[3,8];case 5:return s instanceof Wt$1?(a=e.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof a.fileKey&&me$1(a.fileType)?(i$1=a,[4,this.collection.getBlob(a.fileKey)]):[3,7]:[3,8];case 6:i$1.file=c.sent(),c.label=7;case 7:s.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(a,s),c.label=8;case 8:return [2,s]}}))}))})))];case 3:return [2,[]]}}))}))},t$1.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new ee),r(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return [4,this.fetch({filter:t,order:Z.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return [2,s.sent()]}}))}))},t$1.prototype.upsert=function(e){return r(this,void 0,void 0,(function(){var t,s=this;return i(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,3];case 1:return n.sent(),t=e.map((function(e){return s._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:n.sent(),n.label=3;case 3:return [2]}}))}))},t$1.prototype.upsertChildMessages=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,s;return i(this,(function(n){switch(n.label){case 0:return t=[],(null===(s=e.threadInfo)||void 0===s?void 0:s.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=n.sent(),n.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:n.sent(),n.label=4;case 4:return [2]}}))}))})))]:[3,2];case 1:s.sent(),s.label=2;case 2:return [2]}}))}))},t$1.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,s$1,n,r,a,i$1;return i(this,(function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return [3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),t=s(e),s$1=t.next(),c.label=2;case 2:return s$1.done?[3,5]:(n=s$1.value,[4,this.collection.remove(n)]);case 3:c.sent(),c.label=4;case 4:return s$1=t.next(),[3,2];case 5:return [3,8];case 6:return r=c.sent(),a={error:r},[3,8];case 7:try{s$1&&!s$1.done&&(i$1=t.return)&&i$1.call(t);}finally{if(a)throw a.error}return [7];case 8:return [2]}}))}))},t$1.prototype.removeMessagesOfChannel=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return [2]}}))}))},t$1.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return [2]}}))}))},t$1.prototype.saveBlobs=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(s){switch(s.label){case 0:return [4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,s,n;return i(this,(function(r){switch(r.label){case 0:return e instanceof Wt$1?e.messageParams&&(t=e.messageParams).file&&fe$1(t.file)?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2]:[3,4];case 1:n=r.sent(),t.fileKey=n,t.fileType=oe$1.BLOB,r.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&((s=e.scheduledInfo.scheduledMessageParams).file&&fe$1(s.file))?[4,this.collection.saveBlob(s.file,e.reqId)]:[3,4];case 3:n=r.sent(),s.fileKey=n,s.fileType=oe$1.BLOB,r.label=4;case 4:return [2]}}))}))})))];case 1:return s.sent(),[2]}}))}))},t$1}(Le$2),de={},he=function(e){function t$1(t,s){var n=s.sdkState,r=s.cacheContext,a=s.unsentMessageCache,i=e.call(this,t)||this;return i._sdkState=n,i._cacheContext=r,i._unsentMessageCache=a,de[t]=i,i}return t(t$1,e),t$1.of=function(e){return de[e]},Object.defineProperty(t$1.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(t$1.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t$1.prototype._serialize=function(e){return n(n({},e.serialize()),{messageId:"".concat(e.messageId)})},t$1.prototype._deserialize=function(e){return e=n(n({},e),{messageId:parseInt(e.messageId)}),En$2.of(this._iid).buildMessageFromSerializedData(e)},t$1.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=s.sent())return [2,this._deserialize(t)];s.label=2;case 2:return [2,null]}}))}))},t$1.prototype.fetch=function(e){var t=e.channelUrl,s=e.token,n=e.limit,r$1=void 0===n?100:n,a=e.filter,i$1=void 0===a?new ee:a,c=e.order,o=void 0===c?Z.CHANNEL_LATEST:c,d=e.backward,g=void 0!==d&&d,p=e.parentMessageId,m=void 0===p?null:p;return r(this,void 0,void 0,(function(){var e,n,a,c=this;return i(this,(function(d){switch(d.label){case 0:return this.localCacheEnabled?(e=se(o),n={where:{channelUrl:t,"/where":function(e){if(s)switch(o){case Z.CHANNEL_LATEST:if(!g&&e.createdAt>s||g&&e.createdAt<s)return !1;break;case Z.NEWEST_CHILD_MESSAGE:if(!m||0===e.parentMessageId||e.parentMessageId!==m)return !1}return i$1.match(c._deserialize(e))}},index:e,backward:g},[4,this.collection.query(n)]):[3,3];case 1:return [4,d.sent().fetch({limit:r$1})];case 2:return a=d.sent(),[2,Promise.all(a.map((function(e){return r(c,void 0,void 0,(function(){var t,s,n;return i(this,(function(r){switch(r.label){case 0:return t=this._deserialize(e),(s=e.messageParams)?t instanceof Vt$1?(t.messageParams=s,[3,4]):[3,1]:[3,4];case 1:return t instanceof Wt$1?s.fileKey&&"string"==typeof s.fileKey&&me$1(s.fileType)?(n=s,[4,this.collection.getBlob(s.fileKey)]):[3,3]:[3,4];case 2:n.file=r.sent(),r.label=3;case 3:t.messageParams=s,r.label=4;case 4:return [2,t]}}))}))})))];case 3:return [2,[]]}}))}))},t$1.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new ee),r(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return [4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:Z.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return [2,s.sent()]}}))}))},t$1.prototype.upsert=function(e){return r(this,void 0,void 0,(function(){var t,s=this;return i(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return n.sent(),t=e.map((function(e){return s._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:return n.sent(),[4,this.upsertChildMessages(e)];case 3:return n.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:n.sent(),n.label=5;case 5:return [2]}}))}))},t$1.prototype.upsertChildMessages=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,s;return i(this,(function(n){switch(n.label){case 0:return t=[],(null===(s=e.threadInfo)||void 0===s?void 0:s.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=n.sent(),n.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:n.sent(),n.label=4;case 4:return [2]}}))}))})))]:[3,2];case 1:s.sent(),s.label=2;case 2:return [2]}}))}))},t$1.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,s$1,n,r,a,i$1;return i(this,(function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return [3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),t=s(e),s$1=t.next(),c.label=2;case 2:return s$1.done?[3,5]:(n=s$1.value,[4,this.collection.remove("".concat(n))]);case 3:c.sent(),c.label=4;case 4:return s$1=t.next(),[3,2];case 5:return [3,8];case 6:return r=c.sent(),a={error:r},[3,8];case 7:try{s$1&&!s$1.done&&(i$1=t.return)&&i$1.call(t);}finally{if(a)throw a.error}return [7];case 8:return [2]}}))}))},t$1.prototype.removeMessagesOfChannel=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:se(Z.CHANNEL_LATEST)})]:[3,6];case 1:return s.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return s.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return s.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return s.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:s.sent(),s.label=6;case 6:return [2]}}))}))},t$1.prototype.removeUnderOffset=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:se(Z.CHANNEL_LATEST)})]:[3,2];case 1:s.sent(),s.label=2;case 2:return [2]}}))}))},t$1.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return [2]}}))}))},t$1.prototype.countBetween=function(e,t,s){return r(this,void 0,void 0,(function(){var n,r=this;return i(this,(function(a){switch(a.label){case 0:return this.localCacheEnabled?(n=se(Z.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var n=r._deserialize(e);return s.includes(n.createdAt)&&t.match(n)}},index:n}).count()]):[3,2];case 1:return [2,a.sent()];case 2:return [2,0]}}))}))},t$1.prototype.saveBlobs=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(s){switch(s.label){case 0:return [4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,s;return i(this,(function(n){switch(n.label){case 0:return e instanceof Wt$1&&e.messageParams&&((t=e.messageParams).file&&fe$1(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:s=n.sent(),t.fileKey=s,n.label=2;case 2:return [2]}}))}))})))];case 1:return s.sent(),[2]}}))}))},t$1}(Le$2),fe=function(e){function t$1(t){var s=t.message,n=e.call(this)||this;return n.message=s,n}return t(t$1,e),t$1}(L),ge={},pe=function(){function e(e,t){var s=t.localCacheEnabled,n=t.dispatcher,r=t.sdkState,a=t.logger,i=this;ge[e]=this,this._iid=e,ge[e]=this,this._localCacheEnabled=s,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=n,this._logger=a,this._sdkState=r,this._localCacheEnabled&&n.on((function(e){if(e instanceof de$2)switch(e.stateType){case J$1.CONNECTED:i._isProcessingAutoResend||i.processAutoResendRegisteredPendingMessages().then((function(){return i._processNextAutoResend()}));break;case J$1.DISCONNECTED:i._isProcessingAutoResend=!1;}}));}return e.of=function(e){return ge[e]},e.prototype.processNonAutoResendRegisteredPendingMessages=function(){return r(this,void 0,void 0,(function(){var e,t,s$1,n,r,a;return i(this,(function(i){switch(i.label){case 0:return [4,this._fetchAllCachedPendingMessages()];case 1:e=i.sent();try{for(t=s(e),s$1=t.next();!s$1.done;s$1=t.next())0===(n=s$1.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",n.reqId),n.sendingStatus=le$2.FAILED,n.errorCode=u.ACK_TIMEOUT,this._dispatcher.dispatch(new un$2({messages:[n],source:$t$1.LOCAL_MESSAGE_FAILED})));}catch(e){r={error:e};}finally{try{s$1&&!s$1.done&&(a=t.return)&&a.call(t);}finally{if(r)throw r.error}}return [2]}}))}))},e.prototype.processAutoResendRegisteredPendingMessages=function(){return r(this,void 0,void 0,(function(){var e,t,s$1,n,r,a,i$1,c;return i(this,(function(o){switch(o.label){case 0:return [4,this._fetchAllCachedPendingMessages()];case 1:e=o.sent();try{for(t=s(e),s$1=t.next();!s$1.done;s$1=t.next())(n=s$1.value).errorCode&&I(n.errorCode)&&(r=(new Date).getTime(),a=n.createdAt+2592e5,r<=a?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(n.reqId)<0&&this._autoResendQueue.push(n):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),n.sendingStatus=le$2.FAILED,this._dispatcher.dispatch(new un$2({messages:[n],source:$t$1.LOCAL_MESSAGE_FAILED}))));}catch(e){i$1={error:e};}finally{try{s$1&&!s$1.done&&(c=t.return)&&c.call(t);}finally{if(i$1)throw i$1.error}}return [2]}}))}))},e.prototype.completeCurrentAndProcessNextAutoResend=function(e){if(this._localCacheEnabled&&(e.sendingStatus===le$2.SUCCEEDED||e.sendingStatus===le$2.FAILED&&!I(e.errorCode))){var t=this.indexOf(e);t>=0&&this._autoResendQueue.splice(t,1),0===t&&this._processNextAutoResend();}},e.prototype._fetchAllCachedPendingMessages=function(){return r(this,void 0,void 0,(function(){var e,t;return i(this,(function(s){switch(s.label){case 0:return (e=ue.of(this._iid))?[4,e.fetch({sendingStatus:le$2.PENDING,backward:!0})]:[3,2];case 1:return t=s.sent(),[3,3];case 2:t=[],s.label=3;case 3:return [2,t]}}))}))},e.prototype.indexOf=function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1},e.prototype._isNotInQueue=function(e){return -1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)},e.prototype._processNextAutoResend=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),e=this._autoResendQueue[0],this._dispatcher.dispatch(new fe({message:e})),this._logger.debug("processing auto-resend for message request id: ",e.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1);}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1;}return [2]}))}))},e}();!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED";}(te||(te={}));var me=function(){function e(e){this.category=e.cat,this.data=e.data;}return e.getDataAsUserBlockEvent=function(e,t){var s=t.data,n=s.blocker,r=s.blockee;return {blocker:new ct$2(e,n),blockee:new ct$2(e,r)}},e.getDataAsFriendDiscoveredEvent=function(e,t){var s=t.data.friend_discoveries;return {friendDiscoveries:Array.isArray(s)?s.map((function(t){return new ct$2(e,t)})):[]}},e}(),ve=function(e){function t$1(t,s){var n=s.userId,r=e.call(this)||this;return r._iid=t,r.userId=n,r}return t(t$1,e),t$1}(L),be=function(e){function t$1(t,s,n){var r=e.call(this,t,"USEV",n)||this;return r.event=new me(n),r}return t(t$1,e),t$1}(B$1),_e=function(e){function t$1(t){var s=t.userId,n=e.call(this)||this;return n.method=d$1.GET,n.path="".concat(Ue$2,"/").concat(encodeURIComponent(s),"/push_preference"),n}return t(t$1,e),t$1}(q$1),Ee=function(e){function t$1(t,s){var n=e.call(this,t,s)||this;return n.pushTriggerOption=s.push_trigger_option,n}return t(t$1,e),t$1}(F),Ae$1=function(e){function t$1(t){var s=t.userId,n=t.pushTriggerOption,r=e.call(this)||this;return r.method=d$1.PUT,r.path="".concat(Ue$2,"/").concat(encodeURIComponent(s),"/push_preference"),r.params={push_trigger_option:n},r}return t(t$1,e),t$1}(q$1),ye=function(e){function t$1(t,s){var n=e.call(this,t,s)||this;return n.pushTriggerOption=s.push_trigger_option,n}return t(t$1,e),t$1}(F);var Re={profileImage:null,profileUrl:null,nickname:null},Le=function(){this.onSessionExpired=Y,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=Y,this.onSessionRefreshed=Y,this.onSessionClosed=Y;},Pe=function(){this.onConnected=Y,this.onReconnectStarted=Y,this.onReconnectSucceeded=Y,this.onReconnectFailed=Y,this.onDisconnected=Y;},Ae=function(){this.onFriendsDiscovered=Y,this.onTotalUnreadMessageCountUpdated=Y;};!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(Le$2);var De=function(e){function t$1(){var t=e.call(this)||this;return t._pauseDelayTimer=null,t._currentState="visible",t._toggleState=t._toggleState.bind(t),t}return t(t$1,e),Object.defineProperty(t$1.prototype,"isAvailable",{get:function(){return "undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),t$1.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=null,e.dispatch("pause");}),3e4)),this._currentState=document.visibilityState;},t$1.prototype.start=function(){this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0});},t$1.prototype.stop=function(){this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0});},t$1}(M),Me=function(){function e(e){var t=e.logger,n=e.connectionDelegate,r=void 0===n?null:n;this.logger=t,r&&(this.connectionDelegate=r),this._onlineWorker=this._onlineWorker.bind(this),this._offlineWorker=this._offlineWorker.bind(this);}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return "undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),e.prototype._onlineWorker=function(){this.connectionDelegate.reconnect();},e.prototype._offlineWorker=function(){this.connectionDelegate.disconnect();},e.prototype.start=function(){this.isAvailable&&(window.addEventListener("online",this._onlineWorker),window.addEventListener("offline",this._offlineWorker));},e.prototype.stop=function(){this.isAvailable&&(window.removeEventListener("online",this._onlineWorker,!1),window.removeEventListener("offline",this._offlineWorker,!1));},e.prototype.isOnline=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return this.isAvailable?[2,navigator.onLine]:[2,new Promise((function(e,t){fetch("https://www.google.com",{method:d$1.GET}).then((function(){return e(!0)})).catch((function(){return e(!1)}));}))]}))}))},e}(),Ue=function(e){function t$1(t){var n=t.userId,r=t.nickname,i=void 0===r?null:r,s=t.profileUrl,o=void 0===s?null:s,a=t.profileImage,u=void 0===a?null:a,c=t.preferredLanguages,l=void 0===c?null:c,h=e.call(this)||this;return h.method=d$1.PUT,h.path="".concat(Ue$2,"/").concat(encodeURIComponent(n)),h.params=U$1({nickname:i,profile_url:o,profile_file:u,preferred_languages:l}),h}return t(t$1,e),t$1}(q$1),qe=function(e){function t$1(t,n$1){var r=e.call(this,t,n$1)||this;return r.user=null,r.user=new ct$2(t,n({},n$1)),r}return t(t$1,e),t$1}(F),Be=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d$1.POST,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/apns"),i.params={apns_device_token:r,always_push:!0},i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.type=n.type?z[n.type.toLowerCase()]:z.UNKNOWN,r.user=new ct$2(t,n.user),r}t(t$1,e);}(F);var Fe=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d$1.POST,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/gcm"),i.params={gcm_reg_token:r,always_push:!0},i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.type=n.type?z[n.type.toLowerCase()]:z.UNKNOWN,r.user=new ct$2(t,n.user),r}t(t$1,e);}(F);var Ke=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d$1.DELETE,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/apns/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new ct$2(t,n.user),r}t(t$1,e);}(F);var je=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d$1.DELETE,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/gcm/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new ct$2(t,n.user),r}t(t$1,e);}(F);var He=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d$1.DELETE,r.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/apns"),r}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.type=n.type?z[n.type.toLowerCase()]:z.UNKNOWN,r.user=new ct$2(t,n.user),r}t(t$1,e);}(F);var Ve=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d$1.DELETE,r.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/gcm"),r}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.type=n.type?z[n.type.toLowerCase()]:z.UNKNOWN,r.user=new ct$2(t,n.user),r}t(t$1,e);}(F);var We=function(e){function t$1(t){var n=t.userId,r=t.type,i=t.token,s=t.ts,o=e.call(this)||this;return o.method=d$1.GET,o.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/").concat(encodeURIComponent(r),"/device_tokens"),o.params={created_ts:s,token:i},o}return t(t$1,e),t$1}(q$1),ze=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.pushTokens={type:n.type?z[n.type.toLowerCase()]:z.UNKNOWN,deviceTokens:n.device_tokens,hasMore:n.has_more,token:n.token},r}return t(t$1,e),t$1}(F),Qe=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d$1.GET,r.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),r}return t(t$1,e),t$1}(q$1),Ge=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return t(t$1,e),t$1}(F),Ye=function(e){function t$1(t){var n=t.userId,r=t.willAutoAccept,i=e.call(this)||this;return i.method=d$1.PUT,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),i.params={auto_accept:r},i}return t(t$1,e),t$1}(q$1),Je=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return t(t$1,e),t$1}(F),Xe=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d$1.GET,r.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push_preference"),r}return t(t$1,e),t$1}(q$1),Ze=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return t(t$1,e),t$1}(F),$e=function(e){function t$1(t){var n=t.userId,r=t.doNotDisturbOn,i=t.startHour,s=t.startMin,o=t.endHour,a=t.endMin,u=t.timezone,c=e.call(this)||this;return c.method=d$1.PUT,c.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push_preference"),c.params={do_not_disturb:r,start_hour:i,start_min:s,end_hour:o,end_min:a,timezone:u},c}return t(t$1,e),t$1}(q$1),et=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return t(t$1,e),t$1}(F),tt=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d$1.GET,r.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push_preference"),r}return t(t$1,e),t$1}(q$1),nt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return t(t$1,e),t$1}(F),rt=function(e){function t$1(t){var n=t.userId,r=t.snoozeOn,i=t.startTs,s=t.endTs,o=e.call(this)||this;return o.method=d$1.PUT,o.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push_preference"),o.params={snooze_enabled:r,snooze_start_ts:i,snooze_end_ts:s},o}return t(t$1,e),t$1}(q$1),it=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return t(t$1,e),t$1}(F),st=function(e){function t$1(t){var n=t.userId,r=t.blockedUserId,i=e.call(this)||this;return i.method=d$1.POST,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/block"),i.params={target_id:r},i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.user=new ct$2(t,n),r}t(t$1,e);}(F);var ot=function(e){function t$1(t){var n=t.userId,r=t.unblockedUserId,i=e.call(this)||this;return i.method=d$1.DELETE,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/block/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var at=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d$1.GET,r.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/template"),r}return t(t$1,e),t$1}(q$1),ut=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return t(t$1,e),t$1}(F),ct=function(e){function t$1(t){var n=t.userId,r=t.templateName,i=e.call(this)||this;return i.method=d$1.PUT,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/push/template"),i.params={name:r},i}return t(t$1,e),t$1}(q$1),lt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return t(t$1,e),t$1}(F),ht=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d$1.GET,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/friends/changelogs"),i.params={token:r},i}return t(t$1,e),t$1}(q$1),dt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.changelogs={addedUsers:n.added.map((function(e){return new ct$2(t,e)})),updatedUsers:n.updated.map((function(e){return new ct$2(t,e)})),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next},r}return t(t$1,e),t$1}(F),ft=function(e){function t$1(t){var n=t.userId,r=t.discoveries,i=e.call(this)||this;return i.method=d$1.PUT,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discoveries:r.map((function(e){return {friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},i}return t(t$1,e),t$1}(q$1),pt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.friendDiscoveryRequestId=n.friend_discovery_request_id,r}return t(t$1,e),t$1}(F),vt=function(e){function t$1(t){var n=t.userId,r=t.discoveryKeys,i=e.call(this)||this;return i.method=d$1.DELETE,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discovery_keys:r},i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var _t=function(e){function t$1(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=d$1.POST,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return t(t$1,e),t$1}(q$1),mt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ct$2(t,e)})),r}return t(t$1,e),t$1}(F),yt=function(e){function t$1(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=d$1.DELETE,i.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var bt=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d$1.GET,r.path="".concat(Ue$2,"/").concat(n,"/allow_friend_discovery"),r.params={},r}return t(t$1,e),t$1}(q$1),gt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.allowFriendDiscovery=n.allow_friend_discovery,r}return t(t$1,e),t$1}(F),It=function(e){function t$1(t){var n=t.userId,r=t.allowFriendDiscovery,i=e.call(this)||this;return i.method=d$1.PUT,i.path="".concat(Ue$2,"/").concat(n,"/allow_friend_discovery"),i.params={allow_friend_discovery:r},i}return t(t$1,e),t$1}(q$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var wt,Et=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url;},kt=function(e){var t,n,r;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!==(t=e.id)&&void 0!==t?t:0,this.name=null!==(n=e.name)&&void 0!==n?n:"",this.url=null!==(r=e.url)&&void 0!==r?r:"",this.emojis=e.emojis?e.emojis.map((function(e){return new Et(e)})):[];},Nt=function(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((function(e){return new kt(e)})):[];},Ot=function(e){function t$1(){var t=e.call(this)||this;return t.method=d$1.GET,t.path=ze$2,t}return t(t$1,e),t$1}(q$1),St=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emojiContainer=new Nt(n),r}return t(t$1,e),t$1}(F),Tt=function(e){function t$1(t){var n=t.categoryId,r=e.call(this)||this;return r.method=d$1.GET,r.path="".concat(ze$2,"/").concat(n),r}return t(t$1,e),t$1}(q$1),xt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emojiCategory=new kt(n),r}return t(t$1,e),t$1}(F),Ct=function(e){function t$1(t){var n=t.key,r=e.call(this)||this;return r.method=d$1.GET,r.path="".concat(Ke$2,"/").concat(n),r}return t(t$1,e),t$1}(q$1),Rt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emoji=new Et(n),r}return t(t$1,e),t$1}(F),Lt=function(e){function t$1(t){var n=t.limit,r=t.token,i=t.userIdsFilter,s=t.metaDataKeyFilter,o=t.metaDataValuesFilter,a=t.nicknameStartsWithFilter,u=e.call(this)||this;return u.method=d$1.GET,u.path=Ue$2,u.params=U$1({limit:n,token:r,user_ids:i,metadatakey:s,metadatavalues_in:o,nickname_startswith:a}),u}return t(t$1,e),t$1}(q$1),Pt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ct$2(t,e)})),r.next=n.next,r}return t(t$1,e),t$1}(F),At=function(e){function n$1(t,n){var r,i,s,o=this;return (o=e.call(this,t,n)||this).userIdsFilter=null,o.metaDataKeyFilter=null,o.metaDataValuesFilter=null,o.nicknameStartsWithFilter=null,o.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,o.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,o.metaDataValuesFilter=null!==(s=n.metaDataValuesFilter)&&void 0!==s?s:null,o.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,o}return t(n$1,e),n$1.prototype._validate=function(){return e.prototype._validate.call(this)&&E("string",this.userIdsFilter,!0)&&y("string",this.metaDataKeyFilter,!0)&&E("string",this.metaDataValuesFilter,!0)&&y("string",this.metaDataKeyFilter,!0)},n$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$2.of(this._iid).requestQueue,t=new Lt(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n$1=o.sent(),r=n$1.as(Pt),i$1=r.users,s=r.next,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i$1];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},n$1}(bn$1),Dt=function(e){function t$1(t){var n=t.userId,r=t.limit,i=t.token,s=t.userIdsFilter,o=e.call(this)||this;return o.method=d$1.GET,o.path="".concat(Ue$2,"/").concat(n,"/block"),o.params=U$1({limit:r,token:i,user_ids:s}),o}return t(t$1,e),t$1}(q$1),Mt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ct$2(t,e)})),r.next=n.next,r}return t(t$1,e),t$1}(F),Ut=function(e){function t$1(t,n){var r,i=this;return (i=e.call(this,t,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return t(t$1,e),t$1.prototype._validate=function(){return e.prototype._validate.call(this)&&E("string",this.userIdsFilter,!0)},t$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,s,o,a;return i(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$2.of(this._iid),t=e.sdkState,n$1=e.requestQueue,r=new Dt(n(n({},this),{userId:t.userId,token:this._token})),[4,n$1.send(r)]):[3,2]:[3,5];case 1:return i$1=u.sent(),s=i$1.as(Mt),o=s.users,a=s.next,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},t$1}(bn$1),qt=function(e){function t$1(t){var n=t.userId,r=t.limit,i=t.token,s=e.call(this)||this;return s.method=d$1.GET,s.path="".concat(Ue$2,"/").concat(encodeURIComponent(n),"/friends"),s.params={limit:r,token:i},s}return t(t$1,e),t$1}(q$1),Bt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(e){return new ct$2(t,e)})),r.next=n.next,r}return t(t$1,e),t$1}(F),Ft=function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}return t(t$1,e),t$1.prototype._validate=function(){return e.prototype._validate.call(this)},t$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$2.of(this._iid),t=e.sdkState,n$1=e.requestQueue,r=new qt(n(n({},this),{userId:t.userId,token:this._token})),[4,n$1.send(r)]):[3,2]:[3,5];case 1:return i$1=c.sent(),s=i$1.as(Bt),o=s.users,a=s.hasMore,u=s.next,this._token=u,this._hasNext=a,this._isLoading=!1,[2,o];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},t$1}(bn$1),Kt={},jt=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,s=void 0===i?256:i,o=e.blockHashBase,a=void 0===o?2:o,u=e.blockHashMultiplier,c=void 0===u?10:u,l=e.blockHashConstant,h=void 0===l?11:l,d=e.transactionApplyDelay,f=void 0===d?200:d,p=e.disableLogger,v=void 0!==p&&p;return Kt[t]||(this.itemSizeLimit=r,this.cacheLimit=s,this.blockHashBase=a,this.blockHashMultiplier=c,this.blockHashConstant=h,this.transactionApplyDelay=f,this.disableLogger=v,Kt[t]=this),Kt[t]}return e.get=function(e){return Kt[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND";}(wt||(wt={}));var Ht,Vt=function(e){function t$1(n){var r=n.code,i=void 0===r?wt.UNKNOWN_ERROR:r,s=n.message,o=void 0===s?"Unknown error occurred.":s,a=e.call(this,o)||this;return a.code=i,Object.setPrototypeOf(a,t$1.prototype),a}return t(t$1,e),Object.defineProperty(t$1,"storeNotDefined",{get:function(){return new t$1({code:wt.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeNotAvailable",{get:function(){return new t$1({code:wt.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeNotAvailableInPrivateBrowsing",{get:function(){return new t$1({code:wt.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeIsFull",{get:function(){return new t$1({code:wt.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeKeyTypeIsInvalid",{get:function(){return new t$1({code:wt.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeBrokenIntegrity",{get:function(){return new t$1({code:wt.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeBrokenBlob",{get:function(){return new t$1({code:wt.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeEncryptionInvalid",{get:function(){return new t$1({code:wt.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeItemSizeExceeded",{get:function(){return new t$1({code:wt.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeReadFailed",{get:function(){return new t$1({code:wt.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeWriteFailed",{get:function(){return new t$1({code:wt.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"databaseSchemaNotOnUpgrade",{get:function(){return new t$1({code:wt.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionNotReady",{get:function(){return new t$1({code:wt.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionKeyNotMatch",{get:function(){return new t$1({code:wt.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionQueryNotValid",{get:function(){return new t$1({code:wt.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionInsertDuplicate",{get:function(){return new t$1({code:wt.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionKeyNotFound",{get:function(){return new t$1({code:wt.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionKeyNotGiven",{get:function(){return new t$1({code:wt.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionWriteFailed",{get:function(){return new t$1({code:wt.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionItemSizeExceeded",{get:function(){return new t$1({code:wt.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"indexTableIsRequired",{get:function(){return new t$1({code:wt.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"indexTypesNotMatch",{get:function(){return new t$1({code:wt.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"compareTypesNotMatch",{get:function(){return new t$1({code:wt.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"circularReferenceFound",{get:function(){return new t$1({code:wt.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),t$1}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed";}(Ht||(Ht={}));var Wt,zt=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw Vt.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map((function(e){return zt(e,t)}));else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=zt(e[r],t);return t.delete(e),n}return e},Qt=function(e,t){if(null==t)return 1;if(null==e)return -1;if(typeof e!=typeof t)throw Vt.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t);}return n},Gt=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return (n>>>0)%t},Yt=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e);}))},Jt=function(e,t){if(!t)return !1;if("function"!=typeof e){for(var n in e){if(["/and","&&"].includes(n)){if(e[n].some((function(e){return !Jt(e,t)})))return !1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return !Jt(e,t)})))return !1}else if("/where"===n){if(!(0, e[n])(t))return !1}else {var r=n;if("object"==typeof e[r]){var i=e[r];for(var s in i)switch(s){case"/eq":case"=":if((o=t[r])!==(a=i[s]))return !1;break;case"/neq":case"!=":if((o=t[r])===(a=i[s]))return !1;break;case"/gt":case">":var o=t[r],a=i[s];if(!(Qt(o,a)>0))return !1;break;case"/gte":case">=":o=t[r],a=i[s];if(!(Qt(o,a)>=0))return !1;break;case"/lt":case"<":o=t[r],a=i[s];if(!(Qt(o,a)<0))return !1;break;case"/lte":case"<=":o=t[r],a=i[s];if(!(Qt(o,a)<=0))return !1;break;case"/in":o=t[r];if(!(a=i[s]).includes(o))return !1;break;case"/nin":o=t[r];if((a=i[s]).includes(o))return !1;break;case"/contain":o=t[r],a=i[s];if(!o.includes(a))return !1;break;case"/regex":o=t[r];if(!(a=i[s]).test(o))return !1;break;case"/where":o=t[r];if(!(0, i[s])(o))return !1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return !1}else if(e[r]!==t[r])return !1}}return !0}return e(t)},Xt=function(){},Zt=function(){return Promise.resolve()},$t=function(e){return e},en$1=function(e,t){t(null);};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD";}(Wt||(Wt={}));var tn$1,nn,rn$1,sn$1=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,s=e.iterator,o=e.map,a=void 0===o?$t:o,u=e.backward,c=void 0===u?Zt:u,l=e.forward,h=void 0===l?Zt:l,d=e.complete,f=void 0===d?Xt:d;this._prevValue=n,this._nextValue=i,this._error=null,this._map=a,this._backward=c,this._forward=h,this._iterator=s,this._complete=f;}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return !!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return !!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return [3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return [4,this._iterator(this)];case 5:return [2,r.sent()];case 6:this._complete(),r.label=7;case 7:return [2]}}))}))},e.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return [3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return [4,this._iterator(this)];case 5:return [2,r.sent()];case 6:this._complete(),r.label=7;case 7:return [2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete();},e}(),on$1=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.blockManager,o=e.indexer;this.condition=n,this.backward=i,this._blockManager=s,this._indexer=o;}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var s=this._indexer.fields[i],o=1;if("-"===s[0]&&(s=s.slice(1),o=-1),this.condition[s])if("object"==typeof this.condition[s]){var a=o>0?n:t;for(var u in this.condition[s])if(a.includes(u))for(var c=r;c>=0;c--)if(o*Qt(this._indexer.origin[c].columnValues[i],this.condition[s][u])<=0){r=c;break}}else for(c=r;c>=0;c--)if(o*Qt(this._indexer.origin[c].columnValues[i],this.condition[s])<=0){r=c;break}}return Math.min(r+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=function(r){var i=d._indexer.fields[r],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),d.condition[i])if("object"==typeof d.condition[i])Object.keys(d.condition[i]).forEach((function(o){if((s>0?t:n).includes(o))for(var a=l;a<e._indexer.origin.length;a++)if(s*Qt(e._indexer.origin[a].columnValues[r],e.condition[i][o])>=0){l=a;break}}));else for(var o=l;o<d._indexer.origin.length;o++)if(s*Qt(d._indexer.origin[o].columnValues[r],d.condition[i])>=0){l=o;break}},d=this,i=0;i<this._indexer.fields.length;i++)h(i);return Math.max(l-1,0)},e.prototype.each=function(e){return r(this,void 0,void 0,(function(){var t,n,r$1,i$1,s,o,a,c=this;return i(this,(function(l){switch(l.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r$1=function(){if(c._indexer.origin[t]){if(!c._indexer.origin[t].keys[++n]){if(!c._indexer.origin[++t])return !1;n=0;}return !0}return !1},i$1=function(){if(c._indexer.origin[t]){if(!c._indexer.origin[t].keys[--n]){if(!c._indexer.origin[--t])return !1;n=c._indexer.origin[t].keys.length-1;}return !0}return !1},s=null,!this._indexer.origin[t])return [3,4];o=this.backward?i$1:r$1,l.label=1;case 1:return [4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if(a=l.sent(),Jt(this.condition,a))return s=a,[3,4];l.label=3;case 3:if(o())return [3,1];l.label=4;case 4:return [4,new Promise((function(o){var a=new sn$1({initialNextValue:zt(s),iterator:e,forward:function(){return r(c,void 0,void 0,(function(){var e,s;return i(this,(function(o){switch(o.label){case 0:e=this.backward?i$1:r$1,o.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return s=o.sent(),Jt(this.condition,s)?[2,zt(s)]:[3,1];case 3:return [2,null]}}))}))},backward:function(){return r(c,void 0,void 0,(function(){var e,s;return i(this,(function(o){switch(o.label){case 0:e=this.backward?r$1:i$1,o.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return s=o.sent(),Jt(this.condition,s)?[2,zt(s)]:[3,1];case 3:return [2,null]}}))}))},complete:o});e(a);}))];case 5:return [2,l.sent()]}}))}))},e}(),an$1=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.mutex,o=e.blockManager,a=e.indexer;this._mutex=s,this._iterator=new on$1({condition:n,backward:i,blockManager:o,indexer:a});}return e.prototype.fetch=function(e){return void 0===e&&(e={}),r(this,void 0,void 0,(function(){var t,n,r$1,i$1,s=this;return i(this,(function(o){switch(o.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return [2,[]];if(n<0)throw Vt.collectionQueryNotValid;o.label=1;case 1:return o.trys.push([1,4,,5]),r$1=[],[4,this._mutex.lock()];case 2:return o.sent(),[4,this._iterator.each((function(e){return r(s,void 0,void 0,(function(){return i(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r$1.push(e.nextValue),0<n&&n<=r$1.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return o.sent(),this._mutex.unlock(),[2,r$1];case 4:throw i$1=o.sent(),this._mutex.unlock(),i$1;case 5:return [2]}}))}))},e.prototype.count=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return i(this,(function(r$1){switch(r$1.label){case 0:return r$1.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r$1.sent(),[4,this._iterator.each((function(t){return r(n,void 0,void 0,(function(){return i(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r$1.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r$1.sent(),this._mutex.unlock(),t;case 4:return [2]}}))}))},e}(),un$1=function(e){return "".concat("nest","@").concat(e)},cn$1=function(e,t){return "".concat(un$1(e),"/").concat(t)},ln$1=function(e,t){return "".concat(cn$1(e,t),".metadata")},hn$1=function(e,t){return "".concat(cn$1(e,t),"/block.")},dn$1=function(e,t){return "".concat(cn$1(e,t),"/blob.")},fn$1=function(e,t,n,r){return void 0===r&&(r=0),"".concat(dn$1(e,t)).concat(n,".").concat(r)},pn$1=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this._store=r;}return e.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(n>0){for(var r=Math.ceil(e.data.length/n),i="".concat(r,".").concat(e.type,".").concat(t),s=[],o=0;o<e.data.length;o+=n){var a=e.data.slice(o,o+n);s.push(a);}return {blobId:i,shards:s}}return {blobId:null,shards:null}},e.prototype._encode=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,new Promise((function(t){var n=new FileReader;n.onload=function(){t({data:n.result,type:e.type});},n.readAsDataURL(e);}))];case 1:return [2,t.sent()]}}))}))},e.prototype._decode=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return "undefined"==typeof fetch?[3,3]:[4,fetch(e.data)];case 1:return [4,a.sent().blob()];case 2:return [2,a.sent()];case 3:for(t=[],n=atob(e.data.split(",")[1]),r=0;r<n.length;r+=512){for(i$1=n.slice(r,r+512),s=new Array(i$1.length),o=0;o<i$1.length;o++)s[o]=i$1.charCodeAt(o);t.push(new Uint8Array(s));}return [2,new Blob(t,{type:e.type})]}}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o$1,a,u;return i(this,(function(c){switch(c.label){case 0:if(t=[],n=o(e.split("."),2),r=n[0],i$1=n[1],!((s=parseInt(r))>0))return [3,6];o$1=0,c.label=1;case 1:return o$1<s?(a=fn$1(this.dbname,this.collectionName,e,o$1),[4,this._store.get(a)]):[3,4];case 2:if(!(u=c.sent())||!u.d)throw Vt.storeBrokenBlob;t.push(u.d),c.label=3;case 3:return o$1++,[3,1];case 4:return [4,this._decode({data:t.join(""),type:i$1})];case 5:return [2,c.sent()];case 6:return [2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),r(this,void 0,void 0,(function(){var n,r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return n=[],[4,this._encode(e)];case 1:if(r=c.sent(),i$1=this._makeShards(r,t),s=i$1.blobId,o=i$1.shards,!s)return [3,3];for(a=0;a<o.length;a++)u=fn$1(this.dbname,this.collectionName,s,a),n.push({key:u,value:{d:o[a]},generation:1});return [4,this._store.setMany(n)];case 2:if(c.sent().some((function(e){return e instanceof Error})))throw Vt.storeWriteFailed;return [2,s];case 3:return [2,null]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s;return i(this,(function(o$1){switch(o$1.label){case 0:if(t=[],n=o(e.split("."),1),r=n[0],!((i$1=parseInt(r))>0))return [3,2];for(s=0;s<i$1;s++)t.push(fn$1(this.dbname,this.collectionName,e,s));return [4,this._store.removeMany(t)];case 1:o$1.sent(),o$1.label=2;case 2:return [2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,s$1,o,a;return i(this,(function(u){switch(u.label){case 0:return e=dn$1(this.dbname,this.collectionName),t=[],[4,this._store.getAllKeys()];case 1:n=u.sent();try{for(r=s(n),i$1=r.next();!i$1.done;i$1=r.next())(s$1=i$1.value).startsWith(e)&&t.push(s$1);}catch(e){o={error:e};}finally{try{i$1&&!i$1.done&&(a=r.return)&&a.call(r);}finally{if(o)throw o.error}}return [4,this._store.removeMany(n)];case 2:return u.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR";}(tn$1||(tn$1={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile";}(nn||(nn={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT";}(rn$1||(rn$1={}));var vn$1=[nn.PENDING,nn.VOLATILE],_n$1={},mn$1=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return _n$1[t]||(this.dbname=t,this._items=[],this._limit=r,_n$1[t]=this),_n$1[t]}return e.get=function(e){return _n$1[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=rn$1.DEFAULT),r(this,void 0,void 0,(function(){var r,i$1;return i(this,(function(s){switch(s.label){case 0:return (r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return (i$1=s.sent())&&(r={key:t,value:i$1,generation:1,state:n===rn$1.PERSISTENT?nn.PERSISTENT:nn.VOLATILE},this.put(r)),[3,3];case 2:n===rn$1.PERSISTENT&&(r.state=nn.PERSISTENT),s.label=3;case 3:return [2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=rn$1.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===rn$1.PERSISTENT&&(r.state=nn.PERSISTENT),t!==rn$1.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)vn$1.includes(this._items[r].state)&&vn$1.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else {this._items.push(e);var i=this._items.filter((function(e){return e.state===nn.VOLATILE})),s$1=i.length-this._limit;if(s$1>0){var o=[];try{for(var a=s(this._items),u=a.next();!u.done;u=a.next()){var c=u.value;c.state===nn.VOLATILE&&s$1>0?s$1--:o.push(c);}}catch(e){t={error:e};}finally{try{u&&!u.done&&(n=a.return)&&n.call(a);}finally{if(t)throw t.error}}this._items=o;}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1);},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return !e(t)}));},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==nn.VOLATILE}));},e}(),yn$1=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey=function(e,t){return "".concat(cn$1(e,t),"/trans.metadata")}(t,n),this.recordsetKey=function(e,t){return "".concat(cn$1(e,t),"/trans.recordset")}(t,n),this._store=r;}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return [4,this._store.get(this.recordsetKey)];case 1:return (t=n.sent()||[]).push.apply(t,a([],o(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],s=[],o=i.requests.length-1;o>=0;o--){var a=i.requests[o],u=a.data;n[u.key]||(s.unshift(a),n[u.key]=!0);}s.length>0&&(i.requests=s,t.unshift(i));}return t},e.prototype._applyRecord=function(e,t){return r(this,void 0,void 0,(function(){var n$1,r,i$1,s,o,a,u,c,l;return i(this,(function(h){switch(h.label){case 0:n$1=mn$1.get(this.dbname),r=t.generation,i$1=t.requests,s=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(i$1.map((function(e){return n(n({},e.data),{generation:r})})))];case 2:for(o=h.sent(),a=0;a<i$1.length;a++)o[a]instanceof Error&&(s||(s=o[a]),u=i$1[a].data,n$1.put(n(n({},u),{generation:r,state:nn.PERSISTENT})));return [3,4];case 3:return c=h.sent(),s=c,[3,4];case 4:return s?[3,6]:(l=e.filter((function(e){return e.generation!==r})),[4,this._store.set({key:this.recordsetKey,value:l,generation:r})]);case 5:return h.sent(),this._onWrite.forEach((function(e){e(i$1.map((function(e){return e.data})));})),[3,7];case 6:this._onError.forEach((function(e){return e(s)})),h.label=7;case 7:return [2]}}))}))},e.prototype.init=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,s$1,o,a;return i(this,(function(u){switch(u.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=u.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),n=s(t),r=n.next(),u.label=4;case 4:return r.done?[3,7]:(i$1=r.value,[4,this._applyRecord(t,i$1)]);case 5:u.sent(),u.label=6;case 6:return r=n.next(),[3,4];case 7:return [3,10];case 8:return s$1=u.sent(),o={error:s$1},[3,10];case 9:try{r&&!r.done&&(a=n.return)&&a.call(n);}finally{if(o)throw o.error}return [7];case 10:return [2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case tn$1.COMMIT:this._onCommit.set(t,n);break;case tn$1.WRITE:this._onWrite.set(t,n);break;case tn$1.ERROR:this._onError.set(t,n);}},e.prototype.requestWrite=function(e,t){void 0===t&&(t=null),this._requests.push({data:e,options:t}),mn$1.get(this.dbname).put(n({state:nn.PENDING,generation:this.generation},e));},e.prototype.requestMultipleWrite=function(e,t){var n$1,r;void 0===t&&(t=null);var i=mn$1.get(this.dbname);try{for(var s$1=s(e),o=s$1.next();!o.done;o=s$1.next()){var a=o.value;this._requests.push({data:a,options:t}),i.put(n({state:nn.PENDING,generation:this.generation},a));}}catch(e){n$1={error:e};}finally{try{o&&!o.done&&(r=s$1.return)&&r.call(s$1);}finally{if(n$1)throw n$1.error}}},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return mn$1.get(this.dbname).clearByCondition((function(e){return e.state===nn.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,s,o,a,u,c,l,d,f=this;return i(this,(function(h){switch(h.label){case 0:if(!((e=this._requests).length>0))return [3,4];for(t=[],n$1={},a=e.length-1;a>=0;a--)r=e[a],c=r.data,n$1[c.key]||(n$1[c.key]=!0,t.unshift(r));return i$1={generation:this.generation,requests:t},[4,this._getReducedRecordset([i$1])];case 1:return s=h.sent(),[4,this._store.set({key:this.recordsetKey,value:s,generation:this.generation})];case 2:return h.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(h.sent(),o=mn$1.get(this.dbname),a=0;a<t.length;a++)u=t[a],c=u.data,l=u.options,o.put(n(n({},c),{generation:i$1.generation,state:l&&l.persistent?nn.PERSISTENT:nn.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})));})),d=jt.get(this.dbname),setTimeout((function(){try{f._applyRecord(s,i$1);}catch(e){f._onError.forEach((function(t){return t(e)}));}}),d.transactionApplyDelay),h.label=4;case 4:return [2]}}))}))},e}(),bn=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,s=e.limit;this.blockId=t,this.keyName=n,this.limit=s,this._items=a([],o(i),!1);}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return {blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this;return this._items.find((function(n){var r=n[t.keyName];return e===r}))},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return !1},e.prototype.clear=function(){this._items=[];},e}(),gn$1=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,s=void 0===i?Gt:i,o=e.transaction,a=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=s,this.metadata=r,this._transaction=o,this._store=a;}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,s="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return (n.hashFunction||Gt)(e,r)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(hn$1(n,r)).concat(i,".").concat(s);var n,r,i,s;},e.prototype._findBlock=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:t=mn$1.get(this.dbname),n=this.metadata.blockLevel,o.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i$1=o.sent())&&(s=bn.createFromCacheItem(i$1),s.getItemByKey(e)))return [2,s];o.label=3;case 3:return n--,[3,1];case 4:return [2,null]}}))}))},e.prototype.getFromBlock=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return [4,this._findBlock(e)];case 1:return [2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return n=jt.get(this.dbname),r=this.createBlockId(e),i$1=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,mn$1.get(this.dbname).find(this._store,r)];case 1:return s=a.sent(),(o=s?bn.createFromCacheItem(s):new bn({blockId:r,keyName:this.keyName,items:[],limit:i$1})).add(t)?(this._transaction.requestWrite({key:o.blockId,value:o.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return [4,this._findBlock(e)];case 1:return (t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,s$1,o,a,u;return i(this,(function(c){switch(c.label){case 0:return e=hn$1(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=c.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:c.sent(),r=mn$1.get(this.dbname);try{for(i$1=s(n),s$1=i$1.next();!s$1.done;s$1=i$1.next())o=s$1.value,r.remove(o);}catch(e){a={error:e};}finally{try{s$1&&!s$1.done&&(u=i$1.return)&&u.call(i$1);}finally{if(a)throw a.error}}return [2]}}))}))},e}(),In=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,o=e.store,a=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=function(e,t,n){return "".concat(cn$1(e,t),"/index.").concat(n)}(this.dbname,this.collectionName,this.fields.join(">")),this._transaction=s,this._store=o,this._transaction.on(tn$1.COMMIT,this.indexerKey,(function(){return a.commit()})),this._transaction.on(tn$1.ERROR,this.indexerKey,(function(){return a.abort()}));}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=o(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=o(this.indexOf(n),2),i=r[0];if(r[1]){var s=this._table[i].keys.indexOf(t);if(s>-1)return this._table[i].keys.splice(s,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return !1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,s$1=[];try{for(var o=s(this.fields),a=o.next();!a.done;a=o.next()){var u=a.value;if("-"===u[0]&&(u=u.slice(1)),r=e[u],i=void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw Vt.indexTypesNotMatch;s$1.push(e[u]);}}catch(e){t={error:e};}finally{try{a&&!a.done&&(n=o.return)&&n.call(o);}finally{if(t)throw t.error}}return s$1},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=Qt(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(i>0)t=r+1;else {if(!(i<0))return [r,!0];n=r-1;}}return [t,!1]}return [0,!1]},e.prototype.ensure=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,s$1,o,a,u,c,l,d,f,p,v,_,m;return i(this,(function(h){switch(h.label){case 0:return [4,(e=mn$1.get(this.dbname)).find(this._store,this.indexerKey,rn$1.PERSISTENT)];case 1:return (t=h.sent())?[3,11]:(n=hn$1(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=h.sent(),h.label=3;case 3:h.trys.push([3,8,9,10]),i$1=s(r),s$1=i$1.next(),h.label=4;case 4:return s$1.done?[3,7]:(o=s$1.value).startsWith(n)?[4,e.find(this._store,o,rn$1.NO_CACHE)]:[3,6];case 5:a=h.sent(),u=bn.createFromCacheItem(a);try{for(_=void 0,c=s(u.items),l=c.next();!l.done;l=c.next())d=l.value,this._addItem(d);}catch(e){_={error:e};}finally{try{l&&!l.done&&(m=c.return)&&m.call(c);}finally{if(_)throw _.error}}h.label=6;case 6:return s$1=i$1.next(),[3,4];case 7:return [3,10];case 8:return f=h.sent(),p={error:f},[3,10];case 9:try{s$1&&!s$1.done&&(v=i$1.return)&&v.call(i$1);}finally{if(p)throw p.error}return [7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=zt(this._origin),h.label=12;case 12:return [2]}}))}))},e.prototype.drop=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return mn$1.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}}))}))},e.prototype.addItem=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=zt(this._origin);},e.prototype.abort=function(){this._table=zt(this._origin);},e}(),wn$1="undefined"!=typeof document&&"undefined"!=typeof navigator;wn$1&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var En$1=wn$1&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");wn$1&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),wn$1&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),wn$1&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");var kn,Nn$1,On=wn$1&&navigator.userAgent&&navigator.userAgent.includes("Edge/"),Sn=function(){var e=(new Date).getTime();return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE";}(kn||(kn={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock";}(Nn$1||(Nn$1={}));var Tn$1,xn={},Cn$1=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=kn.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],xn[e]&&!t.forceCreate||(this.nodeId=Sn(),this.key=e,wn$1&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost();})),window.addEventListener("message",(function(e){var t,r,i=e.data,s$1=i.nodeId,o=i.requestId,a=i.key,u=i.op,c=i.data;if(s$1!==n.nodeId&&a===n.key)switch(u){case Nn$1.NEWNODE:n._sendSync();break;case Nn$1.CLAIM_HOST:n._sendSync(),n._hostId=s$1;break;case Nn$1.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var l=c,h=l.currentItemRequestId,d=l.queue,f=function(e){var t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:Nn$1.REQUEST_LOCK,ts:e.ts});};try{for(var p=s(d),v=p.next();!v.done;v=p.next()){f(v.value);}}catch(e){t={error:e};}finally{try{v&&!v.done&&(r=p.return)&&r.call(p);}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===h})),n._completeSync();}break;case Nn$1.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=null,n._acquire(n._queue[0]));break;case Nn$1.REQUEST_LOCK:n._requestLock(i);break;case Nn$1.ACQUIRE_LOCK:var _=n._queue.find((function(e){return e.requestId===o}));n._acquire(_);break;case Nn$1.RELEASE_LOCK:n._release(o);}})),window.addEventListener("beforeunload",(function(){n._send(Nn$1.REMOVENODE);}))),xn[e]=this),xn[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return !!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==kn.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n,r;void 0===t&&(t={});var i={nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:Sn(),key:this.key,op:e,data:null!==(r=t.data)&&void 0!==r?r:null,ts:Date.now()};return wn$1&&window.postMessage(i,"*"),i},e.prototype._acquire=function(e){void 0===e&&(e=null),e?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null;},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=null,t.nodeId===this.nodeId&&this._send(Nn$1.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased(e);}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(Nn$1.ACQUIRE_LOCK,{requestId:e}),n();},onReleased:function(){t._acquire(t._queue[0]);}},i=!1;for(var s in t._queue)if(t._queue[s].ts>r.ts){t._queue.splice(parseInt(s),0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0]);}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(Nn$1.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return {nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}});},e.prototype._waitUntilSyncCompleted=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t);}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync();}),8));},e.prototype._completeSync=function(){this.isInSync||(this._state=kn.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[]);},e.prototype.registerNode=function(){this._send(Nn$1.NEWNODE),this._waitSync();},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Nn$1.CLAIM_HOST),this._waitSync();},e.prototype.lock=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return [4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(Nn$1.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;this._release(null===(e=this._currentItem)||void 0===e?void 0:e.requestId);},e}(),Rn=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,o$1=e.store,a$1=this;this._state=Ht.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=a([[r]],o(s.filter((function(e){return In.createKey(e)!==a$1.keyName}))),!1),this._keyHash=i,this._store=o$1,this._mutex=new Cn$1(function(e,t){return "".concat(cn$1(e,t),".lock")}(t,n)),this._blobContainer=new pn$1({dbname:t,collectionName:n,store:o$1}),this._transaction=new yn$1({dbname:t,collectionName:n,store:o$1});}return e.metadataOf=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=ln$1(e,t),[4,n.get(r)];case 1:return [2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._state===Ht.READY},enumerable:!1,configurable:!0}),e.prototype.init=function(){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o$1,a$1,u,c,l,d,f,p,v,_=this;return i(this,(function(h){switch(h.label){case 0:return [4,this._mutex.lock()];case 1:h.sent(),h.label=2;case 2:return h.trys.push([2,9,,10]),t=jt.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=h.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:h.sent(),this._blockManager=new gn$1({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=a([],o(this.indexes),!1),i$1=[],s$1=r.map((function(e){return In.createKey(e)})),o$1=n?n.indexes.map((function(e){return In.createKey(e)})):[];try{for(a$1=s(o$1),u=a$1.next();!u.done;u=a$1.next())c=u.value,s$1.includes(c)||i$1.push(In.parseKey(c));}catch(e){p={error:e};}finally{try{u&&!u.done&&(v=a$1.return)&&v.call(a$1);}finally{if(p)throw p.error}}return (l=[]).push.apply(l,a([],o(r.map((function(e){var t=new In({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store});return _._indexers.push(t),t.ensure()}))),!1)),l.push.apply(l,a([],o(i$1.map((function(e){return new In({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store}).drop()}))),!1)),[4,Promise.all(l)];case 5:return h.sent(),[4,this._transaction.commit()];case 6:return h.sent(),s$1.sort().join(",")===o$1.sort().join(",")?[3,8]:(d=ln$1(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata,generation:1})]);case 7:h.sent(),h.label=8;case 8:return this._state=Ht.READY,this._mutex.unlock(),[3,10];case 9:throw f=h.sent(),this._mutex.unlock(),f;case 10:return [2]}}))}))},e.prototype.close=function(){this._state=Ht.CLOSED;},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return "string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=In.createKey(e);try{for(var i=s(this._indexers),s$1=i.next();!s$1.done;s$1=i.next()){var o=s$1.value;if(r===In.createKey(o.fields))return o}}catch(e){t={error:e};}finally{try{s$1&&!s$1.done&&(n=i.return)&&n.call(i);}finally{if(t)throw t.error}}return null},e.prototype._upgradeBlockLevel=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=ln$1(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata,generation:1})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o;return i(this,(function(a){switch(a.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return a.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return a.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return a.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:a.sent(),a.label=5;case 5:a.trys.push([5,10,11,12]),n=s(this._indexers),r=n.next(),a.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:a.sent(),a.label=8;case 8:return r=n.next(),[3,6];case 9:return [3,12];case 10:return i$1=a.sent(),s$1={error:i$1},[3,12];case 11:try{r&&!r.done&&(o=n.return)&&o.call(n);}finally{if(s$1)throw s$1.error}return [7];case 12:return [3,14];case 13:throw Vt.collectionInsertDuplicate;case 14:return [2]}}))}))},e.prototype._requestUpsert=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u,c,l,d,f,p;return i(this,(function(h){switch(h.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return (n=h.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return h.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return h.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:h.sent(),h.label=5;case 5:h.trys.push([5,10,11,12]),r=s(this._indexers),i$1=r.next(),h.label=6;case 6:return i$1.done?[3,9]:[4,(u=i$1.value).addItem(e)];case 7:h.sent(),h.label=8;case 8:return i$1=r.next(),[3,6];case 9:return [3,12];case 10:return s$1=h.sent(),l={error:s$1},[3,12];case 11:try{i$1&&!i$1.done&&(d=r.return)&&d.call(r);}finally{if(l)throw l.error}return [7];case 12:return [3,23];case 13:return [4,this._blockManager.putToBlock(t,e)];case 14:h.sent(),h.label=15;case 15:h.trys.push([15,21,22,23]),o=s(this._indexers),a=o.next(),h.label=16;case 16:return a.done?[3,20]:0===(u=a.value).diff(u.getColumnValues(n),u.getColumnValues(e))?[3,19]:[4,u.removeItem(n)];case 17:return h.sent(),[4,u.addItem(e)];case 18:h.sent(),h.label=19;case 19:return a=o.next(),[3,16];case 20:return [3,23];case 21:return c=h.sent(),f={error:c},[3,23];case 22:try{a&&!a.done&&(p=o.return)&&p.call(o);}finally{if(f)throw f.error}return [7];case 23:return [2]}}))}))},e.prototype._requestUpdate=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u;return i(this,(function(c){switch(c.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return (n=c.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:c.sent(),c.label=3;case 3:c.trys.push([3,9,10,11]),r=s(this._indexers),i$1=r.next(),c.label=4;case 4:return i$1.done?[3,8]:0===(s$1=i$1.value).diff(s$1.getColumnValues(n),s$1.getColumnValues(e))?[3,7]:[4,s$1.removeItem(n)];case 5:return c.sent(),[4,s$1.addItem(e)];case 6:c.sent(),c.label=7;case 7:return i$1=r.next(),[3,4];case 8:return [3,11];case 9:return o=c.sent(),a={error:o},[3,11];case 10:try{i$1&&!i$1.done&&(u=r.return)&&u.call(r);}finally{if(a)throw a.error}return [7];case 11:return [2]}}))}))},e.prototype._requestRemove=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o;return i(this,(function(a){switch(a.label){case 0:return [4,this._blockManager.getFromBlock(e)];case 1:return (t=a.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:a.sent(),a.label=3;case 3:a.trys.push([3,8,9,10]),n=s(this._indexers),r=n.next(),a.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:a.sent(),a.label=6;case 6:return r=n.next(),[3,4];case 7:return [3,10];case 8:return i$1=a.sent(),s$1={error:i$1},[3,10];case 9:try{r&&!r.done&&(o=n.return)&&o.call(n);}finally{if(s$1)throw s$1.error}return [7];case 10:return [2]}}))}))},e.prototype._requestClear=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s$1){switch(s$1.label){case 0:return [4,this._blockManager.clearAllBlocks()];case 1:s$1.sent(),s$1.label=2;case 2:s$1.trys.push([2,7,8,9]),e=s(this._indexers),t=e.next(),s$1.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:s$1.sent(),s$1.label=5;case 5:return t=e.next(),[3,3];case 6:return [3,9];case 7:return n=s$1.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i$1=e.return)&&i$1.call(e);}finally{if(r)throw r.error}return [7];case 9:return [2]}}))}))},e.prototype.getByKey=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,zt(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return [3,7];case 6:throw Vt.collectionNotReady;case 7:return [2]}}))}))},e.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new an$1({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},e.prototype.insertOne=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Vt.collectionKeyNotGiven;return [4,this._requestInsert(zt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.insertMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u=this;return i(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return !u._hasPropertyOfKeyName(e)})))throw Vt.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=s(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(zt(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return [3,10];case 8:return i$1=c.sent(),o={error:i$1},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(o)throw o.error}return [7];case 10:return [4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s$1=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s$1;case 14:return [3,16];case 15:throw Vt.collectionNotReady;case 16:return [2]}}))}))},e.prototype.upsertOne=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Vt.collectionKeyNotGiven;return [4,this._requestUpsert(zt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.upsertMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u=this;return i(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return !u._hasPropertyOfKeyName(e)})))throw Vt.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=s(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(zt(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return [3,10];case 8:return i$1=c.sent(),o={error:i$1},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(o)throw o.error}return [7];case 10:return [4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s$1=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s$1;case 14:return [3,16];case 15:throw Vt.collectionNotReady;case 16:return [2]}}))}))},e.prototype.update=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Vt.collectionKeyNotGiven;return [4,this._requestUpdate(zt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.updateIf=function(e,t){return r(this,void 0,void 0,(function(){var n,r$1,i$1,s$1,o,a,c,l,d,f,p,v,_,m,y=this;return i(this,(function(b){switch(b.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:b.sent(),b.label=2;case 2:return b.trys.push([2,13,,15]),n=e.where,r$1=void 0===n?{}:n,i$1=e.index,s$1=void 0===i$1?null:i$1,o=e.backward,a=void 0!==o&&o,c=[],[4,new on$1({condition:r$1,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(s$1)}).each((function(e){return r(y,void 0,void 0,(function(){var n,i$1;return i(this,(function(s){if(e.error)throw e.stop(),e.error;if(e.hasNext){if(n=e.nextValue,Jt(r$1,n)&&t.set){if("function"!=typeof t.set)for(i$1 in t.set)n[i$1]=t.set[i$1];else t.set(n);c.push(n);}e.next();}else e.stop();return [2]}))}))}))];case 3:b.sent(),b.label=4;case 4:b.trys.push([4,9,10,11]),l=s(c),d=l.next(),b.label=5;case 5:return d.done?[3,8]:(f=d.value,[4,this._requestUpdate(zt(f))]);case 6:b.sent(),b.label=7;case 7:return d=l.next(),[3,5];case 8:return [3,11];case 9:return p=b.sent(),_={error:p},[3,11];case 10:try{d&&!d.done&&(m=l.return)&&m.call(l);}finally{if(_)throw _.error}return [7];case 11:return [4,this._transaction.commit()];case 12:return b.sent(),this._mutex.unlock(),[2,c];case 13:return v=b.sent(),[4,this._transaction.clear()];case 14:throw b.sent(),this._mutex.unlock(),v;case 15:return [3,17];case 16:throw this._transaction.clear(),Vt.collectionNotReady;case 17:return [2]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.removeIf=function(e){return r(this,void 0,void 0,(function(){var t,n,r$1,i$1,s$1,o,a,c,l,d,f,p,v,_,m=this;return i(this,(function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,14]),t=e.where,n=void 0===t?{}:t,r$1=e.index,i$1=void 0===r$1?null:r$1,s$1=e.backward,o=void 0!==s$1&&s$1,a=[],[4,new on$1({condition:n,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(i$1)}).each((function(e){return r(m,void 0,void 0,(function(){var t,r;return i(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(t=e.nextValue,Jt(n,t)&&(r=t[this.keyName],a.push(r)),e.next()):e.stop(),[2]}))}))}))];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),c=s(a),l=c.next(),y.label=5;case 5:return l.done?[3,8]:(d=l.value,[4,this._requestRemove(d)]);case 6:y.sent(),y.label=7;case 7:return l=c.next(),[3,5];case 8:return [3,11];case 9:return f=y.sent(),v={error:f},[3,11];case 10:try{l&&!l.done&&(_=c.return)&&_.call(c);}finally{if(v)throw v.error}return [7];case 11:return [4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,a];case 13:throw p=y.sent(),this._mutex.unlock(),p;case 14:return [3,16];case 15:throw this._transaction.clear(),Vt.collectionNotReady;case 16:return [2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.getBlob=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._blobContainer.get(e)];case 1:return [2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return void 0===t&&(t=null),r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return [4,this._blobContainer.save(e,t)];case 1:return [2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),Ln={},Pn=function(){function e(e){void 0===e&&(e={});var t=e.itemSizeLimit,n=void 0===t?4194304:t,r=e.delay,i=void 0===r?1:r,s=e.encryption,o=void 0===s?A$1:s;this._encryption=o,this.itemSizeLimit=n,this.delay=i,this.observer={};}return Object.defineProperty(e.prototype,"rawData",{get:function(){return Ln[this.dbname]},set:function(e){Ln[this.dbname]=e;},enumerable:!1,configurable:!0}),e.prototype.observe=function(e,t,n){var r=this;this.observer[e]={},t.forEach((function(t){return r.observer[e][t]=n}));},e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:this.dbname=e,Ln[this.dbname]={},n.label=1;case 1:return n.trys.push([1,,3,5]),[4,this.get(N.key)];case 2:if((t=n.sent())&&JSON.stringify(t)!==JSON.stringify(N.value))throw Vt.storeEncryptionInvalid;return [3,5];case 3:return [4,this.set(N)];case 4:return n.sent(),[7];case 5:return [2]}}))}))},e.prototype.getAllKeys=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,Object.keys(Ln[this.dbname]).filter((function(e){return e!==N.key}))]}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return [4,Yt(this.delay)];case 1:if(r.sent(),t=this.observer[e],n=t&&t.get?t.get(e):null)throw n;return [2,Ln[this.dbname][e]?this._encryption.decrypt(Ln[this.dbname][e]):null]}}))}))},e.prototype.set=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return [4,Yt(this.delay)];case 1:if(a.sent(),t=e.key,n=e.value,r=this.observer[t],i$1=r&&r.set?r.set(t):null)throw i$1;if(s=this._encryption.encrypt(n),o=JSON.stringify(s),t===N.key||o.length<this.itemSizeLimit)return Ln[this.dbname][t]=s,[2,Ln[this.dbname][t]];throw Vt.storeItemSizeExceeded}}))}))},e.prototype.setMany=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(r){switch(r.label){case 0:return [4,Yt(this.delay)];case 1:return r.sent(),t=[],e.forEach((function(e){var r=e.key,i=e.value,s=n.observer[r];if(s&&s.set?s.set(r):null)t.push(Vt.collectionWriteFailed);else {var o=n._encryption.encrypt(i),a=JSON.stringify(o);r===N.key||a.length<n.itemSizeLimit?(Ln[n.dbname][r]=o,t.push(i)):t.push(Vt.storeItemSizeExceeded);}})),[2,t]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return [4,Yt(this.delay)];case 1:if(r.sent(),t=this.observer[e],n=t&&t.remove?t.remove(e):null)throw n;return Ln[this.dbname][e]&&delete Ln[this.dbname][e],[2,e]}}))}))},e.prototype.removeMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a;return i(this,(function(u){switch(u.label){case 0:return [4,Yt(this.delay)];case 1:u.sent();try{for(t=s(e),n=t.next();!n.done;n=t.next()){if(r=n.value,i$1=this.observer[r],s$1=i$1&&i$1.remove?i$1.remove(r):null)throw s$1;Ln[this.dbname][r]&&delete Ln[this.dbname][r];}}catch(e){o={error:e};}finally{try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(o)throw o.error}}return [2,e]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,Yt(this.delay)];case 1:return e.sent(),Ln[this.dbname]={},[2]}}))}))},e}(),An=function(){function e(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;var t=e.encryption,n=void 0===t?A$1:t;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=n;}return e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return this.dbname=e,[4,new Promise((function(e,t){if(r._window&&wn$1)if(En$1){var n=r._indexedDB.open("_testMozilla");n.onerror=function(){return t(Vt.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()};}else On?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(Vt.storeNotAvailableInPrivateBrowsing):e();else t(Vt.storeNotAvailable);}))];case 1:return i.sent(),t=this,[4,new Promise((function(t,n){var i=r._indexedDB.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"});})),i.addEventListener("success",(function(e){return t(e.target.result)})),i.addEventListener("error",(function(e){return n(e.target.error)}));}))];case 2:t._database=i.sent(),i.label=3;case 3:return i.trys.push([3,,5,7]),[4,this.get(N.key)];case 4:if((n=i.sent())&&JSON.stringify(n)!==JSON.stringify(N.value))throw Vt.storeEncryptionInvalid;return [3,7];case 5:return [4,this.set(N)];case 6:return i.sent(),[7];case 7:return [2]}}))}))},e.prototype.getAllKeys=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){switch(t.label){case 0:return [4,new Promise((function(t,n){var r=e._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").getAllKeys();r.addEventListener("success",(function(e){t(e.target.result.filter((function(e){return e!==N.key})));})),r.addEventListener("error",(function(e){return n(e.target.error)}));}))];case 1:return [2,t.sent()]}}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return [4,new Promise((function(n,r){var i=t._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").get(e);i.addEventListener("success",(function(e){return n(e.target.result?t._encryption.decrypt(e.target.result.value):null)})),i.addEventListener("error",(function(e){return r(e.target.error)}));}))];case 1:return [2,n.sent()]}}))}))},e.prototype.set=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return t=e.key,n=e.value,[4,new Promise((function(e,i){var s=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").put({key:t,value:r._encryption.encrypt(n)});s.addEventListener("success",(function(t){e(t.target.result);})),s.addEventListener("error",(function(e){return i(e.target.error)}));}))];case 1:return i.sent(),[2,n]}}))}))},e.prototype.setMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return t=[],n=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),e.forEach((function(e){var i=e.key,s=e.value;t.push(new Promise((function(e){var t=n.put({key:i,value:r._encryption.encrypt(s)});t.addEventListener("success",(function(t){e(t.target.result);})),t.addEventListener("error",(function(){e(Vt.collectionWriteFailed);}));})));})),[4,Promise.all(t)];case 1:return i.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return [4,new Promise((function(n,r){var i=t._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}));}))];case 1:return [2,n.sent()]}}))}))},e.prototype.removeMany=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}));}))})))];case 1:return [2,n.sent()]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){switch(t.label){case 0:return [4,new Promise((function(t,n){var r=e._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").clear();r.addEventListener("success",(function(){return t()})),r.addEventListener("error",(function(e){return n(e.target.error)}));}))];case 1:return [2,t.sent()]}}))}))},e}(),Dn=function(){function e(e){var t=e.AsyncStorage,n=e.encryption,r=void 0===n?A$1:n;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=r;}return e.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},e.prototype._getActualKey=function(e){return "".concat(this.dbname,"/").concat(e)},e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:this.dbname=e,n.label=1;case 1:return n.trys.push([1,,3,5]),[4,this.get(N.key)];case 2:if((t=n.sent())&&JSON.stringify(t)!==JSON.stringify(N.value))throw Vt.storeEncryptionInvalid;return [3,5];case 3:return [4,this.set(N)];case 4:return n.sent(),[7];case 5:return [2]}}))}))},e.prototype.getAllKeys=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return i(this,(function(r){switch(r.label){case 0:return e=this._getActualKey(N.key),[4,this._asyncStorage.getAllKeys()];case 1:return t=r.sent(),[2,t.filter((function(t){return n._isBelonging(t)&&t!==e})).map((function(e){return e.substring("".concat(n.dbname,"/").length)}))]}}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return [4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return [2,(t=n.sent())?this._encryption.decrypt(JSON.parse(t)):null]}}))}))},e.prototype.set=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=e.key,n=e.value,r=JSON.stringify(this._encryption.encrypt(n)),t===N.key||r.length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),r)]:[3,2];case 1:return i.sent(),[2,JSON.parse(r)];case 2:throw Vt.storeItemSizeExceeded}}))}))},e.prototype.setMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u,c,l;return i(this,(function(h){switch(h.label){case 0:t=[],n=[];try{for(r=s(e),i$1=r.next();!i$1.done;i$1=r.next()){s$1=i$1.value;try{o=s$1.key,a=s$1.value,u=JSON.stringify(this._encryption.encrypt(a)),o===N.key||u.length<this.itemSizeLimit?(n.push([this._getActualKey(o),u]),t.push(a)):t.push(Vt.storeItemSizeExceeded);}catch(e){t.push(Vt.collectionWriteFailed);}}}catch(e){c={error:e};}finally{try{i$1&&!i$1.done&&(l=r.return)&&l.call(r);}finally{if(c)throw c.error}}h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._asyncStorage.multiSet(n)];case 2:return h.sent(),[3,4];case 3:return h.sent(),[2,new Array(t.length).fill(Vt.collectionWriteFailed)];case 4:return [2,t]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._asyncStorage.removeItem(this._getActualKey(e))];case 1:return t.sent(),[2,e]}}))}))},e.prototype.removeMany=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return [4,this._asyncStorage.multiRemove(e.map((function(e){return t._getActualKey(e)})))];case 1:return n.sent(),[2,e]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return [4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[4,this.remove(N.key)];case 3:return t.sent(),[2]}}))}))},e}(),Mn=!0,Un=function(){function e(){}return e.off=function(){Mn=!1;},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Mn&&console.log.apply(console,a(["".concat("[NESTDB]","[LOG]")],o(e),!1));},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Mn&&console.warn.apply(console,a(["".concat("[NESTDB]","[WARNING]")],o(e),!1));},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Mn&&console.error.apply(console,a(["".concat("[NESTDB]","[ERROR]")],o(e),!1));},e}();!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED";}(Tn$1||(Tn$1={}));var qn=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=Tn$1.INIT,this._config=i||new jt({dbname:t}),this._store=r,this._event={success:Xt,error:Xt,upgrade:en$1},this._collections=new Map,this._globalMutex=new Cn$1("".concat(this.name,".lock")),this._config.disableLogger&&Un.off(),new mn$1({dbname:t,limit:this._config.cacheLimit});}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.commitSchema=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return this._state!==Tn$1.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return t=e.collectionName,n=e.keyName,r=e.index,i$1=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new Rn({dbname:this.name,collectionName:t,keyName:n,keyHash:e.keyHash||null,indexes:i$1,store:this._store})),[4,this._collections.get(t).init()];case 1:return s.sent(),[2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw Vt.databaseSchemaNotOnUpgrade;case 3:return [2]}}))}))},e.prototype.open=function(){var e;return r(this,void 0,void 0,(function(){var t,n,r$1,i$1,s=this;return i(this,(function(o){switch(o.label){case 0:return [4,this._globalMutex.lock()];case 1:if(o.sent(),this._state===Tn$1.OPENED)return [3,15];this._state=Tn$1.OPENING,o.label=2;case 2:return o.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return o.sent(),a=this.name,t="".concat(un$1(a),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:return r$1=null!==(e=o.sent())&&void 0!==e?e:n,[2,new Promise((function(e,n){var i$1=function(e){r$1.version<s._version?s._event.upgrade(r$1.version,(function(n){return r(s,void 0,void 0,(function(){var i$1;return i(this,(function(s){switch(s.label){case 0:if(n)return [3,5];r$1.version++,r$1.collectionNames=Array.from(this._collections.keys()),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r$1,generation:this._version})];case 2:return s.sent(),e({continued:!0}),[3,4];case 3:return i$1=s.sent(),e({continued:!1,err:i$1}),[3,4];case 4:return [3,6];case 5:e({continued:!1,err:n}),s.label=6;case 6:return [2]}}))}))})):e({continued:!1});},o=function(t){var a=t.continued,c=void 0!==a&&a,l=t.err,d=void 0===l?null:l;if(c)setTimeout((function(){return i$1(o)}),10);else if(d)Un.error(d.message),s._globalMutex.unlock(),s._event.error(d),n(d);else {var f=[];r$1.collectionNames.forEach((function(e){s._collections.has(e)||f.push(r(s,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return [4,Rn.metadataOf(this.name,e,this._store)];case 1:return (t=r.sent())?(n=new Rn({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(e,n),[4,n.init()]):[3,3];case 2:r.sent(),r.label=3;case 3:return [2]}}))})));})),Promise.all(f).then((function(){s._state=Tn$1.OPENED,s._globalMutex.unlock(),s._event.success(),e();})).catch((function(e){Un.error(e.message),s._globalMutex.unlock(),s._event.error(e),n(e);}));}};i$1(o);}))];case 5:switch(i$1=o.sent(),i$1.code){case wt.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return [3,6];case wt.STORE_NOT_AVAILABLE:return [3,8];case wt.STORE_ENCRYPTION_INVALID:return [3,10]}return [3,13];case 6:return Un.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new Pn({}),this._globalMutex.unlock(),this._event.error(i$1),[4,this.open()];case 7:return o.sent(),[3,14];case 8:return Un.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Pn({}),this._globalMutex.unlock(),this._event.error(i$1),[4,this.open()];case 9:return o.sent(),[3,14];case 10:return Un.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return o.sent(),this._globalMutex.unlock(),this._event.error(i$1),[4,this.open()];case 12:return o.sent(),[3,14];case 13:throw Un.error(i$1.message),this._globalMutex.unlock(),this._event.error(i$1),i$1;case 14:return [3,15];case 15:return [2]}var a;}))}))},e.prototype.close=function(){this._collections.forEach((function(e){return e.close()})),this._state=Tn$1.CLOSED;},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})))];case 1:return e.sent(),[2]}}))}))},e.prototype.reset=function(){return r(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(n){switch(n.label){case 0:return this.close(),(e=mn$1.get(this.name))&&e.clearByCondition((function(e){return e.key.startsWith(un$1(t.name))})),[4,this._store.clear()];case 1:return n.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t;},e.prototype.off=function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=en$1;else this._event[e]=Xt;},e.prototype.collection=function(e){return this._collections.get(e)||null},e}(),Bn=null,Fn=function(){function n$1(e,t,n){var r$1=this;this._fcmPushToken=null,this._apnsPushToken=null,this._iid=e,this.options=t;var i$1=St$2.of(e),s=i$1.sdkState,o=i$1.cacheContext,a=i$1.dispatcher,c=i$1.sessionManager,l=i$1.requestQueue,d=i$1.logger,f=i$1.userEventHandlers;this._onlineDetector=new Me({logger:d,connectionDelegate:{reconnect:function(){var t=St$2.of(e),n=t.sdkState,r=t.connectionManager;"foreground"===n.appState&&r.resetAndReconnect();},disconnect:function(){St$2.of(e).connectionManager.disconnect();}}}),new pe(e,{localCacheEnabled:o.localCacheEnabled,dispatcher:a,sdkState:s,logger:d}),n.forEach((function(t){t.init(e,{sdkState:s,cacheContext:o,dispatcher:a,sessionManager:c,requestQueue:l,logger:d,onlineDetector:r$1._onlineDetector}),r$1[t.name]=t;})),this._appStateChangeDetector=new De,this._appStateChangeDetector.on("resume",(function(){d.debug("the page resumes from freeze"),r$1.setForegroundState();})).on("pause",(function(){d.debug("the page freezes"),r$1.setBackgroundState();})),a.on((function(t){if(t instanceof B$1){if("USEV"===t.code){var n=t.as(be).event;if(n.category===te.FRIEND_DISCOVERED){var i$1=me.getDataAsFriendDiscoveredEvent(e,n).friendDiscoveries;Ie$1((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,f.forEach((function(e){e.onFriendsDiscovered(i$1);}))]}))}))}));}}}else if(t instanceof $$1){var a=St$2.of(r$1._iid).subscribedUnreadMessageCount,c=!1,l=t.ts;if("number"==typeof l&&l>a.ts){if(a.all!==t.all&&(c=!0),a.all=t.all>=0?t.all:0,t.customTypes)for(var d in t.customTypes)a.customTypes[d]!==t.customTypes[d]&&(c=!0),a.customTypes[d]=t.customTypes[d];c=c&&a.ts>0,a.ts=l;}c&&Ie$1((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,f.forEach((function(e){e.onTotalUnreadMessageCountUpdated(a.all,a.customTypes);}))]}))}))}));}else t instanceof lt$2&&o.localCacheEnabled&&o.preference.set(r$1._getUserProfileCacheKey(s.userId),dt$2.payloadify(t.userProfile));}));}return n$1.init=function(e){var t=e.appId,r=e.appVersion,i=void 0===r?null:r,s=e.modules,o$1=void 0===s?[]:s,a$1=e.options,u=void 0===a$1?new b:a$1,c=e.debugMode,l=void 0!==c&&c,h=e.customApiHost,d=e.customWebSocketHost,f=e.newInstance,p=void 0!==f&&f,v=e.logLevel,_=e.localCacheEnabled,m=void 0!==_&&_,y=e.localCacheEncryption,b$1=e.useAsyncStorageStore,g=void 0===b$1?null:b$1;if(!Bn||p){var I="su-".concat(R()),w=null!=y?y:{encrypt:function(e){return e},decrypt:function(e){return e}},E=new Pn({encryption:w});l||(E=g?new Dn({AsyncStorage:g,encryption:w}):new An({encryption:w})),new St$2(I,{appId:t,appVersion:i,options:u,apiHost:null!=h?h:"https://api-".concat(t,".sendbird.com"),websocketHost:null!=d?d:"wss://ws-".concat(t,".sendbird.com"),store:E,encryption:w,logLevel:v,localCacheEnabled:m,debugMode:l});var k=new n$1(I,u,a(a([],o(o$1),!1),[new Dn$1],!1));return Bn||(Bn=k),k}return Bn},Object.defineProperty(n$1,"instance",{get:function(){return Bn},enumerable:!1,configurable:!0}),Object.defineProperty(n$1,"version",{get:function(){return c$1},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"appId",{get:function(){return St$2.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"appInfo",{get:function(){return St$2.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"appVersion",{get:function(){var e;return null!==(e=St$2.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"debugMode",{get:function(){return St$2.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"logLevel",{get:function(){return St$2.of(this._iid).logger.level},set:function(e){St$2.of(this._iid).logger.level=e;},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"isCacheEnabled",{get:function(){return St$2.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"ekey",{get:function(){return Me$2(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"currentUser",{get:function(){var e;return null!==(e=St$2.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"connectionState",{get:function(){var e=St$2.of(this._iid).connectionManager;return e.isConnected?j.OPEN:e.isConnecting?j.CONNECTING:j.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"lastConnectedAt",{get:function(){var e=St$2.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),n$1.prototype._getPreferenceCacheKey=function(e){return "sendbird@".concat(this.appId,"/").concat(e,".pref")},n$1.prototype._getUserProfileCacheKey=function(e){return "sendbird@".concat(this.appId,"/").concat(e,".profile")},n$1.prototype.getMemoryStoreForDebugging=function(){var e=St$2.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof Pn?n.store:null;throw p.debugModeRequired},n$1.prototype.addExtension=function(e,t){var n=St$2.of(this._iid).sdkState;["sb_uikit","sb_syncmanager"].indexOf(e)>-1&&(n.extensions[e]=t);},n$1.prototype.initializeCache=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return t=St$2.of(this._iid),n=t.sdkState,r=t.cacheContext,i$1=t.connectionManager,s=t.dispatcher,n.userId&&n.userId===e?[3,6]:[4,i$1.logout()];case 1:return c.sent(),n.userId=e,r.localCacheEnabled?(o="sendbird@".concat(n.appId,"/").concat(e,".db"),r.nestdb&&r.nestdb.state!==Tn$1.CLOSED&&r.nestdb.name===o?[3,3]:((a=r.nestdb=new qn({name:"sendbird@".concat(n.appId,"/").concat(e,".db"),version:1,store:r.store})).on("upgrade",function(e){return function(t,n){0===t?e.commitSchema([{collectionName:W,keyName:V,index:[$(K.LATEST_LAST_MESSAGE),$(K.CHRONOLOGICAL),$(K.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:J,keyName:X,index:[se(Z.CHANNEL_LATEST),se(Z.NEWEST_CHILD_MESSAGE)]},{collectionName:ce,keyName:oe,index:[se(Z.CHANNEL_LATEST),se(Z.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]).then((function(){return n()})).catch((function(e){return n(e)})):n();}}(a)),[4,a.open()])):[3,6];case 2:c.sent(),s.dispatch(new ve(this._iid,{userId:e})),c.label=3;case 3:return [4,r.preference.init(this._getPreferenceCacheKey(e))];case 4:return c.sent(),[4,r.preference.get(this._getUserProfileCacheKey(e))];case 5:(u=c.sent())&&new dt$2(this._iid,u).apply(),c.label=6;case 6:return [2]}}))}))},n$1.prototype.clearCachedData=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return (e=St$2.of(this._iid).cacheContext).localCacheEnabled?(e.nestdb&&e.nestdb.clear(),[4,e.preference.clear()]):[3,2];case 1:t.sent(),t.label=2;case 2:return [2]}}))}))},n$1.prototype.clearCachedMessages=function(e){return r(this,void 0,void 0,(function(){var t,n,r$1=this;return i(this,(function(i$1){switch(i$1.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),t=he.of(this._iid),n=ue.of(this._iid),t&&n?[4,Promise.all(e.map((function(e){return r(r$1,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return [4,t.removeMessagesOfChannel(e)];case 1:return r.sent(),[4,n.removeMessagesOfChannel(e)];case 2:return r.sent(),[2]}}))}))})))]:[3,2];case 1:i$1.sent(),i$1.label=2;case 2:return [2]}}))}))},n$1.prototype.connect=function(e,t){return void 0===t&&(t=null),r(this,void 0,void 0,(function(){var n,r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:n=St$2.of(this._iid),r=n.sdkState,i$1=n.cacheContext,s=n.connectionManager,o=n.statLogCollector,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.initializeCache(e)];case 2:return c.sent(),[3,4];case 3:return c.sent(),a=St$2.of(this._iid).logger,i$1.localCacheEnabled=!1,a.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return [4,o.init("sendbird@".concat(r.appId,"/").concat(e,".statlog"))];case 5:return c.sent(),[4,s.connect(t)];case 6:return c.sent(),this._appStateChangeDetector.start(),r.appState="foreground",[4,null==(u=pe.of(this._iid))?void 0:u.processNonAutoResendRegisteredPendingMessages()];case 7:return c.sent(),this._onlineDetector.start(),[2,this.currentUser]}}))}))},n$1.prototype.reconnect=function(){var e=St$2.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.auth.hasSession;return r&&t.resetAndReconnect().then((function(){n.appState="foreground";})).catch((function(){})),r},n$1.prototype.disconnect=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=St$2.of(this._iid),t=e.connectionManager,n=e.cacheContext,r=e.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return i.sent(),n.localCacheEnabled?[4,this.clearCachedData()]:[3,3];case 2:i.sent(),i.label=3;case 3:return [2]}}))}))},n$1.prototype.setBackgroundState=function(){var e=St$2.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background());},n$1.prototype.setForegroundState=function(){var e=St$2.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.resetAndReconnect());},n$1.prototype.setSessionHandler=function(e){at$2(e instanceof Le).throw(p.invalidParameters),St$2.of(this._iid).sessionManager.handler=e;},n$1.prototype.addUserEventHandler=function(e,n){at$2(y("string",e)&&n instanceof Ae).throw(p.invalidParameters),St$2.of(this._iid).userEventHandlers.set(e,n);},n$1.prototype.removeUserEventHandler=function(e){St$2.of(this._iid).userEventHandlers.delete(e);},n$1.prototype.removeAllUserEventHandler=function(){St$2.of(this._iid).userEventHandlers.clear();},n$1.prototype.addConnectionHandler=function(e,n){at$2(y("string",e)&&n instanceof Pe).throw(p.invalidParameters),St$2.of(this._iid).connectionHandlers.set(e,n);},n$1.prototype.removeConnectionHandler=function(e){St$2.of(this._iid).connectionHandlers.delete(e);},n$1.prototype.removeAllConnectionHandler=function(){St$2.of(this._iid).connectionHandlers.clear();},n$1.prototype.createApplicationUserListQuery=function(e){return void 0===e&&(e={}),new At(this._iid,e)},n$1.prototype.createBlockedUserListQuery=function(e){return void 0===e&&(e={}),new Ut(this._iid,e)},n$1.prototype.createFriendListQuery=function(e){return void 0===e&&(e={}),new Ft(this._iid,e)},n$1.prototype.createMessageSearchQuery=function(e){return new Cn$2(this._iid,e)},n$1.prototype.buildUserFromSerializedData=function(e){var t=ot$2(e);return new ct$2(this._iid,ct$2.payloadify(t))},n$1.prototype.updateCurrentUserInfo=function(n$1){return void 0===n$1&&(n$1={}),r(this,void 0,void 0,(function(){var r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return n$1=n(n({},Re),n$1),at$2(function(n){return S(n.profileImage,!0)&&y("string",n.profileUrl,!0)&&y("string",n.nickname,!0)}(n$1)).throw(p.invalidParameters),this.currentUser?(r=St$2.of(this._iid),i$1=r.sdkState,s=r.requestQueue,o=new Ue(n({userId:i$1.userId},n$1)),[4,s.send(o)]):[3,2];case 1:return a=c.sent(),u=a.as(qe).user,this.currentUser&&(n$1.nickname&&(this.currentUser.nickname=u.nickname),(n$1.profileUrl||n$1.profileImage)&&(this.currentUser.plainProfileUrl=u.profileUrl)),[2,u];case 2:throw p.connectionRequired}}))}))},n$1.prototype.updateCurrentUserInfoWithPreferredLanguages=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),this.currentUser?(t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new Ue({userId:n.userId,preferredLanguages:e}),[4,r.send(i$1)]):[3,2];case 1:return s=a.sent(),o=s.as(qe).user,this.currentUser&&(this.currentUser.preferredLanguages=o.preferredLanguages),[2,o];case 2:throw p.connectionRequired}}))}))},n$1.prototype.registerFCMPushTokenForCurrentUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:if(at$2(y("string",e)).throw(p.invalidParameters),!this.currentUser)return [3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new Fe({userId:r.userId,token:e}),[4,i$1.send(s)];case 2:return o.sent(),this._fcmPushToken="",[2,B.SUCCESS];case 3:return o.sent(),[2,B.ERROR];case 4:return [3,6];case 5:return this._fcmPushToken=e,[2,B.PENDING];case 6:return [2]}}))}))},n$1.prototype.unregisterFCMPushTokenForCurrentUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:if(at$2(y("string",e)).throw(p.invalidParameters),!this.currentUser)return [3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new je({userId:r.userId,token:e}),[4,i$1.send(s)];case 2:return o.sent(),this._fcmPushToken="",[2,B.SUCCESS];case 3:return o.sent(),[2,B.ERROR];case 4:return [3,6];case 5:return this._fcmPushToken=e,[2,B.PENDING];case 6:return [2]}}))}))},n$1.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return this.currentUser?(e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ve({userId:t.userId}),[4,n.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return [2]}}))}))},n$1.prototype.registerAPNSPushTokenForCurrentUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:if(at$2(y("string",e)).throw(p.invalidParameters),!this.currentUser)return [3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new Be({userId:r.userId,token:e}),[4,i$1.send(s)];case 2:return o.sent(),this._fcmPushToken="",[2,B.SUCCESS];case 3:return o.sent(),[2,B.ERROR];case 4:return [3,6];case 5:return this._fcmPushToken=e,[2,B.PENDING];case 6:return [2]}}))}))},n$1.prototype.unregisterAPNSPushTokenForCurrentUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:if(at$2(y("string",e)).throw(p.invalidParameters),!this.currentUser)return [3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new Ke({userId:r.userId,token:e}),[4,i$1.send(s)];case 2:return o.sent(),this._fcmPushToken="",[2,B.SUCCESS];case 3:return o.sent(),[2,B.ERROR];case 4:return [3,6];case 5:return this._fcmPushToken=e,[2,B.PENDING];case 6:return [2]}}))}))},n$1.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return this.currentUser?(e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new He({userId:t.userId}),[4,n.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return [2]}}))}))},n$1.prototype.getChannelInvitationPreference=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Qe({userId:t.userId}),[4,n.send(r)];case 1:return i$1=s.sent(),[2,{autoAccept:i$1.as(Ge).autoAccept}]}}))}))},n$1.prototype.setChannelInvitationPreference=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return at$2(y("boolean",e)).throw(p.invalidParameters),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new Ye({userId:r.userId,willAutoAccept:e}),[4,i$1.send(s)];case 1:return o=a.sent(),[2,{autoAccept:o.as(Je).autoAccept}]}}))}))},n$1.prototype.getDoNotDisturb=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Xe({userId:t.userId}),[4,n.send(r)];case 1:return i$1=s.sent(),[2,i$1.as(Ze).preference]}}))}))},n$1.prototype.setDoNotDisturb=function(e,n,r$1,i$1,s,o){return void 0===n&&(n=0),void 0===r$1&&(r$1=0),void 0===i$1&&(i$1=0),void 0===s&&(s=0),void 0===o&&(o=""),r(this,void 0,void 0,(function(){var a,u,c,l,d;return i(this,(function(h){switch(h.label){case 0:return at$2(y("boolean",e)&&y("number",n)&&y("number",r$1)&&y("number",i$1)&&y("number",s)&&y("string",o)).throw(p.invalidParameters),a=St$2.of(this._iid),u=a.sdkState,c=a.requestQueue,l=new $e({userId:u.userId,doNotDisturbOn:e,startHour:n,startMin:r$1,endHour:i$1,endMin:s,timezone:o}),[4,c.send(l)];case 1:return d=h.sent(),[2,d.as(et).preference]}}))}))},n$1.prototype.getSnoozePeriod=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new tt({userId:t.userId}),[4,n.send(r)];case 1:return i$1=s.sent(),[2,i$1.as(nt).snoozePeriod]}}))}))},n$1.prototype.setSnoozePeriod=function(e,n,r$1){return void 0===n&&(n=0),void 0===r$1&&(r$1=0),r(this,void 0,void 0,(function(){var i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return at$2(y("boolean",e)&&y("number",n)&&y("number",r$1)).throw(p.invalidParameters),i$1=St$2.of(this._iid),s=i$1.sdkState,o=i$1.requestQueue,a=new rt({userId:s.userId,snoozeOn:e,startTs:n,endTs:r$1}),[4,o.send(a)];case 1:return u=c.sent(),[2,u.as(it).snoozePeriod]}}))}))},n$1.prototype.getMyPushTokensByToken=function(e,n){return r(this,void 0,void 0,(function(){var r,i$1,s,o,a;return i(this,(function(u){switch(u.label){case 0:return at$2(y("string",e)&&m(z,n)).throw(p.invalidParameters),r=St$2.of(this._iid),i$1=r.sdkState,s=r.requestQueue,o=new We({userId:i$1.userId,type:n,token:e}),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as(ze).pushTokens]}}))}))},n$1.prototype.getPushTriggerOption=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new _e({userId:t.userId}),[4,n.send(r)];case 1:return [2,i.sent().as(Ee).pushTriggerOption]}}))}))},n$1.prototype.setPushTriggerOption=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return at$2(m(H$1,e)).throw(p.invalidParameters),t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new Ae$1({userId:n.userId,pushTriggerOption:e}),[4,r.send(i$1)];case 1:return [2,s.sent().as(ye).pushTriggerOption]}}))}))},n$1.prototype.getPushTemplate=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new at({userId:t.userId}),[4,n.send(r)];case 1:return [2,i.sent().as(ut).name]}}))}))},n$1.prototype.setPushTemplate=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return at$2(m(q,e)).throw(p.invalidParameters),t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new ct({userId:n.userId,templateName:e}),[4,r.send(i$1)];case 1:return [2,s.sent().as(lt).name]}}))}))},n$1.prototype.blockUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return at$2(e instanceof ct$2||y("string",e)).throw(p.invalidParameters),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new st({userId:r.userId,blockedUserId:e instanceof ct$2?e.userId:e}),[4,i$1.send(s)];case 1:return o.sent(),[2]}}))}))},n$1.prototype.blockUserWithUserId=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.blockUser(e)]}))}))},n$1.prototype.unblockUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return at$2(e instanceof ct$2||y("string",e)).throw(p.invalidParameters),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new ot({userId:r.userId,unblockedUserId:e instanceof ct$2?e.userId:e}),[4,i$1.send(s)];case 1:return o.sent(),[2]}}))}))},n$1.prototype.unblockUserWithUserId=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.unblockUser(e)]}))}))},n$1.prototype.getFriendChangeLogsByToken=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return at$2(y("string",e)).throw(p.invalidParameters),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new ht({userId:r.userId,token:e}),[4,i$1.send(s)];case 1:return o=a.sent(),[2,o.as(dt).changelogs]}}))}))},n$1.prototype.getAllowFriendDiscovery=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return e=St$2.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new bt({userId:t.userId}),[4,n.send(r)];case 1:return i$1=s.sent(),[2,i$1.as(gt).allowFriendDiscovery]}}))}))},n$1.prototype.setAllowFriendDiscovery=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return at$2(y("boolean",e)).throw(p.invalidParameters),n=St$2.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new It({userId:r.userId,allowFriendDiscovery:e}),[4,i$1.send(s)];case 1:return o.sent(),[2,e]}}))}))},n$1.prototype.uploadFriendDiscoveries=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new ft({userId:n.userId,discoveries:e}),[4,r.send(i$1)];case 1:return s=o.sent(),[2,s.as(pt).friendDiscoveryRequestId]}}))}))},n$1.prototype.deleteFriendDiscovery=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.deleteFriendDiscoveries([e])]}))}))},n$1.prototype.deleteFriendDiscoveries=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new vt({userId:n.userId,discoveryKeys:e}),[4,r.send(i$1)];case 1:return s.sent(),[2]}}))}))},n$1.prototype.addFriends=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new _t({userId:n.userId,userIds:e}),[4,r.send(i$1)];case 1:return s=o.sent(),[2,s.as(mt).users]}}))}))},n$1.prototype.deleteFriend=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.deleteFriends([e])]}))}))},n$1.prototype.deleteFriends=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return at$2(E("string",e)).throw(p.invalidParameters),t=St$2.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new yt({userId:n.userId,userIds:e}),[4,r.send(i$1)];case 1:return s.sent(),[2]}}))}))},n$1.prototype.getAllEmoji=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:return e=St$2.of(this._iid).requestQueue,t=new Ot,[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(St).emojiContainer]}}))}))},n$1.prototype.getEmojiCategory=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=St$2.of(this._iid).requestQueue,n=new Tt({categoryId:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(xt).emojiCategory]}}))}))},n$1.prototype.getEmoji=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=St$2.of(this._iid).requestQueue,n=new Ct({key:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Rt).emoji]}}))}))},n$1}();
var _;!function(e){e[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE";}(_||(_={}));var l=function(){function n(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts;}return Object.defineProperty(n.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===ne.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===ne.OPEN},enumerable:!1,configurable:!0}),n}(),C=function(e){function t$1(n,t,a){var s=e.call(this,n,"SYEV",a)||this;return s.event=new l(a),s}return t(t$1,e),t$1}(B$1),d=function(e){function t$1(n,t,s){var N=e.call(this,n,t,s)||this,o=s.data.operators,E=void 0===o?[]:o;return N.operators=E.map((function(e){return new ct$2(N._iid,e)})),N}return t(t$1,e),t$1}(C),h=function(e){function t$1(n,t,a){var s=e.call(this,n,"MCNT",a)||this;return s.groupChannelMemberCounts=a.group_channels.map((function(e){return {channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}})),s.openChannelMemberCounts=a.open_channels.map((function(e){return {channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}})),s}return t(t$1,e),t$1}(B$1),A=function(e){function t$1(n,t,a){var E,r,i,u=this;(u=e.call(this,n,"ADMM",a)||this).message=new Kt$1(n,a);var _=St$2.of(n).sdkState;return u.isMentioned=Ye$2(u.message.mentionType,null!==(E=u.message.mentionedUserIds)&&void 0!==E?E:null===(r=u.message.mentionedUsers)||void 0===r?void 0:r.map((function(e){return e.userId})),_.userId),u.forceUpdateLastMessage=null!==(i=a.force_update_last_message)&&void 0!==i&&i,u}return t(t$1,e),t$1}(B$1),c=function(e){function t$1(n,t,a){var o,r,i,u,_,l,C=this;(C=e.call(this,n,"AEDI",a)||this).message=new Kt$1(n,a);var d=St$2.of(n).sdkState;return C.mentionCountChange=Je$2({mentionType:null!==(r=null===(o=a.old_values)||void 0===o?void 0:o.mention_type)&&void 0!==r?r:null,mentionedUserIds:null!==(u=null===(i=a.old_values)||void 0===i?void 0:i.mentioned_user_ids)&&void 0!==u?u:[]},{mentionType:C.message.mentionType,mentionedUserIds:null!==(_=C.message.mentionedUserIds)&&void 0!==_?_:null===(l=C.message.mentionedUsers)||void 0===l?void 0:l.map((function(e){return e.userId}))},d.userId),C}return t(t$1,e),t$1}(B$1),H=function(e){function t$1(n,t,a){var s=e.call(this,n,"MRCT",a)||this;return s.channelUrl=a.channel_url,s.channelType=a.channel_type,s.event=new wt$2(a),s}return t(t$1,e),t$1}(B$1),T=function(e){function t$1(n,t,a){var s=e.call(this,n,"MTHD",a)||this;return s.event=new Sn$1(n,a),s}return t(t$1,e),t$1}(B$1),U=function(){this.onUserMuted=Y,this.onUserUnmuted=Y,this.onUserBanned=Y,this.onUserUnbanned=Y,this.onChannelChanged=Y,this.onChannelDeleted=Y,this.onChannelFrozen=Y,this.onChannelUnfrozen=Y,this.onOperatorUpdated=Y,this.onChannelMemberCountChanged=Y,this.onMetaDataCreated=Y,this.onMetaDataUpdated=Y,this.onMetaDataDeleted=Y,this.onMetaCounterCreated=Y,this.onMetaCounterUpdated=Y,this.onMetaCounterDeleted=Y,this.onMessageReceived=Y,this.onMessageUpdated=Y,this.onMessageDeleted=Y,this.onMentionReceived=Y,this.onReactionUpdated=Y,this.onThreadInfoUpdated=Y;};var en=function(r$1){function a(){var n=null!==r$1&&r$1.apply(this,arguments)||this;return n._channels=new Map,n._enteredChannelUrls=[],n}return t(a,r$1),Object.defineProperty(a.prototype,"enteredChannels",{get:function(){var n=this;return this._enteredChannelUrls.map((function(e){return n._channels.get(e)})).filter((function(n){return null!==n}))},enumerable:!1,configurable:!0}),a.prototype.isEnteredChannel=function(n){return this._enteredChannelUrls.includes(n)},a.prototype.enter=function(n){this._enteredChannelUrls.indexOf(n)<0&&this._enteredChannelUrls.push(n);},a.prototype.exit=function(n){var e=this._enteredChannelUrls.indexOf(n);e>=0&&this._enteredChannelUrls.splice(e,1);},a.prototype.exitAll=function(){this._enteredChannelUrls=[];},a.prototype.get=function(n){var r$1;return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,null!==(r$1=this._channels.get(n))&&void 0!==r$1?r$1:null]}))}))},a.prototype.upsert=function(n){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){return n.forEach((function(n){if(e._channels.has(n.url)){var t=e._channels.get(n.url);Object.assign(t,n);}else e._channels.set(n.url,n);})),[2]}))}))},a.prototype.remove=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){return this._channels.delete(n),this.exit(n),[2]}))}))},a.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(n){return this._channels.clear(),this._enteredChannelUrls=[],[2]}))}))},a}(Le$2),tn={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},rn=function(e){function t$1(n){var t=n.channelUrl,r=n.isInternalCall,a=e.call(this)||this;return a.method=d$1.GET,a.path="".concat(r?Ge$2:xe$1,"/").concat(encodeURIComponent(t)),a}return t(t$1,e),t$1}(q$1),an=function(e){function t$1(n,t){var r=e.call(this,n,t)||this;return r.channel=null,r.channel=new gn(n,t),r}return t(t$1,e),t$1}(F),sn=function(e){function t$1(n){var t=this,r=n.channelUrl,a=n.coverUrlOrImage,u=n.name,l=n.data,h=n.customType,p=n.operatorUserIds;return (t=e.call(this)||this).method=d$1.POST,t.path=xe$1,t.params=U$1({channel_url:r,cover_url:y("string",a)?a:null,cover_file:S(a)?a:null,name:u,data:l,custom_type:h,operators:p}),t}return t(t$1,e),t$1}(q$1);!function(e){function t$1(n,t){var r=e.call(this,n,t)||this;return r.channel=new gn(n,t),r}t(t$1,e);}(F);var on=function(e){function t$1(n){var t=n.channelUrl;return e.call(this,{code:"ENTR",payload:{channel_url:t},ackRequired:!0})||this}return t(t$1,e),t$1}(H$2),un=function(e){function t$1(n,t,r){var a,i,s=this;return s=e.call(this,n,"ENTR",r)||this,r.data&&(s.participantCount=null!==(a=r.data.participant_count)&&void 0!==a?a:0,s.user=new ct$2(n,r.data),s.ts=null!==(i=r.data.edge_ts)&&void 0!==i?i:0),s}return t(t$1,e),t$1}(B$1),cn=function(e){function t$1(n){var t=n.channelUrl;return e.call(this,{code:"EXIT",payload:{channel_url:t},ackRequired:!0})||this}return t(t$1,e),t$1}(H$2),ln=function(e){function t$1(n,t,r){var a,i,s=this;return s=e.call(this,n,"EXIT",r)||this,r.data&&(s.participantCount=null!==(a=r.data.participant_count)&&void 0!==a?a:0,s.user=new ct$2(n,r.data),s.ts=null!==(i=r.data.edge_ts)&&void 0!==i?i:0),s}return t(t$1,e),t$1}(B$1),hn={},dn=function(){function n$1(n,e){var t=e.sdkState,r=e.dispatcher,a=e.requestQueue,i=this;this._sdkState=t,this._requestQueue=a,this._dispatcher=r,this._openChannelCache=new en(n),this._openChannelHandlers=new Map,this._dispatcher.on((function(n){var e,t;if(n instanceof B$1)i._handleEvent(n);else if(n instanceof de$2&&n.stateType===J$1.CONNECTED){var r=i._openChannelCache.enteredChannels;try{for(var a=s(r),s$1=a.next();!s$1.done;s$1=a.next()){s$1.value.enter();}}catch(n){e={error:n};}finally{try{s$1&&!s$1.done&&(t=a.return)&&t.call(a);}finally{if(e)throw e.error}}}})),hn[n]=this;}return n$1.of=function(n){return hn[n]},n$1.prototype.buildOpenChannelFromSerializedData=function(n){var e=ot$2(n);return new gn(e._iid,gn.payloadify(e))},n$1.prototype.getChannelFromCache=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._openChannelCache.get(n)];case 1:return [2,e.sent()]}}))}))},n$1.prototype.upsertChannelsToCache=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._openChannelCache.upsert(n)];case 1:return e.sent(),[2]}}))}))},n$1.prototype.removeChannelsFromCache=function(n){return r(this,void 0,void 0,(function(){var e,r,a,i$1,s$1,o;return i(this,(function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),e=s(n),r=e.next(),t.label=1;case 1:return r.done?[3,4]:(a=r.value,[4,this._openChannelCache.remove(a)]);case 2:t.sent(),t.label=3;case 3:return r=e.next(),[3,1];case 4:return [3,7];case 5:return i$1=t.sent(),s$1={error:i$1},[3,7];case 6:try{r&&!r.done&&(o=e.return)&&o.call(e);}finally{if(s$1)throw s$1.error}return [7];case 7:return [2]}}))}))},n$1.prototype.setEnteredToCache=function(n){this._openChannelCache.enter(n.url);},n$1.prototype.setExitedToCache=function(n){this._openChannelCache.exit(n.url);},n$1.prototype._handleEvent=function(n){return r(this,void 0,void 0,(function(){var r$1,a,i$1,s$1,o,u,c$1,l,h$2,d$1,p,f,C$1,v,_$1,m,T$1,N,H$1,I,M,b,O,D,x,A$1,B,nn,en,tn,rn,an,sn,on,cn,hn,dn,pn,fn,Cn,vn,_n,yn,mn,gn,Un,En,wn,Tn,Nn,Hn,In,Mn,bn,On,Dn,xn,An,Pn,Ln=this;return i(this,(function(Rn){switch(Rn.label){case 0:switch(Rn.trys.push([0,51,,52]),n.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return [3,1];case"MEDI":case"FEDI":case"AEDI":return [3,4];case"DELM":return [3,7];case"MRCT":return [3,10];case"MTHD":return [3,13];case"MCNT":return [3,16];case"SYEV":return [3,27]}return [3,50];case 1:return s$1=null,"MESG"===n.code?s$1=n.as(gt$1):"FILE"===n.code?s$1=n.as(Jt$1):"ADMM"!==n.code&&"BRDM"!=n.code||(s$1=n.as(A)),s$1?(r$1=s$1.message,a=s$1.isMentioned,r$1.channelType!==ne.OPEN?[3,3]:[4,this.getChannel(r$1.channelUrl,!0)]):[3,3];case 2:i$1=Rn.sent(),Ie$1((function(){return r(Ln,void 0,void 0,(function(){var n,e,s$1,o,u;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())s$1=e.value,this._openChannelCache.isEnteredChannel(i$1.url)&&s$1.onMessageReceived(i$1,r$1),a&&s$1.onMentionReceived(i$1,r$1);}catch(n){o={error:n};}finally{try{e&&!e.done&&(u=n.return)&&u.call(n);}finally{if(o)throw o.error}}return [2]}))}))})),Rn.label=3;case 3:return [3,50];case 4:return s$1=null,"MEDI"===n.code?s$1=n.as(Tt$1):"FEDI"===n.code?s$1=n.as(It$1):"AEDI"===n.code&&(s$1=n.as(c)),s$1?(o=s$1.message).channelType!==ne.OPEN?[3,6]:[4,this.getChannel(o.channelUrl,!0)]:[3,6];case 5:u=Rn.sent(),Ie$1((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a,i$1;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())r=e.value,this._openChannelCache.isEnteredChannel(u.url)&&r.onMessageUpdated(u,o);}catch(n){a={error:n};}finally{try{e&&!e.done&&(i$1=n.return)&&i$1.call(n);}finally{if(a)throw a.error}}return [2]}))}))})),Rn.label=6;case 6:return [3,50];case 7:return c$1=n.as(Mt$1),M=c$1.channelUrl,p=c$1.channelType,l=c$1.messageId,p!==ne.OPEN?[3,9]:[4,this.getChannel(M,!0)];case 8:h$2=Rn.sent(),Ie$1((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a,i$1;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())r=e.value,this._openChannelCache.isEnteredChannel(h$2.url)&&r.onMessageDeleted(h$2,l);}catch(n){a={error:n};}finally{try{e&&!e.done&&(i$1=n.return)&&i$1.call(n);}finally{if(a)throw a.error}}return [2]}))}))})),Rn.label=9;case 9:return [3,50];case 10:return d$1=n.as(H),M=d$1.channelUrl,p=d$1.channelType,f=d$1.event,p!==ne.OPEN?[3,12]:[4,this.getChannel(M,!0)];case 11:C$1=Rn.sent(),Ie$1((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())e.value.onReactionUpdated(C$1,f);}catch(n){r={error:n};}finally{try{e&&!e.done&&(a=n.return)&&a.call(n);}finally{if(r)throw r.error}}return [2]}))}))})),Rn.label=12;case 12:return [3,50];case 13:return (v=n.as(T).event).channelType!==ne.OPEN?[3,15]:[4,this.getChannel(v.channelUrl,!0)];case 14:_$1=Rn.sent(),Ie$1((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())e.value.onThreadInfoUpdated(_$1,v);}catch(n){r={error:n};}finally{try{e&&!e.done&&(a=n.return)&&a.call(n);}finally{if(r)throw r.error}}return [2]}))}))})),Rn.label=15;case 15:return [3,50];case 16:m=n.as(h).openChannelMemberCounts,T$1=[],Rn.label=17;case 17:Rn.trys.push([17,22,23,24]),N=s(m),H$1=N.next(),Rn.label=18;case 18:return H$1.done?[3,21]:(I=H$1.value,M=I.channelUrl,an=I.participantCount,b=I.updatedAt,[4,this.getChannelFromCache(M)]);case 19:(O=Rn.sent())&&O._updateParticipantCount(an,b)&&T$1.push(O),Rn.label=20;case 20:return H$1=N.next(),[3,18];case 21:return [3,24];case 22:return D=Rn.sent(),An={error:D},[3,24];case 23:try{H$1&&!H$1.done&&(Pn=N.return)&&Pn.call(N);}finally{if(An)throw An.error}return [7];case 24:return T$1.length>0?[4,this.upsertChannelsToCache(T$1)]:[3,26];case 25:Rn.sent(),Ie$1((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())e.value.onChannelMemberCountChanged(T$1);}catch(n){r={error:n};}finally{try{e&&!e.done&&(a=n.return)&&a.call(n);}finally{if(r)throw r.error}}return [2]}))}))})),Rn.label=26;case 26:return [3,50];case 27:if(!(x=n.as(C).event).isOpenChannelEvent)return [3,49];switch(x.category){case _.CHANNEL_ENTER:return [3,28];case _.CHANNEL_EXIT:return [3,30];case _.CHANNEL_OPERATOR_UPDATE:return [3,32];case _.USER_CHANNEL_MUTE:case _.USER_CHANNEL_UNMUTE:return [3,34];case _.USER_CHANNEL_BAN:case _.USER_CHANNEL_UNBAN:return [3,36];case _.CHANNEL_FREEZE:case _.CHANNEL_UNFREEZE:return [3,38];case _.CHANNEL_DELETED:return [3,40];case _.CHANNEL_PROP_CHANGED:return [3,43];case _.CHANNEL_META_DATA_CHANGED:return [3,45];case _.CHANNEL_META_COUNTERS_CHANGED:return [3,47]}return [3,49];case 28:return [4,this.getChannel(x.channelUrl,!0)];case 29:return A$1=Rn.sent(),B=n.as(un),an=B.participantCount,nn=B.user,en=A$1._updateParticipantCount(an,x.ts),Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onUserEntered(A$1,nn),en&&n.onChannelParticipantCountChanged(A$1);})),[2]}))}))})),[3,49];case 30:return [4,this.getChannel(x.channelUrl,!0)];case 31:return tn=Rn.sent(),rn=n.as(ln),an=rn.participantCount,sn=rn.user,on=tn._updateParticipantCount(an,x.ts),Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onUserExited(tn,sn),on&&n.onChannelParticipantCountChanged(tn);})),[2]}))}))})),[3,49];case 32:return [4,this.getChannel(x.channelUrl,!0)];case 33:return cn=Rn.sent(),hn=n.as(d).operators,cn.operators=hn,this.upsertChannelsToCache([cn]),Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onOperatorUpdated(cn,hn);})),[2]}))}))})),[3,49];case 34:return [4,this.getChannel(x.channelUrl,!0)];case 35:return dn=Rn.sent(),pn=x.category===_.USER_CHANNEL_MUTE,fn=n.as(pn?at$1:ot$1).user,Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){pn?n.onUserMuted(dn,fn):n.onUserUnmuted(dn,fn);})),[2]}))}))})),[3,49];case 36:return [4,this.getChannel(x.channelUrl,!0)];case 37:return Cn=Rn.sent(),vn=x.category===_.USER_CHANNEL_BAN,_n=n.as(vn?ct$1:dt$1).user,Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){vn?n.onUserBanned(Cn,_n):n.onUserUnbanned(Cn,_n);})),[2]}))}))})),[3,49];case 38:return [4,this.getChannel(x.channelUrl,!0)];case 39:return yn=Rn.sent(),mn=n.as(pt$1).freeze,yn.isFrozen=mn,this.upsertChannelsToCache([yn]),Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){mn?n.onChannelFrozen(yn):n.onChannelUnfrozen(yn);})),[2]}))}))})),[3,49];case 40:return [4,this.getChannel(x.channelUrl,!0)];case 41:return gn=Rn.sent(),[4,this.removeChannelsFromCache([gn.url])];case 42:return Rn.sent(),Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onChannelDeleted(gn.url,gn.channelType);})),[2]}))}))})),[3,49];case 43:return [4,this.getChannelWithoutCache(x.channelUrl,!0)];case 44:return Un=Rn.sent(),Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onChannelChanged(Un);})),[2]}))}))})),[3,49];case 45:return [4,this.getChannel(x.channelUrl,!0)];case 46:return En=Rn.sent(),wn=n.as(je$1),Tn=wn.created,Nn=wn.updated,Hn=wn.deleted,Tn&&En._upsertCachedMetaData(Tn,x.ts),Nn&&En._upsertCachedMetaData(Nn,x.ts),Hn&&En._removeFromCachedMetaData(Hn,x.ts),Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){Tn&&n.onMetaDataCreated(En,Tn),Nn&&n.onMetaDataUpdated(En,Nn),Hn&&n.onMetaDataDeleted(En,Hn);})),[2]}))}))})),[3,49];case 47:return [4,this.getChannel(x.channelUrl,!0)];case 48:return In=Rn.sent(),Mn=n.as(tt$1),bn=Mn.created,On=Mn.updated,Dn=Mn.deleted,Ie$1((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){bn&&n.onMetaCounterCreated(In,bn),On&&n.onMetaCounterUpdated(In,On),Dn&&n.onMetaCounterDeleted(In,Dn);})),[2]}))}))})),[3,49];case 49:return [3,50];case 50:return [3,52];case 51:if(xn=Rn.sent(),h$1(xn))throw xn;return [3,52];case 52:return [2]}}))}))},n$1.prototype.addHandler=function(n,e){this._openChannelHandlers.set(n,e);},n$1.prototype.removeHandler=function(n){this._openChannelHandlers.delete(n);},n$1.prototype.clearHandler=function(){this._openChannelHandlers.clear();},n$1.prototype.getChannel=function(n,r$1){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:at$2(y("string",n)).throw(p.invalidParameters),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.getChannelFromCache(n)];case 2:return (e=t.sent())?[2,e]:[3,4];case 3:return t.sent(),[3,4];case 4:return [4,this.getChannelWithoutCache(n)];case 5:return [2,t.sent()]}}))}))},n$1.prototype.getChannelWithoutCache=function(n,r$1){return void 0===r$1&&(r$1=!1),r(this,void 0,void 0,(function(){var e,a,s;return i(this,(function(t){switch(t.label){case 0:return at$2(y("string",n)).throw(p.invalidParameters),e=new rn({channelUrl:n,isInternalCall:r$1}),[4,this._requestQueue.send(e)];case 1:return a=t.sent(),s=a.as(an).channel,[4,this.upsertChannelsToCache([s])];case 2:return t.sent(),[2,s]}}))}))},n$1.prototype.createChannel=function(n$1){return r(this,void 0,void 0,(function(){var e,r,o;return i(this,(function(t){switch(t.label){case 0:return n$1=n(n({},tn),n$1),at$2(function(n){return E("string",n.operatorUserIds,!0)&&(y("string",n.coverUrlOrImage)||S(n.coverUrlOrImage)||null===n.coverUrlOrImage)&&y("string",n.name,!0)&&y("string",n.data,!0)&&y("string",n.customType,!0)&&(y("string",n.channelUrl)&&/^\w+$/.test(n.channelUrl)||null===n.channelUrl)}(n$1)).throw(p.invalidParameters),e=new sn(n$1),[4,this._requestQueue.send(e)];case 1:return r=t.sent(),o=r.as(an).channel,this.upsertChannelsToCache([o]),[2,o]}}))}))},n$1}(),pn={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},fn=function(e){function t$1(n){var t=this,r=n.channelUrl,a=n.token,i=n.limit;return (t=e.call(this)||this).method=d$1.GET,t.path="".concat(xe$1,"/").concat(encodeURIComponent(r),"/participants"),t.params={token:a,limit:i},t}return t(t$1,e),t$1}(q$1),Cn=function(e){function t$1(n,t){var r=e.call(this,n,t)||this;r.token=null,r.participants=[];var a=t.next,i=t.participants;return r.token=a,r.participants=i.map((function(e){return new ct$2(n,e)})),r}return t(t$1,e),t$1}(F),vn=function(r$1){function a(n,e,t){return r$1.call(this,n,e,ne.OPEN,t)||this}return t(a,r$1),a.prototype._validate=function(){return r$1.prototype._validate.call(this)},a.prototype.next=function(){return r(this,void 0,void 0,(function(){var n$1,e,r,a,i$1,s;return i(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,n$1=St$2.of(this._iid).requestQueue,e=new fn(n(n({},this),{token:this._token})),[4,n$1.send(e)]):[3,2]:[3,5];case 1:return r=t.sent(),a=r.as(Cn),i$1=a.participants,s=a.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i$1];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},a}(On$1),_n=function(e){function t$1(n){var t=this,r=n.channelUrl,a=n.coverUrlOrImage,u=n.name,l=n.data,h=n.customType,p=n.operatorUserIds;return (t=e.call(this)||this).method=d$1.PUT,t.path="".concat(xe$1,"/").concat(encodeURIComponent(r)),t.params=U$1({cover_url:y("string",a)?a:null,cover_file:S(a)?a:null,name:u,data:l,custom_type:h,operators:p}),t}return t(t$1,e),t$1}(q$1),yn=function(e){function t$1(n,t){var r=e.call(this,n,t)||this;return r.channel=new gn(n,t),r}return t(t$1,e),t$1}(F),mn=function(e){function t$1(n){var t=this,r=n.channelUrl;return (t=e.call(this)||this).method=d$1.DELETE,t.path="".concat(xe$1,"/").concat(encodeURIComponent(r)),t}return t(t$1,e),t$1}(q$1);!function(e){function t$1(n,t){return e.call(this,n,t)||this}t(t$1,e);}(F);var gn=function(r$1){function o(n,e){var t,a=this;return (a=r$1.call(this,n,e)||this)._lastParticipantCountUpdated=0,a.participantCount=0,a.operators=[],a.channelType=ne.OPEN,a.participantCount=null!==(t=e.participant_count)&&void 0!==t?t:0,a.operators=Array.isArray(e.operators)?e.operators.map((function(e){return new ct$2(n,e)})):[],a}return t(o,r$1),o.payloadify=function(n$1){return n$1?U$1(n(n({},kt$1.payloadify(n$1)),{participant_count:n$1.participantCount,operators:n$1.operators.map((function(n){return ct$2.payloadify(n)}))})):null},o.prototype.serialize=function(){return st$2(this)},o.prototype.isOperator=function(n){return n instanceof ct$2?this.isOperator(n.userId):this.operators.some((function(e){return e.userId===n}))},o.prototype._updateParticipantCount=function(n,e){return e>this._lastParticipantCountUpdated&&(this.participantCount=n,this._lastParticipantCountUpdated=e,!0)},o.prototype.createParticipantListQuery=function(n){return new vn(this._iid,this.url,n)},o.prototype.refresh=function(){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return [4,dn.of(this._iid).getChannelWithoutCache(this.url)];case 1:return [2,n.sent()]}}))}))},o.prototype.enter=function(){return r(this,void 0,void 0,(function(){var n,e,r,a,i$1,s;return i(this,(function(t){switch(t.label){case 0:return n=St$2.of(this._iid).requestQueue,e=new on({channelUrl:this.url}),[4,n.send(e)];case 1:return r=t.sent(),a=r.as(un),i$1=a.participantCount,s=a.ts,this._updateParticipantCount(i$1,s),dn.of(this._iid).setEnteredToCache(this),[2]}}))}))},o.prototype.exit=function(){return r(this,void 0,void 0,(function(){var n,e,r,a,i$1,s;return i(this,(function(t){switch(t.label){case 0:return n=St$2.of(this._iid).requestQueue,e=new cn({channelUrl:this.url}),[4,n.send(e)];case 1:return r=t.sent(),a=r.as(ln),i$1=a.participantCount,s=a.ts,this._updateParticipantCount(i$1,s),dn.of(this._iid).setExitedToCache(this),En$2.of(this._iid).fileMessageQueue.cancel(this),[2]}}))}))},o.prototype.updateChannel=function(n$1){return r(this,void 0,void 0,(function(){var e,r,o,u;return i(this,(function(t){switch(t.label){case 0:return n$1=n(n({},pn),n$1),at$2(function(n){return E("string",n.operatorUserIds,!0)&&(y("string",n.coverUrlOrImage)||S(n.coverUrlOrImage)||null===n.coverUrlOrImage)&&y("string",n.name,!0)&&y("string",n.data,!0)&&y("string",n.customType,!0)}(n$1)).throw(p.invalidParameters),e=St$2.of(this._iid).requestQueue,r=new _n(n({channelUrl:this.url},n$1)),[4,e.send(r)];case 1:return o=t.sent(),u=o.as(yn).channel,[4,dn.of(this._iid).upsertChannelsToCache([u])];case 2:return t.sent(),[2,u]}}))}))},o.prototype.updateChannelWithOperatorUserIds=function(n$1,r$1,a,i$1,s){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return e=n(n({},pn),{name:n$1,coverUrlOrImage:r$1,data:a,operatorUserIds:i$1,customType:s}),[2,this.updateChannel(e)]}))}))},o.prototype.delete=function(){return r(this,void 0,void 0,(function(){var n,e;return i(this,(function(t){switch(t.label){case 0:return n=St$2.of(this._iid).requestQueue,e=new mn({channelUrl:this.url}),[4,n.send(e)];case 1:return t.sent(),[4,dn.of(this._iid).removeChannelsFromCache([this.url])];case 2:return t.sent(),[2]}}))}))},o}(kt$1);(function(e){function t$1(n){void 0===n&&(n={});var t=e.call(this)||this;return Object.keys(n).forEach((function(e){t.hasOwnProperty(e)&&(t[e]=n[e]);})),t}return t(t$1,e),t$1})(function(e){function t$1(){var n=null!==e&&e.apply(this,arguments)||this;return n.onUserEntered=Y,n.onUserExited=Y,n.onChannelParticipantCountChanged=Y,n}return t(t$1,e),t$1}(U));var En=function(e){function t$1(n){var t=this,r=n.token,a=n.limit,i=n.nameKeyword,s=n.urlKeyword,u=n.customTypes,l=n.includeFrozen,h=n.includeMetaData;return (t=e.call(this)||this).method=d$1.GET,t.path=xe$1,t.params=U$1({token:r,limit:a,name_contains:i,url_contains:s,custom_types:u,show_frozen:l,show_metadata:h}),t}return t(t$1,e),t$1}(q$1),wn=function(e){function t$1(n,t){var r=e.call(this,n,t)||this;r.token=null,r.channels=[],r.ts=null;var a=t.next,i=t.channels,s=t.ts;return r.token=a,i&&i.length>0&&(r.channels=i.map((function(e){return new gn(n,e)}))),r.ts="number"==typeof s?s:null,r}return t(t$1,e),t$1}(F),Tn=function(r$1){function s(n,e){var t,a,i,s,o,u=this;return (u=r$1.call(this,n,e)||this).includeFrozen=!0,u.includeMetaData=!0,u.nameKeyword=null,u.urlKeyword=null,u.customTypes=null,u.includeFrozen=null===(t=e.includeFrozen)||void 0===t||t,u.includeMetaData=null===(a=e.includeMetaData)||void 0===a||a,u.nameKeyword=null!==(i=e.nameKeyword)&&void 0!==i?i:null,u.urlKeyword=null!==(s=e.urlKeyword)&&void 0!==s?s:null,u.customTypes=null!==(o=e.customTypes)&&void 0!==o?o:null,u}return t(s,r$1),s.prototype._validate=function(){return r$1.prototype._validate.call(this)&&y("boolean",this.includeFrozen)&&y("boolean",this.includeMetaData)&&y("string",this.nameKeyword,!0)&&y("string",this.urlKeyword,!0)&&E("string",this.customTypes,!0)},s.prototype.next=function(){return r(this,void 0,void 0,(function(){var n$1,e,r,a,i$1,s;return i(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,n$1=St$2.of(this._iid).requestQueue,e=new En(n(n({},this),{token:this._token})),[4,n$1.send(e)]):[3,3]:[3,6];case 1:return r=t.sent(),a=r.as(wn),i$1=a.channels,s=a.token,this._token=s,this._hasNext=!!s,[4,dn.of(this._iid).upsertChannelsToCache(i$1)];case 2:return t.sent(),this._isLoading=!1,[2,i$1];case 3:return [2,[]];case 4:throw p.queryInProgress;case 5:return [3,7];case 6:throw p.invalidParameters;case 7:return [2]}}))}))},s}(bn$1),Nn=function(r$1){function a(){var n=null!==r$1&&r$1.apply(this,arguments)||this;return n.name="openChannel",n}return t(a,r$1),a.prototype.init=function(n,e){var t=e.sdkState,a=e.dispatcher,i=e.sessionManager,s=e.requestQueue,o=e.logger,u=e.onlineDetector,c=e.cacheContext;r$1.prototype.init.call(this,n,{sdkState:t,dispatcher:a,sessionManager:i,requestQueue:s,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new dn(n,{sdkState:t,dispatcher:a,requestQueue:s});},a.prototype.createOpenChannelListQuery=function(n){return void 0===n&&(n={}),new Tn(this._iid,n)},a.prototype.addOpenChannelHandler=function(n,e){this._manager.addHandler(n,e);},a.prototype.removeOpenChannelHandler=function(n){this._manager.removeHandler(n);},a.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler();},a.prototype.buildOpenChannelFromSerializedData=function(n){return this._manager.buildOpenChannelFromSerializedData(n)},a.prototype.getChannel=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,this._manager.getChannel(n)]}))}))},a.prototype.getChannelWithoutCache=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,this._manager.getChannelWithoutCache(n)]}))}))},a.prototype.createChannel=function(n){return void 0===n&&(n={}),r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,this._manager.createChannel(n)]}))}))},a.prototype.createChannelWithOperatorUserIds=function(n$1,r$1,a,i$1,s){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return (e=n({},tn)).name=n$1,e.coverUrlOrImage=r$1,e.data=a,e.operatorUserIds=i$1,e.customType=s,[2,this._manager.createChannel(e)]}))}))},a}(Tt$2);class CommandRouter extends EventTarget {
  // TODO :: call unsubscriber
  constructor(_ctx) {
    super();
    this._ctx = _ctx;
    this.wsClient = new WebSocketClient({ ..._ctx,
      parse: command => LiveCommandFactory.parse(command)
    }); // @ts-ignore

    this.apiClient = new APIClient({ ..._ctx,
      parseResponse: (command, bodyJson) => LiveCommandFactory.parseResponse(command, bodyJson)
    });
    this._unsubscriber = this.wsClient.on('command', command => {
      this._dispatchEvent("command", command);
    });
  }

  connectWs() {
    return this.wsClient.connect();
  }

  sendAPI(req) {
    return this.apiClient.send(req);
  }

  async send(req) {
    return this.sendAPI(req);
  }

  async sendWithRetry(req) {
    let strategy = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new IncrementalStrategy();
    let meta = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {
      count: 0,
      deferred: new Deferred()
    };
    const {
      deferred,
      count
    } = meta;

    try {
      const res = await this.send(req);
      deferred.resolve(res);
    } catch (error) {
      const timeout = strategy.calcTimeout(count);

      if (timeout > 0) {
        setTimeout(() => {
          this.sendWithRetry(req, strategy, {
            count: count + 1,
            deferred
          });
        }, timeout);
      } else {
        deferred.reject(error);
      }
    }

    return deferred.promise;
  }

  _setSessionKey(sessionKey) {
    this.apiClient.setSessionKey(sessionKey);
    this.wsClient.setSessionKey(sessionKey);
  }

  async authenticate(_ref) {
    let {
      userId,
      accessToken
    } = _ref;
    const sb = Fn.init({
      appId: this._ctx.appId,
      modules: [new Nn()]
    }); // @ts-ignore

    this._ctx.sb = sb; // TODO :: get chat user object

    try {
      await sb.connect(userId, accessToken);
      const authCommand = LiveCommandFactory.createAuth(this._ctx.appId, userId, accessToken);
      const res = await this.send(authCommand);

      this._setSessionKey(res.sbcall_session_token);

      this._ctx.liveEventManager.userId = res.user.user_id;
    } catch (e) {
      logger.error(`failed to authenticate user ${userId}`);
      throw e;
    }
  }

  deauthenticate() {
    this.apiClient.clearSessionKey();
    this.wsClient.clearSessionKey();
  }

}const LEVELS_INFO = {
  VERBOSE: {
    level: -1,
    name: LEVELS.VERBOSE,
    public: false
  },
  DEBUG: {
    level: 1,
    name: LEVELS.DEBUG,
    public: false
  },
  INFO: {
    level: 2,
    name: LEVELS.INFO,
    public: true
  },
  WARNING: {
    level: 3,
    name: LEVELS.WARNING,
    public: true
  },
  ERROR: {
    level: 4,
    name: LEVELS.ERROR,
    public: true
  },
  NONE: {
    level: 100,
    name: LEVELS.NONE,
    public: true
  }
};class logListener {
  constructor(level) {
    this.level = level || LEVELS.NONE;
  }

  setLoggerLevel(level) {
    if (LEVELS_INFO[level]?.public) {
      this.level = level;
    }

    return this.level;
  }

  _enabledFor(lv) {
    try {
      return LEVELS_INFO[this.level].level <= LEVELS_INFO[lv].level;
    } catch (e) {
      return false;
    }
  }

}class ConsoleLogListener extends logListener {
  constructor(level) {
    super(level);
  }

  _getLogType(lv) {
    switch (lv) {
      case LEVELS.ERROR:
        return 'error';

      case LEVELS.WARNING:
        return 'warn';

      default:
        return 'log';
    }
  }

  _getTimeString(time) {
    const year = time.getFullYear().toString().padStart(2, '0');
    const month = (time.getMonth() + 1).toString().padStart(2, '0');
    const date = time.getDate().toString().padStart(2, '0');
    const hours = time.getHours().toString().padStart(2, '0');
    const minutes = time.getMinutes().toString().padStart(2, '0');
    const seconds = time.getSeconds().toString().padStart(2, '0');
    const milliseconds = time.getMilliseconds().toString().padStart(2, '0');
    return `[${year}.${month}.${date} ${hours}:${minutes}:${seconds}:${milliseconds}]`;
  } // TODO :: any[] type???


  _permit(lv) {
    const logType = this._getLogType(lv);

    const logTime = new Date();

    if (this._enabledFor(lv) && console && console[logType]) {
      const prefix = `${this._getTimeString(logTime)} [${lv}]`;

      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }

      console[logType](prefix, ...args);
    }
  }

}/**
 * A singleton class that serves as the basis for all functionalities in Sendbird Live.
 * This class can be initialized with an application ID and provides methods to authenticate, create, and retrieve a live event object.
 */

class SendbirdLiveMain {
  constructor() {
    _defineProperty(this, "_ctx", {});
  }
  /**
   * Initializes Sendbird Live SDK with the app ID of a Sendbird application.
   */


  init(appId) {
    this._consoleLogListener = new ConsoleLogListener(LEVELS.NONE);
    logger.addListener(this._consoleLogListener);
    this._ctx.appId = appId;
    this._ctx.clientId = v4();
    this._ctx.commandRouter = new CommandRouter(this._ctx);
    this._ctx.deviceManager = new DeviceManager();
    this._ctx.liveEventManager = new LiveEventManager(this._ctx);
  }
  /**
   * You can specify log level to display log output to the console.
   */


  setLoggerLevel(level) {
    return this._consoleLogListener.setLoggerLevel(level);
  }
  /**
   * Authenticates a user with the user ID and access token to connect to Sendbird server.
   *
   * @param userId
   * @param accessToken
   */


  async authenticate(userId, accessToken) {
    await this._ctx.commandRouter.authenticate({
      userId,
      accessToken
    });
    await this._ctx.commandRouter.connectWs();
  }
  /**
   * Deauthenticates a user to disconnect from Sendbird server.
   */


  async deauthenticate() {
    await this._ctx.sb.disconnect();

    this._ctx.commandRouter.deauthenticate();

    this._ctx.liveEventManager.clear();

    logger.removeAllListener();
  }
  /**
   * Creates a live event.
   *
   * @param config
   */


  async createLiveEvent(config) {
    return this._ctx.liveEventManager.createLiveEvent(config);
  }
  /**
   * Returns a live event by its URL.
   *
   * @param liveEventId
   */


  async getLiveEvent(liveEventId) {
    return this._ctx.liveEventManager.getLiveEvent(liveEventId);
  }
  /**
   * Creates a query for a list of all live events.
   *
   * A list of live events in a specific state can be queried by specifying a state in `LiveEventListQueryParams`.
   *
   * @param params
   */


  createLiveEventListQuery(params) {
    return new LiveEventListQuery(params, this._ctx.commandRouter);
  }
  /**
   * Returns a set of available audio input devices.
   */


  getAvailableAudioInputDevices() {
    return this._ctx.deviceManager.getAvailableAudioInputDevices();
  }
  /**
   * Returns a set of available video devices.
   */


  getAvailableVideoInputDevices() {
    return this._ctx.deviceManager.getAvailableVideoInputDevices();
  }

}/**
 * This is a list of client errors that may occur.
 * These errors are usually caused by something the client app side did, such as incorrect or invalid parameters, or sending a request when disconnected.
 */
exports.ErrorCode=void 0;

(function (ErrorCode) {
  ErrorCode[ErrorCode["LIVE_EVENT_ID_NOT_FOUND"] = 2800100] = "LIVE_EVENT_ID_NOT_FOUND";
  ErrorCode[ErrorCode["ACTION_NOT_ALLOWED_IN_CURRENT_STATE"] = 2800101] = "ACTION_NOT_ALLOWED_IN_CURRENT_STATE";
  ErrorCode[ErrorCode["ACTION_NOT_ALLOWED_FOR_PARTICIPANT"] = 2800102] = "ACTION_NOT_ALLOWED_FOR_PARTICIPANT";
  ErrorCode[ErrorCode["USER_NOT_ENTERED_LIVE_EVENT"] = 2800103] = "USER_NOT_ENTERED_LIVE_EVENT";
  ErrorCode[ErrorCode["STREAM_NOT_STARTED"] = 2800104] = "STREAM_NOT_STARTED";
  ErrorCode[ErrorCode["CONNECTION_TO_MEDIA_STREAM_FAILED"] = 2800105] = "CONNECTION_TO_MEDIA_STREAM_FAILED";
  ErrorCode[ErrorCode["UNKNOWN_NETWORK_ERROR"] = 2800400] = "UNKNOWN_NETWORK_ERROR";
  ErrorCode[ErrorCode["QUERY_IN_PROGRESS"] = 2800900] = "QUERY_IN_PROGRESS";
  ErrorCode[ErrorCode["OPEN_CHANNEL_NOT_FETCHED"] = 2800901] = "OPEN_CHANNEL_NOT_FETCHED";
})(exports.ErrorCode || (exports.ErrorCode = {}));const SendbirdLive = new SendbirdLiveMain();exports.LiveEvent=LiveEvent;exports.SendbirdLive=SendbirdLive;Object.defineProperty(exports,'__esModule',{value:true});}));